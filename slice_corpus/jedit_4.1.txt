public class SoftWrapTokenHandler extends DisplayTokenHandler public void init Segment seg SyntaxStyle styles FontRenderContext fontRenderContext TabExpander expander List out float wrapMargin super init seg styles fontRenderContext expander this wrapMargin wrapMargin this out out initialSize out size seenNonWhitespace addedNonWhitespace false endX endOfWhitespace end null public List getChunkList return out public void handleToken byte id int offset int length TokenMarker LineContext context Token token createToken id offset length context if token null addToken token context if id Token WHITESPACE id Token TAB if seenNonWhitespace endOfWhitespace else seenNonWhitespace true if out size initialSize out add firstToken else if id Token WHITESPACE id Token TAB if out size initialSize end lastToken endX else if wrapMargin end null addedNonWhitespace Chunk blankSpace new Chunk endOfWhitespace end offset end length getParserRuleSet context blankSpace next end next end next null endX endOfWhitespace out add blankSpace end null endX addedNonWhitespace seenNonWhitespace private List out private float wrapMargin private float endX private Token end private boolean seenNonWhitespace private boolean addedNonWhitespace private float endOfWhitespace private int initialSize class BSHBlock extends SimpleNode BSHBlock int id super id public Object eval CallStack callstack Interpreter interpreter throws EvalError return eval callstack interpreter false public Object eval CallStack callstack Interpreter interpreter boolean overrideNamespace throws EvalError Object ret Primitive VOID int statements jjtGetNumChildren NameSpace enclosingNameSpace null if overrideNamespace enclosingNameSpace callstack top BlockNameSpace bodyNameSpace new BlockNameSpace enclosingNameSpace callstack swap bodyNameSpace try for int statements SimpleNode node SimpleNode jjtGetChild ret node eval callstack interpreter if ret instanceof ReturnControl break finally if overrideNamespace callstack swap enclosingNameSpace return ret public class GUIUtilities public static final Icon NEW_BUFFER_ICON loadIcon public static final Icon DIRTY_BUFFER_ICON loadIcon public static final Icon READ_ONLY_BUFFER_ICON loadIcon public static final Icon NORMAL_BUFFER_ICON loadIcon public static final Icon WINDOW_ICON loadIcon public static Icon loadIcon String iconName if icons null icons new Hashtable Icon icon Icon icons get iconName if icon null return icon if iconName startsWith icon new ImageIcon iconName substring else URL url GUIUtilities class getResource iconName if url null Log log Log ERROR GUIUtilities class iconName return null icon new ImageIcon url icons put iconName icon return icon public static Image getEditorIcon return ImageIcon WINDOW_ICON getImage public static Image getPluginIcon return ImageIcon WINDOW_ICON getImage public static JMenuBar loadMenuBar String name String menus jEdit getProperty name StringTokenizer st new StringTokenizer menus JMenuBar mbar new JMenuBar while st hasMoreTokens String menu st nextToken if menu equals loadPluginsMenu mbar else mbar add loadMenu menu return mbar public static JMenu loadMenu View view String name return loadMenu name public static JMenu loadMenu String name if name equals return new RecentFilesMenu else if name equals return new RecentDirectoriesMenu else if name equals return new DirectoryMenu null else if name equals return new MarkersMenu else if name equals return new DirectoryMenu jEdit getJEditHome else if name equals String settings jEdit getSettingsDirectory if settings null settings jEdit getJEditHome return new DirectoryMenu settings else if name equals return new MacrosMenu else return new EnhancedMenu name public static JPopupMenu loadPopupMenu String name JPopupMenu menu new JPopupMenu String menuItems jEdit getProperty name if menuItems null StringTokenizer st new StringTokenizer menuItems while st hasMoreTokens String menuItemName st nextToken if menuItemName equals menu addSeparator else if menuItemName startsWith menu add loadMenu menuItemName substring else menu add loadMenuItem menuItemName false return menu public static JMenuItem loadMenuItem String name return loadMenuItem name true public static JMenuItem loadMenuItem String name boolean setMnemonic EditAction action jEdit getAction name String label action null jEdit getProperty name action getLabel if label null label name char mnemonic int index label indexOf if index label length index mnemonic Character toLowerCase label charAt index label label substring index concat label substring index else mnemonic JMenuItem mi if action null action isToggle mi new EnhancedCheckBoxMenuItem label action else mi new EnhancedMenuItem label action if OperatingSystem isMacOS setMnemonic mnemonic mi setMnemonic mnemonic return mi public static JToolBar loadToolBar String name JToolBar toolBar new JToolBar toolBar setFloatable false String buttons jEdit getProperty name if buttons null StringTokenizer st new StringTokenizer buttons while st hasMoreTokens String button st nextToken if button equals toolBar addSeparator else JButton loadToolButton button if null toolBar add return toolBar public static EnhancedButton loadToolButton String name EditAction action jEdit getAction name String label action null jEdit getProperty name action getLabel if label null label name Icon icon String iconName jEdit getProperty name if iconName null icon loadIcon else icon loadIcon iconName if icon null icon loadIcon String toolTip prettifyMenuLabel label String shortcut1 jEdit getProperty name String shortcut2 jEdit getProperty name if shortcut1 null shortcut2 null toolTip toolTip shortcut1 null shortcut1 shortcut1 null shortcut2 null shortcut2 null shortcut2 return new EnhancedButton icon toolTip action public static String prettifyMenuLabel String label int index label indexOf if index label label substring index concat label substring index return label public static void message Component comp String name Object args hideSplashScreen JOptionPane showMessageDialog comp jEdit getProperty name concat args jEdit getProperty name concat args JOptionPane INFORMATION_MESSAGE public static void error Component comp String name Object args hideSplashScreen JOptionPane showMessageDialog comp jEdit getProperty name concat args jEdit getProperty name concat args JOptionPane ERROR_MESSAGE public static String input Component comp String name Object def return input comp name null def public static String inputProperty Component comp String name String def return inputProperty comp name null def public static String input Component comp String name Object args Object def hideSplashScreen String retVal String JOptionPane showInputDialog comp jEdit getProperty name concat args jEdit getProperty name concat JOptionPane QUESTION_MESSAGE null null def return retVal public static String inputProperty Component comp String name Object args String def hideSplashScreen String retVal String JOptionPane showInputDialog comp jEdit getProperty name concat args jEdit getProperty name concat JOptionPane QUESTION_MESSAGE null null jEdit getProperty def if retVal null jEdit setProperty def retVal return retVal public static int confirm Component comp String name Object args int buttons int type hideSplashScreen return JOptionPane showConfirmDialog comp jEdit getProperty name args jEdit getProperty name buttons type public static String showVFSFileDialog View view String path int type boolean multipleSelection hideSplashScreen VFSFileChooserDialog fileChooser new VFSFileChooserDialog view path type multipleSelection String selectedFiles fileChooser getSelectedFiles if selectedFiles null return null return selectedFiles public static Color parseColor String name return parseColor name Color black public static Color parseColor String name Color defaultColor if name null return defaultColor else if name startsWith try return Color decode name catch NumberFormatException nf return defaultColor else if equals name return Color red else if equals name return Color green else if equals name return Color blue else if equals name return Color yellow else if equals name return Color orange else if equals name return Color white else if equals name return Color lightGray else if equals name return Color gray else if equals name return Color darkGray else if equals name return Color black else if equals name return Color cyan else if equals name return Color magenta else if equals name return Color pink else return defaultColor public static String getColorHexString Color String colString Integer toHexString getRGB return substring colString length concat colString public static SyntaxStyle parseStyle String str String family int size throws IllegalArgumentException return parseStyle str family size true public static SyntaxStyle parseStyle String str String family int size boolean color throws IllegalArgumentException Color fgColor Color black Color bgColor null boolean italic false boolean bold false StringTokenizer st new StringTokenizer str while st hasMoreTokens String st nextToken if startsWith if color fgColor GUIUtilities parseColor substring Color black else if startsWith if color bgColor GUIUtilities parseColor substring null else if startsWith for int length if charAt italic true else if charAt bold true else throw new IllegalArgumentException else throw new IllegalArgumentException return new SyntaxStyle fgColor bgColor new Font family italic Font ITALIC bold Font BOLD size public static String getStyleString SyntaxStyle style StringBuffer buf new StringBuffer if style getForegroundColor null buf append getColorHexString style getForegroundColor if style getBackgroundColor null buf append getColorHexString style getBackgroundColor if style getFont isPlain buf append style getFont isItalic style getFont isBold return buf toString public static SyntaxStyle loadStyles String family int size return loadStyles family size true public static SyntaxStyle loadStyles String family int size boolean color SyntaxStyle styles new SyntaxStyle Token ID_COUNT try styles Token COMMENT1 GUIUtilities parseStyle jEdit getProperty family size color styles Token COMMENT2 GUIUtilities parseStyle jEdit getProperty family size color styles Token LITERAL1 GUIUtilities parseStyle jEdit getProperty family size color styles Token LITERAL2 GUIUtilities parseStyle jEdit getProperty family size color styles Token LABEL GUIUtilities parseStyle jEdit getProperty family size color styles Token KEYWORD1 GUIUtilities parseStyle jEdit getProperty family size color styles Token KEYWORD2 GUIUtilities parseStyle jEdit getProperty family size color styles Token KEYWORD3 GUIUtilities parseStyle jEdit getProperty family size color styles Token FUNCTION GUIUtilities parseStyle jEdit getProperty family size color styles Token MARKUP GUIUtilities parseStyle jEdit getProperty family size color styles Token OPERATOR GUIUtilities parseStyle jEdit getProperty family size color styles Token DIGIT GUIUtilities parseStyle jEdit getProperty family size color styles Token INVALID GUIUtilities parseStyle jEdit getProperty family size color catch Exception Log log Log ERROR GUIUtilities class return styles public static void loadGeometry Window win String name int width height Dimension size win getSize Dimension screen win getToolkit getScreenSize width jEdit getIntegerProperty name size width height jEdit getIntegerProperty name size height Component parent win getParent if parent null screen width width screen height height else Rectangle bounds parent getBounds bounds bounds width width bounds bounds height height jEdit getIntegerProperty name jEdit getIntegerProperty name Rectangle osbounds OperatingSystem getScreenBounds if osbounds width osbounds width if width osbounds width width osbounds width osbounds width width if osbounds height osbounds height if height osbounds height height osbounds height osbounds height height Rectangle desired new Rectangle width height win setBounds desired if win instanceof Frame OperatingSystem hasJava14 int extState jEdit getIntegerProperty name Frame NORMAL try java lang reflect Method meth Frame class getMethod new Class int class meth invoke win new Object new Integer extState catch Exception Log log Log ERROR GUIUtilities class public static void saveGeometry Window win String name if win instanceof Frame OperatingSystem hasJava14 try java lang reflect Method meth Frame class getMethod new Class Integer extState Integer meth invoke win new Object jEdit setIntegerProperty name extState intValue if extState intValue Frame NORMAL return catch Exception Log log Log ERROR GUIUtilities class Rectangle bounds win getBounds jEdit setIntegerProperty name bounds jEdit setIntegerProperty name bounds jEdit setIntegerProperty name bounds width jEdit setIntegerProperty name bounds height public static void hideSplashScreen if splash null splash dispose splash null public static JComponent createMultilineLabel String str JPanel panel new JPanel new VariableGridLayout VariableGridLayout FIXED_NUM_COLUMNS int lastOffset for int index str indexOf lastOffset if index break else panel add new JLabel str substring lastOffset index lastOffset index if lastOffset str length panel add new JLabel str substring lastOffset return panel public static void requestFocus final Window win final Component comp win addWindowListener new WindowAdapter public void windowActivated WindowEvent evt comp requestFocus win removeWindowListener this public static boolean isPopupTrigger MouseEvent evt return isRightButton evt getModifiers public static boolean isMiddleButton int modifiers if OperatingSystem isMacOS if modifiers MouseEvent BUTTON1_MASK return modifiers MouseEvent META_MASK if OperatingSystem hasJava14 return modifiers MouseEvent BUTTON3_MASK else return modifiers MouseEvent BUTTON2_MASK else return modifiers MouseEvent BUTTON2_MASK public static boolean isRightButton int modifiers if OperatingSystem isMacOS if modifiers MouseEvent BUTTON1_MASK return modifiers MouseEvent CTRL_MASK if OperatingSystem hasJava14 return modifiers MouseEvent BUTTON2_MASK else return modifiers MouseEvent BUTTON3_MASK else return modifiers MouseEvent BUTTON3_MASK public static void showPopupMenu JPopupMenu popup Component comp int int showPopupMenu popup comp true public static void showPopupMenu JPopupMenu popup Component comp int int boolean point int offsetX int offsetY int extraOffset point Component win comp while win instanceof Window win null offsetX win getX offsetY win getY win win getParent if win null Dimension size popup getPreferredSize Rectangle screenSize win getGraphicsConfiguration getBounds if offsetX size width win getX screenSize width offsetX win getX size width if point size width extraOffset else win getWidth size width offsetX extraOffset else extraOffset if offsetY size height win getY screenSize height offsetY win getY size height if point win getHeight size height offsetY extraOffset else comp getY size height else extraOffset popup show comp else popup show comp extraOffset extraOffset public static boolean isAncestorOf Component comp1 Component comp2 while comp2 null if comp1 comp2 return true else comp2 comp2 getParent return false public static JDialog getParentDialog Component Component getParent while null instanceof JDialog getParent return instanceof JDialog JDialog null public static View getView Component comp for if comp instanceof JComponent Component real Component JComponent comp getClientProperty if real null comp real if comp instanceof View return View comp else if comp instanceof JPopupMenu comp JPopupMenu comp getInvoker else if comp null comp comp getParent else break return null static void showSplashScreen splash new SplashScreen static void advanceSplashProgress if splash null splash advance private static SplashScreen splash private static Hashtable icons private GUIUtilities private static void loadPluginsMenu JMenuBar mbar Vector pluginMenuItems new Vector EditPlugin pluginArray jEdit getPlugins for int pluginArray length try EditPlugin plugin pluginArray plugin createMenuItems pluginMenuItems catch Throwable Log log Log ERROR GUIUtilities class Log log Log ERROR GUIUtilities class JMenu menu new EnhancedMenu EnhancedMenu menu init if pluginMenuItems isEmpty menu add GUIUtilities loadMenuItem mbar add menu return int maxItems jEdit getIntegerProperty MiscUtilities quicksort pluginMenuItems new MiscUtilities MenuItemCompare if pluginMenuItems size maxItems for int pluginMenuItems size menu add JMenuItem pluginMenuItems get mbar add menu else int menuCount menu setText menu getText menuCount for int pluginMenuItems size menu add JMenuItem pluginMenuItems get if menu getMenuComponentCount maxItems mbar add menu menu new JMenu String valueOf menuCount if menu getMenuComponentCount mbar add menu public interface EBComponent void handleMessage EBMessage message public class KeyEventWorkaround public static KeyEvent processKeyEvent KeyEvent evt int keyCode evt getKeyCode char ch evt getKeyChar switch evt getID case KeyEvent KEY_PRESSED switch keyCode case KeyEvent VK_ALT case KeyEvent VK_ALT_GRAPH case KeyEvent VK_CONTROL case KeyEvent VK_SHIFT case KeyEvent VK_META case KeyEvent VK_DEAD_GRAVE case KeyEvent VK_DEAD_ACUTE case KeyEvent VK_DEAD_CIRCUMFLEX case KeyEvent VK_DEAD_TILDE case KeyEvent VK_DEAD_MACRON case KeyEvent VK_DEAD_BREVE case KeyEvent VK_DEAD_ABOVEDOT case KeyEvent VK_DEAD_DIAERESIS case KeyEvent VK_DEAD_ABOVERING case KeyEvent VK_DEAD_DOUBLEACUTE case KeyEvent VK_DEAD_CARON case KeyEvent VK_DEAD_CEDILLA case KeyEvent VK_DEAD_OGONEK case KeyEvent VK_DEAD_IOTA case KeyEvent VK_DEAD_VOICED_SOUND case KeyEvent VK_DEAD_SEMIVOICED_SOUND case return null default switch keyCode case KeyEvent VK_NUMPAD0 case KeyEvent VK_NUMPAD1 case KeyEvent VK_NUMPAD2 case KeyEvent VK_NUMPAD3 case KeyEvent VK_NUMPAD4 case KeyEvent VK_NUMPAD5 case KeyEvent VK_NUMPAD6 case KeyEvent VK_NUMPAD7 case KeyEvent VK_NUMPAD8 case KeyEvent VK_NUMPAD9 case KeyEvent VK_MULTIPLY case KeyEvent VK_ADD case KeyEvent VK_DECIMAL case KeyEvent VK_DIVIDE last LAST_NUMKEYPAD lastKeyTime System currentTimeMillis return evt if OperatingSystem isMacOS handleBrokenKeys evt keyCode else last LAST_NOTHING break return evt case KeyEvent KEY_TYPED if ch ch ch ch return null if OperatingSystem isMacOS if evt isControlDown evt isMetaDown return null else if evt isControlDown evt isAltDown evt isMetaDown return null if last LAST_MOD switch ch case case case case case case case last LAST_NOTHING return null if last LAST_NUMKEYPAD System currentTimeMillis lastKeyTime last LAST_NOTHING if ch ch ch ch ch ch ch return null else if last LAST_BROKEN System currentTimeMillis lastKeyTime Character isLetter ch last LAST_NOTHING return null else if last LAST_ALT System currentTimeMillis lastKeyTime last LAST_NOTHING return null return evt case KeyEvent KEY_RELEASED if keyCode KeyEvent VK_ALT if OperatingSystem isWindows OperatingSystem hasJava14 last LAST_MOD return evt default return evt public static void numericKeypadKey last LAST_NOTHING private static long lastKeyTime private static int last private static final int LAST_NOTHING private static final int LAST_ALT private static final int LAST_BROKEN private static final int LAST_NUMKEYPAD private static final int LAST_MOD private static void handleBrokenKeys KeyEvent evt int keyCode if evt isAltDown evt isControlDown evt isMetaDown last LAST_NOTHING return else if evt isAltDown evt isControlDown evt isMetaDown last LAST_NOTHING return if evt isAltDown last LAST_ALT switch keyCode case KeyEvent VK_LEFT case KeyEvent VK_RIGHT case KeyEvent VK_UP case KeyEvent VK_DOWN case KeyEvent VK_DELETE case KeyEvent VK_BACK_SPACE case KeyEvent VK_TAB case KeyEvent VK_ENTER last LAST_NOTHING break default if keyCode KeyEvent VK_A keyCode KeyEvent VK_Z last LAST_BROKEN else last LAST_NOTHING break lastKeyTime System currentTimeMillis class BSHPrimaryExpression extends SimpleNode BSHPrimaryExpression int id super id public Object eval CallStack callstack Interpreter interpreter throws EvalError Object obj jjtGetChild int jjtGetNumChildren for int obj BSHPrimarySuffix jjtGetChild doSuffix obj callstack interpreter if obj instanceof SimpleNode if obj instanceof BSHAmbiguousName obj BSHAmbiguousName obj toObject callstack interpreter else obj SimpleNode obj eval callstack interpreter return obj public class EditPane extends JPanel implements EBComponent public View getView return view public Buffer getBuffer return buffer public void setBuffer final Buffer buffer if this buffer buffer return recentBuffer this buffer if recentBuffer null saveCaretInfo this buffer buffer textArea setBuffer buffer if init view updateTitle if bufferSwitcher null if bufferSwitcher getSelectedItem buffer bufferSwitcher setSelectedItem buffer EditBus send new EditPaneUpdate this EditPaneUpdate BUFFER_CHANGED SwingUtilities invokeLater new Runnable public void run if view getEditPane EditPane this bufferSwitcher null bufferSwitcher isPopupVisible focusOnTextArea Runnable runnable new Runnable public void run loadCaretInfo buffer checkModTime EditPane this if buffer isPerformingIO VFSManager runInAWTThread runnable else runnable run public void prevBuffer Buffer buffer this buffer getPrev if buffer null setBuffer jEdit getLastBuffer else setBuffer buffer public void nextBuffer Buffer buffer this buffer getNext if buffer null setBuffer jEdit getFirstBuffer else setBuffer buffer public void recentBuffer if recentBuffer null setBuffer recentBuffer else getToolkit beep public void focusOnTextArea textArea grabFocus public JEditTextArea getTextArea return textArea public BufferSwitcher getBufferSwitcher return bufferSwitcher public void showBufferSwitcher if bufferSwitcher null getToolkit beep else bufferSwitcher requestFocus bufferSwitcher showPopup public void saveCaretInfo buffer setIntegerProperty Buffer CARET textArea getCaretPosition buffer setIntegerProperty Buffer SCROLL_VERT textArea getFirstPhysicalLine buffer setIntegerProperty Buffer SCROLL_HORIZ textArea getHorizontalOffset public void loadCaretInfo Integer caret Integer buffer getProperty Buffer CARET Integer firstLine Integer buffer getProperty Buffer SCROLL_VERT Integer horizontalOffset Integer buffer getProperty Buffer SCROLL_HORIZ if caret null textArea setCaretPosition Math min caret intValue buffer getLength if firstLine null textArea setFirstLine textArea physicalToVirtual firstLine intValue if horizontalOffset null textArea setHorizontalOffset horizontalOffset intValue view getStatus setMessage null public void handleMessage EBMessage msg if msg instanceof PropertiesChanged propertiesChanged loadBufferSwitcher else if msg instanceof BufferUpdate handleBufferUpdate BufferUpdate msg public final Dimension getMinimumSize return new Dimension EditPane View view Buffer buffer super new BorderLayout init true this view view EditBus addToBus this textArea new JEditTextArea view add BorderLayout CENTER textArea propertiesChanged if buffer null setBuffer jEdit getFirstBuffer else setBuffer buffer loadBufferSwitcher init false void close saveCaretInfo EditBus send new EditPaneUpdate this EditPaneUpdate DESTROYED EditBus removeFromBus this private boolean init private View view private Buffer buffer private Buffer recentBuffer private BufferSwitcher bufferSwitcher private JEditTextArea textArea private void propertiesChanged TextAreaPainter painter textArea getPainter painter setFont UIManager getFont painter setBracketHighlightEnabled jEdit getBooleanProperty painter setBracketHighlightColor jEdit getColorProperty painter setEOLMarkersPainted jEdit getBooleanProperty painter setEOLMarkerColor jEdit getColorProperty painter setWrapGuidePainted jEdit getBooleanProperty painter setWrapGuideColor jEdit getColorProperty painter setCaretColor jEdit getColorProperty painter setSelectionColor jEdit getColorProperty painter setBackground jEdit getColorProperty painter setForeground jEdit getColorProperty painter setBlockCaretEnabled jEdit getBooleanProperty painter setLineHighlightEnabled jEdit getBooleanProperty painter setLineHighlightColor jEdit getColorProperty painter setAntiAliasEnabled jEdit getBooleanProperty painter setFractionalFontMetricsEnabled jEdit getBooleanProperty painter setStyles GUIUtilities loadStyles jEdit getProperty jEdit getIntegerProperty painter setFoldLineStyle GUIUtilities parseStyle jEdit getProperty jEdit getProperty jEdit getIntegerProperty Gutter gutter textArea getGutter gutter setExpanded jEdit getBooleanProperty int interval jEdit getIntegerProperty gutter setHighlightInterval interval gutter setCurrentLineHighlightEnabled jEdit getBooleanProperty gutter setBracketHighlightEnabled jEdit getBooleanProperty gutter setBracketHighlightColor jEdit getColorProperty gutter setBackground jEdit getColorProperty gutter setForeground jEdit getColorProperty gutter setHighlightedForeground jEdit getColorProperty gutter setFoldColor jEdit getColorProperty gutter setMarkerHighlightColor jEdit getColorProperty gutter setMarkerHighlightEnabled jEdit getBooleanProperty gutter setCurrentLineForeground jEdit getColorProperty String alignment jEdit getProperty if equals alignment gutter setLineNumberAlignment Gutter RIGHT else if equals alignment gutter setLineNumberAlignment Gutter CENTER gutter setLineNumberAlignment Gutter LEFT gutter setFont jEdit getFontProperty int width jEdit getIntegerProperty gutter setBorder width jEdit getColorProperty jEdit getColorProperty textArea getPainter getBackground textArea setCaretBlinkEnabled jEdit getBooleanProperty textArea setElectricScroll jEdit getIntegerProperty JPopupMenu popup GUIUtilities loadPopupMenu JMenuItem customize new JMenuItem jEdit getProperty customize addActionListener new ActionListener public void actionPerformed ActionEvent evt new GlobalOptions view popup addSeparator popup add customize textArea setRightClickPopup popup textArea setQuickCopyEnabled jEdit getBooleanProperty textArea propertiesChanged private void loadBufferSwitcher if jEdit getBooleanProperty if bufferSwitcher null bufferSwitcher new BufferSwitcher this add BorderLayout NORTH bufferSwitcher bufferSwitcher updateBufferList revalidate else if bufferSwitcher null remove bufferSwitcher revalidate bufferSwitcher null private void handleBufferUpdate BufferUpdate msg Buffer msg getBuffer if msg getWhat BufferUpdate CREATED if bufferSwitcher null bufferSwitcher updateBufferList if buffer isClosed setBuffer jEdit getFirstBuffer recentBuffer null else if msg getWhat BufferUpdate CLOSED if bufferSwitcher null bufferSwitcher updateBufferList if buffer Buffer newBuffer recentBuffer null recentBuffer getPrev if newBuffer null newBuffer isClosed setBuffer newBuffer else if jEdit getBufferCount setBuffer jEdit getFirstBuffer recentBuffer null else if recentBuffer recentBuffer null else if msg getWhat BufferUpdate LOAD_STARTED if buffer textArea setCaretPosition textArea getPainter repaint else if msg getWhat BufferUpdate LOADED if buffer textArea repaint textArea updateScrollBars if bufferSwitcher null bufferSwitcher updateBufferList if view getEditPane this StatusBar status view getStatus status updateCaretStatus status updateBufferStatus status updateMiscStatus loadCaretInfo else if msg getWhat BufferUpdate DIRTY_CHANGED if buffer if bufferSwitcher null if buffer isDirty bufferSwitcher repaint else bufferSwitcher updateBufferList else if msg getWhat BufferUpdate MARKERS_CHANGED if buffer textArea getGutter repaint else if msg getWhat BufferUpdate PROPERTIES_CHANGED if buffer textArea getFoldVisibilityManager foldStructureChanged textArea propertiesChanged textArea repaint if view getEditPane this view getStatus updateBufferStatus else if msg getWhat BufferUpdate SAVED if buffer textArea propertiesChanged public class SyntaxHiliteOptionPane extends AbstractOptionPane public static final EmptyBorder noFocusBorder new EmptyBorder public SyntaxHiliteOptionPane super protected void setLayout new BorderLayout add BorderLayout CENTER createStyleTableScroller protected void styleModel save private StyleTableModel styleModel private JTable styleTable private JScrollPane createStyleTableScroller styleModel createStyleTableModel styleTable new JTable styleModel styleTable setRowSelectionAllowed false styleTable setColumnSelectionAllowed false styleTable setCellSelectionEnabled false styleTable getTableHeader setReorderingAllowed false styleTable addMouseListener new MouseHandler TableColumnModel tcm styleTable getColumnModel TableColumn styleColumn tcm getColumn styleColumn setCellRenderer new StyleTableModel StyleRenderer Dimension styleTable getPreferredSize height Math min height JScrollPane scroller new JScrollPane styleTable scroller setPreferredSize return scroller private StyleTableModel createStyleTableModel return new StyleTableModel class MouseHandler extends MouseAdapter public void mouseClicked MouseEvent evt int row styleTable rowAtPoint evt getPoint if row return SyntaxStyle style new StyleEditor SyntaxHiliteOptionPane this SyntaxStyle styleModel getValueAt row getStyle if style null styleModel setValueAt style row class StyleTableModel extends AbstractTableModel private Vector styleChoices StyleTableModel styleChoices new Vector addStyleChoice addStyleChoice addStyleChoice addStyleChoice addStyleChoice addStyleChoice addStyleChoice addStyleChoice addStyleChoice addStyleChoice addStyleChoice addStyleChoice addStyleChoice addStyleChoice MiscUtilities quicksort styleChoices new MiscUtilities StringCompare public int getColumnCount return public int getRowCount return styleChoices size public Object getValueAt int row int col StyleChoice ch StyleChoice styleChoices elementAt row switch col case return ch label case return ch style default return null public void setValueAt Object value int row int col StyleChoice ch StyleChoice styleChoices elementAt row if col ch style SyntaxStyle value fireTableRowsUpdated row row public String getColumnName int index switch index case return jEdit getProperty case return jEdit getProperty default return null public void save for int styleChoices size StyleChoice ch StyleChoice styleChoices elementAt jEdit setProperty ch property GUIUtilities getStyleString ch style private void addStyleChoice String label String property styleChoices addElement new StyleChoice jEdit getProperty label property GUIUtilities parseStyle jEdit getProperty property static class StyleChoice String label String property SyntaxStyle style StyleChoice String label String property SyntaxStyle style this label label this property property this style style public String toString return label static class StyleRenderer extends JLabel implements TableCellRenderer public StyleRenderer setOpaque true setBorder SyntaxHiliteOptionPane noFocusBorder setText public Component getTableCellRendererComponent JTable table Object value boolean isSelected boolean cellHasFocus int row int col if value null SyntaxStyle style SyntaxStyle value setForeground style getForegroundColor if style getBackgroundColor null setBackground style getBackgroundColor else setBackground jEdit getColorProperty setFont style getFont setBorder cellHasFocus UIManager getBorder SyntaxHiliteOptionPane noFocusBorder return this class StyleEditor extends EnhancedDialog implements ActionListener StyleEditor Component comp SyntaxStyle style super GUIUtilities getParentDialog comp jEdit getProperty true JPanel content new JPanel new BorderLayout content setBorder new EmptyBorder setContentPane content GridBagLayout layout new GridBagLayout JPanel panel new JPanel layout GridBagConstraints cons new GridBagConstraints cons gridx cons gridy cons gridwidth cons gridheight cons fill GridBagConstraints BOTH cons weightx italics new JCheckBox jEdit getProperty italics setSelected style getFont isItalic layout setConstraints italics cons panel add italics cons gridy bold new JCheckBox jEdit getProperty bold setSelected style getFont isBold layout setConstraints bold cons panel add bold cons gridy cons gridwidth Color fg style getForegroundColor fgColorCheckBox new JCheckBox jEdit getProperty fgColorCheckBox setSelected fg null fgColorCheckBox addActionListener this fgColorCheckBox setBorder new EmptyBorder layout setConstraints fgColorCheckBox cons panel add fgColorCheckBox cons gridx fgColor new ColorWellButton fg fgColor setEnabled fg null layout setConstraints fgColor cons panel add fgColor cons gridx cons gridy Color bg style getBackgroundColor bgColorCheckBox new JCheckBox jEdit getProperty bgColorCheckBox setSelected bg null bgColorCheckBox addActionListener this bgColorCheckBox setBorder new EmptyBorder layout setConstraints bgColorCheckBox cons panel add bgColorCheckBox cons gridx bgColor new ColorWellButton bg bgColor setEnabled bg null layout setConstraints bgColor cons panel add bgColor content add BorderLayout CENTER panel Box box new Box BoxLayout X_AXIS box add Box createGlue box add ok new JButton jEdit getProperty getRootPane setDefaultButton ok ok addActionListener this box add Box createHorizontalStrut box add cancel new JButton jEdit getProperty cancel addActionListener this box add Box createGlue content add BorderLayout SOUTH box pack setLocationRelativeTo GUIUtilities getParentDialog comp setResizable false show public void actionPerformed ActionEvent evt Object source evt getSource if source ok ok else if source cancel cancel else if source fgColorCheckBox fgColor setEnabled fgColorCheckBox isSelected else if source bgColorCheckBox bgColor setEnabled bgColorCheckBox isSelected public void ok okClicked true dispose public void cancel dispose public SyntaxStyle getStyle if okClicked return null Color foreground fgColorCheckBox isSelected fgColor getSelectedColor null Color background bgColorCheckBox isSelected bgColor getSelectedColor null return new SyntaxStyle foreground background new Font italics isSelected Font ITALIC bold isSelected Font BOLD private JCheckBox italics private JCheckBox bold private JCheckBox fgColorCheckBox private ColorWellButton fgColor private JCheckBox bgColorCheckBox private ColorWellButton bgColor private JButton ok private JButton cancel private boolean okClicked public abstract class EBMessage public EBMessage EBComponent source this source source public EBComponent getSource return source public String toString return getClass getName paramString public String paramString return source private EBComponent source public void veto public boolean isVetoed return false public static abstract class NonVetoable extends EBMessage public NonVetoable EBComponent source super source public void veto throw new InternalError public class AbbrevsOptionPane extends AbstractOptionPane public AbbrevsOptionPane super protected void setLayout new BorderLayout JPanel panel new JPanel new BorderLayout expandOnInput new JCheckBox jEdit getProperty Abbrevs getExpandOnInput panel add expandOnInput BorderLayout NORTH JPanel panel2 new JPanel panel2 setLayout new BoxLayout panel2 BoxLayout X_AXIS panel2 setBorder new EmptyBorder panel2 add Box createGlue JLabel label new JLabel jEdit getProperty label setBorder new EmptyBorder panel2 add label Hashtable Abbrevs getModeAbbrevs modeAbbrevs new Hashtable Mode modes jEdit getModes String sets new String modes length sets for int modes length String name modes getName sets name modeAbbrevs put name new AbbrevsModel Hashtable get name setsComboBox new JComboBox sets ActionHandler actionHandler new ActionHandler setsComboBox addActionListener actionHandler panel2 add setsComboBox panel2 add Box createGlue panel add panel2 BorderLayout SOUTH add BorderLayout NORTH panel globalAbbrevs new AbbrevsModel Abbrevs getGlobalAbbrevs abbrevsTable new JTable globalAbbrevs abbrevsTable getColumnModel getColumn setCellRenderer new Renderer abbrevsTable setAutoResizeMode JTable AUTO_RESIZE_ALL_COLUMNS abbrevsTable getTableHeader setReorderingAllowed false abbrevsTable getTableHeader addMouseListener new HeaderMouseHandler abbrevsTable getSelectionModel addListSelectionListener new SelectionHandler abbrevsTable addMouseListener new TableMouseHandler Dimension abbrevsTable getPreferredSize height Math min height JScrollPane scroller new JScrollPane abbrevsTable scroller setPreferredSize add BorderLayout CENTER scroller JPanel buttons new JPanel buttons setLayout new BoxLayout buttons BoxLayout X_AXIS buttons setBorder new EmptyBorder add new RolloverButton GUIUtilities loadIcon add setToolTipText jEdit getProperty add addActionListener actionHandler buttons add add remove new RolloverButton GUIUtilities loadIcon remove setToolTipText jEdit getProperty remove addActionListener actionHandler buttons add remove edit new RolloverButton GUIUtilities loadIcon edit setToolTipText jEdit getProperty edit addActionListener actionHandler buttons add edit buttons add Box createGlue add BorderLayout SOUTH buttons updateEnabled protected void if abbrevsTable getCellEditor null abbrevsTable getCellEditor stopCellEditing Abbrevs setExpandOnInput expandOnInput isSelected Abbrevs setGlobalAbbrevs globalAbbrevs toHashtable Hashtable modeHash new Hashtable Enumeration keys modeAbbrevs keys Enumeration values modeAbbrevs elements while keys hasMoreElements modeHash put keys nextElement AbbrevsModel values nextElement toHashtable Abbrevs setModeAbbrevs modeHash private JComboBox setsComboBox private JCheckBox expandOnInput private JTable abbrevsTable private AbbrevsModel globalAbbrevs private Hashtable modeAbbrevs private JButton add private JButton edit private JButton remove private void updateEnabled int selectedRow abbrevsTable getSelectedRow edit setEnabled selectedRow remove setEnabled selectedRow private void edit AbbrevsModel abbrevsModel AbbrevsModel abbrevsTable getModel int row abbrevsTable getSelectedRow String abbrev String abbrevsModel getValueAt row String expansion String abbrevsModel getValueAt row EditAbbrevDialog dialog new EditAbbrevDialog GUIUtilities getParentDialog AbbrevsOptionPane this abbrev expansion abbrev dialog getAbbrev expansion dialog getExpansion if abbrev null expansion null abbrevsModel setValueAt abbrev row abbrevsModel setValueAt expansion row class HeaderMouseHandler extends MouseAdapter public void mouseClicked MouseEvent evt switch abbrevsTable getTableHeader columnAtPoint evt getPoint case AbbrevsModel abbrevsTable getModel sort break case AbbrevsModel abbrevsTable getModel sort break class TableMouseHandler extends MouseAdapter public void mouseClicked MouseEvent evt if evt getClickCount edit class SelectionHandler implements ListSelectionListener public void valueChanged ListSelectionEvent evt updateEnabled class ActionHandler implements ActionListener public void actionPerformed ActionEvent evt AbbrevsModel abbrevsModel AbbrevsModel abbrevsTable getModel Object source evt getSource if source setsComboBox String selected String setsComboBox getSelectedItem if selected equals abbrevsTable setModel globalAbbrevs else abbrevsTable setModel AbbrevsModel modeAbbrevs get selected updateEnabled else if source add EditAbbrevDialog dialog new EditAbbrevDialog GUIUtilities getParentDialog AbbrevsOptionPane this null null String abbrev dialog getAbbrev String expansion dialog getExpansion if abbrev null abbrev length expansion null expansion length abbrevsModel add abbrev expansion int index abbrevsModel getRowCount abbrevsTable getSelectionModel setSelectionInterval index index Rectangle rect abbrevsTable getCellRect index true abbrevsTable scrollRectToVisible rect updateEnabled else if source edit edit else if source remove int selectedRow abbrevsTable getSelectedRow abbrevsModel remove selectedRow updateEnabled static class Renderer extends DefaultTableCellRenderer public Component getTableCellRendererComponent JTable table Object value boolean isSelected boolean cellHasFocus int row int col String valueStr value toString if valueStr toLowerCase startsWith valueStr valueStr return super getTableCellRendererComponent table valueStr isSelected cellHasFocus row col class AbbrevsModel extends AbstractTableModel Vector abbrevs AbbrevsModel abbrevs new Vector AbbrevsModel Hashtable abbrevHash this if abbrevHash null Enumeration abbrevEnum abbrevHash keys Enumeration expandEnum abbrevHash elements while abbrevEnum hasMoreElements abbrevs addElement new Abbrev String abbrevEnum nextElement String expandEnum nextElement sort void sort int col MiscUtilities quicksort abbrevs new AbbrevCompare col fireTableDataChanged void add String abbrev String expansion abbrevs addElement new Abbrev abbrev expansion fireTableStructureChanged void remove int index abbrevs removeElementAt index fireTableStructureChanged public Hashtable toHashtable Hashtable hash new Hashtable for int abbrevs size Abbrev abbrev Abbrev abbrevs elementAt if abbrev abbrev length abbrev expand length hash put abbrev abbrev abbrev expand return hash public int getColumnCount return public int getRowCount return abbrevs size public Object getValueAt int row int col Abbrev abbrev Abbrev abbrevs elementAt row switch col case return abbrev abbrev case return abbrev expand default return null public boolean isCellEditable int row int col return false public void setValueAt Object value int row int col if value null value Abbrev abbrev Abbrev abbrevs elementAt row if col abbrev abbrev String value else abbrev expand String value fireTableRowsUpdated row row public String getColumnName int index switch index case return jEdit getProperty case return jEdit getProperty default return null class AbbrevCompare implements MiscUtilities Compare int col AbbrevCompare int col this col col public int compare Object obj1 Object obj2 Abbrev a1 Abbrev obj1 Abbrev a2 Abbrev obj2 if col String abbrev1 a1 abbrev toLowerCase String abbrev2 a2 abbrev toLowerCase return MiscUtilities compareStrings abbrev1 abbrev2 true else String expand1 a1 expand toLowerCase String expand2 a2 expand toLowerCase return MiscUtilities compareStrings expand1 expand2 true class Abbrev Abbrev Abbrev String abbrev String expand this abbrev abbrev this expand expand String abbrev String expand public class AboutDialog extends EnhancedDialog public AboutDialog View view super view jEdit getProperty true JPanel content new JPanel new BorderLayout content setBorder new EmptyBorder setContentPane content content add BorderLayout CENTER new AboutPanel JPanel buttonPanel new JPanel buttonPanel setLayout new BoxLayout buttonPanel BoxLayout X_AXIS buttonPanel setBorder new EmptyBorder buttonPanel add Box createGlue close new JButton jEdit getProperty close addActionListener new ActionHandler getRootPane setDefaultButton close buttonPanel add close buttonPanel add Box createGlue content add BorderLayout SOUTH buttonPanel pack setResizable false setLocationRelativeTo view show public void ok dispose public void cancel dispose private JButton close class ActionHandler implements ActionListener public void actionPerformed ActionEvent evt dispose static class AboutPanel extends JComponent ImageIcon image Vector text int scrollPosition AnimationThread thread int maxWidth FontMetrics fm public static int TOP public static int BOTTOM AboutPanel setFont UIManager getFont fm getFontMetrics getFont setForeground new Color image new ImageIcon getClass getResource setBorder new MatteBorder Color gray text new Vector StringTokenizer st new StringTokenizer jEdit getProperty while st hasMoreTokens String line st nextToken text addElement line maxWidth Math max maxWidth fm stringWidth line scrollPosition thread new AnimationThread public void paintComponent Graphics setColor new Color image paintIcon this FontMetrics fm getFontMetrics String args jEdit getVersion String version jEdit getProperty args drawString version getWidth fm stringWidth version getHeight create getWidth maxWidth TOP maxWidth getHeight TOP BOTTOM int height fm getHeight int firstLine scrollPosition height int firstLineOffset height scrollPosition height int lines getHeight TOP BOTTOM height int firstLineOffset for int lines if firstLine firstLine text size String line String text get firstLine drawString line maxWidth fm stringWidth line fm getHeight public Dimension getPreferredSize return new Dimension image getIconWidth image getIconHeight public void addNotify super addNotify thread start public void removeNotify super removeNotify thread kill class AnimationThread extends Thread private boolean running true AnimationThread super setPriority Thread MIN_PRIORITY public void kill running false public void run FontMetrics fm getFontMetrics getFont int max text size fm getHeight while running scrollPosition if scrollPosition max scrollPosition try Thread sleep catch Exception repaint getWidth maxWidth TOP maxWidth getHeight TOP BOTTOM public class SegmentBuffer extends Segment public SegmentBuffer int capacity ensureCapacity capacity public void append char ch ensureCapacity count array offset count ch count public void append char text int off int len ensureCapacity count len System arraycopy text off array count len count len private void ensureCapacity int capacity if array null array new char capacity else if capacity array length char arrayN new char capacity System arraycopy array arrayN count array arrayN public class BeanShell public static void evalSelection View view JEditTextArea textArea String command textArea getSelectedText if command null view getToolkit beep return Object returnValue eval view global command if returnValue null textArea setSelectedText returnValue toString public static void showEvaluateDialog View view String command GUIUtilities input view null if command null if command endsWith command command int repeat view getInputHandler getRepeatCount if view getMacroRecorder null view getMacroRecorder record repeat command Object returnValue null try for int repeat returnValue view global command catch Throwable Log log Log ERROR BeanShell class handleException view null if returnValue null String args returnValue toString GUIUtilities message view args public static void showEvaluateLinesDialog View view String command GUIUtilities input view null JEditTextArea textArea view getTextArea Buffer buffer view getBuffer if command null command length return Selection selection textArea getSelection if selection length view getToolkit beep return if command endsWith command command if view getMacroRecorder null view getMacroRecorder record command try buffer beginCompoundEdit for int selection length Selection selection for int getStartLine getEndLine if getEnd textArea getLineStartOffset break global setVariable new Integer global setVariable new Integer getStartLine int start getStart buffer int end getEnd buffer String text buffer getText start end start global setVariable text Object returnValue view global command if returnValue null buffer remove start end start buffer insert start returnValue toString catch Throwable Log log Log ERROR BeanShell class handleException view null finally buffer endCompoundEdit textArea selectNone public static void runScript View view String path Reader in boolean ownNamespace try view path in ownNamespace catch Throwable Log log Log ERROR BeanShell class handleException view path public static void View view String path Reader in boolean ownNamespace throws Exception Log log Log MESSAGE BeanShell class path NameSpace namespace if ownNamespace namespace new NameSpace global else namespace global Interpreter interp createInterpreter namespace VFS vfs null Object session null try if in null Buffer buffer jEdit getBuffer path vfs VFSManager getVFSForPath path session vfs createVFSSession path view if session null return if buffer null if buffer isLoaded VFSManager waitForRequests in new StringReader buffer getText buffer getLength else in new BufferedReader new InputStreamReader vfs session path false view if view null interp set view EditPane editPane view getEditPane interp set editPane interp set editPane getBuffer interp set editPane getTextArea interp set path running true interp eval in namespace path catch Exception unwrapException finally running false if session null try vfs session view catch IOException io Log log Log ERROR BeanShell class io GUIUtilities error view new String path io toString try if ownNamespace if view null interp unset interp unset interp unset interp unset interp unset catch EvalError public static Object eval View view NameSpace namespace String command try return view namespace command catch Throwable Log log Log ERROR BeanShell class handleException view null return null public static Object View view NameSpace namespace String command throws Exception Interpreter interp createInterpreter namespace try if view null EditPane editPane view getEditPane interp set view interp set editPane interp set editPane getBuffer interp set editPane getTextArea return interp eval command catch Exception unwrapException return null finally try if view null interp unset interp unset interp unset interp unset catch EvalError public static BshMethod cacheBlock String id String code boolean namespace throws Exception String name id if namespace null global name code return global getMethod name new Class NameSpace class else null global name code return global getMethod name new Class public static Object runCachedBlock BshMethod method View view NameSpace namespace throws Exception boolean useNamespace if namespace null useNamespace false namespace global else useNamespace true try if view null namespace setVariable view EditPane editPane view getEditPane namespace setVariable editPane namespace setVariable editPane getBuffer namespace setVariable editPane getTextArea Object retVal method invoke useNamespace new Object namespace NO_ARGS interpForMethods new CallStack if retVal instanceof Primitive if retVal Primitive VOID return null else return Primitive retVal getValue else return retVal catch Exception unwrapException return null finally if view null try namespace setVariable null namespace setVariable null namespace setVariable null namespace setVariable null catch EvalError public static boolean isScriptRunning return running public static NameSpace getNameSpace return global public static void runScript View view String path boolean ownNamespace boolean rethrowBshErrors runScript view path null ownNamespace public static void runScript View view String path Reader in boolean ownNamespace boolean rethrowBshErrors runScript view path in ownNamespace public static Object eval View view String command boolean rethrowBshErrors return eval view global command public static Object eval View view NameSpace namespace String command boolean rethrowBshErrors return eval view namespace command static void init BshClassManager setClassLoader new JARClassLoader global new NameSpace interpForMethods createInterpreter global Log log Log DEBUG BeanShell class Interpreter VERSION private static final Object NO_ARGS new Object private static Interpreter interpForMethods private static NameSpace global private static boolean running private static void unwrapException Exception throws Exception if instanceof TargetError Throwable TargetError getTarget if instanceof Exception throw Exception else if instanceof Error throw Error if instanceof InvocationTargetException Throwable InvocationTargetException getTargetException if instanceof Exception throw Exception else if instanceof Error throw Error throw private static void handleException View view String path Throwable if instanceof IOException VFSManager error view path new String toString else new BeanShellErrorDialog view private static Interpreter createInterpreter NameSpace nameSpace return new Interpreter null System out System err false nameSpace public class EditPaneUpdate extends EBMessage public static final Object CREATED public static final Object DESTROYED public static final Object BUFFER_CHANGED public EditPaneUpdate EditPane editPane Object what super editPane if what null throw new NullPointerException this what what public Object getWhat return what public EditPane getEditPane return EditPane getSource public String paramString return what super paramString private Object what class HelpTOCPanel extends JPanel public HelpTOCPanel HelpViewer helpViewer super new BorderLayout this helpViewer helpViewer nodes new Hashtable createTOC toc new TOCTree tocModel if OperatingSystem isMacOSLF toc putClientProperty toc setCellRenderer new TOCCellRenderer toc setEditable false toc setRootVisible false toc setShowsRootHandles true for int tocRoot getChildCount DefaultMutableTreeNode node DefaultMutableTreeNode tocRoot getChildAt toc expandPath new TreePath node getPath add BorderLayout CENTER new JScrollPane toc public void selectNode String shortURL DefaultMutableTreeNode node DefaultMutableTreeNode nodes get shortURL if node null return TreePath path new TreePath tocModel getPathToRoot node toc expandPath path toc setSelectionPath path toc scrollPathToVisible path private HelpViewer helpViewer private DefaultTreeModel tocModel private DefaultMutableTreeNode tocRoot private JTree toc private Hashtable nodes private DefaultMutableTreeNode createNode String href String title DefaultMutableTreeNode node new DefaultMutableTreeNode new HelpNode href title true nodes put href node return node private void createTOC tocRoot new DefaultMutableTreeNode tocRoot add createNode jEdit getProperty tocRoot add createNode jEdit getProperty tocRoot add createNode jEdit getProperty tocRoot add createNode jEdit getProperty tocRoot add createNode jEdit getProperty tocRoot add createNode jEdit getProperty tocRoot add createNode jEdit getProperty loadTOC tocRoot loadTOC tocRoot loadTOC tocRoot DefaultMutableTreeNode pluginTree new DefaultMutableTreeNode jEdit getProperty true EditPlugin plugins jEdit getPlugins for int plugins length EditPlugin plugin plugins EditPlugin JAR jar plugin getJAR if jar null continue String name plugin getClassName String docs jEdit getProperty name String label jEdit getProperty name if docs null if label null docs null URL url jar getClassLoader getResource docs if url null pluginTree add createNode url toString label if pluginTree getChildCount tocRoot add pluginTree else pluginTree null tocModel new DefaultTreeModel tocRoot private void loadTOC DefaultMutableTreeNode root String path TOCHandler new TOCHandler root MiscUtilities getParentOfPath path XmlParser parser new XmlParser parser setHandler try parser parse null null new InputStreamReader new URL helpViewer getBaseURL path openStream catch XmlException xe int line xe getLine String message xe getMessage Log log Log ERROR this path line message catch Exception Log log Log NOTICE this static class HelpNode String href title HelpNode String href String title this href href this title title public String toString return title class TOCHandler extends HandlerBase String dir TOCHandler DefaultMutableTreeNode root String dir nodes new Stack node root this dir dir public void attribute String aname String value boolean isSpecified if aname equals href value public void charData char int off int len if tag equals StringBuffer buf new StringBuffer for int len char ch off if ch Character isWhitespace ch buf append ch title buf toString public void startElement String name tag name public void endElement String name if name null return if name equals DefaultMutableTreeNode newNode createNode dir href title node add newNode nodes push node node newNode else if name equals node DefaultMutableTreeNode nodes pop private String tag private String title private String href private DefaultMutableTreeNode node private Stack nodes class TOCTree extends JTree TOCTree TreeModel model super model ToolTipManager sharedInstance registerComponent this public final String getToolTipText MouseEvent evt TreePath path getPathForLocation evt getX evt getY if path null Rectangle cellRect getPathBounds path if cellRect null cellRectIsVisible cellRect return path getLastPathComponent toString return null protected void processMouseEvent MouseEvent evt switch evt getID case MouseEvent MOUSE_CLICKED TreePath path getPathForLocation evt getX evt getY if path null if isPathSelected path setSelectionPath path Object obj DefaultMutableTreeNode path getLastPathComponent getUserObject if obj instanceof HelpNode this expandPath path return HelpNode node HelpNode obj helpViewer gotoURL node href true super processMouseEvent evt break default super processMouseEvent evt break private int toolTipInitialDelay private int toolTipReshowDelay private boolean cellRectIsVisible Rectangle cellRect Rectangle vr TOCTree this getVisibleRect return vr contains cellRect cellRect vr contains cellRect cellRect width cellRect cellRect height class TOCCellRenderer extends DefaultTreeCellRenderer EmptyBorder border new EmptyBorder public Component getTreeCellRendererComponent JTree tree Object value boolean sel boolean expanded boolean leaf int row boolean focus super getTreeCellRendererComponent tree value sel expanded leaf row focus setIcon leaf FileCellRenderer fileIcon expanded FileCellRenderer openDirIcon FileCellRenderer dirIcon setBorder border return this public class AllBufferSet extends BufferListSet public AllBufferSet String glob this glob glob public String getFileFilter return glob public String getCode return MiscUtilities charsToEscapes glob private String glob protected String Component comp Buffer buffers jEdit getBuffers ArrayList returnValue new ArrayList buffers length RE filter try filter new RE MiscUtilities globToRE glob catch Exception Log log Log ERROR this return null for int buffers length Buffer buffer buffers if filter isMatch buffer getName returnValue add buffer getPath return String returnValue toArray new String returnValue size public class UndoManager public UndoManager Buffer buffer this buffer buffer undos new ArrayList public void setLimit int limit this limit limit public void clear undos clear undoPos undoCount public boolean undo JEditTextArea textArea if insideCompoundEdit throw new InternalError if undoPos return false else Edit edit Edit undos get undoPos int caret edit undo if caret textArea setCaretPosition caret return true public boolean redo JEditTextArea textArea if insideCompoundEdit throw new InternalError if undoPos undoCount return false else Edit edit Edit undos get undoPos int caret edit redo if caret textArea setCaretPosition caret return true public void beginCompoundEdit if compoundEditCount compoundEdit new CompoundEdit compoundEditCount public void endCompoundEdit if compoundEditCount Log log Log WARNING this new Exception return else if compoundEditCount switch compoundEdit undos size case break case addEdit Edit compoundEdit undos get break default addEdit compoundEdit compoundEdit null compoundEditCount public boolean insideCompoundEdit return compoundEditCount public void contentInserted int offset int length String text boolean clearDirty Edit toMerge getLastEdit if clearDirty toMerge instanceof Insert Insert ins Insert toMerge if ins offset offset ins str text concat ins str ins length length return else if ins offset ins length offset ins str ins str concat text ins length length return Insert ins new Insert offset length text clearDirty if clearDirty if clearDirtyEdit null clearDirtyEdit clearDirty false clearDirtyEdit ins if compoundEdit null compoundEdit undos add ins else addEdit ins public void contentRemoved int offset int length String text boolean clearDirty Edit toMerge getLastEdit if clearDirty toMerge instanceof Remove Remove rem Remove toMerge if rem offset offset rem str rem str concat text rem length length return else if offset length rem offset rem str text concat rem str rem length length rem offset offset return Remove rem new Remove offset length text clearDirty if clearDirty if clearDirtyEdit null clearDirtyEdit clearDirty false clearDirtyEdit rem if compoundEdit null compoundEdit undos add rem else addEdit rem public void bufferSaved if clearDirtyEdit null clearDirtyEdit clearDirty false clearDirtyEdit null private Buffer buffer private ArrayList undos private int limit private int undoPos private int undoCount private int compoundEditCount private CompoundEdit compoundEdit private Edit clearDirtyEdit private void addEdit Edit edit undos add undoPos edit for int undoCount undoPos undos remove if undoPos limit undos remove undoPos undoCount undoPos private Edit getLastEdit if compoundEdit null int size compoundEdit undos size if size return Edit compoundEdit undos get size else return null else if undoCount undoPos Edit Edit undos get undoPos if instanceof CompoundEdit CompoundEdit CompoundEdit return Edit undos get undos size if undoPos return Edit undos get undoPos else return null abstract class Edit abstract int undo abstract int redo boolean clearDirty class Insert extends Edit Insert int offset int length String str boolean clearDirty this offset offset this length length this str str this clearDirty clearDirty int undo buffer remove offset length if clearDirty buffer setDirty false return offset int redo buffer insert offset str return offset length int offset int length String str class Remove extends Edit Remove int offset int length String str boolean clearDirty this offset offset this length length this str str this clearDirty clearDirty int undo buffer insert offset str if clearDirty buffer setDirty false return offset length int redo buffer remove offset length return offset int offset int length String str class CompoundEdit extends Edit public int undo int retVal for int undos size retVal Edit undos get undo return retVal public int redo int retVal for int undos size retVal Edit undos get redo return retVal ArrayList undos new ArrayList class ReturnControl implements ParserConstants public int kind public Object value public ReturnControl int kind Object value this kind kind this value value public class BufferSwitcher extends JComboBox public BufferSwitcher EditPane editPane this editPane editPane setRenderer new BufferCellRenderer setMaximumRowCount jEdit getIntegerProperty addActionListener new ActionHandler public void updateBufferList if jEdit getBufferCount return updating true setMaximumRowCount jEdit getIntegerProperty setModel new DefaultComboBoxModel jEdit getBuffers setSelectedItem editPane getBuffer updating false private EditPane editPane private boolean updating class ActionHandler implements ActionListener public void actionPerformed ActionEvent evt if updating Buffer buffer Buffer getSelectedItem if buffer null editPane setBuffer buffer class BufferCellRenderer extends DefaultListCellRenderer public Component getListCellRendererComponent JList list Object value int index boolean isSelected boolean cellHasFocus super getListCellRendererComponent list value index isSelected cellHasFocus Buffer buffer Buffer value if buffer null setIcon null else setIcon buffer getIcon return this public class OffsetManager public OffsetManager Buffer buffer this buffer buffer lineInfo new long lineInfo VISIBLE_SHIFT lineContext new TokenMarker LineContext lineCount positions new PosBottomHalf virtualLineCounts new int for int virtualLineCounts gapLine public final int getLineCount return lineCount public final int getVirtualLineCount int index return virtualLineCounts index public final void setVirtualLineCount int index int lineCount virtualLineCounts index lineCount public int getLineOfOffset int offset int start int end lineCount for switch end start case if getLineEndOffset start offset return start else return start case if getLineEndOffset start offset if getLineEndOffset end offset return end else return end else return start default int pivot end start int value getLineEndOffset pivot if value offset return pivot else if value offset start pivot else end pivot break public final int getLineEndOffset int line int end int lineInfo line END_MASK if gapLine line gapLine return end gapWidth else return end public final boolean isFoldLevelValid int line if gapLine line gapLine return false return lineInfo line FOLD_LEVEL_VALID_MASK public final int getFoldLevel int line return int lineInfo line FOLD_LEVEL_MASK FOLD_LEVEL_SHIFT public final void setFoldLevel int line int level if gapLine line gapLine moveGap line lineInfo line lineInfo line FOLD_LEVEL_MASK long level FOLD_LEVEL_SHIFT FOLD_LEVEL_VALID_MASK public final boolean isLineVisible int line int index long mask index VISIBLE_SHIFT return lineInfo line mask public final void setLineVisible int line int index boolean visible long mask index VISIBLE_SHIFT if visible lineInfo line lineInfo line mask else lineInfo line lineInfo line mask public final boolean isLineContextValid int line if gapLine line gapLine return false return lineInfo line CONTEXT_VALID_MASK public final TokenMarker LineContext getLineContext int line return lineContext line public final void setLineContext int line TokenMarker LineContext context if gapLine line gapLine moveGap line lineContext line context lineInfo line CONTEXT_VALID_MASK public synchronized Position createPosition int offset PosBottomHalf bh null for int positionCount PosBottomHalf positions if offset offset bh break else if offset offset bh new PosBottomHalf offset growPositionArray System arraycopy positions positions positionCount positionCount positions bh break if bh null bh new PosBottomHalf offset growPositionArray positions positionCount bh return new PosTopHalf bh public void expandFolds int foldLevel int newVirtualLineCount if foldLevel newVirtualLineCount lineCount for int lineCount lineInfo VISIBLE_MASK else foldLevel foldLevel buffer getIndentSize boolean seenVisibleLine false for int lineCount if seenVisibleLine buffer getFoldLevel foldLevel seenVisibleLine true lineInfo VISIBLE_MASK newVirtualLineCount else lineInfo VISIBLE_MASK for int virtualLineCounts length virtualLineCounts newVirtualLineCount public void contentInserted int startLine int offset int numLines int length IntegerArray endOffsets int endLine startLine numLines if numLines moveGap lineCount numLines if lineInfo length lineCount long lineInfoN new long lineCount System arraycopy lineInfo lineInfoN lineInfo length lineInfo lineInfoN TokenMarker LineContext lineContextN new TokenMarker LineContext lineCount System arraycopy lineContext lineContextN lineContext length lineContext lineContextN System arraycopy lineInfo startLine lineInfo endLine lineCount endLine System arraycopy lineContext startLine lineContext endLine lineCount endLine int foldLevel buffer getFoldLevel startLine long visible VISIBLE_SHIFT if startLine for int startLine visible lineInfo VISIBLE_MASK break for int numLines lineInfo startLine offset endOffsets get visible if visible VISIBLE_SHIFT virtualLineCounts numLines if visible VISIBLE_SHIFT virtualLineCounts numLines if visible VISIBLE_SHIFT virtualLineCounts numLines if visible VISIBLE_SHIFT virtualLineCounts numLines if visible VISIBLE_SHIFT virtualLineCounts numLines if visible VISIBLE_SHIFT virtualLineCounts numLines if visible VISIBLE_SHIFT virtualLineCounts numLines if visible VISIBLE_SHIFT virtualLineCounts numLines moveGap endLine length updatePositionsForInsert offset length public void contentRemoved int startLine int offset int numLines int length for int numLines long info lineInfo startLine if info VISIBLE_SHIFT virtualLineCounts if info VISIBLE_SHIFT virtualLineCounts if info VISIBLE_SHIFT virtualLineCounts if info VISIBLE_SHIFT virtualLineCounts if info VISIBLE_SHIFT virtualLineCounts if info VISIBLE_SHIFT virtualLineCounts if info VISIBLE_SHIFT virtualLineCounts if info VISIBLE_SHIFT virtualLineCounts if numLines moveGap lineCount numLines System arraycopy lineInfo startLine numLines lineInfo startLine lineCount startLine System arraycopy lineContext startLine numLines lineContext startLine lineCount startLine moveGap startLine length updatePositionsForRemove offset length public void lineInfoChangedFrom int startLine moveGap startLine private static final long END_MASK private static final long FOLD_LEVEL_MASK private static final int FOLD_LEVEL_SHIFT private static final long VISIBLE_MASK private static final int VISIBLE_SHIFT private static final long FOLD_LEVEL_VALID_MASK private static final long CONTEXT_VALID_MASK private static final long SCREEN_LINES_MASK private static final long SCREEN_LINES_SHIFT private Buffer buffer private long lineInfo private TokenMarker LineContext lineContext private int lineCount private PosBottomHalf positions private int positionCount private int virtualLineCounts private int gapLine private int gapWidth private final void setLineEndOffset int line int end lineInfo line lineInfo line END_MASK FOLD_LEVEL_VALID_MASK CONTEXT_VALID_MASK end private final void moveGap int newGapLine int newGapWidth String method if gapLine gapWidth newGapWidth else if newGapLine for int gapLine lineCount setLineEndOffset getLineEndOffset gapWidth newGapWidth else if newGapLine gapLine for int newGapLine gapLine setLineEndOffset getLineEndOffset gapWidth gapWidth newGapWidth for int gapLine newGapLine setLineEndOffset getLineEndOffset gapWidth newGapWidth if newGapLine lineCount gapLine else gapLine newGapLine private void growPositionArray if positions length positionCount PosBottomHalf newPositions new PosBottomHalf positionCount System arraycopy positions newPositions positionCount positions newPositions private synchronized void removePosition PosBottomHalf bh int index for int positionCount if positions bh index break System arraycopy positions index positions index positionCount index positions positionCount null private void updatePositionsForInsert int offset int length if positionCount return int start getPositionAtOffset offset for int start positionCount PosBottomHalf bh positions if bh offset offset Log log Log ERROR this bh offset else bh offset length private void updatePositionsForRemove int offset int length if positionCount return int start getPositionAtOffset offset for int start positionCount PosBottomHalf bh positions if bh offset offset Log log Log ERROR this bh offset else if bh offset offset length bh offset offset else bh offset length private int getPositionAtOffset int offset int start int end positionCount PosBottomHalf bh loop for switch end start case bh positions start if bh offset offset start break loop case bh positions end if bh offset offset start end else bh positions start if bh offset offset start break loop default int pivot start end bh positions pivot if bh offset offset end pivot else start pivot break return start static class PosTopHalf implements Position PosBottomHalf bh PosTopHalf PosBottomHalf bh this bh bh bh ref public int getOffset return bh offset public void finalize bh unref class PosBottomHalf int offset int ref PosBottomHalf int offset this offset offset void ref ref void unref if ref removePosition this public interface TokenHandler public void handleToken byte id int offset int length TokenMarker LineContext context public class MacrosChanged extends EBMessage public MacrosChanged EBComponent source super source public class CharIndexedSegment implements CharIndexed Serializable public CharIndexedSegment Segment seg int index this seg seg m_index index public CharIndexedSegment Segment seg boolean reverse this seg seg m_index reverse seg count this reverse reverse public char charAt int index if reverse index index return m_index index seg count m_index index seg array seg offset m_index index CharIndexed OUT_OF_BOUNDS public boolean isValid return m_index m_index seg count public void reset m_index reverse seg count public boolean move int index if reverse index index return m_index index seg count private Segment seg private int m_index private boolean reverse class PluginManagerProgress extends JDialog public PluginManagerProgress JDialog dialog String type Roster roster super dialog jEdit getProperty type true this dialog dialog this roster roster this type type JPanel content new JPanel new BorderLayout content setBorder new EmptyBorder setContentPane content progress new JProgressBar progress setStringPainted true progress setString jEdit getProperty type int maximum count roster getOperationCount for int count maximum roster getOperation getMaximum progress setMaximum maximum content add BorderLayout CENTER progress stop new JButton jEdit getProperty stop addActionListener new ActionHandler JPanel panel new JPanel panel setLayout new BoxLayout panel BoxLayout X_AXIS panel add Box createGlue panel add stop panel add Box createGlue content add BorderLayout SOUTH panel addWindowListener new WindowHandler pack Dimension size getSize size width Math max size width setSize size setLocationRelativeTo dialog show public void removing String plugin String args plugin showMessage jEdit getProperty args stop setEnabled true public void downloading String plugin String args plugin showMessage jEdit getProperty args stop setEnabled true public void installing String plugin String args plugin showMessage jEdit getProperty args stop setEnabled false public void setValue final int value SwingUtilities invokeLater new Runnable public void run progress setValue valueSoFar value public void done final boolean ok this ok ok try if ok done count SwingUtilities invokeAndWait new Runnable public void run dispose if ok GUIUtilities message dialog type null else else SwingUtilities invokeAndWait new Runnable public void run valueSoFar roster getOperation done getMaximum progress setValue valueSoFar done catch Exception public boolean isOK return ok private JDialog dialog private Thread thread private String type private JProgressBar progress private JButton stop private int count private int done private int valueSoFar private boolean ok private Roster roster private void showMessage final String msg class ActionHandler implements ActionListener public void actionPerformed ActionEvent evt if evt getSource stop thread stop dispose class WindowHandler extends WindowAdapter boolean done public void windowOpened WindowEvent evt if done return done true thread new RosterThread thread start public void windowClosing WindowEvent evt thread stop dispose class RosterThread extends Thread RosterThread super public void run roster performOperations PluginManagerProgress this class LHS implements ParserConstants java io Serializable NameSpace nameSpace static final int VARIABLE FIELD PROPERTY INDEX int type String varName String propName Field field Object object int index LHS NameSpace nameSpace String varName type VARIABLE this varName varName this nameSpace nameSpace LHS Field field type FIELD this object null this field field LHS Object object Field field if object null throw new NullPointerException type FIELD this object object this field field LHS Object object String propName if object null throw new NullPointerException type PROPERTY this object object this propName propName LHS Object array int index if array null throw new NullPointerException type INDEX this object array this index index public Object getValue throws EvalError if type VARIABLE return nameSpace getVariable varName else if type FIELD try return field get object catch IllegalAccessException e2 throw new EvalError field else if type PROPERTY try return Reflect getObjectProperty object propName catch ReflectError Interpreter debug getMessage throw new EvalError propName else if type INDEX try return Reflect getIndex object index catch Exception throw new EvalError throw new InterpreterError public Object assign Object val throws EvalError if type VARIABLE nameSpace setVariable varName val else if type FIELD try if val instanceof Primitive val Primitive val getValue field set object val return val catch NullPointerException throw new EvalError field getName catch IllegalAccessException e2 throw new EvalError field getName catch IllegalArgumentException e3 throw new EvalError val null val getClass getName field getName else if type PROPERTY if object instanceof Hashtable Hashtable object put propName val else try Reflect setObjectProperty object propName val catch ReflectError Interpreter debug getMessage throw new EvalError propName else if type INDEX try Reflect setIndex object index val throw e1 catch Exception throw new EvalError getMessage return val public String toString return final class RETokenWordBoundary extends REToken private boolean negated private int where static final int BEGIN static final int END RETokenWordBoundary int subIndex int where boolean negated super subIndex this where where this negated negated boolean match CharIndexed input REMatch mymatch char ch if mymatch eflags RE REG_ANCHORINDEX RE REG_ANCHORINDEX mymatch offset mymatch index mymatch anchor if ch input charAt mymatch index CharIndexed OUT_OF_BOUNDS before Character isLetterOrDigit ch ch if ch input charAt mymatch index CharIndexed OUT_OF_BOUNDS after Character isLetterOrDigit ch ch boolean doNext false if where BEGIN BEGIN doNext after before if where END END doNext before after if negated doNext doNext return doNext next input mymatch false void dump StringBuffer os if where BEGIN END os append negated else if where BEGIN os append else os append public class AddAbbrevDialog extends JDialog public AddAbbrevDialog View view String abbrev super view jEdit getProperty true this view view JPanel content new JPanel new BorderLayout content setBorder new EmptyBorder setContentPane content editor new AbbrevEditor editor setAbbrev abbrev editor setBorder new EmptyBorder content add BorderLayout CENTER editor Box box new Box BoxLayout X_AXIS box add Box createGlue global new JButton jEdit getProperty global addActionListener new ActionHandler box add global box add Box createHorizontalStrut modeSpecific new JButton jEdit getProperty modeSpecific addActionListener new ActionHandler box add modeSpecific box add Box createHorizontalStrut cancel new JButton jEdit getProperty cancel addActionListener new ActionHandler box add cancel box add Box createGlue content add BorderLayout SOUTH box KeyListener listener new KeyHandler addKeyListener listener editor getBeforeCaretTextArea addKeyListener listener editor getAfterCaretTextArea addKeyListener listener setDefaultCloseOperation DISPOSE_ON_CLOSE if abbrev null GUIUtilities requestFocus this editor getAbbrevField else GUIUtilities requestFocus this editor getBeforeCaretTextArea pack setLocationRelativeTo view show private View view private AbbrevEditor editor private JButton global private JButton modeSpecific private JButton cancel class ActionHandler implements ActionListener public void actionPerformed ActionEvent evt Object source evt getSource if source global String editor getAbbrev if null length getToolkit beep return Abbrevs addGlobalAbbrev editor getExpansion Abbrevs expandAbbrev view false else if source modeSpecific String editor getAbbrev if null length getToolkit beep return Abbrevs addModeAbbrev view getBuffer getMode getName editor getExpansion Abbrevs expandAbbrev view false dispose class KeyHandler extends KeyAdapter public void keyPressed KeyEvent evt if evt getKeyCode KeyEvent VK_ESCAPE dispose class BSHFormalParameter extends SimpleNode public static final Class UNTYPED null public String name public Class type BSHFormalParameter int id super id public Object eval NameSpace namespace throws EvalError if jjtGetNumChildren type BSHType jjtGetChild getType namespace else type UNTYPED return Primitive VOID class BSHWhileStatement extends SimpleNode implements ParserConstants public boolean isDoStatement BSHWhileStatement int id super id public Object eval CallStack callstack Interpreter interpreter throws EvalError int numChild jjtGetNumChildren SimpleNode condExp body null if isDoStatement condExp SimpleNode jjtGetChild body SimpleNode jjtGetChild else condExp SimpleNode jjtGetChild body SimpleNode jjtGetChild boolean doOnceFlag isDoStatement while doOnceFlag BSHIfStatement evaluateCondition condExp callstack interpreter continue Object ret body eval callstack interpreter boolean breakout false if ret instanceof ReturnControl switch ReturnControl ret kind case RETURN return ret case CONTINUE continue case BREAK breakout true break if breakout break doOnceFlag false return Primitive VOID public class Handler extends URLStreamHandler public URLConnection openConnection URL url throws IOException PluginResURLConnection new PluginResURLConnection url connect return public interface CharIndexed char OUT_OF_BOUNDS char charAt int index boolean move int index boolean isValid public abstract class FoldHandler public String getName return name public abstract int getFoldLevel Buffer buffer int lineIndex Segment seg public boolean equals Object if null return false else return getClass getClass public static void registerFoldHandler FoldHandler handler if getFoldHandler handler getName null Log log Log ERROR FoldHandler class return foldHandlers add handler public static void unregisterFoldHandler FoldHandler handler foldHandlers remove handler public static FoldHandler getFoldHandlers FoldHandler handlers new FoldHandler foldHandlers size return FoldHandler foldHandlers toArray handlers public static FoldHandler getFoldHandler String name FoldHandler handler Iterator foldHandlers iterator while hasNext handler FoldHandler next if name equals handler getName return handler return null public static String getFoldModes FoldHandler handlers getFoldHandlers String foldModes new String handlers length for int foldModes length foldModes handlers getName return foldModes protected FoldHandler String name this name name private String name private static ArrayList foldHandlers static foldHandlers new ArrayList registerFoldHandler new DummyFoldHandler registerFoldHandler new IndentFoldHandler registerFoldHandler new ExplicitFoldHandler public class HistoryModel public HistoryModel String name this name name max jEdit getIntegerProperty data new Vector max public void addItem String text if text null text length return int index data indexOf text if index data removeElementAt index data insertElementAt text while getSize max data removeElementAt data size public String getItem int index return String data elementAt index public int getSize return data size public String getName return name public static HistoryModel getModel String name if models null models new Hashtable HistoryModel model HistoryModel models get name if model null model new HistoryModel name models put name model return model public static void loadHistory File file if models null models new Hashtable try BufferedReader in new BufferedReader new FileReader file HistoryModel currentModel null String line while line in readLine null if line startsWith line endsWith if currentModel null models put currentModel getName currentModel currentModel new HistoryModel line substring line length else if currentModel null throw new IOException else currentModel data addElement MiscUtilities escapesToChars line if currentModel null models put currentModel getName currentModel in close catch FileNotFoundException fnf Log log Log DEBUG HistoryModel class fnf catch IOException io Log log Log ERROR HistoryModel class io public static void saveHistory File file String lineSep System getProperty try BufferedWriter out new BufferedWriter new FileWriter file if models null out close return Enumeration modelEnum models elements while modelEnum hasMoreElements HistoryModel model HistoryModel modelEnum nextElement out write out write model getName out write out write lineSep for int model getSize out write MiscUtilities charsToEscapes model getItem TO_ESCAPE out write lineSep out close catch IOException io Log log Log ERROR HistoryModel class io private static final String TO_ESCAPE private String name private int max private Vector data private static Hashtable models final class RETokenRepeated extends REToken private REToken token private int min max private boolean stingy RETokenRepeated int subIndex REToken token int min int max super subIndex this token token this min min this max max void makeStingy stingy true boolean isStingy return stingy int getMinimumLength return min token getMinimumLength boolean match CharIndexed input REMatch mymatch int numRepeats REMatch newMatch mymatch REMatch last null REMatch current Vector positions new Vector positions addElement newMatch REMatch doables REMatch doablesLast REMatch recurrent do if stingy numRepeats min REMatch result matchRest input newMatch if result null mymatch assignFrom result return true doables null doablesLast null for current newMatch current null current current next recurrent REMatch current clone if token match input recurrent if doables null doables recurrent doablesLast recurrent else doablesLast next recurrent while doablesLast next null doablesLast doablesLast next if doables null break newMatch doables numRepeats positions addElement newMatch while numRepeats max if numRepeats min return false int posIndex positions size REMatch allResults null REMatch allResultsLast null REMatch results null while posIndex min newMatch REMatch positions elementAt posIndex results matchRest input newMatch if results null if allResults null allResults results allResultsLast results else allResultsLast next results while allResultsLast next null allResultsLast allResultsLast next if allResults null return true return false private REMatch matchRest CharIndexed input final REMatch newMatch REMatch current single REMatch doneIndex null REMatch doneIndexLast null for current newMatch current null current current next single REMatch current clone if next input single if doneIndex null doneIndex single doneIndexLast single else doneIndexLast next single while doneIndexLast next null doneIndexLast doneIndexLast next return doneIndex void dump StringBuffer os os append token dumpAll os os append if max Integer MAX_VALUE min os append min else if min max os append else os append append min if max min os append if max Integer MAX_VALUE os append max os append if stingy os append public class REMatchEnumeration implements Enumeration Serializable private static final int YES private static final int MAYBE private static final int NO private int more private REMatch match private RE expr private CharIndexed input private int eflags private int index REMatchEnumeration RE expr CharIndexed input int index int eflags more MAYBE this expr expr this input input this index index this eflags eflags public boolean hasMoreElements return hasMoreMatches null public boolean hasMoreMatches return hasMoreMatches null public boolean hasMoreMatches StringBuffer buffer if more MAYBE match expr getMatchImpl input index eflags buffer if match null input move match end match end index match end match end match offset index more YES else more NO return more YES public Object nextElement throws NoSuchElementException return nextMatch public REMatch nextMatch throws NoSuchElementException if hasMoreElements more input isValid MAYBE NO return match throw new NoSuchElementException class BSHType extends SimpleNode implements BshClassManager Listener private Class baseType private int arrayDims private Class type BSHType int id super id BshClassManager addCMListener this public void addArrayDimension arrayDims public Class getType NameSpace namespace throws EvalError if type null return type SimpleNode node SimpleNode jjtGetChild if node instanceof BSHPrimitiveType baseType BSHPrimitiveType node getType else baseType BSHAmbiguousName node toClass namespace if arrayDims try Object obj Array newInstance baseType dims type obj getClass catch Exception throw new EvalError this else type baseType return type public Class getBaseType return baseType public int getArrayDims return arrayDims public void classLoaderChanged type null baseType null final class RETokenOneOf extends REToken private Vector options private boolean negative RETokenOneOf int subIndex String optionsStr boolean negative boolean insens super subIndex options new Vector this negative negative for int optionsStr length options addElement new RETokenChar subIndex optionsStr charAt insens RETokenOneOf int subIndex Vector options boolean negative super subIndex this options options this negative negative int getMinimumLength int min Integer MAX_VALUE int for int options size if REToken options elementAt getMinimumLength min min return min boolean match CharIndexed input REMatch mymatch if negative input charAt mymatch index CharIndexed OUT_OF_BOUNDS return false REMatch newMatch null REMatch last null REToken tk boolean isMatch for int options size tk REToken options elementAt REMatch tryMatch REMatch mymatch clone if negative return false if next input tryMatch if last null newMatch tryMatch last tryMatch else last next tryMatch last tryMatch if newMatch null if negative return false else mymatch assignFrom newMatch return true else if negative mymatch index return next input mymatch else return false void dump StringBuffer os os append negative for int options size if negative os append REToken options elementAt dumpAll os os append negative class BSHArrayDimensions extends SimpleNode public Class baseType private int arrayDims public int dimensions BSHArrayDimensions int id super id public void addArrayDimension arrayDims public Object eval Class type CallStack callstack Interpreter interpreter throws EvalError if Interpreter DEBUG Interpreter debug type baseType type return eval callstack interpreter public Object eval CallStack callstack Interpreter interpreter throws EvalError SimpleNode child SimpleNode jjtGetChild if child instanceof BSHArrayInitializer if baseType null throw new EvalError this Object initValue BSHArrayInitializer child eval baseType arrayDims callstack interpreter Class arrayClass initValue getClass dimensions new int Reflect getArrayDimensions arrayClass if dimensions length arrayDims throw new EvalError arrayDims dimensions length this Object arraySlice initValue for int dimensions length dimensions Array getLength arraySlice if dimensions arraySlice Array get arraySlice return initValue else dimensions new int jjtGetNumChildren for int dimensions length try Object length SimpleNode jjtGetChild eval callstack interpreter dimensions Primitive length intValue catch Exception throw new EvalError this return Primitive VOID class CharIndexedString implements CharIndexed Serializable private String private int anchor private int len CharIndexedString String str int index str len length anchor index public char charAt int index int pos anchor index return pos len pos charAt pos OUT_OF_BOUNDS public boolean isValid return anchor len public boolean move int index return anchor index len public class TextUtilities public static Token getTokenAtOffset Token tokens int offset if offset tokens id Token END return tokens for if tokens id Token END throw new ArrayIndexOutOfBoundsException if tokens offset tokens length offset return tokens else tokens tokens next public static int findMatchingBracket Buffer buffer int line int offset if offset offset buffer getLineLength line throw new ArrayIndexOutOfBoundsException offset buffer getLineLength line Segment lineText new Segment buffer getLineText line lineText char lineText array lineText offset offset switch case cprime direction true break case cprime direction false break case cprime direction true break case cprime direction false break case cprime direction true break case cprime direction false break default return int count DefaultTokenHandler tokenHandler new DefaultTokenHandler buffer markTokens line tokenHandler byte idOfBracket getTokenAtOffset tokenHandler getTokens offset id boolean haveTokens true if direction offset for for int offset lineText count char ch lineText array lineText offset if ch if haveTokens tokenHandler init buffer markTokens line tokenHandler haveTokens true if getTokenAtOffset tokenHandler getTokens id idOfBracket count else if ch cprime if haveTokens tokenHandler init buffer markTokens line tokenHandler haveTokens true if getTokenAtOffset tokenHandler getTokens id idOfBracket count if count return buffer getLineStartOffset line line if line buffer getLineCount break buffer getLineText line lineText offset haveTokens false else offset for for int offset char ch lineText array lineText offset if ch if haveTokens tokenHandler init buffer markTokens line tokenHandler haveTokens true if getTokenAtOffset tokenHandler getTokens id idOfBracket count else if ch cprime if haveTokens tokenHandler init buffer markTokens line tokenHandler haveTokens true if getTokenAtOffset tokenHandler getTokens id idOfBracket count if count return buffer getLineStartOffset line line if line break buffer getLineText line lineText offset lineText count haveTokens false return public static int findMatchingBracketFuzzy Buffer buffer int line int offset int result findMatchingBracket buffer line offset if result offset buffer getLineLength line return findMatchingBracket buffer line offset else return result public static int findWordStart String line int pos String noWordSep return findWordStart line pos noWordSep true public static int findWordStart String line int pos String noWordSep boolean joinNonWordChars char ch line charAt pos if noWordSep null noWordSep int type if Character isWhitespace ch type WHITESPACE else if Character isLetterOrDigit ch noWordSep indexOf ch type WORD_CHAR else type SYMBOL int whiteSpaceEnd loop for int pos ch line charAt switch type case WHITESPACE if Character isWhitespace ch break else case WORD_CHAR if Character isLetterOrDigit ch noWordSep indexOf ch break else case SYMBOL if joinNonWordChars pos return if Character isWhitespace ch return else if Character isLetterOrDigit ch noWordSep indexOf ch return else break return whiteSpaceEnd public static int findWordEnd String line int pos String noWordSep return findWordEnd line pos noWordSep true public static int findWordEnd String line int pos String noWordSep boolean joinNonWordChars if pos pos char ch line charAt pos if noWordSep null noWordSep int type if Character isWhitespace ch type WHITESPACE else if Character isLetterOrDigit ch noWordSep indexOf ch type WORD_CHAR else type SYMBOL loop for int pos line length ch line charAt switch type case WHITESPACE if Character isWhitespace ch break else case WORD_CHAR if Character isLetterOrDigit ch noWordSep indexOf ch break else case SYMBOL if joinNonWordChars pos return if Character isWhitespace ch return else if Character isLetterOrDigit ch noWordSep indexOf ch return else break return line length public static boolean regionMatches boolean ignoreCase Segment text int offset char match int length offset match length if length text offset text count return false char textArray text array for int offset length char c1 textArray char c2 match if ignoreCase c1 Character toUpperCase c1 c2 Character toUpperCase c2 if c1 c2 return false return true public static String spacesToTabs String in int tabSize StringBuffer buf new StringBuffer int width int whitespace for int in length switch in charAt case whitespace width break case int tab tabSize width tabSize width tab whitespace tab break case if whitespace buf append MiscUtilities createWhiteSpace whitespace tabSize whitespace width buf append break default if whitespace buf append MiscUtilities createWhiteSpace whitespace tabSize whitespace buf append in charAt width break if whitespace buf append MiscUtilities createWhiteSpace whitespace tabSize return buf toString public static String tabsToSpaces String in int tabSize StringBuffer buf new StringBuffer int width for int in length switch in charAt case int count tabSize width tabSize width count while count buf append break case width buf append in charAt break default width buf append in charAt break return buf toString public static String format String text int maxLineLength int tabSize StringBuffer buf new StringBuffer int index for int newIndex text indexOf index if newIndex break formatParagraph text substring index newIndex maxLineLength tabSize buf buf append index newIndex if index text length formatParagraph text substring index maxLineLength tabSize buf return buf toString public static final int MIXED public static final int LOWER_CASE public static final int UPPER_CASE public static final int TITLE_CASE public static int getStringCase String str if str length return MIXED int state char ch str charAt if Character isLetter ch if Character isUpperCase ch state UPPER_CASE else state LOWER_CASE for int str length ch str charAt if Character isLetter ch continue switch state case UPPER_CASE if Character isLowerCase ch if state TITLE_CASE else return MIXED break case LOWER_CASE case TITLE_CASE if Character isUpperCase ch return MIXED break return state public static String toTitleCase String str if str length return str else return Character toUpperCase str charAt str substring toLowerCase private static final int WHITESPACE private static final int WORD_CHAR private static final int SYMBOL private static void formatParagraph String text int maxLineLength int tabSize StringBuffer buf int leadingWhitespaceCount MiscUtilities getLeadingWhiteSpace text String leadingWhitespace text substring leadingWhitespaceCount int leadingWhitespaceWidth MiscUtilities getLeadingWhiteSpaceWidth text tabSize buf append leadingWhitespace int lineLength leadingWhitespaceWidth StringTokenizer st new StringTokenizer text while st hasMoreTokens String word st nextToken if lineLength leadingWhitespaceWidth else if lineLength word length maxLineLength buf append buf append leadingWhitespace lineLength leadingWhitespaceWidth else buf append lineLength buf append word lineLength word length public abstract class EditPlugin public void start public String getClassName return getClass getName public EditPlugin JAR getJAR return jar public static class Broken extends EditPlugin public String getClassName return clazz Broken String clazz this clazz clazz private String clazz public static class JAR public String getPath return path public ZipFile getZipFile return classLoader getZipFile public JARClassLoader getClassLoader return classLoader public ActionSet getActions return actions public void addPlugin EditPlugin plugin plugin jar JAR this long start System currentTimeMillis try plugin start finally Log log Log DEBUG this System currentTimeMillis start if plugin instanceof EBPlugin EditBus addToBus EBPlugin plugin plugins addElement plugin public EditPlugin getPlugins EditPlugin array new EditPlugin plugins size plugins copyInto array return array public JAR String path JARClassLoader classLoader this path path this classLoader classLoader plugins new Vector actions new ActionSet void getPlugins Vector vector for int plugins size vector addElement plugins elementAt private String path private JARClassLoader classLoader private Vector plugins private ActionSet actions private EditPlugin JAR jar class BSHLHSPrimarySuffix extends SimpleNode public static final int INDEX NAME PROPERTY public String field public String method BSHLHSPrimarySuffix int id super id public LHS doLHSSuffix Object obj CallStack callstack Interpreter interpreter throws EvalError try switch operation case INDEX return doIndex obj callstack interpreter case NAME return doName obj callstack interpreter case PROPERTY return doProperty obj callstack interpreter default throw new InterpreterError catch ReflectError throw new EvalError this catch InvocationTargetException throw new TargetError getTargetException this true private LHS doName Object obj CallStack callstack Interpreter interpreter throws EvalError ReflectError InvocationTargetException if jjtGetNumChildren return Reflect getLHSObjectField obj field else Object oa BSHArguments jjtGetChild getArguments callstack interpreter try obj Reflect invokeObjectMethod interpreter obj method oa this catch EvalError ee throw new EvalError ee getMessage this return Reflect getLHSObjectField obj field private LHS doIndex Object obj CallStack callstack Interpreter interpreter throws EvalError ReflectError int index BSHPrimarySuffix getIndexAux obj callstack interpreter this return new LHS obj index private LHS doProperty Object obj CallStack callstack Interpreter interpreter throws EvalError ReflectError if obj Primitive VOID throw new EvalError this else if obj instanceof Primitive throw new EvalError this Object value SimpleNode jjtGetChild eval callstack interpreter if value instanceof String throw new EvalError this if Interpreter DEBUG Interpreter debug return new LHS obj String value public class DockingOptionPane extends AbstractOptionPane public DockingOptionPane super public void addSeparator layoutIcon1 GUIUtilities loadIcon layoutIcon2 GUIUtilities loadIcon layoutIcon3 GUIUtilities loadIcon layoutIcon4 GUIUtilities loadIcon JPanel layoutPanel new JPanel new VariableGridLayout VariableGridLayout FIXED_NUM_COLUMNS if jEdit getBooleanProperty layout new JLabel jEdit getBooleanProperty layoutIcon4 layoutIcon2 else layout new JLabel jEdit getBooleanProperty layoutIcon3 layoutIcon1 layoutPanel add layout layoutPanel add alternateDockingLayout new JButton jEdit getProperty alternateDockingLayout addActionListener new ActionHandler layoutPanel add alternateToolBarLayout new JButton jEdit getProperty alternateToolBarLayout addActionListener new ActionHandler GridBagConstraints cons new GridBagConstraints cons gridy cons gridwidth GridBagConstraints REMAINDER cons fill GridBagConstraints BOTH cons weightx gridBag setConstraints layoutPanel cons add layoutPanel addSeparator cons new GridBagConstraints cons gridy cons gridwidth cons gridheight GridBagConstraints REMAINDER cons fill GridBagConstraints BOTH cons weightx cons weighty JScrollPane windowScroller createWindowTableScroller gridBag setConstraints windowScroller cons add windowScroller public void jEdit setBooleanProperty layout getIcon layoutIcon2 layout getIcon layoutIcon4 jEdit setBooleanProperty layout getIcon layoutIcon3 layout getIcon layoutIcon4 windowModel save private JLabel layout private Icon layoutIcon1 layoutIcon2 layoutIcon3 layoutIcon4 private JButton alternateDockingLayout alternateToolBarLayout private JTable windowTable private WindowTableModel windowModel private JScrollPane createWindowTableScroller windowModel createWindowModel windowTable new JTable windowModel windowTable getTableHeader setReorderingAllowed false windowTable setColumnSelectionAllowed false windowTable setRowSelectionAllowed false windowTable setCellSelectionEnabled false DockPositionCellRenderer comboBox new DockPositionCellRenderer windowTable setRowHeight comboBox getPreferredSize height TableColumn column windowTable getColumnModel getColumn column setCellRenderer comboBox column setCellEditor new DefaultCellEditor new DockPositionCellRenderer Dimension windowTable getPreferredSize height Math min height JScrollPane scroller new JScrollPane windowTable scroller setPreferredSize return scroller private WindowTableModel createWindowModel return new WindowTableModel class ActionHandler implements ActionListener public void actionPerformed ActionEvent evt if evt getSource alternateDockingLayout if layout getIcon layoutIcon1 layout setIcon layoutIcon2 else if layout getIcon layoutIcon2 layout setIcon layoutIcon1 else if layout getIcon layoutIcon3 layout setIcon layoutIcon4 else if layout getIcon layoutIcon4 layout setIcon layoutIcon3 else if evt getSource alternateToolBarLayout if layout getIcon layoutIcon1 layout setIcon layoutIcon3 else if layout getIcon layoutIcon3 layout setIcon layoutIcon1 else if layout getIcon layoutIcon2 layout setIcon layoutIcon4 else if layout getIcon layoutIcon4 layout setIcon layoutIcon2 class DockPositionCellRenderer extends JComboBox implements TableCellRenderer DockPositionCellRenderer super new String DockableWindowManager FLOATING DockableWindowManager TOP DockableWindowManager LEFT DockableWindowManager BOTTOM DockableWindowManager RIGHT DockPositionCellRenderer this setRequestFocusEnabled false public Component getTableCellRendererComponent JTable table Object value boolean isSelected boolean hasFocus int row int column setSelectedItem value return this class WindowTableModel extends AbstractTableModel private Vector windows WindowTableModel windows new Vector String dockables DockableWindowManager getRegisteredDockableWindows for int dockables length windows addElement new Entry dockables sort public void sort MiscUtilities quicksort windows new WindowCompare fireTableDataChanged public int getColumnCount return public int getRowCount return windows size public Class getColumnClass int col switch col case case return String class default throw new InternalError public Object getValueAt int row int col Entry window Entry windows elementAt row switch col case return window title case return window dockPosition default throw new InternalError public boolean isCellEditable int row int col return col public void setValueAt Object value int row int col if col return Entry window Entry windows elementAt row switch col case window dockPosition String value break default throw new InternalError fireTableRowsUpdated row row public String getColumnName int index switch index case return jEdit getProperty case return jEdit getProperty default throw new InternalError public void save for int windows size Entry windows elementAt save class Entry String name String title String dockPosition Entry String name this name name title jEdit getProperty name if title null title name dockPosition jEdit getProperty name if dockPosition null dockPosition DockableWindowManager FLOATING void save jEdit setProperty name dockPosition class WindowCompare implements MiscUtilities Compare public int compare Object obj1 Object obj2 Entry e1 Entry obj1 Entry e2 Entry obj2 return MiscUtilities compareStrings e1 title e2 title true public class KeywordMap public KeywordMap boolean ignoreCase this ignoreCase this ignoreCase ignoreCase noWordSep new StringBuffer public KeywordMap boolean ignoreCase int mapLength this mapLength mapLength this ignoreCase ignoreCase map new Keyword mapLength public byte lookup Segment text int offset int length if length return Token NULL Keyword map getSegmentMapKey text offset length while null if length keyword length next continue if TextUtilities regionMatches ignoreCase text offset keyword return id next return Token NULL public void add String keyword byte id int key getStringMapKey keyword char chars keyword toCharArray loop for int chars length char ch chars if Character isLetterOrDigit ch for int noWordSep length if noWordSep charAt ch continue loop noWordSep append ch noWordSepStr null map key new Keyword chars id map key public String getNonAlphaNumericChars return noWordSep toString public String getKeywords Vector vector new Vector for int map length Keyword keyword map while keyword null vector addElement new String keyword keyword keyword keyword next String retVal new String vector size vector copyInto retVal return retVal public boolean getIgnoreCase return ignoreCase public void setIgnoreCase boolean ignoreCase this ignoreCase ignoreCase private int mapLength private Keyword map private boolean ignoreCase private StringBuffer noWordSep private String noWordSepStr private int getStringMapKey String return Character toUpperCase charAt Character toUpperCase charAt length mapLength protected int getSegmentMapKey Segment int off int len return Character toUpperCase array off Character toUpperCase array off len mapLength class Keyword public Keyword char keyword byte id Keyword next this keyword keyword this id id this next next public char keyword public byte id public Keyword next public class JARClassLoader extends ClassLoader public JARClassLoader public static long scanTime public static long startTime public JARClassLoader String path throws IOException long time System currentTimeMillis this path path zipFile new JarFile path definePackages jar new EditPlugin JAR path this Enumeration entires zipFile entries while entires hasMoreElements ZipEntry entry ZipEntry entires nextElement String name entry getName String lname name toLowerCase if lname equals pluginResources add entry if lname equals pluginResources add entry else if lname endsWith jEdit loadProps zipFile getInputStream entry true else if name endsWith classHash put MiscUtilities fileToClass name this if name endsWith pluginClasses add name jEdit addPluginJAR jar scanTime System currentTimeMillis time public Class loadClass String clazz boolean resolveIt throws ClassNotFoundException Object obj classHash get clazz if obj NO_CLASS throw new ClassNotFoundException clazz else if obj instanceof ClassLoader JARClassLoader classLoader JARClassLoader obj return classLoader clazz resolveIt try Class cls ClassLoader parentLoader getClass getClassLoader if parentLoader null cls parentLoader loadClass clazz else cls findSystemClass clazz return cls catch ClassNotFoundException cnf classHash put clazz NO_CLASS throw cnf public InputStream getResourceAsStream String name if zipFile null return null try ZipEntry entry zipFile getEntry name if entry null return getSystemResourceAsStream name else return zipFile getInputStream entry catch IOException io Log log Log ERROR this io return null public URL getResource String name if zipFile null return null ZipEntry entry zipFile getEntry name if entry null return getSystemResource name try return new URL getResourceAsPath name catch MalformedURLException mu Log log Log ERROR this mu return null public String getResourceAsPath String name if zipFile null return null if name startsWith name name return MiscUtilities getFileName jar getPath name public void closeZipFile if zipFile null return try zipFile close catch IOException io Log log Log ERROR this io zipFile null public ZipFile getZipFile return zipFile void startAllPlugins long time System currentTimeMillis boolean ok true for int pluginClasses size String name String pluginClasses get name MiscUtilities fileToClass name try ok loadPluginClass name catch Throwable ok false Log log Log ERROR this name Log log Log ERROR this jar addPlugin new EditPlugin Broken name String args toString jEdit pluginError jar getPath args startTime System currentTimeMillis time time System currentTimeMillis if ok return try for int pluginResources size ZipEntry entry ZipEntry pluginResources get String name entry getName if name equalsIgnoreCase jEdit loadActions path new BufferedReader new InputStreamReader zipFile getInputStream entry jar getActions else if name equalsIgnoreCase DockableWindowManager loadDockableWindows path new BufferedReader new InputStreamReader zipFile getInputStream entry jar getActions catch IOException io Log log Log ERROR jEdit class MiscUtilities getFileName path Log log Log ERROR jEdit class io String args io toString jEdit pluginError path args scanTime System currentTimeMillis time private static final Object NO_CLASS new Object private static Hashtable classHash new Hashtable private String path private EditPlugin JAR jar private ArrayList pluginResources new ArrayList private ArrayList pluginClasses new ArrayList private JarFile zipFile private boolean loadPluginClass String name throws Exception EditPlugin plugins jEdit getPlugins for int plugins length if plugins getClass getName equals name jEdit pluginError jar getPath null return false if name equals OperatingSystem hasJava14 jar addPlugin new EditPlugin Broken name jEdit pluginError jar getPath null return false if checkDependencies name jar addPlugin new EditPlugin Broken name return false Class clazz loadClass name true int modifiers clazz getModifiers if Modifier isInterface modifiers Modifier isAbstract modifiers EditPlugin class isAssignableFrom clazz String label jEdit getProperty name String version jEdit getProperty name if version null Log log Log ERROR this name jar addPlugin new EditPlugin Broken name return false jar getActions setLabel jEdit getProperty new String label Log log Log NOTICE this label version jar addPlugin EditPlugin clazz newInstance return true else return true private boolean checkDependencies String name int boolean ok true String dep while dep jEdit getProperty name null int index dep indexOf if index Log log Log ERROR this name dep return false String what dep substring index String arg dep substring index if what equals if MiscUtilities compareStrings System getProperty arg false String args arg System getProperty jEdit pluginError jar getPath args ok false else if what equals if arg length Log log Log ERROR this arg ok false if MiscUtilities compareStrings jEdit getBuild arg false String needs MiscUtilities buildToVersion arg String args needs jEdit getVersion jEdit pluginError jar getPath args ok false else if what equals int index2 arg indexOf if index2 Log log Log ERROR this name dep return false String plugin arg substring index2 String needVersion arg substring index2 String currVersion jEdit getProperty plugin if currVersion null String args needVersion plugin jEdit pluginError jar getPath args ok false else if MiscUtilities compareStrings currVersion needVersion false String args needVersion plugin currVersion jEdit pluginError jar getPath args ok false else if jEdit getPlugin plugin instanceof EditPlugin Broken String args plugin jEdit pluginError jar getPath args ok false else if what equals try loadClass arg false catch Exception String args arg jEdit pluginError jar getPath args ok false else Log log Log ERROR this name dep return false return ok private Class String clazz boolean resolveIt throws ClassNotFoundException Class cls findLoadedClass clazz if cls null if resolveIt resolveClass cls return cls String name MiscUtilities classToFile clazz try ZipEntry entry zipFile getEntry name if entry null throw new ClassNotFoundException clazz InputStream in zipFile getInputStream entry int len int entry getSize byte data new byte len int success int offset while success len len success offset success success in read data offset len if success Log log Log ERROR this clazz zipFile getName throw new ClassNotFoundException clazz cls defineClass clazz data data length if resolveIt resolveClass cls return cls catch IOException io Log log Log ERROR this io throw new ClassNotFoundException clazz private void definePackages try Manifest manifest zipFile getManifest if manifest null Map entries manifest getEntries Iterator entries keySet iterator while hasNext String path String next if path endsWith String name path replace if name endsWith name name substring name length definePackage path name manifest null catch Exception ex Log log Log ERROR this zipFile Log log Log ERROR this ex private Package definePackage String path String name Manifest man URL url throws IllegalArgumentException String specTitle null String specVersion null String specVendor null String implTitle null String implVersion null String implVendor null String sealed null URL sealBase null Attributes attr man getAttributes path if attr null specTitle attr getValue Attributes Name SPECIFICATION_TITLE specVersion attr getValue Attributes Name SPECIFICATION_VERSION specVendor attr getValue Attributes Name SPECIFICATION_VENDOR implTitle attr getValue Attributes Name IMPLEMENTATION_TITLE implVersion attr getValue Attributes Name IMPLEMENTATION_VERSION implVendor attr getValue Attributes Name IMPLEMENTATION_VENDOR sealed attr getValue Attributes Name SEALED attr man getMainAttributes if attr null if specTitle null specTitle attr getValue Attributes Name SPECIFICATION_TITLE if specVersion null specVersion attr getValue Attributes Name SPECIFICATION_VERSION if specVendor null specVendor attr getValue Attributes Name SPECIFICATION_VENDOR if implTitle null implTitle attr getValue Attributes Name IMPLEMENTATION_TITLE if implVersion null implVersion attr getValue Attributes Name IMPLEMENTATION_VERSION if implVendor null implVendor attr getValue Attributes Name IMPLEMENTATION_VENDOR if sealed null sealed attr getValue Attributes Name SEALED return super definePackage name specTitle specVersion specVendor implTitle implVersion implVendor sealBase public abstract class EnhancedDialog extends JDialog public EnhancedDialog Frame parent String title boolean modal super parent title modal public EnhancedDialog Dialog parent String title boolean modal super parent title modal public abstract void ok public abstract void cancel private void Container getLayeredPane addContainerListener new ContainerHandler getContentPane addContainerListener new ContainerHandler keyHandler new KeyHandler addKeyListener keyHandler addWindowListener new WindowHandler setDefaultCloseOperation DO_NOTHING_ON_CLOSE protected KeyHandler keyHandler class ContainerHandler extends ContainerAdapter public void componentAdded ContainerEvent evt componentAdded evt getChild public void componentRemoved ContainerEvent evt componentRemoved evt getChild private void componentAdded Component comp comp addKeyListener keyHandler if comp instanceof Container Container cont Container comp cont addContainerListener this Component comps cont getComponents for int comps length componentAdded comps private void componentRemoved Component comp comp removeKeyListener keyHandler if comp instanceof Container Container cont Container comp cont removeContainerListener this Component comps cont getComponents for int comps length componentRemoved comps class KeyHandler extends KeyAdapter public void keyPressed KeyEvent evt if evt isConsumed return if evt getKeyCode KeyEvent VK_ENTER Component comp getFocusOwner while comp null if comp instanceof JComboBox JComboBox combo JComboBox comp if combo isEditable Object selected combo getEditor getItem if selected null combo setSelectedItem selected break comp comp getParent ok evt consume else if evt getKeyCode KeyEvent VK_ESCAPE cancel evt consume class WindowHandler extends WindowAdapter public void windowClosing WindowEvent evt cancel class BrowserView extends JPanel public BrowserView VFSBrowser browser final boolean splitHorizontally this browser browser this splitHorizontally splitHorizontally parentDirectories new JList parentDirectories getSelectionModel setSelectionMode TreeSelectionModel SINGLE_TREE_SELECTION parentDirectories setCellRenderer new ParentDirectoryRenderer parentDirectories setVisibleRowCount parentDirectories addMouseListener new MouseHandler rootNode new DefaultMutableTreeNode null true model new DefaultTreeModel rootNode true tree new BrowserJTree model tree setCellRenderer renderer tree setEditable false tree addTreeExpansionListener new TreeHandler if OperatingSystem isMacOSLF tree putClientProperty tree setRootVisible false tree setShowsRootHandles true tree setVisibleRowCount final JScrollPane parentScroller new JScrollPane parentDirectories parentScroller setMinimumSize new Dimension JScrollPane treeScroller new JScrollPane tree treeScroller setMinimumSize new Dimension splitPane new JSplitPane splitHorizontally JSplitPane HORIZONTAL_SPLIT JSplitPane VERTICAL_SPLIT parentScroller treeScroller splitPane setOneTouchExpandable true SwingUtilities invokeLater new Runnable public void run String prop splitHorizontally int loc jEdit getIntegerProperty prop if loc loc parentScroller getPreferredSize height splitPane setDividerLocation loc parentDirectories ensureIndexIsVisible parentDirectories getModel getSize tmpExpanded new Hashtable if browser isMultipleSelectionEnabled tree getSelectionModel setSelectionMode TreeSelectionModel DISCONTIGUOUS_TREE_SELECTION else tree getSelectionModel setSelectionMode TreeSelectionModel SINGLE_TREE_SELECTION setLayout new BorderLayout add BorderLayout CENTER splitPane propertiesChanged public void focusOnFileView tree requestFocus public void removeNotify String prop splitHorizontally jEdit setIntegerProperty prop splitPane getDividerLocation super removeNotify public VFS DirectoryEntry getSelectedFiles Vector selected new Vector tree getSelectionCount TreePath paths tree getSelectionPaths if paths null return new VFS DirectoryEntry for int paths length DefaultMutableTreeNode treeNode DefaultMutableTreeNode paths getLastPathComponent Object obj treeNode getUserObject if obj instanceof VFS DirectoryEntry selected addElement obj VFS DirectoryEntry retVal new VFS DirectoryEntry selected size selected copyInto retVal return retVal public void selectNone tree setSelectionPaths new TreePath public void loadDirectory String path tmpExpanded clear loadDirectory rootNode path false public void directoryLoaded DefaultMutableTreeNode node String path Vector directory if node rootNode DefaultListModel parentList new DefaultListModel String parent path if parent length parent endsWith parent endsWith File separator parent parent substring parent length for VFS VFSManager getVFSForPath parent parentList insertElementAt new VFS DirectoryEntry getFileName parent parent parent VFS DirectoryEntry DIRECTORY false String newParent getParentOfPath parent if newParent length newParent endsWith newParent endsWith File separator newParent newParent substring newParent length if newParent null parent equals newParent break else parent newParent parentDirectories setModel parentList int index parentList getSize parentDirectories setSelectedIndex index parentDirectories ensureIndexIsVisible index node removeAllChildren Vector toExpand new Vector if directory null for int directory size VFS DirectoryEntry file VFS DirectoryEntry directory elementAt boolean allowsChildren file type VFS DirectoryEntry FILE DefaultMutableTreeNode newNode new DefaultMutableTreeNode file allowsChildren node add newNode if tmpExpanded get file path null tmpExpanded remove file path toExpand addElement new TreePath newNode getPath model reload node tree expandPath new TreePath node getPath for int toExpand size TreePath treePath TreePath toExpand elementAt tree expandPath treePath timer stop typeSelectBuffer setLength public void updateFileView tree repaint public void maybeReloadDirectory String path tmpExpanded clear String browserDir browser getDirectory if browserDir startsWith FavoritesVFS PROTOCOL maybeReloadDirectory rootNode path else if browserDir startsWith FileRootsVFS PROTOCOL if MiscUtilities isURL path MiscUtilities getProtocolOfURL path equals maybeReloadDirectory rootNode path else if path startsWith browserDir maybeReloadDirectory rootNode path public Component getDefaultFocusComponent return tree public void propertiesChanged showIcons jEdit getBooleanProperty renderer propertiesChanged tree setRowHeight renderer getTreeCellRendererComponent tree new DefaultMutableTreeNode false false false false getSize height splitPane setBorder null public BrowserJTree getTree return tree private VFSBrowser browser private JSplitPane splitPane private JList parentDirectories private BrowserJTree tree private Hashtable tmpExpanded private DefaultTreeModel model private DefaultMutableTreeNode rootNode private BrowserCommandsMenu popup private boolean showIcons private boolean splitHorizontally private FileCellRenderer renderer new FileCellRenderer private StringBuffer typeSelectBuffer new StringBuffer private Timer timer new Timer new ClearTypeSelect private boolean maybeReloadDirectory DefaultMutableTreeNode node String path if tree isExpanded new TreePath node getPath return false if node rootNode path equals browser getDirectory loadDirectory rootNode path false return true Object userObject node getUserObject if userObject instanceof VFS DirectoryEntry VFS DirectoryEntry file VFS DirectoryEntry userObject if file type VFS DirectoryEntry FILE return false if path equals file path loadDirectory node path false return true if node getChildCount Enumeration children node children while children hasMoreElements DefaultMutableTreeNode child DefaultMutableTreeNode children nextElement if maybeReloadDirectory child path return true return false private void loadDirectory DefaultMutableTreeNode node String path boolean showLoading saveExpansionState node path MiscUtilities constructPath browser getDirectory path VFS vfs VFSManager getVFSForPath path Object session vfs createVFSSession path this if session null return if node rootNode setListModel parentDirectories new Object new LoadingPlaceholder if showLoading node removeAllChildren node add new DefaultMutableTreeNode new LoadingPlaceholder false model reload node VFSManager runInWorkThread new BrowserIORequest BrowserIORequest LIST_DIRECTORY browser session vfs path null node node rootNode private void saveExpansionState DefaultMutableTreeNode node for int node getChildCount DefaultMutableTreeNode child DefaultMutableTreeNode node getChildAt TreePath treePath new TreePath child getPath if tree isExpanded treePath VFS DirectoryEntry file VFS DirectoryEntry child getUserObject tmpExpanded put file path file path if file type VFS DirectoryEntry FILE saveExpansionState child private void showFilePopup VFS DirectoryEntry files Component comp Point point popup new BrowserCommandsMenu browser files popup addPopupMenuListener new PopupMenuListener public void popupMenuCanceled PopupMenuEvent public void popupMenuWillBecomeVisible PopupMenuEvent public void popupMenuWillBecomeInvisible PopupMenuEvent int index parentDirectories getModel getSize parentDirectories setSelectedIndex index GUIUtilities showPopupMenu popup comp point point private void setListModel JList list final Object model list setModel new AbstractListModel public int getSize return model length public Object getElementAt int return model class ClearTypeSelect implements ActionListener public void actionPerformed ActionEvent evt typeSelectBuffer setLength browser filesSelected class ParentDirectoryRenderer extends DefaultListCellRenderer Font plainFont boldFont ParentDirectoryRenderer plainFont UIManager getFont boldFont new Font plainFont getName Font BOLD plainFont getSize public Component getListCellRendererComponent JList list Object value int index boolean isSelected boolean cellHasFocus super getListCellRendererComponent list value index isSelected cellHasFocus ParentDirectoryRenderer this setBorder new EmptyBorder index if value instanceof LoadingPlaceholder ParentDirectoryRenderer this setFont plainFont setIcon showIcons FileCellRenderer loadingIcon null setText jEdit getProperty else if value instanceof VFS DirectoryEntry VFS DirectoryEntry dirEntry VFS DirectoryEntry value ParentDirectoryRenderer this setFont boldFont setIcon showIcons FileCellRenderer getIconForFile dirEntry true null setText dirEntry name else if value null setText return this class MouseHandler extends MouseAdapter public void mousePressed MouseEvent evt int row parentDirectories locationToIndex evt getPoint if row Object obj parentDirectories getModel getElementAt row if obj instanceof VFS DirectoryEntry VFS DirectoryEntry dirEntry VFS DirectoryEntry obj if GUIUtilities isPopupTrigger evt if popup null popup isVisible popup setVisible false popup null else parentDirectories setSelectedIndex row showFilePopup new VFS DirectoryEntry dirEntry parentDirectories evt getPoint public void mouseReleased MouseEvent evt if evt getClickCount GUIUtilities isMiddleButton evt getModifiers return int row parentDirectories locationToIndex evt getPoint if row Object obj parentDirectories getModel getElementAt row if obj instanceof VFS DirectoryEntry VFS DirectoryEntry dirEntry VFS DirectoryEntry obj if GUIUtilities isPopupTrigger evt browser setDirectory dirEntry path focusOnFileView class BrowserJTree extends JTree BrowserJTree TreeModel model super model ToolTipManager sharedInstance registerComponent this public final String getToolTipText MouseEvent evt TreePath path getPathForLocation evt getX evt getY if path null Rectangle cellRect getPathBounds path if cellRect null cellRectIsVisible cellRect return path getLastPathComponent toString return null public void processKeyEvent KeyEvent evt if evt getID KeyEvent KEY_PRESSED switch evt getKeyCode case KeyEvent VK_UP case KeyEvent VK_DOWN super processKeyEvent evt if browser getMode VFSBrowser BROWSER browser filesSelected break case KeyEvent VK_ENTER browser filesActivated evt isShiftDown VFSBrowser M_OPEN_NEW_VIEW VFSBrowser M_OPEN false evt consume break case KeyEvent VK_LEFT String directory browser getDirectory browser setDirectory MiscUtilities getParentOfPath directory evt consume break else if evt getID KeyEvent KEY_TYPED if evt isControlDown evt isAltDown evt isMetaDown return if evt isShiftDown evt getKeyChar return switch evt getKeyChar case browser setDirectory System getProperty break case browser rootDirectory break case View view browser getView Buffer buffer view getBuffer browser setDirectory buffer getDirectory break default typeSelectBuffer append evt getKeyChar doTypeSelect typeSelectBuffer toString true timer stop timer setInitialDelay timer setRepeats false timer start break return if evt isConsumed super processKeyEvent evt protected void processMouseEvent MouseEvent evt TreePath path getPathForLocation evt getX evt getY switch evt getID case MouseEvent MOUSE_CLICKED if path null if evt getModifiers MouseEvent BUTTON1_MASK evt getClickCount setSelectionPath path browser filesActivated evt isShiftDown VFSBrowser M_OPEN_NEW_VIEW VFSBrowser M_OPEN true break else if GUIUtilities isMiddleButton evt getModifiers browser filesActivated evt isShiftDown VFSBrowser M_OPEN_NEW_VIEW VFSBrowser M_OPEN true else if evt getModifiers MouseEvent BUTTON1_MASK if isPathSelected path setSelectionPath path super processMouseEvent evt break else if GUIUtilities isPopupTrigger evt break case MouseEvent MOUSE_PRESSED if evt getModifiers MouseEvent BUTTON1_MASK if evt getClickCount break if GUIUtilities isMiddleButton evt getModifiers if isPathSelected path setSelectionPath path else if GUIUtilities isPopupTrigger evt if popup null popup isVisible popup setVisible false popup null break if path null showFilePopup null this evt getPoint else if isPathSelected path setSelectionPath path showFilePopup getSelectedFiles this evt getPoint break super processMouseEvent evt break case MouseEvent MOUSE_RELEASED if GUIUtilities isPopupTrigger evt path null browser filesSelected if evt getClickCount super processMouseEvent evt break default super processMouseEvent evt break private int toolTipInitialDelay private int toolTipReshowDelay private boolean cellRectIsVisible Rectangle cellRect Rectangle vr BrowserJTree this getVisibleRect return vr contains cellRect cellRect vr contains cellRect cellRect width cellRect cellRect height void doTypeSelect String str boolean ignoreCase if getSelectionCount doTypeSelect str getRowCount ignoreCase else int start getMaxSelectionRow boolean retVal doTypeSelect str start getRowCount ignoreCase if retVal doTypeSelect str start ignoreCase private boolean doTypeSelect String str int start int end boolean ignoreCase for int start end DefaultMutableTreeNode treeNode DefaultMutableTreeNode getPathForRow getLastPathComponent Object obj treeNode getUserObject if obj instanceof VFS DirectoryEntry VFS DirectoryEntry file VFS DirectoryEntry obj String matchAgainst MiscUtilities isAbsolutePath str file path file name if matchAgainst regionMatches ignoreCase str str length setSelectionRow scrollRowToVisible return true return false class TreeHandler implements TreeExpansionListener public void treeExpanded TreeExpansionEvent evt TreePath path evt getPath DefaultMutableTreeNode treeNode DefaultMutableTreeNode path getLastPathComponent Object userObject treeNode getUserObject if userObject instanceof VFS DirectoryEntry loadDirectory treeNode VFS DirectoryEntry userObject path true public void treeCollapsed TreeExpansionEvent evt TreePath path evt getPath DefaultMutableTreeNode treeNode DefaultMutableTreeNode path getLastPathComponent if treeNode getUserObject instanceof VFS DirectoryEntry treeNode removeAllChildren treeNode add new DefaultMutableTreeNode new LoadingPlaceholder false model reload treeNode static class LoadingPlaceholder class BSHSwitchLabel extends SimpleNode boolean isDefault public BSHSwitchLabel int id super id public Object eval CallStack callstack Interpreter interpreter throws EvalError if isDefault SimpleNode label SimpleNode jjtGetChild return label eval callstack interpreter public class XmlException extends Exception private String message private String systemId private int line private int column public XmlException String message String systemId int line int column this message message this systemId systemId this line line this column column public String getMessage return message public String getSystemId return systemId public int getLine return line public int getColumn return column public class PropertiesChanged extends EBMessage public PropertiesChanged EBComponent source super source public class AbstractOptionPane extends JPanel implements OptionPane public AbstractOptionPane String name this name name setLayout gridBag new GridBagLayout public String getName return name public Component getComponent return this public void init if initialized initialized true public void save if initialized public void addComponent String label Component comp JLabel new JLabel label setBorder new EmptyBorder addComponent comp GridBagConstraints BOTH public void addComponent String label Component comp int fill JLabel new JLabel label setBorder new EmptyBorder addComponent comp fill public void addComponent Component comp1 Component comp2 addComponent comp1 comp2 GridBagConstraints BOTH public void addComponent Component comp1 Component comp2 int fill GridBagConstraints cons new GridBagConstraints cons gridy cons gridheight cons gridwidth cons weightx cons insets new Insets cons fill GridBagConstraints BOTH gridBag setConstraints comp1 cons add comp1 cons fill fill cons gridx cons weightx gridBag setConstraints comp2 cons add comp2 public void addComponent Component comp GridBagConstraints cons new GridBagConstraints cons gridy cons gridheight cons gridwidth cons REMAINDER cons fill GridBagConstraints NONE cons anchor GridBagConstraints WEST cons weightx cons insets new Insets gridBag setConstraints comp cons add comp public void addSeparator if addComponent Box createVerticalStrut JSeparator sep new JSeparator JSeparator HORIZONTAL GridBagConstraints cons new GridBagConstraints cons gridy cons gridheight cons gridwidth cons REMAINDER cons fill GridBagConstraints BOTH cons anchor GridBagConstraints WEST cons weightx cons insets new Insets gridBag setConstraints sep cons add sep public void addSeparator String label if addComponent Box createVerticalStrut Box box new Box BoxLayout X_AXIS Box box2 new Box BoxLayout Y_AXIS box2 add Box createGlue box2 add new JSeparator JSeparator HORIZONTAL box2 add Box createGlue box add box2 JLabel new JLabel jEdit getProperty label setMaximumSize getPreferredSize box add Box box3 new Box BoxLayout Y_AXIS box3 add Box createGlue box3 add new JSeparator JSeparator HORIZONTAL box3 add Box createGlue box add box3 GridBagConstraints cons new GridBagConstraints cons gridy cons gridheight cons gridwidth cons REMAINDER cons fill GridBagConstraints BOTH cons anchor GridBagConstraints WEST cons weightx cons insets new Insets gridBag setConstraints box cons add box protected boolean initialized protected GridBagLayout gridBag protected int protected void protected void private String name abstract class REToken implements Serializable protected REToken next null protected REToken uncle null protected int subIndex protected REToken int subIndex this subIndex subIndex int getMinimumLength return void setUncle REToken anUncle uncle anUncle abstract boolean match CharIndexed input REMatch mymatch protected boolean next CharIndexed input REMatch mymatch if next null if uncle null return true else return uncle match input mymatch else return next match input mymatch boolean chain REToken token next token abstract void dump StringBuffer os void dumpAll StringBuffer os dump os if next null next dumpAll os class ErrorListCellRenderer extends JComponent implements ListCellRenderer ErrorListCellRenderer plainFont UIManager getFont boldFont new Font plainFont getName Font BOLD plainFont getSize plainFM getFontMetrics plainFont boldFM getFontMetrics boldFont setBorder new EmptyBorder public Component getListCellRendererComponent JList list Object value int index boolean isSelected boolean cellHasFocus ErrorListDialog ErrorEntry entry ErrorListDialog ErrorEntry value this path entry path this messages entry messages return this public Dimension getPreferredSize int width boldFM stringWidth path int height boldFM getHeight for int messages length width Math max plainFM stringWidth messages width height plainFM getHeight Insets insets getBorder getBorderInsets this width insets left insets right height insets top insets bottom return new Dimension width height public void paintComponent Graphics Insets insets getBorder getBorderInsets this setFont boldFont drawString path insets left insets top boldFM getAscent int insets top boldFM getHeight setFont plainFont for int messages length drawString messages insets left plainFM getAscent plainFM getHeight private String path private String messages private Font plainFont private Font boldFont private FontMetrics plainFM private FontMetrics boldFM public final class UncheckedRE extends RE public UncheckedRE Object pattern this pattern RESyntax RE_SYNTAX_PERL5 public UncheckedRE Object pattern int cflags this pattern cflags RESyntax RE_SYNTAX_PERL5 public UncheckedRE Object pattern int cflags RESyntax syntax try initialize pattern cflags syntax catch REException throw new RuntimeException getMessage public class Macros public static void showRunScriptDialog View view String paths GUIUtilities showVFSFileDialog view null JFileChooser OPEN_DIALOG true if paths null Buffer buffer view getBuffer try buffer beginCompoundEdit file_loop for int paths length runScript view paths false finally buffer endCompoundEdit public static void runScript View view String path boolean ignoreUnknown Handler handler getHandlerForPathName path if handler null try Macro newMacro handler createMacro MiscUtilities getFileName path path newMacro invoke view catch Exception Log log Log ERROR Macros class return return if ignoreUnknown Log log Log NOTICE Macros class path else Log log Log ERROR Macros class path getHandler createMacro path path invoke view public static void message Component comp String message GUIUtilities hideSplashScreen JOptionPane showMessageDialog comp message jEdit getProperty JOptionPane INFORMATION_MESSAGE public static void error Component comp String message GUIUtilities hideSplashScreen JOptionPane showMessageDialog comp message jEdit getProperty JOptionPane ERROR_MESSAGE public static String input Component comp String prompt GUIUtilities hideSplashScreen return input comp prompt null public static String input Component comp String prompt String defaultValue GUIUtilities hideSplashScreen return String JOptionPane showInputDialog comp prompt jEdit getProperty JOptionPane QUESTION_MESSAGE null null defaultValue public static int confirm Component comp String prompt int buttons GUIUtilities hideSplashScreen return JOptionPane showConfirmDialog comp prompt jEdit getProperty buttons JOptionPane QUESTION_MESSAGE public static int confirm Component comp String prompt int buttons int type GUIUtilities hideSplashScreen return JOptionPane showConfirmDialog comp prompt jEdit getProperty buttons type public static void loadMacros macroActionSet removeAllActions macroHierarchy removeAllElements macroHash clear if jEdit getJEditHome null systemMacroPath MiscUtilities constructPath jEdit getJEditHome loadMacros macroHierarchy new File systemMacroPath String settings jEdit getSettingsDirectory if settings null userMacroPath MiscUtilities constructPath settings loadMacros macroHierarchy new File userMacroPath EditBus send new MacrosChanged null public static void registerHandler Handler handler if getHandler handler getName null Log log Log ERROR Macros class return Log log Log DEBUG Macros class handler getName macroHandlers add handler public static Handler getHandlers Handler handlers new Handler macroHandlers size return Handler macroHandlers toArray handlers public static Handler getHandlerForPathName String pathName for int macroHandlers size Handler handler Handler macroHandlers get if handler accept pathName return handler return null public static Handler getHandler String name Handler handler null for int macroHandlers size handler Handler macroHandlers get if handler getName equals name return handler return null public static Vector getMacroHierarchy return macroHierarchy public static ActionSet getMacroActionSet return macroActionSet public static Macro getMacro String macro return Macro macroHash get macro public static class Macro extends EditAction public Macro Handler handler String name String label String path super name replace this handler handler this label label this path path public Handler getHandler return handler public String getLabel return label public String getMouseOverText return handler getLabel path public String getPath return path public void invoke View view lastMacro this if view null handler runMacro null this else Buffer buffer view getBuffer try buffer beginCompoundEdit handler runMacro view this finally buffer endCompoundEdit public String getCode return getName public static String macroNameToLabel String macroName int index macroName lastIndexOf return macroName substring index replace private Handler handler private String path private String label public static void recordTemporaryMacro View view String settings jEdit getSettingsDirectory if settings null GUIUtilities error view new String return if view getMacroRecorder null GUIUtilities error view new String return Buffer buffer jEdit openFile null settings File separator true null if buffer null return buffer remove buffer getLength buffer insert jEdit getProperty recordMacro view buffer true public static void recordMacro View view String settings jEdit getSettingsDirectory if settings null GUIUtilities error view new String return if view getMacroRecorder null GUIUtilities error view new String return String name GUIUtilities input view null if name null return name name replace Buffer buffer jEdit openFile null null MiscUtilities constructPath settings name true null if buffer null return buffer remove buffer getLength buffer insert jEdit getProperty recordMacro view buffer false public static void stopRecording View view Recorder recorder view getMacroRecorder if recorder null GUIUtilities error view null else view setMacroRecorder null if recorder temporary view setBuffer recorder buffer recorder dispose public static void runTemporaryMacro View view String settings jEdit getSettingsDirectory if settings null GUIUtilities error view new String return String path MiscUtilities constructPath jEdit getSettingsDirectory Handler handler getHandler Macro temp handler createMacro path path Buffer buffer view getBuffer try buffer beginCompoundEdit temp invoke view finally if buffer insideCompoundEdit buffer endCompoundEdit public static void runLastMacro View view if lastMacro null view getToolkit beep else lastMacro invoke view private static String systemMacroPath private static String userMacroPath private static ArrayList macroHandlers private static ActionSet macroActionSet private static Vector macroHierarchy private static Hashtable macroHash private static Macro lastMacro static macroHandlers new ArrayList registerHandler new BeanShellHandler macroActionSet new ActionSet jEdit getProperty jEdit addActionSet macroActionSet macroHierarchy new Vector macroHash new Hashtable private static void loadMacros Vector vector String path File directory File macroFiles directory listFiles if macroFiles null macroFiles length return for int macroFiles length File file macroFiles String fileName file getName if file isHidden continue else if file isDirectory String submenuName fileName replace Vector submenu null for int vector size Object obj vector get if obj instanceof Vector Vector vec Vector obj if String vec get equals submenuName submenu vec break if submenu null submenu new Vector submenu addElement submenuName vector addElement submenu loadMacros submenu path fileName file else Handler handler getHandlerForPathName file getPath if handler null continue try Macro newMacro handler createMacro path fileName file getPath vector addElement newMacro macroActionSet addAction newMacro macroHash put newMacro getName newMacro catch Exception Log log Log ERROR Macros class macroHandlers remove handler private static void recordMacro View view Buffer buffer boolean temporary Handler handler getHandler String path buffer getPath lastMacro handler createMacro path path view setMacroRecorder new Recorder view buffer temporary view getStatus setMessage null public static class Recorder implements EBComponent View view Buffer buffer boolean temporary boolean lastWasInput public Recorder View view Buffer buffer boolean temporary this view view this buffer buffer this temporary temporary EditBus addToBus this public void record String code if lastWasInput lastWasInput false append append append code public void record int repeat String code if repeat record code else record repeat code public void record int repeat char ch if ch record repeat else if ch record repeat else StringBuffer buf new StringBuffer for int repeat buf append ch String charStr MiscUtilities charsToEscapes buf toString if lastWasInput append charStr else append charStr lastWasInput true public void handleMessage EBMessage msg if msg instanceof BufferUpdate BufferUpdate bmsg BufferUpdate msg if bmsg getWhat BufferUpdate CLOSED if bmsg getBuffer buffer stopRecording view private void append String str buffer insert buffer getLength str private void dispose if lastWasInput lastWasInput false append for int buffer getLineCount buffer indentLine true true EditBus removeFromBus this view getStatus setMessage null public static abstract class Handler public String getName return name public String getLabel return label public boolean accept String path return filter isMatch MiscUtilities getFileName path public abstract Macro createMacro String macroName String path public abstract void runMacro View view Macro macro public void runMacro View view Macro macro boolean ownNamespace runMacro view macro protected Handler String name this name name label jEdit getProperty name name try filter new RE MiscUtilities globToRE jEdit getProperty name catch Exception throw new InternalError name private String name private String label private RE filter static class BeanShellHandler extends Handler BeanShellHandler super public Macro createMacro String macroName String path macroName macroName substring macroName length return new Macro this macroName Macro macroNameToLabel macroName path public void runMacro View view Macro macro BeanShell runScript view macro getPath null true public void runMacro View view Macro macro boolean ownNamespace BeanShell runScript view macro getPath null ownNamespace public abstract class BufferListSet implements SearchFileSet public synchronized String getFirstFile View view if files null files view if files null files length return null else return files public synchronized String getNextFile View view String file if files null files view if files null files length return null if file null file view getBuffer getPath for int files length if files equals file return file return getFirstFile view else for int files length if files equals file return files return null public synchronized String getFiles View view if files null files view if files null files length return null else return files public synchronized int getFileCount View view if files null files view if files null return else return files length public String getCode return null public void invalidateCachedList files null protected abstract String Component comp private String files public class DefaultTokenHandler implements TokenHandler public void init lastToken firstToken null public Token getTokens return firstToken public void handleToken byte id int offset int length TokenMarker LineContext context Token token createToken id offset length context if token null addToken token context protected Token firstToken lastToken protected ParserRuleSet getParserRuleSet TokenMarker LineContext context while context null if context rules getMode null return context rules context context parent return null protected Token createToken byte id int offset int length TokenMarker LineContext context return new Token id offset length getParserRuleSet context protected void addToken Token token TokenMarker LineContext context if firstToken null firstToken lastToken token else lastToken next token lastToken lastToken next public abstract class TextAreaExtension public void paintValidLine Graphics2D gfx int screenLine public void paintInvalidLine Graphics2D gfx int screenLine public String getToolTipText int int return null public interface ParserTreeConstants public int JJTVOID public int JJTMETHODDECLARATION public int JJTIMPORTDECLARATION public int JJTVARIABLEDECLARATOR public int JJTARRAYINITIALIZER public int JJTFORMALPARAMETERS public int JJTFORMALPARAMETER public int JJTTYPE public int JJTRETURNTYPE public int JJTPRIMITIVETYPE public int JJTAMBIGUOUSNAME public int JJTASSIGNMENT public int JJTTERNARYEXPRESSION public int JJTBINARYEXPRESSION public int JJTUNARYEXPRESSION public int JJTCASTEXPRESSION public int JJTPRIMARYEXPRESSION public int JJTMETHODINVOCATION public int JJTPRIMARYSUFFIX public int JJTLHSPRIMARYEXPRESSION public int JJTLHSPRIMARYSUFFIX public int JJTLITERAL public int JJTARGUMENTS public int JJTALLOCATIONEXPRESSION public int JJTARRAYDIMENSIONS public int JJTBLOCK public int JJTFORMALCOMMENT public int JJTSWITCHSTATEMENT public int JJTSWITCHLABEL public int JJTIFSTATEMENT public int JJTWHILESTATEMENT public int JJTFORSTATEMENT public int JJTTYPEDVARIABLEDECLARATION public int JJTSTATEMENTEXPRESSIONLIST public int JJTRETURNSTATEMENT public int JJTTHROWSTATEMENT public int JJTTRYSTATEMENT public String jjtNodeName public class SearchAndReplace public static void setSearchString String search if search equals SearchAndReplace search return SearchAndReplace search search matcher null EditBus send new SearchSettingsChanged null public static String getSearchString return search public static void setReplaceString String replace if replace equals SearchAndReplace replace return SearchAndReplace replace replace matcher null EditBus send new SearchSettingsChanged null public static String getReplaceString return replace public static void setIgnoreCase boolean ignoreCase if ignoreCase SearchAndReplace ignoreCase return SearchAndReplace ignoreCase ignoreCase matcher null EditBus send new SearchSettingsChanged null public static boolean getIgnoreCase return ignoreCase public static void setRegexp boolean regexp if regexp SearchAndReplace regexp return SearchAndReplace regexp regexp if regexp reverse reverse false matcher null EditBus send new SearchSettingsChanged null public static boolean getRegexp return regexp public static void setReverseSearch boolean reverse if reverse SearchAndReplace reverse return SearchAndReplace reverse regexp false reverse matcher null EditBus send new SearchSettingsChanged null public static boolean getReverseSearch return reverse public static void setBeanShellReplace boolean beanshell if beanshell SearchAndReplace beanshell return SearchAndReplace beanshell beanshell matcher null EditBus send new SearchSettingsChanged null public static boolean getBeanShellReplace return beanshell public static void setAutoWrapAround boolean wrap if wrap SearchAndReplace wrap return SearchAndReplace wrap wrap EditBus send new SearchSettingsChanged null public static boolean getAutoWrapAround return wrap public static void setSearchMatcher SearchMatcher matcher SearchAndReplace matcher matcher EditBus send new SearchSettingsChanged null public static SearchMatcher getSearchMatcher throws Exception if matcher null return matcher if search null equals search return null String replace SearchAndReplace replace null SearchAndReplace replace BshMethod replaceMethod if beanshell replace length replaceMethod BeanShell cacheBlock replace true else replaceMethod null if regexp matcher new RESearchMatcher search replace ignoreCase beanshell replaceMethod else matcher new BoyerMooreSearchMatcher search replace ignoreCase beanshell replaceMethod return matcher public static void setSearchFileSet SearchFileSet fileset SearchAndReplace fileset fileset EditBus send new SearchSettingsChanged null public static SearchFileSet getSearchFileSet return fileset public static boolean hyperSearch View view return hyperSearch view false public static boolean hyperSearch View view boolean selection Component comp SearchDialog getSearchDialog view if comp null comp view record view selection false selection view getDockableWindowManager addDockableWindow HyperSearchResults NAME final HyperSearchResults results HyperSearchResults view getDockableWindowManager getDockable HyperSearchResults NAME results searchStarted try SearchMatcher matcher getSearchMatcher if matcher null view getToolkit beep results searchFailed return false Selection if selection view getTextArea getSelection if null results searchFailed return false else null VFSManager runInWorkThread new HyperSearchRequest view matcher results return true catch Exception results searchFailed Log log Log ERROR SearchAndReplace class Object args getMessage if args null args toString GUIUtilities error comp args return false public static boolean find View view Component comp SearchDialog getSearchDialog view if comp null comp view boolean repeat false String path fileset getNextFile view null if path null GUIUtilities error comp null return false try SearchMatcher matcher getSearchMatcher if matcher null view getToolkit beep return false record view false true view showWaitCursor boolean reverse fileset instanceof CurrentBufferSet loop for while path null Buffer buffer jEdit openTemporary view null path false path fileset getNextFile view path if buffer null continue loop if buffer isLoaded VFSManager waitForRequests int start if view getBuffer buffer repeat JEditTextArea textArea view getTextArea Selection textArea getSelectionAtOffset textArea getCaretPosition if null start textArea getCaretPosition else if start getStart else start getEnd else if start buffer getLength else start if find view buffer start repeat return true if repeat if BeanShell isScriptRunning view getStatus setMessageAndClear jEdit getProperty view getToolkit beep return false boolean restart if BeanShell isScriptRunning restart true else if wrap view getStatus setMessageAndClear jEdit getProperty if jEdit getBooleanProperty view getToolkit beep restart true else Integer args new Integer int result GUIUtilities confirm comp args JOptionPane YES_NO_OPTION JOptionPane QUESTION_MESSAGE restart result JOptionPane YES_OPTION if restart path fileset getFirstFile view repeat true else break loop catch Exception Log log Log ERROR SearchAndReplace class Object args getMessage if args null args toString GUIUtilities error comp args finally view hideWaitCursor return false public static boolean find View view Buffer buffer int start throws Exception return find view buffer start false false public static boolean find View view Buffer buffer int start boolean firstTime boolean reverse throws Exception SearchMatcher matcher getSearchMatcher if matcher null view getToolkit beep return false Segment text new Segment if reverse buffer getText start text else buffer getText start buffer getLength start text int match matcher nextMatch new CharIndexedSegment text reverse start true firstTime reverse if match null jEdit commitTemporary buffer view setBuffer buffer JEditTextArea textArea view getTextArea if reverse textArea setSelection new Selection Range start match start match textArea moveCaretPosition start match else textArea setSelection new Selection Range start match start match textArea moveCaretPosition start match return true else return false public static boolean replace View view Component comp SearchDialog getSearchDialog view if comp null comp view JEditTextArea textArea view getTextArea Buffer buffer view getBuffer if buffer isEditable return false boolean smartCaseReplace replace null TextUtilities getStringCase replace TextUtilities LOWER_CASE Selection selection textArea getSelection if selection length view getToolkit beep return false record view true false int caret textArea getCaretPosition Selection textArea getSelectionAtOffset caret if null caret getStart try buffer beginCompoundEdit SearchMatcher matcher getSearchMatcher if matcher null return false int retVal for int selection length selection int start getStart if instanceof Selection Range retVal view buffer matcher getStart getEnd smartCaseReplace textArea removeFromSelection textArea addToSelection new Selection Range start getEnd else if instanceof Selection Rect for int getStartLine getEndLine retVal view buffer matcher getStart buffer getEnd buffer smartCaseReplace textArea addToSelection new Selection Rect start getEnd if reverse textArea moveCaretPosition caret else textArea getSelectionAtOffset textArea getCaretPosition if null textArea moveCaretPosition getEnd if retVal view getToolkit beep return false return true catch Exception Log log Log ERROR SearchAndReplace class Object args getMessage if args null args toString GUIUtilities error comp args finally buffer endCompoundEdit return false public static boolean replace View view Buffer buffer int start int end if buffer isEditable return false Component comp SearchDialog getSearchDialog view if comp null comp view boolean smartCaseReplace replace null TextUtilities getStringCase replace TextUtilities LOWER_CASE try buffer beginCompoundEdit SearchMatcher matcher getSearchMatcher if matcher null return false int retVal retVal view buffer matcher start end smartCaseReplace if retVal return true catch Exception Log log Log ERROR SearchAndReplace class Object args getMessage if args null args toString GUIUtilities error comp args finally buffer endCompoundEdit return false public static boolean replaceAll View view Component comp SearchDialog getSearchDialog view if comp null comp view int fileCount int occurCount if fileset getFileCount view GUIUtilities error comp null return false record view true true view showWaitCursor boolean smartCaseReplace replace null TextUtilities getStringCase replace TextUtilities LOWER_CASE try SearchMatcher matcher getSearchMatcher if matcher null return false String path fileset getFirstFile view loop while path null Buffer buffer jEdit openTemporary view null path false path fileset getNextFile view path if buffer null continue loop if buffer isPerformingIO VFSManager waitForRequests if buffer isEditable continue loop int retVal try buffer beginCompoundEdit retVal view buffer matcher buffer getLength smartCaseReplace finally buffer endCompoundEdit if retVal fileCount occurCount retVal jEdit commitTemporary buffer catch Exception Log log Log ERROR SearchAndReplace class Object args getMessage if args null args toString GUIUtilities error comp args finally view hideWaitCursor if BeanShell isScriptRunning Object args new Integer occurCount new Integer fileCount view getStatus setMessageAndClear jEdit getProperty args if occurCount view getToolkit beep return fileCount public static void load search jEdit getProperty replace jEdit getProperty ignoreCase jEdit getBooleanProperty regexp jEdit getBooleanProperty beanshell jEdit getBooleanProperty wrap jEdit getBooleanProperty fileset new CurrentBufferSet matcher null EditBus send new SearchSettingsChanged null public static void save jEdit setProperty search jEdit setProperty replace jEdit setBooleanProperty ignoreCase jEdit setBooleanProperty regexp jEdit setBooleanProperty beanshell jEdit setBooleanProperty wrap private static String search private static String replace private static boolean regexp private static boolean ignoreCase private static boolean reverse private static boolean beanshell private static boolean wrap private static SearchMatcher matcher private static SearchFileSet fileset private static void record View view String action boolean replaceAction boolean recordFileSet Macros Recorder recorder view getMacroRecorder if recorder null recorder record MiscUtilities charsToEscapes search if replaceAction recorder record MiscUtilities charsToEscapes replace recorder record beanshell else recorder record wrap recorder record reverse recorder record ignoreCase recorder record regexp if recordFileSet recorder record fileset getCode recorder record action private static int View view Buffer buffer SearchMatcher matcher int start int end boolean smartCaseReplace throws Exception int occurCount boolean endOfLine buffer getLineEndOffset buffer getLineOfOffset end end Segment text new Segment int offset start loop for int counter counter buffer getText offset end offset text boolean startOfLine buffer getLineStartOffset buffer getLineOfOffset offset offset int occur matcher nextMatch new CharIndexedSegment text false startOfLine endOfLine counter false if occur null break loop int occur int occur occur String found new String text array text offset String subst matcher substitute found if smartCaseReplace ignoreCase int strCase TextUtilities getStringCase found if strCase TextUtilities LOWER_CASE subst subst toLowerCase else if strCase TextUtilities UPPER_CASE subst subst toUpperCase else if strCase TextUtilities TITLE_CASE subst TextUtilities toTitleCase subst if subst null buffer remove offset buffer insert offset subst occurCount offset subst length end subst length found length else offset return occurCount public HelpViewer this public HelpViewer URL url this url toString public HelpViewer String url super jEdit getProperty setIconImage GUIUtilities getEditorIcon try baseURL new File MiscUtilities constructPath jEdit getJEditHome toURL toString catch MalformedURLException mu Log log Log ERROR this mu history new String ActionHandler actionListener new ActionHandler JTabbedPane tabs new JTabbedPane tabs addTab jEdit getProperty toc new HelpTOCPanel this tabs addTab jEdit getProperty new HelpSearchPanel this tabs setMinimumSize new Dimension JPanel rightPanel new JPanel new BorderLayout JToolBar toolBar new JToolBar toolBar setFloatable false toolBar add title new JLabel toolBar add Box createGlue JPanel buttons new JPanel buttons setLayout new BoxLayout buttons BoxLayout X_AXIS buttons setBorder new EmptyBorder back new RolloverButton GUIUtilities loadIcon jEdit getProperty back setToolTipText jEdit getProperty back addActionListener actionListener toolBar add back forward new RolloverButton GUIUtilities loadIcon jEdit getProperty forward addActionListener actionListener forward setToolTipText jEdit getProperty toolBar add forward back setPreferredSize forward getPreferredSize rightPanel add BorderLayout NORTH toolBar viewer new JEditorPane viewer setEditable false viewer addHyperlinkListener new LinkHandler viewer setFont new Font Font PLAIN viewer addPropertyChangeListener new PropertyChangeHandler rightPanel add BorderLayout CENTER new JScrollPane viewer splitter new JSplitPane JSplitPane HORIZONTAL_SPLIT tabs rightPanel splitter setBorder null getContentPane add BorderLayout CENTER splitter gotoURL url true setDefaultCloseOperation DISPOSE_ON_CLOSE getRootPane setPreferredSize new Dimension pack GUIUtilities loadGeometry this show SwingUtilities invokeLater new Runnable public void run splitter setDividerLocation jEdit getIntegerProperty viewer requestFocus public void gotoURL String url boolean addToHistory String shortURL if MiscUtilities isURL url if url startsWith baseURL shortURL url substring baseURL length if shortURL startsWith shortURL shortURL substring else shortURL url else shortURL url if baseURL endsWith url baseURL url else url baseURL url viewer setCursor Cursor getDefaultCursor URL null try new URL url if equals viewer getPage title setText jEdit getProperty else viewer setPage if addToHistory history historyPos url if historyPos history length System arraycopy history history history length history historyPos null else historyPos catch MalformedURLException mf Log log Log ERROR this mf String args url mf getMessage GUIUtilities error this args return catch IOException io Log log Log ERROR this io String args url io toString GUIUtilities error this args return if shortURL null toc selectNode shortURL public void dispose jEdit setIntegerProperty splitter getDividerLocation GUIUtilities saveGeometry this super dispose public String getBaseURL return baseURL private String baseURL private JButton back private JButton forward private JEditorPane viewer private JLabel title private JSplitPane splitter private String history private int historyPos private HelpTOCPanel toc class ActionHandler implements ActionListener public void actionPerformed ActionEvent evt Object source evt getSource if source back if historyPos getToolkit beep else String url history historyPos gotoURL url false else if source forward if history length historyPos getToolkit beep else String url history historyPos if url null getToolkit beep else historyPos gotoURL url false class LinkHandler implements HyperlinkListener public void hyperlinkUpdate HyperlinkEvent evt if evt getEventType HyperlinkEvent EventType ACTIVATED if evt instanceof HTMLFrameHyperlinkEvent HTMLDocument viewer getDocument processHTMLFrameHyperlinkEvent HTMLFrameHyperlinkEvent evt else URL url evt getURL if url null gotoURL url toString true else if evt getEventType HyperlinkEvent EventType ENTERED viewer setCursor Cursor getPredefinedCursor Cursor HAND_CURSOR else if evt getEventType HyperlinkEvent EventType EXITED viewer setCursor Cursor getDefaultCursor class PropertyChangeHandler implements PropertyChangeListener public void propertyChange PropertyChangeEvent evt if equals evt getPropertyName String titleStr String viewer getDocument getProperty if titleStr null titleStr MiscUtilities getFileName viewer getPage toString title setText titleStr class BSHIfStatement extends SimpleNode BSHIfStatement int id super id public Object eval CallStack callstack Interpreter interpreter throws EvalError Object ret null if evaluateCondition SimpleNode jjtGetChild callstack interpreter ret SimpleNode jjtGetChild eval callstack interpreter else if jjtGetNumChildren ret SimpleNode jjtGetChild eval callstack interpreter if ret instanceof ReturnControl return ret else return Primitive VOID public static boolean evaluateCondition SimpleNode condExp CallStack callstack Interpreter interpreter throws EvalError Object obj condExp eval callstack interpreter if obj instanceof Primitive if obj Primitive VOID throw new EvalError condExp obj Primitive obj getValue if obj instanceof Boolean return Boolean obj booleanValue else throw new EvalError condExp public class BrowserColorsOptionPane extends AbstractOptionPane public BrowserColorsOptionPane super protected void setLayout new BorderLayout colorsModel new BrowserColorsModel colorsTable new JTable colorsModel colorsTable setAutoResizeMode JTable AUTO_RESIZE_ALL_COLUMNS colorsTable getTableHeader setReorderingAllowed false colorsTable addMouseListener new MouseHandler colorsTable getSelectionModel addListSelectionListener new SelectionHandler TableColumnModel tcm colorsTable getColumnModel tcm getColumn setCellRenderer new BrowserColorsModel ColorRenderer Dimension colorsTable getPreferredSize height Math min height JScrollPane scroller new JScrollPane colorsTable scroller setPreferredSize add BorderLayout CENTER scroller JPanel buttons new JPanel buttons setBorder new EmptyBorder buttons setLayout new BoxLayout buttons BoxLayout X_AXIS ActionHandler actionHandler new ActionHandler add new RolloverButton GUIUtilities loadIcon add setToolTipText jEdit getProperty add addActionListener actionHandler buttons add add buttons add Box createHorizontalStrut remove new RolloverButton GUIUtilities loadIcon remove setToolTipText jEdit getProperty remove addActionListener actionHandler buttons add remove buttons add Box createGlue add BorderLayout SOUTH buttons updateEnabled protected void colorsModel save private BrowserColorsModel colorsModel private JTable colorsTable private JButton add private JButton remove private void updateEnabled int selectedRow colorsTable getSelectedRow remove setEnabled selectedRow class SelectionHandler implements ListSelectionListener public void valueChanged ListSelectionEvent evt updateEnabled class ActionHandler implements ActionListener public void actionPerformed ActionEvent evt Object source evt getSource if source add colorsModel add else if source remove int selectedRow colorsTable getSelectedRow colorsModel remove selectedRow updateEnabled class MouseHandler extends MouseAdapter public void mouseClicked MouseEvent evt Point evt getPoint int row colorsTable rowAtPoint int column colorsTable columnAtPoint if row column return Color color JColorChooser showDialog BrowserColorsOptionPane this jEdit getProperty Color colorsModel getValueAt row if color null colorsModel setValueAt color row class BrowserColorsModel extends AbstractTableModel Vector entries BrowserColorsModel entries new Vector int String glob while glob jEdit getProperty null entries addElement new Entry glob jEdit getColorProperty Color black void add entries addElement new Entry UIManager getColor fireTableRowsInserted entries size entries size void remove int index entries removeElementAt index fireTableRowsDeleted entries size entries size void save int for entries size Entry entry Entry entries elementAt jEdit setProperty entry glob jEdit setColorProperty entry color jEdit unsetProperty jEdit unsetProperty public int getColumnCount return public int getRowCount return entries size public Object getValueAt int row int col Entry entry Entry entries elementAt row switch col case return entry glob case return entry color default return null public boolean isCellEditable int row int col return col public void setValueAt Object value int row int col Entry entry Entry entries elementAt row if col entry glob String value else entry color Color value fireTableRowsUpdated row row public String getColumnName int index switch index case return jEdit getProperty case return jEdit getProperty default return null public Class getColumnClass int col switch col case return String class case return Color class default throw new InternalError static class Entry String glob Color color Entry String glob Color color this glob glob this color color static class ColorRenderer extends JLabel implements TableCellRenderer public ColorRenderer setOpaque true setBorder SyntaxHiliteOptionPane noFocusBorder public Component getTableCellRendererComponent JTable table Object value boolean isSelected boolean cellHasFocus int row int col if isSelected setBackground table getSelectionBackground setForeground table getSelectionForeground else setBackground table getBackground setForeground table getForeground if value null setBackground Color value setBorder cellHasFocus UIManager getBorder SyntaxHiliteOptionPane noFocusBorder return this public class EditBus public static void addToBus EBComponent comp synchronized components components add comp copyComponents null public static void removeFromBus EBComponent comp synchronized components components remove comp copyComponents null public static EBComponent getComponents synchronized components if copyComponents null copyComponents EBComponent components toArray new EBComponent components size return copyComponents public static void send EBMessage message Log log Log DEBUG EditBus class message toString EBComponent comps getComponents for int comps length try comps handleMessage message catch Throwable Log log Log ERROR EditBus class Log log Log ERROR EditBus class private static ArrayList components new ArrayList private static EBComponent copyComponents private EditBus public class VariableGridLayout implements LayoutManager2 java io Serializable public static final int FIXED_NUM_ROWS public static final int FIXED_NUM_COLUMNS public VariableGridLayout int mode int size int hgap int vgap if mode FIXED_NUM_ROWS mode FIXED_NUM_COLUMNS throw new IllegalArgumentException mode if size throw new IllegalArgumentException size if hgap throw new IllegalArgumentException hgap if vgap throw new IllegalArgumentException vgap this mode mode this size size this hgap hgap this vgap vgap public VariableGridLayout int mode int size this mode size public VariableGridLayout this FIXED_NUM_ROWS public void addLayoutComponent String name Component component public void addLayoutComponent Component component Object constraints public void removeLayoutComponent Component component public float getLayoutAlignmentX Container container return public float getLayoutAlignmentY Container container return public Dimension preferredLayoutSize Container parent return getLayoutSize parent public Dimension minimumLayoutSize Container parent return getLayoutSize parent public Dimension maximumLayoutSize Container parent return getLayoutSize parent public void layoutContainer Container parent synchronized parent getTreeLock int ncomponents parent getComponentCount if ncomponents return int total_height for int nrows for int ncols if ncomponents Dimension parent getComponent getPreferredSize row_heights Math max row_heights height col_widths Math max col_widths width else break total_height row_heights int total_width for int ncols total_width col_widths Dimension parent_size parent getSize Insets insets parent getInsets int free_height parent_size height insets top insets bottom nrows vgap int free_width parent_size width insets left insets right ncols hgap if total_height free_height double dy double free_height double total_height for int nrows row_heights int double row_heights dy if total_width free_width double dx double free_width double total_width for int ncols col_widths int double col_widths dx for int insets top nrows row_heights vgap for int insets left ncols col_widths hgap if ncomponents parent getComponent setBounds col_widths row_heights public void invalidateLayout Container container int ncomponents container getComponentCount int old_nrows nrows int old_ncols ncols if this mode FIXED_NUM_ROWS nrows this size ncols ncomponents nrows nrows else ncols this size nrows ncomponents ncols ncols if old_nrows nrows row_heights new int nrows if old_ncols ncols col_widths new int ncols public int getRows return nrows public int getColumns return ncols public String toString return getClass getName mode size hgap vgap private Dimension getLayoutSize Container parent int which synchronized parent getTreeLock int ncomponents parent getComponentCount int int for int nrows int row_height for int ncols if ncomponents switch which case row_height Math max row_height parent getComponent getMinimumSize height break case row_height Math max row_height parent getComponent getMaximumSize height break default row_height Math max row_height parent getComponent getPreferredSize height break else break row_height for int ncols int col_width for int nrows int ncols if ncomponents switch which case col_width Math max col_width parent getComponent getMinimumSize width break case col_width Math max col_width parent getComponent getMaximumSize width break default col_width Math max col_width parent getComponent getPreferredSize width break else break col_width Insets insets parent getInsets return new Dimension insets left insets right ncols hgap insets top insets bottom nrows vgap private int mode private int size private int hgap private int vgap private transient int nrows private transient int ncols private transient int row_heights null private transient int col_widths null public class GutterOptionPane extends AbstractOptionPane public GutterOptionPane super public void lineNumbersEnabled new JCheckBox jEdit getProperty lineNumbersEnabled setSelected jEdit getBooleanProperty addComponent lineNumbersEnabled gutterFont new FontSelector jEdit getFontProperty new Font Font PLAIN addComponent jEdit getProperty gutterFont addComponent jEdit getProperty gutterForeground new ColorWellButton jEdit getColorProperty GridBagConstraints VERTICAL addComponent jEdit getProperty gutterBackground new ColorWellButton jEdit getColorProperty GridBagConstraints VERTICAL gutterCurrentLineHighlightEnabled new JCheckBox jEdit getProperty gutterCurrentLineHighlightEnabled setSelected jEdit getBooleanProperty addComponent gutterCurrentLineHighlightEnabled gutterCurrentLineHighlight new ColorWellButton jEdit getColorProperty GridBagConstraints VERTICAL gutterHighlightInterval new JTextField jEdit getProperty Box gutterHighlightBox new Box BoxLayout X_AXIS gutterHighlightBox add new JLabel jEdit getProperty gutterHighlightBox add Box createHorizontalStrut gutterHighlightBox add gutterHighlightInterval gutterHighlightBox add Box createHorizontalStrut gutterHighlightBox add new JLabel jEdit getProperty gutterHighlightBox add Box createHorizontalStrut addComponent gutterHighlightBox gutterHighlightColor new ColorWellButton jEdit getColorProperty GridBagConstraints VERTICAL gutterBracketHighlightEnabled new JCheckBox jEdit getProperty gutterBracketHighlightEnabled setSelected jEdit getBooleanProperty addComponent gutterBracketHighlightEnabled gutterBracketHighlight new ColorWellButton jEdit getColorProperty GridBagConstraints VERTICAL gutterMarkerHighlightEnabled new JCheckBox jEdit getProperty gutterMarkerHighlightEnabled setSelected jEdit getBooleanProperty addComponent gutterMarkerHighlightEnabled gutterMarkerHighlight new ColorWellButton jEdit getColorProperty GridBagConstraints VERTICAL addComponent jEdit getProperty gutterFoldMarkers new ColorWellButton jEdit getColorProperty GridBagConstraints VERTICAL addComponent jEdit getProperty gutterFocusBorder new ColorWellButton jEdit getColorProperty GridBagConstraints VERTICAL addComponent jEdit getProperty gutterNoFocusBorder new ColorWellButton jEdit getColorProperty GridBagConstraints VERTICAL addSeparator int clickActionKeys length String clickActionNames new String for int clickActionNames jEdit getProperty clickActionKeys clickModifierKeys length String clickModifierNames new String for int clickModifierNames jEdit getProperty clickModifierKeys gutterClickActions new JComboBox for int JComboBox cb new JComboBox clickActionNames gutterClickActions cb String val jEdit getProperty clickModifierKeys for int clickActionKeys length if val equals clickActionKeys cb setSelectedIndex addComponent clickModifierNames cb public void jEdit setBooleanProperty lineNumbersEnabled isSelected jEdit setFontProperty gutterFont getFont jEdit setColorProperty gutterForeground getSelectedColor jEdit setColorProperty gutterBackground getSelectedColor jEdit setBooleanProperty gutterCurrentLineHighlightEnabled isSelected jEdit setColorProperty gutterCurrentLineHighlight getSelectedColor jEdit setProperty gutterHighlightInterval getText jEdit setColorProperty gutterHighlightColor getSelectedColor jEdit setBooleanProperty gutterBracketHighlightEnabled isSelected jEdit setColorProperty gutterBracketHighlight getSelectedColor jEdit setBooleanProperty gutterMarkerHighlightEnabled isSelected jEdit setColorProperty gutterMarkerHighlight getSelectedColor jEdit setColorProperty gutterFoldMarkers getSelectedColor jEdit setColorProperty gutterFocusBorder getSelectedColor jEdit setColorProperty gutterNoFocusBorder getSelectedColor int clickModifierKeys length for int int idx gutterClickActions getSelectedIndex jEdit setProperty clickModifierKeys clickActionKeys idx private FontSelector gutterFont private ColorWellButton gutterForeground private ColorWellButton gutterBackground private JTextField gutterBorderWidth private JTextField gutterHighlightInterval private ColorWellButton gutterHighlightColor private JComboBox gutterNumberAlignment private JCheckBox lineNumbersEnabled private JCheckBox gutterCurrentLineHighlightEnabled private ColorWellButton gutterCurrentLineHighlight private JCheckBox gutterBracketHighlightEnabled private ColorWellButton gutterBracketHighlight private JCheckBox gutterMarkerHighlightEnabled private ColorWellButton gutterMarkerHighlight private ColorWellButton gutterFoldMarkers private ColorWellButton gutterFocusBorder private ColorWellButton gutterNoFocusBorder private JComboBox gutterClickActions private static final String clickActionKeys new String private static final String clickModifierKeys new String final class RETokenPOSIX extends REToken int type boolean insens boolean negated static final int ALNUM static final int ALPHA static final int BLANK static final int CNTRL static final int DIGIT static final int GRAPH static final int LOWER static final int PRINT static final int PUNCT static final int SPACE static final int UPPER static final int XDIGIT static final String s_nameTable static int intValue String key for int s_nameTable length if s_nameTable equals key return return RETokenPOSIX int subIndex int type boolean insens boolean negated super subIndex this type type this insens insens this negated negated int getMinimumLength return boolean match CharIndexed input REMatch mymatch char ch input charAt mymatch index if ch CharIndexed OUT_OF_BOUNDS return false boolean retval false switch type case ALNUM retval Character isLetterOrDigit ch ch break case ALPHA retval Character isLetter ch break case BLANK retval ch ch break case CNTRL retval Character isISOControl ch break case DIGIT retval Character isDigit ch break case GRAPH retval Character isWhitespace ch Character isISOControl ch break case LOWER retval insens Character isLetter ch Character isLowerCase ch break case PRINT retval Character isWhitespace ch Character isISOControl ch ch break case PUNCT retval indexOf ch break case SPACE retval Character isWhitespace ch break case UPPER retval insens Character isLetter ch Character isUpperCase ch break case XDIGIT retval Character isDigit ch indexOf ch break if negated retval retval if retval mymatch index return next input mymatch else return false void dump StringBuffer os if negated os append os append s_nameTable type public class REFilterInputStream extends FilterInputStream private RE expr private String replace private String buffer private int bufpos private int offset private CharIndexedInputStream stream public REFilterInputStream InputStream stream RE expr String replace super stream this stream new CharIndexedInputStream stream this expr expr this replace replace public int read if buffer null bufpos buffer length return int buffer charAt bufpos if stream isValid return REMatch mymatch new REMatch expr getNumSubs offset if expr match stream mymatch mymatch end mymatch index mymatch finish stream stream move mymatch toString length offset mymatch toString length buffer mymatch substituteInto replace bufpos if buffer length return buffer charAt char ch stream charAt if ch CharIndexed OUT_OF_BOUNDS return stream move offset return ch public boolean markSupported return false public int read byte int off int len int int ok while len read if return ok ok off byte ok return ok public int read byte return read length public class DummyFoldHandler extends FoldHandler public DummyFoldHandler super public int getFoldLevel Buffer buffer int lineIndex Segment seg return public class RecentDirectoriesMenu extends EnhancedMenu public RecentDirectoriesMenu super public void menuSelected MenuEvent evt super menuSelected evt final View view GUIUtilities getView this if getMenuComponentCount removeAll ActionListener actionListener new ActionListener public void actionPerformed ActionEvent evt VFSBrowser browseDirectory view evt getActionCommand view getStatus setMessage null MouseListener mouseListener new MouseAdapter public void mouseEntered MouseEvent evt view getStatus setMessage JMenuItem evt getSource getActionCommand public void mouseExited MouseEvent evt view getStatus setMessage null HistoryModel model HistoryModel getModel if model getSize add GUIUtilities loadMenuItem return boolean sort jEdit getBooleanProperty Vector menuItems new Vector for int model getSize String path model getItem VFS vfs VFSManager getVFSForPath path JMenuItem menuItem new JMenuItem vfs getFileName path menuItem setActionCommand path menuItem addActionListener actionListener menuItem addMouseListener mouseListener menuItem setIcon FileCellRenderer dirIcon if sort menuItems addElement menuItem else add menuItem if sort MiscUtilities quicksort menuItems new MiscUtilities MenuItemCompare for int menuItems size add JMenuItem menuItems elementAt public void menuDeselected MenuEvent public void menuCanceled MenuEvent public class RootElement implements Element public RootElement Buffer buffer this buffer buffer public Document getDocument return null public Element getParentElement return null public String getName return null public AttributeSet getAttributes return null public int getStartOffset return public int getEndOffset return buffer getLength public int getElementIndex int offset return buffer getLineOfOffset offset public int getElementCount return buffer getLineCount public Element getElement int line return new LineElement buffer line public boolean isLeaf return false private Buffer buffer public class StatusBarOptionPane extends AbstractOptionPane public StatusBarOptionPane super protected void statusVisible new JCheckBox jEdit getProperty statusVisible setSelected jEdit getBooleanProperty statusVisible addActionListener new ActionHandler addComponent statusVisible showCaretStatus new JCheckBox jEdit getProperty showCaretStatus setSelected jEdit getBooleanProperty addComponent showCaretStatus showEditMode new JCheckBox jEdit getProperty showEditMode setSelected jEdit getBooleanProperty addComponent showEditMode showFoldMode new JCheckBox jEdit getProperty showFoldMode setSelected jEdit getBooleanProperty addComponent showFoldMode showEncoding new JCheckBox jEdit getProperty showEncoding setSelected jEdit getBooleanProperty addComponent showEncoding showWrap new JCheckBox jEdit getProperty showWrap setSelected jEdit getBooleanProperty addComponent showWrap showMultiSelect new JCheckBox jEdit getProperty showMultiSelect setSelected jEdit getBooleanProperty addComponent showMultiSelect showOverwrite new JCheckBox jEdit getProperty showOverwrite setSelected jEdit getBooleanProperty addComponent showOverwrite showLineSeperator new JCheckBox jEdit getProperty showLineSeperator setSelected jEdit getBooleanProperty addComponent showLineSeperator showMemory new JCheckBox jEdit getProperty showMemory setSelected jEdit getBooleanProperty showMemory addActionListener new ActionHandler addComponent showMemory addComponent jEdit getProperty memForegroundColor new ColorWellButton jEdit getColorProperty GridBagConstraints VERTICAL addComponent jEdit getProperty memBackgroundColor new ColorWellButton jEdit getColorProperty GridBagConstraints VERTICAL updateEnabled protected void jEdit setBooleanProperty statusVisible isSelected jEdit setBooleanProperty showCaretStatus isSelected jEdit setBooleanProperty showEditMode isSelected jEdit setBooleanProperty showFoldMode isSelected jEdit setBooleanProperty showEncoding isSelected jEdit setBooleanProperty showWrap isSelected jEdit setBooleanProperty showMultiSelect isSelected jEdit setBooleanProperty showOverwrite isSelected jEdit setBooleanProperty showLineSeperator isSelected jEdit setBooleanProperty showMemory isSelected jEdit setColorProperty memForegroundColor getSelectedColor jEdit setColorProperty memBackgroundColor getSelectedColor private JCheckBox statusVisible private JCheckBox showCaretStatus private JCheckBox showEditMode private JCheckBox showFoldMode private JCheckBox showEncoding private JCheckBox showWrap private JCheckBox showMultiSelect private JCheckBox showOverwrite private JCheckBox showLineSeperator private JCheckBox showMemory private ColorWellButton memForegroundColor private ColorWellButton memBackgroundColor private void updateEnabled boolean enabled statusVisible isSelected showCaretStatus setEnabled enabled showEditMode setEnabled enabled showFoldMode setEnabled enabled showEncoding setEnabled enabled showWrap setEnabled enabled showMultiSelect setEnabled enabled showOverwrite setEnabled enabled showLineSeperator setEnabled enabled showMemory setEnabled enabled memForegroundColor setEnabled enabled showMemory isSelected memBackgroundColor setEnabled enabled showMemory isSelected class ActionHandler implements ActionListener public void actionPerformed ActionEvent evt updateEnabled final class RETokenAny extends REToken private boolean newline private boolean matchNull RETokenAny int subIndex boolean newline boolean matchNull super subIndex this newline newline this matchNull matchNull int getMinimumLength return boolean match CharIndexed input REMatch mymatch char ch input charAt mymatch index if ch CharIndexed OUT_OF_BOUNDS newline ch matchNull ch return false mymatch index return next input mymatch void dump StringBuffer os os append public class AppearanceOptionPane extends AbstractOptionPane public AppearanceOptionPane super protected void addComponent new JLabel jEdit getProperty lfs UIManager getInstalledLookAndFeels String names new String lfs length String lf UIManager getLookAndFeel getClass getName int index for int names length names lfs getName if lf equals lfs getClassName index lookAndFeel new JComboBox names lookAndFeel setSelectedIndex index lookAndFeel addActionListener new ActionListener public void actionPerformed ActionEvent evt updateEnabled addComponent jEdit getProperty lookAndFeel primaryFont new FontSelector jEdit getFontProperty addComponent jEdit getProperty primaryFont secondaryFont new FontSelector jEdit getFontProperty addComponent jEdit getProperty secondaryFont updateEnabled addSeparator addComponent GUIUtilities createMultilineLabel jEdit getProperty textColors new JCheckBox jEdit getProperty textColors setSelected jEdit getBooleanProperty addComponent textColors decorateFrames new JCheckBox jEdit getProperty decorateFrames setSelected jEdit getBooleanProperty decorateDialogs new JCheckBox jEdit getProperty decorateDialogs setSelected jEdit getBooleanProperty if OperatingSystem hasJava14 addComponent decorateFrames addComponent decorateDialogs protected void String lf lfs lookAndFeel getSelectedIndex getClassName jEdit setProperty lf jEdit setFontProperty primaryFont getFont jEdit setFontProperty secondaryFont getFont jEdit setBooleanProperty textColors isSelected jEdit setBooleanProperty decorateFrames isSelected jEdit setBooleanProperty decorateDialogs isSelected private UIManager LookAndFeelInfo lfs private JComboBox lookAndFeel private FontSelector primaryFont private FontSelector secondaryFont private JCheckBox textColors private JCheckBox decorateFrames private JCheckBox decorateDialogs private void updateEnabled String className lfs lookAndFeel getSelectedIndex getClassName if className equals className equals primaryFont setEnabled true secondaryFont setEnabled true else primaryFont setEnabled false secondaryFont setEnabled false public class RecentFilesMenu extends EnhancedMenu public RecentFilesMenu super public void menuSelected MenuEvent evt super menuSelected evt final View view GUIUtilities getView this if getMenuComponentCount removeAll ActionListener actionListener new ActionListener public void actionPerformed ActionEvent evt jEdit openFile view evt getActionCommand view getStatus setMessage null MouseListener mouseListener new MouseAdapter public void mouseEntered MouseEvent evt view getStatus setMessage JMenuItem evt getSource getActionCommand public void mouseExited MouseEvent evt view getStatus setMessage null Vector recentVector BufferHistory getBufferHistory if recentVector size add GUIUtilities loadMenuItem return Vector menuItems new Vector boolean sort jEdit getBooleanProperty int recentFileCount Math min recentVector size jEdit getIntegerProperty for int recentVector size recentVector size recentFileCount String path BufferHistory Entry recentVector elementAt path VFS vfs VFSManager getVFSForPath path JMenuItem menuItem new JMenuItem vfs getFileName path menuItem setActionCommand path menuItem addActionListener actionListener menuItem addMouseListener mouseListener menuItem setIcon FileCellRenderer fileIcon if sort menuItems addElement menuItem else add menuItem if sort MiscUtilities quicksort menuItems new MiscUtilities MenuItemCompare for int menuItems size add JMenuItem menuItems elementAt public void menuDeselected MenuEvent public void menuCanceled MenuEvent public class VFSManager public static void init int count jEdit getIntegerProperty ioThreadPool new WorkThreadPool count registerVFS FavoritesVFS PROTOCOL new FavoritesVFS if OperatingSystem isDOSDerived OperatingSystem isMacOS registerVFS FileRootsVFS PROTOCOL new FileRootsVFS public static void start ioThreadPool start public static VFS getFileVFS return fileVFS public static VFS getUrlVFS return urlVFS public static VFS getVFSByName String name return VFS vfsHash get name public static VFS getVFSForProtocol String protocol if protocol equals return fileVFS else VFS vfs VFS protocolHash get protocol if vfs null return vfs else return urlVFS public static VFS getVFSForPath String path if MiscUtilities isURL path return getVFSForProtocol MiscUtilities getProtocolOfURL path else return fileVFS public static void registerVFS String protocol VFS vfs Log log Log DEBUG VFSManager class vfs getName protocol vfsHash put vfs getName vfs protocolHash put protocol vfs public static Enumeration getFilesystems return vfsHash elements public static WorkThreadPool getIOThreadPool return ioThreadPool public static void waitForRequests ioThreadPool waitForRequests public static boolean errorOccurred return error public static int getRequestCount return ioThreadPool getRequestCount public static void runInAWTThread Runnable run ioThreadPool addWorkRequest run true public static void runInWorkThread Runnable run ioThreadPool addWorkRequest run false public static void error final Component comp final String error final Object args if SwingUtilities isEventDispatchThread GUIUtilities error comp error args return VFSManager error true runInAWTThread new Runnable public void run VFSManager error false if comp null comp isShowing GUIUtilities error null error args else GUIUtilities error comp error args public static void error Component comp final String path String messageProp Object args final Frame frame JOptionPane getFrameForComponent comp synchronized errorLock error true errors addElement new ErrorListDialog ErrorEntry path messageProp args if errors size final String caption jEdit getProperty errors size new Integer new Integer errors size VFSManager runInAWTThread new Runnable public void run new ErrorListDialog frame isShowing frame jEdit getFirstView jEdit getProperty caption errors false errors removeAllElements error false public static void sendVFSUpdate VFS vfs String path boolean parent if parent sendVFSUpdate vfs vfs getParentOfPath path false sendVFSUpdate vfs path false else if path length path endsWith path endsWith java io File separator path path substring path length synchronized vfsUpdateLock for int vfsUpdates size VFSUpdate msg VFSUpdate vfsUpdates elementAt if msg getPath equals path return vfsUpdates addElement new VFSUpdate path if vfsUpdates size VFSManager runInAWTThread new SendVFSUpdatesSafely static class SendVFSUpdatesSafely implements Runnable public void run synchronized vfsUpdateLock for int vfsUpdates size EditBus send VFSUpdate vfsUpdates elementAt vfsUpdates removeAllElements private static WorkThreadPool ioThreadPool private static VFS fileVFS private static VFS urlVFS private static Hashtable vfsHash private static Hashtable protocolHash private static boolean error private static Object errorLock private static Vector errors private static Object vfsUpdateLock private static Vector vfsUpdates static errorLock new Object errors new Vector fileVFS new FileVFS urlVFS new UrlVFS vfsHash new Hashtable protocolHash new Hashtable vfsUpdateLock new Object vfsUpdates new Vector private VFSManager public class dir static final String months public static String usage return public static void invoke Interpreter env NameSpace namespace String dir invoke env namespace dir public static void invoke Interpreter env NameSpace namespace String dir File file try file env pathToFile dir catch IOException env println return if file exists file canRead env println file return if file isDirectory env println dir String files file list files bubbleSort files for int files length File new File dir File separator files StringBuffer sb new StringBuffer sb append canRead sb append canWrite sb append sb append Date new Date lastModified GregorianCalendar new GregorianCalendar setTime int day get Calendar DAY_OF_MONTH sb append months get Calendar MONTH day if day sb append sb append int fieldlen StringBuffer len new StringBuffer for int fieldlen len append len insert length len setLength fieldlen int si len toString indexOf if si String pad len toString substring si len setLength si len insert pad sb append len toString sb append getName if isDirectory sb append env println sb toString public static String bubbleSort String in Vector new Vector for int in length addElement in int size boolean swap true while swap swap false for int if String elementAt compareTo String elementAt String tmp String elementAt removeElementAt insertElementAt tmp swap true String out new String copyInto out return out public class REException extends Exception private int type private int pos public static final int REG_BADRPT public static final int REG_BADBR public static final int REG_EBRACE public static final int REG_EBRACK public static final int REG_ERANGE public static final int REG_ECTYPE public static final int REG_EPAREN public static final int REG_ESUBREG public static final int REG_EEND public static final int REG_ESCAPE public static final int REG_BADPAT public static final int REG_ESIZE public static final int REG_ESPACE REException String msg int type int position super msg this type type this pos position public int getType return type public int getPosition return pos public String getMessage Object args new Integer pos StringBuffer sb new StringBuffer String prefix RE getLocalizedMessage sb append MessageFormat format prefix args sb append sb append super getMessage return sb toString class BSHLHSPrimaryExpression extends SimpleNode BSHLHSPrimaryExpression int id super id public LHS toLHS CallStack callstack Interpreter interpreter throws EvalError int childNum SimpleNode prefixNode SimpleNode jjtGetChild childNum Object prefixValue null LHS lhs null if prefixNode instanceof BSHAmbiguousName lhs BSHAmbiguousName prefixNode toLHS callstack interpreter else prefixValue SimpleNode prefixNode eval callstack interpreter if prefixValue null lhs BSHLHSPrimarySuffix jjtGetChild childNum doLHSSuffix prefixValue callstack interpreter int numChildren jjtGetNumChildren while childNum numChildren lhs BSHLHSPrimarySuffix jjtGetChild childNum doLHSSuffix lhs getValue callstack interpreter return lhs public class StringUtil public static String split String String delim Vector new Vector StringTokenizer st new StringTokenizer delim while st hasMoreTokens addElement st nextToken String sa new String size copyInto sa return sa public static String bubbleSort String in Vector new Vector for int in length addElement in int size boolean swap true while swap swap false for int if String elementAt compareTo String elementAt String tmp String elementAt removeElementAt insertElementAt tmp swap true String out new String copyInto out return out public static String maxCommonPrefix String one String two int while one regionMatches two return one substring public static String methodString String name Class types StringBuffer sb new StringBuffer name if types length sb append for int types length Class types sb append null getName if types length Class types types length sb append null getName sb append sb append return sb toString class Name implements java io Serializable public NameSpace namespace String value null private boolean literalThisReference private boolean literalCallerReference private void reset evalName value evalBaseObject null callstackDepth literalThisReference false literalCallerReference false public Name NameSpace namespace String this namespace namespace value public Object toObject CallStack callstack Interpreter interpreter throws EvalError return toObject callstack interpreter false synchronized public Object toObject CallStack callstack Interpreter interpreter boolean forceClass throws EvalError reset Object obj null while evalName null obj consumeNextObjectField callstack interpreter forceClass if obj null throw new InterpreterError return obj private Object consumeNextObjectField CallStack callstack Interpreter interpreter boolean forceClass throws EvalError if evalBaseObject null isCompound evalName forceClass Object obj resolveThisFieldReference callstack namespace interpreter evalName false if obj Primitive VOID if evalBaseObject null evalBaseObject instanceof This forceClass String varName prefix evalName if Interpreter DEBUG Interpreter debug varName Object obj if evalBaseObject null obj resolveThisFieldReference callstack namespace interpreter varName false else obj resolveThisFieldReference callstack This evalBaseObject namespace interpreter varName true if obj Primitive VOID if Interpreter DEBUG Interpreter debug varName namespace evalName suffix evalName return evalBaseObject obj if evalBaseObject null if Interpreter DEBUG Interpreter debug evalName Class clas null int for countParts evalName if clas namespace getClass prefix evalName null break if clas null evalName suffix evalName countParts evalName return evalBaseObject new ClassIdentifier clas if Interpreter DEBUG Interpreter debug evalName if evalBaseObject null if isCompound evalName else throw new EvalError evalName throw new TargetError value new NullPointerException throw new EvalError value if evalBaseObject instanceof Primitive throw new EvalError value if evalBaseObject instanceof ClassIdentifier Class clas ClassIdentifier evalBaseObject getTargetClass String field prefix evalName Object obj null try if Interpreter DEBUG Interpreter debug clas field obj Reflect getStaticField clas field catch ReflectError if Interpreter DEBUG Interpreter debug if obj null String iclass clas getName field Class namespace getClass iclass if null obj new ClassIdentifier if obj null throw new EvalError field clas evalName suffix evalName return evalBaseObject obj if forceClass throw new EvalError value String field prefix evalName if field equals evalBaseObject getClass isArray Object obj new Primitive Array getLength evalBaseObject evalName suffix evalName return evalBaseObject obj try Object obj Reflect getObjectField evalBaseObject field evalName suffix evalName return evalBaseObject obj throw new EvalError field evalBaseObject Object resolveThisFieldReference CallStack callstack NameSpace thisNamespace Interpreter interpreter String varName boolean specialFieldsVisible throws EvalError Object obj null boolean wasThis false wasCaller false if varName equals if specialFieldsVisible throw new EvalError obj thisNamespace getThis interpreter wasThis true if obj null if varName equals obj thisNamespace getSuper getThis interpreter else if varName equals obj thisNamespace getGlobal getThis interpreter if obj null specialFieldsVisible if varName equals obj thisNamespace else if varName equals obj thisNamespace getVariableNames else if varName equals obj thisNamespace getMethodNames else if varName equals if literalThisReference obj interpreter else throw new EvalError if obj null specialFieldsVisible varName equals if literalThisReference literalCallerReference if callstack null throw new InterpreterError obj callstack get callstackDepth getThis interpreter else throw new EvalError wasCaller true if obj null specialFieldsVisible varName equals if literalThisReference if callstack null throw new InterpreterError obj callstack else throw new EvalError if obj null obj thisNamespace getVariable varName literalThisReference wasThis literalCallerReference wasCaller return obj synchronized public Class toClass throws EvalError reset Class clas namespace getClass evalName if clas null Object obj null try obj toObject null null true if obj instanceof ClassIdentifier clas ClassIdentifier obj getTargetClass if clas null throw new EvalError value return clas synchronized public LHS toLHS CallStack callstack Interpreter interpreter throws EvalError reset if isCompound evalName return new LHS namespace evalName Object obj null try while isCompound evalName obj consumeNextObjectField callstack interpreter false catch EvalError throw new EvalError if obj null throw new InterpreterError if obj instanceof This Interpreter debug return new LHS This obj namespace evalName if evalName null try if obj instanceof ClassIdentifier Class clas ClassIdentifier obj getTargetClass return Reflect getLHSStaticField clas evalName else return Reflect getLHSObjectField obj evalName catch ReflectError throw new EvalError throw new InterpreterError private BshMethod toLocalMethod Object args Class sig Reflect getTypes args return namespace getMethod value sig public Object invokeMethod Interpreter interpreter Object args CallStack callstack SimpleNode callerInfo throws EvalError ReflectError InvocationTargetException if Name isCompound value return invokeLocalMethod interpreter args callstack callerInfo Name targetName namespace getNameResolver Name prefix value String methodName Name suffix value Object obj targetName toObject callstack interpreter if obj Primitive VOID throw new EvalError methodName targetName if obj instanceof Name ClassIdentifier if obj instanceof Primitive if obj Primitive NULL throw new TargetError new NullPointerException interpreter error return Reflect invokeObjectMethod interpreter obj methodName args callerInfo if Interpreter DEBUG Interpreter debug targetName Class clas Name ClassIdentifier obj getTargetClass if clas null return Reflect invokeStaticMethod clas methodName args throw new EvalError targetName public Object invokeLocalMethod Interpreter interpreter Object args CallStack callstack SimpleNode callerInfo throws EvalError ReflectError InvocationTargetException if Interpreter DEBUG Interpreter debug value BshMethod meth toLocalMethod args if meth null return meth invokeDeclaredMethod args interpreter callstack callerInfo else if Interpreter DEBUG Interpreter debug value String commandName value InputStream in Interpreter class getResourceAsStream commandName if in null if Interpreter DEBUG Interpreter debug commandName if interpreter null throw new InterpreterError interpreter eval new InputStreamReader in namespace commandName meth toLocalMethod args if meth null return meth invokeDeclaredMethod args interpreter callstack callerInfo else throw new EvalError commandName commandName value Class BshClassManager classForName commandName if null throw new EvalError value Object invokeArgs new Object args length invokeArgs interpreter invokeArgs namespace System arraycopy args invokeArgs args length try return Reflect invokeStaticMethod invokeArgs catch ReflectError if Interpreter DEBUG Interpreter debug try String String Reflect invokeStaticMethod null interpreter println return Primitive VOID catch ReflectError if Interpreter DEBUG Interpreter debug throw new EvalError static boolean isCompound String value return countParts value static int countParts String value if value null return int count int index while index value indexOf index count return count static String prefix String value if isCompound value return null return prefix value countParts value static String prefix String value int parts if parts return null int count int index while index value indexOf index count parts return index value value substring index static String suffix String name if isCompound name return null return suffix name countParts name public static String suffix String value int parts if parts return null int count int index value length while index value lastIndexOf index count parts return index value value substring index public String toString return value static class ClassIdentifier Class clas public ClassIdentifier Class clas this clas clas public Class getTargetClass return clas public String toString return clas getName final class RETokenChar extends REToken private char ch private boolean insens RETokenChar int subIndex char boolean ins super subIndex ch new char ch insens ins Character toLowerCase int getMinimumLength return ch length boolean match CharIndexed input REMatch mymatch int ch length char for int input charAt mymatch index if insens Character toLowerCase ch return false mymatch index return next input mymatch boolean chain REToken next if next instanceof RETokenChar RETokenChar cnext RETokenChar next int newsize ch length cnext ch length char chTemp new char newsize System arraycopy ch chTemp ch length System arraycopy cnext ch chTemp ch length cnext ch length ch chTemp return false else return super chain next void dump StringBuffer os os append ch public class ErrorListDialog extends EnhancedDialog public static class ErrorEntry String path String messages public ErrorEntry String path String messageProp Object args this path path String message jEdit getProperty messageProp args if message null message messageProp Log log Log ERROR this path Log log Log ERROR this message Vector tokenizedMessage new Vector int lastIndex for int message length if message charAt tokenizedMessage addElement message substring lastIndex lastIndex if lastIndex message length tokenizedMessage addElement message substring lastIndex messages new String tokenizedMessage size tokenizedMessage copyInto messages public ErrorListDialog Frame frame String title String caption Vector messages boolean showPluginMgrButton super frame title true JPanel content new JPanel new BorderLayout content setBorder new EmptyBorder setContentPane content Box iconBox new Box BoxLayout Y_AXIS iconBox add new JLabel UIManager getIcon iconBox add Box createGlue content add BorderLayout WEST iconBox JPanel centerPanel new JPanel new BorderLayout JLabel label new JLabel caption label setBorder new EmptyBorder centerPanel add BorderLayout NORTH label JList errors new JList messages errors setCellRenderer new ErrorListCellRenderer errors setVisibleRowCount Math min messages size JScrollPane scrollPane new JScrollPane errors JScrollPane VERTICAL_SCROLLBAR_ALWAYS JScrollPane HORIZONTAL_SCROLLBAR_ALWAYS Dimension size scrollPane getPreferredSize size width Math min size width scrollPane setPreferredSize size centerPanel add BorderLayout CENTER scrollPane content add BorderLayout CENTER centerPanel Box buttons new Box BoxLayout X_AXIS buttons add Box createGlue ok new JButton jEdit getProperty ok addActionListener new ActionHandler if showPluginMgrButton pluginMgr new JButton jEdit getProperty pluginMgr addActionListener new ActionHandler buttons add pluginMgr buttons add Box createHorizontalStrut buttons add ok buttons add Box createGlue content add BorderLayout SOUTH buttons getRootPane setDefaultButton ok pack setLocationRelativeTo frame show public void ok dispose public void cancel dispose private JButton ok pluginMgr class ActionHandler implements ActionListener public void actionPerformed ActionEvent evt if evt getSource ok dispose else if evt getSource pluginMgr new org gjt sp jedit pluginmgr PluginManager JOptionPane getFrameForComponent ErrorListDialog this public class REFilterReader extends FilterReader private RE expr private String replace private String buffer private int bufpos private int offset private CharIndexedReader stream public REFilterReader Reader stream RE expr String replace super stream this stream new CharIndexedReader stream this expr expr this replace replace public int read if buffer null bufpos buffer length return int buffer charAt bufpos if stream isValid return REMatch mymatch new REMatch expr getNumSubs offset if expr match stream mymatch mymatch end mymatch index mymatch finish stream stream move mymatch toString length offset mymatch toString length buffer mymatch substituteInto replace bufpos if buffer length return buffer charAt char ch stream charAt if ch CharIndexed OUT_OF_BOUNDS return stream move offset return ch public boolean markSupported return false public int read char int off int len int int ok while len read if return ok ok off char ok return ok public int read char return read length public interface XmlHandler public void startDocument throws java lang Exception public void endDocument throws java lang Exception public Object resolveEntity String publicId String systemId throws java lang Exception public void startExternalEntity String systemId throws java lang Exception public void endExternalEntity String systemId throws java lang Exception public void doctypeDecl String name String publicId String systemId throws java lang Exception public void attribute String aname String value boolean isSpecified throws java lang Exception public void startElement String elname throws java lang Exception public void endElement String elname throws java lang Exception public void charData char ch int start int length throws java lang Exception public void ignorableWhitespace char ch int start int length throws java lang Exception public void processingInstruction String target String data throws java lang Exception public void error String message String systemId int line int column throws java lang Exception public class EnhancedMenuItem extends JMenuItem public EnhancedMenuItem String label EditAction action super label this action action if action null setEnabled true addActionListener new EditAction Wrapper action shortcutProp1 action getName shortcutProp2 action getName addMouseListener new MouseHandler else setEnabled false public Dimension getPreferredSize Dimension super getPreferredSize String shortcut getShortcut if shortcut null width getFontMetrics acceleratorFont stringWidth shortcut return public void paint Graphics super paint String shortcut getShortcut if shortcut null setFont acceleratorFont setColor getModel isArmed acceleratorSelectionForeground acceleratorForeground FontMetrics fm getFontMetrics Insets insets getInsets drawString shortcut getWidth fm stringWidth shortcut insets right insets left getFont getSize insets top OperatingSystem isMacOSLF private String shortcutProp1 private String shortcutProp2 private EditAction action private static Font acceleratorFont private static Color acceleratorForeground private static Color acceleratorSelectionForeground private String getShortcut if action null return null else String shortcut1 jEdit getProperty shortcutProp1 String shortcut2 jEdit getProperty shortcutProp2 if shortcut1 null shortcut1 length if shortcut2 null shortcut2 length return null else return shortcut2 else if shortcut2 null shortcut2 length return shortcut1 else return shortcut1 shortcut2 static String shortcutFont if OperatingSystem isMacOSLF shortcutFont else shortcutFont acceleratorFont UIManager getFont acceleratorFont new Font shortcutFont acceleratorFont getStyle acceleratorFont getSize acceleratorForeground UIManager getColor acceleratorSelectionForeground UIManager getColor class MouseHandler extends MouseAdapter public void mouseReleased MouseEvent evt GUIUtilities getView Component evt getSource getStatus setMessage null public void mouseEntered MouseEvent evt String msg action getMouseOverText if msg null GUIUtilities getView Component evt getSource getStatus setMessage msg public void mouseExited MouseEvent evt GUIUtilities getView Component evt getSource getStatus setMessage null public class ParserRule public static final int MAJOR_ACTIONS public static final int SEQ public static final int SPAN public static final int MARK_PREVIOUS public static final int MARK_FOLLOWING public static final int EOL_SPAN public static final int ACTION_HINTS public static final int EXCLUDE_MATCH public static final int AT_LINE_START public static final int AT_WHITESPACE_END public static final int AT_WORD_START public static final int NO_LINE_BREAK public static final int NO_WORD_BREAK public static final int IS_ESCAPE public static final int REGEXP public final char hashChar public final char start public final RE startRegexp public final char end public final int action public final byte token public ParserRule next public ParserRuleSet getDelegateRuleSet TokenMarker tokenMarker if delegate null if action MAJOR_ACTIONS SEQ return null else return ParserRuleSet getStandardRuleSet token else ParserRuleSet delegateSet tokenMarker getRuleSet delegate if delegateSet null return ParserRuleSet getStandardRuleSet Token NULL else return delegateSet public static final ParserRule createSequenceRule String seq String delegate byte id boolean atLineStart boolean atWhitespaceEnd boolean atWordStart int ruleAction SEQ atLineStart AT_LINE_START atWhitespaceEnd AT_WHITESPACE_END atWordStart AT_WORD_START return new ParserRule ruleAction seq charAt seq toCharArray null null delegate id public static final ParserRule createRegexpSequenceRule char hashChar String seq String delegate byte id boolean atLineStart boolean atWhitespaceEnd boolean atWordStart boolean ignoreCase throws REException int ruleAction SEQ REGEXP atLineStart AT_LINE_START atWhitespaceEnd AT_WHITESPACE_END atWordStart AT_WORD_START return new ParserRule ruleAction hashChar null new RE seq ignoreCase RE REG_ICASE RESearchMatcher RE_SYNTAX_JEDIT null delegate id public static final ParserRule createSpanRule String begin String end String delegate byte id boolean noLineBreak boolean atLineStart boolean atWhitespaceEnd boolean atWordStart boolean excludeMatch boolean noWordBreak int ruleAction SPAN noLineBreak NO_LINE_BREAK atLineStart AT_LINE_START atWhitespaceEnd AT_WHITESPACE_END atWordStart AT_WORD_START excludeMatch EXCLUDE_MATCH noWordBreak NO_WORD_BREAK return new ParserRule ruleAction begin charAt begin toCharArray null end toCharArray delegate id public static final ParserRule createRegexpSpanRule char hashChar String begin String end String delegate byte id boolean noLineBreak boolean atLineStart boolean atWhitespaceEnd boolean atWordStart boolean excludeMatch boolean noWordBreak boolean ignoreCase throws REException int ruleAction SPAN REGEXP noLineBreak NO_LINE_BREAK atLineStart AT_LINE_START atWhitespaceEnd AT_WHITESPACE_END atWordStart AT_WORD_START excludeMatch EXCLUDE_MATCH noWordBreak NO_WORD_BREAK return new ParserRule ruleAction hashChar null new RE begin ignoreCase RE REG_ICASE RESearchMatcher RE_SYNTAX_JEDIT end toCharArray delegate id public static final ParserRule createEOLSpanRule String seq String delegate byte id boolean atLineStart boolean atWhitespaceEnd boolean atWordStart boolean excludeMatch int ruleAction EOL_SPAN atLineStart AT_LINE_START atWhitespaceEnd AT_WHITESPACE_END atWordStart AT_WORD_START excludeMatch EXCLUDE_MATCH NO_LINE_BREAK return new ParserRule ruleAction seq charAt seq toCharArray null null delegate id public static final ParserRule createRegexpEOLSpanRule char hashChar String seq String delegate byte id boolean atLineStart boolean atWhitespaceEnd boolean atWordStart boolean excludeMatch boolean ignoreCase throws REException int ruleAction EOL_SPAN REGEXP atLineStart AT_LINE_START atWhitespaceEnd AT_WHITESPACE_END atWordStart AT_WORD_START excludeMatch EXCLUDE_MATCH NO_LINE_BREAK return new ParserRule ruleAction hashChar null new RE seq ignoreCase RE REG_ICASE RESearchMatcher RE_SYNTAX_JEDIT null delegate id public static final ParserRule createMarkFollowingRule String seq byte id boolean atLineStart boolean atWhitespaceEnd boolean atWordStart boolean excludeMatch int ruleAction MARK_FOLLOWING atLineStart AT_LINE_START atWhitespaceEnd AT_WHITESPACE_END atWordStart AT_WORD_START excludeMatch EXCLUDE_MATCH return new ParserRule ruleAction seq charAt seq toCharArray null null null id public static final ParserRule createMarkPreviousRule String seq byte id boolean atLineStart boolean atWhitespaceEnd boolean atWordStart boolean excludeMatch int ruleAction MARK_PREVIOUS atLineStart AT_LINE_START atWhitespaceEnd AT_WHITESPACE_END atWordStart AT_WORD_START excludeMatch EXCLUDE_MATCH return new ParserRule ruleAction seq charAt seq toCharArray null null null id public static final ParserRule createEscapeRule String seq int ruleAction IS_ESCAPE return new ParserRule ruleAction seq charAt seq toCharArray null null null Token NULL private String delegate private ParserRule int action char hashChar char start RE startRegexp char end String delegate byte token this hashChar hashChar this start start this startRegexp startRegexp this end end this delegate delegate this action action this token token public class SplashScreen extends Canvas public SplashScreen setCursor Cursor getPredefinedCursor Cursor WAIT_CURSOR setBackground Color white Font font new Font Font PLAIN setFont font fm getFontMetrics font image getToolkit getImage getClass getResource MediaTracker tracker new MediaTracker this tracker addImage image try tracker waitForAll catch Exception Log log Log ERROR this win new Window new Frame Dimension screen getToolkit getScreenSize Dimension size new Dimension image getWidth this image getHeight this PROGRESS_HEIGHT win setSize size win setLayout new BorderLayout win add BorderLayout CENTER this win setLocation screen width size width screen height size height win validate win show public void dispose win dispose public synchronized void advance progress repaint try wait catch InterruptedException ie Log log Log ERROR this ie public void update Graphics paint public synchronized void paint Graphics Dimension size getSize if offscreenImg null offscreenImg createImage size width size height offscreenGfx offscreenImg getGraphics offscreenGfx setFont getFont offscreenGfx setColor Color gray offscreenGfx drawRect size width size height offscreenGfx drawImage image this offscreenGfx setColor new Color offscreenGfx fillRect image getHeight this win getWidth progress PROGRESS_HEIGHT offscreenGfx setColor Color gray String str jEdit getVersion offscreenGfx drawString str getWidth fm stringWidth str image getHeight this fm getDescent drawImage offscreenImg this notify private FontMetrics fm private Window win private Image image private Image offscreenImg private Graphics offscreenGfx private int progress private static final int PROGRESS_HEIGHT public class ViewRegisters extends EnhancedDialog public ViewRegisters View view super view jEdit getProperty true JPanel content new JPanel new BorderLayout content setBorder new EmptyBorder setContentPane content JPanel panel new JPanel new BorderLayout panel setBorder new EmptyBorder JLabel label new JLabel jEdit getProperty label setBorder new EmptyBorder panel add BorderLayout NORTH label DefaultListModel registerModel new DefaultListModel registerList new JList registerModel registerList setSelectionMode ListSelectionModel SINGLE_SELECTION registerList setCellRenderer new Renderer Registers Register registers Registers getRegisters int index for int registers length Registers Register reg registers if reg null continue String value reg toString if value null value length continue registerModel addElement new Character char if registerModel getSize registerModel addElement jEdit getProperty panel add BorderLayout CENTER new JScrollPane registerList content add BorderLayout WEST panel panel new JPanel new BorderLayout panel setBorder new EmptyBorder label new JLabel jEdit getProperty label setBorder new EmptyBorder panel add BorderLayout NORTH label contentTextArea new JTextArea contentTextArea setEditable false panel add BorderLayout CENTER new JScrollPane contentTextArea content add BorderLayout CENTER panel panel new JPanel panel setLayout new BoxLayout panel BoxLayout X_AXIS panel setBorder new EmptyBorder close new JButton jEdit getProperty close addActionListener new ActionHandler panel add Box createGlue panel add close panel add Box createGlue getRootPane setDefaultButton close content add BorderLayout SOUTH panel registerList addListSelectionListener new ListHandler registerList setSelectedIndex index pack setLocationRelativeTo view show public void ok dispose public void cancel dispose private JList registerList private JTextArea contentTextArea private JButton close class Renderer extends DefaultListCellRenderer public Component getListCellRendererComponent JList list Object value int index boolean isSelected boolean cellHasFocus super getListCellRendererComponent list value index isSelected cellHasFocus if value instanceof Character char name Character value charValue String label if name label else if name label else if name label jEdit getProperty else if name label jEdit getProperty else label String valueOf char name setText label return this class ActionHandler implements ActionListener public void actionPerformed ActionEvent evt if evt getSource close cancel class ListHandler implements ListSelectionListener public void valueChanged ListSelectionEvent evt Object value registerList getSelectedValue if value instanceof Character return char name Character value charValue Registers Register reg Registers getRegister name if reg null return contentTextArea setText reg toString contentTextArea setCaretPosition public class BrowserCommandsMenu extends JPopupMenu public BrowserCommandsMenu VFSBrowser browser VFS DirectoryEntry files this browser browser if files null this files files VFS vfs VFSManager getVFSForPath files deletePath int type files type boolean fileOpen jEdit getBuffer files path null boolean delete fileOpen vfs getCapabilities VFS DELETE_CAP boolean rename fileOpen vfs getCapabilities VFS RENAME_CAP for int files length VFS DirectoryEntry file files VFS VFSManager getVFSForPath file deletePath delete vfs getCapabilities VFS DELETE_CAP if type file type else type rename false if jEdit getBuffer file path null fileOpen true if type VFS DirectoryEntry DIRECTORY type VFS DirectoryEntry FILESYSTEM if files length add createMenuItem if browser getMode VFSBrowser BROWSER add createMenuItem else if type VFS DirectoryEntry FILE browser getMode VFSBrowser BROWSER browser getMode VFSBrowser BROWSER_DIALOG add createMenuItem JMenu openIn new JMenu jEdit getProperty openIn add createMenuItem openIn add createMenuItem openIn add createMenuItem add openIn add createMenuItem if fileOpen add createMenuItem else if type add createMenuItem if rename add createMenuItem if delete add createMenuItem addSeparator add createMenuItem add createMenuItem add createMenuItem add createMenuItem add createMenuItem addSeparator if browser getMode VFSBrowser BROWSER add createMenuItem add createMenuItem if browser getMode VFSBrowser BROWSER addSeparator add createMenuItem addSeparator showHiddenFiles new JCheckBoxMenuItem jEdit getProperty showHiddenFiles setActionCommand showHiddenFiles addActionListener new ActionHandler add showHiddenFiles if browser getMode VFSBrowser BROWSER browser getMode VFSBrowser BROWSER_DIALOG addSeparator add createEncodingMenu update public void update showHiddenFiles setSelected browser getShowHiddenFiles if encodingMenuItems null JRadioButtonMenuItem mi JRadioButtonMenuItem encodingMenuItems get browser currentEncoding if mi null mi setSelected true otherEncoding setText jEdit getProperty else otherEncoding setSelected true otherEncoding setText jEdit getProperty new String browser currentEncoding private VFSBrowser browser private VFS DirectoryEntry files private VFS vfs private JCheckBoxMenuItem showHiddenFiles private HashMap encodingMenuItems private JRadioButtonMenuItem defaultEncoding private JRadioButtonMenuItem otherEncoding private JMenuItem createMenuItem String name String label jEdit getProperty name JMenuItem mi new JMenuItem label mi setActionCommand name mi addActionListener new ActionHandler return mi private JMenu createEncodingMenu ActionHandler actionHandler new ActionHandler encodingMenuItems new HashMap JMenu encodingMenu new JMenu jEdit getProperty ButtonGroup grp new ButtonGroup StringTokenizer st new StringTokenizer jEdit getProperty while st hasMoreTokens String encoding st nextToken JRadioButtonMenuItem mi new JRadioButtonMenuItem encoding mi setActionCommand encoding mi addActionListener actionHandler grp add mi encodingMenuItems put encoding mi encodingMenu add mi String systemEncoding System getProperty if encodingMenuItems get systemEncoding null JRadioButtonMenuItem mi new JRadioButtonMenuItem systemEncoding mi setActionCommand systemEncoding mi addActionListener actionHandler grp add mi encodingMenuItems put systemEncoding mi encodingMenu add mi encodingMenu addSeparator otherEncoding new JRadioButtonMenuItem otherEncoding setActionCommand otherEncoding addActionListener actionHandler grp add otherEncoding encodingMenu add otherEncoding return encodingMenu class ActionHandler implements ActionListener public void actionPerformed ActionEvent evt View view browser getView String actionCommand evt getActionCommand if actionCommand equals String encoding GUIUtilities input browser null jEdit getProperty System getProperty if encoding null return browser currentEncoding encoding else if actionCommand startsWith browser currentEncoding actionCommand substring else if actionCommand equals browser filesActivated VFSBrowser M_OPEN false else if actionCommand equals browser filesActivated VFSBrowser M_OPEN_NEW_VIEW false else if actionCommand equals browser filesActivated VFSBrowser M_OPEN_NEW_PLAIN_VIEW false else if actionCommand equals browser filesActivated VFSBrowser M_OPEN_NEW_SPLIT false else if actionCommand equals for int files length view getBuffer insertFile view files path else if actionCommand equals browser filesActivated VFSBrowser M_OPEN false else if actionCommand equals for int files length Buffer buffer jEdit getBuffer files path if buffer null jEdit closeBuffer view buffer else if actionCommand equals browser setDirectory files path else if actionCommand equals for int files length VFSBrowser browseDirectoryInNewWindow view files path else if actionCommand equals browser rename files path else if actionCommand equals browser delete files else if actionCommand equals String path browser getDirectory VFS vfs VFSManager getVFSForPath path browser setDirectory vfs getParentOfPath path else if actionCommand equals browser reloadDirectory else if actionCommand equals browser rootDirectory else if actionCommand equals browser setDirectory System getProperty else if actionCommand equals Buffer buffer browser getView getBuffer browser setDirectory buffer getDirectory else if actionCommand equals browser newFile else if actionCommand equals browser mkdir else if actionCommand equals browser searchInDirectory else if actionCommand equals browser setShowHiddenFiles browser getShowHiddenFiles browser reloadDirectory public class EnhancedMenu extends JMenu implements MenuListener public EnhancedMenu String name this name String label jEdit getProperty name concat if label null label name char mnemonic int index label indexOf if index label length index mnemonic Character toLowerCase label charAt index label label substring index concat label substring index else mnemonic setText label if OperatingSystem isMacOS setMnemonic mnemonic addMenuListener this public void menuSelected MenuEvent evt init public void menuDeselected MenuEvent public void menuCanceled MenuEvent public void init if initialized return initialized true String menuItems jEdit getProperty if menuItems null StringTokenizer st new StringTokenizer menuItems while st hasMoreTokens String menuItemName st nextToken if menuItemName equals addSeparator else if menuItemName startsWith add GUIUtilities loadMenu menuItemName substring else add GUIUtilities loadMenuItem menuItemName protected String protected boolean initialized public class Capabilities private static boolean accessibility false public static boolean haveSwing return classExists public static boolean canGenerateInterfaces return classExists public static boolean haveAccessibility return accessibility classExists classExists public static void setAccessibility boolean accessibility private static Hashtable classes new Hashtable public static boolean classExists String name Object classes get name if null try Class forName name catch ClassNotFoundException if null classes put return null public static class Unavailable extends RuntimeException public Unavailable String super class BSHMethodDeclaration extends SimpleNode String name BSHFormalParameters params BSHBlock block BSHMethodDeclaration int id super id public Object eval NameSpace namespace throws EvalError if block null if jjtGetNumChildren returnType BSHReturnType jjtGetChild getReturnType namespace params BSHFormalParameters jjtGetChild block BSHBlock jjtGetChild else params BSHFormalParameters jjtGetChild block BSHBlock jjtGetChild params eval namespace if Interpreter strictJava for int params argTypes length if params argTypes null throw new EvalError params argNames name this if returnType null throw new EvalError name this namespace setMethod name new BshMethod this namespace return Primitive VOID public String toString return name public class GlobalOptions extends OptionsDialog public GlobalOptions Frame frame super frame jEdit getProperty public GlobalOptions Frame frame String pane super frame pane public GlobalOptions Dialog dialog super dialog jEdit getProperty public GlobalOptions Dialog dialog String pane super dialog pane protected OptionTreeModel createOptionTreeModel OptionTreeModel paneTreeModel new OptionTreeModel OptionGroup rootGroup OptionGroup paneTreeModel getRoot jEditGroup new OptionGroup addOptionPane new AbbrevsOptionPane jEditGroup addOptionPane new AppearanceOptionPane jEditGroup addOptionPane new ContextOptionPane jEditGroup addOptionPane new DockingOptionPane jEditGroup addOptionPane new EditingOptionPane jEditGroup addOptionPane new GeneralOptionPane jEditGroup addOptionPane new GutterOptionPane jEditGroup addOptionPane new LoadSaveOptionPane jEditGroup addOptionPane new PrintOptionPane jEditGroup addOptionPane new FirewallOptionPane jEditGroup addOptionPane new ShortcutsOptionPane jEditGroup addOptionPane new StatusBarOptionPane jEditGroup addOptionPane new SyntaxHiliteOptionPane jEditGroup addOptionPane new TextAreaOptionPane jEditGroup addOptionPane new ToolBarOptionPane jEditGroup addOptionGroup jEditGroup rootGroup browserGroup new OptionGroup addOptionPane new BrowserColorsOptionPane browserGroup addOptionPane new BrowserOptionPane browserGroup addOptionGroup browserGroup rootGroup pluginsGroup new OptionGroup EditPlugin plugins jEdit getPlugins for int plugins length EditPlugin ep plugins try ep createOptionPanes this catch Throwable Log log Log ERROR ep Log log Log ERROR ep if pluginsGroup getMemberCount addOptionGroup pluginsGroup rootGroup return paneTreeModel protected OptionGroup getDefaultGroup return pluginsGroup private OptionGroup jEditGroup private OptionGroup browserGroup private OptionGroup pluginsGroup public interface SearchMatcher int nextMatch CharIndexed text boolean start boolean end boolean firstTime boolean reverse String substitute String text throws Exception class ParseException extends EvalError String sourceFile public ParseException Token currentTokenVal int expectedTokenSequencesVal String tokenImageVal this specialConstructor true currentToken currentTokenVal expectedTokenSequences expectedTokenSequencesVal tokenImage tokenImageVal public ParseException this specialConstructor false public ParseException String message super message specialConstructor false protected boolean specialConstructor public Token currentToken public int expectedTokenSequences public String tokenImage public String getMessage return getMessage false public String getMessage boolean debug if specialConstructor return super getMessage String expected int maxSize for int expectedTokenSequences length if maxSize expectedTokenSequences length maxSize expectedTokenSequences length for int expectedTokenSequences length expected tokenImage expectedTokenSequences if expectedTokenSequences expectedTokenSequences length expected expected eol String retval sourceFile Token tok currentToken next for int maxSize if retval if tok kind retval tokenImage break retval add_escapes tok image tok tok next retval currentToken next beginLine currentToken next beginColumn eol if debug if expectedTokenSequences length retval eol else retval eol retval expected return retval protected String eol System getProperty protected String add_escapes String str StringBuffer retval new StringBuffer char ch for int str length switch str charAt case continue case retval append continue case retval append continue case retval append continue case retval append continue case retval append continue case retval append continue case retval append continue case retval append continue default if ch str charAt ch String Integer toString ch retval append substring length length else retval append ch continue return retval toString public String getErrorText int maxSize for int expectedTokenSequences length if maxSize expectedTokenSequences length maxSize expectedTokenSequences length String retval Token tok currentToken next for int maxSize if retval if tok kind retval tokenImage break retval add_escapes tok image tok tok next return retval public int getErrorLineNumber return currentToken next beginLine public String getErrorSourceFile return sourceFile public void setErrorSourceFile String file this sourceFile file public String toString return getMessage class Token implements java io Serializable public int kind public int beginLine beginColumn endLine endColumn public String image public Token next public Token specialToken public final String toString return image public static final Token newToken int ofKind switch ofKind default return new Token class JThis extends This implements ActionListener AdjustmentListener ComponentListener ContainerListener FocusListener ItemListener KeyListener MouseListener MouseMotionListener TextListener WindowListener PropertyChangeListener AncestorListener CaretListener CellEditorListener ChangeListener DocumentListener HyperlinkListener InternalFrameListener ListDataListener ListSelectionListener MenuDragMouseListener MenuKeyListener MenuListener MouseInputListener PopupMenuListener TableColumnModelListener TableModelListener TreeExpansionListener TreeModelListener TreeSelectionListener TreeWillExpandListener UndoableEditListener JThis NameSpace namespace Interpreter declaringInterp super namespace declaringInterp public String toString return namespace name void event String name Object event CallStack callstack newCallStack BshMethod method method namespace getMethod new Class null if method null try method invokeDeclaredMethod new Object event declaringInterpreter callstack null catch EvalError declaringInterpreter error method namespace getMethod name new Class null if method null try method invokeDeclaredMethod new Object event declaringInterpreter callstack null catch EvalError declaringInterpreter error public void ancestorAdded AncestorEvent event public void ancestorRemoved AncestorEvent event public void ancestorMoved AncestorEvent event public void caretUpdate CaretEvent event public void editingStopped ChangeEvent event public void editingCanceled ChangeEvent event public void stateChanged ChangeEvent event public void insertUpdate DocumentEvent event public void removeUpdate DocumentEvent event public void changedUpdate DocumentEvent event public void hyperlinkUpdate HyperlinkEvent event public void internalFrameOpened InternalFrameEvent event public void internalFrameClosing InternalFrameEvent event public void internalFrameClosed InternalFrameEvent event public void internalFrameIconified InternalFrameEvent event public void internalFrameDeiconified InternalFrameEvent event public void internalFrameActivated InternalFrameEvent event public void internalFrameDeactivated InternalFrameEvent event public void intervalAdded ListDataEvent event public void intervalRemoved ListDataEvent event public void contentsChanged ListDataEvent event public void valueChanged ListSelectionEvent event public void menuDragMouseEntered MenuDragMouseEvent event public void menuDragMouseExited MenuDragMouseEvent event public void menuDragMouseDragged MenuDragMouseEvent event public void menuDragMouseReleased MenuDragMouseEvent event public void menuKeyTyped MenuKeyEvent event public void menuKeyPressed MenuKeyEvent event public void menuKeyReleased MenuKeyEvent event public void menuSelected MenuEvent event public void menuDeselected MenuEvent event public void menuCanceled MenuEvent event public void popupMenuWillBecomeVisible PopupMenuEvent event public void popupMenuWillBecomeInvisible PopupMenuEvent event public void popupMenuCanceled PopupMenuEvent event public void columnAdded TableColumnModelEvent event public void columnRemoved TableColumnModelEvent event public void columnMoved TableColumnModelEvent event public void columnMarginChanged ChangeEvent event public void columnSelectionChanged ListSelectionEvent event public void tableChanged TableModelEvent event public void treeExpanded TreeExpansionEvent event public void treeCollapsed TreeExpansionEvent event public void treeNodesChanged TreeModelEvent event public void treeNodesInserted TreeModelEvent event public void treeNodesRemoved TreeModelEvent event public void treeStructureChanged TreeModelEvent event public void valueChanged TreeSelectionEvent event public void treeWillExpand TreeExpansionEvent event public void treeWillCollapse TreeExpansionEvent event public void undoableEditHappened UndoableEditEvent event public void actionPerformed ActionEvent event public void adjustmentValueChanged AdjustmentEvent event public void componentResized ComponentEvent event public void componentMoved ComponentEvent event public void componentShown ComponentEvent event public void componentHidden ComponentEvent event public void componentAdded ContainerEvent event public void componentRemoved ContainerEvent event public void focusGained FocusEvent event public void focusLost FocusEvent event public void itemStateChanged ItemEvent event public void keyTyped KeyEvent event public void keyPressed KeyEvent event public void keyReleased KeyEvent event public void mouseClicked MouseEvent event public void mousePressed MouseEvent event public void mouseReleased MouseEvent event public void mouseEntered MouseEvent event public void mouseExited MouseEvent event public void mouseDragged MouseEvent event public void mouseMoved MouseEvent event public void textValueChanged TextEvent event public void windowOpened WindowEvent event public void windowClosing WindowEvent event public void windowClosed WindowEvent event public void windowIconified WindowEvent event public void windowDeiconified WindowEvent event public void windowActivated WindowEvent event public void windowDeactivated WindowEvent event public void propertyChange PropertyChangeEvent event public void vetoableChange PropertyChangeEvent event public boolean imageUpdate java awt Image img int infoflags int int int width int height BshMethod method namespace getMethod new Class null null null null null null if method null try CallStack callstack newCallStack method invokeDeclaredMethod new Object img new Primitive infoflags new Primitive new Primitive new Primitive width new Primitive height declaringInterpreter callstack null catch EvalError declaringInterpreter error return true public class EditorExitRequested extends EBMessage public EditorExitRequested View view super view public View getView return View getSource class BrowserIORequest extends WorkRequest public static final int LIST_DIRECTORY public static final int DELETE public static final int RENAME public static final int MKDIR public BrowserIORequest int type VFSBrowser browser Object session VFS vfs String path1 String path2 DefaultMutableTreeNode node boolean loadingRoot this type type this browser browser this session session this vfs vfs this path1 path1 this path2 path2 this node node this loadingRoot loadingRoot public void run switch type case LIST_DIRECTORY listDirectory break case DELETE delete break case RENAME rename break case MKDIR mkdir break if type LIST_DIRECTORY browser endRequest public String toString String typeString switch type case LIST_DIRECTORY typeString break case DELETE typeString break case RENAME typeString break case MKDIR typeString break default typeString break return getClass getName typeString vfs path1 path2 private int type private VFSBrowser browser private Object session private VFS vfs private String path1 private String path2 private DefaultMutableTreeNode node private boolean loadingRoot private void listDirectory VFS DirectoryEntry directory null String args path1 setStatus jEdit getProperty args String canonPath path1 try setAbortable true canonPath vfs session path1 browser directory vfs session canonPath browser catch IOException io setAbortable false Log log Log ERROR this io String pp io toString VFSManager error browser path1 pp catch WorkThread Abort finally try vfs session browser catch IOException io setAbortable false Log log Log ERROR this io String pp io toString VFSManager error browser path1 pp setAbortable false browser directoryLoaded node loadingRoot canonPath directory private void delete try setAbortable true String args path1 setStatus jEdit getProperty args try path1 vfs session path1 browser if vfs session path1 browser VFSManager error browser path1 null catch IOException io setAbortable false Log log Log ERROR this io String pp io toString VFSManager error browser path1 pp catch WorkThread Abort finally try vfs session browser catch IOException io setAbortable false Log log Log ERROR this io String pp io toString VFSManager error browser path1 pp private void rename try setAbortable true String args path1 path2 setStatus jEdit getProperty args try path1 vfs session path1 browser path2 vfs session path2 browser VFS DirectoryEntry file vfs session path2 browser if file null VFSManager error browser path1 new String path2 else if vfs session path1 path2 browser VFSManager error browser path1 new String path2 catch IOException io setAbortable false Log log Log ERROR this io String pp io toString VFSManager error browser path1 pp catch WorkThread Abort finally try vfs session browser catch IOException io setAbortable false Log log Log ERROR this io String pp io toString VFSManager error browser path1 pp private void mkdir try setAbortable true String args path1 setStatus jEdit getProperty args try path1 vfs session path1 browser if vfs session path1 browser VFSManager error browser path1 null catch IOException io setAbortable false Log log Log ERROR this io args io toString VFSManager error browser path1 args catch WorkThread Abort finally try vfs session browser catch IOException io setAbortable false Log log Log ERROR this io String args io toString VFSManager error browser path1 args public class BufferIORequest extends WorkRequest public static final int IOBUFSIZE public static final int PROGRESS_INTERVAL public static final String LOAD_DATA public static final String END_OFFSETS public static final String NEW_PATH public static final String ERROR_OCCURRED public static final int LOAD public static final int SAVE public static final int AUTOSAVE public static final int INSERT public static final int GZIP_MAGIC_1 public static final int GZIP_MAGIC_2 public static final int UNICODE_MAGIC_1 public static final int UNICODE_MAGIC_2 public BufferIORequest int type View view Buffer buffer Object session VFS vfs String path this type type this view view this buffer buffer this session session this vfs vfs this path path markersPath vfs getParentOfPath path vfs getFileName path public void run switch type case LOAD load break case SAVE save break case AUTOSAVE autosave break case INSERT insert break public String toString String typeString switch type case LOAD typeString break case SAVE typeString break case AUTOSAVE typeString break default typeString return getClass getName typeString buffer private int type private View view private Buffer buffer private Object session private VFS vfs private String path private String markersPath private void load InputStream in null try try String args vfs getFileName path setAbortable true if buffer isTemporary setStatus jEdit getProperty args setProgressValue path vfs session path view VFS DirectoryEntry entry vfs session path view long length if entry null length entry length else length in vfs session path false view if in null return in new BufferedInputStream in if in markSupported in mark int b1 in read int b2 in read in reset if b1 GZIP_MAGIC_1 b2 GZIP_MAGIC_2 in new GZIPInputStream in buffer setBooleanProperty Buffer GZIPPED true else if b1 UNICODE_MAGIC_1 b2 UNICODE_MAGIC_2 b1 UNICODE_MAGIC_2 b2 UNICODE_MAGIC_1 buffer setProperty Buffer ENCODING else if path toLowerCase endsWith in new GZIPInputStream in read buffer in length buffer setNewFile false catch CharConversionException ch Log log Log ERROR this ch Object pp buffer getProperty Buffer ENCODING ch toString VFSManager error view path pp buffer setBooleanProperty ERROR_OCCURRED true catch UnsupportedEncodingException uu Log log Log ERROR this uu Object pp buffer getProperty Buffer ENCODING uu toString VFSManager error view path pp buffer setBooleanProperty ERROR_OCCURRED true catch IOException io Log log Log ERROR this io Object pp io toString VFSManager error view path pp buffer setBooleanProperty ERROR_OCCURRED true catch OutOfMemoryError oom Log log Log ERROR this oom VFSManager error view path null buffer setBooleanProperty ERROR_OCCURRED true if jEdit getBooleanProperty try String args vfs getFileName path if buffer isTemporary setStatus jEdit getProperty args setAbortable true in vfs session markersPath true view if in null readMarkers buffer in catch IOException io catch WorkThread Abort if in null try in close catch IOException io buffer setBooleanProperty ERROR_OCCURRED true finally try vfs session view catch IOException io Log log Log ERROR this io String pp io toString VFSManager error view path pp buffer setBooleanProperty ERROR_OCCURRED true catch WorkThread Abort buffer setBooleanProperty ERROR_OCCURRED true private void read Buffer buffer InputStream long length throws IOException IntegerArray endOffsets new IntegerArray boolean trackProgress buffer isTemporary length if trackProgress setProgressValue setProgressMaximum int length if length length IOBUFSIZE SegmentBuffer seg new SegmentBuffer int length InputStreamReader in new InputStreamReader buffer getStringProperty Buffer ENCODING char buf new char IOBUFSIZE int len boolean CRLF false boolean CROnly false boolean lastWasCR false int lineCount while len in read buf buf length int lastLine for int len switch buf case if lastWasCR CROnly true CRLF false else lastWasCR true seg append buf lastLine lastLine endOffsets add seg count seg append if trackProgress lineCount PROGRESS_INTERVAL setProgressValue seg count lastLine break case if lastWasCR CROnly false CRLF true lastWasCR false lastLine else CROnly false CRLF false seg append buf lastLine lastLine endOffsets add seg count seg append if trackProgress lineCount PROGRESS_INTERVAL setProgressValue seg count lastLine break default if lastWasCR CROnly true CRLF false lastWasCR false break if trackProgress setProgressValue seg count seg append buf lastLine len lastLine setAbortable false String lineSeparator if CRLF lineSeparator else if CROnly lineSeparator else lineSeparator in close int bufferLength seg count if bufferLength char ch seg array bufferLength seg count buffer setBooleanProperty Buffer TRAILING_EOL false if bufferLength jEdit getBooleanProperty char ch seg array bufferLength if ch buffer setBooleanProperty Buffer TRAILING_EOL true seg count endOffsets setSize endOffsets getSize buffer setProperty LOAD_DATA seg buffer setProperty END_OFFSETS endOffsets buffer setProperty NEW_PATH path buffer setProperty Buffer LINESEP lineSeparator private void readMarkers Buffer buffer InputStream throws IOException buffer removeAllMarkers BufferedReader in new BufferedReader new InputStreamReader String line while line in readLine null if line startsWith continue char shortcut line charAt int start line indexOf int end line indexOf start int position Integer parseInt line substring start end buffer addMarker shortcut position in close private void save OutputStream out null try String args vfs getFileName path setStatus jEdit getProperty args setAbortable true try path vfs session path view buffer readLock if buffer getProperty Buffer BACKED_UP null jEdit getBooleanProperty vfs session path view buffer setBooleanProperty Buffer BACKED_UP true String savePath boolean twoStageSave vfs getCapabilities VFS RENAME_CAP jEdit getBooleanProperty if twoStageSave savePath vfs getTwoStageSaveName path else savePath path out vfs session savePath view if out null if savePath endsWith buffer setBooleanProperty Buffer GZIPPED true if buffer getBooleanProperty Buffer GZIPPED out new GZIPOutputStream out write buffer out if twoStageSave if vfs session savePath path view throw new IOException savePath if vfs getCapabilities VFS DELETE_CAP if jEdit getBooleanProperty buffer getMarkers size setStatus jEdit getProperty args setProgressValue out vfs session markersPath view if out null writeMarkers buffer out else vfs session markersPath view else buffer setBooleanProperty ERROR_OCCURRED true if twoStageSave VFSManager sendVFSUpdate vfs path true catch IOException io Log log Log ERROR this io String pp io toString VFSManager error view path pp buffer setBooleanProperty ERROR_OCCURRED true finally buffer readUnlock catch WorkThread Abort if out null try out close catch IOException io buffer setBooleanProperty ERROR_OCCURRED true finally try vfs session buffer path view vfs session view catch IOException io Log log Log ERROR this io String pp io toString VFSManager error view path pp buffer setBooleanProperty ERROR_OCCURRED true catch WorkThread Abort buffer setBooleanProperty ERROR_OCCURRED true private void autosave OutputStream out null try String args vfs getFileName path setStatus jEdit getProperty args setAbortable true try if buffer isDirty return out vfs session path view if out null return write buffer out catch Exception finally catch WorkThread Abort if out null try out close catch IOException io private void write Buffer buffer OutputStream throws IOException BufferedWriter out new BufferedWriter new OutputStreamWriter buffer getStringProperty Buffer ENCODING IOBUFSIZE Segment lineSegment new Segment String newline buffer getStringProperty Buffer LINESEP if newline null newline System getProperty setProgressMaximum buffer getLineCount PROGRESS_INTERVAL setProgressValue int while buffer getLineCount buffer getLineText lineSegment out write lineSegment array lineSegment offset lineSegment count if buffer getLineCount out write newline if PROGRESS_INTERVAL setProgressValue PROGRESS_INTERVAL if jEdit getBooleanProperty buffer getBooleanProperty Buffer TRAILING_EOL out write newline out close private void writeMarkers Buffer buffer OutputStream out throws IOException Writer new BufferedWriter new OutputStreamWriter out Vector markers buffer getMarkers for int markers size Marker marker Marker markers elementAt write write marker getShortcut write String pos String valueOf marker getPosition write pos write write pos write close private void insert InputStream in null try try String args vfs getFileName path setStatus jEdit getProperty args setAbortable true path vfs session path view VFS DirectoryEntry entry vfs session path view long length if entry null length entry length else length in vfs session path false view if in null return if path endsWith in new GZIPInputStream in read buffer in length catch IOException io Log log Log ERROR this io String pp io toString VFSManager error view path pp buffer setBooleanProperty ERROR_OCCURRED true catch WorkThread Abort if in null try in close catch IOException io buffer setBooleanProperty ERROR_OCCURRED true finally try vfs session view catch IOException io Log log Log ERROR this io String pp io toString VFSManager error view path pp buffer setBooleanProperty ERROR_OCCURRED true catch WorkThread Abort buffer setBooleanProperty ERROR_OCCURRED true public class DirectoryMenu extends EnhancedMenu public DirectoryMenu String name String dir super name this dir dir public void menuSelected MenuEvent evt super menuSelected evt final View view GUIUtilities getView this if getMenuComponentCount removeAll final String path if dir null path view getBuffer getDirectory else path dir JMenuItem mi new JMenuItem path mi setActionCommand path mi setIcon FileCellRenderer openDirIcon ActionListener fileListener new ActionListener public void actionPerformed ActionEvent evt jEdit openFile view evt getActionCommand ActionListener dirListener new ActionListener public void actionPerformed ActionEvent evt VFSBrowser browseDirectory view evt getActionCommand mi addActionListener dirListener add mi addSeparator if dir null view getBuffer getVFS instanceof FileVFS mi new JMenuItem jEdit getProperty mi setEnabled false add mi return File directory new File path JMenu current this String backupPrefix jEdit getProperty String backupSuffix jEdit getProperty File list directory listFiles if list null list length mi new JMenuItem jEdit getProperty mi setEnabled false add mi else int maxItems jEdit getIntegerProperty MiscUtilities quicksort list new MiscUtilities StringICaseCompare for int list length File file list String name file getName if name endsWith continue if name startsWith name endsWith continue if backupPrefix length name startsWith backupPrefix backupSuffix length name endsWith backupSuffix continue mi new JMenuItem name mi setActionCommand file getPath mi addActionListener file isDirectory dirListener fileListener mi setIcon file isDirectory FileCellRenderer dirIcon FileCellRenderer fileIcon if current getItemCount maxItems list length JMenu newCurrent new JMenu jEdit getProperty current add newCurrent current newCurrent current add mi public void menuDeselected MenuEvent public void menuCanceled MenuEvent private String dir public class ColorWellButton extends JButton public ColorWellButton Color color setIcon new ColorWell color setMargin new Insets addActionListener new ActionHandler if OperatingSystem isMacOSLF putClientProperty public Color getSelectedColor return ColorWell getIcon color public void setSelectedColor Color color ColorWell getIcon color color repaint static class ColorWell implements Icon Color color ColorWell Color color this color color public int getIconWidth return public int getIconHeight return public void paintIcon Component Graphics int int if color null return setColor color fillRect getIconWidth getIconHeight setColor color darker drawRect getIconWidth getIconHeight class ActionHandler implements ActionListener public void actionPerformed ActionEvent evt JDialog parent GUIUtilities getParentDialog ColorWellButton this JDialog dialog if parent null dialog new ColorPickerDialog parent jEdit getProperty true else dialog new ColorPickerDialog JOptionPane getFrameForComponent ColorWellButton this jEdit getProperty true dialog pack dialog show private class ColorPickerDialog extends EnhancedDialog implements ActionListener public ColorPickerDialog Frame parent String title boolean modal super parent title modal init public ColorPickerDialog Dialog parent String title boolean modal super parent title modal getContentPane setLayout new BorderLayout init public void ok Color chooser getColor if null setSelectedColor setVisible false public void cancel setVisible false public void actionPerformed ActionEvent evt if evt getSource ok ok else cancel private JColorChooser chooser private JButton ok private JButton cancel private void init Color getSelectedColor if null chooser new JColorChooser else chooser new JColorChooser getContentPane add BorderLayout CENTER chooser Box buttons new Box BoxLayout X_AXIS buttons add Box createGlue ok new JButton jEdit getProperty ok addActionListener this buttons add ok buttons add Box createHorizontalStrut getRootPane setDefaultButton ok cancel new JButton jEdit getProperty cancel addActionListener this buttons add cancel buttons add Box createGlue getContentPane add BorderLayout SOUTH buttons pack setLocationRelativeTo getParent class BSHArguments extends SimpleNode BSHArguments int id super id public Object getArguments CallStack callstack Interpreter interpreter throws EvalError Object args new Object jjtGetNumChildren for int args length args SimpleNode jjtGetChild eval callstack interpreter return args class PluginList Vector plugins Hashtable pluginHash Vector pluginSets PluginList throws Exception plugins new Vector pluginHash new Hashtable pluginSets new Vector String path jEdit getProperty PluginListHandler handler new PluginListHandler this path XmlParser parser new XmlParser parser setHandler handler parser parse null null new BufferedReader new InputStreamReader new GZIPInputStream new URL path openStream void addPlugin Plugin plugin plugin checkIfInstalled plugins addElement plugin pluginHash put plugin name plugin void addPluginSet PluginSet set pluginSets addElement set void finished for int plugins size Plugin plugin Plugin plugins elementAt for int plugin branches size Branch branch Branch plugin branches elementAt for int branch deps size Dependency dep Dependency branch deps elementAt if dep what equals dep plugin Plugin pluginHash get dep pluginName void dump for int plugins size System err println Plugin plugins elementAt System err println static class PluginSet String name String description Vector plugins new Vector public String toString return plugins toString static class Plugin String jar String name String description String author Vector branches new Vector String installed String installedVersion void checkIfInstalled EditPlugin JAR jars jEdit getPluginJARs for int jars length String path jars getPath if new File path exists continue if MiscUtilities getFileName path equals jar installed path EditPlugin plugins jars getPlugins if plugins length installedVersion jEdit getProperty plugins getClassName break String notLoaded jEdit getNotLoadedPluginJARs for int notLoaded length String path notLoaded if MiscUtilities getFileName path equals jar installed path break Branch getCompatibleBranch for int branches size Branch branch Branch branches elementAt if branch canSatisfyDependencies return branch return null boolean canBeInstalled Branch branch getCompatibleBranch return branch null branch obsolete branch canSatisfyDependencies void install Roster roster String installDirectory boolean downloadSource if installed null roster addOperation new Roster Remove installed Branch branch getCompatibleBranch if branch obsolete return branch satisfyDependencies roster installDirectory downloadSource if installed null installDirectory MiscUtilities getParentOfPath installed roster addOperation new Roster Install downloadSource branch downloadSource branch download installDirectory downloadSource branch downloadSourceSize branch downloadSize public String toString return name static class Branch String version String date int downloadSize String download int downloadSourceSize String downloadSource boolean obsolete Vector deps new Vector boolean canSatisfyDependencies for int deps size Dependency dep Dependency deps elementAt if dep canSatisfy return false return true void satisfyDependencies Roster roster String installDirectory boolean downloadSource for int deps size Dependency dep Dependency deps elementAt dep satisfy roster installDirectory downloadSource public String toString return version download obsolete deps static class Dependency String what String from String to String pluginName Plugin plugin Dependency String what String from String to String pluginName this what what this from from this to to this pluginName pluginName boolean isSatisfied if what equals for int plugin branches size if plugin installedVersion null from null MiscUtilities compareStrings plugin installedVersion from false to null MiscUtilities compareStrings plugin installedVersion to false return true return false else if what equals String javaVersion System getProperty substring if from null MiscUtilities compareStrings javaVersion from false to null MiscUtilities compareStrings javaVersion to false return true else return false else if what equals String build jEdit getBuild if from null MiscUtilities compareStrings build from false to null MiscUtilities compareStrings build to false return true else return false else Log log Log ERROR this what return false boolean canSatisfy if isSatisfied return true else if what equals return plugin canBeInstalled else return false void satisfy Roster roster String installDirectory boolean downloadSource if what equals for int plugin branches size Branch branch Branch plugin branches elementAt if plugin installedVersion null MiscUtilities compareStrings plugin installedVersion branch version false from null MiscUtilities compareStrings branch version from false to null MiscUtilities compareStrings branch version to false plugin install roster installDirectory downloadSource return public String toString return what from to plugin public class AbbrevEditor extends JPanel public AbbrevEditor GridBagLayout layout new GridBagLayout setLayout layout GridBagConstraints cons new GridBagConstraints cons anchor cons WEST cons fill cons BOTH cons weightx cons gridx cons gridy JLabel label new JLabel jEdit getProperty SwingConstants RIGHT label setBorder new EmptyBorder layout setConstraints label cons add label cons gridx cons weightx abbrev new JTextField layout setConstraints abbrev cons add abbrev cons gridx cons weightx cons gridwidth cons gridy label new JLabel jEdit getProperty label setBorder new EmptyBorder layout setConstraints label cons add label cons gridy cons weighty beforeCaret new JTextArea JScrollPane scroller new JScrollPane beforeCaret layout setConstraints scroller cons add scroller cons gridy cons weighty label new JLabel jEdit getProperty label setBorder new EmptyBorder layout setConstraints label cons add label cons gridy cons weighty afterCaret new JTextArea scroller new JScrollPane afterCaret layout setConstraints scroller cons add scroller public String getAbbrev return abbrev getText public void setAbbrev String abbrev this abbrev setText abbrev public String getExpansion StringBuffer buf new StringBuffer String beforeCaretText beforeCaret getText String afterCaretText afterCaret getText for int beforeCaretText length char ch beforeCaretText charAt switch ch case buf append break case buf append break case buf append break default buf append ch break if afterCaretText length buf append for int afterCaretText length char ch afterCaretText charAt switch ch case buf append break case buf append break case buf append break default buf append ch break return buf toString public void setExpansion String expansion if expansion null beforeCaret setText null afterCaret setText null return String beforeCaretText null String afterCaretText null StringBuffer buf new StringBuffer for int expansion length char ch expansion charAt if ch expansion length ch expansion charAt switch ch case buf append break case buf append break case beforeCaretText buf toString buf setLength break default buf append ch break else buf append ch if beforeCaretText null beforeCaretText buf toString else afterCaretText buf toString beforeCaret setText beforeCaretText afterCaret setText afterCaretText public JTextField getAbbrevField return abbrev public JTextArea getBeforeCaretTextArea return beforeCaret public JTextArea getAfterCaretTextArea return afterCaret private JTextField abbrev private JTextArea beforeCaret afterCaret public class EnhancedButton extends RolloverButton public EnhancedButton Icon icon String toolTip EditAction action super icon this action action if action null setEnabled true addActionListener new EditAction Wrapper action addMouseListener new MouseHandler else setEnabled false setToolTipText toolTip public boolean isFocusTraversable return false private EditAction action class MouseHandler extends MouseAdapter public void mouseEntered MouseEvent evt String msg action getMouseOverText if msg null GUIUtilities getView Component evt getSource getStatus setMessage msg public void mouseExited MouseEvent evt GUIUtilities getView Component evt getSource getStatus setMessage null public class BufferPrinter1_4 private static PrinterJob getPrintJob String jobName job PrinterJob getPrinterJob format new HashPrintRequestAttributeSet String settings jEdit getSettingsDirectory if settings null String printSpecPath MiscUtilities constructPath settings File filePrintSpec new File printSpecPath if filePrintSpec exists try FileInputStream fileIn new FileInputStream filePrintSpec ObjectInputStream obIn new ObjectInputStream fileIn format HashPrintRequestAttributeSet obIn readObject catch Exception Log log Log ERROR BufferPrinter1_4 class if jEdit getBooleanProperty format add Chromaticity COLOR else format add Chromaticity MONOCHROME format add new JobName jobName null return job public static void pageSetup View view PrinterJob prnJob getPrintJob if prnJob pageDialog format null savePrintSpec public static void print final View view final Buffer buffer boolean selection job getPrintJob buffer getPath boolean header jEdit getBooleanProperty boolean footer jEdit getBooleanProperty boolean lineNumbers jEdit getBooleanProperty boolean color jEdit getBooleanProperty Font font jEdit getFontProperty BufferPrintable printable new BufferPrintable job format view buffer font header footer lineNumbers color job setPrintable printable if job printDialog format return savePrintSpec VFSManager runInWorkThread printable public static PageFormat getPageFormat PrinterJob prnJob getPrintJob PageFormat pf prnJob defaultPage Paper pap pf getPaper MediaSizeName media MediaSizeName format get Media class MediaSize ms MediaSize getMediaSizeForName media MediaPrintableArea mediaarea MediaPrintableArea format get MediaPrintableArea class if mediaarea null pap setImageableArea double mediaarea getX MediaPrintableArea INCH double mediaarea getY MediaPrintableArea INCH double mediaarea getWidth MediaPrintableArea INCH double mediaarea getHeight MediaPrintableArea INCH if ms null pap setSize double ms getX MediaSize INCH double ms getY MediaSize INCH pf setPaper pap OrientationRequested orientation OrientationRequested format get OrientationRequested class if orientation null if orientation getValue OrientationRequested LANDSCAPE getValue pf setOrientation PageFormat LANDSCAPE else if orientation getValue OrientationRequested REVERSE_LANDSCAPE getValue pf setOrientation PageFormat REVERSE_LANDSCAPE else if orientation getValue OrientationRequested PORTRAIT getValue pf setOrientation PageFormat PORTRAIT else if orientation getValue OrientationRequested REVERSE_PORTRAIT getValue pf setOrientation PageFormat PORTRAIT return pf private static void savePrintSpec String settings jEdit getSettingsDirectory if settings null return String printSpecPath MiscUtilities constructPath settings File filePrintSpec new File printSpecPath try FileOutputStream fileOut new FileOutputStream filePrintSpec ObjectOutputStream obOut new ObjectOutputStream fileOut obOut writeObject format Chromaticity cc Chromaticity format get Chromaticity class if cc null jEdit setBooleanProperty cc getValue Chromaticity COLOR getValue catch Exception printStackTrace private static PrintRequestAttributeSet format private static PrinterJob job public class ToolBarOptionPane extends AbstractOptionPane public ToolBarOptionPane super protected void setLayout new BorderLayout JPanel panel new JPanel new GridLayout showToolbar new JCheckBox jEdit getProperty showToolbar setSelected jEdit getBooleanProperty panel add showToolbar panel add new JLabel jEdit getProperty add BorderLayout NORTH panel String toolbar jEdit getProperty StringTokenizer st new StringTokenizer toolbar listModel new DefaultListModel while st hasMoreTokens String actionName String st nextToken if actionName equals listModel addElement new ToolBarOptionPane Button null null else EditAction action jEdit getAction actionName if action null continue String label action getLabel if label null continue Icon icon String iconName if actionName equals iconName null icon null else iconName jEdit getProperty actionName if iconName null icon GUIUtilities loadIcon else icon GUIUtilities loadIcon iconName if icon null icon GUIUtilities loadIcon listModel addElement new Button actionName iconName icon label list new JList listModel list setSelectionMode ListSelectionModel SINGLE_SELECTION list addListSelectionListener new ListHandler list setCellRenderer new ButtonCellRenderer add BorderLayout CENTER new JScrollPane list JPanel buttons new JPanel buttons setBorder new EmptyBorder buttons setLayout new BoxLayout buttons BoxLayout X_AXIS ActionHandler actionHandler new ActionHandler add new RolloverButton GUIUtilities loadIcon add setToolTipText jEdit getProperty add addActionListener actionHandler buttons add add buttons add Box createHorizontalStrut remove new RolloverButton GUIUtilities loadIcon remove setToolTipText jEdit getProperty remove addActionListener actionHandler buttons add remove buttons add Box createHorizontalStrut moveUp new RolloverButton GUIUtilities loadIcon moveUp setToolTipText jEdit getProperty moveUp addActionListener actionHandler buttons add moveUp buttons add Box createHorizontalStrut moveDown new RolloverButton GUIUtilities loadIcon moveDown setToolTipText jEdit getProperty moveDown addActionListener actionHandler buttons add moveDown buttons add Box createHorizontalStrut edit new RolloverButton GUIUtilities loadIcon edit setToolTipText jEdit getProperty edit addActionListener actionHandler buttons add edit buttons add Box createGlue updateButtons add BorderLayout SOUTH buttons iconList new DefaultComboBoxModel st new StringTokenizer jEdit getProperty while st hasMoreElements String icon st nextToken iconList addElement new IconListEntry GUIUtilities loadIcon icon icon protected void jEdit setBooleanProperty showToolbar isSelected StringBuffer buf new StringBuffer for int listModel getSize if buf append Button button Button listModel elementAt buf append button actionName jEdit setProperty button actionName button iconName jEdit setProperty buf toString private JCheckBox showToolbar private DefaultListModel listModel private JList list private RolloverButton add private RolloverButton remove private RolloverButton moveUp moveDown private RolloverButton edit private DefaultComboBoxModel iconList private void updateButtons int index list getSelectedIndex remove setEnabled index listModel getSize moveUp setEnabled index moveDown setEnabled index index listModel getSize edit setEnabled index static class ButtonCompare implements MiscUtilities Compare public int compare Object obj1 Object obj2 return MiscUtilities compareStrings Button obj1 label Button obj2 label true static class Button String actionName String iconName Icon icon String label Button String actionName String iconName Icon icon String label this actionName actionName this iconName iconName this icon icon this label GUIUtilities prettifyMenuLabel label public String toString return label public boolean equals Object if instanceof Button return Button actionName equals actionName else return false static class IconListEntry Icon icon String name IconListEntry Icon icon String name this icon icon this name name public String toString return name static class ButtonCellRenderer extends DefaultListCellRenderer public Component getListCellRendererComponent JList list Object value int index boolean isSelected boolean cellHasFocus super getListCellRendererComponent list value index isSelected cellHasFocus Button button Button value setIcon button icon return this static class IconCellRenderer extends DefaultListCellRenderer public Component getListCellRendererComponent JList list Object value int index boolean isSelected boolean cellHasFocus super getListCellRendererComponent list value index isSelected cellHasFocus IconListEntry icon IconListEntry value setIcon icon icon return this class ActionHandler implements ActionListener public void actionPerformed ActionEvent evt Object source evt getSource if source add ToolBarEditDialog dialog new ToolBarEditDialog ToolBarOptionPane this iconList null Button selection dialog getSelection if selection null return int index list getSelectedIndex if index index listModel getSize else index listModel insertElementAt selection index list setSelectedIndex index list ensureIndexIsVisible index else if source remove int index list getSelectedIndex listModel removeElementAt index updateButtons else if source moveUp int index list getSelectedIndex Object selected list getSelectedValue listModel removeElementAt index listModel insertElementAt selected index list setSelectedIndex index list ensureIndexIsVisible index else if source moveDown int index list getSelectedIndex Object selected list getSelectedValue listModel removeElementAt index listModel insertElementAt selected index list setSelectedIndex index list ensureIndexIsVisible index else if source edit ToolBarEditDialog dialog new ToolBarEditDialog ToolBarOptionPane this iconList Button list getSelectedValue Button selection dialog getSelection if selection null return int index list getSelectedIndex listModel setElementAt selection index list setSelectedIndex index list ensureIndexIsVisible index class ListHandler implements ListSelectionListener public void valueChanged ListSelectionEvent evt updateButtons class ToolBarEditDialog extends EnhancedDialog public ToolBarEditDialog Component comp DefaultComboBoxModel iconListModel ToolBarOptionPane Button current super GUIUtilities getParentDialog comp jEdit getProperty true JPanel content new JPanel new BorderLayout content setBorder new EmptyBorder setContentPane content ActionHandler actionHandler new ActionHandler ButtonGroup grp new ButtonGroup JPanel typePanel new JPanel new GridLayout typePanel setBorder new EmptyBorder typePanel add new JLabel jEdit getProperty separator new JRadioButton jEdit getProperty separator addActionListener actionHandler grp add separator typePanel add separator action new JRadioButton jEdit getProperty action addActionListener actionHandler grp add action typePanel add action content add BorderLayout NORTH typePanel JPanel actionPanel new JPanel new BorderLayout ActionSet actionsList jEdit getActionSets Vector vec new Vector actionsList length for int actionsList length ActionSet actionSet actionsList if actionSet getActionCount vec addElement actionSet combo new JComboBox vec combo addActionListener actionHandler actionPanel add BorderLayout NORTH combo list new JList list setVisibleRowCount list setSelectionMode ListSelectionModel SINGLE_SELECTION actionPanel add BorderLayout CENTER new JScrollPane list JPanel iconPanel new JPanel new BorderLayout JPanel labelPanel new JPanel new GridLayout labelPanel setBorder new EmptyBorder JPanel compPanel new JPanel new GridLayout grp new ButtonGroup labelPanel add builtin new JRadioButton jEdit getProperty builtin addActionListener actionHandler grp add builtin labelPanel add file new JRadioButton jEdit getProperty grp add file file addActionListener actionHandler iconPanel add BorderLayout WEST labelPanel builtinCombo new JComboBox iconListModel builtinCombo setRenderer new ToolBarOptionPane IconCellRenderer compPanel add builtinCombo fileButton new JButton jEdit getProperty fileButton setMargin new Insets fileButton setIcon GUIUtilities loadIcon fileButton setHorizontalAlignment SwingConstants LEFT fileButton addActionListener actionHandler compPanel add fileButton iconPanel add BorderLayout CENTER compPanel actionPanel add BorderLayout SOUTH iconPanel content add BorderLayout CENTER actionPanel JPanel southPanel new JPanel southPanel setLayout new BoxLayout southPanel BoxLayout X_AXIS southPanel setBorder new EmptyBorder southPanel add Box createGlue ok new JButton jEdit getProperty ok addActionListener actionHandler getRootPane setDefaultButton ok southPanel add ok southPanel add Box createHorizontalStrut cancel new JButton jEdit getProperty cancel addActionListener actionHandler southPanel add cancel southPanel add Box createGlue content add BorderLayout SOUTH southPanel if current null action setSelected true builtin setSelected true updateList else if current actionName equals separator setSelected true builtin setSelected true else action setSelected true ActionSet set jEdit getActionSetForAction jEdit getAction current actionName combo setSelectedItem set updateList list setSelectedValue current true if MiscUtilities isURL current iconName file setSelected true fileIcon current iconName try fileButton setIcon new ImageIcon new URL fileIcon catch MalformedURLException mf Log log Log ERROR this mf fileButton setText MiscUtilities getFileName fileIcon else String iconName MiscUtilities getFileName current iconName builtin setSelected true ListModel model builtinCombo getModel for int model getSize ToolBarOptionPane IconListEntry entry ToolBarOptionPane IconListEntry model getElementAt if entry name equals iconName builtinCombo setSelectedIndex break updateEnabled pack setLocationRelativeTo GUIUtilities getParentDialog comp show public void ok isOK true dispose public void cancel dispose public ToolBarOptionPane Button getSelection if isOK return null if separator isSelected return new ToolBarOptionPane Button null null else Icon icon String iconName if builtin isSelected ToolBarOptionPane IconListEntry selectedIcon ToolBarOptionPane IconListEntry builtinCombo getSelectedItem icon selectedIcon icon iconName selectedIcon name else icon fileButton getIcon iconName fileIcon if iconName null iconName String label String actionName if action isSelected ToolBarOptionPane Button button ToolBarOptionPane Button list getSelectedValue label button label actionName button actionName else throw new InternalError return new ToolBarOptionPane Button actionName iconName icon label private boolean isOK private JRadioButton separator action private JComboBox combo private JList list private JRadioButton builtin private JComboBox builtinCombo private JRadioButton file private JButton fileButton private String fileIcon private JButton ok cancel private void updateEnabled combo setEnabled action isSelected list setEnabled action isSelected boolean iconControlsEnabled separator isSelected builtin setEnabled iconControlsEnabled file setEnabled iconControlsEnabled builtinCombo setEnabled iconControlsEnabled builtin isSelected fileButton setEnabled iconControlsEnabled file isSelected private void updateList ActionSet actionSet ActionSet combo getSelectedItem EditAction actions actionSet getActions Vector listModel new Vector actions length for int actions length EditAction action actions String label action getLabel if label null continue listModel addElement new ToolBarOptionPane Button action getName null null label MiscUtilities quicksort listModel new ToolBarOptionPane ButtonCompare list setListData listModel class ActionHandler implements ActionListener public void actionPerformed ActionEvent evt Object source evt getSource if source instanceof JRadioButton updateEnabled if source ok ok else if source cancel cancel else if source combo updateList else if source fileButton String directory if fileIcon null directory null else directory MiscUtilities getParentOfPath fileIcon String paths GUIUtilities showVFSFileDialog null directory VFSBrowser OPEN_DIALOG false if paths null return fileIcon paths try fileButton setIcon new ImageIcon new URL fileIcon catch MalformedURLException mf Log log Log ERROR this mf fileButton setText MiscUtilities getFileName fileIcon class ReflectError extends Exception public ReflectError super public ReflectError String super class ActionListHandler extends HandlerBase ActionListHandler String path ActionSet actionSet this path path this actionSet actionSet stateStack new Stack public Object resolveEntity String publicId String systemId if equals systemId return new StringReader return null public void attribute String aname String value boolean isSpecified aname aname null null aname intern value value null null value intern if aname actionName value else if aname noRepeat value else if aname noRecord value public void doctypeDecl String name String publicId String systemId throws Exception if equals name return Log log Log ERROR this path public void charData char int off int len String tag peekElement String text new String off len if tag code text else if tag isSelected text public void startElement String tag tag pushElement tag if tag code null isSelected null public void endElement String name if name null return String tag peekElement if name equals tag if tag actionSet addAction new BeanShellAction actionName code isSelected noRepeat noRecord noRepeat noRecord false popElement else throw new InternalError public void startDocument try pushElement null catch Exception printStackTrace private String path private ActionSet actionSet private String actionName private String code private String isSelected private boolean noRepeat private boolean noRecord private Stack stateStack private String pushElement String name name name null null name intern stateStack push name return name private String peekElement return String stateStack peek private String popElement return String stateStack pop public class MarkersMenu extends EnhancedMenu public MarkersMenu super public void menuSelected MenuEvent evt super menuSelected evt final View view GUIUtilities getView this if getMenuComponentCount for int getMenuComponentCount Component comp getMenuComponent if comp instanceof JSeparator break else remove comp Buffer buffer view getBuffer Vector markers buffer getMarkers if markers size JMenuItem mi new JMenuItem jEdit getProperty mi setEnabled false add mi return int maxItems jEdit getIntegerProperty JMenu current this for int markers size final Marker marker Marker markers elementAt int lineNo buffer getLineOfOffset marker getPosition if current getItemCount maxItems markers size JMenu newCurrent new JMenu jEdit getProperty current add newCurrent current newCurrent JMenuItem mi new MarkersMenuItem buffer lineNo marker getShortcut mi addActionListener new ActionListener public void actionPerformed ActionEvent evt view getTextArea setCaretPosition marker getPosition current add mi public void menuDeselected MenuEvent public void menuCanceled MenuEvent static class MarkersMenuItem extends JMenuItem MarkersMenuItem Buffer buffer int lineNo char shortcut String text buffer getLineText lineNo trim if text length text jEdit getProperty setText lineNo text shortcutProp MarkersMenuItem this shortcut shortcut public Dimension getPreferredSize Dimension super getPreferredSize String shortcut getShortcut if shortcut null width getFontMetrics acceleratorFont stringWidth shortcut return public void paint Graphics super paint String shortcut getShortcut if shortcut null setFont acceleratorFont setColor getModel isArmed acceleratorSelectionForeground acceleratorForeground FontMetrics fm getFontMetrics Insets insets getInsets drawString shortcut getWidth fm stringWidth shortcut insets right insets left getFont getSize insets top private String shortcutProp private char shortcut private static Font acceleratorFont private static Color acceleratorForeground private static Color acceleratorSelectionForeground private String getShortcut if shortcut return null else String shortcutPrefix jEdit getProperty shortcutProp if shortcutPrefix null return null else return shortcutPrefix shortcut static acceleratorFont UIManager getFont acceleratorFont new Font acceleratorFont getStyle acceleratorFont getSize acceleratorForeground UIManager getColor acceleratorSelectionForeground UIManager getColor public class VFSFileChooserDialog extends EnhancedDialog public VFSFileChooserDialog View view String path int mode boolean multipleSelection super view jEdit getProperty true JPanel content new JPanel new BorderLayout content setBorder new EmptyBorder setContentPane content String name if mode VFSBrowser CHOOSE_DIRECTORY_DIALOG name null else if path null path endsWith File separator path endsWith name null else VFS vfs VFSManager getVFSForPath path name vfs getFileName path path vfs getParentOfPath path browser new VFSBrowser view path mode multipleSelection true browser addBrowserListener new BrowserHandler content add BorderLayout CENTER browser JPanel panel new JPanel panel setLayout new BoxLayout panel BoxLayout X_AXIS panel setBorder new EmptyBorder filenameField new JTextField filenameField setText name filenameField addKeyListener new KeyHandler filenameField selectAll Dimension dim filenameField getPreferredSize dim width Integer MAX_VALUE filenameField setMaximumSize dim Box box new Box BoxLayout Y_AXIS box add Box createGlue box add filenameField box add Box createGlue if mode VFSBrowser CHOOSE_DIRECTORY_DIALOG JLabel label new JLabel jEdit getProperty label setDisplayedMnemonic jEdit getProperty charAt label setLabelFor filenameField panel add label panel add Box createHorizontalStrut panel add box panel add Box createHorizontalStrut else panel add Box createGlue if mode VFSBrowser BROWSER mode VFSBrowser OPEN_DIALOG mode VFSBrowser CHOOSE_DIRECTORY_DIALOG GUIUtilities requestFocus this browser getBrowserView getDefaultFocusComponent else GUIUtilities requestFocus this filenameField ok new JButton getRootPane setDefaultButton ok switch mode case VFSBrowser OPEN_DIALOG case VFSBrowser BROWSER_DIALOG ok setText jEdit getProperty break case VFSBrowser CHOOSE_DIRECTORY_DIALOG ok setText jEdit getProperty dim ok getPreferredSize ok setPreferredSize dim break case VFSBrowser SAVE_DIALOG ok setText jEdit getProperty break ok addActionListener new ActionHandler panel add ok panel add Box createHorizontalStrut cancel new JButton jEdit getProperty cancel addActionListener new ActionHandler panel add cancel content add BorderLayout SOUTH panel VFSManager getIOThreadPool addProgressListener workThreadHandler new WorkThreadHandler pack GUIUtilities loadGeometry this show public void dispose GUIUtilities saveGeometry this VFSManager getIOThreadPool removeProgressListener workThreadHandler super dispose public void ok VFS DirectoryEntry files browser getSelectedFiles String directory browser getDirectory filename filenameField getText if files length if browser getMode VFSBrowser CHOOSE_DIRECTORY_DIALOG filename browser getDirectory else if filename length getToolkit beep return else if browser getMode VFSBrowser BROWSER_DIALOG Hashtable props new Hashtable props put Buffer ENCODING browser currentEncoding jEdit openFile browser getView browser getDirectory filename false props dispose return else for int files length VFS DirectoryEntry file files if file type VFS DirectoryEntry FILESYSTEM file type VFS DirectoryEntry DIRECTORY browser setDirectory file path if file name equals filename filenameField setText null return else if browser getMode VFSBrowser SAVE_DIALOG filename null filename length filename file path if browser getMode VFSBrowser SAVE_DIALOG if MiscUtilities isURL directory MiscUtilities isURL filename filename MiscUtilities constructPath directory MiscUtilities canonPath filename if doFileExistsWarning filename return else if browser getMode VFSBrowser BROWSER_DIALOG browser filesActivated VFSBrowser M_OPEN false isOK true dispose public void cancel dispose public String getSelectedFiles if isOK return null if filename null filename length String path browser getDirectory return new String MiscUtilities constructPath path filename else Vector vector new Vector VFS DirectoryEntry selectedFiles browser getSelectedFiles for int selectedFiles length VFS DirectoryEntry file selectedFiles if browser getMode VFSBrowser CHOOSE_DIRECTORY_DIALOG if file type VFS DirectoryEntry FILE vector addElement file path else if file type VFS DirectoryEntry FILE vector addElement file path String retVal new String vector size vector copyInto retVal return retVal private VFSBrowser browser private JTextField filenameField private String filename private JButton ok private JButton cancel private boolean isOK private WorkThreadHandler workThreadHandler private boolean doFileExistsWarning String filename if new File filename exists String args MiscUtilities getFileName filename int result GUIUtilities confirm browser args JOptionPane YES_NO_OPTION JOptionPane WARNING_MESSAGE if result JOptionPane YES_OPTION return true return false class ActionHandler implements ActionListener public void actionPerformed ActionEvent evt if evt getSource ok if browser getDirectory equals browser getDirectoryField getText browser setDirectory browser getDirectoryField getText else ok else if evt getSource cancel cancel class BrowserHandler implements BrowserListener public void filesSelected VFSBrowser browser VFS DirectoryEntry files if files length if browser getMode VFSBrowser CHOOSE_DIRECTORY_DIALOG ok setText jEdit getProperty return else if files length if browser getMode VFSBrowser CHOOSE_DIRECTORY_DIALOG ok setText jEdit getProperty VFS DirectoryEntry file files if file type VFS DirectoryEntry FILE String path file path String directory browser getDirectory VFS vfs VFSManager getVFSForPath directory String parent vfs getParentOfPath path if parent endsWith parent endsWith File separator parent parent substring parent length if parent equals directory path file name filenameField setText path filenameField selectAll else if browser getMode VFSBrowser CHOOSE_DIRECTORY_DIALOG ok setText jEdit getProperty filenameField setText null public void filesActivated VFSBrowser browser VFS DirectoryEntry files for int files length VFS DirectoryEntry file files if file type VFS DirectoryEntry FILESYSTEM file type VFS DirectoryEntry DIRECTORY if file name equals filenameField getText filenameField setText null return if browser getMode VFSBrowser BROWSER_DIALOG dispose else ok class KeyHandler extends KeyAdapter public void keyPressed KeyEvent evt switch evt getKeyCode case KeyEvent VK_LEFT if filenameField getCaretPosition browser getBrowserView getTree processKeyEvent evt break case KeyEvent VK_UP case KeyEvent VK_DOWN browser getBrowserView getTree processKeyEvent evt break public void keyTyped KeyEvent evt char ch evt getKeyChar if ch ch ch return SwingUtilities invokeLater new Runnable public void run String currentText filenameField getText int caret filenameField getCaretPosition BrowserView view browser getBrowserView view selectNone view getTree doTypeSelect currentText false VFS DirectoryEntry files view getSelectedFiles if files length String path files path String name files name String parent MiscUtilities getParentOfPath path if parent endsWith parent endsWith File separator parent parent substring parent length String newText if MiscUtilities isAbsolutePath currentText currentText startsWith browser getDirectory newText path else if MiscUtilities isAbsolutePath currentText caret MiscUtilities getParentOfPath currentText length if parent equals browser getDirectory newText name else caret parent length newText path filenameField setText newText filenameField setCaretPosition newText length filenameField moveCaretPosition caret class WorkThreadHandler implements WorkThreadProgressListener public void statusUpdate WorkThreadPool threadPool int threadIndex synchronized VFSFileChooserDialog this int requestCount threadPool getRequestCount if requestCount getContentPane setCursor Cursor getDefaultCursor else if requestCount getContentPane setCursor Cursor getPredefinedCursor Cursor WAIT_CURSOR public void progressUpdate WorkThreadPool threadPool int threadIndex class BSHStatementExpressionList extends SimpleNode BSHStatementExpressionList int id super id public Object eval CallStack callstack Interpreter interpreter throws EvalError int jjtGetNumChildren for int SimpleNode node SimpleNode jjtGetChild node eval callstack interpreter return Primitive VOID public class NameSpace implements java io Serializable BshClassManager Listener NameSource public static final NameSpace JAVACODE new NameSpace public String name private NameSpace parent private Hashtable variables private Hashtable methods private This thisReference transient private static boolean superImport transient private Hashtable classCache public NameSpace String name this null name public NameSpace NameSpace parent String name setName name setParent parent BshClassManager addCMListener this public void setName String name this name name public String getName return this name SimpleNode callerInfoNode void setNode SimpleNode node this callerInfoNode node SimpleNode getNode return this callerInfoNode public Object get String name Interpreter interpreter throws EvalError CallStack callstack new CallStack return getNameResolver name toObject callstack interpreter public void setVariable String name Object value throws EvalError if variables null variables new Hashtable if value null variables remove name return boolean recurse Interpreter strictJava Object current getVariableImpl name recurse if current null current instanceof TypedVariable try TypedVariable current setValue value catch EvalError throw new EvalError name getMessage else if Interpreter strictJava throw new EvalError name else variables put name value public String getVariableNames if variables null return new String else return enumerationToStringArray variables keys public String getMethodNames if methods null return new String else return enumerationToStringArray methods keys public BshMethod getMethods if methods null return new BshMethod else return flattenMethodCollection methods elements private String enumerationToStringArray Enumeration Vector new Vector while hasMoreElements addElement nextElement String sa new String size copyInto sa return sa private BshMethod flattenMethodCollection Enumeration Vector new Vector while hasMoreElements Object nextElement if instanceof BshMethod addElement else Vector ov Vector for int ov size addElement ov elementAt BshMethod bma new BshMethod size copyInto bma return bma public NameSpace getParent return parent public NameSpace getSuper if parent null return parent else return this public NameSpace getGlobal if parent null return parent getGlobal else return this This getThis Interpreter declaringInterpreter if thisReference null thisReference This getThis this declaringInterpreter return thisReference public void prune setParent null public void setParent NameSpace parent this parent parent if parent null loadDefaultImports public Object getVariable String name return getVariable name true public Object getVariable String name boolean recurse Object val getVariableImpl name recurse return unwrapVariable val protected Object unwrapVariable Object val if val instanceof TypedVariable val TypedVariable val getValue return val null Primitive VOID val protected Object getVariableImpl String name boolean recurse Object val null if variables null val variables get name if recurse val null parent null val parent getVariableImpl name recurse return val public void setTypedVariable String name Class type Object value boolean isFinal throws EvalError if variables null variables new Hashtable if value null if type isPrimitive if type Boolean TYPE value new Primitive Boolean FALSE else if type Byte TYPE value new Primitive byte else if type Short TYPE value new Primitive short else if type Character TYPE value new Primitive char else if type Integer TYPE value new Primitive int else if type Long TYPE value new Primitive else if type Float TYPE value new Primitive else if type Double TYPE value new Primitive else value Primitive NULL if variables containsKey name Object existing getVariableImpl name false if existing instanceof TypedVariable if TypedVariable existing getType type throw new EvalError name TypedVariable existing getType else TypedVariable existing setValue value return variables put name new TypedVariable type value isFinal public void setMethod String name BshMethod method if methods null methods new Hashtable Object methods get name if null methods put name method else if instanceof BshMethod Vector new Vector addElement addElement method methods put name Vector addElement method public BshMethod getMethod String name Class sig BshMethod method null Object null if methods null methods get name if instanceof Vector Vector vm Vector BshMethod ma new BshMethod vm size vm copyInto ma Class candidates new Class ma length for int ma length candidates ma getArgTypes int match Reflect findMostSpecificSignature sig candidates if match method ma match else method BshMethod if method null parent null return parent getMethod name sig return method nameSpaceChanged nameSpaceChanged public String getImportedPackages Vector getImportedPackages true public Vector getImportedPackages boolean recurse if recurse else Vector new Vector if parent null String psa parent getImportedPackages for int psa length addElement psa return private void cacheClass Class if classCache null classCache new Hashtable classCache put name public Class getClass String name throws ClassPathException Class getClassImpl name if null return else if parent null return parent getClass name else return null private Class getClassImpl String name throws ClassPathException boolean unqualifiedName Name isCompound name Class null if classCache null Class classCache get name if null return if unqualifiedName getImportedClassImpl name if null cacheClass return classForName name if null if unqualifiedName cacheClass return if Interpreter DEBUG Interpreter debug name this return null private Class getImportedClassImpl String name throws ClassPathException String fullname null if fullname null Class clas classForName fullname if clas null if Name isCompound fullname try clas getNameResolver fullname toClass else if Interpreter DEBUG Interpreter debug if clas null BshClassManager cacheClassInfo fullname clas return clas else return clas return null Class classForName if null return if superImport BshClassManager bcm BshClassManager getClassManager if bcm null String bcm getClassNameByUnqName name if null return classForName return null private Class classForName String name return BshClassManager classForName name public String getAllNames Vector vec new Vector getAllNamesAux vec String names new String vec size vec copyInto names return names protected void getAllNamesAux Vector vec Enumeration varNames variables keys while varNames hasMoreElements vec addElement varNames nextElement Enumeration methodNames methods keys while methodNames hasMoreElements vec addElement methodNames nextElement if parent null parent getAllNamesAux vec Vector nameSourceListeners public void addNameSourceListener NameSource Listener listener if nameSourceListeners null nameSourceListeners new Vector nameSourceListeners addElement listener public static void doSuperImport throws EvalError BshClassManager bcm BshClassManager getClassManager if bcm null bcm doSuperImport superImport true static class TypedVariable implements java io Serializable Class type boolean isFinal TypedVariable Class type Object value boolean isFinal throws EvalError this type type if type null throw new InterpreterError value this isFinal isFinal setValue value void setValue Object val throws EvalError if isFinal value null throw new EvalError val getAssignableForm val type if val instanceof Primitive Primitive val isNumber try val BSHCastExpression castPrimitive Primitive val type catch EvalError throw new InterpreterError this value val Object getValue return value Class getType return type public String toString return type value public static Object checkAssignableFrom Object rhs Class lhsType throws EvalError return getAssignableForm rhs lhsType public static Object getAssignableForm Object rhs Class lhsType throws EvalError Class originalType if lhsType null throw new InterpreterError if rhs null throw new InterpreterError if rhs Primitive VOID throw new EvalError if rhs Primitive NULL if lhsType isPrimitive return rhs else throw new EvalError lhsType getName Class rhsType if rhs instanceof Primitive rhsType originalType Primitive rhs getType if lhsType isPrimitive else if Boolean class isAssignableFrom lhsType Character class isAssignableFrom lhsType Number class isAssignableFrom lhsType rhs Primitive rhs getValue rhsType rhs getClass else assignmentError lhsType originalType else rhsType originalType rhs getClass if lhsType isPrimitive if rhsType Boolean class rhs new Primitive Boolean rhs rhsType Boolean TYPE else if rhsType Character class rhs new Primitive Character rhs rhsType Character TYPE else if Number class isAssignableFrom rhsType rhs new Primitive Number rhs rhsType Primitive rhs getType else assignmentError lhsType originalType if Reflect isAssignableFrom lhsType rhsType return rhs if lhsType Short class if rhsType Byte class return new Short Number rhs shortValue if lhsType Integer class if rhsType Byte class rhsType Short class return new Integer Number rhs intValue if rhsType Character class return new Integer Number rhs intValue if lhsType Long class if rhsType Byte class rhsType Short class rhsType Integer class return new Long Number rhs longValue if rhsType Character class return new Long Number rhs longValue if lhsType Float class if rhsType Byte class rhsType Short class rhsType Integer class rhsType Long class return new Float Number rhs floatValue if rhsType Character class return new Float Number rhs floatValue if lhsType Double class if rhsType Byte class rhsType Short class rhsType Integer class rhsType Long class rhsType Float class return new Double Number rhs doubleValue if rhsType Character class return new Double Number rhs doubleValue if Capabilities canGenerateInterfaces lhsType isInterface rhs instanceof bsh This return bsh This rhs getInterface lhsType assignmentError lhsType originalType return rhs private static void assignmentError Class lhs Class rhs throws EvalError String lhsType Reflect normalizeClassName lhs String rhsType Reflect normalizeClassName rhs throw new EvalError rhsType lhsType public String toString return name null super toString name super toString private synchronized void writeObject java io ObjectOutputStream throws IOException defaultWriteObject public Object invokeMethod String methodName Object args Interpreter interpreter throws EvalError return invokeMethod methodName args interpreter null null public Object invokeMethod String methodName Object args Interpreter interpreter CallStack callstack SimpleNode callerInfo throws EvalError if callstack null callstack new CallStack callstack push this BshMethod meth getMethod methodName Reflect getTypes args if meth null return meth invokeDeclaredMethod args interpreter callstack callerInfo meth getMethod new Class null null if meth null return meth invokeDeclaredMethod new Object methodName args interpreter callstack callerInfo throw new EvalError methodName this public void classLoaderChanged nameSpaceChanged public void nameSpaceChanged classCache null public void loadDefaultImports Name getNameResolver String name return new Name this name public int getInvocationLine SimpleNode node getNode if node null return node getLineNumber else return public String getInvocationText SimpleNode node getNode if node null return node getText else return public static Class identifierToClass Name ClassIdentifier ci return ci getTargetClass public void clear variables null methods null superImport false if parent null loadDefaultImports classCache null public class HistoryTextField extends JTextField public HistoryTextField this null public HistoryTextField String name this name false true public HistoryTextField String name boolean instantPopups this name instantPopups true public HistoryTextField String name boolean instantPopups boolean enterAddsToHistory setBorder new CompoundBorder getBorder new HistoryBorder if name null historyModel HistoryModel getModel name MouseHandler mouseHandler new MouseHandler addMouseListener mouseHandler addMouseMotionListener mouseHandler this instantPopups instantPopups this enterAddsToHistory enterAddsToHistory index public void setInstantPopups boolean instantPopups this instantPopups instantPopups public boolean getInstantPopups return instantPopups public void setEnterAddsToHistory boolean enterAddsToHistory this enterAddsToHistory enterAddsToHistory public boolean setEnterAddsToHistory return enterAddsToHistory public void setSelectAllOnFocus boolean selectAllOnFocus this selectAllOnFocus selectAllOnFocus public boolean setSelectAllOnFocus return selectAllOnFocus public void setModel String name if name null historyModel null else historyModel HistoryModel getModel name index repaint public void addCurrentToHistory if historyModel null historyModel addItem getText index public void setText String text super setText text index public HistoryModel getModel return historyModel public void fireActionPerformed super fireActionPerformed protected void processKeyEvent KeyEvent evt if isEnabled return if evt getID KeyEvent KEY_PRESSED if evt getKeyCode KeyEvent VK_ENTER if enterAddsToHistory addCurrentToHistory if evt getModifiers fireActionPerformed evt consume else if evt getKeyCode KeyEvent VK_UP if evt isShiftDown doBackwardSearch else historyPrevious evt consume else if evt getKeyCode KeyEvent VK_DOWN if evt isShiftDown doForwardSearch else historyNext evt consume else if evt getKeyCode KeyEvent VK_TAB evt isControlDown doBackwardSearch evt consume if evt isConsumed super processKeyEvent evt protected void processMouseEvent MouseEvent evt if isEnabled return switch evt getID case MouseEvent MOUSE_PRESSED Border border getBorder Insets insets border getBorderInsets HistoryTextField this if evt getX getWidth insets right GUIUtilities isPopupTrigger evt if evt isShiftDown showPopupMenu getText substring getSelectionStart getHeight else showPopupMenu getHeight else super processMouseEvent evt break case MouseEvent MOUSE_EXITED setCursor Cursor getDefaultCursor super processMouseEvent evt break default super processMouseEvent evt break private HistoryModel historyModel private JPopupMenu popup private boolean instantPopups private boolean enterAddsToHistory private boolean selectAllOnFocus private String current private int index private void doBackwardSearch if historyModel null return if getSelectionEnd getDocument getLength setCaretPosition getDocument getLength String text getText substring getSelectionStart if text null historyPrevious return for int index historyModel getSize String item historyModel getItem if item startsWith text replaceSelection item substring text length select text length getDocument getLength index return getToolkit beep private void doForwardSearch if historyModel null return if getSelectionEnd getDocument getLength setCaretPosition getDocument getLength String text getText substring getSelectionStart if text null historyNext return for int index String item historyModel getItem if item startsWith text replaceSelection item substring text length select text length getDocument getLength index return getToolkit beep private void historyPrevious if historyModel null return if index historyModel getSize getToolkit beep else if index current getText setText historyModel getItem index else int newIndex index setText historyModel getItem newIndex index newIndex private void historyNext if historyModel null return if index getToolkit beep else if index setText current else int newIndex index setText historyModel getItem newIndex index newIndex private void showPopupMenu String text int int if historyModel null return requestFocus if popup null popup isVisible popup setVisible false return ActionHandler actionListener new ActionHandler popup new JPopupMenu JMenuItem caption new JMenuItem jEdit getProperty caption getModel setEnabled false popup add caption popup addSeparator for int historyModel getSize String item historyModel getItem if item startsWith text JMenuItem menuItem new JMenuItem item menuItem setActionCommand String valueOf menuItem addActionListener actionListener popup add menuItem GUIUtilities showPopupMenu popup this false class ActionHandler implements ActionListener public void actionPerformed ActionEvent evt int ind Integer parseInt evt getActionCommand if ind if index setText current else setText historyModel getItem ind index ind if instantPopups addCurrentToHistory fireActionPerformed class MouseHandler extends MouseInputAdapter boolean selectAll public void mousePressed MouseEvent evt selectAll hasFocus selectAllOnFocus public void mouseReleased MouseEvent evt SwingUtilities invokeLater new Runnable public void run if selectAll selectAll public void mouseMoved MouseEvent evt Border border getBorder Insets insets border getBorderInsets HistoryTextField this if evt getX getWidth insets right setCursor Cursor getDefaultCursor else setCursor Cursor getPredefinedCursor Cursor TEXT_CURSOR public void mouseDragged MouseEvent evt selectAll false static class HistoryBorder extends AbstractBorder static final int WIDTH public void paintBorder Component Graphics int int int int translate WIDTH int w2 WIDTH int h2 setColor UIManager getColor isEnabled HistoryTextField getModel null drawLine w2 h2 w2 h2 drawLine w2 h2 w2 h2 drawLine w2 h2 w2 h2 drawLine w2 h2 w2 h2 drawLine w2 h2 w2 h2 translate WIDTH public Insets getBorderInsets Component return new Insets WIDTH public class IntegerArray public IntegerArray array new int public void add int num if len array length int arrayN new int len System arraycopy array arrayN len array arrayN array len num public final int get int index return array index public final int getSize return len public final void setSize int len this len len public final void clear len private int array private int len public class LogViewer extends JPanel public LogViewer super new BorderLayout Box captionBox Box createHorizontalBox String settingsDirectory jEdit getSettingsDirectory if settingsDirectory null String args MiscUtilities constructPath settingsDirectory JLabel label new JLabel jEdit getProperty args captionBox add label captionBox add Box createHorizontalGlue tailIsOn jEdit getBooleanProperty false tail new JCheckBox jEdit getProperty tailIsOn tail addActionListener new ActionHandler captionBox add tail textArea new JTextArea textArea setDocument Log getLogDocument textArea getDocument addDocumentListener new DocumentHandler add BorderLayout NORTH captionBox add BorderLayout CENTER new JScrollPane textArea public boolean requestDefaultFocus textArea requestFocus return true private JTextArea textArea private JCheckBox tail private boolean tailIsOn class ActionHandler implements ActionListener public void actionPerformed ActionEvent tailIsOn tailIsOn jEdit setBooleanProperty tailIsOn if tailIsOn textArea setCaretPosition textArea getDocument getLength class DocumentHandler implements DocumentListener public void insertUpdate DocumentEvent if tailIsOn textArea setCaretPosition textArea getDocument getLength public void changedUpdate DocumentEvent public void removeUpdate DocumentEvent public class FileVFS extends VFS public static final String PERMISSIONS_PROPERTY public FileVFS super READ_CAP WRITE_CAP BROWSE_CAP DELETE_CAP RENAME_CAP MKDIR_CAP LOW_LATENCY_CAP public String getParentOfPath String path if OperatingSystem isDOSDerived if path length path charAt return FileRootsVFS PROTOCOL else if path length path endsWith return FileRootsVFS PROTOCOL else if path startsWith path indexOf return path return super getParentOfPath path public String constructPath String parent String path if parent endsWith File separator path parent path else path parent File separator path try return new File path getCanonicalPath catch IOException io return path public char getFileSeparator return File separatorChar public boolean load View view Buffer buffer String path File file new File MiscUtilities canonPath path if file exists buffer setNewFile true return true else buffer setReadOnly file canWrite if file isDirectory VFSManager error view file getPath null buffer setNewFile false return false if file canRead VFSManager error view file getPath null buffer setNewFile false return false return super load view buffer path public boolean save View view Buffer buffer String path File file new File path if file isDirectory VFSManager error view file getPath null return false if file exists file canWrite file exists new File file getParent canWrite VFSManager error view file getPath null return false if OperatingSystem isUnix int permissions getPermissions buffer getPath Log log Log DEBUG this buffer getPath Integer toString permissions buffer setIntegerProperty PERMISSIONS_PROPERTY permissions return super save view buffer path public boolean insert View view Buffer buffer String path File file new File path if file exists return false if file isDirectory VFSManager error view file getPath null return false if file canRead VFSManager error view file getPath null return false return super insert view buffer path public String Object session String path Component comp throws IOException return MiscUtilities canonPath path public VFS DirectoryEntry Object session String path Component comp if OperatingSystem isWindows if path length path charAt path path concat File separator File directory new File path File list directory listFiles if list null VFSManager error comp path null return null VFS DirectoryEntry list2 new VFS DirectoryEntry list length for int list length File file list int type if file isDirectory type VFS DirectoryEntry DIRECTORY else type VFS DirectoryEntry FILE list2 new VFS DirectoryEntry file getName file getPath file getPath type file length file isHidden return list2 public DirectoryEntry Object session String path Component comp if path equals OperatingSystem isUnix return new VFS DirectoryEntry path path path VFS DirectoryEntry DIRECTORY false if path endsWith path endsWith File separator path path substring path length File file new File path if file exists return null int type if file isDirectory type VFS DirectoryEntry DIRECTORY else type VFS DirectoryEntry FILE return new VFS DirectoryEntry file getName path path type file length file isHidden public boolean Object session String path Component comp boolean retVal new File path delete if retVal VFSManager sendVFSUpdate this path true return retVal public boolean Object session String from String to Component comp File new File to if from equalsIgnoreCase to delete boolean retVal new File from renameTo VFSManager sendVFSUpdate this from true VFSManager sendVFSUpdate this to true return retVal public boolean Object session String directory Component comp String parent getParentOfPath directory if new File parent exists if session parent comp return false boolean retVal new File directory mkdir VFSManager sendVFSUpdate this directory true return retVal public void Object session String path Component comp throws IOException int backups jEdit getIntegerProperty if backups return String backupPrefix jEdit getProperty String backupSuffix jEdit getProperty String backupDirectory MiscUtilities canonPath jEdit getProperty File file new File path if backupDirectory null backupDirectory length backupDirectory file getParent else backupDirectory MiscUtilities constructPath System getProperty backupDirectory backupDirectory MiscUtilities concatPath backupDirectory file getParent File dir new File backupDirectory if dir exists dir mkdirs MiscUtilities saveBackup file backups backupPrefix backupSuffix backupDirectory public InputStream Object session String path boolean ignoreErrors Component comp throws IOException try return new FileInputStream path catch IOException io if ignoreErrors return null else throw io public OutputStream Object session String path Component comp throws IOException OutputStream retVal new FileOutputStream path return retVal public void Object session Buffer buffer String path Component comp int permissions buffer getIntegerProperty PERMISSIONS_PROPERTY setPermissions path permissions public static int getPermissions String path int permissions if OperatingSystem isUnix String cmdarray path try Process process Runtime getRuntime exec cmdarray BufferedReader reader new BufferedReader new InputStreamReader process getInputStream String output reader readLine if output null String output substring permissions MiscUtilities parsePermissions catch Throwable return permissions public static void setPermissions String path int permissions if permissions if OperatingSystem isUnix String cmdarray Integer toString permissions path try Process process Runtime getRuntime exec cmdarray process getInputStream close process getOutputStream close process getErrorStream close int exitCode process waitFor if exitCode Log log Log NOTICE FileVFS class exitCode catch Throwable public class LoadSaveOptionPane extends AbstractOptionPane public LoadSaveOptionPane super public void autosave new JTextField jEdit getProperty addComponent jEdit getProperty autosave backups new JTextField jEdit getProperty addComponent jEdit getProperty backups backupDirectory new JTextField jEdit getProperty addComponent jEdit getProperty backupDirectory backupPrefix new JTextField jEdit getProperty addComponent jEdit getProperty backupPrefix backupSuffix new JTextField jEdit getProperty addComponent jEdit getProperty backupSuffix String lineSeps jEdit getProperty jEdit getProperty jEdit getProperty lineSeparator new JComboBox lineSeps String lineSep jEdit getProperty System getProperty if equals lineSep lineSeparator setSelectedIndex else if equals lineSep lineSeparator setSelectedIndex else if equals lineSep lineSeparator setSelectedIndex addComponent jEdit getProperty lineSeparator DefaultComboBoxModel encodings new DefaultComboBoxModel StringTokenizer st new StringTokenizer jEdit getProperty while st hasMoreTokens encodings addElement st nextToken encoding new JComboBox encodings encoding setEditable true encoding setSelectedItem jEdit getProperty System getProperty addComponent jEdit getProperty encoding restore new JCheckBox jEdit getProperty restore setSelected jEdit getBooleanProperty restore addActionListener new ActionListener public void actionPerformed ActionEvent evt restoreCLI setEnabled restore isSelected addComponent restore restoreCLI new JCheckBox jEdit getProperty restoreCLI setSelected jEdit getBooleanProperty restoreCLI setEnabled restore isSelected addComponent restoreCLI newView new JCheckBox jEdit getProperty newView setSelected jEdit getBooleanProperty addComponent newView persistentMarkers new JCheckBox jEdit getProperty persistentMarkers setSelected jEdit getBooleanProperty addComponent persistentMarkers twoStageSave new JCheckBox jEdit getProperty twoStageSave setSelected jEdit getBooleanProperty addComponent twoStageSave backupEverySave new JCheckBox jEdit getProperty backupEverySave setSelected jEdit getBooleanProperty addComponent backupEverySave stripTrailingEOL new JCheckBox jEdit getProperty stripTrailingEOL setSelected jEdit getBooleanProperty addComponent stripTrailingEOL public void jEdit setProperty autosave getText jEdit setProperty backups getText jEdit setProperty backupDirectory getText jEdit setProperty backupPrefix getText jEdit setProperty backupSuffix getText String lineSep null switch lineSeparator getSelectedIndex case lineSep break case lineSep break case lineSep break jEdit setProperty lineSep jEdit setProperty String encoding getSelectedItem jEdit setBooleanProperty restore isSelected jEdit setBooleanProperty restoreCLI isSelected jEdit setBooleanProperty newView isSelected jEdit setBooleanProperty persistentMarkers isSelected jEdit setBooleanProperty twoStageSave isSelected jEdit setBooleanProperty backupEverySave isSelected jEdit setBooleanProperty stripTrailingEOL isSelected private JTextField autosave private JTextField backups private JTextField backupDirectory private JTextField backupPrefix private JTextField backupSuffix private JComboBox lineSeparator private JComboBox encoding private JCheckBox restore private JCheckBox restoreCLI private JCheckBox newView private JCheckBox persistentMarkers private JCheckBox twoStageSave private JCheckBox backupEverySave private JCheckBox stripTrailingEOL class SimpleNode implements Node protected Node parent protected Node children protected int id Token firstToken lastToken String sourceFile public SimpleNode int id public void jjtOpen public void jjtClose public void jjtSetParent Node parent public Node jjtGetParent return parent public void jjtAddChild Node int if children null children new Node else if children length Node new Node System arraycopy children children length children children public Node jjtGetChild int return children public SimpleNode getChild int return SimpleNode jjtGetChild public int jjtGetNumChildren return children null children length public String toString return ParserTreeConstants jjtNodeName id public String toString String prefix return prefix toString public void dump String prefix System out println toString prefix if children null for int children length SimpleNode SimpleNode children if null dump prefix public void prune jjtSetParent null public Object eval NameSpace namespace throws EvalError throw new EvalError getClass getName public Object eval CallStack callstack Interpreter interpreter throws EvalError return eval callstack top public void setSourceFile String sourceFile this sourceFile sourceFile public String getSourceFile if sourceFile null if parent null return SimpleNode parent getSourceFile else return else return sourceFile public int getLineNumber return firstToken beginLine public String getText StringBuffer text new StringBuffer Token firstToken while null text append image if image equals text append if lastToken image equals image equals break next return text toString public class EditorStarted extends EBMessage public EditorStarted EBComponent source super source class BSHVariableDeclarator extends SimpleNode public String name BSHVariableDeclarator int id super id public Object eval BSHType typeNode CallStack callstack Interpreter interpreter throws EvalError Object value Primitive VOID if jjtGetNumChildren SimpleNode initializer SimpleNode jjtGetChild if typeNode null initializer instanceof BSHArrayInitializer value BSHArrayInitializer initializer eval typeNode getBaseType typeNode getArrayDims callstack interpreter else value initializer eval callstack interpreter return value public interface WorkThreadProgressListener extends EventListener void statusUpdate WorkThreadPool threadPool int threadIndex void progressUpdate WorkThreadPool threadPool int threadIndex public class ParserRuleSet public static ParserRuleSet getStandardRuleSet byte id return standard id public ParserRuleSet String name Mode mode this name name this mode mode ruleMapFirst new ParserRule RULE_BUCKET_COUNT ruleMapLast new ParserRule RULE_BUCKET_COUNT public String getName return name public Mode getMode return mode public Hashtable getProperties return props public void setProperties Hashtable props this props props null public void addRule ParserRule ruleCount int key Character toUpperCase hashChar RULE_BUCKET_COUNT ParserRule last ruleMapLast key if last null ruleMapFirst key ruleMapLast key else last next ruleMapLast key public ParserRule getRules char ch int key Character toUpperCase ch RULE_BUCKET_COUNT return ruleMapFirst key public int getRuleCount return ruleCount public int getTerminateChar return terminateChar public void setTerminateChar int atChar terminateChar atChar atChar public boolean getIgnoreCase return ignoreCase public void setIgnoreCase boolean ignoreCase public KeywordMap getKeywords return keywords public void setKeywords KeywordMap km keywords km null public boolean getHighlightDigits return highlightDigits public void setHighlightDigits boolean highlightDigits this highlightDigits highlightDigits public RE getDigitRegexp return digitRE public void setDigitRegexp RE digitRE this digitRE digitRE public ParserRule getEscapeRule return escapeRule public void setEscapeRule ParserRule escapeRule addRule escapeRule this escapeRule escapeRule public byte getDefault return defaultToken public void setDefault byte def defaultToken def public String getNoWordSep if null noWordSep if noWordSep null noWordSep if keywords null noWordSep keywords getNonAlphaNumericChars return noWordSep public void setNoWordSep String noWordSep this noWordSep noWordSep null public String toString return getClass getName mode null mode getName name private static ParserRuleSet standard static standard new ParserRuleSet Token ID_COUNT for byte standard length standard new ParserRuleSet null null standard setDefault private static final int RULE_BUCKET_COUNT private String name private Mode mode private Hashtable props private KeywordMap keywords private int ruleCount private ParserRule ruleMapFirst private ParserRule ruleMapLast private int terminateChar private boolean ignoreCase true private byte defaultToken private ParserRule escapeRule private boolean highlightDigits private RE digitRE private String private String noWordSep public class RESearchMatcher implements SearchMatcher public static final RESyntax RE_SYNTAX_JEDIT new RESyntax RESyntax RE_SYNTAX_PERL5 set RESyntax RE_CHAR_CLASSES setLineSeparator public RESearchMatcher String search String replace boolean ignoreCase boolean beanshell BshMethod replaceMethod throws Exception if beanshell replaceMethod null replace length this beanshell true this replaceMethod replaceMethod replaceNS new NameSpace BeanShell getNameSpace else this replace MiscUtilities escapesToChars replace re new RE search ignoreCase RE REG_ICASE RE REG_MULTILINE RE_SYNTAX_JEDIT returnValue new int public int nextMatch CharIndexed text boolean start boolean end boolean firstTime boolean reverse int flags if start flags RE REG_NOTBOL if end flags RE REG_NOTEOL REMatch match re getMatch text flags if match null return null int match getStartIndex int match getEndIndex if firstTime text move if text charAt CharIndexed OUT_OF_BOUNDS return null match re getMatch text flags RE REG_NOTBOL if match null return null else match getStartIndex match getEndIndex returnValue returnValue return returnValue public String substitute String text throws Exception REMatch match re getMatch text if match null return null if beanshell int count re getNumSubs for int count replaceNS setVariable match toString Object obj BeanShell runCachedBlock replaceMethod null replaceNS if obj null return else return obj toString else return match substituteInto replace private String replace private RE re private boolean beanshell private BshMethod replaceMethod private NameSpace replaceNS private int returnValue class HyperSearchRequest extends WorkRequest public HyperSearchRequest View view SearchMatcher matcher HyperSearchResults results Selection selection this view view this matcher matcher this results results this searchString SearchAndReplace getSearchString this rootSearchNode new DefaultMutableTreeNode searchString this selection selection public void run setStatus jEdit getProperty SearchFileSet fileset SearchAndReplace getSearchFileSet String files fileset getFiles view if files null files length SwingUtilities invokeLater new Runnable public void run GUIUtilities error view null return setProgressMaximum fileset getFileCount view long lastStatusTime try if selection null Buffer buffer view getBuffer searchInSelection buffer else int current loop for int files length String file files current long currentTime System currentTimeMillis if currentTime lastStatusTime setStatus jEdit getProperty new String file setProgressValue current lastStatusTime currentTime Buffer buffer jEdit openTemporary null null file false if buffer null continue loop doHyperSearch buffer catch final Exception Log log Log ERROR this SwingUtilities invokeLater new Runnable public void run GUIUtilities error view new String toString catch WorkThread Abort finally VFSManager runInAWTThread new Runnable public void run results searchDone rootSearchNode private View view private SearchMatcher matcher private HyperSearchResults results private DefaultMutableTreeNode rootSearchNode private Selection selection private String searchString private int searchInSelection Buffer buffer throws Exception setAbortable false int resultCount try buffer readLock for int selection length Selection selection if instanceof Selection Rect for int getStartLine getEndLine resultCount doHyperSearch buffer getStart buffer getEnd buffer else resultCount doHyperSearch buffer getStart getEnd finally buffer readUnlock setAbortable true return resultCount private int doHyperSearch Buffer buffer throws Exception return doHyperSearch buffer buffer getLength private int doHyperSearch Buffer buffer int start int end throws Exception setAbortable false final DefaultMutableTreeNode bufferNode new DefaultMutableTreeNode buffer getPath int resultCount doHyperSearch buffer start end bufferNode if resultCount rootSearchNode insert bufferNode rootSearchNode getChildCount setAbortable true return resultCount private int doHyperSearch Buffer buffer int start int end DefaultMutableTreeNode bufferNode int resultCount try buffer readLock boolean endOfLine buffer getLineEndOffset buffer getLineOfOffset end end Segment text new Segment int offset start int line loop for int counter counter boolean startOfLine buffer getLineStartOffset buffer getLineOfOffset offset offset buffer getText offset end offset text int match matcher nextMatch new CharIndexedSegment text false startOfLine endOfLine counter false if match null break loop int matchStart offset match int matchEnd offset match offset match int newLine buffer getLineOfOffset offset if line newLine continue loop line newLine resultCount bufferNode add new DefaultMutableTreeNode new HyperSearchResult buffer line matchStart matchEnd false finally buffer readUnlock return resultCount class ExtensionManager void addExtension int layer TextAreaExtension ext Entry entry new Entry layer ext for int extensions size int Entry extensions get layer if layer extensions add entry return extensions add entry void removeExtension TextAreaExtension ext for int extensions size Entry entry Entry extensions get if entry ext ext extensions remove return TextAreaExtension getExtensions TextAreaExtension retVal new TextAreaExtension extensions size for int extensions size retVal Entry extensions get ext return retVal void paintValidLine Graphics2D gfx int screenLine int physicalLine int start int end int for int extensions size TextAreaExtension ext Entry extensions get ext try ext paintValidLine gfx screenLine physicalLine start end catch Throwable Log log Log ERROR this extensions remove void paintInvalidLine Graphics2D gfx int screenLine int for int extensions size TextAreaExtension ext Entry extensions get ext try ext paintInvalidLine gfx screenLine catch Throwable Log log Log ERROR this extensions remove String getToolTipText int int for int extensions size TextAreaExtension ext Entry extensions get ext String toolTip ext getToolTipText if toolTip null return toolTip return null private ArrayList extensions new ArrayList static class Entry int layer TextAreaExtension ext Entry int layer TextAreaExtension ext this layer layer this ext ext class BlockNameSpace extends NameSpace boolean initMode public BlockNameSpace NameSpace parent throws EvalError super parent parent name public void setVariable String name Object throws EvalError if weHaveVar name initMode super setVariable name else getParent setVariable name public void setInitMode boolean initMode boolean weHaveVar String name return super getVariableImpl name false null public NameSpace getSuper return getParent getSuper This getThis Interpreter declaringInterpreter return getParent getThis declaringInterpreter public abstract class InputHandler extends KeyAdapter public InputHandler View view this view view public void processKeyEvent KeyEvent evt switch evt getID case KeyEvent KEY_TYPED keyTyped evt break case KeyEvent KEY_PRESSED keyPressed evt break case KeyEvent KEY_RELEASED keyReleased evt break public abstract void addKeyBinding String keyBinding EditAction action public abstract void removeKeyBinding String keyBinding public abstract void removeAllKeyBindings public boolean isPrefixActive return false public boolean isRepeatEnabled return repeat public void setRepeatEnabled boolean repeat boolean oldRepeat this repeat this repeat repeat repeatCount if oldRepeat repeat view getStatus setMessage null public int getRepeatCount return repeat repeatCount repeatCount public void setRepeatCount int repeatCount boolean oldRepeat this repeat repeat true this repeatCount repeatCount if oldRepeat repeat view getStatus setMessage null public EditAction getLastAction return lastAction public int getLastActionCount return lastActionCount public void readNextChar String msg String code view getStatus setMessage msg readNextChar code public void readNextChar String code readNextChar code public void resetLastActionCount lastAction null lastActionCount public void invokeAction EditAction action Buffer buffer view getBuffer if lastAction action lastActionCount else lastAction action lastActionCount boolean repeat int getRepeatCount if action noRepeat action invoke view else if REPEAT_COUNT_THRESHOLD String label action getLabel if label null label action getName else label GUIUtilities prettifyMenuLabel label Object pp label new Integer if GUIUtilities confirm view pp JOptionPane WARNING_MESSAGE JOptionPane YES_NO_OPTION JOptionPane YES_OPTION repeat false repeatCount view getStatus setMessage null return try buffer beginCompoundEdit for int action invoke view finally buffer endCompoundEdit Macros Recorder recorder view getMacroRecorder if recorder null action noRecord recorder record action getCode if if readNextChar null return repeat false repeatCount view getStatus setMessage null private static final int REPEAT_COUNT_THRESHOLD protected View view protected boolean repeat protected int repeatCount protected EditAction lastAction protected int lastActionCount protected String readNextChar protected void userInput char ch lastAction null if readNextChar null invokeReadNextChar ch else JEditTextArea textArea view getTextArea int getRepeatCount if textArea userInput ch else if REPEAT_COUNT_THRESHOLD Object pp String valueOf ch new Integer if GUIUtilities confirm view pp JOptionPane WARNING_MESSAGE JOptionPane YES_NO_OPTION JOptionPane YES_OPTION repeat false repeatCount view getStatus setMessage null return for int textArea userInput ch Macros Recorder recorder view getMacroRecorder if recorder null recorder record ch setRepeatEnabled false protected void invokeReadNextChar char ch Buffer buffer view getBuffer String charStr MiscUtilities charsToEscapes String valueOf ch int index while index readNextChar indexOf readNextChar readNextChar substring index charStr readNextChar substring index Macros Recorder recorder view getMacroRecorder if recorder null recorder record getRepeatCount readNextChar if getRepeatCount try buffer beginCompoundEdit BeanShell eval view BeanShell getNameSpace getRepeatCount readNextChar finally buffer endCompoundEdit else BeanShell eval view BeanShell getNameSpace readNextChar readNextChar null view getStatus setMessage null public interface NameSource public String getAllNames public void addNameSourceListener NameSource Listener listener public static interface Listener public void nameSourceChanged NameSource src class TokenMgrError extends Error static final int LEXICAL_ERROR static final int STATIC_LEXER_ERROR static final int INVALID_LEXICAL_STATE static final int LOOP_DETECTED int errorCode protected static final String addEscapes String str StringBuffer retval new StringBuffer char ch for int str length switch str charAt case continue case retval append continue case retval append continue case retval append continue case retval append continue case retval append continue case retval append continue case retval append continue case retval append continue default if ch str charAt ch String Integer toString ch retval append substring length length else retval append ch continue return retval toString private static final String LexicalError boolean EOFSeen int lexState int errorLine int errorColumn String errorAfter char curChar return errorLine errorColumn EOFSeen addEscapes String valueOf curChar int curChar addEscapes errorAfter public String getMessage return super getMessage public TokenMgrError public TokenMgrError String message int reason super message errorCode reason public TokenMgrError boolean EOFSeen int lexState int errorLine int errorColumn String errorAfter char curChar int reason this LexicalError EOFSeen lexState errorLine errorColumn errorAfter curChar reason public class CallStack private Vector stack new Vector public void clear stack removeAllElements public void push NameSpace ns stack insertElementAt ns public NameSpace top return get public NameSpace get int depth if depth depth return NameSpace JAVACODE else return NameSpace stack elementAt depth public void set int depth NameSpace ns stack setElementAt ns depth public NameSpace pop if depth throw new InterpreterError NameSpace top top stack removeElementAt return top public NameSpace swap NameSpace newTop NameSpace oldTop NameSpace stack elementAt stack setElementAt newTop return oldTop public int depth return stack size public NameSpace toArray NameSpace nsa new NameSpace depth stack copyInto nsa return nsa public String toString StringBuffer sb new StringBuffer sb append NameSpace nsa toArray for int nsa length sb append nsa return sb toString public class HyperSearchResults extends JPanel implements EBComponent public static final String NAME public HyperSearchResults View view super new BorderLayout this view view caption new JLabel JPanel topPanel new JPanel new BorderLayout topPanel add BorderLayout CENTER caption multi new JCheckBox jEdit getProperty topPanel add BorderLayout EAST multi multi addActionListener new ActionHandler add BorderLayout NORTH topPanel resultTreeRoot new DefaultMutableTreeNode resultTreeModel new DefaultTreeModel resultTreeRoot resultTree new JTree resultTreeModel resultTree setCellRenderer new ResultCellRenderer resultTree setVisibleRowCount resultTree setRootVisible false resultTree setShowsRootHandles true if OperatingSystem isMacOSLF resultTree putClientProperty resultTree setEditable false resultTree addKeyListener new KeyHandler resultTree addMouseListener new MouseHandler JScrollPane scrollPane new JScrollPane resultTree Dimension dim scrollPane getPreferredSize dim width scrollPane setPreferredSize dim add BorderLayout CENTER scrollPane public boolean requestDefaultFocus resultTree grabFocus return true public void addNotify super addNotify EditBus addToBus this multi setSelected jEdit getBooleanProperty public void removeNotify super removeNotify EditBus removeFromBus this jEdit setBooleanProperty multi isSelected public void handleMessage EBMessage msg if msg instanceof BufferUpdate BufferUpdate bmsg BufferUpdate msg Buffer buffer bmsg getBuffer Object what bmsg getWhat if what BufferUpdate LOADED what BufferUpdate CLOSED ResultVisitor visitor null if what BufferUpdate LOADED visitor new BufferLoadedVisitor visitor new BufferClosedVisitor for int resultTreeRoot getChildCount DefaultMutableTreeNode searchNode DefaultMutableTreeNode resultTreeRoot getChildAt for int searchNode getChildCount DefaultMutableTreeNode bufferNode DefaultMutableTreeNode searchNode getChildAt for int bufferNode getChildCount Object userObject DefaultMutableTreeNode bufferNode getChildAt getUserObject HyperSearchResult result HyperSearchResult userObject if buffer getPath equals result path visitor visit buffer result public DefaultTreeModel getTreeModel return resultTreeModel public JTree getTree return resultTree public void searchStarted caption setText jEdit getProperty public void searchFailed caption setText jEdit getProperty for int resultTreeRoot getChildCount DefaultMutableTreeNode node DefaultMutableTreeNode resultTreeRoot getChildAt resultTree collapsePath new TreePath new Object resultTreeRoot node public void searchDone final DefaultMutableTreeNode searchNode final int nodeCount searchNode getChildCount if nodeCount searchFailed return caption setText jEdit getProperty SwingUtilities invokeLater new Runnable public void run if multi isSelected for int resultTreeRoot getChildCount resultTreeRoot remove resultTreeRoot add searchNode resultTreeModel reload resultTreeRoot TreePath lastNode null for int nodeCount lastNode new TreePath DefaultMutableTreeNode searchNode getChildAt getPath resultTree expandPath lastNode resultTree scrollPathToVisible new TreePath new Object resultTreeRoot searchNode private View view private JLabel caption private JTree resultTree private DefaultMutableTreeNode resultTreeRoot private DefaultTreeModel resultTreeModel private JCheckBox multi private void goToSelectedNode TreePath path resultTree getSelectionPath if path null return DefaultMutableTreeNode node DefaultMutableTreeNode path getLastPathComponent Object value node getUserObject if node getParent resultTreeRoot else if value instanceof String Buffer buffer jEdit openFile view String value if buffer null return view setBuffer buffer SwingUtilities invokeLater new Runnable public void run resultTree requestFocus else if value instanceof HyperSearchResult final HyperSearchResult result HyperSearchResult value final Buffer buffer result getBuffer if buffer null return VFSManager runInAWTThread new Runnable public void run int start result startPos getOffset int end result endPos getOffset Selection new Selection Range start end view setBuffer buffer JEditTextArea textArea view getTextArea if textArea isMultipleSelectionEnabled textArea addToSelection else textArea setSelection textArea moveCaretPosition end public class ActionHandler implements ActionListener public void actionPerformed ActionEvent evt if multi isSelected for int resultTreeRoot getChildCount resultTreeModel removeNodeFromParent MutableTreeNode resultTreeRoot getChildAt class KeyHandler extends KeyAdapter public void keyPressed KeyEvent evt if evt getKeyCode KeyEvent VK_ENTER goToSelectedNode SwingUtilities invokeLater new Runnable public void run resultTree requestFocus evt consume class MouseHandler extends MouseAdapter public void mousePressed MouseEvent evt if evt isConsumed return TreePath path1 resultTree getPathForLocation evt getX evt getY if path1 null return resultTree setSelectionPath path1 if GUIUtilities isPopupTrigger evt showPopupMenu evt else goToSelectedNode view toFront view requestFocus view getTextArea requestFocus private JPopupMenu popupMenu private void showPopupMenu MouseEvent evt if popupMenu null popupMenu new JPopupMenu popupMenu add new RemoveTreeNodeAction GUIUtilities showPopupMenu popupMenu evt getComponent evt getX evt getY evt consume class RemoveTreeNodeAction extends AbstractAction public RemoveTreeNodeAction super jEdit getProperty public void actionPerformed ActionEvent evt TreePath path resultTree getSelectionPath if path null return MutableTreeNode value MutableTreeNode path getLastPathComponent resultTreeModel removeNodeFromParent value class ResultCellRenderer extends DefaultTreeCellRenderer Font plainFont boldFont ResultCellRenderer plainFont UIManager getFont boldFont new Font plainFont getName Font BOLD plainFont getSize public Component getTreeCellRendererComponent JTree tree Object value boolean sel boolean expanded boolean leaf int row boolean hasFocus Component comp super getTreeCellRendererComponent tree value sel expanded leaf row hasFocus setIcon null DefaultMutableTreeNode node DefaultMutableTreeNode value if node getParent resultTreeRoot ResultCellRenderer this setFont boldFont int bufferCount node getChildCount int resultCount for int bufferCount resultCount node getChildAt getChildCount Object pp node toString new Integer resultCount new Integer bufferCount setText jEdit getProperty pp else if node getUserObject instanceof String ResultCellRenderer this setFont boldFont int count node getChildCount if count setText jEdit getProperty new Object node getUserObject else setText jEdit getProperty new Object node getUserObject new Integer count else ResultCellRenderer this setFont plainFont return this interface ResultVisitor public void visit Buffer buffer HyperSearchResult result class BufferLoadedVisitor implements ResultVisitor public void visit Buffer buffer HyperSearchResult result result bufferOpened buffer class BufferClosedVisitor implements ResultVisitor public void visit Buffer buffer HyperSearchResult result result bufferClosed public class MacrosMenu extends EnhancedMenu implements EBComponent public MacrosMenu super updateMacrosMenu public void addNotify super addNotify EditBus addToBus this public void removeNotify super removeNotify EditBus removeFromBus this public void handleMessage EBMessage msg if msg instanceof MacrosChanged updateMacrosMenu public void init super init updateMacrosMenu private void updateMacrosMenu if initialized return for int getMenuComponentCount if getMenuComponent instanceof JSeparator break else remove int count getMenuComponentCount Vector macroVector Macros getMacroHierarchy createMacrosMenu this macroVector if count getMenuComponentCount add GUIUtilities loadMenuItem private void createMacrosMenu JMenu menu Vector vector int start Vector menuItems new Vector for int start vector size Object obj vector elementAt if obj instanceof Macros Macro Macros Macro macro Macros Macro obj menuItems add new EnhancedMenuItem macro getLabel macro else if obj instanceof Vector Vector subvector Vector obj String name String subvector elementAt JMenu submenu new JMenu name createMacrosMenu submenu subvector if submenu getMenuComponentCount menuItems add submenu Collections sort menuItems new MiscUtilities MenuItemCompare for int menuItems size menu add JMenuItem menuItems get class BSHSwitchStatement extends SimpleNode implements ParserConstants public BSHSwitchStatement int id super id public Object eval CallStack callstack Interpreter interpreter throws EvalError int numchild jjtGetNumChildren int child SimpleNode switchExp SimpleNode jjtGetChild child Object switchVal switchExp eval callstack interpreter BSHSwitchLabel label Object node ReturnControl returnControl null if child numchild throw new EvalError label BSHSwitchLabel jjtGetChild child while child numchild returnControl null if label isDefault label eval callstack interpreter equals switchVal while child numchild node jjtGetChild child if node instanceof BSHSwitchLabel continue Object value SimpleNode node eval callstack interpreter if value instanceof ReturnControl returnControl ReturnControl value break else while child numchild node jjtGetChild child if node instanceof BSHSwitchLabel label BSHSwitchLabel node break if returnControl null returnControl kind RETURN return returnControl else return Primitive VOID public class FavoritesVFS extends VFS public static final String PROTOCOL public FavoritesVFS super DELETE_CAP LOW_LATENCY_CAP instance this public String getParentOfPath String path return PROTOCOL public VFS DirectoryEntry Object session String url Component comp synchronized lock if favorites null loadFavorites VFS DirectoryEntry retVal new VFS DirectoryEntry favorites size for int retVal length String favorite String favorites get retVal session favorite comp return retVal public DirectoryEntry Object session String path Component comp return new VFS DirectoryEntry path path path VFS DirectoryEntry DIRECTORY false public boolean Object session String path Component comp synchronized lock path path substring PROTOCOL length favorites remove path VFSManager sendVFSUpdate this PROTOCOL false return true public static void loadFavorites favorites new ArrayList synchronized lock String favorite int while favorite jEdit getProperty null favorites add favorite public static void addToFavorites String path synchronized lock if favorites null loadFavorites if favorites contains path favorites add path VFSManager sendVFSUpdate instance PROTOCOL false public static void saveFavorites synchronized lock if favorites null return for int favorites size jEdit setProperty String favorites get jEdit unsetProperty favorites size public static Object getFavorites synchronized lock if favorites null loadFavorites return favorites toArray private static FavoritesVFS instance private static Object lock new Object private static ArrayList favorites class ModeCatalogHandler extends HandlerBase ModeCatalogHandler String directory boolean resource this directory directory this resource resource public Object resolveEntity String publicId String systemId if equals systemId return new StringReader return null public void attribute String aname String value boolean isSpecified aname aname null null aname intern if aname modeName value else if aname if value null Log log Log ERROR this directory modeName else file value else if aname filenameGlob value else if aname firstlineGlob value public void doctypeDecl String name String publicId String systemId throws Exception if equals name equals name return Log log Log ERROR this directory public void endElement String name if name equals Mode mode jEdit getMode modeName if mode null mode new Mode modeName jEdit addMode mode Object path if resource path jEdit class getResource directory file else path MiscUtilities constructPath directory file mode setProperty path if filenameGlob null mode setProperty filenameGlob else mode unsetProperty if firstlineGlob null mode setProperty firstlineGlob else mode unsetProperty mode init modeName file filenameGlob firstlineGlob null private String directory private boolean resource private String modeName private String file private String filenameGlob private String firstlineGlob public class ReflectManagerImpl extends ReflectManager public boolean setAccessible Object obj if obj instanceof AccessibleObject AccessibleObject obj setAccessible true return true else return false public abstract class EBPlugin extends EditPlugin implements EBComponent public void handleMessage EBMessage message Log log Log WARNING this getClassName EditBus removeFromBus this protected EBPlugin public class JCheckBoxList extends JTable public JCheckBoxList Object items setModel items public JCheckBoxList Vector items setModel items public void setModel Object items setModel new CheckBoxListModel items init public void setModel Vector items setModel new CheckBoxListModel items init public Object getCheckedValues Vector values new Vector CheckBoxListModel model CheckBoxListModel getModel for int model items size Entry entry Entry model items elementAt if entry checked entry caption values addElement entry value Object retVal new Object values size values copyInto retVal return retVal public void selectAll CheckBoxListModel model CheckBoxListModel getModel for int model items size Entry entry Entry model items elementAt if entry caption entry checked true model fireTableRowsUpdated model getRowCount public Entry getValues CheckBoxListModel model CheckBoxListModel getModel Entry retVal new Entry model items size model items copyInto retVal return retVal public Object getSelectedValue int row getSelectedRow if row return null else return getModel getValueAt row public TableCellRenderer getCellRenderer int row int column if column Entry entry Entry CheckBoxListModel getModel items get row if entry caption return dummy return super getCellRenderer row column private TableCellRenderer dummy private void init dummy new DummyRenderer getSelectionModel setSelectionMode ListSelectionModel SINGLE_SELECTION setShowGrid false setAutoResizeMode JTable AUTO_RESIZE_LAST_COLUMN TableColumn column getColumnModel getColumn int checkBoxWidth new JCheckBox getPreferredSize width column setPreferredWidth checkBoxWidth column setMinWidth checkBoxWidth column setWidth checkBoxWidth column setMaxWidth checkBoxWidth column setResizable false column getColumnModel getColumn column setCellRenderer new LabelRenderer public static class Entry boolean checked boolean caption Object value public Entry Object value this caption true this value value public Entry boolean checked Object value this checked checked this value value public boolean isChecked return checked public Object getValue return value private class DummyRenderer extends DefaultTableCellRenderer public Component getTableCellRendererComponent JTable table Object value boolean isSelected boolean hasFocus int row int column private class LabelRenderer extends DefaultTableCellRenderer Font plainFont boldFont LabelRenderer plainFont UIManager getFont boldFont plainFont deriveFont Font BOLD public Component getTableCellRendererComponent JTable table Object value boolean isSelected boolean hasFocus int row int column super getTableCellRendererComponent table value isSelected hasFocus row column Entry entry Entry CheckBoxListModel getModel items get row if entry caption setFont boldFont else setFont plainFont return this class CheckBoxListModel extends AbstractTableModel Vector items CheckBoxListModel Vector items new Vector size for int size items addElement createEntry elementAt CheckBoxListModel Object items new Vector length for int length items addElement createEntry private JCheckBoxList Entry createEntry Object obj if obj instanceof JCheckBoxList Entry return JCheckBoxList Entry obj else return new JCheckBoxList Entry false obj public int getRowCount return items size public int getColumnCount return public String getColumnName int col return null public Object getValueAt int row int col JCheckBoxList Entry entry JCheckBoxList Entry items elementAt row switch col case return new Boolean entry checked case return entry value default throw new InternalError public Class getColumnClass int col switch col case return Boolean class case return String class default throw new InternalError public boolean isCellEditable int row int col JCheckBoxList Entry entry JCheckBoxList Entry items elementAt row return col entry caption public void setValueAt Object value int row int col if col JCheckBoxList Entry entry JCheckBoxList Entry items elementAt row if entry caption entry checked value equals Boolean TRUE fireTableRowsUpdated row row class RETokenStart extends REToken RETokenStart int subIndex String newline super subIndex this newline newline boolean match CharIndexed input REMatch mymatch if newline null int len newline length if mymatch offset len boolean found true char char ch input charAt mymatch index len do newline charAt if ch found false break ch input charAt mymatch index len while len if found return next input mymatch if mymatch eflags RE REG_NOTBOL return false if mymatch eflags RE REG_ANCHORINDEX return mymatch anchor mymatch offset next input mymatch false else return mymatch index mymatch offset next input mymatch false void dump StringBuffer os os append public class BoyerMooreSearchMatcher implements SearchMatcher public BoyerMooreSearchMatcher String pattern String replace boolean ignoreCase boolean beanshell BshMethod replaceMethod if ignoreCase this pattern pattern toUpperCase toCharArray else this pattern pattern toCharArray this replace replace this ignoreCase ignoreCase if beanshell replaceMethod null replace length this beanshell true this replaceMethod replaceMethod replaceNS new NameSpace BeanShell getNameSpace pattern_end this pattern length returnValue new int public int nextMatch CharIndexed text boolean start boolean end boolean firstTime boolean reverse int pos match text reverse if pos return null else returnValue pos returnValue pos pattern length return returnValue public String substitute String text throws Exception if beanshell replaceNS setVariable text Object obj BeanShell runCachedBlock replaceMethod null replaceNS if obj null return else return obj toString else return replace public int match CharIndexed text boolean reverse int skip suffix if reverse if back_skip null back_skip generateSkipArray true back_suffix generateSuffixArray true skip back_skip suffix back_suffix else if fwd_skip null fwd_skip generateSkipArray false fwd_suffix generateSuffixArray false skip fwd_skip suffix fwd_suffix int pos int anchor char ch int bad_char int good_suffix SEARCH while text isValid for pos pattern_end pos pos ch text charAt pos if ignoreCase ch Character toUpperCase ch if reverse ch pattern pattern_end pos ch pattern pos bad_char pos skip getSkipIndex ch good_suffix suffix pos int skip_index bad_char good_suffix bad_char good_suffix anchor skip_index text move skip_index continue SEARCH return anchor return private char pattern private int pattern_end private String replace private boolean ignoreCase private boolean beanshell private BshMethod replaceMethod private NameSpace replaceNS private int fwd_skip private int fwd_suffix private int back_skip private int back_suffix private int returnValue private int generateSkipArray boolean reverse int skip new int if pattern length return skip int pos do skip getSkipIndex pattern reverse pattern_end pos pos pos while pos pattern length return skip private static final int getSkipIndex char ch return int ch private int generateSuffixArray boolean reverse int pattern length int int suffix new int int tmp new int tmp for int while pattern reverse pattern_end pattern reverse pattern_end if suffix suffix tmp tmp int tmp for if suffix suffix suffix if tmp return suffix public class PluginResURLConnection extends URLConnection public PluginResURLConnection URL url throws IOException super url String file url getFile int index file indexOf if index plugin null resource file else int start if file charAt start else start plugin file substring start index resource file substring index if plugin null resource startsWith resource resource substring public void connect throws IOException if connected if plugin null in jEdit class getResourceAsStream resource else EditPlugin JAR plugins jEdit getPluginJARs for int plugins length EditPlugin JAR jar plugins if MiscUtilities getFileName jar getPath equalsIgnoreCase plugin in jar getClassLoader getResourceAsStream resource break if in null throw new IOException resource connected true public InputStream getInputStream throws IOException connect return in public String getHeaderField String name if name equals String lcResource resource toLowerCase if lcResource endsWith return else if lcResource endsWith return else if lcResource endsWith return else if lcResource endsWith return else if lcResource endsWith lcResource endsWith return else return null else return null private InputStream in private String plugin private String resource public class EditingOptionPane extends AbstractOptionPane public EditingOptionPane super protected void Mode modes jEdit getModes defaultMode new JComboBox modes defaultMode setSelectedItem jEdit getMode jEdit getProperty addComponent jEdit getProperty defaultMode undoCount new JTextField jEdit getProperty addComponent jEdit getProperty undoCount addSeparator global new ModeProperties modeProps new ModeProperties modes length String modeNames new String modes length modeNames jEdit getProperty for int modes length modeProps new ModeProperties modes modeNames modes getName mode new JComboBox modeNames mode addActionListener new ActionHandler addComponent jEdit getProperty mode useDefaults new JCheckBox jEdit getProperty useDefaults addActionListener new ActionHandler addComponent useDefaults addComponent jEdit getProperty noWordSep new JTextField String foldModes FoldHandler getFoldModes addComponent jEdit getProperty folding new JComboBox foldModes addComponent jEdit getProperty collapseFolds new JTextField String wrapModes addComponent jEdit getProperty wrap new JComboBox wrapModes String lineLens addComponent jEdit getProperty maxLineLen new JComboBox lineLens maxLineLen setEditable true String tabSizes addComponent jEdit getProperty tabSize new JComboBox tabSizes tabSize setEditable true addComponent jEdit getProperty indentSize new JComboBox tabSizes indentSize setEditable true addComponent noTabs new JCheckBox jEdit getProperty addComponent jEdit getProperty filenameGlob new JTextField addComponent jEdit getProperty firstlineGlob new JTextField selectMode protected void jEdit setProperty Mode defaultMode getSelectedItem getName jEdit setProperty undoCount getText saveMode global save for int modeProps length modeProps save private JComboBox defaultMode private JTextField undoCount private ModeProperties global private ModeProperties modeProps private ModeProperties current private JComboBox mode private JCheckBox useDefaults private JTextField filenameGlob private JTextField firstlineGlob private JTextField noWordSep private JComboBox folding private JTextField collapseFolds private JComboBox wrap private JComboBox maxLineLen private JComboBox tabSize private JComboBox indentSize private JCheckBox noTabs private void saveMode current useDefaults useDefaults isSelected current filenameGlob filenameGlob getText current firstlineGlob firstlineGlob getText current noWordSep noWordSep getText current folding String folding getSelectedItem current collapseFolds collapseFolds getText current wrap String wrap getSelectedItem current maxLineLen String maxLineLen getSelectedItem current tabSize String tabSize getSelectedItem current indentSize String indentSize getSelectedItem current noTabs noTabs isSelected private void selectMode int index mode getSelectedIndex current index global modeProps index current edited true current load useDefaults setSelected current useDefaults filenameGlob setText current filenameGlob firstlineGlob setText current firstlineGlob noWordSep setText current noWordSep folding setSelectedItem current folding collapseFolds setText current collapseFolds wrap setSelectedItem current wrap maxLineLen setSelectedItem current maxLineLen tabSize setSelectedItem current tabSize indentSize setSelectedItem current indentSize noTabs setSelected current noTabs updateEnabled private void updateEnabled if current global useDefaults setEnabled false filenameGlob setEnabled false firstlineGlob setEnabled false noWordSep setEnabled true folding setEnabled true collapseFolds setEnabled true wrap setEnabled true maxLineLen setEnabled true tabSize setEnabled true indentSize setEnabled true noTabs setEnabled true else useDefaults setEnabled true boolean enabled modeProps mode getSelectedIndex useDefaults filenameGlob setEnabled enabled firstlineGlob setEnabled enabled noWordSep setEnabled enabled folding setEnabled enabled collapseFolds setEnabled enabled wrap setEnabled enabled maxLineLen setEnabled enabled tabSize setEnabled enabled indentSize setEnabled enabled noTabs setEnabled enabled class ActionHandler implements ActionListener public void actionPerformed ActionEvent evt if evt getSource mode saveMode selectMode else if evt getSource useDefaults modeProps mode getSelectedIndex useDefaults useDefaults isSelected updateEnabled class ModeProperties Mode mode boolean edited boolean loaded boolean useDefaults String filenameGlob String firstlineGlob String noWordSep String folding String collapseFolds String wrap String maxLineLen String tabSize String indentSize boolean noTabs ModeProperties ModeProperties Mode mode this mode mode void load if loaded return loaded true if mode null mode loadIfNecessary useDefaults jEdit getBooleanProperty mode getName filenameGlob String mode getProperty firstlineGlob String mode getProperty noWordSep String mode getProperty folding mode getProperty toString collapseFolds mode getProperty toString wrap mode getProperty toString maxLineLen mode getProperty toString tabSize mode getProperty toString indentSize mode getProperty toString noTabs mode getBooleanProperty else noWordSep jEdit getProperty folding jEdit getProperty collapseFolds jEdit getProperty wrap jEdit getProperty maxLineLen jEdit getProperty tabSize jEdit getProperty indentSize jEdit getProperty noTabs jEdit getBooleanProperty void save if edited return String prefix if mode null prefix mode getName jEdit setBooleanProperty prefix useDefaults String oldFilenameGlob String mode getProperty String oldFirstlineGlob String mode getProperty if useDefaults jEdit resetProperty prefix jEdit resetProperty prefix jEdit resetProperty prefix jEdit resetProperty prefix jEdit resetProperty prefix jEdit resetProperty prefix jEdit resetProperty prefix jEdit resetProperty prefix jEdit resetProperty prefix jEdit resetProperty prefix if MiscUtilities stringsEqual oldFilenameGlob String mode getProperty MiscUtilities stringsEqual oldFirstlineGlob String mode getProperty mode init return else jEdit setProperty prefix filenameGlob jEdit setProperty prefix firstlineGlob if MiscUtilities stringsEqual oldFilenameGlob filenameGlob MiscUtilities stringsEqual oldFirstlineGlob firstlineGlob mode init else prefix jEdit setProperty prefix noWordSep jEdit setProperty prefix folding jEdit setProperty prefix collapseFolds jEdit setProperty prefix wrap jEdit setProperty prefix maxLineLen jEdit setProperty prefix tabSize jEdit setProperty prefix indentSize jEdit setBooleanProperty prefix noTabs public interface ConsoleInterface public Reader getIn public PrintStream getOut public PrintStream getErr public void println String public void print String public void error String public class JEditTextArea extends JComponent public JEditTextArea View view enableEvents AWTEvent FOCUS_EVENT_MASK AWTEvent KEY_EVENT_MASK this view view selection new Vector chunkCache new ChunkCache this painter new TextAreaPainter this gutter new Gutter view this bufferHandler new BufferChangeHandler listenerList new EventListenerList caretEvent new MutableCaretEvent bracketLine bracketPosition blink true lineSegment new Segment returnValue new Point runnables new ArrayList setLayout new ScrollLayout add LEFT gutter add CENTER painter add RIGHT vertical new JScrollBar JScrollBar VERTICAL add BOTTOM horizontal new JScrollBar JScrollBar HORIZONTAL horizontal setValues if UIManager getLookAndFeel instanceof MetalLookAndFeel setBorder new TextAreaBorder vertical putClientProperty Boolean FALSE horizontal putClientProperty Boolean FALSE vertical addAdjustmentListener new AdjustHandler horizontal addAdjustmentListener new AdjustHandler mouseHandler new MouseHandler painter addMouseListener mouseHandler painter addMouseMotionListener mouseHandler addFocusListener new FocusHandler focusedComponent this public final TextAreaPainter getPainter return painter public final Gutter getGutter return gutter public FoldVisibilityManager getFoldVisibilityManager return foldVisibilityManager public final boolean isCaretBlinkEnabled return caretBlinks public void setCaretBlinkEnabled boolean caretBlinks this caretBlinks caretBlinks if caretBlinks blink false if buffer null invalidateLine caretLine public final int getElectricScroll return electricScroll public final void setElectricScroll int electricScroll this electricScroll electricScroll public final boolean isQuickCopyEnabled return quickCopy public final void setQuickCopyEnabled boolean quickCopy this quickCopy quickCopy public final Buffer getBuffer return buffer public void setBuffer Buffer buffer if this buffer buffer return try bufferChanging true if this buffer null selectNone caretLine caret caretScreenLine bracketLine bracketPosition this buffer foldVisibilityManager this buffer removeBufferChangeListener bufferHandler this buffer buffer foldVisibilityManager buffer this buffer addBufferChangeListener bufferHandler bufferHandlerInstalled true firstLine maxHorizontalScrollWidth physFirstLine foldVisibilityManager getFirstVisibleLine chunkCache setFirstLine physFirstLine true propertiesChanged recalculateLastPhysicalLine painter repaint gutter repaint updateScrollBars fireScrollEvent true finally bufferChanging false public final boolean isEditable return buffer isEditable public final JPopupMenu getRightClickPopup return popup public final void setRightClickPopup JPopupMenu popup this popup popup public final int getFirstLine return firstLine public void setFirstLine int firstLine if firstLine this firstLine return firstLine view synchroScrollVertical this firstLine public void int firstLine firstLine Math max Math min getVirtualLineCount firstLine this firstLine firstLine physFirstLine virtualToPhysical firstLine maxHorizontalScrollWidth chunkCache setFirstLine firstLine physFirstLine false recalculateLastPhysicalLine painter repaint gutter repaint if this firstLine vertical getValue updateScrollBars fireScrollEvent true public final int getVisibleLines return visibleLines public final int getFirstPhysicalLine return physFirstLine public final int getLastPhysicalLine return physLastLine public final int getHorizontalOffset return horizontalOffset public void setHorizontalOffset int horizontalOffset if horizontalOffset this horizontalOffset return horizontalOffset view synchroScrollHorizontal this horizontalOffset public void int horizontalOffset this horizontalOffset horizontalOffset if horizontalOffset horizontal getValue updateScrollBars painter repaint fireScrollEvent false public void updateScrollBars if vertical null visibleLines int lineCount getVirtualLineCount if softWrap lineCount visibleLines if lineCount firstLine visibleLines int newFirstLine Math max lineCount visibleLines if newFirstLine firstLine setFirstLine newFirstLine return vertical setValues firstLine visibleLines lineCount vertical setUnitIncrement vertical setBlockIncrement visibleLines int width painter getWidth if horizontal null width maxHorizontalScrollWidth painter repaint horizontal setUnitIncrement painter getFontMetrics charWidth horizontal setBlockIncrement width public void scrollUpLine if firstLine setFirstLine firstLine public void scrollUpPage if firstLine int newFirstLine if softWrap newFirstLine firstLine int screenLineCount while newFirstLine int lines chunkCache getLineInfosForPhysicalLine newFirstLine length if screenLineCount lines visibleLines break else screenLineCount lines else newFirstLine firstLine visibleLines setFirstLine newFirstLine public void scrollDownLine int numLines getVirtualLineCount if softWrap firstLine numLines firstLine visibleLines numLines setFirstLine firstLine public void scrollDownPage int numLines getVirtualLineCount if softWrap firstLine numLines firstLine visibleLines numLines setFirstLine physicalToVirtual physLastLine public void scrollToCaret boolean doElectricScroll scrollTo caretLine caret buffer getLineStartOffset caretLine doElectricScroll public void scrollTo int line int offset boolean doElectricScroll int extraEndVirt int lineLength buffer getLineLength line if offset lineLength extraEndVirt charWidth offset lineLength offset lineLength else extraEndVirt int doElectricScroll visibleLines electricScroll electricScroll if visibleLines setFirstLine physicalToVirtual Math max line return int screenLine getScreenLineOfOffset buffer getLineStartOffset line offset Point point if screenLine int height painter getFontMetrics getHeight int y1 firstLine height int y2 visibleLines firstLine getVirtualLineCount height Rectangle rect new Rectangle y1 painter getWidth visibleLines height y1 y2 point offsetToXY line offset returnValue point extraEndVirt if rect contains point return else point null if line physLastLine int count chunkCache getLineInfosForPhysicalLine physLastLine length chunkCache getLineInfosForPhysicalLine physLastLine length while count count chunkCache getLineInfosForPhysicalLine physFirstLine length firstLine physFirstLine foldVisibilityManager getNextVisibleLine physFirstLine else if screenLine if line physLastLine int count chunkCache getLineInfosForPhysicalLine physLastLine length while count count chunkCache getLineInfosForPhysicalLine physFirstLine length firstLine int nextLine foldVisibilityManager getNextVisibleLine physFirstLine if nextLine break else physFirstLine nextLine int virtualLine foldVisibilityManager physicalToVirtual line if virtualLine firstLine firstLine Math max firstLine physFirstLine foldVisibilityManager virtualToPhysical firstLine else if softWrap virtualLine foldVisibilityManager getVirtualLineCount visibleLines firstLine foldVisibilityManager getVirtualLineCount visibleLines physFirstLine foldVisibilityManager virtualToPhysical firstLine else physFirstLine line int count for if foldVisibilityManager isLineVisible physFirstLine int incr chunkCache getLineInfosForPhysicalLine physFirstLine length if count incr visibleLines break else count incr int prevLine foldVisibilityManager getPrevVisibleLine physFirstLine if prevLine break else physFirstLine prevLine firstLine physicalToVirtual physFirstLine else if screenLine firstLine int count screenLine while count firstLine count chunkCache getLineInfosForPhysicalLine physFirstLine length firstLine physFirstLine foldVisibilityManager getPrevVisibleLine physFirstLine else if screenLine visibleLines int count visibleLines screenLine while count firstLine getVirtualLineCount count chunkCache getLineInfosForPhysicalLine physFirstLine length firstLine physFirstLine foldVisibilityManager getNextVisibleLine physFirstLine chunkCache setFirstLine firstLine physFirstLine false recalculateLastPhysicalLine if point null point offsetToXY line offset returnValue if point null return else point extraEndVirt if point horizontalOffset Math min horizontalOffset point charWidth else if point painter getWidth charWidth horizontalOffset horizontalOffset painter getWidth point charWidth updateScrollBars painter repaint gutter repaint view synchroScrollVertical this firstLine view synchroScrollHorizontal this horizontalOffset fireScrollEvent true fireScrollEvent false public final void addScrollListener ScrollListener listener listenerList add ScrollListener class listener public final void removeScrollListener ScrollListener listener listenerList remove ScrollListener class listener public int getPhysicalLineOfScreenLine int screenLine chunkCache updateChunksUpTo screenLine return chunkCache getLineInfo screenLine physicalLine public int getScreenLineOfOffset int offset int line buffer getLineOfOffset offset offset buffer getLineStartOffset line return chunkCache getScreenLineOfOffset line offset public int getScreenLineStartOffset int line chunkCache updateChunksUpTo line ChunkCache LineInfo lineInfo chunkCache getLineInfo line if lineInfo physicalLine return return buffer getLineStartOffset lineInfo physicalLine lineInfo offset public int getScreenLineEndOffset int line chunkCache updateChunksUpTo line ChunkCache LineInfo lineInfo chunkCache getLineInfo line if lineInfo physicalLine return return buffer getLineStartOffset lineInfo physicalLine lineInfo offset lineInfo length public int xyToOffset int int return xyToOffset true public int xyToOffset int int boolean round FontMetrics fm painter getFontMetrics int height fm getHeight int line height if line line visibleLines return chunkCache updateChunksUpTo line ChunkCache LineInfo lineInfo chunkCache getLineInfo line if lineInfo chunksValid System err println if lineInfo physicalLine return getLineEndOffset foldVisibilityManager getLastVisibleLine else int offset Chunk xToOffset lineInfo chunks horizontalOffset round if offset offset lineInfo offset lineInfo length offset lineInfo offset lineInfo length return getLineStartOffset lineInfo physicalLine offset public Point offsetToXY int offset int line buffer getLineOfOffset offset offset buffer getLineStartOffset line Point retVal new Point return offsetToXY line offset retVal public Point offsetToXY int line int offset Point retVal int screenLine chunkCache getScreenLineOfOffset line offset if screenLine if line physFirstLine return null else if line physLastLine return null else throw new InternalError line offset screenLine physFirstLine physLastLine FontMetrics fm painter getFontMetrics retVal screenLine fm getHeight chunkCache updateChunksUpTo screenLine ChunkCache LineInfo info chunkCache getLineInfo screenLine if info chunksValid System err println retVal int horizontalOffset Chunk offsetToX info chunks offset return retVal public void invalidateScreenLineRange int start int end if chunkCache needFullRepaint recalculateLastPhysicalLine gutter repaint painter repaint return if start end int tmp end end start start tmp FontMetrics fm painter getFontMetrics int start fm getHeight int height end start fm getHeight painter repaint painter getWidth height gutter repaint gutter getWidth height public void invalidateLine int line if line physFirstLine line physLastLine foldVisibilityManager isLineVisible line return int startLine int endLine for int visibleLines chunkCache updateChunksUpTo ChunkCache LineInfo info chunkCache getLineInfo if info physicalLine line info physicalLine startLine startLine if info physicalLine line info lastSubregion info physicalLine endLine break if chunkCache needFullRepaint recalculateLastPhysicalLine endLine visibleLines else if endLine endLine visibleLines invalidateScreenLineRange startLine endLine public void invalidateLineRange int start int end if end start int tmp end end start start tmp if end physFirstLine start physLastLine return int startScreenLine int endScreenLine for int visibleLines chunkCache updateChunksUpTo ChunkCache LineInfo info chunkCache getLineInfo if info physicalLine start info physicalLine startScreenLine startScreenLine if info physicalLine end info lastSubregion info physicalLine endScreenLine break if startScreenLine startScreenLine if chunkCache needFullRepaint recalculateLastPhysicalLine endScreenLine visibleLines else if endScreenLine endScreenLine visibleLines invalidateScreenLineRange startScreenLine endScreenLine public void invalidateSelectedLines invalidateLine caretLine for int selection size Selection Selection selection elementAt invalidateLineRange startLine endLine public int physicalToVirtual int line return foldVisibilityManager physicalToVirtual line public int virtualToPhysical int line return foldVisibilityManager virtualToPhysical line public final int getBufferLength return buffer getLength public final int getLineCount return buffer getLineCount public final int getVirtualLineCount return foldVisibilityManager getVirtualLineCount public final int getLineOfOffset int offset return buffer getLineOfOffset offset public int getLineStartOffset int line return buffer getLineStartOffset line public int getLineEndOffset int line return buffer getLineEndOffset line public int getLineLength int line return buffer getLineLength line public final String getText int start int len return buffer getText start len public final void getText int start int len Segment segment buffer getText start len segment public final String getLineText int lineIndex return buffer getLineText lineIndex public final void getLineText int lineIndex Segment segment buffer getLineText lineIndex segment public String getText return buffer getText buffer getLength public void setText String text try buffer beginCompoundEdit buffer remove buffer getLength buffer insert text finally buffer endCompoundEdit public final void selectAll setSelection new Selection Range buffer getLength moveCaretPosition buffer getLength true public void selectLine int caretLine getCaretLine int start getLineStartOffset caretLine int end getLineEndOffset caretLine Selection new Selection Range start end if multi addToSelection else setSelection moveCaretPosition end public void selectParagraph int caretLine getCaretLine if getLineLength caretLine view getToolkit beep return int start caretLine int end caretLine while start if getLineLength start break else start while end getLineCount if getLineLength end break else end int selectionStart getLineStartOffset start int selectionEnd getLineEndOffset end Selection new Selection Range selectionStart selectionEnd if multi addToSelection else setSelection moveCaretPosition selectionEnd public void selectWord int line getCaretLine int lineStart getLineStartOffset line int offset getCaretPosition lineStart if getLineLength line return String lineText getLineText line String noWordSep buffer getStringProperty if offset getLineLength line offset int wordStart TextUtilities findWordStart lineText offset noWordSep int wordEnd TextUtilities findWordEnd lineText offset noWordSep Selection new Selection Range lineStart wordStart lineStart wordEnd if multi addToSelection else setSelection moveCaretPosition lineStart wordEnd public boolean selectToMatchingBracket int position int positionLine buffer getLineOfOffset position int lineOffset position buffer getLineStartOffset positionLine int bracket TextUtilities findMatchingBracket buffer positionLine lineOffset if bracket Selection if bracket position moveCaretPosition position false new Selection Range bracket position else moveCaretPosition position false new Selection Range position bracket if multi selectNone addToSelection return true return false public void selectToMatchingBracket int caret this caret int offset caret buffer getLineStartOffset caretLine if buffer getLineLength caretLine return if offset buffer getLineLength caretLine caret selectToMatchingBracket caret public void selectBlock String openBrackets String closeBrackets Selection getSelectionAtOffset caret int start end if null start end caret else start start end end String text getText buffer getLength int count char openBracket char closeBracket if start view getToolkit beep return backward_scan while start char text charAt start int index openBrackets indexOf if index if count openBracket closeBracket closeBrackets charAt index break backward_scan else if closeBrackets indexOf count count if openBracket getToolkit beep return else forward_scan do char text charAt end if closeBracket if count end break forward_scan else if openBracket count while end buffer getLength new Selection Range start end if multi addToSelection else setSelection moveCaretPosition end public final void invertSelection Selection newSelection new Selection selection size int lastOffset for int selection size Selection Selection selection elementAt newSelection new Selection Range lastOffset getStart lastOffset getEnd newSelection selection size new Selection Range lastOffset buffer getLength setSelection newSelection public int getSelectionCount return selection size public Selection getSelection Selection sel new Selection selection size selection copyInto sel return sel public void selectNone setSelection Selection null public void setSelection Selection selection invalidateSelectedLines this selection removeAllElements if selection null for int selection length selection fireCaretEvent public void setSelection Selection selection invalidateSelectedLines this selection removeAllElements if selection null selection fireCaretEvent public void addToSelection Selection selection if selection null for int selection length selection invalidateLine caretLine fireCaretEvent public void addToSelection Selection selection selection invalidateLine caretLine fireCaretEvent public Selection getSelectionAtOffset int offset if selection null for int selection size Selection Selection selection elementAt if offset start offset end return return null public void removeFromSelection Selection sel selection removeElement sel invalidateLineRange sel startLine sel endLine invalidateLine caretLine fireCaretEvent public void removeFromSelection int offset Selection sel getSelectionAtOffset offset if sel null return selection removeElement sel invalidateLineRange sel startLine sel endLine invalidateLine caretLine fireCaretEvent public void resizeSelection int offset int end int extraEndVirt boolean rect Selection getSelectionAtOffset offset if null invalidateLineRange startLine endLine selection removeElement boolean reversed false if end offset int tmp offset offset end end tmp reversed true Selection newSel if rect Selection Rect rectSel new Selection Rect offset end if reversed rectSel extraStartVirt extraEndVirt else rectSel extraEndVirt extraEndVirt newSel rectSel else newSel new Selection Range offset end newSel fireCaretEvent public void extendSelection int offset int end Selection getSelectionAtOffset offset if null invalidateLineRange startLine endLine selection removeElement if offset start offset end end end else if offset end offset start if end offset int tmp end end offset offset tmp new Selection Range offset end fireCaretEvent public String getSelectedText Selection StringBuffer buf new StringBuffer getText buffer buf return buf toString public String getSelectedText String separator if selection size return null StringBuffer buf new StringBuffer for int selection size if buf append separator Selection selection elementAt getText buffer buf return buf toString public String getSelectedText return getSelectedText public void setSelectedText Selection String selectedText if isEditable throw new InternalError try buffer beginCompoundEdit moveCaretPosition setText buffer selectedText finally buffer endCompoundEdit public void setSelectedText String selectedText if isEditable throw new InternalError Selection selection getSelection if selection length buffer insert caret selectedText else try int newCaret buffer beginCompoundEdit for int selection length newCaret selection setText buffer selectedText moveCaretPosition newCaret finally buffer endCompoundEdit selectNone public int getSelectedLines if selection size return new int caretLine Integer line Hashtable hash new Hashtable for int selection size Selection Selection selection elementAt int endLine end getLineStartOffset endLine endLine endLine for int startLine endLine line new Integer hash put line line int returnValue new int hash size int Enumeration keys hash keys while keys hasMoreElements line Integer keys nextElement returnValue line intValue Arrays sort returnValue return returnValue public void showSelectLineRangeDialog new SelectLineRange view public final void blinkCaret if caretBlinks blink blink invalidateLine caretLine else blink true public void centerCaret int offset getScreenLineStartOffset visibleLines if offset getToolkit beep else setCaretPosition offset public void setCaretPosition int newCaret invalidateSelectedLines selection removeAllElements moveCaretPosition newCaret true public void setCaretPosition int newCaret boolean doElectricScroll invalidateSelectedLines selection removeAllElements moveCaretPosition newCaret doElectricScroll public void moveCaretPosition int newCaret moveCaretPosition newCaret true public void moveCaretPosition int newCaret boolean doElectricScroll if newCaret newCaret buffer getLength throw new IllegalArgumentException newCaret if caret newCaret if view getTextArea this finishCaretUpdate doElectricScroll false else int newCaretLine getLineOfOffset newCaret magicCaret if foldVisibilityManager isLineVisible newCaretLine if foldVisibilityManager isNarrowed int collapseFolds buffer getIntegerProperty if collapseFolds foldVisibilityManager expandFolds collapseFolds foldVisibilityManager expandFold newCaretLine false else foldVisibilityManager expandAllFolds else foldVisibilityManager expandFold newCaretLine false if caretLine newCaretLine if caretScreenLine invalidateScreenLineRange caretScreenLine caretScreenLine else int newCaretScreenLine chunkCache getScreenLineOfOffset newCaretLine newCaret buffer getLineStartOffset newCaretLine if caretScreenLine invalidateScreenLineRange newCaretScreenLine newCaretScreenLine else invalidateScreenLineRange caretScreenLine newCaretScreenLine caretScreenLine newCaretScreenLine caret newCaret caretLine newCaretLine if view getTextArea this finishCaretUpdate doElectricScroll true public int getCaretPosition return caret public int getCaretLine return caretLine public final int getMagicCaretPosition if magicCaret magicCaret offsetToX caretLine caret getLineStartOffset caretLine return magicCaret public final void setMagicCaretPosition int magicCaret this magicCaret magicCaret public final void addCaretListener CaretListener listener listenerList add CaretListener class listener public final void removeCaretListener CaretListener listener listenerList remove CaretListener class listener public final int getBracketPosition return bracketPosition public final int getBracketLine return bracketLine public void goToNextBracket boolean select String text getText caret buffer getLength caret int newCaret loop for int text length switch text charAt case case case newCaret caret break loop if newCaret getToolkit beep else if select extendSelection caret newCaret else if multi selectNone moveCaretPosition newCaret public void goToNextCharacter boolean select if select selection size Selection getSelectionAtOffset caret if null if multi if caret end moveCaretPosition end return else setCaretPosition end return if caret buffer getLength getToolkit beep int newCaret if caret getLineEndOffset caretLine int line foldVisibilityManager getNextVisibleLine caretLine if line getToolkit beep return newCaret getLineStartOffset line else newCaret caret if select extendSelection caret newCaret else if multi selectNone moveCaretPosition newCaret public void goToNextLine boolean select ChunkCache LineInfo lineInfos chunkCache getLineInfosForPhysicalLine caretLine int caretFromStartOfLine caret buffer getLineStartOffset caretLine int subregion getSubregionOfOffset caretFromStartOfLine lineInfos int magic this magicCaret if magic magic subregionOffsetToX lineInfos subregion caretFromStartOfLine int newCaret if subregion lineInfos length newCaret buffer getLineStartOffset caretLine xToSubregionOffset lineInfos subregion magic true else int nextLine foldVisibilityManager getNextVisibleLine caretLine if nextLine int end getLineEndOffset caretLine if caret end getToolkit beep return else newCaret end else lineInfos chunkCache getLineInfosForPhysicalLine nextLine newCaret getLineStartOffset nextLine xToSubregionOffset lineInfos magic true if select extendSelection caret newCaret else if multi selectNone moveCaretPosition newCaret this magicCaret magic public void goToNextMarker boolean select Vector markers buffer getMarkers if markers size getToolkit beep return Marker marker null for int markers size Marker Marker markers get if getPosition caret marker break if marker null marker Marker markers get if select extendSelection caret marker getPosition else if multi selectNone moveCaretPosition marker getPosition public void goToNextPage boolean select int lineCount getVirtualLineCount int magic getMagicCaretPosition if firstLine visibleLines lineCount setFirstLine lineCount visibleLines else setFirstLine firstLine visibleLines int newLine virtualToPhysical Math min lineCount physicalToVirtual caretLine visibleLines int newCaret getLineStartOffset newLine xToOffset newLine magic if select extendSelection caret newCaret else if multi selectNone moveCaretPosition newCaret setMagicCaretPosition magic public void goToNextParagraph boolean select int lineNo getCaretLine int newCaret getBufferLength boolean foundBlank false loop for int lineNo getLineCount if foldVisibilityManager isLineVisible continue getLineText lineSegment for int lineSegment count switch lineSegment array lineSegment offset case case break default if foundBlank newCaret getLineStartOffset break loop else continue loop foundBlank true if select extendSelection caret newCaret else if multi selectNone moveCaretPosition newCaret public void goToNextWord boolean select goToNextWord select false public void goToNextWord boolean select boolean stdNextPrevWord int lineStart getLineStartOffset caretLine int newCaret caret lineStart String lineText getLineText caretLine if newCaret lineText length int nextLine foldVisibilityManager getNextVisibleLine caretLine if nextLine getToolkit beep return newCaret getLineStartOffset nextLine else String noWordSep buffer getStringProperty newCaret TextUtilities findWordEnd lineText newCaret noWordSep if stdNextPrevWord while newCaret lineText length Character isWhitespace lineText charAt newCaret newCaret TextUtilities findWordEnd lineText newCaret noWordSep newCaret lineStart if select extendSelection caret newCaret else if multi selectNone moveCaretPosition newCaret public void goToPrevBracket boolean select String text getText caret int newCaret loop for int getCaretPosition switch text charAt case case case newCaret break loop if newCaret getToolkit beep else if select extendSelection caret newCaret else if multi selectNone moveCaretPosition newCaret public void goToPrevCharacter boolean select if select selection size Selection getSelectionAtOffset caret if null if multi if caret start moveCaretPosition start return else setCaretPosition start return int newCaret if caret getLineStartOffset caretLine int line foldVisibilityManager getPrevVisibleLine caretLine if line getToolkit beep return newCaret getLineEndOffset line else newCaret caret if select extendSelection caret newCaret else if multi selectNone moveCaretPosition newCaret public void goToPrevLine boolean select ChunkCache LineInfo lineInfos chunkCache getLineInfosForPhysicalLine caretLine int caretFromStartOfLine caret buffer getLineStartOffset caretLine int subregion getSubregionOfOffset caretFromStartOfLine lineInfos int magic this magicCaret if magic magic subregionOffsetToX lineInfos subregion caretFromStartOfLine int newCaret if subregion newCaret buffer getLineStartOffset caretLine xToSubregionOffset lineInfos subregion magic true else int prevLine foldVisibilityManager getPrevVisibleLine caretLine if prevLine int start getLineStartOffset caretLine if caret start getToolkit beep return else newCaret start else lineInfos chunkCache getLineInfosForPhysicalLine prevLine newCaret getLineStartOffset prevLine xToSubregionOffset lineInfos lineInfos length magic true if select extendSelection caret newCaret else if multi selectNone moveCaretPosition newCaret this magicCaret magic public void goToPrevMarker boolean select Vector markers buffer getMarkers if markers size getToolkit beep return Marker marker null for int markers size Marker Marker markers elementAt if getPosition caret marker break if marker null marker Marker markers get markers size if select extendSelection caret marker getPosition else if multi selectNone moveCaretPosition marker getPosition public void goToPrevPage boolean select if firstLine visibleLines setFirstLine else setFirstLine firstLine visibleLines int magic getMagicCaretPosition int newLine virtualToPhysical Math max physicalToVirtual caretLine visibleLines int newCaret getLineStartOffset newLine xToOffset newLine magic if select extendSelection caret newCaret else if multi selectNone moveCaretPosition newCaret setMagicCaretPosition magic public void goToPrevParagraph boolean select int lineNo caretLine int newCaret boolean foundBlank false loop for int lineNo if foldVisibilityManager isLineVisible continue getLineText lineSegment for int lineSegment count switch lineSegment array lineSegment offset case case break default if foundBlank newCaret getLineEndOffset break loop else continue loop foundBlank true if select extendSelection caret newCaret else if multi selectNone moveCaretPosition newCaret public void goToPrevWord boolean select goToPrevWord select false public void goToPrevWord boolean select boolean stdNextPrevWord int lineStart getLineStartOffset caretLine int newCaret caret lineStart String lineText getLineText caretLine if newCaret if lineStart view getToolkit beep return else int prevLine foldVisibilityManager getPrevVisibleLine caretLine if prevLine getToolkit beep return newCaret getLineEndOffset prevLine else String noWordSep buffer getStringProperty newCaret TextUtilities findWordStart lineText newCaret noWordSep if stdNextPrevWord while newCaret Character isWhitespace lineText charAt newCaret newCaret TextUtilities findWordStart lineText newCaret noWordSep newCaret lineStart if select extendSelection caret newCaret else if multi selectNone moveCaretPosition newCaret public void smartHome boolean select Macros Recorder recorder view getMacroRecorder switch view getInputHandler getLastActionCount case if recorder null recorder record select goToStartOfWhiteSpace select break case if recorder null recorder record select goToStartOfLine select break if recorder null recorder record select goToFirstVisibleLine select break public void smartEnd boolean select Macros Recorder recorder view getMacroRecorder switch view getInputHandler getLastActionCount case if recorder null recorder record select goToEndOfWhiteSpace select break case if recorder null recorder record select goToEndOfLine select break if recorder null recorder record select goToLastVisibleLine select break public void goToStartOfLine boolean select Selection getSelectionAtOffset caret int line select null caretLine startLine int newCaret getLineStartOffset line if select extendSelection caret newCaret else if multi selectNone moveCaretPosition newCaret public void goToEndOfLine boolean select Selection getSelectionAtOffset caret int line select null caretLine endLine int newCaret getLineEndOffset line if select extendSelection caret newCaret else if multi selectNone moveCaretPosition newCaret public void goToStartOfWhiteSpace boolean select Selection getSelectionAtOffset caret int line offset if select null line caretLine offset caret buffer getLineStartOffset line else line startLine offset start buffer getLineStartOffset line int firstIndent ChunkCache LineInfo lineInfos chunkCache getLineInfosForPhysicalLine line int subregion getSubregionOfOffset offset lineInfos if subregion firstIndent MiscUtilities getLeadingWhiteSpace getLineText line if firstIndent getLineLength line firstIndent firstIndent getLineStartOffset line else firstIndent getLineStartOffset line lineInfos subregion offset if select extendSelection caret firstIndent else if multi selectNone moveCaretPosition firstIndent public void goToEndOfWhiteSpace boolean select Selection getSelectionAtOffset caret int line offset if select null line caretLine offset caret getLineStartOffset line else line endLine offset end getLineStartOffset line int lastIndent ChunkCache LineInfo lineInfos chunkCache getLineInfosForPhysicalLine line int subregion getSubregionOfOffset offset lineInfos if subregion lineInfos length lastIndent getLineLength line MiscUtilities getTrailingWhiteSpace getLineText line if lastIndent lastIndent getLineLength line lastIndent getLineStartOffset line else lastIndent getLineStartOffset line lineInfos subregion offset lineInfos subregion length if select extendSelection caret lastIndent else if multi selectNone moveCaretPosition lastIndent public void goToFirstVisibleLine boolean select int firstVisibleLine firstLine electricScroll int firstVisible getScreenLineStartOffset firstVisibleLine if firstVisible firstVisible getLineStartOffset foldVisibilityManager getFirstVisibleLine if select extendSelection caret firstVisible else if multi selectNone moveCaretPosition firstVisible public void goToLastVisibleLine boolean select int lastVisible if firstLine visibleLines getVirtualLineCount lastVisible getLineEndOffset foldVisibilityManager getLastVisibleLine else lastVisible getScreenLineEndOffset visibleLines electricScroll if lastVisible lastVisible getLineEndOffset foldVisibilityManager getLastVisibleLine if select extendSelection caret lastVisible else if multi selectNone moveCaretPosition lastVisible public void goToBufferStart boolean select int start buffer getLineStartOffset foldVisibilityManager getFirstVisibleLine if select extendSelection caret start else if multi selectNone moveCaretPosition start public void goToBufferEnd boolean select int end buffer getLineEndOffset foldVisibilityManager getLastVisibleLine if select extendSelection caret end else if multi selectNone moveCaretPosition end public void goToMatchingBracket if getLineLength caretLine int dot caret getLineStartOffset caretLine int bracket TextUtilities findMatchingBracketFuzzy buffer caretLine Math max dot if bracket selectNone moveCaretPosition bracket false return getToolkit beep public void showGoToLineDialog String line GUIUtilities input view null if line null return try int lineNumber Integer parseInt line setCaretPosition getLineStartOffset lineNumber catch Exception getToolkit beep public void userInput char ch if isEditable getToolkit beep return if ch Abbrevs getExpandOnInput Abbrevs expandAbbrev view false return else if ch if selection size Selection sel Selection selection elementAt if sel startLine sel endLine sel start buffer getLineStartOffset sel startLine sel end buffer getLineEndOffset sel startLine insertTab else shiftIndentRight else if selection size shiftIndentRight else insertTab return else boolean indent String indentOpenBrackets String buffer getProperty String indentCloseBrackets String buffer getProperty if indentCloseBrackets null indentCloseBrackets indexOf ch indentOpenBrackets null indentOpenBrackets indexOf ch indent true else indent false String str String valueOf ch if selection size setSelectedText str return if ch if doWordWrap true return else doWordWrap false try if overwrite indent buffer beginCompoundEdit if overwrite int caretLineEnd getLineEndOffset caretLine if caretLineEnd caret buffer remove caret buffer insert caret str if indent buffer indentLine caretLine false true finally if overwrite indent buffer endCompoundEdit public final boolean isOverwriteEnabled return overwrite public final void setOverwriteEnabled boolean overwrite blink true caretTimer restart this overwrite overwrite invalidateLine caretLine if view getStatus null view getStatus updateMiscStatus public final void toggleOverwriteEnabled setOverwriteEnabled overwrite if view getStatus null view getStatus setMessageAndClear jEdit getProperty new Integer new Integer overwrite public void backspace if buffer isEditable getToolkit beep return if selection size setSelectedText null else if caret getToolkit beep return buffer remove caret public void backspaceWord if buffer isEditable getToolkit beep return if selection size setSelectedText return int lineStart getLineStartOffset caretLine int caret lineStart String lineText getLineText caretLine if if lineStart getToolkit beep return else String noWordSep buffer getStringProperty TextUtilities findWordStart lineText noWordSep buffer remove lineStart caret lineStart public void delete if buffer isEditable getToolkit beep return if selection size setSelectedText null else if caret buffer getLength getToolkit beep return buffer remove caret public void deleteToEndOfLine if buffer isEditable getToolkit beep return buffer remove caret getLineEndOffset caretLine caret public void deleteLine if buffer isEditable getToolkit beep return int start getLineStartOffset caretLine int end getLineEndOffset caretLine if end buffer getLength if start start end int offsetToX caretLine caret start try buffer beginCompoundEdit buffer remove start end start finally buffer endCompoundEdit int lastLine buffer getLineCount if caretLine lastLine setCaretPosition buffer getLineStartOffset lastLine xToOffset caretLine else setCaretPosition start xToOffset caretLine public void deleteParagraph if buffer isEditable getToolkit beep return int start end buffer getLength loop for int caretLine getLineText lineSegment for int lineSegment count switch lineSegment array lineSegment offset case case break default continue loop start getLineStartOffset break loop loop for int caretLine getLineCount getLineText lineSegment for int lineSegment count switch lineSegment array lineSegment offset case case break default continue loop end getLineEndOffset break loop buffer remove start end start public void deleteToStartOfLine if buffer isEditable getToolkit beep return buffer remove getLineStartOffset caretLine caret getLineStartOffset caretLine public void deleteWord if buffer isEditable getToolkit beep return if selection size setSelectedText return int lineStart getLineStartOffset caretLine int caret lineStart String lineText getLineText caretLine if lineText length if lineStart buffer getLength getToolkit beep return else String noWordSep buffer getStringProperty TextUtilities findWordEnd lineText noWordSep buffer remove caret lineStart caret public final boolean isMultipleSelectionEnabled return multi public final void toggleMultipleSelectionEnabled setMultipleSelectionEnabled multi if view getStatus null view getStatus setMessageAndClear jEdit getProperty new Integer new Integer multi public final void setMultipleSelectionEnabled boolean multi this multi multi if view getStatus null view getStatus updateMiscStatus public void goToMarker char shortcut boolean select Marker marker buffer getMarker shortcut if marker null getToolkit beep return int pos marker getPosition if select extendSelection caret pos else if multi selectNone moveCaretPosition pos public void addMarker Selection selection getSelection for int selection length Selection selection if startLine endLine if startLine caretLine buffer addMarker start if endLine caretLine buffer addMarker end buffer addOrRemoveMarker caret public void swapMarkerAndCaret char shortcut Marker marker buffer getMarker shortcut if marker null getToolkit beep return int caret getCaretPosition setCaretPosition marker getPosition buffer addMarker shortcut caret public void goToParentFold int line int level buffer getFoldLevel caretLine for int caretLine if buffer getFoldLevel level line break if line getToolkit beep return int magic getMagicCaretPosition int newCaret buffer getLineStartOffset line xToOffset line magic if multi selectNone moveCaretPosition newCaret setMagicCaretPosition magic public void goToNextFold boolean select int nextFold for int caretLine buffer getLineCount if buffer isFoldStart foldVisibilityManager isLineVisible nextFold break if nextFold getToolkit beep return int magic getMagicCaretPosition int newCaret buffer getLineStartOffset nextFold xToOffset nextFold magic if select extendSelection caret newCaret else if multi selectNone moveCaretPosition newCaret setMagicCaretPosition magic public void goToPrevFold boolean select int prevFold for int caretLine if buffer isFoldStart foldVisibilityManager isLineVisible prevFold break if prevFold getToolkit beep return int magic getMagicCaretPosition int newCaret buffer getLineStartOffset prevFold xToOffset prevFold magic if select extendSelection caret newCaret else if multi selectNone moveCaretPosition newCaret setMagicCaretPosition magic public void collapseFold int offsetToX caretLine caret getLineStartOffset caretLine foldVisibilityManager collapseFold caretLine if foldVisibilityManager isLineVisible caretLine return int line foldVisibilityManager getPrevVisibleLine caretLine if multi selectNone moveCaretPosition buffer getLineStartOffset line xToOffset line public void expandFold boolean fully int offsetToX caretLine caret getLineStartOffset caretLine int line foldVisibilityManager expandFold caretLine fully if fully line if multi selectNone moveCaretPosition getLineStartOffset line xToOffset line public void selectFold selectFold caretLine public void selectFold int line int lines buffer getFoldAtLine line int newCaret getLineEndOffset lines Selection new Selection Range getLineStartOffset lines newCaret if multi addToSelection else setSelection moveCaretPosition newCaret public void narrowToFold int lines buffer getFoldAtLine caretLine if lines lines buffer getLineCount getToolkit beep else foldVisibilityManager narrow lines lines public void narrowToSelection if selection size getToolkit beep return Selection sel Selection selection elementAt foldVisibilityManager narrow sel getStartLine sel getEndLine selectNone public void addExplicitFold if buffer getStringProperty equals GUIUtilities error view null return String lineComment buffer getContextSensitiveProperty caret String commentStart buffer getContextSensitiveProperty caret String commentEnd buffer getContextSensitiveProperty caret String start end if lineComment null start lineComment end lineComment else if commentStart null commentEnd null start commentStart commentEnd end commentStart commentEnd else start end try buffer beginCompoundEdit if selection size String line buffer getLineText caretLine String whitespace line substring MiscUtilities getLeadingWhiteSpace line int loc caret start length start start whitespace buffer insert caret start buffer insert caret end moveCaretPosition loc false else int loc for int selection size Selection Selection selection elementAt String line buffer getLineText startLine String whitespace line substring MiscUtilities getLeadingWhiteSpace line loc start start length buffer insert start start whitespace buffer insert end end setCaretPosition loc false finally buffer endCompoundEdit public void lineComment String comment buffer getContextSensitiveProperty caret if buffer isEditable comment null comment length getToolkit beep return comment comment buffer beginCompoundEdit int lines getSelectedLines try for int lines length String text getLineText lines buffer insert getLineStartOffset lines MiscUtilities getLeadingWhiteSpace text comment finally buffer endCompoundEdit selectNone public void rangeComment String commentStart buffer getContextSensitiveProperty caret String commentEnd buffer getContextSensitiveProperty caret if buffer isEditable commentStart null commentEnd null commentStart length commentEnd length getToolkit beep return commentStart commentStart commentEnd commentEnd try buffer beginCompoundEdit Selection selection getSelection if selection length int oldCaret caret buffer insert caret commentStart buffer insert caret commentEnd setCaretPosition oldCaret commentStart length for int selection length Selection selection if instanceof Selection Range buffer insert start commentStart buffer insert end commentEnd else if instanceof Selection Rect Selection Rect rect Selection Rect int start rect getStartColumn buffer int end rect getEndColumn buffer for int startLine endLine buffer insertAtColumn end commentEnd buffer insertAtColumn start commentStart selectNone finally buffer endCompoundEdit public void formatParagraph if buffer isEditable getToolkit beep return if maxLineLen getToolkit beep return Selection selection getSelection if selection length buffer beginCompoundEdit for int selection length Selection selection setSelectedText TextUtilities format getSelectedText maxLineLen buffer getTabSize buffer endCompoundEdit else int lineNo getCaretLine int start end buffer getLength loop for int lineNo getLineText lineSegment for int lineSegment count switch lineSegment array lineSegment offset case case break default continue loop start getLineEndOffset break loop loop for int lineNo getLineCount getLineText lineSegment for int lineSegment count switch lineSegment array lineSegment offset case case break default continue loop end getLineStartOffset break loop try buffer beginCompoundEdit String text buffer getText start end start buffer remove start end start buffer insert start TextUtilities format text maxLineLen buffer getTabSize finally buffer endCompoundEdit public void spacesToTabs Selection selection getSelection if buffer isEditable getToolkit beep return buffer beginCompoundEdit if selection length setText TextUtilities spacesToTabs getText buffer getTabSize else for int selection length Selection selection setSelectedText TextUtilities spacesToTabs getSelectedText buffer getTabSize buffer endCompoundEdit public void tabsToSpaces Selection selection getSelection if buffer isEditable getToolkit beep return buffer beginCompoundEdit if selection length setText TextUtilities tabsToSpaces getText buffer getTabSize else for int selection length Selection selection setSelectedText TextUtilities tabsToSpaces getSelectedText buffer getTabSize buffer endCompoundEdit public void toUpperCase Selection selection getSelection if buffer isEditable selection length getToolkit beep return buffer beginCompoundEdit for int selection length Selection selection setSelectedText getSelectedText toUpperCase buffer endCompoundEdit public void toLowerCase Selection selection getSelection if buffer isEditable selection length getToolkit beep return buffer beginCompoundEdit for int selection length Selection selection setSelectedText getSelectedText toLowerCase buffer endCompoundEdit public void removeTrailingWhiteSpace if buffer isEditable getToolkit beep else buffer removeTrailingWhiteSpace getSelectedLines public void insertEnterAndIndent if isEditable getToolkit beep else try buffer beginCompoundEdit setSelectedText buffer indentLine caretLine true false finally buffer endCompoundEdit public void insertTabAndIndent if isEditable getToolkit beep return if selection size String text buffer getLineText caretLine int start buffer getLineStartOffset caretLine int whiteSpace MiscUtilities getLeadingWhiteSpace text if caret start whiteSpace buffer indentLine caretLine true false return userInput public void indentSelectedLines if buffer isEditable getToolkit beep else buffer indentLines getSelectedLines selectNone public void shiftIndentLeft if buffer isEditable getToolkit beep else buffer shiftIndentLeft getSelectedLines public void shiftIndentRight if buffer isEditable getToolkit beep else buffer shiftIndentRight getSelectedLines public void joinLines int end getLineEndOffset caretLine if end buffer getLength getToolkit beep return buffer remove end MiscUtilities getLeadingWhiteSpace buffer getLineText caretLine setCaretPosition end public void showWordCountDialog String selection getSelectedText if selection null doWordCount view selection return doWordCount view buffer getText buffer getLength public void addNotify super addNotify ToolTipManager sharedInstance registerComponent painter ToolTipManager sharedInstance registerComponent gutter if bufferHandlerInstalled bufferHandlerInstalled true buffer addBufferChangeListener bufferHandler recalculateVisibleLines recalculateLastPhysicalLine public void removeNotify super removeNotify ToolTipManager sharedInstance unregisterComponent painter ToolTipManager sharedInstance unregisterComponent gutter if focusedComponent this focusedComponent null if bufferHandlerInstalled buffer removeBufferChangeListener bufferHandler bufferHandlerInstalled false public boolean hasFocus Component this while instanceof Window if null return false getParent Component focusOwner Window getFocusOwner boolean hasFocus focusOwner this if hasFocus focusedComponent this return hasFocus public void grabFocus super grabFocus hasFocus public boolean getFocusTraversalKeysEnabled return false long time boolean timing public void processKeyEvent KeyEvent evt time System currentTimeMillis evt KeyEventWorkaround processKeyEvent evt if evt null return if view isClosed return InputHandler inputHandler view getInputHandler KeyListener keyEventInterceptor view getKeyEventInterceptor switch evt getID case KeyEvent KEY_TYPED if keyEventInterceptor null keyEventInterceptor keyTyped evt else inputHandler keyTyped evt break case KeyEvent KEY_PRESSED if keyEventInterceptor null keyEventInterceptor keyPressed evt else inputHandler keyPressed evt break case KeyEvent KEY_RELEASED if keyEventInterceptor null keyEventInterceptor keyReleased evt else inputHandler keyReleased evt break if evt isConsumed super processKeyEvent evt public void propertiesChanged if buffer null return int buffer getTabSize char foo new char for int foo length foo tabSize float painter getFont getStringBounds foo painter getFontRenderContext getWidth charWidth int Math round painter getFont getStringBounds foo painter getFontRenderContext getWidth String wrap buffer getStringProperty softWrap wrap equals hardWrap wrap equals maxLineLen buffer getIntegerProperty if maxLineLen if softWrap wrapToWidth true wrapMargin painter getWidth charWidth else wrapToWidth false wrapMargin else foo new char maxLineLen for int foo length foo wrapToWidth false wrapMargin int painter getFont getStringBounds foo maxLineLen painter getFontRenderContext getWidth monospacedHack jEdit getBooleanProperty maxHorizontalScrollWidth updateScrollBars chunkCache invalidateAll gutter repaint painter repaint public int offsetToX int line int offset Chunk chunks chunkCache lineToChunkList line return int horizontalOffset Chunk offsetToX chunks offset public int xToOffset int line int horizontalOffset Chunk chunks chunkCache lineToChunkList line int offset Chunk xToOffset chunks true if offset offset getLineLength line return offset public int xToOffset int line int boolean round horizontalOffset Chunk chunks chunkCache lineToChunkList line int offset Chunk xToOffset chunks round if offset offset getLineLength line return offset public final int getSelectionStart if selection size return caret return Selection selection elementAt getStart public int getSelectionStart int line if selection size return caret return Selection selection elementAt getStart buffer line public final int getSelectionStartLine if selection size return caret return Selection selection elementAt getStartLine public final void setSelectionStart int selectionStart select selectionStart getSelectionEnd true public final int getSelectionEnd if selection size return caret return Selection selection elementAt getEnd public int getSelectionEnd int line if selection size return caret return Selection selection elementAt getEnd buffer line public final int getSelectionEndLine if selection size return caret return Selection selection elementAt getEndLine public final void setSelectionEnd int selectionEnd select getSelectionStart selectionEnd true public final int getMarkPosition Selection getSelectionAtOffset caret if null return caret if start caret return end else if end caret return start else return caret public final int getMarkLine if selection size return caretLine Selection Selection selection elementAt if start caret return endLine else if end caret return startLine else return caretLine public void select int start int end select start end true public void select int start int end boolean doElectricScroll selectNone int newStart newEnd if start end newStart start newEnd end else newStart end newEnd start setSelection new Selection Range newStart newEnd moveCaretPosition end doElectricScroll public boolean isSelectionRectangular Selection getSelectionAtOffset caret if null return false else return instanceof Selection Rect Segment lineSegment MouseHandler mouseHandler ChunkCache chunkCache int maxHorizontalScrollWidth boolean softWrap boolean hardWrap float tabSize int wrapMargin boolean wrapToWidth int charWidth boolean monospacedHack boolean scrollBarsInitialized boolean queuedScrollTo boolean queuedScrollToElectric boolean queuedFireCaretEvent ArrayList runnables Vector selection Point returnValue final boolean isCaretVisible return blink hasFocus final boolean isBracketHighlightVisible return bracketLine hasFocus foldVisibilityManager isLineVisible bracketLine foldVisibilityManager isLineVisible caretLine void updateMaxHorizontalScrollWidth int max chunkCache getMaxHorizontalScrollWidth if max maxHorizontalScrollWidth maxHorizontalScrollWidth max horizontal setValues Math max Math min maxHorizontalScrollWidth charWidth painter getWidth horizontalOffset painter getWidth maxHorizontalScrollWidth charWidth void recalculateVisibleLines if painter null return int height painter getHeight int lineHeight painter getFontMetrics getHeight visibleLines height lineHeight lastLinePartial height lineHeight chunkCache recalculateVisibleLines propertiesChanged void foldStructureChanged chunkCache invalidateAll physFirstLine virtualToPhysical Math min foldVisibilityManager getVirtualLineCount firstLine setFirstLine physicalToVirtual physFirstLine updateScrollBars recalculateLastPhysicalLine gutter repaint painter repaint for int lineInfos length ChunkCache LineInfo info lineInfos if offset info offset offset info offset info length return return boolean round int offset Chunk xToOffset info chunks horizontalOffset round if offset offset info offset info length offset info offset info length return offset return int horizontalOffset Chunk offsetToX info chunks offset private static String CENTER private static String RIGHT private static String LEFT private static String BOTTOM private static Timer caretTimer private static JEditTextArea focusedComponent private View view private Gutter gutter private TextAreaPainter painter private JPopupMenu popup private EventListenerList listenerList private MutableCaretEvent caretEvent private boolean caretBlinks private boolean blink private int firstLine private int physFirstLine private int physLastLine private int screenLastLine private boolean lastLinePartial private int visibleLines private int electricScroll private int horizontalOffset private boolean quickCopy private JScrollBar vertical private JScrollBar horizontal private boolean bufferChanging private Buffer buffer private FoldVisibilityManager foldVisibilityManager private BufferChangeHandler bufferHandler private boolean bufferHandlerInstalled private int caret private int caretLine private int caretScreenLine private int bracketPosition private int bracketLine private int magicCaret private boolean multi private boolean overwrite private int maxLineLen private void Selection addMe if addMe start addMe end throw new IllegalArgumentException addMe start addMe end else if addMe start addMe end if addMe instanceof Selection Range return else if addMe instanceof Selection Rect if Selection Rect addMe extraEndVirt return for int selection size Selection Selection selection elementAt if overlaps addMe addMe start Math min start addMe start addMe end Math max end addMe end selection removeElement addMe startLine getLineOfOffset addMe start addMe endLine getLineOfOffset addMe end boolean added false for int selection size Selection Selection selection elementAt if addMe start start selection insertElementAt addMe added true break if added selection addElement addMe invalidateLineRange addMe startLine addMe endLine private void finishCaretUpdate boolean doElectricScroll boolean fireCaretEvent if queuedScrollTo return this queuedScrollToElectric doElectricScroll this queuedFireCaretEvent fireCaretEvent Runnable new Runnable public void run blink true caretTimer restart scrollToCaret queuedScrollToElectric updateBracketHighlight if queuedFireCaretEvent fireCaretEvent queuedScrollTo queuedScrollToElectric queuedFireCaretEvent false if buffer isTransactionInProgress queuedScrollTo true runnables add else run private void fireCaretEvent Object listeners listenerList getListenerList for int listeners length if listeners CaretListener class try CaretListener listeners caretUpdate caretEvent catch Throwable Log log Log ERROR this private void fireScrollEvent boolean vertical Object listeners listenerList getListenerList for int listeners length if listeners ScrollListener class try if vertical ScrollListener listeners scrolledVertically this else ScrollListener listeners scrolledHorizontally this catch Throwable Log log Log ERROR this private void insertTab int tabSize buffer getTabSize if buffer getBooleanProperty int lineStart getLineStartOffset caretLine String line getText lineStart caret lineStart int pos for int line length switch line charAt pos case pos break default if pos tabSize pos break setSelectedText MiscUtilities createWhiteSpace tabSize pos else setSelectedText private boolean doWordWrap boolean spaceInserted if hardWrap maxLineLen return false buffer getLineText caretLine lineSegment int start getLineStartOffset caretLine int end getLineEndOffset caretLine int len end start int caretPos caret start for int caretPos len char ch lineSegment array lineSegment offset if ch ch return false boolean returnValue false int tabSize buffer getTabSize String wordBreakChars buffer getStringProperty int lastWordOffset boolean lastWasSpace true for int caretPos char ch lineSegment array lineSegment offset if ch logicalLength tabSize logicalLength tabSize if lastWasSpace logicalLength maxLineLen lastWordOffset lastWasSpace true else if ch logicalLength if lastWasSpace logicalLength maxLineLen lastWordOffset lastWasSpace true else if wordBreakChars null wordBreakChars indexOf ch logicalLength if lastWasSpace logicalLength maxLineLen lastWordOffset lastWasSpace true else logicalLength lastWasSpace false int insertNewLineAt if spaceInserted logicalLength maxLineLen caretPos insertNewLineAt caretPos returnValue true else if logicalLength maxLineLen lastWordOffset insertNewLineAt lastWordOffset else continue try buffer beginCompoundEdit buffer insert start insertNewLineAt buffer indentLine caretLine true true finally buffer endCompoundEdit return returnValue return false private void doWordCount View view String text char chars text toCharArray int characters chars length int words if characters words else words int lines boolean word false for int chars length switch chars case case lines case case if word words word false break default word true break Object args new Integer characters new Integer words new Integer lines GUIUtilities message view args private void updateBracketHighlight if painter isBracketHighlightEnabled return if bracketLine invalidateLineRange bracketLine caretLine int offset caret getLineStartOffset caretLine if offset int bracketOffset TextUtilities findMatchingBracketFuzzy buffer caretLine offset if bracketOffset bracketLine getLineOfOffset bracketOffset bracketPosition bracketOffset getLineStartOffset bracketLine invalidateLineRange bracketLine caretLine if bracketLine physFirstLine bracketLine physLastLine showBracketStatusMessage bracketLine caretLine return bracketLine bracketPosition private void showBracketStatusMessage boolean backward String text buffer getLineText bracketLine trim if backward bracketLine text length switch text charAt case case case case case case text buffer getLineText bracketLine trim text break text text replace view getStatus setMessageAndClear jEdit getProperty new String text void recalculateLastPhysicalLine if softWrap chunkCache updateChunksUpTo visibleLines for int visibleLines ChunkCache LineInfo info chunkCache getLineInfo if info physicalLine physLastLine info physicalLine screenLastLine break else int virtLastLine Math min foldVisibilityManager getVirtualLineCount firstLine visibleLines screenLastLine virtLastLine firstLine physLastLine foldVisibilityManager virtualToPhysical virtLastLine static class TextAreaBorder extends AbstractBorder private static final Insets insets new Insets public void paintBorder Component Graphics int int int width int height translate setColor MetalLookAndFeel getControlDarkShadow drawRect width height setColor MetalLookAndFeel getControlHighlight drawLine width width height drawLine height width height setColor MetalLookAndFeel getControl drawLine width width drawLine height height translate public Insets getBorderInsets Component return new Insets class ScrollLayout implements LayoutManager public void addLayoutComponent String name Component comp if name equals CENTER center comp else if name equals RIGHT right comp else if name equals LEFT left comp else if name equals BOTTOM bottom comp public void removeLayoutComponent Component comp if center comp center null else if right comp right null else if left comp left null else if bottom comp bottom null public Dimension preferredLayoutSize Container parent Dimension dim new Dimension Border border getBorder Insets insets if border null insets new Insets else insets getBorder getBorderInsets JEditTextArea this dim width insets left insets right dim height insets top insets bottom Dimension leftPref left getPreferredSize dim width leftPref width Dimension centerPref center getPreferredSize dim width centerPref width dim height centerPref height Dimension rightPref right getPreferredSize dim width rightPref width Dimension bottomPref bottom getPreferredSize dim height bottomPref height return dim public Dimension minimumLayoutSize Container parent Dimension dim new Dimension Border border getBorder Insets insets if border null insets new Insets else insets getBorder getBorderInsets JEditTextArea this dim width insets left insets right dim height insets top insets bottom Dimension leftPref left getMinimumSize dim width leftPref width Dimension centerPref center getMinimumSize dim width centerPref width dim height centerPref height Dimension rightPref right getMinimumSize dim width rightPref width Dimension bottomPref bottom getMinimumSize dim height bottomPref height return dim public void layoutContainer Container parent Dimension size parent getSize Border border getBorder Insets insets if border null insets new Insets else insets getBorder getBorderInsets JEditTextArea this int itop insets top int ileft insets left int ibottom insets bottom int iright insets right int rightWidth right getPreferredSize width int leftWidth left getPreferredSize width int bottomHeight bottom getPreferredSize height int centerWidth Math max size width leftWidth rightWidth ileft iright int centerHeight Math max size height bottomHeight itop ibottom left setBounds ileft itop leftWidth centerHeight center setBounds ileft leftWidth itop centerWidth centerHeight right setBounds ileft leftWidth centerWidth itop rightWidth centerHeight bottom setBounds ileft itop centerHeight Math max size width rightWidth ileft iright bottomHeight Component center Component left Component right Component bottom static class CaretBlinker implements ActionListener public void actionPerformed ActionEvent evt if focusedComponent null focusedComponent hasFocus focusedComponent blinkCaret class MutableCaretEvent extends CaretEvent MutableCaretEvent super JEditTextArea this public int getDot return getCaretPosition public int getMark return getMarkPosition class AdjustHandler implements AdjustmentListener public void adjustmentValueChanged final AdjustmentEvent evt if scrollBarsInitialized return if evt getAdjustable vertical setFirstLine vertical getValue else setHorizontalOffset horizontal getValue class BufferChangeHandler implements BufferChangeListener boolean delayedUpdate boolean delayedMultilineUpdate int delayedRepaintStart int delayedRepaintEnd boolean delayedRecalculateLastPhysicalLine Position holdPosition public void foldLevelChanged Buffer buffer int start int end if bufferChanging end buffer isLoaded invalidateLineRange start end public void contentInserted Buffer buffer int startLine int start int numLines int length chunkCache invalidateChunksFromPhys startLine numLines if buffer isLoaded return repaintAndScroll startLine numLines for int selection size Selection Selection selection elementAt boolean changed false if instanceof Selection Rect start start instanceof Selection Range start start start length if numLines startLine getLineOfOffset start changed true if end start end length if numLines endLine getLineOfOffset end changed true if changed delayedRepaintStart Math min delayedRepaintStart startLine delayedRepaintEnd Math max delayedRepaintEnd endLine if buffer isTransactionInProgress transactionComplete buffer if caret start moveCaretPosition caret length true else moveCaretPosition caret public void contentRemoved Buffer buffer int startLine int start int numLines int length chunkCache invalidateChunksFromPhys startLine if buffer isLoaded return repaintAndScroll startLine numLines numLines int end start length for int selection size Selection Selection selection elementAt boolean changed false if start start start end start start changed true else if start end start length changed true if end start end end end start changed true else if end end end length changed true if start end selection removeElement delayedRepaintStart Math min delayedRepaintStart startLine delayedRepaintEnd Math max delayedRepaintEnd endLine else if changed if numLines startLine getLineOfOffset start endLine getLineOfOffset end delayedRepaintStart Math min delayedRepaintStart startLine delayedRepaintEnd Math max delayedRepaintEnd endLine int oldFirstLine getFirstLine if caret start caret end moveCaretPosition start false else if caret end moveCaretPosition caret length false else moveCaretPosition caret if getFirstLine oldFirstLine holdPosition null if buffer isTransactionInProgress transactionComplete buffer public void transactionComplete Buffer buffer if delayedUpdate if holdPosition null setFirstLine physicalToVirtual getBuffer getLineOfOffset holdPosition getOffset holdPosition null if delayedMultilineUpdate updateScrollBars invalidateScreenLineRange chunkCache getScreenLineOfOffset delayedRepaintStart screenLastLine delayedMultilineUpdate false else invalidateLineRange delayedRepaintStart delayedRepaintEnd delayedUpdate false if delayedRecalculateLastPhysicalLine int oldScreenLastLine screenLastLine recalculateLastPhysicalLine invalidateScreenLineRange oldScreenLastLine screenLastLine delayedRecalculateLastPhysicalLine false for int runnables size Runnable runnables get run runnables clear private void int numLines if numLines softWrap getFoldVisibilityManager getLastVisibleLine numLines getLastPhysicalLine delayedRecalculateLastPhysicalLine true private void repaintAndScroll int startLine int numLines if numLines delayedMultilineUpdate true if delayedUpdate delayedRepaintStart startLine delayedRepaintEnd startLine delayedUpdate true else delayedRepaintStart Math min delayedRepaintStart startLine delayedRepaintEnd Math max delayedRepaintEnd startLine if holdPosition null return if startLine getFirstPhysicalLine if startLine getFoldVisibilityManager getFirstVisibleLine physFirstLine virtualToPhysical firstLine delayedRecalculateLastPhysicalLine true return int virtStartLine physicalToVirtual startLine int pos int virtLine getFirstLine physicalToVirtual Math max startLine numLines virtStartLine if virtLine pos else if virtLine getVirtualLineCount pos getBufferLength else pos buffer getLineStartOffset virtualToPhysical virtLine holdPosition buffer createPosition pos class FocusHandler implements FocusListener public void focusGained FocusEvent evt if bufferChanging return if bracketLine invalidateLineRange bracketLine caretLine else invalidateLine caretLine view updateGutterBorders public void focusLost FocusEvent evt if isShowing return if bracketLine invalidateLineRange bracketLine caretLine else invalidateLine caretLine class MouseHandler extends MouseInputAdapter private int dragStartLine private int dragStartOffset private int dragStart private int clickCount private boolean dragged private boolean quickCopyDrag private boolean clearStatus private boolean control public void mousePressed MouseEvent evt control OperatingSystem isMacOS evt isMetaDown OperatingSystem isMacOS evt isControlDown view getInputHandler resetLastActionCount grabFocus if GUIUtilities isPopupTrigger evt popup null if popup isVisible popup setVisible false else GUIUtilities showPopupMenu popup painter evt getX evt getY return quickCopyDrag isQuickCopyEnabled GUIUtilities isMiddleButton evt getModifiers blink true invalidateLine caretLine int evt getX int evt getY dragStart xyToOffset painter isBlockCaretEnabled isOverwriteEnabled dragStartLine getLineOfOffset dragStart dragStartOffset dragStart getLineStartOffset dragStartLine dragged false clickCount evt getClickCount switch clickCount case doSingleClick evt break case doDoubleClick evt break doTripleClick evt break private void doSingleClick MouseEvent evt if evt isShiftDown float dragStartLineWidth offsetToXY dragStartLine getLineLength dragStartLine returnValue int extraEndVirt int evt getX if dragStartLineWidth extraEndVirt int dragStartLineWidth charWidth if charWidth charWidth extraEndVirt else extraEndVirt resizeSelection getMarkPosition dragStart extraEndVirt control moveCaretPosition dragStart false dragStartLine getMarkLine dragStart getMarkPosition dragStartOffset dragStart getLineStartOffset dragStartLine else if multi quickCopyDrag selectNone if quickCopyDrag moveCaretPosition dragStart false private void doDoubleClick MouseEvent evt if getLineLength dragStartLine return String lineText getLineText dragStartLine String noWordSep buffer getStringProperty if dragStartOffset getLineLength dragStartLine dragStartOffset boolean joinNonWordChars jEdit getBooleanProperty int wordStart TextUtilities findWordStart lineText dragStartOffset noWordSep joinNonWordChars int wordEnd TextUtilities findWordEnd lineText dragStartOffset noWordSep joinNonWordChars int lineStart getLineStartOffset dragStartLine addToSelection new Selection Range lineStart wordStart lineStart wordEnd if quickCopyDrag quickCopyDrag false moveCaretPosition lineStart wordEnd false dragged true private void doTripleClick MouseEvent evt int newCaret getLineEndOffset dragStartLine if dragStartLine buffer getLineCount newCaret addToSelection new Selection Range getLineStartOffset dragStartLine newCaret if quickCopyDrag quickCopyDrag false moveCaretPosition newCaret public void mouseDragged MouseEvent evt if GUIUtilities isPopupTrigger evt popup null popup isVisible return if evt getY setFirstLine getFirstLine else if evt getY getHeight setFirstLine getFirstLine if quickCopyDrag view getStatus setMessage jEdit getProperty clearStatus true else if control view getStatus setMessage jEdit getProperty clearStatus true switch clickCount case doSingleDrag evt control break case doDoubleDrag evt break doTripleDrag evt break private void doSingleDrag MouseEvent evt boolean rect dragged true int evt getX int dot xyToOffset Math max Math min painter getHeight evt getY painter isBlockCaretEnabled isOverwriteEnabled quickCopyDrag int dotLine buffer getLineOfOffset dot int extraEndVirt if dotLine physLastLine chunkCache getLineInfo screenLastLine lastSubregion float dotLineWidth offsetToXY dotLine getLineLength dotLine returnValue if dotLineWidth extraEndVirt int dotLineWidth charWidth if charWidth charWidth extraEndVirt resizeSelection dragStart dot extraEndVirt rect if quickCopyDrag scrollTo dotLine dot buffer getLineStartOffset dotLine false else if dot caret moveCaretPosition dot false if rect extraEndVirt scrollTo dotLine dot buffer getLineStartOffset dotLine extraEndVirt false private void doDoubleDrag MouseEvent evt int markLineStart getLineStartOffset dragStartLine int markLineLength getLineLength dragStartLine int mark dragStartOffset int pos xyToOffset evt getX Math max Math min painter getHeight evt getY painter isBlockCaretEnabled isOverwriteEnabled int line getLineOfOffset pos int lineStart getLineStartOffset line int lineLength getLineLength line int offset pos lineStart String lineText getLineText line String markLineText getLineText dragStartLine String noWordSep buffer getStringProperty boolean joinNonWordChars jEdit getBooleanProperty if markLineStart dragStartOffset lineStart offset if offset offset lineLength offset TextUtilities findWordStart lineText offset noWordSep joinNonWordChars if markLineLength mark TextUtilities findWordEnd markLineText mark noWordSep joinNonWordChars else if offset lineLength offset TextUtilities findWordEnd lineText offset noWordSep joinNonWordChars if mark mark markLineLength mark TextUtilities findWordStart markLineText mark noWordSep joinNonWordChars if lineStart offset caret return resizeSelection markLineStart mark lineStart offset false if quickCopyDrag moveCaretPosition lineStart offset false private void doTripleDrag MouseEvent evt int offset xyToOffset evt getX Math max Math min painter getHeight evt getY false int mouseLine getLineOfOffset offset int mark int mouse if dragStartLine mouseLine mark getLineEndOffset dragStartLine if offset getLineEndOffset mouseLine mouse offset else mouse getLineStartOffset mouseLine else mark getLineStartOffset dragStartLine if offset getLineStartOffset mouseLine mouse offset else if offset getLineEndOffset mouseLine mouseLine getBuffer getLineCount mouse getLineEndOffset mouseLine else mouse getLineEndOffset mouseLine mouse Math min getBuffer getLength mouse if mouse caret return dragged true resizeSelection mark mouse false moveCaretPosition mouse false public void mouseReleased MouseEvent evt if control dragged int offset xyToOffset evt getX evt getY false if offset buffer getLength buffer getText offset lineSegment switch lineSegment array lineSegment offset case case case case case case moveCaretPosition offset false selectToMatchingBracket return Selection sel getSelectionAtOffset dragStart if sel null Registers setRegister getSelectedText sel if dragged sel null if quickCopyDrag removeFromSelection sel Registers paste JEditTextArea this sel instanceof Selection Rect else Registers setRegister getSelectedText else if isQuickCopyEnabled GUIUtilities isMiddleButton evt getModifiers setCaretPosition dragStart false if isEditable getToolkit beep else Registers paste JEditTextArea this control dragged false if clearStatus clearStatus false view getStatus setMessage null static caretTimer new Timer new CaretBlinker caretTimer setInitialDelay caretTimer start class BSHFormalParameters extends SimpleNode int numArgs String argNames Class argTypes BSHFormalParameters int id super id public Object eval NameSpace namespace throws EvalError numArgs jjtGetNumChildren argNames new String numArgs argTypes new Class numArgs for int numArgs BSHFormalParameter param BSHFormalParameter jjtGetChild param eval namespace argNames param name argTypes param type return Primitive VOID public abstract class ReflectManager private static ReflectManager rfm public static ReflectManager getReflectManager if rfm null Class clas try clas BshClassManager plainClassForName rfm ReflectManager clas newInstance catch Exception throw new Unavailable return rfm public static boolean RMSetAccessible Object obj throws Unavailable return getReflectManager setAccessible obj public abstract boolean setAccessible Object public class PluginManager extends EnhancedDialog public PluginManager Frame frame super frame jEdit getProperty true JPanel content new JPanel new BorderLayout content setBorder new EmptyBorder setContentPane content JLabel caption new JLabel jEdit getProperty caption setBorder new EmptyBorder content add BorderLayout NORTH caption tree new JTree tree setCellRenderer new Renderer tree setRootVisible false tree setVisibleRowCount tree addTreeSelectionListener new TreeHandler JPanel panel new JPanel new BorderLayout panel add BorderLayout CENTER new JScrollPane tree JPanel panel2 new JPanel new BorderLayout panel2 setBorder new EmptyBorder JPanel labelBox new JPanel new GridLayout labelBox setBorder new EmptyBorder labelBox add new JLabel jEdit getProperty SwingConstants RIGHT labelBox add new JLabel jEdit getProperty SwingConstants RIGHT labelBox add new JLabel jEdit getProperty SwingConstants RIGHT panel2 add BorderLayout WEST labelBox JPanel valueBox new JPanel new GridLayout valueBox add name new JLabel valueBox add author new JLabel valueBox add version new JLabel panel2 add BorderLayout CENTER valueBox panel add BorderLayout SOUTH panel2 content add BorderLayout CENTER panel JPanel buttons new JPanel buttons setLayout new BoxLayout buttons BoxLayout X_AXIS buttons setBorder new EmptyBorder buttons add Box createGlue remove new JButton jEdit getProperty remove addActionListener new ActionHandler buttons add remove buttons add Box createHorizontalStrut update new JButton jEdit getProperty update addActionListener new ActionHandler buttons add update buttons add Box createHorizontalStrut install new JButton jEdit getProperty install addActionListener new ActionHandler buttons add install buttons add Box createHorizontalStrut close new JButton jEdit getProperty close addActionListener new ActionHandler buttons add close buttons add Box createGlue content add BorderLayout SOUTH buttons updateTree setDefaultCloseOperation DISPOSE_ON_CLOSE pack setLocationRelativeTo frame show public void ok public void cancel dispose private JTree tree private JLabel name private JLabel author private JLabel version private JButton remove private JButton update private JButton install private JButton close private PluginList pluginList private PluginList getPluginList if pluginList null pluginList new PluginListDownloadProgress PluginManager this getPluginList return pluginList private void updateTree DefaultMutableTreeNode treeRoot new DefaultMutableTreeNode DefaultTreeModel treeModel new DefaultTreeModel treeRoot DefaultMutableTreeNode loadedTree new DefaultMutableTreeNode jEdit getProperty true DefaultMutableTreeNode notLoadedTree new DefaultMutableTreeNode jEdit getProperty true DefaultMutableTreeNode newTree new DefaultMutableTreeNode jEdit getProperty true EditPlugin plugins jEdit getPlugins for int plugins length EditPlugin plugin plugins String path plugin getJAR getPath if new File path exists continue if plugin instanceof EditPlugin Broken Entry entry new Entry path plugin getClassName true notLoadedTree add new DefaultMutableTreeNode entry else Entry entry new Entry path plugin getClassName false loadedTree add new DefaultMutableTreeNode entry if notLoadedTree getChildCount treeRoot add notLoadedTree if loadedTree getChildCount treeRoot add loadedTree String newPlugins jEdit getNotLoadedPluginJARs for int newPlugins length Entry entry new Entry newPlugins null false newTree add new DefaultMutableTreeNode entry if newTree getChildCount treeRoot add newTree tree setModel treeModel for int tree getRowCount tree expandRow remove setEnabled false name setText null author setText null version setText null class Entry String clazz String name version author Vector jars boolean broken Entry String path String clazz boolean broken Entry this clazz clazz Entry this broken broken jars new Vector jars addElement path if clazz null Entry this name path else Entry this name jEdit getProperty clazz if name null name clazz Entry this version jEdit getProperty clazz Entry this author jEdit getProperty clazz String jarsProp jEdit getProperty clazz if jarsProp null String directory MiscUtilities getParentOfPath path StringTokenizer st new StringTokenizer jarsProp while st hasMoreElements jars addElement MiscUtilities constructPath directory st nextToken public String toString return Entry this name class ActionHandler implements ActionListener public void actionPerformed ActionEvent evt Object source evt getSource if source close dispose else if source remove TreePath selected tree getSelectionModel getSelectionPaths StringBuffer buf new StringBuffer Roster roster new Roster for int selected length Object last DefaultMutableTreeNode selected getLastPathComponent getUserObject if last instanceof Entry Entry entry Entry last for int entry jars size String jar String entry jars elementAt if buf length buf append buf append jar roster addOperation new Roster Remove jar String args buf toString if GUIUtilities confirm PluginManager this args JOptionPane YES_NO_OPTION JOptionPane QUESTION_MESSAGE JOptionPane YES_OPTION new PluginManagerProgress PluginManager this roster updateTree else if source update if jEdit getSettingsDirectory null GUIUtilities error PluginManager this null return PluginList list getPluginList if list null return Vector plugins new Vector for int list pluginSets size PluginList PluginSet set PluginList PluginSet list pluginSets get boolean addedSetLabel false for int set plugins size PluginList Plugin plugin PluginList Plugin list pluginHash get set plugins get PluginList Branch branch plugin getCompatibleBranch if branch null branch canSatisfyDependencies plugin installedVersion null MiscUtilities compareStrings branch version plugin installedVersion false if addedSetLabel plugins add new JCheckBoxList Entry set name addedSetLabel true plugins addElement plugin if plugins size GUIUtilities message PluginManager this null return Roster roster new Roster new InstallPluginsDialog PluginManager this plugins InstallPluginsDialog UPDATE installPlugins roster if roster isEmpty return new PluginManagerProgress PluginManager this roster updateTree else if source install if jEdit getSettingsDirectory null jEdit getJEditHome null GUIUtilities error PluginManager this null return PluginList list getPluginList if list null return Vector plugins new Vector for int list pluginSets size PluginList PluginSet set PluginList PluginSet list pluginSets get boolean addedSetLabel false for int set plugins size PluginList Plugin plugin PluginList Plugin list pluginHash get set plugins get if plugin installed null plugin canBeInstalled if addedSetLabel plugins add new JCheckBoxList Entry set name addedSetLabel true plugins addElement plugin Roster roster new Roster new InstallPluginsDialog PluginManager this plugins InstallPluginsDialog INSTALL installPlugins roster if roster isEmpty return new PluginManagerProgress PluginManager this roster updateTree class TreeHandler implements TreeSelectionListener public void valueChanged TreeSelectionEvent evt TreePath selection evt getPath DefaultMutableTreeNode node if selection null node null else node DefaultMutableTreeNode selection getLastPathComponent name setText null author setText null version setText null if node null node isLeaf node getUserObject instanceof Entry remove setEnabled true Entry entry Entry node getUserObject if entry clazz null name setText entry name author setText entry author version setText entry version else remove setEnabled false class Renderer extends DefaultTreeCellRenderer public Component getTreeCellRendererComponent JTree tree Object value boolean selected boolean expanded boolean leaf int row boolean hasFocus super getTreeCellRendererComponent tree value selected expanded leaf row hasFocus setIcon null return this public class PastePrevious extends EnhancedDialog implements ActionListener ListSelectionListener MouseListener public PastePrevious View view super view jEdit getProperty true this view view JPanel content new JPanel new BorderLayout content setBorder new EmptyBorder setContentPane content clipHistory HistoryModel getModel clips new JList new AbstractListModel public int getSize return clipHistory getSize public Object getElementAt int index StringBuffer buf new StringBuffer String item clipHistory getItem index if item toLowerCase startsWith buf append boolean ws true for int item length char ch item charAt if Character isWhitespace ch if ws else buf append ws true else ws false buf append ch return buf toString clips setVisibleRowCount clips addMouseListener this clips addListSelectionListener this insert new JButton jEdit getProperty cancel new JButton jEdit getProperty JLabel label new JLabel jEdit getProperty label setBorder new EmptyBorder content add BorderLayout NORTH label JScrollPane scroller new JScrollPane clips Dimension dim scroller getPreferredSize scroller setPreferredSize new Dimension dim height content add scroller BorderLayout CENTER JPanel panel new JPanel panel setLayout new BoxLayout panel BoxLayout X_AXIS panel setBorder new EmptyBorder panel add Box createGlue panel add insert panel add Box createHorizontalStrut panel add cancel panel add Box createGlue content add panel BorderLayout SOUTH if clipHistory getSize clips setSelectedIndex updateButtons getRootPane setDefaultButton insert insert addActionListener this cancel addActionListener this GUIUtilities requestFocus this clips pack setLocationRelativeTo view show public void ok int selected clips getSelectedIndex if selected view getToolkit beep return String clip clipHistory getItem selected view getTextArea setSelectedText clip dispose public void cancel dispose public void actionPerformed ActionEvent evt Object source evt getSource if source insert ok else if source cancel cancel public void mouseClicked MouseEvent evt if evt getClickCount ok public void mouseEntered MouseEvent evt public void mouseExited MouseEvent evt public void mousePressed MouseEvent evt public void mouseReleased MouseEvent evt public void valueChanged ListSelectionEvent evt updateButtons private View view private JList clips private HistoryModel clipHistory private JButton insert private JButton cancel private void updateButtons int selected clips getSelectedIndex insert setEnabled selected class Java14 public static void init JFrame setDefaultLookAndFeelDecorated jEdit getBooleanProperty JDialog setDefaultLookAndFeelDecorated jEdit getBooleanProperty KeyboardFocusManager setCurrentKeyboardFocusManager new MyFocusManager EditBus addToBus new EBComponent public void handleMessage EBMessage msg if msg instanceof ViewUpdate ViewUpdate vu ViewUpdate msg if vu getWhat ViewUpdate CREATED vu getView setFocusTraversalPolicy new MyFocusTraversalPolicy else if msg instanceof EditPaneUpdate EditPaneUpdate eu EditPaneUpdate msg if eu getWhat EditPaneUpdate CREATED eu getEditPane getTextArea addMouseWheelListener new MouseWheelHandler Clipboard selection Toolkit getDefaultToolkit getSystemSelection if selection null Log log Log DEBUG Java14 class Registers setRegister new Registers ClipboardRegister selection static class MyFocusManager extends DefaultKeyboardFocusManager MyFocusManager setDefaultFocusTraversalPolicy new LayoutFocusTraversalPolicy public boolean postProcessKeyEvent KeyEvent evt if evt isConsumed Component comp Component evt getSource if comp isShowing return true for if comp instanceof View View comp processKeyEvent evt return true else if comp null comp instanceof Window comp instanceof JEditTextArea break else comp comp getParent return super postProcessKeyEvent evt static class MyFocusTraversalPolicy extends LayoutFocusTraversalPolicy public Component getDefaultComponent Container focusCycleRoot return GUIUtilities getView focusCycleRoot getTextArea static class MouseWheelHandler implements MouseWheelListener public void mouseWheelMoved MouseWheelEvent JEditTextArea textArea JEditTextArea getSource if isAltDown moveCaret textArea getWheelRotation isShiftDown isControlDown else if isShiftDown scrollPage textArea getWheelRotation else if isControlDown scrollLine textArea getWheelRotation else if getScrollType MouseWheelEvent WHEEL_UNIT_SCROLL scrollLine textArea getUnitsToScroll else scrollLine textArea getWheelRotation private void scrollLine JEditTextArea textArea int amt int newpos textArea getFirstLine amt newpos Math max newpos newpos Math min newpos textArea getVirtualLineCount textArea setFirstLine newpos private void scrollPage JEditTextArea textArea int amt if amt textArea scrollDownPage else textArea scrollUpPage private void moveCaret JEditTextArea textArea int amt boolean select if amt textArea goToPrevLine select else textArea goToNextLine select public class CurrentBufferSet implements SearchFileSet public String getFirstFile View view return view getBuffer getPath public String getNextFile View view String file if file null return view getBuffer getPath else return null public String getFiles View view return new String view getBuffer getPath public int getFileCount View view return public String getCode return public class SearchBar extends JPanel public SearchBar final View view boolean temp setLayout new BoxLayout this BoxLayout X_AXIS this view view add Box createHorizontalStrut JLabel label new JLabel jEdit getProperty add label add Box createHorizontalStrut add find new HistoryTextField find setSelectAllOnFocus true Dimension max find getPreferredSize max width Integer MAX_VALUE find setMaximumSize max ActionHandler actionHandler new ActionHandler find addKeyListener new KeyHandler find addActionListener actionHandler find getDocument addDocumentListener new DocumentHandler Insets margin new Insets add Box createHorizontalStrut add ignoreCase new JCheckBox jEdit getProperty ignoreCase addActionListener actionHandler ignoreCase setMargin margin ignoreCase setRequestFocusEnabled false add Box createHorizontalStrut add regexp new JCheckBox jEdit getProperty regexp addActionListener actionHandler regexp setMargin margin regexp setRequestFocusEnabled false add Box createHorizontalStrut add hyperSearch new JCheckBox jEdit getProperty hyperSearch addActionListener actionHandler hyperSearch setMargin margin hyperSearch setRequestFocusEnabled false if temp close new RolloverButton new ImageIcon getClass getResource close addActionListener actionHandler close setToolTipText jEdit getProperty add close update timer new Timer new ActionListener public void actionPerformed ActionEvent evt if incrementalSearch searchStart searchReverse if incrementalSearch searchReverse view getBuffer getLength searchReverse view getStatus setMessageAndClear jEdit getProperty this temp temp public HistoryTextField getField return find public void setHyperSearch boolean hyperSearch jEdit setBooleanProperty hyperSearch this hyperSearch setSelected hyperSearch public void update ignoreCase setSelected SearchAndReplace getIgnoreCase regexp setSelected SearchAndReplace getRegexp hyperSearch setSelected jEdit getBooleanProperty private View view private HistoryTextField find private JCheckBox ignoreCase regexp hyperSearch private Timer timer private RolloverButton close private int searchStart private boolean searchReverse private boolean temp private void find boolean reverse timer stop String text find getText if text length jEdit setBooleanProperty hyperSearch isSelected new SearchDialog view null else if hyperSearch isSelected if temp view removeToolBar SearchBar this else find setText null SearchAndReplace setSearchString text SearchAndReplace setSearchFileSet new CurrentBufferSet SearchAndReplace hyperSearch view else int start JEditTextArea textArea view getTextArea Selection textArea getSelectionAtOffset textArea getCaretPosition if null start textArea getCaretPosition else if reverse start getStart else start getEnd if incrementalSearch start reverse if incrementalSearch reverse view getBuffer getLength reverse view getStatus setMessageAndClear jEdit getProperty else view getStatus setMessageAndClear jEdit getProperty if jEdit getBooleanProperty getToolkit beep private boolean incrementalSearch int start boolean reverse SearchAndReplace setSearchFileSet new CurrentBufferSet SearchAndReplace setSearchString find getText SearchAndReplace setReverseSearch reverse try if SearchAndReplace find view view getBuffer start false reverse return true catch Exception Log log Log DEBUG this return true return false private void timerIncrementalSearch int start boolean reverse this searchStart start this searchReverse reverse timer stop timer setRepeats false timer setInitialDelay timer start class ActionHandler implements ActionListener public void actionPerformed ActionEvent evt Object source evt getSource if source find find false else if source hyperSearch jEdit setBooleanProperty hyperSearch isSelected update else if source ignoreCase SearchAndReplace setIgnoreCase ignoreCase isSelected else if source regexp SearchAndReplace setRegexp regexp isSelected else if source close view removeToolBar SearchBar this SwingUtilities invokeLater new Runnable public void run view getEditPane focusOnTextArea class DocumentHandler implements DocumentListener public void insertUpdate DocumentEvent evt if hyperSearch isSelected int start JEditTextArea textArea view getTextArea Selection textArea getSelectionAtOffset textArea getCaretPosition if null start textArea getCaretPosition else start getStart timerIncrementalSearch start false public void removeUpdate DocumentEvent evt if hyperSearch isSelected String text find getText if text length if regexp isSelected timerIncrementalSearch false else int start JEditTextArea textArea view getTextArea Selection textArea getSelectionAtOffset textArea getCaretPosition if null start textArea getCaretPosition else start getStart timerIncrementalSearch start true public void changedUpdate DocumentEvent evt class KeyHandler extends KeyAdapter public void keyPressed KeyEvent evt switch evt getKeyCode case KeyEvent VK_LEFT case KeyEvent VK_RIGHT if hyperSearch isSelected if temp view removeToolBar SearchBar this evt consume SwingUtilities invokeLater new Runnable public void run view getEditPane focusOnTextArea view getEditPane getTextArea processKeyEvent evt break case KeyEvent VK_ESCAPE if temp view removeToolBar SearchBar this evt consume SwingUtilities invokeLater new Runnable public void run view getEditPane focusOnTextArea break case KeyEvent VK_ENTER if evt isShiftDown evt consume find regexp isSelected false true break public class CloseDialog extends EnhancedDialog public CloseDialog View view super view jEdit getProperty true this view view JPanel content new JPanel new BorderLayout content setBorder new EmptyBorder setContentPane content Box iconBox new Box BoxLayout Y_AXIS iconBox add new JLabel UIManager getIcon iconBox add Box createGlue content add BorderLayout WEST iconBox JPanel centerPanel new JPanel new BorderLayout JLabel label new JLabel jEdit getProperty label setBorder new EmptyBorder centerPanel add BorderLayout NORTH label bufferList new JList bufferModel new DefaultListModel bufferList setVisibleRowCount bufferList addListSelectionListener new ListHandler Buffer buffers jEdit getBuffers for int buffers length Buffer buffer buffers if buffer isDirty bufferModel addElement buffer getPath centerPanel add BorderLayout CENTER new JScrollPane bufferList content add BorderLayout CENTER centerPanel ActionHandler actionListener new ActionHandler Box buttons new Box BoxLayout X_AXIS buttons add Box createGlue buttons add selectAll new JButton jEdit getProperty selectAll setMnemonic jEdit getProperty charAt selectAll addActionListener actionListener buttons add Box createHorizontalStrut buttons add save new JButton jEdit getProperty save setMnemonic jEdit getProperty charAt save addActionListener actionListener buttons add Box createHorizontalStrut buttons add discard new JButton jEdit getProperty discard setMnemonic jEdit getProperty charAt discard addActionListener actionListener buttons add Box createHorizontalStrut buttons add cancel new JButton jEdit getProperty cancel addActionListener actionListener buttons add Box createGlue bufferList setSelectedIndex content add BorderLayout SOUTH buttons GUIUtilities requestFocus this bufferList pack setLocationRelativeTo view show public boolean isOK return ok public void ok public void cancel dispose private View view private JList bufferList private DefaultListModel bufferModel private JButton selectAll private JButton save private JButton discard private JButton cancel boolean selectAllFlag private void updateButtons int index bufferList getSelectedIndex save getModel setEnabled index discard getModel setEnabled index class ActionHandler implements ActionListener public void actionPerformed ActionEvent evt Object source evt getSource if source selectAll try selectAllFlag true bufferList setSelectionInterval bufferModel getSize finally selectAllFlag false bufferList requestFocus else if source save Object paths bufferList getSelectedValues for int paths length String path String paths Buffer buffer jEdit getBuffer path if buffer save view null true return VFSManager waitForRequests if buffer getBooleanProperty BufferIORequest ERROR_OCCURRED return jEdit view buffer bufferModel removeElement path if bufferModel getSize ok true dispose else bufferList setSelectedIndex bufferList requestFocus else if source discard Object paths bufferList getSelectedValues for int paths length String path String paths Buffer buffer jEdit getBuffer path jEdit view buffer bufferModel removeElement path if bufferModel getSize ok true dispose else bufferList setSelectedIndex bufferList requestFocus else if source cancel cancel class ListHandler implements ListSelectionListener public void valueChanged ListSelectionEvent evt if selectAllFlag return int index bufferList getSelectedIndex if index view setBuffer jEdit getBuffer String bufferModel getElementAt index updateButtons public class AnimatedIcon extends ImageIcon public AnimatedIcon Image icon Image frames int rate Component host super icon this icon icon this frames frames delay rate this host host public Image getFrames return frames public Image getIcon return icon public int getRate return delay public void setFrames Image frames this frames frames public void setIcon Image icon this icon icon public void setRate int rate delay rate public void start if timer null return timer new Timer delay new Animator timer start public void stop current if timer null timer stop timer null setImage icon host repaint private Image frames private int current private int delay private Timer timer private Component host private Image icon class Animator implements ActionListener public void actionPerformed ActionEvent evt current current frames length setImage frames current host repaint public class SearchDialog extends EnhancedDialog implements EBComponent public static final int CURRENT_BUFFER public static final int ALL_BUFFERS public static final int DIRECTORY public static SearchDialog getSearchDialog View view return SearchDialog viewHash get view public static void showSearchDialog View view String searchString int searchIn SearchDialog dialog SearchDialog viewHash get view if dialog null if OperatingSystem isUnix OperatingSystem isMacOS dialog setVisible false dialog setVisible true dialog setSearchString searchString searchIn GUIUtilities requestFocus dialog dialog find dialog toFront dialog requestFocus else dialog new SearchDialog view searchString searchIn viewHash put view dialog public SearchDialog View view String searchString this view searchString CURRENT_BUFFER public SearchDialog View view String searchString int searchIn super view jEdit getProperty false this view view JPanel content new JPanel new BorderLayout content setBorder new EmptyBorder setContentPane content JPanel centerPanel new JPanel new BorderLayout centerPanel add BorderLayout NORTH createFieldPanel centerPanel add BorderLayout CENTER createSearchSettingsPanel content add BorderLayout CENTER centerPanel content add BorderLayout SOUTH createMultiFilePanel content add BorderLayout EAST createButtonsPanel ignoreCase setSelected SearchAndReplace getIgnoreCase regexp setSelected SearchAndReplace getRegexp wrap setSelected SearchAndReplace getAutoWrapAround if SearchAndReplace getReverseSearch searchBack setSelected true else searchForward setSelected true if SearchAndReplace getBeanShellReplace replace setModel beanShellReplace setSelected true else replace setModel stringReplace setSelected true SearchFileSet fileset SearchAndReplace getSearchFileSet if fileset instanceof DirectoryListSet filter setText DirectoryListSet fileset getFileFilter directory setText DirectoryListSet fileset getDirectory searchSubDirectories setSelected DirectoryListSet fileset isRecursive else String path view getBuffer getDirectory if path endsWith path endsWith File separator path path substring path length directory setText path if fileset instanceof AllBufferSet filter setText AllBufferSet fileset getFileFilter else filter setText MiscUtilities getFileExtension view getBuffer getName searchSubDirectories setSelected true directory addCurrentToHistory keepDialog setSelected jEdit getBooleanProperty setSearchString searchString searchIn pack jEdit unsetProperty jEdit unsetProperty jEdit unsetProperty jEdit unsetProperty GUIUtilities loadGeometry this show EditBus addToBus this GUIUtilities requestFocus this find public void setSearchString String searchString int searchIn if searchString null find setText null else if searchString indexOf find setText searchString find selectAll else if searchIn CURRENT_BUFFER searchSelection setSelected true hyperSearch setSelected true if searchIn CURRENT_BUFFER if searchSelection isSelected searchCurrentBuffer setSelected true hyperSearch setSelected jEdit getBooleanProperty else if searchIn ALL_BUFFERS searchAllBuffers setSelected true hyperSearch setSelected true else if searchIn DIRECTORY hyperSearch setSelected true searchDirectory setSelected true updateEnabled public void ok try setCursor Cursor getPredefinedCursor Cursor WAIT_CURSOR if save false return if hyperSearch isSelected searchSelection isSelected if SearchAndReplace hyperSearch view searchSelection isSelected closeOrKeepDialog else if SearchAndReplace find view closeOrKeepDialog else toFront requestFocus find requestFocus finally setCursor Cursor getPredefinedCursor Cursor DEFAULT_CURSOR public void cancel save true GUIUtilities saveGeometry this dispose public void handleMessage EBMessage msg if msg instanceof SearchSettingsChanged ignoreCase setSelected SearchAndReplace getIgnoreCase regexp setSelected SearchAndReplace getRegexp else if msg instanceof ViewUpdate ViewUpdate vmsg ViewUpdate msg if vmsg getView view vmsg getWhat ViewUpdate CLOSED viewHash remove view public void dispose EditBus removeFromBus this viewHash remove view super dispose private static HashMap viewHash new HashMap private View view private HistoryTextField find replace private JRadioButton stringReplace beanShellReplace private JCheckBox keepDialog ignoreCase regexp hyperSearch wrap private JRadioButton searchBack searchForward private JRadioButton searchSelection searchCurrentBuffer searchAllBuffers searchDirectory private HistoryTextField filter directory private JCheckBox searchSubDirectories private JButton choose closeBtn private JPanel createFieldPanel ButtonActionHandler actionHandler new ButtonActionHandler JPanel fieldPanel new JPanel new VariableGridLayout VariableGridLayout FIXED_NUM_COLUMNS fieldPanel setBorder new EmptyBorder JLabel label new JLabel jEdit getProperty label setDisplayedMnemonic jEdit getProperty charAt find new HistoryTextField find setColumns find addActionListener actionHandler label setLabelFor find label setBorder new EmptyBorder fieldPanel add label fieldPanel add find label new JLabel jEdit getProperty label setDisplayedMnemonic jEdit getProperty charAt label setBorder new EmptyBorder fieldPanel add label ButtonGroup grp new ButtonGroup ReplaceActionHandler replaceActionHandler new ReplaceActionHandler Box replaceModeBox new Box BoxLayout X_AXIS stringReplace new MyJRadioButton jEdit getProperty stringReplace addActionListener replaceActionHandler grp add stringReplace replaceModeBox add stringReplace replaceModeBox add Box createHorizontalStrut beanShellReplace new MyJRadioButton jEdit getProperty beanShellReplace addActionListener replaceActionHandler grp add beanShellReplace replaceModeBox add beanShellReplace fieldPanel add replaceModeBox fieldPanel add Box createVerticalStrut replace new HistoryTextField replace addActionListener actionHandler label setLabelFor replace fieldPanel add replace return fieldPanel private JPanel createSearchSettingsPanel JPanel searchSettings new JPanel new VariableGridLayout VariableGridLayout FIXED_NUM_COLUMNS searchSettings setBorder new EmptyBorder SettingsActionHandler actionHandler new SettingsActionHandler ButtonGroup fileset new ButtonGroup ButtonGroup direction new ButtonGroup searchSettings add new JLabel jEdit getProperty searchSettings add new JLabel jEdit getProperty searchSettings add new JLabel jEdit getProperty searchSelection new JRadioButton jEdit getProperty searchSelection setMnemonic jEdit getProperty charAt fileset add searchSelection searchSettings add searchSelection searchSelection addActionListener actionHandler keepDialog new JCheckBox jEdit getProperty keepDialog setMnemonic jEdit getProperty charAt searchSettings add keepDialog searchBack new JRadioButton jEdit getProperty searchBack setMnemonic jEdit getProperty charAt direction add searchBack searchSettings add searchBack searchBack addActionListener actionHandler searchCurrentBuffer new JRadioButton jEdit getProperty searchCurrentBuffer setMnemonic jEdit getProperty charAt fileset add searchCurrentBuffer searchSettings add searchCurrentBuffer searchCurrentBuffer addActionListener actionHandler ignoreCase new JCheckBox jEdit getProperty ignoreCase setMnemonic jEdit getProperty charAt searchSettings add ignoreCase ignoreCase addActionListener actionHandler searchForward new JRadioButton jEdit getProperty searchForward setMnemonic jEdit getProperty charAt direction add searchForward searchSettings add searchForward searchForward addActionListener actionHandler searchAllBuffers new JRadioButton jEdit getProperty searchAllBuffers setMnemonic jEdit getProperty charAt fileset add searchAllBuffers searchSettings add searchAllBuffers searchAllBuffers addActionListener actionHandler regexp new JCheckBox jEdit getProperty regexp setMnemonic jEdit getProperty charAt searchSettings add regexp regexp addActionListener actionHandler wrap new JCheckBox jEdit getProperty wrap setMnemonic jEdit getProperty charAt searchSettings add wrap wrap addActionListener actionHandler searchDirectory new JRadioButton jEdit getProperty searchDirectory setMnemonic jEdit getProperty charAt fileset add searchDirectory searchSettings add searchDirectory searchDirectory addActionListener actionHandler hyperSearch new JCheckBox jEdit getProperty hyperSearch setMnemonic jEdit getProperty charAt searchSettings add hyperSearch hyperSearch addActionListener actionHandler return searchSettings private JPanel createMultiFilePanel JPanel multifile new JPanel GridBagLayout layout new GridBagLayout multifile setLayout layout GridBagConstraints cons new GridBagConstraints cons gridy cons gridwidth cons gridheight cons anchor GridBagConstraints WEST cons fill GridBagConstraints HORIZONTAL MultiFileActionHandler actionListener new MultiFileActionHandler filter new HistoryTextField filter addActionListener actionListener cons insets new Insets JLabel label new JLabel jEdit getProperty SwingConstants RIGHT label setBorder new EmptyBorder label setDisplayedMnemonic jEdit getProperty charAt label setLabelFor filter cons weightx layout setConstraints label cons multifile add label cons insets new Insets cons weightx layout setConstraints filter cons multifile add filter cons gridy directory new HistoryTextField directory setColumns directory addActionListener actionListener label new JLabel jEdit getProperty SwingConstants RIGHT label setBorder new EmptyBorder label setDisplayedMnemonic jEdit getProperty charAt label setLabelFor directory cons insets new Insets cons weightx layout setConstraints label cons multifile add label cons insets new Insets cons weightx cons gridwidth layout setConstraints directory cons multifile add directory choose new JButton jEdit getProperty choose setMnemonic jEdit getProperty charAt cons insets new Insets cons weightx cons gridwidth layout setConstraints choose cons multifile add choose choose addActionListener actionListener cons insets new Insets cons gridy cons gridwidth searchSubDirectories new JCheckBox jEdit getProperty searchSubDirectories setMnemonic jEdit getProperty charAt layout setConstraints searchSubDirectories cons multifile add searchSubDirectories return multifile private Box createButtonsPanel Box box new Box BoxLayout Y_AXIS ButtonActionHandler actionHandler new ButtonActionHandler box add Box createVerticalStrut JPanel grid new JPanel new GridLayout findBtn new JButton jEdit getProperty getRootPane setDefaultButton findBtn grid add findBtn findBtn addActionListener actionHandler replaceAndFindBtn new JButton jEdit getProperty replaceAndFindBtn setMnemonic jEdit getProperty charAt grid add replaceAndFindBtn replaceAndFindBtn addActionListener actionHandler replaceAllBtn new JButton jEdit getProperty replaceAllBtn setMnemonic jEdit getProperty charAt grid add replaceAllBtn replaceAllBtn addActionListener actionHandler closeBtn new JButton jEdit getProperty grid add closeBtn closeBtn addActionListener actionHandler grid setMaximumSize grid getPreferredSize box add grid box add Box createGlue return box private void updateEnabled wrap setEnabled hyperSearch isSelected searchSelection isSelected boolean reverseEnabled hyperSearch isSelected searchCurrentBuffer isSelected regexp isSelected searchBack setEnabled reverseEnabled searchForward setEnabled reverseEnabled if reverseEnabled searchForward setSelected true filter setEnabled searchAllBuffers isSelected searchDirectory isSelected boolean directoryEnabled searchDirectory isSelected directory setEnabled directoryEnabled choose setEnabled directoryEnabled searchSubDirectories setEnabled directoryEnabled findBtn setEnabled searchSelection isSelected hyperSearch isSelected replaceAndFindBtn setEnabled hyperSearch isSelected searchSelection isSelected private boolean save boolean cancel String filter this filter getText this filter addCurrentToHistory if filter length filter SearchFileSet fileset SearchAndReplace getSearchFileSet if searchSelection isSelected fileset new CurrentBufferSet else if searchCurrentBuffer isSelected fileset new CurrentBufferSet jEdit setBooleanProperty hyperSearch isSelected else if searchAllBuffers isSelected fileset new AllBufferSet filter else if searchDirectory isSelected String directory this directory getText this directory addCurrentToHistory if VFSManager getVFSForPath directory getCapabilities VFS LOW_LATENCY_CAP if cancel return false int retVal GUIUtilities confirm SearchDialog this null JOptionPane YES_NO_OPTION JOptionPane WARNING_MESSAGE if retVal JOptionPane YES_OPTION return false boolean recurse searchSubDirectories isSelected if fileset instanceof DirectoryListSet DirectoryListSet dset DirectoryListSet fileset if dset getDirectory equals directory dset getFileFilter equals filter dset isRecursive recurse fileset new DirectoryListSet directory filter recurse else fileset new DirectoryListSet directory filter recurse else fileset null jEdit setBooleanProperty keepDialog isSelected boolean ok true SearchAndReplace setSearchFileSet fileset if find getText length find addCurrentToHistory SearchAndReplace setSearchString find getText replace addCurrentToHistory SearchAndReplace setReplaceString replace getText else ok false return ok private void closeOrKeepDialog if keepDialog isSelected if hyperSearch isSelected toFront requestFocus find requestFocus return else GUIUtilities saveGeometry this dispose class MyJRadioButton extends JRadioButton MyJRadioButton String label super label public boolean isFocusTraversable return false class ReplaceActionHandler implements ActionListener public void actionPerformed ActionEvent evt replace setModel beanShellReplace isSelected SearchAndReplace setBeanShellReplace beanShellReplace isSelected class SettingsActionHandler implements ActionListener public void actionPerformed ActionEvent evt Object source evt getSource if source ignoreCase SearchAndReplace setIgnoreCase ignoreCase isSelected else if source regexp SearchAndReplace setRegexp regexp isSelected else if source searchBack source searchForward SearchAndReplace setReverseSearch searchBack isSelected else if source wrap SearchAndReplace setAutoWrapAround wrap isSelected else if source searchCurrentBuffer hyperSearch setSelected false else if source searchSelection source searchAllBuffers source searchDirectory hyperSearch setSelected true updateEnabled class MultiFileActionHandler implements ActionListener public void actionPerformed ActionEvent evt if evt getSource choose String dirs GUIUtilities showVFSFileDialog view directory getText VFSBrowser CHOOSE_DIRECTORY_DIALOG false if dirs null directory setText dirs ok class ButtonActionHandler implements ActionListener public void actionPerformed ActionEvent evt Object source evt getSource if source closeBtn cancel else if source findBtn source find source replace ok else if source replaceAndFindBtn save false if SearchAndReplace replace view ok else getToolkit beep else if source replaceAllBtn setCursor Cursor getPredefinedCursor Cursor WAIT_CURSOR save false if searchSelection isSelected if SearchAndReplace replace view closeOrKeepDialog else getToolkit beep else if SearchAndReplace replaceAll view closeOrKeepDialog else getToolkit beep setCursor Cursor getPredefinedCursor Cursor DEFAULT_CURSOR final class RETokenLookAhead extends REToken REToken re boolean negative RETokenLookAhead REToken re boolean negative throws REException super this re re this negative negative boolean match CharIndexed input REMatch mymatch REMatch trymatch REMatch mymatch clone REMatch trymatch1 REMatch mymatch clone REMatch newMatch null if re match input trymatch if negative return false if next input trymatch1 newMatch trymatch1 if newMatch null if negative return false mymatch assignFrom newMatch return true if negative return next input mymatch return false void dump StringBuffer os os append os append negative re dumpAll os os append public final class RESyntax implements Serializable static final String DEFAULT_LINE_SEPARATOR System getProperty private static final String SYNTAX_IS_FINAL RE getLocalizedMessage private BitSet bits private boolean isFinal false private String lineSeparator DEFAULT_LINE_SEPARATOR public static final int RE_BACKSLASH_ESCAPE_IN_LISTS public static final int RE_BK_PLUS_QM public static final int RE_CHAR_CLASSES public static final int RE_CONTEXT_INDEP_ANCHORS public static final int RE_CONTEXT_INDEP_OPS public static final int RE_CONTEXT_INVALID_OPS public static final int RE_DOT_NEWLINE public static final int RE_DOT_NOT_NULL public static final int RE_INTERVALS public static final int RE_LIMITED_OPS public static final int RE_NO_BK_BRACES public static final int RE_NO_BK_PARENS public static final int RE_NO_BK_REFS public static final int RE_NO_BK_VBAR public static final int RE_NO_EMPTY_RANGES public static final int RE_UNMATCHED_RIGHT_PAREN_ORD public static final int RE_HAT_LISTS_NOT_NEWLINE public static final int RE_STINGY_OPS public static final int RE_CHAR_CLASS_ESCAPES public static final int RE_PURE_GROUPING public static final int RE_LOOKAHEAD public static final int RE_STRING_ANCHORS public static final int RE_COMMENTS public static final int RE_CHAR_CLASS_ESC_IN_LISTS private static final int BIT_TOTAL public static final RESyntax RE_SYNTAX_AWK public static final RESyntax RE_SYNTAX_ED public static final RESyntax RE_SYNTAX_EGREP public static final RESyntax RE_SYNTAX_EMACS public static final RESyntax RE_SYNTAX_GREP public static final RESyntax RE_SYNTAX_POSIX_AWK public static final RESyntax RE_SYNTAX_POSIX_BASIC public static final RESyntax RE_SYNTAX_POSIX_EGREP public static final RESyntax RE_SYNTAX_POSIX_EXTENDED public static final RESyntax RE_SYNTAX_POSIX_MINIMAL_BASIC public static final RESyntax RE_SYNTAX_POSIX_MINIMAL_EXTENDED public static final RESyntax RE_SYNTAX_SED public static final RESyntax RE_SYNTAX_PERL4 public static final RESyntax RE_SYNTAX_PERL5 public static final RESyntax RE_SYNTAX_PERL5_S public static final RESyntax RE_SYNTAX_JAVA_1_4 static RE_SYNTAX_EMACS new RESyntax makeFinal RESyntax RE_SYNTAX_POSIX_COMMON new RESyntax set RE_CHAR_CLASSES set RE_DOT_NEWLINE set RE_DOT_NOT_NULL set RE_INTERVALS set RE_NO_EMPTY_RANGES makeFinal RE_SYNTAX_POSIX_BASIC new RESyntax RE_SYNTAX_POSIX_COMMON set RE_BK_PLUS_QM makeFinal RE_SYNTAX_POSIX_EXTENDED new RESyntax RE_SYNTAX_POSIX_COMMON set RE_CONTEXT_INDEP_ANCHORS set RE_CONTEXT_INDEP_OPS set RE_NO_BK_BRACES set RE_NO_BK_PARENS set RE_NO_BK_VBAR set RE_UNMATCHED_RIGHT_PAREN_ORD makeFinal RE_SYNTAX_AWK new RESyntax set RE_BACKSLASH_ESCAPE_IN_LISTS set RE_DOT_NOT_NULL set RE_NO_BK_PARENS set RE_NO_BK_REFS set RE_NO_BK_VBAR set RE_NO_EMPTY_RANGES set RE_UNMATCHED_RIGHT_PAREN_ORD makeFinal RE_SYNTAX_POSIX_AWK new RESyntax RE_SYNTAX_POSIX_EXTENDED set RE_BACKSLASH_ESCAPE_IN_LISTS makeFinal RE_SYNTAX_GREP new RESyntax set RE_BK_PLUS_QM set RE_CHAR_CLASSES set RE_HAT_LISTS_NOT_NEWLINE set RE_INTERVALS set RE_NEWLINE_ALT makeFinal RE_SYNTAX_EGREP new RESyntax set RE_CHAR_CLASSES set RE_CONTEXT_INDEP_ANCHORS set RE_CONTEXT_INDEP_OPS set RE_HAT_LISTS_NOT_NEWLINE set RE_NEWLINE_ALT set RE_NO_BK_PARENS set RE_NO_BK_VBAR makeFinal RE_SYNTAX_POSIX_EGREP new RESyntax RE_SYNTAX_EGREP set RE_INTERVALS set RE_NO_BK_BRACES makeFinal RE_SYNTAX_ED new RESyntax RE_SYNTAX_POSIX_BASIC makeFinal RE_SYNTAX_SED new RESyntax RE_SYNTAX_POSIX_BASIC makeFinal RE_SYNTAX_POSIX_MINIMAL_BASIC new RESyntax RE_SYNTAX_POSIX_COMMON set RE_LIMITED_OPS makeFinal RE_SYNTAX_POSIX_MINIMAL_EXTENDED new RESyntax RE_SYNTAX_POSIX_COMMON set RE_CONTEXT_INDEP_ANCHORS set RE_CONTEXT_INVALID_OPS set RE_NO_BK_BRACES set RE_NO_BK_PARENS set RE_NO_BK_REFS set RE_NO_BK_VBAR set RE_UNMATCHED_RIGHT_PAREN_ORD makeFinal RE_SYNTAX_PERL4 new RESyntax set RE_BACKSLASH_ESCAPE_IN_LISTS set RE_CONTEXT_INDEP_ANCHORS set RE_INTERVALS set RE_NO_BK_BRACES set RE_NO_BK_PARENS set RE_NO_BK_VBAR set RE_NO_EMPTY_RANGES makeFinal RE_SYNTAX_PERL4_S new RESyntax RE_SYNTAX_PERL4 set RE_DOT_NEWLINE makeFinal RE_SYNTAX_PERL5 new RESyntax RE_SYNTAX_PERL4 makeFinal RE_SYNTAX_PERL5_S new RESyntax RE_SYNTAX_PERL5 set RE_DOT_NEWLINE makeFinal RE_SYNTAX_JAVA_1_4 new RESyntax RE_SYNTAX_PERL5 makeFinal public RESyntax bits new BitSet BIT_TOTAL public RESyntax makeFinal isFinal true return this public RESyntax RESyntax other bits BitSet other bits clone public boolean get int index return bits get index public RESyntax set int index if isFinal throw new IllegalAccessError SYNTAX_IS_FINAL bits set index return this public RESyntax clear int index if isFinal throw new IllegalAccessError SYNTAX_IS_FINAL bits clear index return this public RESyntax setLineSeparator String aSeparator if isFinal throw new IllegalAccessError SYNTAX_IS_FINAL lineSeparator aSeparator return this public String getLineSeparator return lineSeparator class BSHTypedVariableDeclaration extends SimpleNode public boolean isFinal BSHTypedVariableDeclaration int id super id public Object eval CallStack callstack Interpreter interpreter throws EvalError try NameSpace namespace callstack top BSHType typeNode BSHType jjtGetChild Class type typeNode getType namespace int jjtGetNumChildren for int BSHVariableDeclarator dec BSHVariableDeclarator jjtGetChild Object value dec eval typeNode callstack interpreter if value Primitive VOID value null else if value Primitive NULL else if canCastToDeclaredType value type value BSHCastExpression castObject value type else namespace setTypedVariable dec name type value isFinal catch EvalError reThrow this return Primitive VOID boolean canCastToDeclaredType Object value Class toType if value instanceof Primitive return false Class fromType Primitive value getType if toType Byte TYPE toType Short TYPE toType Character TYPE fromType Integer TYPE return true else return false public class FoldVisibilityManager public FoldVisibilityManager Buffer buffer OffsetManager offsetMgr JEditTextArea textArea this buffer buffer this offsetMgr offsetMgr this textArea textArea public boolean isNarrowed return narrowed public int getVirtualLineCount return offsetMgr getVirtualLineCount index public final boolean isLineVisible int line if line line offsetMgr getLineCount throw new ArrayIndexOutOfBoundsException line try buffer readLock return offsetMgr isLineVisible line index finally buffer readUnlock public int getFirstVisibleLine try buffer readLock for int buffer getLineCount if offsetMgr isLineVisible index return finally buffer readUnlock return public int getLastVisibleLine try buffer readLock for int buffer getLineCount if offsetMgr isLineVisible index return finally buffer readUnlock return public int getNextVisibleLine int line if line line offsetMgr getLineCount throw new ArrayIndexOutOfBoundsException line try buffer readLock if line buffer getLineCount return for int line buffer getLineCount if offsetMgr isLineVisible index return return finally buffer readUnlock public int getPrevVisibleLine int line if line line offsetMgr getLineCount throw new ArrayIndexOutOfBoundsException line try buffer readLock if line return for int line if offsetMgr isLineVisible index return return finally buffer readUnlock public int physicalToVirtual int line try buffer readLock if line throw new ArrayIndexOutOfBoundsException line else if line offsetMgr getLineCount throw new ArrayIndexOutOfBoundsException line buffer getLineCount if getVirtualLineCount buffer getLineCount return line while offsetMgr isLineVisible line index line line if line offsetMgr isLineVisible line index return if lastPhysical line if lastVirtual lastVirtual offsetMgr getVirtualLineCount index throw new ArrayIndexOutOfBoundsException lastVirtual else if line lastPhysical lastPhysical for if lastPhysical line break if offsetMgr isLineVisible lastPhysical index lastVirtual if lastPhysical buffer getLineCount break else lastPhysical if lastVirtual lastVirtual offsetMgr getVirtualLineCount index throw new ArrayIndexOutOfBoundsException lastVirtual else if line lastPhysical lastPhysical line line for if lastPhysical line break if offsetMgr isLineVisible lastPhysical index lastVirtual if lastPhysical break else lastPhysical if lastVirtual lastVirtual offsetMgr getVirtualLineCount index throw new ArrayIndexOutOfBoundsException lastVirtual else lastPhysical while offsetMgr isLineVisible lastPhysical index lastPhysical lastVirtual for if lastPhysical line break if offsetMgr isLineVisible lastPhysical index lastVirtual if lastPhysical buffer getLineCount break else lastPhysical if lastVirtual lastVirtual offsetMgr getVirtualLineCount index throw new ArrayIndexOutOfBoundsException lastVirtual return lastVirtual finally buffer readUnlock public int virtualToPhysical int line try buffer readLock if line throw new ArrayIndexOutOfBoundsException line else if line offsetMgr getVirtualLineCount index throw new ArrayIndexOutOfBoundsException line offsetMgr getVirtualLineCount index if getVirtualLineCount buffer getLineCount return line if lastVirtual line if lastPhysical lastPhysical buffer getLineCount throw new ArrayIndexOutOfBoundsException lastPhysical else if line lastVirtual lastVirtual for if offsetMgr isLineVisible lastPhysical index if lastVirtual line break else lastVirtual if lastPhysical buffer getLineCount break else lastPhysical if lastPhysical lastPhysical buffer getLineCount throw new ArrayIndexOutOfBoundsException lastPhysical else if line lastVirtual lastVirtual line line for if offsetMgr isLineVisible lastPhysical index if lastVirtual line break else lastVirtual if lastPhysical break else lastPhysical if lastPhysical lastPhysical buffer getLineCount throw new ArrayIndexOutOfBoundsException lastPhysical else lastPhysical while offsetMgr isLineVisible lastPhysical index lastPhysical lastVirtual for if offsetMgr isLineVisible lastPhysical index if lastVirtual line break else lastVirtual if lastPhysical buffer getLineCount break else lastPhysical if lastPhysical lastPhysical buffer getLineCount throw new ArrayIndexOutOfBoundsException lastPhysical return lastPhysical finally buffer readUnlock public void collapseFold int line int lineCount buffer getLineCount int start int end lineCount try buffer writeLock if line line buffer getLineCount buffer isFoldStart line offsetMgr isLineVisible line index line int initialFoldLevel buffer getFoldLevel line if line lineCount buffer getFoldLevel line initialFoldLevel start line for int line lineCount if buffer getFoldLevel initialFoldLevel end break else boolean ok false for int line if buffer getFoldLevel initialFoldLevel start ok true break if ok return for int line lineCount if buffer getFoldLevel initialFoldLevel end break int delta end start for int start end if offsetMgr isLineVisible index offsetMgr setLineVisible index false else delta if delta return offsetMgr setVirtualLineCount index offsetMgr getVirtualLineCount index delta finally buffer writeUnlock foldStructureChanged int virtualLine physicalToVirtual start if textArea getFirstLine virtualLine textArea setFirstLine virtualLine textArea getElectricScroll public int expandFold int line boolean fully int returnValue int lineCount buffer getLineCount int start int end lineCount int delta try buffer writeLock int initialFoldLevel buffer getFoldLevel line if line lineCount offsetMgr isLineVisible line index offsetMgr isLineVisible line index buffer getFoldLevel line initialFoldLevel start line for int line lineCount buffer getFoldLevel initialFoldLevel end break else boolean ok false for int line if offsetMgr isLineVisible index buffer getFoldLevel initialFoldLevel start ok true break if ok return for int line lineCount if offsetMgr isLineVisible index buffer getFoldLevel initialFoldLevel getLastVisibleLine end break initialFoldLevel buffer getFoldLevel start for int start end buffer getFoldLevel for int start end if buffer getFoldLevel initialFoldLevel if returnValue buffer isFoldStart returnValue if offsetMgr isLineVisible index fully delta offsetMgr setLineVisible index true else if offsetMgr isLineVisible index delta offsetMgr setLineVisible index true offsetMgr setVirtualLineCount index offsetMgr getVirtualLineCount index delta if fully offsetMgr isLineVisible line index expandFold line false return returnValue finally buffer writeUnlock foldStructureChanged int virtualLine physicalToVirtual start int firstLine textArea getFirstLine int visibleLines textArea getVisibleLines if virtualLine delta firstLine visibleLines delta visibleLines textArea setFirstLine virtualLine delta visibleLines return returnValue public void expandAllFolds try buffer writeLock narrowed false if offsetMgr getVirtualLineCount index buffer getLineCount return offsetMgr setVirtualLineCount index buffer getLineCount for int buffer getLineCount offsetMgr setLineVisible index true foldStructureChanged finally buffer writeUnlock public void expandFolds char digit if digit digit Toolkit getDefaultToolkit beep return else expandFolds int digit public void expandFolds int foldLevel try buffer writeLock narrowed false offsetMgr setVirtualLineCount index buffer getLineCount int newVirtualLineCount foldLevel foldLevel buffer getIndentSize boolean seenVisibleLine false for int buffer getLineCount if seenVisibleLine buffer getFoldLevel foldLevel seenVisibleLine true offsetMgr setLineVisible index true newVirtualLineCount else offsetMgr setLineVisible index false offsetMgr setVirtualLineCount index newVirtualLineCount finally buffer writeUnlock foldStructureChanged public void narrow int start int end if start end start end offsetMgr getLineCount throw new ArrayIndexOutOfBoundsException start end if start getFirstVisibleLine end getLastVisibleLine expandAllFolds else if start offsetMgr getLineCount offsetMgr isLineVisible start index expandFold start false int virtualLineCount offsetMgr getVirtualLineCount index for int start if offsetMgr isLineVisible index virtualLineCount offsetMgr setLineVisible index false for int end buffer getLineCount if offsetMgr isLineVisible index virtualLineCount offsetMgr setLineVisible index false offsetMgr setVirtualLineCount index virtualLineCount narrowed true foldStructureChanged GUIUtilities getView textArea getStatus setMessageAndClear jEdit getProperty public final void int index this index index lastPhysical lastVirtual public final void index public final int return index public void int startLine if lastPhysical startLine lastPhysical lastVirtual public void foldStructureChanged lastPhysical lastVirtual textArea foldStructureChanged private Buffer buffer private OffsetManager offsetMgr private JEditTextArea textArea private int index private int lastPhysical private int lastVirtual private boolean narrowed public abstract class EditAction public EditAction String name this name name public String getName return name public String getLabel return jEdit getProperty name public String getMouseOverText return null public abstract void invoke View view public static View getView Component comp return GUIUtilities getView comp public boolean isToggle return false public boolean isSelected View view return false public boolean noRepeat return false public boolean noRecord return false public abstract String getCode public String toString return name private String name public static class Wrapper implements ActionListener public Wrapper EditAction action this action action public void actionPerformed ActionEvent evt jEdit getActiveView getInputHandler invokeAction action private EditAction action public class EditServer extends Thread EditServer String portFile super portFile setDaemon true this portFile portFile try if OperatingSystem isUnix new File portFile createNewFile FileVFS setPermissions portFile socket new ServerSocket InetAddress getByName authKey Math abs new Random nextInt int port socket getLocalPort FileWriter out new FileWriter portFile out write out write String valueOf port out write out write String valueOf authKey out write out close Log log Log DEBUG this socket getLocalPort Log log Log DEBUG this authKey ok true catch IOException io Log log Log NOTICE this io public void run for if abort return Socket client null try client socket accept client setSoTimeout Log log Log MESSAGE this client DataInputStream in new DataInputStream client getInputStream if handleClient client in abort true catch Exception if abort Log log Log ERROR this abort true finally if client null try client close catch Exception Log log Log ERROR this client null public static void handleClient boolean restore String parent String args String splitConfig null boolean newView jEdit getBooleanProperty if jEdit getFirstView null newView Buffer buffer jEdit openFiles null parent args if restore if jEdit getFirstBuffer null jEdit getFirstBuffer isUntitled jEdit getBufferCount splitConfig jEdit restoreOpenFiles else if jEdit getBooleanProperty jEdit restoreOpenFiles if jEdit getFirstBuffer null jEdit getFirstBuffer isUntitled jEdit getBufferCount buffer jEdit newFile null if splitConfig null jEdit newView null splitConfig else jEdit newView null buffer else View view jEdit getFirstView jEdit openFiles view parent args if OperatingSystem isWindows view setState java awt Frame ICONIFIED view setState java awt Frame NORMAL view requestFocus view toFront return boolean isOK return ok void stopServer abort true try socket close catch IOException io new File portFile delete private String portFile private ServerSocket socket private int authKey private boolean ok private boolean abort private boolean handleClient Socket client DataInputStream in throws Exception int key in readInt if key authKey Log log Log ERROR this client key authKey in close client close return false else client setSoTimeout Log log Log DEBUG this client final String script in readUTF Log log Log DEBUG this script SwingUtilities invokeLater new Runnable public void run BeanShell eval null BeanShell getNameSpace script return true public interface ParserConstants int EOF int NONPRINTABLE int SINGLE_LINE_COMMENT int HASH_BANG_COMMENT int MULTI_LINE_COMMENT int BOOLEAN int BREAK int CLASS int BYTE int CASE int CATCH int CHAR int CONST int CONTINUE int int DO int DOUBLE int ELSE int FALSE int FINAL int FINALLY int FLOAT int FOR int GOTO int IF int IMPORT int INSTANCEOF int INT int INTERFACE int LONG int NEW int NULL int PRIVATE int PROTECTED int PUBLIC int RETURN int SHORT int STATIC int SWITCH int THROW int TRUE int TRY int VOID int WHILE int INTEGER_LITERAL int DECIMAL_LITERAL int HEX_LITERAL int OCTAL_LITERAL int FLOATING_POINT_LITERAL int EXPONENT int CHARACTER_LITERAL int STRING_LITERAL int FORMAL_COMMENT int IDENTIFIER int LETTER int DIGIT int LPAREN int RPAREN int LBRACE int RBRACE int LBRACKET int RBRACKET int SEMICOLON int COMMA int DOT int ASSIGN int GT int GTX int LT int LTX int BANG int TILDE int HOOK int COLON int EQ int LE int LEX int GE int GEX int NE int BOOL_OR int BOOL_ORX int BOOL_AND int BOOL_ANDX int INCR int DECR int PLUS int MINUS int STAR int SLASH int BIT_AND int BIT_ANDX int BIT_OR int BIT_ORX int XOR int MOD int LSHIFT int LSHIFTX int RSIGNEDSHIFT int RSIGNEDSHIFTX int RUNSIGNEDSHIFT int RUNSIGNEDSHIFTX int PLUSASSIGN int MINUSASSIGN int STARASSIGN int SLASHASSIGN int ANDASSIGN int ANDASSIGNX int ORASSIGN int ORASSIGNX int XORASSIGN int MODASSIGN int LSHIFTASSIGN int LSHIFTASSIGNX int RSIGNEDSHIFTASSIGN int RSIGNEDSHIFTASSIGNX int RUNSIGNEDSHIFTASSIGN int RUNSIGNEDSHIFTASSIGNX int DEFAULT String tokenImage final class RETokenEnd extends REToken private String newline RETokenEnd int subIndex String newline super subIndex this newline newline boolean match CharIndexed input REMatch mymatch char ch input charAt mymatch index if ch CharIndexed OUT_OF_BOUNDS return mymatch eflags RE REG_NOTEOL false next input mymatch if newline null char do newline charAt if ch return false ch input charAt mymatch index while newline length return next input mymatch return false void dump StringBuffer os os append public class FirewallOptionPane extends AbstractOptionPane public FirewallOptionPane super public void addComponent httpEnabled new JCheckBox jEdit getProperty addComponent jEdit getProperty httpHost new JTextField jEdit getProperty addComponent jEdit getProperty httpPort new JTextField jEdit getProperty addComponent jEdit getProperty httpUser new JTextField jEdit getProperty addComponent jEdit getProperty httpPass new JPasswordField jEdit getProperty addComponent jEdit getProperty httpNonProxy new JTextField jEdit getProperty boolean enabled jEdit getBooleanProperty httpEnabled setSelected enabled httpHost setEnabled enabled httpPort setEnabled enabled httpUser setEnabled enabled httpPass setEnabled enabled httpNonProxy setEnabled enabled httpEnabled addActionListener new ActionHandler addComponent socksEnabled new JCheckBox jEdit getProperty addComponent jEdit getProperty socksHost new JTextField jEdit getProperty addComponent jEdit getProperty socksPort new JTextField jEdit getProperty enabled jEdit getBooleanProperty socksEnabled setSelected enabled socksHost setEnabled enabled socksPort setEnabled enabled socksEnabled addActionListener new ActionHandler public void jEdit setBooleanProperty httpEnabled isSelected jEdit setProperty httpHost getText jEdit setProperty httpPort getText jEdit setProperty httpUser getText jEdit setProperty new String httpPass getPassword jEdit setProperty httpNonProxy getText jEdit setBooleanProperty socksEnabled isSelected jEdit setProperty socksHost getText jEdit setProperty socksPort getText private JCheckBox httpEnabled private JTextField httpHost private JTextField httpPort private JTextField httpUser private JPasswordField httpPass private JTextField httpNonProxy private JCheckBox socksEnabled private JTextField socksHost private JTextField socksPort class ActionHandler implements ActionListener public void actionPerformed ActionEvent evt httpHost setEnabled httpEnabled isSelected httpPort setEnabled httpEnabled isSelected httpUser setEnabled httpEnabled isSelected httpPass setEnabled httpEnabled isSelected httpNonProxy setEnabled httpEnabled isSelected socksHost setEnabled socksEnabled isSelected socksPort setEnabled socksEnabled isSelected public class View extends JFrame implements EBComponent public static final int TOP_GROUP public static final int BOTTOM_GROUP public static final int DEFAULT_GROUP TOP_GROUP public static final int TOP_LAYER Integer MAX_VALUE public static final int DEFAULT_LAYER public static final int BOTTOM_LAYER Integer MIN_VALUE public static final int ABOVE_SYSTEM_BAR_LAYER public static final int SYSTEM_BAR_LAYER public static final int BELOW_SYSTEM_BAR_LAYER public static final int SEARCH_BAR_LAYER public static final int BELOW_SEARCH_BAR_LAYER public static final int ABOVE_STATUS_BAR_LAYER public static final int STATUS_BAR_LAYER public static final int BELOW_STATUS_BAR_LAYER public DockableWindowManager getDockableWindowManager return dockableWindowManager public JToolBar getToolBar return toolBar public void addToolBar Component toolBar addToolBar DEFAULT_GROUP DEFAULT_LAYER toolBar public void addToolBar int group Component toolBar addToolBar group DEFAULT_LAYER toolBar public void addToolBar int group int layer Component toolBar if toolBar instanceof SearchBar searchBar SearchBar toolBar toolBarManager addToolBar group layer toolBar getRootPane revalidate public void removeToolBar Component toolBar if toolBar searchBar searchBar null toolBarManager removeToolBar toolBar getRootPane revalidate public synchronized void showWaitCursor if waitCount Cursor cursor Cursor getPredefinedCursor Cursor WAIT_CURSOR setCursor cursor EditPane editPanes getEditPanes for int editPanes length EditPane editPane editPanes editPane getTextArea getPainter setCursor cursor public synchronized void hideWaitCursor if waitCount waitCount if waitCount Cursor cursor Cursor getPredefinedCursor Cursor DEFAULT_CURSOR setCursor cursor cursor Cursor getPredefinedCursor Cursor TEXT_CURSOR EditPane editPanes getEditPanes for int editPanes length EditPane editPane editPanes editPane getTextArea getPainter setCursor cursor public final SearchBar getSearchBar return searchBar public StatusBar getStatus return status public KeyListener getKeyEventInterceptor return keyEventInterceptor public void setKeyEventInterceptor KeyListener listener this keyEventInterceptor listener public InputHandler getInputHandler return inputHandler public void setInputHandler InputHandler inputHandler this inputHandler inputHandler public Macros Recorder getMacroRecorder return recorder public void setMacroRecorder Macros Recorder recorder this recorder recorder public void processKeyEvent KeyEvent evt if isClosed return if getFocusOwner instanceof JComponent JComponent comp JComponent getFocusOwner InputMap map comp getInputMap ActionMap am comp getActionMap if map null am null comp isEnabled Object binding map get KeyStroke getKeyStrokeForEvent evt if binding null am get binding null return if getFocusOwner instanceof JTextComponent if evt getID KeyEvent KEY_PRESSED switch evt getKeyCode case KeyEvent VK_BACK_SPACE case KeyEvent VK_TAB case KeyEvent VK_ENTER return if evt isConsumed return evt KeyEventWorkaround processKeyEvent evt if evt null return switch evt getID case KeyEvent KEY_TYPED if keyEventInterceptor null else if inputHandler isPrefixActive getTextArea hasFocus inputHandler keyTyped evt break case KeyEvent KEY_PRESSED if keyEventInterceptor null keyEventInterceptor keyPressed evt else inputHandler keyPressed evt break case KeyEvent KEY_RELEASED if keyEventInterceptor null keyEventInterceptor keyReleased evt else inputHandler keyReleased evt break if evt isConsumed super processKeyEvent evt public EditPane splitHorizontally return split JSplitPane VERTICAL_SPLIT public EditPane splitVertically return split JSplitPane HORIZONTAL_SPLIT public EditPane split int orientation editPane saveCaretInfo EditPane oldEditPane editPane setEditPane createEditPane oldEditPane getBuffer editPane loadCaretInfo JComponent oldParent JComponent oldEditPane getParent final JSplitPane newSplitPane new JSplitPane orientation newSplitPane setOneTouchExpandable true newSplitPane setBorder null newSplitPane setMinimumSize new Dimension if oldParent instanceof JSplitPane JSplitPane oldSplitPane JSplitPane oldParent int dividerPos oldSplitPane getDividerLocation Component left oldSplitPane getLeftComponent if left oldEditPane oldSplitPane setLeftComponent newSplitPane else oldSplitPane setRightComponent newSplitPane newSplitPane setLeftComponent oldEditPane newSplitPane setRightComponent editPane oldSplitPane setDividerLocation dividerPos else this splitPane newSplitPane newSplitPane setLeftComponent oldEditPane newSplitPane setRightComponent editPane oldParent add newSplitPane oldParent revalidate SwingUtilities invokeLater new Runnable public void run newSplitPane setDividerLocation editPane focusOnTextArea return editPane public void unsplit if splitPane null EditPane editPanes getEditPanes for int editPanes length EditPane editPanes if editPane close JComponent parent JComponent splitPane getParent parent remove splitPane parent add editPane parent revalidate splitPane null updateTitle SwingUtilities invokeLater new Runnable public void run editPane focusOnTextArea else getToolkit beep public void unsplitCurrent if splitPane null Component comp editPane while comp instanceof JSplitPane comp comp getParent EditPane editPanes getEditPanes for int editPanes length EditPane editPanes if GUIUtilities isAncestorOf comp editPane close JComponent parent JComponent comp getParent if parent instanceof JSplitPane JSplitPane parentSplit JSplitPane parent int pos parentSplit getDividerLocation if parentSplit getLeftComponent comp parentSplit setLeftComponent editPane else parentSplit setRightComponent editPane parentSplit setDividerLocation pos else parent remove comp parent add editPane splitPane null parent revalidate updateTitle SwingUtilities invokeLater new Runnable public void run editPane focusOnTextArea else getToolkit beep public void nextTextArea EditPane editPanes getEditPanes for int editPanes length if editPane editPanes if editPanes length editPanes focusOnTextArea else editPanes focusOnTextArea break public void prevTextArea EditPane editPanes getEditPanes for int editPanes length if editPane editPanes if editPanes editPanes length focusOnTextArea else editPanes focusOnTextArea break public JSplitPane getSplitPane return splitPane public Buffer getBuffer if editPane null return null else return editPane getBuffer public void setBuffer Buffer buffer editPane setBuffer buffer public JEditTextArea getTextArea if editPane null return null else return editPane getTextArea public EditPane getEditPane return editPane public EditPane getEditPanes if splitPane null EditPane ep editPane return ep else Vector vec new Vector getEditPanes vec splitPane EditPane ep new EditPane vec size vec copyInto ep return ep public String getSplitConfig StringBuffer splitConfig new StringBuffer splitConfig append getBuffer getPath return splitConfig toString public void updateGutterBorders EditPane editPanes getEditPanes for int editPanes length editPanes getTextArea getGutter updateBorder public boolean isSynchroScrollEnabled return synchroScroll public void toggleSynchroScrollEnabled setSynchroScrollEnabled synchroScroll public void setSynchroScrollEnabled boolean synchroScroll this synchroScroll synchroScroll JEditTextArea textArea getTextArea int firstLine textArea getFirstLine int horizontalOffset textArea getHorizontalOffset synchroScrollVertical textArea firstLine synchroScrollHorizontal textArea horizontalOffset public void synchroScrollVertical JEditTextArea textArea int firstLine if synchroScroll return EditPane editPanes getEditPanes for int editPanes length if editPanes getTextArea textArea editPanes getTextArea firstLine public void synchroScrollHorizontal JEditTextArea textArea int horizontalOffset if synchroScroll return EditPane editPanes getEditPanes for int editPanes length if editPanes getTextArea textArea editPanes getTextArea horizontalOffset public void quickIncrementalSearch boolean word if searchBar null addToolBar TOP_GROUP SEARCH_BAR_LAYER new SearchBar this true JEditTextArea textArea getTextArea String text textArea getSelectedText if text null word textArea selectWord text textArea getSelectedText else if text null text indexOf text null searchBar setHyperSearch false searchBar getField setText text searchBar getField requestFocus searchBar getField selectAll public void quickHyperSearch boolean word JEditTextArea textArea getTextArea String text textArea getSelectedText if text null word textArea selectWord text textArea getSelectedText if text null text indexOf HistoryModel getModel addItem text SearchAndReplace setSearchString text SearchAndReplace setSearchFileSet new CurrentBufferSet SearchAndReplace hyperSearch this else if searchBar null addToolBar TOP_GROUP SEARCH_BAR_LAYER new SearchBar this true searchBar setHyperSearch true searchBar getField setText null searchBar getField requestFocus searchBar getField selectAll public boolean isClosed return closed public boolean isPlainView return plainView public View getNext return next public View getPrev return prev public void handleMessage EBMessage msg if msg instanceof PropertiesChanged propertiesChanged else if msg instanceof SearchSettingsChanged if searchBar null searchBar update else if msg instanceof BufferUpdate handleBufferUpdate BufferUpdate msg else if msg instanceof EditPaneUpdate handleEditPaneUpdate EditPaneUpdate msg public Dimension getMinimumSize return new Dimension View prev View next View Buffer buffer String splitConfig boolean plainView this plainView plainView enableEvents AWTEvent KEY_EVENT_MASK setIconImage GUIUtilities getEditorIcon dockableWindowManager new DockableWindowManager this topToolBars new JPanel new VariableGridLayout VariableGridLayout FIXED_NUM_COLUMNS bottomToolBars new JPanel new VariableGridLayout VariableGridLayout FIXED_NUM_COLUMNS toolBarManager new ToolBarManager topToolBars bottomToolBars status new StatusBar this setJMenuBar GUIUtilities loadMenuBar inputHandler new DefaultInputHandler this DefaultInputHandler jEdit getInputHandler Component comp restoreSplitConfig buffer splitConfig dockableWindowManager add comp EditBus addToBus this getContentPane add BorderLayout CENTER dockableWindowManager propertiesChanged setDefaultCloseOperation DO_NOTHING_ON_CLOSE addWindowListener new WindowHandler dockableWindowManager init void close closed true dockableWindowManager close GUIUtilities saveGeometry this plainView EditBus removeFromBus this dispose EditPane editPanes getEditPanes for int editPanes length editPanes close toolBarManager null toolBar null searchBar null splitPane null inputHandler null recorder null getContentPane removeAll void updateTitle Vector buffers new Vector EditPane editPanes getEditPanes for int editPanes length Buffer buffer editPanes getBuffer if buffers indexOf buffer buffers addElement buffer StringBuffer title new StringBuffer jEdit getProperty for int buffers size if title append Buffer buffer Buffer buffers elementAt title append showFullPath buffer isNewFile buffer getPath buffer getName setTitle title toString private boolean closed private DockableWindowManager dockableWindowManager private JPanel topToolBars private JPanel bottomToolBars private ToolBarManager toolBarManager private JToolBar toolBar private SearchBar searchBar private boolean synchroScroll private EditPane editPane private JSplitPane splitPane private StatusBar status private KeyListener keyEventInterceptor private InputHandler inputHandler private Macros Recorder recorder private int waitCount private boolean showFullPath private boolean plainView private void getEditPanes Vector vec Component comp if comp instanceof EditPane vec addElement comp else if comp instanceof JSplitPane JSplitPane split JSplitPane comp getEditPanes vec split getLeftComponent getEditPanes vec split getRightComponent private void getSplitConfig JSplitPane splitPane StringBuffer splitConfig Component left splitPane getLeftComponent if left instanceof JSplitPane getSplitConfig JSplitPane left splitConfig else splitConfig append splitConfig append EditPane left getBuffer getPath Component right splitPane getRightComponent if right instanceof JSplitPane getSplitConfig JSplitPane right splitConfig else splitConfig append splitConfig append EditPane right getBuffer getPath splitConfig append splitPane getOrientation JSplitPane VERTICAL_SPLIT private Component restoreSplitConfig Buffer buffer String splitConfig if buffer null return editPane createEditPane buffer else if splitConfig null return editPane createEditPane jEdit getFirstBuffer Stack stack new Stack StringTokenizer st new StringTokenizer splitConfig while st hasMoreTokens String token st nextToken if token equals stack push splitPane new JSplitPane JSplitPane VERTICAL_SPLIT Component stack pop Component stack pop splitPane setBorder null splitPane setDividerLocation else if token equals stack push splitPane new JSplitPane JSplitPane HORIZONTAL_SPLIT Component stack pop Component stack pop splitPane setBorder null splitPane setDividerLocation else buffer jEdit getBuffer token if buffer null buffer jEdit getFirstBuffer stack push editPane createEditPane buffer return Component stack peek private void propertiesChanged loadToolBars showFullPath jEdit getBooleanProperty updateTitle dockableWindowManager propertiesChanged status propertiesChanged removeToolBar status getContentPane remove status if jEdit getBooleanProperty getContentPane add BorderLayout NORTH topToolBars getContentPane add BorderLayout SOUTH bottomToolBars if plainView jEdit getBooleanProperty addToolBar BOTTOM_GROUP STATUS_BAR_LAYER status else dockableWindowManager add DockableWindowManager DockableLayout TOP_TOOLBARS topToolBars dockableWindowManager add DockableWindowManager DockableLayout BOTTOM_TOOLBARS bottomToolBars if plainView jEdit getBooleanProperty getContentPane add BorderLayout SOUTH status getRootPane revalidate private void loadToolBars if jEdit getBooleanProperty plainView if toolBar null toolBarManager removeToolBar toolBar toolBar GUIUtilities loadToolBar addToolBar TOP_GROUP SYSTEM_BAR_LAYER toolBar else if toolBar null removeToolBar toolBar toolBar null if jEdit getBooleanProperty plainView if searchBar null removeToolBar searchBar addToolBar TOP_GROUP SEARCH_BAR_LAYER new SearchBar this false else if searchBar null removeToolBar searchBar searchBar null private EditPane createEditPane Buffer buffer EditPane editPane new EditPane this buffer JEditTextArea textArea editPane getTextArea textArea addFocusListener new FocusHandler textArea addCaretListener new CaretHandler textArea addScrollListener new ScrollHandler EditBus send new EditPaneUpdate editPane EditPaneUpdate CREATED return editPane private void setEditPane EditPane editPane this editPane editPane status updateCaretStatus status updateBufferStatus status updateMiscStatus EditBus send new ViewUpdate this ViewUpdate EDIT_PANE_CHANGED private void handleBufferUpdate BufferUpdate msg Buffer buffer msg getBuffer if msg getWhat BufferUpdate DIRTY_CHANGED if buffer isDirty EditPane editPanes getEditPanes for int editPanes length if editPanes getBuffer buffer updateTitle break private void handleEditPaneUpdate EditPaneUpdate msg EditPane editPane msg getEditPane if editPane getView this msg getWhat EditPaneUpdate BUFFER_CHANGED editPane getBuffer isLoaded status updateCaretStatus status updateBufferStatus status updateMiscStatus class CaretHandler implements CaretListener public void caretUpdate CaretEvent evt if evt getSource getTextArea status updateCaretStatus class FocusHandler extends FocusAdapter public void focusGained FocusEvent evt Component comp Component evt getSource while comp instanceof EditPane if comp null return comp comp getParent if comp editPane setEditPane EditPane comp class ScrollHandler implements ScrollListener public void scrolledVertically JEditTextArea textArea if getTextArea textArea status updateCaretStatus public void scrolledHorizontally JEditTextArea textArea class WindowHandler extends WindowAdapter public void windowActivated WindowEvent evt jEdit setActiveView View this final Vector buffers new Vector EditPane editPanes getEditPanes for int editPanes length Buffer buffer EditPane editPanes getBuffer if buffers contains buffer continue else buffers addElement buffer SwingUtilities invokeLater new Runnable public void run for int buffers size Buffer buffers elementAt checkModTime editPane public void windowClosing WindowEvent evt jEdit closeView View this public abstract class VFS public static final int READ_CAP public static final int WRITE_CAP public static final int BROWSE_CAP public static final int DELETE_CAP public static final int RENAME_CAP public static final int MKDIR_CAP public static final int LOW_LATENCY_CAP public VFS String name this name name public VFS String name int caps this name name this caps caps public String getName return name public int getCapabilities return caps public String showBrowseDialog Object session Component comp return null public String getFileName String path if path equals return path int count Math max path length int index Math max path lastIndexOf count path lastIndexOf File separatorChar count if index index path indexOf if index index path length return path return path substring index public String getParentOfPath String path int count Math max path length int index path lastIndexOf File separatorChar count if index index path lastIndexOf count if index index path lastIndexOf return path substring index public String constructPath String parent String path return parent path public char getFileSeparator return public String getTwoStageSaveName String path return MiscUtilities constructPath getParentOfPath path getFileName path public Object createVFSSession String path Component comp return new Object public boolean load View view Buffer buffer String path if getCapabilities READ_CAP VFSManager error view path new String name return false Object session createVFSSession path view if session null return false if getCapabilities WRITE_CAP buffer setReadOnly true BufferIORequest request new BufferIORequest BufferIORequest LOAD view buffer session this path if buffer isTemporary request run else VFSManager runInWorkThread request return true public boolean save View view Buffer buffer String path if getCapabilities WRITE_CAP VFSManager error view path new String name return false Object session createVFSSession path view if session null return false if path equals buffer getPath buffer unsetProperty Buffer BACKED_UP VFSManager runInWorkThread new BufferIORequest BufferIORequest SAVE view buffer session this path return true public boolean insert View view Buffer buffer String path if getCapabilities READ_CAP VFSManager error view path new String name return false Object session createVFSSession path view if session null return false VFSManager runInWorkThread new BufferIORequest BufferIORequest INSERT view buffer session this path return true public String Object session String path Component comp throws IOException return path public String Object session String directory String glob boolean recursive Component comp throws IOException Log log Log DEBUG this directory ArrayList files new ArrayList RE filter try filter new RE MiscUtilities globToRE glob RE REG_ICASE catch REException Log log Log ERROR this return null session new ArrayList files directory filter recursive comp String retVal String files toArray new String files size Arrays sort retVal new MiscUtilities StringICaseCompare return retVal public DirectoryEntry Object session String directory Component comp throws IOException VFSManager error comp directory new String name return null public DirectoryEntry Object session String path Component comp throws IOException return null public static class DirectoryEntry implements Serializable public static final int FILE public static final int DIRECTORY public static final int FILESYSTEM public String name public String path public String deletePath public int type public long length public boolean hidden public DirectoryEntry String name String path String deletePath int type long length boolean hidden this name name this path path this deletePath deletePath this type type this length length this hidden hidden protected boolean colorCalculated protected Color color public Color getColor if colorCalculated colorCalculated true color getDefaultColorFor name return color public String toString return name public boolean Object session String path Component comp throws IOException return false public boolean Object session String from String to Component comp throws IOException return false public boolean Object session String directory Component comp throws IOException return false public void Object session String path Component comp throws IOException public InputStream Object session String path boolean ignoreErrors Component comp throws IOException VFSManager error comp path new String name return null public OutputStream Object session String path Component comp throws IOException VFSManager error comp path new String name return null public void Object session Buffer buffer String path public void Object session Component comp throws IOException public static Color getDefaultColorFor String name synchronized lock if colors null loadColors for int colors size ColorEntry entry ColorEntry colors elementAt if entry re isMatch name return entry color return null private String name private int caps private static Vector colors private static Object lock new Object static EditBus addToBus new EBComponent public void handleMessage EBMessage msg if msg instanceof PropertiesChanged synchronized lock colors null private void Object session ArrayList stack ArrayList files String directory RE glob boolean recursive Component comp throws IOException if stack contains directory Log log Log ERROR this directory return else stack add directory VFS DirectoryEntry session directory comp if null length return for int length VFS DirectoryEntry file if file type VFS DirectoryEntry DIRECTORY file type VFS DirectoryEntry FILESYSTEM if recursive String canonPath session file path comp session stack files canonPath glob recursive comp else if glob isMatch file name continue Log log Log DEBUG this file path files add file path private static void loadColors synchronized lock colors new Vector if jEdit getBooleanProperty return String glob int while glob jEdit getProperty null try colors addElement new ColorEntry new RE MiscUtilities globToRE glob jEdit getColorProperty Color black catch REException Log log Log ERROR VFS class glob Log log Log ERROR VFS class static class ColorEntry RE re Color color ColorEntry RE re Color color this re re this color color public class JEditMetalTheme extends DefaultMetalTheme public String getName return public ColorUIResource getSystemTextColor return getBlack public FontUIResource getControlTextFont return primaryFont public FontUIResource getSystemTextFont return secondaryFont public FontUIResource getUserTextFont return secondaryFont public FontUIResource getMenuTextFont return primaryFont public void propertiesChanged primaryFont new FontUIResource jEdit getFontProperty super getControlTextFont secondaryFont new FontUIResource jEdit getFontProperty super getSystemTextFont private FontUIResource primaryFont private FontUIResource secondaryFont public abstract class BufferChangeAdapter implements BufferChangeListener public void foldLevelChanged Buffer buffer int start int end public void contentInserted Buffer buffer int startLine int offset int numLines int length public void contentRemoved Buffer buffer int startLine int offset int numLines int length public void transactionComplete Buffer buffer final class RETokenEndSub extends REToken RETokenEndSub int subIndex super subIndex boolean match CharIndexed input REMatch mymatch mymatch end subIndex mymatch index return next input mymatch void dump StringBuffer os final class RETokenRange extends REToken private char lo hi private boolean insens RETokenRange int subIndex char lo char hi boolean ins super subIndex this lo insens ins Character toLowerCase lo lo this hi ins Character toLowerCase hi hi int getMinimumLength return boolean match CharIndexed input REMatch mymatch char input charAt mymatch index if CharIndexed OUT_OF_BOUNDS return false if insens Character toLowerCase if lo hi mymatch index return next input mymatch return false void dump StringBuffer os os append lo append append hi public class BufferOptions extends EnhancedDialog public BufferOptions View view Buffer buffer super view jEdit getProperty true this view view this buffer buffer JPanel content new JPanel new BorderLayout content setBorder new EmptyBorder setContentPane content ActionHandler actionListener new ActionHandler AbstractOptionPane panel new AbstractOptionPane null panel addComponent GUIUtilities createMultilineLabel jEdit getProperty panel addSeparator String lineSeps jEdit getProperty jEdit getProperty jEdit getProperty lineSeparator new JComboBox lineSeps String lineSep buffer getStringProperty Buffer LINESEP if lineSep null lineSep System getProperty if equals lineSep lineSeparator setSelectedIndex else if equals lineSep lineSeparator setSelectedIndex else if equals lineSep lineSeparator setSelectedIndex panel addComponent jEdit getProperty lineSeparator DefaultComboBoxModel encodings new DefaultComboBoxModel StringTokenizer st new StringTokenizer jEdit getProperty while st hasMoreTokens encodings addElement st nextToken encoding new JComboBox encodings encoding setEditable true encoding setSelectedItem buffer getStringProperty Buffer ENCODING panel addComponent jEdit getProperty encoding gzipped new JCheckBox jEdit getProperty gzipped setSelected buffer getBooleanProperty Buffer GZIPPED panel addComponent gzipped panel addSeparator modes jEdit getModes String bufferMode buffer getMode getName int index String modeNames new String modes length for int modes length Mode mode modes modeNames mode getName if bufferMode equals mode getName index mode new JComboBox modeNames mode setSelectedIndex index mode addActionListener actionListener panel addComponent jEdit getProperty mode String foldModes FoldHandler getFoldModes folding new JComboBox foldModes folding setSelectedItem buffer getStringProperty panel addComponent jEdit getProperty folding String wrapModes wrap new JComboBox wrapModes wrap setSelectedItem buffer getStringProperty panel addComponent jEdit getProperty wrap String lineLengths maxLineLen new JComboBox lineLengths maxLineLen setEditable true maxLineLen setSelectedItem buffer getStringProperty panel addComponent jEdit getProperty maxLineLen String tabSizes tabSize new JComboBox tabSizes tabSize setEditable true tabSize setSelectedItem buffer getStringProperty panel addComponent jEdit getProperty tabSize indentSize new JComboBox tabSizes indentSize setEditable true indentSize setSelectedItem buffer getStringProperty panel addComponent jEdit getProperty indentSize noTabs new JCheckBox jEdit getProperty noTabs setSelected buffer getBooleanProperty panel addComponent noTabs content add BorderLayout NORTH panel JPanel buttons new JPanel buttons setLayout new BoxLayout buttons BoxLayout X_AXIS buttons setBorder new EmptyBorder buttons add Box createGlue ok new JButton jEdit getProperty ok addActionListener actionListener getRootPane setDefaultButton ok buttons add ok buttons add Box createHorizontalStrut cancel new JButton jEdit getProperty cancel addActionListener actionListener buttons add cancel buttons add Box createGlue content add BorderLayout SOUTH buttons pack setLocationRelativeTo view show public void ok int index lineSeparator getSelectedIndex String lineSep if index lineSep else if index lineSep else if index lineSep else throw new InternalError String oldLineSep buffer getStringProperty Buffer LINESEP if oldLineSep null oldLineSep System getProperty if oldLineSep equals lineSep buffer setStringProperty lineSep buffer setDirty true String encoding String this encoding getSelectedItem String oldEncoding buffer getStringProperty Buffer ENCODING if oldEncoding equals encoding buffer setStringProperty Buffer ENCODING encoding buffer setDirty true boolean gzippedValue gzipped isSelected boolean oldGzipped buffer getBooleanProperty Buffer GZIPPED if gzippedValue oldGzipped buffer setBooleanProperty Buffer GZIPPED gzippedValue buffer setDirty true buffer setStringProperty String folding getSelectedItem buffer setStringProperty String wrap getSelectedItem try buffer setProperty new Integer maxLineLen getSelectedItem toString catch NumberFormatException nf try buffer setProperty new Integer tabSize getSelectedItem toString catch NumberFormatException nf try buffer setProperty new Integer indentSize getSelectedItem toString catch NumberFormatException nf buffer setBooleanProperty noTabs isSelected index mode getSelectedIndex buffer setMode modes index dispose public void cancel dispose private View view private Buffer buffer private Mode modes private JComboBox mode private JComboBox lineSeparator private JComboBox encoding private JCheckBox gzipped private JComboBox folding private JComboBox wrap private JComboBox maxLineLen private JComboBox tabSize private JComboBox indentSize private JCheckBox noTabs private JButton ok private JButton cancel class ActionHandler implements ActionListener public void actionPerformed ActionEvent evt Object source evt getSource if source ok ok else if source cancel cancel else if source mode Mode jEdit getMode String mode getSelectedItem folding setSelectedItem getProperty wrap setSelectedItem getProperty maxLineLen setSelectedItem getProperty tabSize setSelectedItem getProperty indentSize setSelectedItem getProperty noTabs setSelected getBooleanProperty public class BrowserOptionPane extends AbstractOptionPane public BrowserOptionPane super public void String dirs jEdit getProperty jEdit getProperty jEdit getProperty jEdit getProperty defaultDirectory new JComboBox dirs String defaultDir jEdit getProperty if equals defaultDir defaultDirectory setSelectedIndex else if equals defaultDir defaultDirectory setSelectedIndex else if equals defaultDir defaultDirectory setSelectedIndex else if equals defaultDir defaultDirectory setSelectedIndex addComponent jEdit getProperty defaultDirectory showToolbar new JCheckBox jEdit getProperty showToolbar setSelected jEdit getBooleanProperty addComponent showToolbar showIcons new JCheckBox jEdit getProperty showIcons setSelected jEdit getBooleanProperty addComponent showIcons showHiddenFiles new JCheckBox jEdit getProperty showHiddenFiles setSelected jEdit getBooleanProperty addComponent showHiddenFiles sortIgnoreCase new JCheckBox jEdit getProperty sortIgnoreCase setSelected jEdit getBooleanProperty addComponent sortIgnoreCase sortMixFilesAndDirs new JCheckBox jEdit getProperty sortMixFilesAndDirs setSelected jEdit getBooleanProperty addComponent sortMixFilesAndDirs doubleClickClose new JCheckBox jEdit getProperty doubleClickClose setSelected jEdit getBooleanProperty addComponent doubleClickClose splitHorizontally new JCheckBox jEdit getProperty splitHorizontally setSelected jEdit getBooleanProperty addComponent splitHorizontally public void String dirs jEdit setProperty dirs defaultDirectory getSelectedIndex jEdit setBooleanProperty showToolbar isSelected jEdit setBooleanProperty showIcons isSelected jEdit setBooleanProperty showHiddenFiles isSelected jEdit setBooleanProperty sortIgnoreCase isSelected jEdit setBooleanProperty sortMixFilesAndDirs isSelected jEdit setBooleanProperty doubleClickClose isSelected jEdit setBooleanProperty splitHorizontally isSelected private JComboBox defaultDirectory private JCheckBox showToolbar private JCheckBox showIcons private JCheckBox showHiddenFiles private JCheckBox sortIgnoreCase private JCheckBox sortMixFilesAndDirs private JCheckBox doubleClickClose private JCheckBox splitHorizontally public class InterpreterError extends RuntimeException public InterpreterError String super public class Registers public static void copy JEditTextArea textArea char register String selection textArea getSelectedText if selection null return setRegister register selection HistoryModel getModel addItem selection public static void cut JEditTextArea textArea char register if textArea isEditable String selection textArea getSelectedText if selection null return setRegister register selection HistoryModel getModel addItem selection textArea setSelectedText else textArea getToolkit beep public static void append JEditTextArea textArea char register append textArea register false public static void append JEditTextArea textArea char register String separator append textArea register separator false public static void append JEditTextArea textArea char register String separator boolean cut if cut textArea isEditable textArea getToolkit beep return String selection textArea getSelectedText if selection null return Register reg getRegister register if reg null String registerContents reg toString if registerContents null if registerContents endsWith separator selection registerContents selection else selection registerContents separator selection setRegister register selection HistoryModel getModel addItem selection if cut textArea setSelectedText public static void paste JEditTextArea textArea char register paste textArea register false public static void paste JEditTextArea textArea char register boolean vertical if textArea isEditable textArea getToolkit beep return Register reg getRegister register if reg null textArea getToolkit beep return else String selection reg toString if selection null textArea getToolkit beep return if vertical textArea getSelectionCount int caret textArea getCaretPosition int caretLine textArea getCaretLine Selection Rect rect new Selection Rect caretLine caret caretLine caret textArea setSelectedText rect selection else textArea setSelectedText selection HistoryModel getModel addItem selection public static Register getRegister char name if registers null name registers length return null else return registers name public static void setRegister char name Register newRegister if name registers length Register newRegisters new Register Math min name System arraycopy registers newRegisters registers length registers newRegisters registers name newRegister public static void setRegister char name String value if name registers length Register newRegisters new Register Math min name System arraycopy registers newRegisters registers length registers newRegisters registers name new StringRegister value else Register register registers name if register null register setValue value else registers name new StringRegister value public static void clearRegister char name if name registers length return Register register registers name if name name register setValue else registers name null public static Register getRegisters return registers public interface Register String toString void setValue String value public static class ClipboardRegister implements Register Clipboard clipboard public ClipboardRegister Clipboard clipboard this clipboard clipboard public void setValue String value StringSelection selection new StringSelection value clipboard setContents selection null public String toString try String selection String clipboard getContents this getTransferData DataFlavor stringFlavor boolean trailingEOL selection endsWith selection endsWith System getProperty BufferedReader in new BufferedReader new StringReader selection StringBuffer buf new StringBuffer String line while line in readLine null buf append line buf append if trailingEOL buf setLength buf length return buf toString catch Exception Log log Log NOTICE this return null public static class StringRegister implements Register private String value public StringRegister String value this value value public void setValue String value this value value public String toString return value public void dispose private static Register registers private Registers static registers new Register registers new ClipboardRegister Toolkit getDefaultToolkit getSystemClipboard class BSHTernaryExpression extends SimpleNode BSHTernaryExpression int id super id public Object eval CallStack callstack Interpreter interpreter throws EvalError SimpleNode cond SimpleNode jjtGetChild evalTrue SimpleNode jjtGetChild evalFalse SimpleNode jjtGetChild if BSHIfStatement evaluateCondition cond callstack interpreter return evalTrue eval callstack interpreter else return evalFalse eval callstack interpreter public class DirectoryListSet extends BufferListSet public DirectoryListSet String directory String glob boolean recurse this directory directory this glob glob this recurse recurse public String getDirectory return directory public String getFileFilter return glob public boolean isRecursive return recurse public String getCode return MiscUtilities charsToEscapes directory MiscUtilities charsToEscapes glob recurse protected String final Component comp final VFS vfs VFSManager getVFSForPath directory Object session if SwingUtilities isEventDispatchThread session vfs createVFSSession directory comp else final Object returnValue new Object try SwingUtilities invokeAndWait new Runnable public void run returnValue vfs createVFSSession directory comp catch Exception Log log Log ERROR this session returnValue if session null return null try return vfs session directory glob recurse comp catch IOException io VFSManager error comp directory new String io toString return null private String directory private String glob private boolean recurse public class StatusBar extends JPanel implements WorkThreadProgressListener public StatusBar View view super new BorderLayout setBorder new CompoundBorder new EmptyBorder OperatingSystem isMacOS UIManager getBorder this view view panel new JPanel new BorderLayout box new Box BoxLayout X_AXIS panel add BorderLayout EAST box add BorderLayout CENTER panel MouseHandler mouseHandler new MouseHandler caretStatus new ToolTipLabel caretStatus setToolTipText jEdit getProperty caretStatus addMouseListener mouseHandler message new JLabel setMessageComponent message mode new ToolTipLabel mode setToolTipText jEdit getProperty mode addMouseListener mouseHandler wrap new ToolTipLabel wrap setHorizontalAlignment SwingConstants CENTER wrap setToolTipText jEdit getProperty wrap addMouseListener mouseHandler multiSelect new ToolTipLabel multiSelect setHorizontalAlignment SwingConstants CENTER multiSelect setToolTipText jEdit getProperty multiSelect addMouseListener mouseHandler overwrite new ToolTipLabel overwrite setHorizontalAlignment SwingConstants CENTER overwrite setToolTipText jEdit getProperty overwrite addMouseListener mouseHandler lineSep new ToolTipLabel lineSep setHorizontalAlignment SwingConstants CENTER lineSep setToolTipText jEdit getProperty lineSep addMouseListener mouseHandler memory new MemoryStatus memory addMouseListener mouseHandler public void propertiesChanged showCaretStatus jEdit getBooleanProperty showEditMode jEdit getBooleanProperty showFoldMode jEdit getBooleanProperty showEncoding jEdit getBooleanProperty showWrap jEdit getBooleanProperty showMultiSelect jEdit getBooleanProperty showOverwrite jEdit getBooleanProperty showLineSeperator jEdit getBooleanProperty showMemory jEdit getBooleanProperty TextAreaPainter painter view getTextArea getPainter panel setBackground painter getBackground panel setForeground painter getForeground caretStatus setBackground painter getBackground caretStatus setForeground painter getForeground message setBackground painter getBackground message setForeground painter getForeground mode setBackground painter getBackground mode setForeground painter getForeground wrap setBackground painter getBackground wrap setForeground painter getForeground multiSelect setBackground painter getBackground multiSelect setForeground painter getForeground overwrite setBackground painter getBackground overwrite setForeground painter getForeground lineSep setBackground painter getBackground lineSep setForeground painter getForeground memory setBackground painter getBackground memory setForeground painter getForeground Font font UIManager getFont FontMetrics fm getFontMetrics font Dimension dim null if showCaretStatus panel add BorderLayout WEST caretStatus caretStatus setFont font dim new Dimension fm stringWidth caretTestStr fm getHeight caretStatus setPreferredSize dim else panel remove caretStatus box removeAll if showEncoding showEditMode showFoldMode box add mode if showWrap dim new Dimension Math max Math max fm charWidth fm charWidth fm charWidth fm getHeight wrap setPreferredSize dim wrap setMaximumSize dim box add wrap if showMultiSelect dim new Dimension Math max fm charWidth fm charWidth fm getHeight multiSelect setPreferredSize dim multiSelect setMaximumSize dim box add multiSelect if showOverwrite dim new Dimension Math max fm charWidth fm charWidth fm getHeight overwrite setPreferredSize dim overwrite setMaximumSize dim box add overwrite if showLineSeperator dim new Dimension Math max Math max fm charWidth fm charWidth fm charWidth fm getHeight lineSep setPreferredSize dim lineSep setMaximumSize dim box add lineSep if showMemory box add memory memory setFont font FontRenderContext frc new FontRenderContext null false false Rectangle2D bounds font getStringBounds memoryTestStr frc dim new Dimension int bounds getWidth int bounds getHeight memory setPreferredSize dim memory setMaximumSize dim memory lm font getLineMetrics memoryTestStr frc memory progressForeground jEdit getColorProperty memory progressBackground jEdit getColorProperty updateBufferStatus updateMiscStatus public void addNotify super addNotify VFSManager getIOThreadPool addProgressListener this public void removeNotify super removeNotify VFSManager getIOThreadPool removeProgressListener this public void statusUpdate final WorkThreadPool threadPool int threadIndex SwingUtilities invokeLater new Runnable public void run if message null equals message getText trim currentMessageIsIO return int requestCount threadPool getRequestCount if requestCount setMessageAndClear jEdit getProperty currentMessageIsIO true else if requestCount setMessage jEdit getProperty currentMessageIsIO true else Object args new Integer requestCount setMessage jEdit getProperty args currentMessageIsIO true public void progressUpdate WorkThreadPool threadPool int threadIndex public void setMessageAndClear String message setMessage message tempTimer new Timer new ActionListener public void actionPerformed ActionEvent evt if isShowing setMessage null tempTimer setInitialDelay tempTimer setRepeats false tempTimer start public void setMessage String message if tempTimer null tempTimer stop tempTimer null setMessageComponent this message if message null InputHandler inputHandler view getInputHandler if inputHandler isRepeatEnabled int repeatCount inputHandler getRepeatCount this message setText jEdit getProperty new Object repeatCount String valueOf repeatCount else if view getMacroRecorder null this message setText jEdit getProperty else this message setText else this message setText message public void setMessageComponent Component comp currentMessageIsIO false if comp null messageComp comp return messageComp comp panel add BorderLayout CENTER messageComp public void updateCaretStatus if showCaretStatus Buffer buffer view getBuffer if buffer isLoaded buffer view getTextArea getBuffer caretStatus setText return JEditTextArea textArea view getTextArea int currLine textArea getCaretLine if currLine buffer getLineCount int start textArea getLineStartOffset currLine int dot textArea getCaretPosition start buffer getText start dot seg int virtualPosition MiscUtilities getVirtualWidth seg buffer getTabSize buf setLength buf append Integer toString currLine buf append buf append Integer toString dot if virtualPosition dot buf append buf append Integer toString virtualPosition buf append int firstLine textArea getFirstLine int visible textArea getVisibleLines int lineCount textArea getVirtualLineCount if visible lineCount buf append else if firstLine buf append else if firstLine visible lineCount buf append else float percent float firstLine float lineCount buf append Integer toString int percent buf append caretStatus setText buf toString public void updateBufferStatus Buffer buffer view getBuffer if showWrap String wrap buffer getStringProperty if wrap equals this wrap setText else if wrap equals this wrap setText else if wrap equals this wrap setText if showLineSeperator String lineSep buffer getStringProperty if equals lineSep this lineSep setText else if equals lineSep this lineSep setText else if equals lineSep this lineSep setText if showEditMode showFoldMode showEncoding buf setLength if showEditMode buf append buffer getMode getName if showFoldMode if showEditMode buf append buf append String view getBuffer getProperty if showEncoding if showEditMode showFoldMode buf append buf append buffer getStringProperty mode setText buf toString public void updateMiscStatus JEditTextArea textArea view getTextArea if showMultiSelect multiSelect setText textArea isMultipleSelectionEnabled if showOverwrite overwrite setText textArea isOverwriteEnabled private View view private JPanel panel private Box box private ToolTipLabel caretStatus private Component messageComp private JLabel message private JLabel mode private JLabel wrap private JLabel multiSelect private JLabel overwrite private JLabel lineSep private MemoryStatus memory private Timer tempTimer private boolean currentMessageIsIO private Segment seg new Segment private boolean showCaretStatus jEdit getBooleanProperty private boolean showEditMode jEdit getBooleanProperty private boolean showFoldMode jEdit getBooleanProperty private boolean showEncoding jEdit getBooleanProperty private boolean showWrap jEdit getBooleanProperty private boolean showMultiSelect jEdit getBooleanProperty private boolean showOverwrite jEdit getBooleanProperty private boolean showLineSeperator jEdit getBooleanProperty private boolean showMemory jEdit getBooleanProperty static final String caretTestStr static final String memoryTestStr class MouseHandler extends MouseAdapter public void mouseClicked MouseEvent evt Buffer buffer view getBuffer Object source evt getSource if source caretStatus if evt getClickCount view getTextArea showGoToLineDialog else if source mode if evt getClickCount new BufferOptions view view getBuffer else if source wrap buffer toggleWordWrap view else if source multiSelect view getTextArea toggleMultipleSelectionEnabled else if source overwrite view getTextArea toggleOverwriteEnabled else if source lineSep buffer toggleLineSeparator view else if source memory if evt getClickCount jEdit showMemoryDialog view memory repaint class ToolTipLabel extends JLabel public Point getToolTipLocation MouseEvent event return new Point event getX class MemoryStatus extends JComponent implements ActionListener public MemoryStatus MemoryStatus this setDoubleBuffered true MemoryStatus this setForeground UIManager getColor MemoryStatus this setBackground UIManager getColor MemoryStatus this setFont UIManager getFont public void addNotify super addNotify timer new Timer this timer start ToolTipManager sharedInstance registerComponent this public void removeNotify timer stop ToolTipManager sharedInstance unregisterComponent this super removeNotify public String getToolTipText Runtime runtime Runtime getRuntime int freeMemory int runtime freeMemory int totalMemory int runtime totalMemory int usedMemory totalMemory freeMemory Integer args new Integer usedMemory new Integer totalMemory return jEdit getProperty args public Point getToolTipLocation MouseEvent event return new Point event getX public void actionPerformed ActionEvent evt MemoryStatus this repaint public void paintComponent Graphics Runtime runtime Runtime getRuntime int freeMemory int runtime freeMemory int totalMemory int runtime totalMemory int usedMemory totalMemory freeMemory int width MemoryStatus this getWidth insets left insets right int height MemoryStatus this getHeight insets top insets bottom float fraction float usedMemory totalMemory setColor progressBackground fillRect insets left insets top int width fraction height String str usedMemory totalMemory FontRenderContext frc new FontRenderContext null false false Rectangle2D bounds getFont getStringBounds str frc Graphics g2 create g2 setClip insets left insets top int width fraction height g2 setColor progressForeground g2 drawString str insets left int width bounds getWidth int insets top lm getAscent g2 dispose g2 create g2 setClip insets left int width fraction insets top MemoryStatus this getWidth insets left int width fraction height g2 setColor MemoryStatus this getForeground g2 drawString str insets left int width bounds getWidth int insets top lm getAscent g2 dispose private Timer timer class XThis extends This Hashtable interfaces InvocationHandler invocationHandler new Handler XThis NameSpace namespace Interpreter declaringInterp super namespace declaringInterp public String toString return namespace name String toStringShowInts Class ints StringBuffer sb new StringBuffer toString for int ints length sb append ints getName ints length return sb toString public Object getInterface Class clas if interfaces null interfaces new Hashtable Object interf interfaces get clas if interf null interf Proxy newProxyInstance clas getClassLoader new Class clas invocationHandler interfaces put clas interf return interf class Handler implements InvocationHandler java io Serializable public Object invoke Object proxy Method method Object args throws EvalError try return invokeImpl proxy method args catch EvalError ee if Interpreter DEBUG Interpreter debug XThis this toString ee throw ee public Object invokeImpl Object proxy Method method Object args throws EvalError CallStack callstack newCallStack Class sig Reflect getTypes args BshMethod bmethod namespace getMethod method getName sig if bmethod null return Primitive unwrap bmethod invokeDeclaredMethod args declaringInterpreter callstack null bmethod namespace getMethod new Class null null if bmethod null return Primitive unwrap bmethod invokeDeclaredMethod new Object method getName args declaringInterpreter callstack null if method getName equals return toStringShowInts proxy getClass getInterfaces if method getName equals return new Integer this hashCode if method getName equals Object obj args return new Boolean proxy obj throw new EvalError method getName namespace name public class Mode public Mode String name this name name props new Hashtable public void init try String filenameGlob String getProperty if filenameGlob null filenameGlob length filenameRE new RE MiscUtilities globToRE filenameGlob RE REG_ICASE String firstlineGlob String getProperty if firstlineGlob null firstlineGlob length firstlineRE new RE MiscUtilities globToRE firstlineGlob RE REG_ICASE catch REException re Log log Log ERROR this name Log log Log ERROR this re marker null public TokenMarker getTokenMarker loadIfNecessary return marker public void setTokenMarker TokenMarker marker this marker marker public void loadIfNecessary if marker null jEdit loadMode this public Object getProperty String key String prefix name String property jEdit getProperty prefix key if property null Object value try value new Integer property catch NumberFormatException nf value property return value Object value props get key if value null return value String global jEdit getProperty key if global null try return new Integer global catch NumberFormatException nf return global else return null public boolean getBooleanProperty String key Object value getProperty key if equals value equals value equals value return true else return false public void setProperty String key Object value props put key value public void unsetProperty String key props remove key public void setProperties Hashtable props String filenameGlob String this props get String firstlineGlob String this props get String filename String this props get this props props if filenameGlob null props put filenameGlob if firstlineGlob null props put firstlineGlob if filename null props put filename public boolean accept String fileName String firstLine if filenameRE null filenameRE isMatch fileName return true if firstlineRE null firstlineRE isMatch firstLine return true return false public String getName return name public String toString return name private String name private Hashtable props private RE firstlineRE private RE filenameRE private TokenMarker marker class BSHLiteral extends SimpleNode public Object value BSHLiteral int id super id public Object eval CallStack callstack Interpreter interpreter throws EvalError if value null throw new InterpreterError value return value private char getEscapeChar char ch switch ch case ch break case ch break case ch break case ch break case ch break case case case break return ch public void charSetup String str char ch str charAt if ch ch str charAt if Character isDigit ch ch char Integer parseInt str substring else ch getEscapeChar ch value new Primitive new Character ch void stringSetup String str StringBuffer buffer new StringBuffer for int str length char ch str charAt if ch ch str charAt if Character isDigit ch int endPos while endPos if Character isDigit str charAt endPos endPos else break ch char Integer parseInt str substring endPos endPos else ch getEscapeChar ch buffer append ch value buffer toString public class FileCellRenderer extends DefaultTreeCellRenderer public static Icon fileIcon GUIUtilities loadIcon public static Icon openFileIcon GUIUtilities loadIcon public static Icon dirIcon GUIUtilities loadIcon public static Icon openDirIcon GUIUtilities loadIcon public static Icon filesystemIcon GUIUtilities loadIcon public static Icon loadingIcon GUIUtilities loadIcon public FileCellRenderer plainFont UIManager getFont boldFont plainFont deriveFont Font BOLD setBorder new EmptyBorder public Component getTreeCellRendererComponent JTree tree Object value boolean sel boolean expanded boolean leaf int row boolean focus super getTreeCellRendererComponent tree value sel expanded leaf row focus DefaultMutableTreeNode treeNode DefaultMutableTreeNode value Object userObject treeNode getUserObject if userObject instanceof VFS DirectoryEntry VFS DirectoryEntry file VFS DirectoryEntry userObject underlined jEdit getBuffer file path null setIcon showIcons getIconForFile file expanded null setFont file type VFS DirectoryEntry FILE plainFont boldFont setText file name if sel Color color file getColor setForeground color null UIManager getColor color else if userObject instanceof BrowserView LoadingPlaceholder setIcon showIcons loadingIcon null setFont plainFont setText jEdit getProperty underlined false else if userObject instanceof String setIcon showIcons dirIcon null setFont boldFont setText String userObject underlined false else setIcon null setText null return this public void paintComponent Graphics if underlined Font font getFont FontMetrics fm getFontMetrics font int if getIcon null fm getAscent else getIcon getIconWidth getIconTextGap Math max fm getAscent setColor getForeground drawLine fm stringWidth getText super paintComponent public static Icon getIconForFile VFS DirectoryEntry file boolean expanded if file type VFS DirectoryEntry DIRECTORY return expanded openDirIcon dirIcon else if file type VFS DirectoryEntry FILESYSTEM return filesystemIcon else if jEdit getBuffer file path null return openFileIcon else return fileIcon boolean showIcons void propertiesChanged showIcons jEdit getBooleanProperty private Font plainFont private Font boldFont private boolean underlined public interface DockableWindowContainer void register DockableWindowManager Entry entry void add DockableWindowManager Entry entry void remove DockableWindowManager Entry entry void save DockableWindowManager Entry entry void show DockableWindowManager Entry entry boolean isVisible DockableWindowManager Entry entry public class TextAreaOptionPane extends AbstractOptionPane public TextAreaOptionPane super public void font new FontSelector jEdit getFontProperty addComponent jEdit getProperty font addComponent jEdit getProperty foregroundColor new ColorWellButton jEdit getColorProperty GridBagConstraints VERTICAL addComponent jEdit getProperty backgroundColor new ColorWellButton jEdit getColorProperty GridBagConstraints VERTICAL blinkCaret new JCheckBox jEdit getProperty blinkCaret setSelected jEdit getBooleanProperty blockCaret new JCheckBox jEdit getProperty blockCaret setSelected jEdit getBooleanProperty Box caretSettings new Box BoxLayout X_AXIS caretSettings add new JLabel jEdit getProperty caretSettings add Box createHorizontalStrut caretSettings add blinkCaret caretSettings add blockCaret addComponent caretSettings caretColor new ColorWellButton jEdit getColorProperty GridBagConstraints VERTICAL addComponent jEdit getProperty selectionColor new ColorWellButton jEdit getColorProperty GridBagConstraints VERTICAL lineHighlight new JCheckBox jEdit getProperty lineHighlight setSelected jEdit getBooleanProperty addComponent lineHighlight lineHighlightColor new ColorWellButton jEdit getColorProperty GridBagConstraints VERTICAL bracketHighlight new JCheckBox jEdit getProperty bracketHighlight setSelected jEdit getBooleanProperty addComponent bracketHighlight bracketHighlightColor new ColorWellButton jEdit getColorProperty GridBagConstraints VERTICAL eolMarkers new JCheckBox jEdit getProperty eolMarkers setSelected jEdit getBooleanProperty addComponent eolMarkers eolMarkerColor new ColorWellButton jEdit getColorProperty GridBagConstraints VERTICAL wrapGuide new JCheckBox jEdit getProperty wrapGuide setSelected jEdit getBooleanProperty addComponent wrapGuide wrapGuideColor new ColorWellButton jEdit getColorProperty GridBagConstraints VERTICAL electricBorders new JCheckBox jEdit getProperty electricBorders setSelected equals jEdit getProperty addComponent electricBorders joinNonWordChars new JCheckBox jEdit getProperty joinNonWordChars setSelected jEdit getBooleanProperty addComponent joinNonWordChars middleMousePaste new JCheckBox jEdit getProperty middleMousePaste setSelected jEdit getBooleanProperty addComponent middleMousePaste antiAlias new JCheckBox jEdit getProperty antiAlias setSelected jEdit getBooleanProperty addComponent antiAlias fracFontMetrics new JCheckBox jEdit getProperty fracFontMetrics setSelected jEdit getBooleanProperty addComponent fracFontMetrics public void jEdit setFontProperty font getFont jEdit setColorProperty foregroundColor getSelectedColor jEdit setColorProperty backgroundColor getSelectedColor jEdit setBooleanProperty blinkCaret isSelected jEdit setBooleanProperty blockCaret isSelected jEdit setColorProperty caretColor getSelectedColor jEdit setColorProperty selectionColor getSelectedColor jEdit setBooleanProperty lineHighlight isSelected jEdit setColorProperty lineHighlightColor getSelectedColor jEdit setBooleanProperty bracketHighlight isSelected jEdit setColorProperty bracketHighlightColor getSelectedColor jEdit setBooleanProperty eolMarkers isSelected jEdit setColorProperty eolMarkerColor getSelectedColor jEdit setBooleanProperty wrapGuide isSelected jEdit setColorProperty wrapGuideColor getSelectedColor jEdit setIntegerProperty electricBorders isSelected jEdit setBooleanProperty joinNonWordChars isSelected jEdit setBooleanProperty middleMousePaste isSelected jEdit setBooleanProperty antiAlias isSelected jEdit setBooleanProperty fracFontMetrics isSelected private FontSelector font private ColorWellButton foregroundColor private ColorWellButton backgroundColor private JCheckBox blinkCaret private JCheckBox blockCaret private ColorWellButton caretColor private ColorWellButton selectionColor private JCheckBox lineHighlight private ColorWellButton lineHighlightColor private JCheckBox bracketHighlight private ColorWellButton bracketHighlightColor private JCheckBox eolMarkers private ColorWellButton eolMarkerColor private JCheckBox wrapGuide private ColorWellButton wrapGuideColor private JCheckBox electricBorders private JCheckBox middleMousePaste private JCheckBox antiAlias private JCheckBox fracFontMetrics private JCheckBox joinNonWordChars class CharIndexedReader implements CharIndexed private static final int BUFFER_INCREMENT private final BufferedReader br private int index private int bufsize BUFFER_INCREMENT private int end UNKNOWN private char cached OUT_OF_BOUNDS private char lookBehind new char OUT_OF_BOUNDS OUT_OF_BOUNDS CharIndexedReader Reader reader int index if reader instanceof BufferedReader br BufferedReader reader else br new BufferedReader reader BUFFER_INCREMENT next if index move index private boolean next lookBehind lookBehind lookBehind cached if end cached OUT_OF_BOUNDS return false try if index br reset int br read br mark bufsize if end cached OUT_OF_BOUNDS return false cached char index catch IOException printStackTrace cached OUT_OF_BOUNDS return false return true public char charAt int index if index return cached else if index end return OUT_OF_BOUNDS else if index bufsize try while bufsize index bufsize BUFFER_INCREMENT br reset br mark bufsize br skip index catch IOException else if this index index try br reset br skip index catch IOException else if index return lookBehind else if index return lookBehind else if index return OUT_OF_BOUNDS char ch OUT_OF_BOUNDS try int br read if end index return ch ch char catch IOException ie return ch public boolean move int index boolean retval true while retval index retval next return retval public boolean isValid return cached OUT_OF_BOUNDS public class Log public static final int MAXLINES public static final int DEBUG public static final int MESSAGE public static final int NOTICE public static final int WARNING public static final int ERROR public static void init boolean stdio int level if stdio if System out realOut System err realErr System setOut createPrintStream NOTICE null System setErr createPrintStream ERROR null Log level level log MESSAGE Log class String props for int props length log MESSAGE Log class props System getProperty props public static void setLogWriter Writer stream if Log stream null stream null try stream write logDocument getText logDocument getLength stream flush catch Exception Log stream stream public static Document getLogDocument return logDocument public static void flushStream if stream null try stream flush catch IOException io io printStackTrace realErr public static void closeStream if stream null try stream close stream null catch IOException io io printStackTrace realErr public static void log int urgency Object source Object message String if source null Thread currentThread getName if null Thread currentThread getClass getName else if source instanceof Class Class source getName else source getClass getName int index lastIndexOf if index substring index if message instanceof Throwable urgency source Throwable message else String String valueOf message synchronized LOCK StringTokenizer st new StringTokenizer while st hasMoreTokens urgency st nextToken private static Object LOCK new Object private static Document logDocument private static int level WARNING private static Writer stream private static String lineSep private static PrintStream realOut private static PrintStream realErr static level WARNING realOut System out realErr System err logDocument new PlainDocument lineSep System getProperty private static PrintStream createPrintStream final int urgency final Object source return new PrintStream new OutputStream public void write int byte barray byte write barray public void write byte int off int len String str new String off len log urgency source str private static void final int urgency final Object source final Throwable message PrintStream out createPrintStream urgency source synchronized LOCK message printStackTrace out private static void int urgency String source String message String urgencyString urgencyToString urgency String fullMessage urgencyString source message try logDocument insertString logDocument getLength fullMessage null logDocument insertString logDocument getLength null Element map logDocument getDefaultRootElement int lines map getElementCount if lines MAXLINES Element first map getElement Element last map getElement lines MAXLINES logDocument remove first getStartOffset last getEndOffset if stream null stream write fullMessage stream write lineSep catch Exception printStackTrace realErr message urgencyString message if urgency level if urgency ERROR realErr print message else realOut print message private static String urgencyToString int urgency switch urgency case DEBUG return case MESSAGE return case NOTICE return case WARNING return case ERROR return throw new IllegalArgumentException urgency public class DummyTokenHandler implements TokenHandler public static final DummyTokenHandler INSTANCE new DummyTokenHandler public void handleToken byte id int offset int length TokenMarker LineContext context public class EvalError extends Exception SimpleNode node String message public EvalError String setMessage public EvalError String SimpleNode node this this node node public String toString String trace if node null trace node getLineNumber node getSourceFile node getText else trace return getMessage trace public void reThrow String msg throws EvalError reThrow msg null public void reThrow SimpleNode node throws EvalError reThrow null node public void reThrow String addMsg SimpleNode addNode throws EvalError prependMessage addMsg addNode addNode throw this void setNode SimpleNode node this node node SimpleNode getNode return node public String getErrorText if node null return node getText else return public int getErrorLineNumber if node null return node getLineNumber else return public String getErrorSourceFile if node null return node getSourceFile else return public String getMessage return message public void setMessage String message protected void prependMessage String if null message message protected void addNode SimpleNode addNode SimpleNode node this node if node null addNode null node addNode public class Interpreter implements Runnable ConsoleInterface Serializable public static final String VERSION public static boolean DEBUG TRACE transient static PrintStream debug static staticInit static This systemObject public static boolean strictJava false transient Parser parser NameSpace globalNameSpace transient Reader in transient PrintStream out transient PrintStream err ConsoleInterface console Interpreter parent String sourceFileInfo public boolean noExitOnEOF private boolean public Interpreter Reader in PrintStream out PrintStream err boolean interactive NameSpace namespace Interpreter parent String sourceFileInfo parser new Parser in long t1 System currentTimeMillis this in in this out out this err err this interactive interactive debug err this parent parent this sourceFileInfo sourceFileInfo if namespace null this globalNameSpace new NameSpace else this globalNameSpace namespace if getu instanceof bsh This initRootSystemObject if interactive loadRCFiles long t2 System currentTimeMillis if Interpreter DEBUG Interpreter debug t2 t1 public Interpreter Reader in PrintStream out PrintStream err boolean interactive NameSpace namespace this in out err interactive namespace null null public Interpreter Reader in PrintStream out PrintStream err boolean interactive this in out err interactive null public Interpreter ConsoleInterface console NameSpace globalNameSpace this console getIn console getOut console getErr true globalNameSpace setConsole console public Interpreter ConsoleInterface console this console null public Interpreter this new StringReader System out System err false null evalOnly true setu new Primitive true public void setConsole ConsoleInterface console this console console setu console setOut console getOut setErr console getErr private void initRootSystemObject setu new NameSpace getThis this if systemObject null systemObject new NameSpace getThis this setu systemObject This helpText new NameSpace getThis this setu helpText try setu System getProperty catch SecurityException setu setu new Primitive interactive setu new Primitive evalOnly public void setNameSpace NameSpace globalNameSpace this globalNameSpace globalNameSpace public NameSpace getNameSpace return globalNameSpace public static void main String args if args length String filename args String bshArgs if args length bshArgs new String args length System arraycopy args bshArgs args length else bshArgs new String Interpreter interpreter new Interpreter interpreter setu bshArgs try interpreter source filename interpreter globalNameSpace catch FileNotFoundException System out println catch TargetError System out println if inNativeCode printStackTrace DEBUG System err catch EvalError System out println catch IOException System out println else InputStream src if System getProperty startsWith System getProperty startsWith src new FilterInputStream System in public int available throws IOException return else src System in Reader in new CommandLineReader new InputStreamReader src Interpreter interpreter new Interpreter in System out System err true interpreter run public void run if evalOnly throw new RuntimeException if interactive try eval catch EvalError println VERSION boolean eof false CallStack callstack new CallStack callstack push globalNameSpace while eof try System out flush System err flush if interactive print eof Line SimpleNode node SimpleNode get_jjtree rootNode if DEBUG node dump Object ret node eval callstack this if callstack depth throw new InterpreterError callstack if ret instanceof ReturnControl ret ReturnControl ret value if ret Primitive VOID setVariable ret Object show getu if show instanceof Boolean Boolean show booleanValue true println ret catch ParseException error getMessage DEBUG if DEBUG printStackTrace if interactive eof true parser reInitInput in catch InterpreterError error getMessage printStackTrace if interactive eof true catch TargetError if inNativeCode printStackTrace DEBUG err if interactive eof true setVariable getTarget catch EvalError if interactive error toString else error getMessage if DEBUG printStackTrace if interactive eof true catch Exception error printStackTrace if interactive eof true catch TokenMgrError error parser reInitTokenInput in if interactive eof true finally get_jjtree reset if callstack depth callstack clear callstack push globalNameSpace if interactive noExitOnEOF System exit public Object source String filename NameSpace nameSpace throws FileNotFoundException IOException EvalError File file pathToFile filename if Interpreter DEBUG debug file Reader sourceIn new BufferedReader new FileReader file try return eval sourceIn nameSpace filename finally sourceIn close public Object source String filename throws FileNotFoundException IOException EvalError return source filename globalNameSpace public Object eval Reader in NameSpace nameSpace String sourceFileInfo throws EvalError Object retVal null if Interpreter DEBUG debug nameSpace Interpreter localInterpreter new Interpreter in out err false nameSpace this sourceFileInfo CallStack callstack new CallStack callstack push nameSpace boolean eof false while eof SimpleNode node null try eof localInterpreter Line if localInterpreter get_jjtree nodeArity node SimpleNode localInterpreter get_jjtree rootNode node setSourceFile sourceFileInfo if TRACE retVal node eval callstack localInterpreter if callstack depth throw new InterpreterError callstack if retVal instanceof ReturnControl retVal ReturnControl retVal value catch ParseException if DEBUG error getMessage DEBUG setErrorSourceFile sourceFileInfo throw catch InterpreterError printStackTrace throw new EvalError sourceFileInfo getMessage node catch TargetError if getNode null setNode node reThrow sourceFileInfo catch EvalError if DEBUG printStackTrace if getNode null setNode node reThrow sourceFileInfo catch Exception printStackTrace throw new EvalError sourceFileInfo getMessage node catch TokenMgrError throw new EvalError sourceFileInfo getMessage node finally localInterpreter get_jjtree reset if callstack depth callstack clear callstack push nameSpace return Primitive unwrap retVal public Object eval Reader in throws EvalError return eval in globalNameSpace public Object eval String statement throws EvalError if Interpreter DEBUG debug statement return eval statement globalNameSpace public Object eval String statement NameSpace nameSpace throws EvalError String statement endsWith statement statement return eval new StringReader nameSpace public final void error String if console null else err flush public Reader getIn return in public PrintStream getOut return out public PrintStream getErr return err public final void println String print public final void print String if console null console print else out print out flush public final static void debug String if DEBUG public Object get String name throws EvalError Object ret globalNameSpace get name this return Primitive unwrap ret Object getu String name try return get name catch EvalError throw new InterpreterError public void set String name Object value throws EvalError if value null value Primitive NULL CallStack callstack new CallStack LHS lhs globalNameSpace getNameResolver name toLHS callstack this lhs assign value void setu String name Object value try set name value catch EvalError throw new InterpreterError public void set String name long value throws EvalError set name new Primitive value public void set String name int value throws EvalError set name new Primitive value public void set String name double value throws EvalError set name new Primitive value public void set String name float value throws EvalError set name new Primitive value public void set String name boolean value throws EvalError set name new Primitive value public void unset String name throws EvalError CallStack callstack new CallStack LHS lhs globalNameSpace getNameResolver name toLHS callstack this if lhs type LHS VARIABLE throw new EvalError name lhs assign null public Object getVariable String name Object obj globalNameSpace getVariable name return Primitive unwrap obj public void setVariable String name Object value try globalNameSpace setVariable name value catch EvalError error toString public void setVariable String name int value try globalNameSpace setVariable name new Primitive value catch EvalError error toString public void setVariable String name float value try globalNameSpace setVariable name new Primitive value catch EvalError error toString public void setVariable String name boolean value try globalNameSpace setVariable name new Primitive value catch EvalError error toString public Object getInterface Class interf throws EvalError return globalNameSpace getThis this getInterface interf private JJTParserState get_jjtree return parser jjtree private ASCII_UCodeESC_CharStream get_jj_input_stream return parser jj_input_stream private boolean Line throws ParseException return parser Line void loadRCFiles try String rcfile System getProperty File separator source rcfile globalNameSpace catch Exception if Interpreter DEBUG debug public File pathToFile String fileName throws IOException File file new File fileName if file isAbsolute String cwd String getu file new File cwd File separator fileName return new File file getCanonicalPath public static void redirectOutputToFile String filename try PrintStream pout new PrintStream new FileOutputStream filename System setOut pout System setErr pout catch IOException System err println filename public void setClassLoader ClassLoader externalCL BshClassManager setClassLoader externalCL static void staticInit try debug System err DEBUG Boolean getBoolean TRACE Boolean getBoolean String outfilename System getProperty if outfilename null redirectOutputToFile outfilename catch SecurityException System err println catch Exception System err println catch Throwable System err println public String getSourceFileInfo if sourceFileInfo null return sourceFileInfo else return public Interpreter getParent return parent public void setOut PrintStream out this out out public void setErr PrintStream out this err err private void readObject ObjectInputStream stream throws java io IOException ClassNotFoundException stream defaultReadObject if console null setOut console getOut setErr console getErr else setOut System out setErr System err public class DefaultInputHandler extends InputHandler public DefaultInputHandler View view super view bindings currentBindings new Hashtable public DefaultInputHandler View view DefaultInputHandler copy super view bindings currentBindings copy bindings public void addKeyBinding String keyBinding EditAction action Hashtable current bindings StringTokenizer st new StringTokenizer keyBinding while st hasMoreTokens String keyCodeStr st nextToken KeyStroke keyStroke parseKeyStroke keyCodeStr if keyStroke null return if st hasMoreTokens Object current get keyStroke if instanceof Hashtable current Hashtable else Hashtable hash new Hashtable hash put PREFIX_STR keyCodeStr hash current put keyStroke current Hashtable else current put keyStroke action public void removeKeyBinding String keyBinding throw new InternalError public void removeAllKeyBindings bindings clear public Object getKeyBinding String keyBinding Hashtable current bindings StringTokenizer st new StringTokenizer keyBinding while st hasMoreTokens KeyStroke keyStroke parseKeyStroke st nextToken if keyStroke null return null if st hasMoreTokens Object current get keyStroke if instanceof Hashtable current Hashtable else return else return current get keyStroke return null public boolean isPrefixActive return bindings currentBindings public void keyPressed KeyEvent evt int keyCode evt getKeyCode int modifiers evt getModifiers if evt isControlDown evt isAltDown evt isMetaDown if keyCode KeyEvent VK_A keyCode KeyEvent VK_Z keyCode KeyEvent VK_0 keyCode KeyEvent VK_9 return else if keyCode KeyEvent VK_SPACE return else if readNextChar null if keyCode KeyEvent VK_ESCAPE readNextChar null view getStatus setMessage null else if evt isActionKey keyCode KeyEvent VK_TAB keyCode KeyEvent VK_ENTER return else KeyStroke keyStroke KeyStroke getKeyStroke keyCode modifiers Object currentBindings get keyStroke if null if currentBindings bindings Toolkit getDefaultToolkit beep repeatCount repeat false evt consume setCurrentBindings bindings else if modifiers keyCode KeyEvent VK_ENTER keyCode KeyEvent VK_TAB userInput char keyCode evt consume if readNextChar null readNextChar null view getStatus setMessage null if instanceof EditAction setCurrentBindings bindings invokeAction EditAction evt consume else if instanceof Hashtable setCurrentBindings Hashtable evt consume if null switch evt getKeyCode case KeyEvent VK_NUMPAD0 case KeyEvent VK_NUMPAD1 case KeyEvent VK_NUMPAD2 case KeyEvent VK_NUMPAD3 case KeyEvent VK_NUMPAD4 case KeyEvent VK_NUMPAD5 case KeyEvent VK_NUMPAD6 case KeyEvent VK_NUMPAD7 case KeyEvent VK_NUMPAD8 case KeyEvent VK_NUMPAD9 case KeyEvent VK_MULTIPLY case KeyEvent VK_ADD case KeyEvent VK_DECIMAL case KeyEvent VK_DIVIDE KeyEventWorkaround numericKeypadKey break public void keyTyped KeyEvent evt char evt getKeyChar if return KeyStroke keyStroke switch case keyStroke KeyStroke getKeyStroke KeyEvent VK_SPACE evt getModifiers break case keyStroke KeyStroke getKeyStroke KeyEvent VK_TAB evt getModifiers break case keyStroke KeyStroke getKeyStroke KeyEvent VK_ENTER evt getModifiers break default keyStroke KeyStroke getKeyStroke break Object currentBindings get keyStroke if instanceof Hashtable setCurrentBindings Hashtable else if instanceof EditAction setCurrentBindings bindings invokeAction EditAction else setCurrentBindings bindings if repeat Character isDigit repeatCount repeatCount view getStatus setMessage null else userInput public static void setModifierMapping int int int int DefaultInputHandler DefaultInputHandler DefaultInputHandler DefaultInputHandler public static char getSymbolicModifierName int mod if mod return else if mod return else if mod return else if mod return else return public static String getModifierString InputEvent evt StringBuffer buf new StringBuffer if evt isControlDown buf append getSymbolicModifierName InputEvent CTRL_MASK if evt isAltDown buf append getSymbolicModifierName InputEvent ALT_MASK if evt isMetaDown buf append getSymbolicModifierName InputEvent META_MASK if evt isShiftDown buf append getSymbolicModifierName InputEvent SHIFT_MASK return buf toString public static KeyStroke parseKeyStroke String keyStroke if keyStroke null return null int modifiers int index keyStroke indexOf if index for int index switch Character toUpperCase keyStroke charAt case modifiers break case modifiers break case modifiers break case modifiers break String key keyStroke substring index if key length char ch key charAt if modifiers return KeyStroke getKeyStroke ch else return KeyStroke getKeyStroke Character toUpperCase ch modifiers else if key length Log log Log ERROR DefaultInputHandler class keyStroke return null else int ch try ch KeyEvent class getField concat key getInt null catch Exception Log log Log ERROR DefaultInputHandler class keyStroke return null return KeyStroke getKeyStroke ch modifiers static if OperatingSystem isMacOS setModifierMapping InputEvent META_MASK InputEvent ALT_MASK InputEvent CTRL_MASK InputEvent SHIFT_MASK else setModifierMapping InputEvent CTRL_MASK InputEvent ALT_MASK InputEvent META_MASK InputEvent SHIFT_MASK private static int private static Object PREFIX_STR private Hashtable bindings private Hashtable currentBindings private void setCurrentBindings Hashtable bindings String prefixStr String bindings get PREFIX_STR if prefixStr null if currentBindings this bindings prefixStr currentBindings get PREFIX_STR prefixStr view getStatus setMessage prefixStr else view getStatus setMessage null currentBindings bindings public class ContextOptionPane extends AbstractOptionPane public ContextOptionPane super protected void setLayout new BorderLayout JLabel caption new JLabel jEdit getProperty add BorderLayout NORTH caption String contextMenu jEdit getProperty StringTokenizer st new StringTokenizer contextMenu listModel new DefaultListModel while st hasMoreTokens String actionName String st nextToken if actionName equals listModel addElement new ContextOptionPane MenuItem else EditAction action jEdit getAction actionName if action null continue String label action getLabel if label null continue listModel addElement new ContextOptionPane MenuItem actionName label list new JList listModel list setSelectionMode ListSelectionModel SINGLE_SELECTION list addListSelectionListener new ListHandler add BorderLayout CENTER new JScrollPane list JPanel buttons new JPanel buttons setBorder new EmptyBorder buttons setLayout new BoxLayout buttons BoxLayout X_AXIS ActionHandler actionHandler new ActionHandler add new RolloverButton GUIUtilities loadIcon add setToolTipText jEdit getProperty add addActionListener actionHandler buttons add add buttons add Box createHorizontalStrut remove new RolloverButton GUIUtilities loadIcon remove setToolTipText jEdit getProperty remove addActionListener actionHandler buttons add remove buttons add Box createHorizontalStrut moveUp new RolloverButton GUIUtilities loadIcon moveUp setToolTipText jEdit getProperty moveUp addActionListener actionHandler buttons add moveUp buttons add Box createHorizontalStrut moveDown new RolloverButton GUIUtilities loadIcon moveDown setToolTipText jEdit getProperty moveDown addActionListener actionHandler buttons add moveDown buttons add Box createGlue updateButtons add BorderLayout SOUTH buttons static class MenuItemCompare implements MiscUtilities Compare public int compare Object obj1 Object obj2 return MiscUtilities compareStrings MenuItem obj1 label MenuItem obj2 label true protected void StringBuffer buf new StringBuffer for int listModel getSize if buf append buf append MenuItem listModel elementAt actionName jEdit setProperty buf toString private DefaultListModel listModel private JList list private JButton add private JButton remove private JButton moveUp moveDown private void updateButtons int index list getSelectedIndex remove setEnabled index listModel getSize moveUp setEnabled index moveDown setEnabled index index listModel getSize static class MenuItem String actionName String label MenuItem String actionName String label this actionName actionName this label GUIUtilities prettifyMenuLabel label public String toString return label class ActionHandler implements ActionListener public void actionPerformed ActionEvent evt Object source evt getSource if source add ContextAddDialog dialog new ContextAddDialog ContextOptionPane this String selection dialog getSelection if selection null return int index list getSelectedIndex if index index listModel getSize else index MenuItem menuItem if selection equals menuItem new ContextOptionPane MenuItem else menuItem new ContextOptionPane MenuItem selection jEdit getAction selection getLabel listModel insertElementAt menuItem index list setSelectedIndex index list ensureIndexIsVisible index else if source remove int index list getSelectedIndex listModel removeElementAt index updateButtons else if source moveUp int index list getSelectedIndex Object selected list getSelectedValue listModel removeElementAt index listModel insertElementAt selected index list setSelectedIndex index list ensureIndexIsVisible index else if source moveDown int index list getSelectedIndex Object selected list getSelectedValue listModel removeElementAt index listModel insertElementAt selected index list setSelectedIndex index list ensureIndexIsVisible index class ListHandler implements ListSelectionListener public void valueChanged ListSelectionEvent evt updateButtons class ContextAddDialog extends EnhancedDialog public ContextAddDialog Component comp super GUIUtilities getParentDialog comp jEdit getProperty true JPanel content new JPanel new BorderLayout content setBorder new EmptyBorder setContentPane content ActionHandler actionHandler new ActionHandler ButtonGroup grp new ButtonGroup JPanel typePanel new JPanel new GridLayout typePanel setBorder new EmptyBorder typePanel add new JLabel jEdit getProperty separator new JRadioButton jEdit getProperty separator addActionListener actionHandler grp add separator typePanel add separator action new JRadioButton jEdit getProperty action addActionListener actionHandler grp add action action setSelected true typePanel add action content add BorderLayout NORTH typePanel JPanel actionPanel new JPanel new BorderLayout ActionSet actionsList jEdit getActionSets Vector vec new Vector actionsList length for int actionsList length ActionSet actionSet actionsList if actionSet getActionCount vec addElement actionSet combo new JComboBox vec combo addActionListener actionHandler actionPanel add BorderLayout NORTH combo list new JList list setVisibleRowCount list setSelectionMode ListSelectionModel SINGLE_SELECTION actionPanel add BorderLayout CENTER new JScrollPane list content add BorderLayout CENTER actionPanel JPanel southPanel new JPanel southPanel setLayout new BoxLayout southPanel BoxLayout X_AXIS southPanel setBorder new EmptyBorder southPanel add Box createGlue ok new JButton jEdit getProperty ok addActionListener actionHandler getRootPane setDefaultButton ok southPanel add ok southPanel add Box createHorizontalStrut cancel new JButton jEdit getProperty cancel addActionListener actionHandler southPanel add cancel southPanel add Box createGlue content add BorderLayout SOUTH southPanel updateList pack setLocationRelativeTo GUIUtilities getParentDialog comp show public void ok isOK true dispose public void cancel dispose public String getSelection if isOK return null if separator isSelected return else if action isSelected return ContextOptionPane MenuItem list getSelectedValue actionName else throw new InternalError private boolean isOK private JRadioButton separator action private JComboBox combo private JList list private JButton ok cancel private void updateList ActionSet actionSet ActionSet combo getSelectedItem EditAction actions actionSet getActions Vector listModel new Vector actions length for int actions length EditAction action actions String label action getLabel if label null continue listModel addElement new ContextOptionPane MenuItem action getName label MiscUtilities quicksort listModel new ContextOptionPane MenuItemCompare list setListData listModel class ActionHandler implements ActionListener public void actionPerformed ActionEvent evt Object source evt getSource if source instanceof JRadioButton combo setEnabled action isSelected list setEnabled action isSelected if source ok ok else if source cancel cancel else if source combo updateList public class PrintOptionPane extends AbstractOptionPane public PrintOptionPane super protected void font new FontSelector jEdit getFontProperty addComponent jEdit getProperty font printHeader new JCheckBox jEdit getProperty printHeader setSelected jEdit getBooleanProperty addComponent printHeader printFooter new JCheckBox jEdit getProperty printFooter setSelected jEdit getBooleanProperty addComponent printFooter printLineNumbers new JCheckBox jEdit getProperty printLineNumbers setSelected jEdit getBooleanProperty addComponent printLineNumbers color new JCheckBox jEdit getProperty color setSelected jEdit getBooleanProperty addComponent color String tabSizes tabSize new JComboBox tabSizes tabSize setEditable true tabSize setSelectedItem jEdit getProperty addComponent jEdit getProperty tabSize protected void jEdit setFontProperty font getFont jEdit setBooleanProperty printHeader isSelected jEdit setBooleanProperty printFooter isSelected jEdit setBooleanProperty printLineNumbers isSelected jEdit setBooleanProperty color isSelected jEdit setProperty String tabSize getSelectedItem private FontSelector font private JCheckBox printHeader private JCheckBox printFooter private JCheckBox printLineNumbers private JCheckBox color private JComboBox tabSize public class UrlVFS extends VFS public UrlVFS super READ_CAP WRITE_CAP public String constructPath String parent String path if parent endsWith return parent path else return parent path public InputStream Object session String path boolean ignoreErrors Component comp throws IOException try return new URL path openStream catch MalformedURLException mu Log log Log ERROR this mu String args mu getMessage VFSManager error comp path args return null public OutputStream Object session String path Component comp throws IOException try return new URL path openConnection getOutputStream catch MalformedURLException mu Log log Log ERROR this mu String args mu getMessage VFSManager error comp path args return null public class WorkThread extends Thread public WorkThread WorkThreadPool pool ThreadGroup group String name super group name setPriority this pool pool public void setAbortable boolean abortable synchronized abortLock this abortable abortable if aborted stop new Abort public boolean isRequestRunning return requestRunning public String getStatus return status public void setStatus String status this status status pool fireProgressChanged this public int getProgressValue return progressValue public void setProgressValue int progressValue this progressValue progressValue pool fireProgressChanged this public int getProgressMaximum return progressMaximum public void setProgressMaximum int progressMaximum this progressMaximum progressMaximum pool fireProgressChanged this public void abortCurrentRequest synchronized abortLock if abortable aborted stop new Abort aborted true public void run Log log Log DEBUG this getName for doRequests private WorkThreadPool pool private Object abortLock new Object private boolean requestRunning private boolean abortable private boolean aborted private String status private int progressValue private int progressMaximum private void doRequests WorkThreadPool Request request for request pool getNextRequest if request null break else requestRunning true pool fireStatusChanged this doRequest request requestRunning false pool fireStatusChanged this synchronized pool waitForAllLock pool waitForAllLock notifyAll synchronized pool lock try pool lock wait catch InterruptedException ie Log log Log ERROR this ie private void doRequest WorkThreadPool Request request Log log Log DEBUG WorkThread class request try request run run catch Abort Log log Log ERROR WorkThread class catch Throwable Log log Log ERROR WorkThread class Log log Log ERROR WorkThread class finally synchronized abortLock aborted abortable false status null progressValue progressMaximum pool requestDone pool fireStatusChanged this public static class Abort extends Error public Abort super class BSHPrimarySuffix extends SimpleNode public static final int CLASS INDEX NAME PROPERTY public int operation Object index public String field BSHPrimarySuffix int id super id public Object doSuffix Object obj CallStack callstack Interpreter interpreter throws EvalError if operation CLASS if obj instanceof BSHType NameSpace namespace callstack top return BSHType obj getType namespace else throw new EvalError this if obj instanceof SimpleNode if obj instanceof BSHAmbiguousName obj BSHAmbiguousName obj toObject callstack interpreter else obj SimpleNode obj eval callstack interpreter try switch operation case INDEX return doIndex obj callstack interpreter case NAME return doName obj callstack interpreter case PROPERTY return doProperty obj callstack interpreter default throw new InterpreterError catch ReflectError throw new EvalError this catch InvocationTargetException throw new TargetError getTargetException this true private Object doName Object obj CallStack callstack Interpreter interpreter throws EvalError ReflectError InvocationTargetException if field equals obj getClass isArray return new Primitive Array getLength obj if jjtGetNumChildren return Reflect getObjectField obj field else Object oa BSHArguments jjtGetChild getArguments callstack interpreter try return Reflect invokeObjectMethod interpreter obj field oa this catch EvalError ee throw new EvalError ee getMessage this static int getIndexAux Object obj CallStack callstack Interpreter interpreter SimpleNode callerNode throws EvalError if obj getClass isArray throw new EvalError callerNode int index try Object indexVal SimpleNode callerNode jjtGetChild eval callstack interpreter if indexVal instanceof Primitive indexVal NameSpace getAssignableForm indexVal Integer TYPE index Primitive indexVal intValue catch EvalError Interpreter debug reThrow callerNode throw new Error return index private Object doIndex Object obj CallStack callstack Interpreter interpreter throws EvalError ReflectError int index getIndexAux obj callstack interpreter this return Reflect getIndex obj index private Object doProperty Object obj CallStack callstack Interpreter interpreter throws EvalError if obj Primitive VOID throw new EvalError this if obj instanceof Primitive throw new EvalError this Object value SimpleNode jjtGetChild eval callstack interpreter if value instanceof String throw new EvalError this if obj instanceof Hashtable Object val Hashtable obj get String value if val null val Primitive NULL return val try return Reflect getObjectProperty obj String value catch ReflectError Interpreter debug toString throw new EvalError value this public class Abbrevs public static boolean getExpandOnInput return expandOnInput public static void setExpandOnInput boolean expandOnInput Abbrevs expandOnInput expandOnInput public static boolean expandAbbrev View view boolean add Buffer buffer view getBuffer JEditTextArea textArea view getTextArea if buffer isEditable view getToolkit beep return false int line textArea getCaretLine int lineStart buffer getLineStartOffset line int caret textArea getCaretPosition String lineText buffer getLineText line if lineText length if add view getToolkit beep return false int pos caret lineStart if pos if add view getToolkit beep return false pp removeAllElements int wordStart String abbrev if lineText charAt pos wordStart lineText indexOf wordStart TextUtilities findWordStart lineText wordStart buffer getStringProperty abbrev lineText substring wordStart pos int lastIndex for int abbrev length if abbrev charAt pp addElement abbrev substring lastIndex lastIndex pp addElement abbrev substring lastIndex abbrev String pp elementAt pp removeElementAt else wordStart TextUtilities findWordStart lineText pos buffer getStringProperty abbrev lineText substring wordStart pos Expansion expand expandAbbrev buffer getMode getName abbrev buffer getBooleanProperty buffer getTabSize pp if expand null if add new AddAbbrevDialog view abbrev return false else buffer beginCompoundEdit try lineText buffer getText lineStart wordStart int leadingIndent MiscUtilities getLeadingWhiteSpaceWidth lineText buffer getTabSize buffer remove lineStart wordStart pos wordStart buffer insert lineStart wordStart expand text if expand caretPosition textArea setCaretPosition lineStart wordStart expand caretPosition String whiteSpace MiscUtilities createWhiteSpace leadingIndent buffer getBooleanProperty buffer getTabSize for int line line expand lineCount buffer insert buffer getLineStartOffset whiteSpace finally buffer endCompoundEdit if expand posParamCount pp size view getStatus setMessageAndClear jEdit getProperty new Integer new Integer pp size new Integer expand posParamCount return true public static Hashtable getGlobalAbbrevs if loaded load return globalAbbrevs public static void setGlobalAbbrevs Hashtable globalAbbrevs abbrevsChanged true Abbrevs globalAbbrevs globalAbbrevs public static Hashtable getModeAbbrevs if loaded load return modes public static void setModeAbbrevs Hashtable modes abbrevsChanged true Abbrevs modes modes public static void addGlobalAbbrev String abbrev String expansion if loaded load globalAbbrevs put abbrev expansion abbrevsChanged true public static void addModeAbbrev String mode String abbrev String expansion if loaded load Hashtable modeAbbrevs Hashtable modes get mode if modeAbbrevs null modeAbbrevs new Hashtable modes put mode modeAbbrevs modeAbbrevs put abbrev expansion abbrevsChanged true static void save jEdit setBooleanProperty expandOnInput String settings jEdit getSettingsDirectory if abbrevsChanged settings null File file1 new File MiscUtilities constructPath settings File file2 new File MiscUtilities constructPath settings if file2 exists file2 lastModified abbrevsModTime Log log Log WARNING Abbrevs class file2 else jEdit backupSettingsFile file2 try saveAbbrevs new FileWriter file1 catch Exception Log log Log ERROR Abbrevs class file1 Log log Log ERROR Abbrevs class file2 delete file1 renameTo file2 abbrevsModTime file2 lastModified private static boolean loaded private static boolean abbrevsChanged private static long abbrevsModTime private static boolean expandOnInput private static Hashtable globalAbbrevs private static Hashtable modes private static Vector pp new Vector private Abbrevs static expandOnInput jEdit getBooleanProperty private static void load globalAbbrevs new Hashtable modes new Hashtable String settings jEdit getSettingsDirectory if settings null File file new File MiscUtilities constructPath settings abbrevsModTime file lastModified try loadAbbrevs new FileReader file loaded true catch FileNotFoundException fnf catch Exception Log log Log ERROR Abbrevs class file Log log Log ERROR Abbrevs class if loaded try loadAbbrevs new InputStreamReader Abbrevs class getResourceAsStream catch Exception Log log Log ERROR Abbrevs class Log log Log ERROR Abbrevs class loaded true private static Expansion expandAbbrev String mode String abbrev int softTabSize Vector pp if loaded load String expand null Hashtable modeAbbrevs Hashtable modes get mode if modeAbbrevs null expand String modeAbbrevs get abbrev if expand null expand String globalAbbrevs get abbrev if expand null return null else return new Expansion expand softTabSize pp private static void loadAbbrevs Reader throws Exception BufferedReader in new BufferedReader Hashtable currentAbbrevs null String line while line in readLine null if line length continue else if line startsWith line indexOf if line equals currentAbbrevs globalAbbrevs else String mode line substring line length currentAbbrevs Hashtable modes get mode if currentAbbrevs null currentAbbrevs new Hashtable modes put mode currentAbbrevs else int index line indexOf currentAbbrevs put line substring index line substring index in close private static void saveAbbrevs Writer throws Exception BufferedWriter out new BufferedWriter String lineSep System getProperty out write out write lineSep saveAbbrevs out globalAbbrevs Enumeration keys modes keys Enumeration values modes elements while keys hasMoreElements out write out write String keys nextElement out write out write lineSep saveAbbrevs out Hashtable values nextElement out close private static void saveAbbrevs Writer out Hashtable abbrevs throws Exception String lineSep System getProperty Enumeration keys abbrevs keys Enumeration values abbrevs elements while keys hasMoreElements String abbrev String keys nextElement out write abbrev out write out write values nextElement toString out write lineSep static class Expansion String text int caretPosition int lineCount int posParamCount Expansion String text int softTabSize Vector pp StringBuffer buf new StringBuffer boolean backslash false for int text length char ch text charAt if backslash backslash false if ch caretPosition buf length else if ch buf append lineCount else if ch if softTabSize buf append else for int softTabSize buf append else buf append ch else if ch backslash true else if ch if text length ch text charAt if Character isDigit ch ch int pos ch posParamCount Math max pos posParamCount if pos pp size buf append pp elementAt pos else buf append else else buf append ch this text buf toString class BSHPrimitiveType extends SimpleNode public Class type BSHPrimitiveType int id super id public Class getType return type public class XModeHandler extends HandlerBase public XModeHandler XmlParser parser String modeName String path this modeName modeName this parser parser this path path stateStack new Stack lastNoWordSep public Object resolveEntity String publicId String systemId if equals systemId return new StringReader return null public void attribute String aname String value boolean isSpecified aname aname null null aname intern if aname propName value else if aname propValue value else if aname lastTokenID Token stringToToken value if lastTokenID error value else if aname lastAtLineStart isSpecified value equals false else if aname lastAtWhitespaceEnd isSpecified value equals false else if aname lastAtWordStart isSpecified value equals false else if aname lastNoLineBreak isSpecified value equals false else if aname lastNoWordBreak isSpecified value equals false else if aname lastExcludeMatch isSpecified value equals false else if aname lastIgnoreCase isSpecified value equals true else if aname lastHighlightDigits isSpecified value equals false else if aname lastDigitRE value else if aname if isSpecified lastNoWordSep value else if aname try if isSpecified termChar Integer parseInt value catch NumberFormatException error value termChar else if aname lastEscape value else if aname lastSetName value else if aname lastDelegateSet value if lastDelegateSet null lastDelegateSet indexOf lastDelegateSet modeName lastDelegateSet else if aname lastDefaultID Token stringToToken value if lastDefaultID error value lastDefaultID Token NULL else if aname if value length error value lastDefaultID Token NULL else lastHashChar value charAt public void doctypeDecl String name String publicId String systemId throws Exception if equalsIgnoreCase name return error name public void charData char int off int len String tag peekElement String text new String off len if tag tag tag tag tag tag tag lastStart text else if tag lastEnd text else lastKeyword text public void startElement String tag tag pushElement tag if tag Log log Log WARNING this path else if tag mode jEdit getMode modeName if mode null mode new Mode modeName jEdit addMode mode else if tag keywords new KeywordMap rules getIgnoreCase else if tag rules new ParserRuleSet lastSetName mode rules setIgnoreCase lastIgnoreCase rules setHighlightDigits lastHighlightDigits if lastDigitRE null try rules setDigitRegexp new RE lastDigitRE lastIgnoreCase RE REG_ICASE RESearchMatcher RE_SYNTAX_JEDIT catch REException error if lastEscape null rules setEscapeRule ParserRule createEscapeRule lastEscape rules setDefault lastDefaultID rules setNoWordSep lastNoWordSep public void endElement String name if name null return String tag popElement if name equalsIgnoreCase tag if tag mode setTokenMarker marker else if tag props put propName propValue else if tag if peekElement equals rules setProperties props else mode setProperties props props new Hashtable else if tag rules setKeywords keywords marker addRuleSet lastSetName rules keywords null lastSetName null lastEscape null lastIgnoreCase true lastHighlightDigits false lastDigitRE null lastDefaultID Token NULL lastNoWordSep rules null else if tag rules setTerminateChar termChar termChar else if tag if lastStart null error return rules addRule ParserRule createSequenceRule lastStart lastDelegateSet lastTokenID lastAtLineStart lastAtWhitespaceEnd lastAtWordStart lastStart null lastEnd null lastDelegateSet null lastTokenID Token NULL lastAtLineStart false lastAtWordStart false lastAtWhitespaceEnd false else if tag if lastStart null error return try rules addRule ParserRule createRegexpSequenceRule lastHashChar lastStart lastDelegateSet lastTokenID lastAtLineStart lastAtWhitespaceEnd lastAtWordStart lastIgnoreCase catch REException re error re lastHashChar lastStart null lastEnd null lastDelegateSet null lastTokenID Token NULL lastAtLineStart false lastAtWordStart false lastAtWhitespaceEnd false else if tag if lastStart null error return if lastEnd null error return rules addRule ParserRule createSpanRule lastStart lastEnd lastDelegateSet lastTokenID lastNoLineBreak lastAtLineStart lastAtWhitespaceEnd lastAtWordStart lastExcludeMatch lastNoWordBreak lastStart null lastEnd null lastTokenID Token NULL lastAtLineStart false lastAtWordStart false lastNoLineBreak false lastAtWhitespaceEnd false lastExcludeMatch false lastNoWordBreak false lastDelegateSet null else if tag if lastStart null error return if lastEnd null error return try rules addRule ParserRule createRegexpSpanRule lastHashChar lastStart lastEnd lastDelegateSet lastTokenID lastNoLineBreak lastAtLineStart lastAtWhitespaceEnd lastAtWordStart lastExcludeMatch lastNoWordBreak lastIgnoreCase catch REException re error re lastHashChar lastStart null lastEnd null lastTokenID Token NULL lastAtLineStart false lastAtWordStart false lastNoLineBreak false lastAtWhitespaceEnd false lastExcludeMatch false lastNoWordBreak false lastDelegateSet null else if tag if lastStart null error return rules addRule ParserRule createEOLSpanRule lastStart lastDelegateSet lastTokenID lastAtLineStart lastAtWhitespaceEnd lastAtWordStart lastExcludeMatch lastStart null lastEnd null lastDelegateSet null lastTokenID Token NULL lastAtLineStart false lastAtWordStart false lastAtWhitespaceEnd false lastExcludeMatch false else if tag if lastStart null error return try rules addRule ParserRule createRegexpEOLSpanRule lastHashChar lastStart lastDelegateSet lastTokenID lastAtLineStart lastAtWhitespaceEnd lastAtWordStart lastExcludeMatch lastIgnoreCase catch REException re error re lastHashChar lastStart null lastEnd null lastDelegateSet null lastTokenID Token NULL lastAtLineStart false lastAtWordStart false lastAtWhitespaceEnd false lastExcludeMatch false else if tag if lastStart null error return rules addRule ParserRule createMarkFollowingRule lastStart lastTokenID lastAtLineStart lastAtWhitespaceEnd lastAtWordStart lastExcludeMatch lastStart null lastEnd null lastTokenID Token NULL lastAtLineStart false lastAtWordStart false lastAtWhitespaceEnd false lastExcludeMatch false else if tag if lastStart null error return rules addRule ParserRule createMarkPreviousRule lastStart lastTokenID lastAtLineStart lastAtWhitespaceEnd lastAtWordStart lastExcludeMatch lastStart null lastEnd null lastTokenID Token NULL lastAtLineStart false lastAtWordStart false lastAtWhitespaceEnd false lastExcludeMatch false else byte token Token stringToToken tag if token addKeyword lastKeyword token else throw new InternalError public void startDocument marker new TokenMarker marker setName modeName props new Hashtable pushElement null private XmlParser parser private String modeName private String path private TokenMarker marker private KeywordMap keywords private Mode mode private Stack stateStack private String propName private String propValue private Hashtable props private String lastStart private String lastEnd private String lastKeyword private String lastSetName private String lastEscape private String lastDelegateSet private String lastNoWordSep private ParserRuleSet rules private byte lastDefaultID Token NULL private byte lastTokenID private int termChar private boolean lastNoLineBreak private boolean lastNoWordBreak private boolean lastAtLineStart private boolean lastAtWhitespaceEnd private boolean lastAtWordStart private boolean lastExcludeMatch private boolean lastIgnoreCase true private boolean lastHighlightDigits private String lastDigitRE private char lastHashChar private void addKeyword String byte id if null error return if keywords null return keywords add id private String pushElement String name name name null null name intern stateStack push name return name private String peekElement return String stateStack peek private String popElement return String stateStack pop private void error String msg jEdit getProperty msg private void error String msg String subst jEdit getProperty msg new String subst private void error String msg Throwable jEdit getProperty msg new String toString Log log Log ERROR this private void String msg Object args path new Integer parser getLineNumber new Integer parser getColumnNumber msg GUIUtilities error null args public class FloatingWindowContainer extends JFrame implements DockableWindowContainer public FloatingWindowContainer DockableWindowManager dockableWindowManager this dockableWindowManager dockableWindowManager setIconImage GUIUtilities getPluginIcon setDefaultCloseOperation DISPOSE_ON_CLOSE public void register DockableWindowManager Entry entry this entry entry setTitle entry title getContentPane add BorderLayout CENTER entry win pack GUIUtilities loadGeometry this entry factory name show public void add DockableWindowManager Entry entry public void save DockableWindowManager Entry entry GUIUtilities saveGeometry this entry factory name public void remove DockableWindowManager Entry entry super dispose public void show final DockableWindowManager Entry entry toFront requestFocus SwingUtilities invokeLater new Runnable public void run entry win requestDefaultFocus public boolean isVisible DockableWindowManager Entry entry return true public void dispose save entry entry container null entry win null super dispose public Dimension getMinimumSize return new Dimension private DockableWindowManager dockableWindowManager private DockableWindowManager Entry entry public interface BufferChangeListener void foldLevelChanged Buffer buffer int startLine int endLine void contentInserted Buffer buffer int startLine int offset int numLines int length void contentRemoved Buffer buffer int startLine int offset int numLines int length void transactionComplete Buffer buffer public class TokenMarker public TokenMarker ruleSets new Hashtable public String getName return name public void setName String name if name null throw new NullPointerException this name name rulePfx name concat public void addRuleSet String setName ParserRuleSet rules if rules null return if setName null setName ruleSets put rulePfx concat setName rules if setName equals mainRuleSet rules public ParserRuleSet getMainRuleSet return mainRuleSet public ParserRuleSet getRuleSet String setName ParserRuleSet rules rules ParserRuleSet ruleSets get setName if rules null setName startsWith rulePfx int delim setName indexOf if delim byte id Token stringToToken setName rules ParserRuleSet getStandardRuleSet id else String modeName setName substring delim Mode mode jEdit getMode modeName if mode null Log log Log ERROR TokenMarker class modeName rules null else TokenMarker marker mode getTokenMarker rules marker getRuleSet setName ruleSets put setName rules if rules null Log log Log ERROR this setName return ParserRuleSet getStandardRuleSet Token INVALID else return rules public LineContext markTokens LineContext prevContext TokenHandler tokenHandler Segment line this tokenHandler tokenHandler this line line lastOffset line offset lineLength line count line offset context new LineContext if prevContext null context rules getMainRuleSet else context parent prevContext parent context inRule prevContext inRule context rules prevContext rules keywords context rules getKeywords escaped false seenWhitespaceEnd false whitespaceEnd line offset ParserRule rule int terminateChar context rules getTerminateChar boolean terminated false main_loop for pos line offset pos lineLength pos if terminateChar pos line offset terminateChar terminated terminated true context new LineContext ParserRuleSet getStandardRuleSet context rules getDefault context keywords context rules getKeywords if context parent null rule context parent inRule if rule null if checkDelegateEnd rule seenWhitespaceEnd true continue main_loop char ch line array pos rule context rules getRules ch while rule null if handleRule rule false seenWhitespaceEnd true continue main_loop rule rule next if Character isWhitespace ch if seenWhitespaceEnd whitespaceEnd pos if context inRule null handleRule context inRule true handleNoWordBreak markKeyword false if lastOffset pos tokenHandler handleToken context rules getDefault lastOffset line offset pos lastOffset context tokenHandler handleToken ch Token TAB Token WHITESPACE pos line offset context lastOffset pos escaped false else if keywords null context rules getRuleCount String noWordSep context rules getNoWordSep if Character isLetterOrDigit ch noWordSep indexOf ch if context inRule null handleRule context inRule true handleNoWordBreak markKeyword true tokenHandler handleToken context rules getDefault lastOffset line offset context lastOffset pos seenWhitespaceEnd true escaped false pos lineLength if context inRule null handleRule context inRule true handleNoWordBreak markKeyword true if context parent null rule context parent inRule if rule null context parent inRule action ParserRule NO_LINE_BREAK ParserRule NO_LINE_BREAK terminated context context parent keywords context rules getKeywords context inRule null tokenHandler handleToken Token END pos line offset context return context intern private Hashtable ruleSets private String name private String rulePfx private ParserRuleSet mainRuleSet private TokenHandler tokenHandler private Segment line private LineContext context private KeywordMap keywords private Segment pattern new Segment private int lastOffset private int lineLength private int pos private boolean escaped private int whitespaceEnd private boolean seenWhitespaceEnd private boolean checkDelegateEnd ParserRule rule if rule end null return false LineContext tempContext context context context parent keywords context rules getKeywords boolean tempEscaped escaped boolean handleRule rule true context tempContext keywords context rules getKeywords if tempEscaped if context inRule null handleRule context inRule true markKeyword true context LineContext context parent clone tokenHandler handleToken context inRule action ParserRule EXCLUDE_MATCH ParserRule EXCLUDE_MATCH context rules getDefault context inRule token pos line offset pattern count context keywords context rules getKeywords context inRule null lastOffset pos pattern count pos pattern count return true rule context parent rules getEscapeRule if rule null handleRule rule false return true return false private boolean handleRule ParserRule checkRule boolean end if end if Character toUpperCase checkRule hashChar Character toUpperCase line array pos return false if checkRule action ParserRule AT_LINE_START ParserRule AT_LINE_START if checkRule action ParserRule MARK_PREVIOUS lastOffset pos line offset return false else if checkRule action ParserRule AT_WHITESPACE_END ParserRule AT_WHITESPACE_END if checkRule action ParserRule MARK_PREVIOUS lastOffset pos whitespaceEnd return false else if checkRule action ParserRule AT_WORD_START ParserRule AT_WORD_START if checkRule action ParserRule MARK_PREVIOUS lastOffset pos lastOffset return false int matchedChars if end checkRule action ParserRule MARK_FOLLOWING if checkRule action ParserRule REGEXP end pattern array end checkRule end checkRule start pattern offset pattern count pattern array length matchedChars pattern count if TextUtilities regionMatches context rules getIgnoreCase line pos pattern array return false else int matchStart pos line offset REMatch match checkRule startRegexp getMatch new CharIndexedSegment line matchStart RE REG_ANCHORINDEX if match null return false else if match getStartIndex throw new InternalError else matchedChars match getEndIndex if checkRule action ParserRule IS_ESCAPE ParserRule IS_ESCAPE if context inRule null handleRule context inRule true escaped escaped pos pattern count else if escaped escaped false pos pattern count else if end if context inRule null handleRule context inRule true markKeyword checkRule action ParserRule MARK_PREVIOUS ParserRule MARK_PREVIOUS switch checkRule action ParserRule MAJOR_ACTIONS case ParserRule SEQ if checkRule action ParserRule REGEXP handleTokenWithTabs tokenHandler checkRule token pos line offset matchedChars context else tokenHandler handleToken checkRule token pos line offset matchedChars context ParserRuleSet delegateSet checkRule getDelegateRuleSet this if delegateSet null context new LineContext delegateSet context parent keywords context rules getKeywords break case ParserRule SPAN case ParserRule EOL_SPAN context inRule checkRule delegateSet checkRule getDelegateRuleSet this byte tokenType checkRule action ParserRule EXCLUDE_MATCH ParserRule EXCLUDE_MATCH context rules getDefault checkRule token if checkRule action ParserRule REGEXP handleTokenWithTabs tokenHandler tokenType pos line offset matchedChars context else tokenHandler handleToken tokenType pos line offset matchedChars context context new LineContext delegateSet context keywords context rules getKeywords break case ParserRule MARK_FOLLOWING tokenHandler handleToken checkRule action ParserRule EXCLUDE_MATCH ParserRule EXCLUDE_MATCH context rules getDefault checkRule token pos line offset pattern count context context inRule checkRule break case ParserRule MARK_PREVIOUS if checkRule action ParserRule EXCLUDE_MATCH ParserRule EXCLUDE_MATCH if pos lastOffset tokenHandler handleToken checkRule token lastOffset line offset pos lastOffset context tokenHandler handleToken context rules getDefault pos line offset pattern count context else tokenHandler handleToken checkRule token lastOffset line offset pos lastOffset pattern count context break default throw new InternalError pos matchedChars lastOffset pos else if context inRule action ParserRule MARK_FOLLOWING if pos lastOffset tokenHandler handleToken context inRule token lastOffset line offset pos lastOffset context lastOffset pos context inRule null return true private void handleNoWordBreak if context parent null ParserRule rule context parent inRule if rule null context parent inRule action ParserRule NO_WORD_BREAK if pos lastOffset tokenHandler handleToken rule token lastOffset line offset pos lastOffset context lastOffset pos context context parent keywords context rules getKeywords context inRule null private void handleTokenWithTabs TokenHandler tokenHandler byte tokenType int start int len LineContext context int last start int end start len for int start end if line array if last tokenHandler handleToken tokenType last last context tokenHandler handleToken tokenType context last if last end tokenHandler handleToken tokenType last end last context private void markKeyword boolean addRemaining int len pos lastOffset if len return if context rules getHighlightDigits boolean digit false boolean mixed false for int lastOffset pos char ch line array if Character isDigit ch digit true else mixed true if mixed RE digitRE context rules getDigitRegexp if digit if digitRE null digit false else CharIndexedSegment seg new CharIndexedSegment line false int oldCount line count int oldOffset line offset line offset lastOffset line count len if digitRE isMatch seg digit false line offset oldOffset line count oldCount if digit tokenHandler handleToken Token DIGIT lastOffset line offset len context lastOffset pos return if keywords null byte id keywords lookup line lastOffset len if id Token NULL tokenHandler handleToken id lastOffset line offset len context lastOffset pos return if addRemaining tokenHandler handleToken context rules getDefault lastOffset line offset len context lastOffset pos public static class LineContext private static Hashtable intern new Hashtable public LineContext parent public ParserRule inRule public ParserRuleSet rules public String spanEndSubst public LineContext ParserRule ParserRuleSet rs String spanEndSubst inRule rules rs this spanEndSubst spanEndSubst public LineContext ParserRuleSet rs LineContext lc rules rs parent lc null null LineContext lc clone public LineContext public LineContext intern Object obj intern get this if obj null intern put this this return this else return LineContext obj public int hashCode if inRule null return inRule hashCode else if rules null return rules hashCode else return public boolean equals Object obj if obj instanceof LineContext LineContext lc LineContext obj if lc parent null if parent null return false if parent null return false else if lc parent equals parent return false if lc spanEndSubst null if spanEndSubst null return false else if spanEndSubst null return false else if lc spanEndSubst equals spanEndSubst return false return lc inRule inRule lc rules rules else return false public Object clone LineContext lc new LineContext lc inRule inRule lc rules rules lc parent parent null null LineContext parent clone lc spanEndSubst spanEndSubst return lc public class FontSelector extends JButton public FontSelector Font font setFont font updateText setRequestFocusEnabled false addActionListener new ActionHandler private void updateText Font font getFont String styleString switch font getStyle case Font PLAIN styleString jEdit getProperty break case Font BOLD styleString jEdit getProperty break case Font ITALIC styleString jEdit getProperty break case Font BOLD Font ITALIC styleString jEdit getProperty break default styleString break setText font getName font getSize styleString class ActionHandler implements ActionListener public void actionPerformed ActionEvent evt Font font JDialog dialog GUIUtilities getParentDialog FontSelector this if dialog null font new FontSelectorDialog JOptionPane getFrameForComponent FontSelector this getFont getSelectedFont else font new FontSelectorDialog dialog getFont getSelectedFont if font null setFont font updateText class FontSelectorDialog extends EnhancedDialog public FontSelectorDialog Frame parent Font font super parent jEdit getProperty true init font public FontSelectorDialog Dialog parent Font font super parent jEdit getProperty true init font public void ok isOK true dispose public void cancel dispose public Font getSelectedFont if isOK return null int size try size Integer parseInt sizeField getText catch Exception size return new Font familyField getText styleList getSelectedIndex size private boolean isOK private JTextField familyField private JList familyList private JTextField sizeField private JList sizeList private JTextField styleField private JList styleList private JLabel preview private JButton ok private JButton cancel private static final String HIDEFONTS private void init Font font JPanel content new JPanel new BorderLayout content setBorder new EmptyBorder setContentPane content JPanel listPanel new JPanel new GridLayout JPanel familyPanel createTextFieldAndListPanel familyField new JTextField familyList new JList getFontList listPanel add familyPanel String sizes JPanel sizePanel createTextFieldAndListPanel sizeField new JTextField sizeList new JList sizes listPanel add sizePanel String styles jEdit getProperty jEdit getProperty jEdit getProperty jEdit getProperty JPanel stylePanel createTextFieldAndListPanel styleField new JTextField styleList new JList styles styleField setEditable false listPanel add stylePanel familyList setSelectedValue font getFamily true familyField setText font getFamily sizeList setSelectedValue String valueOf font getSize true sizeField setText String valueOf font getSize styleList setSelectedIndex font getStyle styleField setText String styleList getSelectedValue ListHandler listHandler new ListHandler familyList addListSelectionListener listHandler sizeList addListSelectionListener listHandler styleList addListSelectionListener listHandler content add BorderLayout NORTH listPanel preview new JLabel jEdit getProperty preview setBorder new TitledBorder jEdit getProperty updatePreview Dimension prefSize preview getPreferredSize prefSize height preview setPreferredSize prefSize content add BorderLayout CENTER preview JPanel buttons new JPanel buttons setLayout new BoxLayout buttons BoxLayout X_AXIS buttons setBorder new EmptyBorder buttons add Box createGlue ok new JButton jEdit getProperty ok addActionListener new ActionHandler getRootPane setDefaultButton ok buttons add ok buttons add Box createHorizontalStrut cancel new JButton jEdit getProperty cancel addActionListener new ActionHandler buttons add cancel buttons add Box createGlue content add BorderLayout SOUTH buttons pack setLocationRelativeTo getParent show private String getFontList String nameArray GraphicsEnvironment getLocalGraphicsEnvironment getAvailableFontFamilyNames Vector nameVector new Vector nameArray length for int nameArray length for HIDEFONTS length if nameArray indexOf HIDEFONTS break if HIDEFONTS length nameVector addElement nameArray String new String nameVector size nameVector copyInto return private JPanel createTextFieldAndListPanel String label JTextField textField JList list GridBagLayout layout new GridBagLayout JPanel panel new JPanel layout GridBagConstraints cons new GridBagConstraints cons gridx cons gridy cons gridwidth cons gridheight cons fill GridBagConstraints BOTH cons weightx JLabel new JLabel jEdit getProperty label layout setConstraints cons panel add cons gridy Component vs Box createVerticalStrut layout setConstraints vs cons panel add vs cons gridy layout setConstraints textField cons panel add textField cons gridy vs Box createVerticalStrut layout setConstraints vs cons panel add vs cons gridy cons gridheight GridBagConstraints REMAINDER cons weighty JScrollPane scroller new JScrollPane list layout setConstraints scroller cons panel add scroller return panel private void updatePreview String family familyField getText int size try size Integer parseInt sizeField getText catch Exception size int style styleList getSelectedIndex preview setFont new Font family style size class ActionHandler implements ActionListener public void actionPerformed ActionEvent evt if evt getSource ok ok else if evt getSource cancel cancel class ListHandler implements ListSelectionListener public void valueChanged ListSelectionEvent evt Object source evt getSource if source familyList String family String familyList getSelectedValue if family null familyField setText family else if source sizeList String size String sizeList getSelectedValue if size null sizeField setText size else if source styleList String style String styleList getSelectedValue if style null styleField setText style updatePreview public abstract class Selection implements Cloneable public int getStart return start public int getEnd return end public abstract int getStart Buffer buffer int line public abstract int getEnd Buffer buffer int line public int getStartLine return startLine public int getEndLine return endLine public boolean overlaps Selection if start start start end end start end end return true else return false public String toString return getClass getName start end startLine endLine public Object clone try return super clone catch CloneNotSupportedException throw new InternalError int start end int startLine endLine Selection Selection Selection sel this start sel start this end sel end Selection int start int end this start start this end end abstract void getText Buffer buffer StringBuffer buf abstract int setText Buffer buffer String text public static class Range extends Selection public Range public Range Selection sel super sel public Range int start int end super start end public int getStart Buffer buffer int line if line startLine return start else return buffer getLineStartOffset line public int getEnd Buffer buffer int line if line endLine return end else return buffer getLineEndOffset line void getText Buffer buffer StringBuffer buf buf append buffer getText start end start int setText Buffer buffer String text buffer remove start end start if text null text length buffer insert start text return start text length else return start public static class Rect extends Selection public Rect super public Rect Selection sel super sel public Rect int start int end super start end public Rect int startLine int start int endLine int end this startLine startLine this start start this endLine endLine this end end public Rect Buffer buffer int startLine int startColumn int endLine int endColumn this startLine startLine this endLine endLine int width new int int startOffset buffer getOffsetOfVirtualColumn startLine startColumn width if startOffset extraStartVirt startColumn width startOffset buffer getLineEndOffset startLine else startOffset buffer getLineStartOffset startLine int endOffset buffer getOffsetOfVirtualColumn endLine endColumn width if endOffset extraEndVirt endColumn width endOffset buffer getLineEndOffset endLine else endOffset buffer getLineStartOffset endLine public int getStartColumn Buffer buffer int virtColStart buffer getVirtualWidth startLine start buffer getLineStartOffset startLine extraStartVirt int virtColEnd buffer getVirtualWidth endLine end buffer getLineStartOffset endLine extraEndVirt return Math min virtColStart virtColEnd public int getEndColumn Buffer buffer int virtColStart buffer getVirtualWidth startLine start buffer getLineStartOffset startLine extraStartVirt int virtColEnd buffer getVirtualWidth endLine end buffer getLineStartOffset endLine extraEndVirt return Math max virtColStart virtColEnd public int getStart Buffer buffer int line return getColumnOnOtherLine buffer startLine line getStartColumn buffer public int getEnd Buffer buffer int line return getColumnOnOtherLine buffer startLine line getEndColumn buffer int extraStartVirt int extraEndVirt void getText Buffer buffer StringBuffer buf int start getStartColumn buffer int end getEndColumn buffer for int startLine endLine int lineStart buffer getLineStartOffset int lineLen buffer getLineLength int rectStart buffer getOffsetOfVirtualColumn start null if rectStart rectStart lineLen int rectEnd buffer getOffsetOfVirtualColumn end null if rectEnd rectEnd lineLen if rectEnd rectStart System err println start end rectStart rectEnd buf append buffer getText lineStart rectStart rectEnd rectStart if endLine buf append int setText Buffer buffer String text int startColumn getStartColumn buffer int endColumn getEndColumn buffer int total new int int tabSize buffer getTabSize int maxWidth int totalLines ArrayList lines new ArrayList if text null int lastNewline int currentWidth startColumn for int text length char ch text charAt if ch totalLines lines add text substring lastNewline lastNewline maxWidth Math max maxWidth currentWidth lines add new Integer currentWidth currentWidth startColumn else if ch currentWidth tabSize currentWidth tabSize else currentWidth if lastNewline text length totalLines lines add text substring lastNewline lines add new Integer currentWidth maxWidth Math max maxWidth currentWidth int endOffset int lastLine Math max startLine totalLines endLine for int startLine lastLine if buffer getLineCount buffer insert buffer getLength int lineStart buffer getLineStartOffset int lineLen buffer getLineLength int rectStart buffer getOffsetOfVirtualColumn startColumn total int startWhitespace if rectStart startWhitespace startColumn total rectStart lineLen else startWhitespace int rectEnd buffer getOffsetOfVirtualColumn endColumn null if rectEnd rectEnd lineLen buffer remove rectStart lineStart rectEnd rectStart int index startLine int endWhitespace if rectEnd lineLen endWhitespace else if startLine totalLines endWhitespace maxWidth startColumn else endWhitespace maxWidth Integer lines get index intValue String str startLine totalLines String lines get index if startWhitespace buffer insert rectStart lineStart MiscUtilities createWhiteSpace startWhitespace buffer insert rectStart lineStart startWhitespace str if endWhitespace buffer insert rectStart lineStart startWhitespace str length MiscUtilities createWhiteSpace endWhitespace endOffset rectStart lineStart startWhitespace endWhitespace str length if text null text length return end if lastLine buffer getLineCount int offset buffer getOffsetOfVirtualColumn lastLine startColumn null if offset buffer insertAtColumn lastLine startColumn return buffer getLineEndOffset lastLine else return buffer getLineStartOffset lastLine offset else return endOffset private int getColumnOnOtherLine Buffer buffer int line1 int line2 int col int returnValue buffer getOffsetOfVirtualColumn line2 col null if returnValue return buffer getLineEndOffset line2 else return buffer getLineStartOffset line2 returnValue public class Token public static byte stringToToken String value value value intern if value return Token NULL else if value return Token COMMENT1 else if value return Token COMMENT2 else if value return Token LITERAL1 else if value return Token LITERAL2 else if value return Token LABEL else if value return Token KEYWORD1 else if value return Token KEYWORD2 else if value return Token KEYWORD3 else if value return Token FUNCTION else if value return Token MARKUP else if value return Token OPERATOR else if value return Token DIGIT else if value return Token INVALID else return public static final byte NULL public static final byte COMMENT1 public static final byte COMMENT2 public static final byte LITERAL1 public static final byte LITERAL2 public static final byte LABEL public static final byte KEYWORD1 public static final byte KEYWORD2 public static final byte KEYWORD3 public static final byte FUNCTION public static final byte MARKUP public static final byte OPERATOR public static final byte DIGIT public static final byte ID_COUNT public static final byte WHITESPACE public static final byte TAB public static final byte END public byte id public int offset public int length public ParserRuleSet rules public Token next public Token byte id int offset int length ParserRuleSet rules this id id this offset offset this length length this rules rules public String toString return id offset length public class TextAreaPainter extends JComponent implements TabExpander public static final int LOWEST_LAYER Integer MIN_VALUE public static final int BACKGROUND_LAYER public static final int LINE_BACKGROUND_LAYER public static final int BELOW_SELECTION_LAYER public static final int SELECTION_LAYER public static final int WRAP_GUIDE_LAYER public static final int BELOW_MOST_EXTENSIONS_LAYER public static final int DEFAULT_LAYER public static final int BRACKET_HIGHLIGHT_LAYER public static final int HIGHEST_LAYER Integer MAX_VALUE public TextAreaPainter JEditTextArea textArea enableEvents AWTEvent FOCUS_EVENT_MASK AWTEvent KEY_EVENT_MASK AWTEvent MOUSE_EVENT_MASK this textArea textArea extensionMgr new ExtensionManager setAutoscrolls true setOpaque true setCursor Cursor getPredefinedCursor Cursor TEXT_CURSOR fontRenderContext new FontRenderContext null false false addExtension LINE_BACKGROUND_LAYER lineBackground new PaintLineBackground addExtension SELECTION_LAYER new PaintSelection addExtension WRAP_GUIDE_LAYER new WrapGuide addExtension BRACKET_HIGHLIGHT_LAYER new BracketHighlight public void setBounds int int int width int height if getX getY width getWidth height getHeight return super setBounds width height textArea recalculateVisibleLines textArea recalculateLastPhysicalLine textArea propertiesChanged textArea scrollBarsInitialized true public boolean isManagingFocus return false public boolean getFocusTraversalKeysEnabled return false public final SyntaxStyle getStyles return styles public final void setStyles SyntaxStyle styles this styles styles styles Token NULL new SyntaxStyle getForeground null getFont repaint public final Color getCaretColor return caretColor public final void setCaretColor Color caretColor this caretColor caretColor if textArea getBuffer null textArea invalidateLine textArea getCaretLine public final Color getSelectionColor return selectionColor public final void setSelectionColor Color selectionColor this selectionColor selectionColor if textArea getBuffer null textArea invalidateSelectedLines public final Color getLineHighlightColor return lineHighlightColor public final void setLineHighlightColor Color lineHighlightColor this lineHighlightColor lineHighlightColor if textArea getBuffer null textArea invalidateLine textArea getCaretLine public final boolean isLineHighlightEnabled return lineHighlight public final void setLineHighlightEnabled boolean lineHighlight this lineHighlight lineHighlight if textArea getBuffer null textArea invalidateSelectedLines public final Color getBracketHighlightColor return bracketHighlightColor public final void setBracketHighlightColor Color bracketHighlightColor this bracketHighlightColor bracketHighlightColor if textArea getBuffer null textArea invalidateLine textArea getBracketLine public final boolean isBracketHighlightEnabled return bracketHighlight public final void setBracketHighlightEnabled boolean bracketHighlight this bracketHighlight bracketHighlight if textArea getBuffer null textArea invalidateLine textArea getBracketLine public final boolean isBlockCaretEnabled return blockCaret public final void setBlockCaretEnabled boolean blockCaret this blockCaret blockCaret if textArea getBuffer null textArea invalidateLine textArea getCaretLine public final Color getEOLMarkerColor return eolMarkerColor public final void setEOLMarkerColor Color eolMarkerColor this eolMarkerColor eolMarkerColor repaint public final boolean getEOLMarkersPainted return eolMarkers public final void setEOLMarkersPainted boolean eolMarkers this eolMarkers eolMarkers repaint public final Color getWrapGuideColor return wrapGuideColor public final void setWrapGuideColor Color wrapGuideColor this wrapGuideColor wrapGuideColor repaint public final boolean isWrapGuidePainted return wrapGuide public final void setWrapGuidePainted boolean wrapGuide this wrapGuide wrapGuide repaint public final SyntaxStyle getFoldLineStyle return foldLineStyle public final void setFoldLineStyle SyntaxStyle foldLineStyle this foldLineStyle foldLineStyle repaint public void setAntiAliasEnabled boolean antiAlias this antiAlias antiAlias updateRenderingHints public boolean isAntiAliasEnabled return antiAlias public void setFractionalFontMetricsEnabled boolean fracFontMetrics this fracFontMetrics fracFontMetrics updateRenderingHints public boolean isFractionalFontMetricsEnabled return fracFontMetrics public FontRenderContext getFontRenderContext return fontRenderContext public void addExtension TextAreaExtension extension extensionMgr addExtension DEFAULT_LAYER extension repaint public void addExtension int layer TextAreaExtension extension extensionMgr addExtension layer extension repaint public void removeExtension TextAreaExtension extension extensionMgr removeExtension extension repaint public TextAreaExtension getExtensions return extensionMgr getExtensions public String getToolTipText MouseEvent evt if textArea getBuffer isLoaded return null return extensionMgr getToolTipText evt getX evt getY public FontMetrics getFontMetrics return fm public void setFont Font font super setFont font fm getFontMetrics font textArea recalculateVisibleLines public void paintComponent Graphics Graphics2D gfx Graphics2D gfx setRenderingHints renderingHints fontRenderContext gfx getFontRenderContext Rectangle clipRect gfx getClipBounds gfx setColor getBackground gfx fillRect clipRect clipRect clipRect width clipRect height Buffer buffer textArea getBuffer if buffer isLoaded return int textArea getHorizontalOffset int height fm getHeight int firstInvalid clipRect height int lastInvalid clipRect clipRect height height textArea chunkCache updateChunksUpTo lastInvalid int clipRect clipRect height try boolean updateMaxHorizontalScrollWidth false for int line firstInvalid line lastInvalid line ChunkCache LineInfo lineInfo textArea chunkCache getLineInfo line if lineInfo chunksValid System err println lineInfo width paintLine gfx buffer lineInfo line if lineInfo width textArea maxHorizontalScrollWidth updateMaxHorizontalScrollWidth true height if buffer isNextLineRequested int clipRect clipRect height textArea chunkCache invalidateChunksFrom lastInvalid repaint getWidth getHeight if updateMaxHorizontalScrollWidth textArea updateMaxHorizontalScrollWidth catch Exception Log log Log ERROR this firstInvalid lastInvalid Log log Log ERROR this if textArea timing textArea timing false System err println System currentTimeMillis textArea time public float nextTabStop float int tabOffset int ntabs int textArea tabSize return ntabs textArea tabSize public Dimension getPreferredSize Dimension dim new Dimension char foo new char for int foo length foo dim width int getFont getStringBounds foo foo length fontRenderContext getWidth dim height fm getHeight return dim public Dimension getMinimumSize return getPreferredSize private JEditTextArea textArea private SyntaxStyle styles private Color caretColor private Color selectionColor private Color lineHighlightColor private Color bracketHighlightColor private Color eolMarkerColor private Color wrapGuideColor private SyntaxStyle foldLineStyle private boolean blockCaret private boolean lineHighlight private boolean bracketHighlight private boolean eolMarkers private boolean wrapGuide private boolean antiAlias private boolean fracFontMetrics private FontMetrics fm private ExtensionManager extensionMgr private PaintLineBackground lineBackground private RenderingHints renderingHints private FontRenderContext fontRenderContext private void updateRenderingHints HashMap hints new HashMap if antiAlias hints put RenderingHints KEY_RENDERING RenderingHints VALUE_RENDER_QUALITY hints put RenderingHints KEY_ANTIALIASING RenderingHints VALUE_ANTIALIAS_ON hints put RenderingHints KEY_TEXT_ANTIALIASING RenderingHints VALUE_TEXT_ANTIALIAS_ON else hints put RenderingHints KEY_ANTIALIASING RenderingHints VALUE_ANTIALIAS_OFF hints put RenderingHints KEY_TEXT_ANTIALIASING RenderingHints VALUE_TEXT_ANTIALIAS_OFF hints put RenderingHints KEY_FRACTIONALMETRICS fracFontMetrics RenderingHints VALUE_FRACTIONALMETRICS_ON RenderingHints VALUE_FRACTIONALMETRICS_OFF renderingHints new RenderingHints hints fontRenderContext new FontRenderContext null antiAlias fracFontMetrics private int paintLine Graphics2D gfx Buffer buffer ChunkCache LineInfo lineInfo int screenLine int int int physicalLine lineInfo physicalLine if physicalLine extensionMgr paintInvalidLine gfx screenLine else int start textArea getScreenLineStartOffset screenLine int end textArea getScreenLineEndOffset screenLine extensionMgr paintValidLine gfx screenLine physicalLine start end Font defaultFont getFont Color defaultColor getForeground gfx setFont defaultFont gfx setColor defaultColor float baseLine fm getHeight fm getLeading fm getDescent if lineInfo chunks null buffer getLineText physicalLine textArea lineSegment Chunk paintChunkList textArea lineSegment lineInfo chunks gfx baseLine lineBackground bgColor true if lineInfo lastSubregion gfx setFont defaultFont gfx setColor eolMarkerColor gfx drawString Math max textArea getHorizontalOffset textArea wrapMargin textArea charWidth baseLine textArea charWidth else if lineBackground collapsedFold Font font foldLineStyle getFont gfx setFont font gfx setColor foldLineStyle getForegroundColor int nextLine textArea getFoldVisibilityManager getNextVisibleLine physicalLine if nextLine nextLine buffer getLineCount int count nextLine physicalLine String str count float width float font getStringBounds str fontRenderContext getWidth gfx drawString str baseLine width else if eolMarkers gfx setFont defaultFont gfx setColor eolMarkerColor gfx drawString baseLine textArea charWidth paintCaret gfx physicalLine start end lineBackground bgColor return private void paintCaret Graphics2D gfx int physicalLine int start int end int Color bgColor if textArea isCaretVisible return int caret textArea getCaretPosition if caret start caret end return int offset caret textArea getLineStartOffset physicalLine textArea offsetToXY physicalLine offset textArea returnValue int caretX textArea returnValue int height fm getHeight gfx setColor caretColor if blockCaret Graphics2D blockgfx Graphics2D gfx create blockgfx setXORMode bgColor if textArea isOverwriteEnabled blockgfx fillRect caretX height height textArea charWidth height else blockgfx fillRect caretX textArea charWidth height blockgfx dispose else if textArea isOverwriteEnabled gfx drawLine caretX height caretX textArea charWidth height else gfx drawLine caretX caretX height class PaintLineBackground extends TextAreaExtension boolean collapsedFold Color bgColor public void paintValidLine Graphics2D gfx int screenLine int physicalLine int start int end int JEditTextArea textArea TextAreaPainter this textArea Buffer buffer textArea getBuffer collapsedFold physicalLine buffer getLineCount buffer isFoldStart physicalLine textArea getFoldVisibilityManager isLineVisible physicalLine int caret textArea getCaretPosition boolean paintLineHighlight isLineHighlightEnabled caret start caret end textArea selection size if paintLineHighlight bgColor lineHighlightColor else if collapsedFold bgColor foldLineStyle getBackgroundColor if bgColor null bgColor getBackground else bgColor getBackground if paintLineHighlight collapsedFold gfx setColor bgColor gfx fillRect getWidth fm getHeight class PaintSelection extends TextAreaExtension public void paintValidLine Graphics2D gfx int screenLine int physicalLine int start int end int if textArea selection size return gfx setColor getSelectionColor for int textArea selection size paintSelection gfx screenLine physicalLine start end Selection textArea selection get private void paintSelection Graphics2D gfx int screenLine int physicalLine int start int end int Selection if end start start end return int selStartScreenLine textArea getScreenLineOfOffset start int selEndScreenLine textArea getScreenLineOfOffset end Buffer buffer textArea getBuffer int lineStart buffer getLineStartOffset physicalLine int x1 x2 if instanceof Selection Rect start lineStart end lineStart Selection Rect rect Selection Rect int rect getStartColumn buffer int rect getEndColumn buffer int lineLen buffer getLineLength physicalLine int total new int int rectStart buffer getOffsetOfVirtualColumn physicalLine total if rectStart x1 total textArea charWidth rectStart lineLen else x1 int rectEnd buffer getOffsetOfVirtualColumn physicalLine total if rectEnd x2 total textArea charWidth rectEnd lineLen else x2 if end rectStart start rectEnd return x1 rectStart start x1 textArea offsetToXY physicalLine rectStart textArea returnValue x2 rectEnd end getWidth x2 textArea offsetToXY physicalLine rectEnd textArea returnValue else if selStartScreenLine selEndScreenLine selStartScreenLine x1 textArea offsetToXY physicalLine start lineStart textArea returnValue x2 textArea offsetToXY physicalLine end lineStart textArea returnValue else if screenLine selStartScreenLine x1 textArea offsetToXY physicalLine start lineStart textArea returnValue x2 getWidth else if screenLine selEndScreenLine x1 x2 textArea offsetToXY physicalLine end lineStart textArea returnValue else x1 x2 getWidth if x1 x1 if x2 x2 if x1 x2 x2 gfx fillRect x1 x2 x1 fm getHeight class WrapGuide extends TextAreaExtension public void paintValidLine Graphics2D gfx int screenLine int physicalLine int start int end int paintInvalidLine gfx screenLine public void paintInvalidLine Graphics2D gfx int screenLine int if textArea wrapToWidth textArea wrapMargin isWrapGuidePainted gfx setColor getWrapGuideColor int textArea getHorizontalOffset textArea wrapMargin gfx drawLine fm getHeight public String getToolTipText int int if textArea wrapToWidth textArea wrapMargin isWrapGuidePainted int wrapGuidePos textArea wrapMargin textArea getHorizontalOffset if Math abs wrapGuidePos return String valueOf textArea getBuffer getProperty return null class BracketHighlight extends TextAreaExtension public void paintValidLine Graphics2D gfx int screenLine int physicalLine int start int end int if isBracketHighlightEnabled textArea isBracketHighlightVisible return int bracketLine textArea getBracketLine int bracketOffset textArea getBracketPosition if bracketLine bracketOffset return int bracketLineStart textArea getLineStartOffset bracketLine if bracketOffset bracketLineStart start bracketOffset bracketLineStart end return textArea offsetToXY bracketLine bracketOffset textArea returnValue gfx setColor getBracketHighlightColor gfx drawRect textArea returnValue int gfx getFont getStringBounds getFontRenderContext getWidth fm getHeight public class ParserTokenManager implements ParserConstants private final int jjStopStringLiteralDfa_0 int pos long active0 long active1 switch pos case if active1 return if active0 return if active1 return if active0 jjmatchedKind return return case if active0 if jjmatchedPos jjmatchedKind jjmatchedPos return if active0 return return case if active0 if jjmatchedPos jjmatchedKind jjmatchedPos return if active0 return return case if active0 return if active0 if jjmatchedPos jjmatchedKind jjmatchedPos return return case if active0 if jjmatchedPos jjmatchedKind jjmatchedPos return if active0 return return case if active0 jjmatchedKind jjmatchedPos return if active0 return return case if active0 return if active0 jjmatchedKind jjmatchedPos return return case if active0 jjmatchedKind jjmatchedPos return if active0 return return case if active0 jjmatchedKind jjmatchedPos return if active0 return return case if active0 return return default return private final int jjStartNfa_0 int pos long active0 long active1 return jjMoveNfa_0 jjStopStringLiteralDfa_0 pos active0 active1 pos private final int jjStopAtPos int pos int kind jjmatchedKind kind jjmatchedPos pos return pos private final int jjStartNfaWithStates_0 int pos int kind int state jjmatchedKind kind jjmatchedPos pos try curChar input_stream readChar catch java io IOException return pos return jjMoveNfa_0 state pos private final int jjMoveStringLiteralDfa0_0 switch curChar case return jjStartNfaWithStates_0 case return jjStartNfaWithStates_0 case return jjStartNfaWithStates_0 case return jjStartNfaWithStates_0 case return jjStartNfaWithStates_0 case jjmatchedKind return jjMoveStringLiteralDfa1_0 case jjmatchedKind return jjMoveStringLiteralDfa1_0 case jjmatchedKind return jjMoveStringLiteralDfa1_0 case return jjStopAtPos case return jjStopAtPos case jjmatchedKind return jjMoveStringLiteralDfa1_0 case jjmatchedKind return jjMoveStringLiteralDfa1_0 case return jjStopAtPos case jjmatchedKind return jjMoveStringLiteralDfa1_0 case return jjStartNfaWithStates_0 case jjmatchedKind return jjMoveStringLiteralDfa1_0 case return jjStopAtPos case return jjStopAtPos case jjmatchedKind return jjMoveStringLiteralDfa1_0 case jjmatchedKind return jjMoveStringLiteralDfa1_0 case jjmatchedKind return jjMoveStringLiteralDfa1_0 case return jjStopAtPos case return jjMoveStringLiteralDfa1_0 case return jjStopAtPos case return jjStopAtPos case jjmatchedKind return jjMoveStringLiteralDfa1_0 case return jjMoveStringLiteralDfa1_0 case return jjMoveStringLiteralDfa1_0 case return jjMoveStringLiteralDfa1_0 case return jjMoveStringLiteralDfa1_0 case return jjMoveStringLiteralDfa1_0 case return jjMoveStringLiteralDfa1_0 case return jjMoveStringLiteralDfa1_0 case return jjMoveStringLiteralDfa1_0 case return jjMoveStringLiteralDfa1_0 case return jjMoveStringLiteralDfa1_0 case return jjMoveStringLiteralDfa1_0 case return jjMoveStringLiteralDfa1_0 case return jjMoveStringLiteralDfa1_0 case return jjMoveStringLiteralDfa1_0 case return jjMoveStringLiteralDfa1_0 case return jjStopAtPos case jjmatchedKind return jjMoveStringLiteralDfa1_0 case return jjStopAtPos case return jjStopAtPos default return jjMoveNfa_0 private final int jjMoveStringLiteralDfa1_0 long active0 long active1 try curChar input_stream readChar catch java io IOException jjStopStringLiteralDfa_0 active0 active1 return switch curChar case if active1 return jjStopAtPos break case if active1 return jjStopAtPos break case if active1 return jjStopAtPos break case if active1 jjmatchedKind jjmatchedPos return jjMoveStringLiteralDfa2_0 active0 active1 case if active1 return jjStopAtPos else if active1 return jjStopAtPos else if active1 return jjStopAtPos else if active1 return jjStopAtPos else if active1 return jjStopAtPos else if active1 return jjStopAtPos else if active1 return jjStopAtPos else if active1 return jjStopAtPos else if active1 return jjStopAtPos else if active1 return jjStopAtPos else if active1 return jjStopAtPos else if active1 return jjStopAtPos break case if active1 jjmatchedKind jjmatchedPos return jjMoveStringLiteralDfa2_0 active0 active1 case return jjMoveStringLiteralDfa2_0 active0 active1 case return jjMoveStringLiteralDfa2_0 active0 active1 case return jjMoveStringLiteralDfa2_0 active0 active1 case if active0 return jjStartNfaWithStates_0 break case return jjMoveStringLiteralDfa2_0 active0 active1 case return jjMoveStringLiteralDfa2_0 active0 active1 case return jjMoveStringLiteralDfa2_0 active0 active1 case return jjMoveStringLiteralDfa2_0 active0 active1 case return jjMoveStringLiteralDfa2_0 active0 active1 case return jjMoveStringLiteralDfa2_0 active0 active1 case if active0 jjmatchedKind jjmatchedPos return jjMoveStringLiteralDfa2_0 active0 active1 case return jjMoveStringLiteralDfa2_0 active0 active1 case return jjMoveStringLiteralDfa2_0 active0 active1 case return jjMoveStringLiteralDfa2_0 active0 active1 case return jjMoveStringLiteralDfa2_0 active0 active1 case return jjMoveStringLiteralDfa2_0 active0 active1 case if active1 return jjStopAtPos break default break return jjStartNfa_0 active0 active1 private final int jjMoveStringLiteralDfa2_0 long old0 long active0 long old1 long active1 if active0 old0 active1 old1 return jjStartNfa_0 old0 old1 try curChar input_stream readChar catch java io IOException jjStopStringLiteralDfa_0 active0 active1 return switch curChar case if active1 return jjStopAtPos else if active1 return jjStopAtPos break case if active1 jjmatchedKind jjmatchedPos return jjMoveStringLiteralDfa3_0 active0 active1 case return jjMoveStringLiteralDfa3_0 active0 active1 case return jjMoveStringLiteralDfa3_0 active0 active1 case return jjMoveStringLiteralDfa3_0 active0 active1 case return jjMoveStringLiteralDfa3_0 active0 active1 case return jjMoveStringLiteralDfa3_0 active0 active1 case return jjMoveStringLiteralDfa3_0 active0 active1 case return jjMoveStringLiteralDfa3_0 active0 active1 case return jjMoveStringLiteralDfa3_0 active0 active1 case return jjMoveStringLiteralDfa3_0 active0 active1 case if active0 return jjStartNfaWithStates_0 else if active1 jjmatchedKind jjmatchedPos return jjMoveStringLiteralDfa3_0 active0 active1 case return jjMoveStringLiteralDfa3_0 active0 active1 case if active0 jjmatchedKind jjmatchedPos else if active1 jjmatchedKind jjmatchedPos else if active1 jjmatchedKind jjmatchedPos return jjMoveStringLiteralDfa3_0 active0 active1 case return jjMoveStringLiteralDfa3_0 active0 active1 case if active0 return jjStartNfaWithStates_0 break case if active0 return jjStartNfaWithStates_0 break default break return jjStartNfa_0 active0 active1 private final int jjMoveStringLiteralDfa3_0 long old0 long active0 long old1 long active1 if active0 old0 active1 old1 return jjStartNfa_0 old0 old1 try curChar input_stream readChar catch java io IOException jjStopStringLiteralDfa_0 active0 active1 return switch curChar case if active1 return jjStopAtPos break case return jjMoveStringLiteralDfa4_0 active0 active1 case return jjMoveStringLiteralDfa4_0 active0 active1 case return jjMoveStringLiteralDfa4_0 active0 active1 case return jjMoveStringLiteralDfa4_0 active0 active1 case if active0 return jjStartNfaWithStates_0 else if active1 jjmatchedKind jjmatchedPos return jjMoveStringLiteralDfa4_0 active0 active1 case if active0 return jjStartNfaWithStates_0 else if active0 return jjStartNfaWithStates_0 else if active0 return jjStartNfaWithStates_0 else if active0 return jjStartNfaWithStates_0 return jjMoveStringLiteralDfa4_0 active0 active1 case return jjMoveStringLiteralDfa4_0 active0 active1 case if active0 return jjStartNfaWithStates_0 return jjMoveStringLiteralDfa4_0 active0 active1 case if active0 return jjStartNfaWithStates_0 return jjMoveStringLiteralDfa4_0 active0 active1 case if active0 return jjStartNfaWithStates_0 return jjMoveStringLiteralDfa4_0 active0 active1 case if active0 return jjStartNfaWithStates_0 return jjMoveStringLiteralDfa4_0 active0 active1 case return jjMoveStringLiteralDfa4_0 active0 active1 case return jjMoveStringLiteralDfa4_0 active0 active1 case return jjMoveStringLiteralDfa4_0 active0 active1 case return jjMoveStringLiteralDfa4_0 active0 active1 default break return jjStartNfa_0 active0 active1 private final int jjMoveStringLiteralDfa4_0 long old0 long active0 long old1 long active1 if active0 old0 active1 old1 return jjStartNfa_0 old0 old1 try curChar input_stream readChar catch java io IOException jjStopStringLiteralDfa_0 active0 active1 return switch curChar case return jjMoveStringLiteralDfa5_0 active0 active1 case return jjMoveStringLiteralDfa5_0 active0 active1 case return jjMoveStringLiteralDfa5_0 active0 active1 case if active0 return jjStartNfaWithStates_0 else if active0 return jjStartNfaWithStates_0 return jjMoveStringLiteralDfa5_0 active0 active1 case if active0 return jjStartNfaWithStates_0 return jjMoveStringLiteralDfa5_0 active0 active1 case return jjMoveStringLiteralDfa5_0 active0 active1 case if active0 return jjStartNfaWithStates_0 break case if active0 jjmatchedKind jjmatchedPos return jjMoveStringLiteralDfa5_0 active0 active1 case if active1 return jjStopAtPos else if active1 return jjStopAtPos break case return jjMoveStringLiteralDfa5_0 active0 active1 case if active0 return jjStartNfaWithStates_0 break case if active0 return jjStartNfaWithStates_0 else if active0 return jjStartNfaWithStates_0 else if active0 return jjStartNfaWithStates_0 return jjMoveStringLiteralDfa5_0 active0 active1 case return jjMoveStringLiteralDfa5_0 active0 active1 case if active0 return jjStartNfaWithStates_0 return jjMoveStringLiteralDfa5_0 active0 active1 default break return jjStartNfa_0 active0 active1 private final int jjMoveStringLiteralDfa5_0 long old0 long active0 long old1 long active1 if active0 old0 active1 old1 return jjStartNfa_0 old0 old1 try curChar input_stream readChar catch java io IOException jjStopStringLiteralDfa_0 active0 active1 return switch curChar case return jjMoveStringLiteralDfa6_0 active0 active1 case return jjMoveStringLiteralDfa6_0 active0 active1 case if active0 return jjStartNfaWithStates_0 else if active0 return jjStartNfaWithStates_0 return jjMoveStringLiteralDfa6_0 active0 active1 case if active0 return jjStartNfaWithStates_0 break case return jjMoveStringLiteralDfa6_0 active0 active1 case if active0 return jjStartNfaWithStates_0 break case return jjMoveStringLiteralDfa6_0 active0 active1 case return jjMoveStringLiteralDfa6_0 active0 active1 case if active0 return jjStartNfaWithStates_0 return jjMoveStringLiteralDfa6_0 active0 active1 case return jjMoveStringLiteralDfa6_0 active0 active1 case if active0 return jjStartNfaWithStates_0 return jjMoveStringLiteralDfa6_0 active0 active1 default break return jjStartNfa_0 active0 active1 private final int jjMoveStringLiteralDfa6_0 long old0 long active0 long old1 long active1 if active0 old0 active1 old1 return jjStartNfa_0 old0 old1 try curChar input_stream readChar catch java io IOException jjStopStringLiteralDfa_0 active0 active1 return switch curChar case return jjMoveStringLiteralDfa7_0 active0 active1 case return jjMoveStringLiteralDfa7_0 active0 active1 case return jjMoveStringLiteralDfa7_0 active0 active1 case if active0 return jjStartNfaWithStates_0 break case if active0 return jjStartNfaWithStates_0 break case return jjMoveStringLiteralDfa7_0 active0 active1 case if active0 return jjStartNfaWithStates_0 return jjMoveStringLiteralDfa7_0 active0 active1 case return jjMoveStringLiteralDfa7_0 active0 active1 case if active0 return jjStartNfaWithStates_0 break default break return jjStartNfa_0 active0 active1 private final int jjMoveStringLiteralDfa7_0 long old0 long active0 long old1 long active1 if active0 old0 active1 old1 return jjStartNfa_0 old0 old1 try curChar input_stream readChar catch java io IOException jjStopStringLiteralDfa_0 active0 active1 return switch curChar case return jjMoveStringLiteralDfa8_0 active0 active1 case if active0 return jjStartNfaWithStates_0 return jjMoveStringLiteralDfa8_0 active0 active1 case return jjMoveStringLiteralDfa8_0 active0 active1 case return jjMoveStringLiteralDfa8_0 active0 active1 case return jjMoveStringLiteralDfa8_0 active0 active1 case return jjMoveStringLiteralDfa8_0 active0 active1 default break return jjStartNfa_0 active0 active1 private final int jjMoveStringLiteralDfa8_0 long old0 long active0 long old1 long active1 if active0 old0 active1 old1 return jjStartNfa_0 old0 old1 try curChar input_stream readChar catch java io IOException jjStopStringLiteralDfa_0 active0 active1 return switch curChar case return jjMoveStringLiteralDfa9_0 active0 active1 case if active0 return jjStartNfaWithStates_0 break case if active0 return jjStartNfaWithStates_0 break case return jjMoveStringLiteralDfa9_0 active0 active1 case return jjMoveStringLiteralDfa9_0 active0 active1 case return jjMoveStringLiteralDfa9_0 active0 active1 case return jjMoveStringLiteralDfa9_0 active0 active1 case return jjMoveStringLiteralDfa9_0 active0 active1 default break return jjStartNfa_0 active0 active1 private final int jjMoveStringLiteralDfa9_0 long old0 long active0 long old1 long active1 if active0 old0 active1 old1 return jjStartNfa_0 old0 old1 try curChar input_stream readChar catch java io IOException jjStopStringLiteralDfa_0 active0 active1 return switch curChar case return jjMoveStringLiteralDfa10_0 active0 active1 case if active0 return jjStartNfaWithStates_0 return jjMoveStringLiteralDfa10_0 active0 active1 case return jjMoveStringLiteralDfa10_0 active0 active1 case return jjMoveStringLiteralDfa10_0 active0 active1 case if active1 return jjStopAtPos break case return jjMoveStringLiteralDfa10_0 active0 active1 case return jjMoveStringLiteralDfa10_0 active0 active1 default break return jjStartNfa_0 active0 active1 private final int jjMoveStringLiteralDfa10_0 long old0 long active0 long old1 long active1 if active0 old0 active1 old1 return jjStartNfa_0 old0 old1 try curChar input_stream readChar catch java io IOException jjStopStringLiteralDfa_0 active1 return switch curChar case return jjMoveStringLiteralDfa11_0 active1 case return jjMoveStringLiteralDfa11_0 active1 case if active1 return jjStopAtPos return jjMoveStringLiteralDfa11_0 active1 case if active1 return jjStopAtPos break case if active1 jjmatchedKind jjmatchedPos return jjMoveStringLiteralDfa11_0 active1 default break return jjStartNfa_0 active1 private final int jjMoveStringLiteralDfa11_0 long old1 long active1 if active1 old1 return jjStartNfa_0 old1 try curChar input_stream readChar catch java io IOException jjStopStringLiteralDfa_0 active1 return switch curChar case return jjMoveStringLiteralDfa12_0 active1 case if active1 return jjStopAtPos break case return jjMoveStringLiteralDfa12_0 active1 case if active1 jjmatchedKind jjmatchedPos return jjMoveStringLiteralDfa12_0 active1 default break return jjStartNfa_0 active1 private final int jjMoveStringLiteralDfa12_0 long old1 long active1 if active1 old1 return jjStartNfa_0 old1 try curChar input_stream readChar catch java io IOException jjStopStringLiteralDfa_0 active1 return switch curChar case return jjMoveStringLiteralDfa13_0 active1 case return jjMoveStringLiteralDfa13_0 active1 case return jjMoveStringLiteralDfa13_0 active1 default break return jjStartNfa_0 active1 private final int jjMoveStringLiteralDfa13_0 long old1 long active1 if active1 old1 return jjStartNfa_0 old1 try curChar input_stream readChar catch java io IOException jjStopStringLiteralDfa_0 active1 return switch curChar case return jjMoveStringLiteralDfa14_0 active1 case return jjMoveStringLiteralDfa14_0 active1 case return jjMoveStringLiteralDfa14_0 active1 default break return jjStartNfa_0 active1 private final int jjMoveStringLiteralDfa14_0 long old1 long active1 if active1 old1 return jjStartNfa_0 old1 try curChar input_stream readChar catch java io IOException jjStopStringLiteralDfa_0 active1 return switch curChar case return jjMoveStringLiteralDfa15_0 active1 case return jjMoveStringLiteralDfa15_0 active1 default break return jjStartNfa_0 active1 private final int jjMoveStringLiteralDfa15_0 long old1 long active1 if active1 old1 return jjStartNfa_0 old1 try curChar input_stream readChar catch java io IOException jjStopStringLiteralDfa_0 active1 return switch curChar case return jjMoveStringLiteralDfa16_0 active1 case return jjMoveStringLiteralDfa16_0 active1 case return jjMoveStringLiteralDfa16_0 active1 default break return jjStartNfa_0 active1 private final int jjMoveStringLiteralDfa16_0 long old1 long active1 if active1 old1 return jjStartNfa_0 old1 try curChar input_stream readChar catch java io IOException jjStopStringLiteralDfa_0 active1 return switch curChar case return jjMoveStringLiteralDfa17_0 active1 case return jjMoveStringLiteralDfa17_0 active1 case return jjMoveStringLiteralDfa17_0 active1 default break return jjStartNfa_0 active1 private final int jjMoveStringLiteralDfa17_0 long old1 long active1 if active1 old1 return jjStartNfa_0 old1 try curChar input_stream readChar catch java io IOException jjStopStringLiteralDfa_0 active1 return switch curChar case return jjMoveStringLiteralDfa18_0 active1 case return jjMoveStringLiteralDfa18_0 active1 case if active1 return jjStopAtPos break default break return jjStartNfa_0 active1 private final int jjMoveStringLiteralDfa18_0 long old1 long active1 if active1 old1 return jjStartNfa_0 old1 try curChar input_stream readChar catch java io IOException jjStopStringLiteralDfa_0 active1 return switch curChar case return jjMoveStringLiteralDfa19_0 active1 case if active1 return jjStopAtPos break default break return jjStartNfa_0 active1 private final int jjMoveStringLiteralDfa19_0 long old1 long active1 if active1 old1 return jjStartNfa_0 old1 try curChar input_stream readChar catch java io IOException jjStopStringLiteralDfa_0 active1 return switch curChar case return jjMoveStringLiteralDfa20_0 active1 default break return jjStartNfa_0 active1 private final int jjMoveStringLiteralDfa20_0 long old1 long active1 if active1 old1 return jjStartNfa_0 old1 try curChar input_stream readChar catch java io IOException jjStopStringLiteralDfa_0 active1 return switch curChar case if active1 jjmatchedKind jjmatchedPos return jjMoveStringLiteralDfa21_0 active1 default break return jjStartNfa_0 active1 private final int jjMoveStringLiteralDfa21_0 long old1 long active1 if active1 old1 return jjStartNfa_0 old1 try curChar input_stream readChar catch java io IOException jjStopStringLiteralDfa_0 active1 return switch curChar case return jjMoveStringLiteralDfa22_0 active1 default break return jjStartNfa_0 active1 private final int jjMoveStringLiteralDfa22_0 long old1 long active1 if active1 old1 return jjStartNfa_0 old1 try curChar input_stream readChar catch java io IOException jjStopStringLiteralDfa_0 active1 return switch curChar case return jjMoveStringLiteralDfa23_0 active1 default break return jjStartNfa_0 active1 private final int jjMoveStringLiteralDfa23_0 long old1 long active1 if active1 old1 return jjStartNfa_0 old1 try curChar input_stream readChar catch java io IOException jjStopStringLiteralDfa_0 active1 return switch curChar case return jjMoveStringLiteralDfa24_0 active1 default break return jjStartNfa_0 active1 private final int jjMoveStringLiteralDfa24_0 long old1 long active1 if active1 old1 return jjStartNfa_0 old1 try curChar input_stream readChar catch java io IOException jjStopStringLiteralDfa_0 active1 return switch curChar case return jjMoveStringLiteralDfa25_0 active1 default break return jjStartNfa_0 active1 private final int jjMoveStringLiteralDfa25_0 long old1 long active1 if active1 old1 return jjStartNfa_0 old1 try curChar input_stream readChar catch java io IOException jjStopStringLiteralDfa_0 active1 return switch curChar case return jjMoveStringLiteralDfa26_0 active1 default break return jjStartNfa_0 active1 private final int jjMoveStringLiteralDfa26_0 long old1 long active1 if active1 old1 return jjStartNfa_0 old1 try curChar input_stream readChar catch java io IOException jjStopStringLiteralDfa_0 active1 return switch curChar case return jjMoveStringLiteralDfa27_0 active1 default break return jjStartNfa_0 active1 private final int jjMoveStringLiteralDfa27_0 long old1 long active1 if active1 old1 return jjStartNfa_0 old1 try curChar input_stream readChar catch java io IOException jjStopStringLiteralDfa_0 active1 return switch curChar case if active1 return jjStopAtPos break default break return jjStartNfa_0 active1 private final void jjCheckNAdd int state if jjrounds state jjround jjstateSet jjnewStateCnt state jjrounds state jjround private final void jjAddStates int start int end do jjstateSet jjnewStateCnt jjnextStates start while start end private final void jjCheckNAddTwoStates int state1 int state2 jjCheckNAdd state1 jjCheckNAdd state2 private final void jjCheckNAddStates int start int end do jjCheckNAdd jjnextStates start while start end private final void jjCheckNAddStates int start jjCheckNAdd jjnextStates start jjCheckNAdd jjnextStates start static final long jjbitVec0 static final long jjbitVec1 static final long jjbitVec3 static final long jjbitVec4 static final long jjbitVec5 static final long jjbitVec6 static final long jjbitVec7 static final long jjbitVec8 private final int jjMoveNfa_0 int startState int curPos int nextStates int startsAt jjnewStateCnt int jjstateSet startState int kind for if jjround ReInitRounds if curChar long curChar MatchLoop do switch jjstateSet case if if kind kind jjCheckNAdd else if jjCheckNAddStates else if curChar jjAddStates else if curChar if kind kind jjCheckNAdd else if curChar jjCheckNAddStates else if curChar jjAddStates else if curChar jjCheckNAdd else if curChar jjstateSet jjnewStateCnt if if kind kind jjCheckNAddTwoStates else if curChar if kind kind jjCheckNAddStates break case if curChar jjstateSet jjnewStateCnt else if curChar if kind kind jjCheckNAddStates if curChar jjCheckNAdd break case if break if kind kind jjCheckNAdd break case if curChar jjCheckNAddStates break case if jjCheckNAddStates break case if kind kind break case if curChar kind kind break case if curChar jjstateSet jjnewStateCnt break case if break if kind kind jjCheckNAddTwoStates break case if break if kind kind jjCheckNAddTwoStates break case if curChar jjCheckNAdd break case if break if kind kind jjCheckNAddStates break case if jjCheckNAdd break case if break if kind kind jjCheckNAddTwoStates break case if curChar jjAddStates break case if jjCheckNAdd break case if curChar kind kind break case if jjCheckNAdd break case if jjCheckNAddTwoStates break case if jjCheckNAdd break case if jjstateSet jjnewStateCnt break case if jjCheckNAdd break case if curChar jjCheckNAddStates break case if jjCheckNAddStates break case if jjCheckNAddStates break case if curChar kind kind break case if jjCheckNAddStates break case if jjCheckNAddStates break case if jjstateSet jjnewStateCnt break case if jjCheckNAdd break case if curChar break if kind kind jjCheckNAdd break case if break if kind kind jjCheckNAdd break case if jjCheckNAddStates break case if jjCheckNAddTwoStates break case if curChar break if kind kind jjCheckNAddStates break case if break if kind kind jjCheckNAddStates break case if jjCheckNAdd break case if break if kind kind jjCheckNAddTwoStates break case if jjCheckNAddTwoStates break case if jjCheckNAdd break case if break if kind kind jjCheckNAddTwoStates break case if jjCheckNAddStates break case if jjCheckNAdd break case if jjCheckNAddTwoStates break case if curChar break if kind kind jjCheckNAddStates break case if break if kind kind jjCheckNAddTwoStates break case if break if kind kind jjCheckNAddTwoStates break case if curChar jjAddStates break case if break if kind kind jjCheckNAddStates break case if kind kind break case if curChar kind kind break case if curChar jjstateSet jjnewStateCnt break case if curChar jjCheckNAdd break case if jjCheckNAddTwoStates break case if curChar jjCheckNAddStates break case if jjCheckNAddTwoStates break case if jjCheckNAddTwoStates break case if curChar kind kind break case if curChar jjCheckNAddTwoStates break case if jjCheckNAddTwoStates break case if curChar jjCheckNAddStates break case if jjCheckNAddTwoStates break case if jjCheckNAddTwoStates break case if curChar kind kind break case if curChar jjstateSet jjnewStateCnt break default break while startsAt else if curChar long curChar MatchLoop do switch jjstateSet case case if break if kind kind jjCheckNAdd break case jjAddStates break case if kind kind break case if jjAddStates break case if kind kind break case if jjCheckNAdd break case if curChar jjAddStates break case if jjCheckNAdd break case if jjCheckNAddStates break case if curChar jjAddStates break case if jjCheckNAddStates break case if jjAddStates break case if jjAddStates break case if jjAddStates break case if jjCheckNAdd break case if break if kind kind jjCheckNAddTwoStates break case if kind kind jjAddStates break case jjCheckNAddTwoStates break case case jjCheckNAddTwoStates break case jjCheckNAddTwoStates break case case jjCheckNAddTwoStates break default break while startsAt else int hiByte int curChar int i1 hiByte long l1 hiByte int i2 curChar long l2 curChar MatchLoop do switch jjstateSet case if jjCanMove_0 hiByte i1 i2 l1 l2 if kind kind jjCheckNAdd if jjCanMove_2 hiByte i1 i2 l1 l2 if kind kind jjCheckNAdd break case if jjCanMove_0 hiByte i1 i2 l1 l2 break if kind kind jjCheckNAdd break case if jjCanMove_1 hiByte i1 i2 l1 l2 jjAddStates break case if jjCanMove_1 hiByte i1 i2 l1 l2 jjstateSet jjnewStateCnt break case if jjCanMove_1 hiByte i1 i2 l1 l2 jjAddStates break case case if jjCanMove_2 hiByte i1 i2 l1 l2 break if kind kind jjCheckNAdd break case if jjCanMove_1 hiByte i1 i2 l1 l2 break if kind kind jjAddStates break case if jjCanMove_1 hiByte i1 i2 l1 l2 jjCheckNAddTwoStates break case case if jjCanMove_1 hiByte i1 i2 l1 l2 jjCheckNAddTwoStates break case if jjCanMove_1 hiByte i1 i2 l1 l2 jjCheckNAddTwoStates break case case if jjCanMove_1 hiByte i1 i2 l1 l2 jjCheckNAddTwoStates break default break while startsAt if kind jjmatchedKind kind jjmatchedPos curPos kind curPos if jjnewStateCnt startsAt jjnewStateCnt startsAt return curPos try curChar input_stream readChar catch java io IOException return curPos static final int jjnextStates private static final boolean jjCanMove_0 int hiByte int i1 int i2 long l1 long l2 switch hiByte case return jjbitVec0 i2 l2 default return false private static final boolean jjCanMove_1 int hiByte int i1 int i2 long l1 long l2 switch hiByte case return jjbitVec0 i2 l2 default if jjbitVec1 i1 l1 return true return false private static final boolean jjCanMove_2 int hiByte int i1 int i2 long l1 long l2 switch hiByte case return jjbitVec4 i2 l2 case return jjbitVec5 i2 l2 case return jjbitVec6 i2 l2 case return jjbitVec7 i2 l2 case return jjbitVec8 i2 l2 default if jjbitVec3 i1 l1 return true return false public static final String jjstrLiteralImages null null null null null null null null null null null null null null null null null null null null null public static final String lexStateNames static final long jjtoToken static final long jjtoSkip static final long jjtoSpecial private ASCII_UCodeESC_CharStream input_stream private final int jjrounds new int private final int jjstateSet new int protected char curChar public ParserTokenManager ASCII_UCodeESC_CharStream stream if ASCII_UCodeESC_CharStream staticFlag throw new Error input_stream stream public ParserTokenManager ASCII_UCodeESC_CharStream stream int lexState this stream SwitchTo lexState public void ReInit ASCII_UCodeESC_CharStream stream jjmatchedPos jjnewStateCnt curLexState defaultLexState input_stream stream ReInitRounds private final void ReInitRounds int jjround for jjrounds public void ReInit ASCII_UCodeESC_CharStream stream int lexState ReInit stream SwitchTo lexState public void SwitchTo int lexState if lexState lexState throw new TokenMgrError lexState TokenMgrError INVALID_LEXICAL_STATE else curLexState lexState private final Token jjFillToken Token Token newToken jjmatchedKind kind jjmatchedKind String im jjstrLiteralImages jjmatchedKind image im null input_stream GetImage im beginLine input_stream getBeginLine beginColumn input_stream getBeginColumn endLine input_stream getEndLine endColumn input_stream getEndColumn return int curLexState int defaultLexState int jjnewStateCnt int jjround int jjmatchedPos int jjmatchedKind public final Token getNextToken int kind Token specialToken null Token matchedToken int curPos EOFLoop for try curChar input_stream BeginToken catch java io IOException jjmatchedKind matchedToken jjFillToken matchedToken specialToken specialToken return matchedToken jjmatchedKind jjmatchedPos curPos jjMoveStringLiteralDfa0_0 if jjmatchedKind if jjmatchedPos curPos input_stream backup curPos jjmatchedPos if jjtoToken jjmatchedKind jjmatchedKind matchedToken jjFillToken matchedToken specialToken specialToken return matchedToken else if jjtoSpecial jjmatchedKind jjmatchedKind matchedToken jjFillToken if specialToken null specialToken matchedToken else matchedToken specialToken specialToken specialToken specialToken next matchedToken continue EOFLoop int error_line input_stream getEndLine int error_column input_stream getEndColumn String error_after null boolean EOFSeen false try input_stream readChar input_stream backup catch java io IOException e1 EOFSeen true error_after curPos input_stream GetImage if curChar curChar error_line error_column else error_column if EOFSeen input_stream backup error_after curPos input_stream GetImage throw new TokenMgrError EOFSeen curLexState error_line error_column error_after curChar TokenMgrError LEXICAL_ERROR class CharIndexedStringBuffer implements CharIndexed Serializable private StringBuffer private int anchor CharIndexedStringBuffer StringBuffer str int index str anchor index public char charAt int index int pos anchor index return pos length pos charAt pos OUT_OF_BOUNDS public boolean isValid return anchor length public boolean move int index return anchor index length public class SyntaxStyle public SyntaxStyle Color fgColor Color bgColor Font font this fgColor fgColor this bgColor bgColor this font font public Color getForegroundColor return fgColor public Color getBackgroundColor return bgColor public Font getFont return font private Color fgColor private Color bgColor private Font font public class Marker public char getShortcut return shortcut public int getPosition return position null pos position getOffset Marker Buffer buffer char shortcut int position this buffer buffer this shortcut shortcut this pos position void setShortcut char shortcut this shortcut shortcut void createPosition position buffer createPosition pos void removePosition if position null pos position getOffset position null void setPosition int pos this pos pos private Buffer buffer private char shortcut private int pos private Position position class IntPair implements Serializable public int first second class CharUnit implements Serializable public char ch public boolean bk public class RE extends REToken private static final String VERSION private static ResourceBundle messages PropertyResourceBundle getBundle Locale getDefault private REToken firstToken lastToken private int numSubs private int minimumLength public static final int REG_ICASE public static final int REG_DOT_NEWLINE public static final int REG_MULTILINE public static final int REG_NOTBOL public static final int REG_NOTEOL public static final int REG_ANCHORINDEX public static final int REG_NO_INTERPOLATE public static final String version return VERSION static final String getLocalizedMessage String key return messages getString key public RE Object pattern throws REException this pattern RESyntax RE_SYNTAX_PERL5 public RE Object pattern int cflags throws REException this pattern cflags RESyntax RE_SYNTAX_PERL5 public RE Object pattern int cflags RESyntax syntax throws REException this pattern cflags syntax private RE REToken first REToken last int subs int subIndex int minLength super subIndex firstToken first lastToken last numSubs subs minimumLength minLength addToken new RETokenEndSub subIndex private RE Object patternObj int cflags RESyntax syntax int myIndex int nextSub throws REException initialize patternObj cflags syntax myIndex nextSub protected RE super protected void initialize Object patternObj int cflags RESyntax syntax int myIndex int nextSub throws REException char pattern if patternObj instanceof String pattern String patternObj toCharArray else if patternObj instanceof char pattern char patternObj else if patternObj instanceof StringBuffer pattern new char StringBuffer patternObj length StringBuffer patternObj getChars pattern length pattern else pattern patternObj toString toCharArray int pLength pattern length Vector branches null firstToken lastToken null boolean insens cflags REG_ICASE int index CharUnit unit new CharUnit IntPair minMax new IntPair REToken currentToken null char ch while index pLength index getCharUnit pattern index unit if unit ch syntax get RESyntax RE_NO_BK_VBAR unit bk syntax get RESyntax RE_NEWLINE_ALT unit ch unit bk syntax get RESyntax RE_LIMITED_OPS addToken currentToken RE theBranch new RE firstToken lastToken numSubs subIndex minimumLength minimumLength if branches null branches new Vector branches addElement theBranch firstToken lastToken currentToken null else if unit ch syntax get RESyntax RE_INTERVALS syntax get RESyntax RE_NO_BK_BRACES unit bk int newIndex getMinMax pattern index minMax syntax if newIndex index if minMax first minMax second throw new REException getLocalizedMessage REException REG_BADRPT newIndex if currentToken null throw new REException getLocalizedMessage REException REG_BADRPT newIndex if currentToken instanceof RETokenRepeated throw new REException getLocalizedMessage REException REG_BADRPT newIndex if currentToken instanceof RETokenWordBoundary currentToken instanceof RETokenWordBoundary throw new REException getLocalizedMessage REException REG_BADRPT newIndex if currentToken getMinimumLength minMax second Integer MAX_VALUE throw new REException getLocalizedMessage REException REG_BADRPT newIndex index newIndex currentToken setRepeated currentToken minMax first minMax second index else addToken currentToken currentToken new RETokenChar subIndex unit ch insens else if unit ch unit bk Vector options new Vector boolean negative false char lastChar if index pLength throw new REException getLocalizedMessage REException REG_EBRACK index if ch pattern index negative true if index pLength throw new REException getLocalizedMessage REException REG_EBRACK index ch pattern index if ch lastChar ch if index pLength throw new REException getLocalizedMessage REException REG_EBRACK index while ch pattern index if ch lastChar if index pLength throw new REException getLocalizedMessage REException REG_EBRACK index if ch pattern index options addElement new RETokenChar subIndex lastChar insens lastChar else options addElement new RETokenRange subIndex lastChar ch insens lastChar index else if ch syntax get RESyntax RE_BACKSLASH_ESCAPE_IN_LISTS if index pLength throw new REException getLocalizedMessage REException REG_EBRACK index int posixID boolean negate false char asciiEsc if indexOf pattern index syntax get RESyntax RE_CHAR_CLASS_ESC_IN_LISTS switch pattern index case negate true case posixID RETokenPOSIX DIGIT break case negate true case posixID RETokenPOSIX SPACE break case negate true case posixID RETokenPOSIX ALNUM break else if indexOf pattern index switch pattern index case asciiEsc break case asciiEsc break case asciiEsc break if lastChar options addElement new RETokenChar subIndex lastChar insens if posixID options addElement new RETokenPOSIX subIndex posixID insens negate else if asciiEsc lastChar asciiEsc else lastChar pattern index index else if ch syntax get RESyntax RE_CHAR_CLASSES index pLength pattern index StringBuffer posixSet new StringBuffer index getPosixSet pattern index posixSet int posixId RETokenPOSIX intValue posixSet toString if posixId options addElement new RETokenPOSIX subIndex posixId insens false else if lastChar options addElement new RETokenChar subIndex lastChar insens lastChar ch if index pLength throw new REException getLocalizedMessage REException REG_EBRACK index if lastChar options addElement new RETokenChar subIndex lastChar insens addToken currentToken options trimToSize currentToken new RETokenOneOf subIndex options negative else if unit ch syntax get RESyntax RE_NO_BK_PARENS unit bk boolean pure false boolean comment false boolean lookAhead false boolean negativelh false if index pLength pattern index switch pattern index case if syntax get RESyntax RE_LOOKAHEAD pure true negativelh true lookAhead true index break case if syntax get RESyntax RE_LOOKAHEAD pure true lookAhead true index break case if syntax get RESyntax RE_PURE_GROUPING pure true index break case if syntax get RESyntax RE_COMMENTS comment true break default throw new REException getLocalizedMessage REException REG_BADRPT index if index pLength throw new REException getLocalizedMessage REException REG_ESUBREG index int endIndex index int nextIndex index int nested while nextIndex getCharUnit pattern endIndex unit nested unit ch syntax get RESyntax RE_NO_BK_PARENS unit bk if endIndex nextIndex pLength throw new REException getLocalizedMessage REException REG_ESUBREG nextIndex else if unit ch syntax get RESyntax RE_NO_BK_PARENS unit bk nested else if unit ch syntax get RESyntax RE_NO_BK_PARENS unit bk nested if comment index nextIndex addToken currentToken if pure numSubs int useIndex pure lookAhead nextSub numSubs currentToken new RE String valueOf pattern index endIndex index toCharArray cflags syntax useIndex nextSub numSubs numSubs RE currentToken getNumSubs if lookAhead currentToken new RETokenLookAhead currentToken negativelh index nextIndex else if syntax get RESyntax RE_UNMATCHED_RIGHT_PAREN_ORD unit ch syntax get RESyntax RE_NO_BK_PARENS unit bk throw new REException getLocalizedMessage REException REG_EPAREN index else if unit ch unit bk addToken currentToken currentToken null addToken new RETokenStart subIndex cflags REG_MULTILINE syntax getLineSeparator null else if unit ch unit bk addToken currentToken currentToken null addToken new RETokenEnd subIndex cflags REG_MULTILINE syntax getLineSeparator null else if unit ch unit bk addToken currentToken currentToken new RETokenAny subIndex syntax get RESyntax RE_DOT_NEWLINE cflags REG_DOT_NEWLINE syntax get RESyntax RE_DOT_NOT_NULL else if unit ch unit bk if currentToken null throw new REException getLocalizedMessage REException REG_BADRPT index if currentToken instanceof RETokenRepeated throw new REException getLocalizedMessage REException REG_BADRPT index if currentToken instanceof RETokenWordBoundary currentToken instanceof RETokenWordBoundary throw new REException getLocalizedMessage REException REG_BADRPT index if currentToken getMinimumLength throw new REException getLocalizedMessage REException REG_BADRPT index currentToken setRepeated currentToken Integer MAX_VALUE index else if unit ch syntax get RESyntax RE_LIMITED_OPS syntax get RESyntax RE_BK_PLUS_QM unit bk if currentToken null throw new REException getLocalizedMessage REException REG_BADRPT index if currentToken instanceof RETokenRepeated throw new REException getLocalizedMessage REException REG_BADRPT index if currentToken instanceof RETokenWordBoundary currentToken instanceof RETokenWordBoundary throw new REException getLocalizedMessage REException REG_BADRPT index if currentToken getMinimumLength throw new REException getLocalizedMessage REException REG_BADRPT index currentToken setRepeated currentToken Integer MAX_VALUE index else if unit ch syntax get RESyntax RE_LIMITED_OPS syntax get RESyntax RE_BK_PLUS_QM unit bk if currentToken null throw new REException getLocalizedMessage REException REG_BADRPT index if currentToken instanceof RETokenRepeated if syntax get RESyntax RE_STINGY_OPS RETokenRepeated currentToken isStingy RETokenRepeated currentToken makeStingy else throw new REException getLocalizedMessage REException REG_BADRPT index else if currentToken instanceof RETokenWordBoundary currentToken instanceof RETokenWordBoundary throw new REException getLocalizedMessage REException REG_BADRPT index else currentToken setRepeated currentToken index else if unit bk Character isDigit unit ch syntax get RESyntax RE_NO_BK_REFS addToken currentToken currentToken new RETokenBackRef subIndex Character digit unit ch insens else if unit bk unit ch syntax get RESyntax RE_STRING_ANCHORS addToken currentToken currentToken new RETokenStart subIndex null else if unit bk unit ch syntax get RESyntax RE_STRING_ANCHORS addToken currentToken currentToken new RETokenWordBoundary subIndex RETokenWordBoundary BEGIN RETokenWordBoundary END false else if unit bk unit ch addToken currentToken currentToken new RETokenWordBoundary subIndex RETokenWordBoundary BEGIN false else if unit bk unit ch addToken currentToken currentToken new RETokenWordBoundary subIndex RETokenWordBoundary END false else if unit bk unit ch syntax get RESyntax RE_STRING_ANCHORS addToken currentToken currentToken new RETokenWordBoundary subIndex RETokenWordBoundary BEGIN RETokenWordBoundary END true else if unit bk unit ch syntax get RESyntax RE_CHAR_CLASS_ESCAPES addToken currentToken currentToken new RETokenPOSIX subIndex RETokenPOSIX DIGIT insens false else if unit bk unit ch syntax get RESyntax RE_CHAR_CLASS_ESCAPES addToken currentToken currentToken new RETokenPOSIX subIndex RETokenPOSIX DIGIT insens true else if unit bk unit ch addToken currentToken currentToken new RETokenChar subIndex false else if unit bk unit ch addToken currentToken currentToken new RETokenChar subIndex false else if unit bk unit ch syntax get RESyntax RE_CHAR_CLASS_ESCAPES addToken currentToken currentToken new RETokenPOSIX subIndex RETokenPOSIX SPACE insens false else if unit bk unit ch syntax get RESyntax RE_CHAR_CLASS_ESCAPES addToken currentToken currentToken new RETokenPOSIX subIndex RETokenPOSIX SPACE insens true else if unit bk unit ch addToken currentToken currentToken new RETokenChar subIndex false else if unit bk unit ch syntax get RESyntax RE_CHAR_CLASS_ESCAPES addToken currentToken currentToken new RETokenPOSIX subIndex RETokenPOSIX ALNUM insens false else if unit bk unit ch syntax get RESyntax RE_CHAR_CLASS_ESCAPES addToken currentToken currentToken new RETokenPOSIX subIndex RETokenPOSIX ALNUM insens true else if unit bk unit ch syntax get RESyntax RE_STRING_ANCHORS addToken currentToken currentToken new RETokenEnd subIndex null addToken currentToken currentToken new RETokenChar subIndex unit ch insens addToken currentToken if branches null branches addElement new RE firstToken lastToken numSubs subIndex minimumLength minimumLength firstToken lastToken null addToken new RETokenOneOf subIndex branches false else addToken new RETokenEndSub subIndex private static int getCharUnit char input int index CharUnit unit throws REException unit ch input index if unit bk unit ch if index input length unit ch input index else throw new REException getLocalizedMessage REException REG_ESCAPE index return index public boolean isMatch Object input return isMatch input public boolean isMatch Object input int index return isMatch input index public boolean isMatch Object input int index int eflags return isMatchImpl makeCharIndexed input index index eflags private boolean isMatchImpl CharIndexed input int index int eflags return input charAt CharIndexed OUT_OF_BOUNDS REMatch new REMatch numSubs index eflags if firstToken match input while null if input charAt index CharIndexed OUT_OF_BOUNDS return true next return false public int getNumSubs return numSubs void setUncle REToken uncle if lastToken null lastToken setUncle uncle boolean chain REToken next super chain next setUncle next return true public int getMinimumLength return minimumLength public REMatch getAllMatches Object input return getAllMatches input public REMatch getAllMatches Object input int index return getAllMatches input index public REMatch getAllMatches Object input int index int eflags return getAllMatchesImpl makeCharIndexed input index index eflags private REMatch getAllMatchesImpl CharIndexed input int index int eflags Vector all new Vector REMatch null while getMatchImpl input index eflags null null all addElement index getEndIndex index input move else input move end if input isValid break REMatch mset new REMatch all size all copyInto mset return mset boolean match CharIndexed input REMatch mymatch if firstToken null return next input mymatch mymatch start subIndex mymatch index return firstToken match input mymatch public REMatch getMatch Object input return getMatch input public REMatch getMatch Object input int index return getMatch input index public REMatch getMatch Object input int index int eflags return getMatch input index eflags null public REMatch getMatch Object input int index int eflags StringBuffer buffer return getMatchImpl makeCharIndexed input index index eflags buffer REMatch getMatchImpl CharIndexed input int anchor int eflags StringBuffer buffer REMatch mymatch new REMatch numSubs anchor eflags do if minimumLength input charAt minimumLength CharIndexed OUT_OF_BOUNDS if match input mymatch REMatch longest mymatch while mymatch mymatch next null if mymatch index longest index longest mymatch longest end longest index longest finish input return longest mymatch clear anchor if buffer null input charAt CharIndexed OUT_OF_BOUNDS buffer append input charAt while input move if minimumLength if match input mymatch mymatch finish input return mymatch return null public REMatchEnumeration getMatchEnumeration Object input return getMatchEnumeration input public REMatchEnumeration getMatchEnumeration Object input int index return getMatchEnumeration input index public REMatchEnumeration getMatchEnumeration Object input int index int eflags return new REMatchEnumeration this makeCharIndexed input index index eflags public String substitute Object input String replace return substitute input replace public String substitute Object input String replace int index return substitute input replace index public String substitute Object input String replace int index int eflags return substituteImpl makeCharIndexed input index replace index eflags private String substituteImpl CharIndexed input String replace int index int eflags StringBuffer buffer new StringBuffer REMatch getMatchImpl input index eflags buffer if null return buffer toString buffer append eflags REG_NO_INTERPOLATE replace substituteInto replace if input move end do buffer append input charAt while input move return buffer toString public String substituteAll Object input String replace return substituteAll input replace public String substituteAll Object input String replace int index return substituteAll input replace index public String substituteAll Object input String replace int index int eflags return substituteAllImpl makeCharIndexed input index replace index eflags private String substituteAllImpl CharIndexed input String replace int index int eflags StringBuffer buffer new StringBuffer REMatch while getMatchImpl input index eflags buffer null buffer append eflags REG_NO_INTERPOLATE replace substituteInto replace index getEndIndex if end char ch input charAt if ch CharIndexed OUT_OF_BOUNDS buffer append ch input move else input move end if input isValid break return buffer toString private void addToken REToken next if next null return minimumLength next getMinimumLength if firstToken null lastToken firstToken next else if lastToken chain next lastToken next private static REToken setRepeated REToken current int min int max int index throws REException if current null throw new REException getLocalizedMessage REException REG_BADRPT index return new RETokenRepeated current subIndex current min max private static int getPosixSet char pattern int index StringBuffer buf int for index pattern length if pattern pattern return buf append pattern private int getMinMax char input int index IntPair minMax RESyntax syntax throws REException boolean mustMatch syntax get RESyntax RE_NO_BK_BRACES int startIndex index if index input length if mustMatch throw new REException getLocalizedMessage REException REG_EBRACE index else return startIndex int min max CharUnit unit new CharUnit StringBuffer buf new StringBuffer do index getCharUnit input index unit if Character isDigit unit ch buf append unit ch while index input length Character isDigit unit ch if buf length if mustMatch throw new REException getLocalizedMessage REException REG_EBRACE index else return startIndex min Integer parseInt buf toString if unit ch syntax get RESyntax RE_NO_BK_BRACES unit bk max min else if index input length if mustMatch throw new REException getLocalizedMessage REException REG_EBRACE index else return startIndex else if unit ch unit bk buf new StringBuffer while index getCharUnit input index unit input length Character isDigit unit ch buf append unit ch if unit ch syntax get RESyntax RE_NO_BK_BRACES unit bk if mustMatch throw new REException getLocalizedMessage REException REG_EBRACE index else return startIndex if buf length max Integer MAX_VALUE else max Integer parseInt buf toString else if mustMatch throw new REException getLocalizedMessage REException REG_EBRACE index else return startIndex minMax first min minMax second max return index public String toString StringBuffer sb new StringBuffer dump sb return sb toString void dump StringBuffer os os append if subIndex os append if firstToken null firstToken dumpAll os os append private static CharIndexed makeCharIndexed Object input int index if input instanceof String return new CharIndexedString String input index else if input instanceof char return new CharIndexedCharArray char input index else if input instanceof StringBuffer return new CharIndexedStringBuffer StringBuffer input index else if input instanceof InputStream return new CharIndexedInputStream InputStream input index else if input instanceof Reader return new CharIndexedReader Reader input index else if input instanceof CharIndexed else return new CharIndexedString input toString index public class EditorExiting extends EBMessage public EditorExiting EBComponent source super source class BSHArrayInitializer extends SimpleNode BSHArrayInitializer int id super id public Object eval CallStack callstack Interpreter interpreter throws EvalError throw new EvalError public Object eval Class baseType int dimensions CallStack callstack Interpreter interpreter throws EvalError int numInitializers jjtGetNumChildren dima numInitializers Object initializers Array newInstance baseType dima for int numInitializers SimpleNode node SimpleNode jjtGetChild Object currentInitializer if node instanceof BSHArrayInitializer if dimensions throw new EvalError this currentInitializer BSHArrayInitializer node eval baseType dimensions callstack interpreter else currentInitializer node eval callstack interpreter if currentInitializer Primitive VOID throw new EvalError this Object value if currentInitializer instanceof Primitive value Primitive currentInitializer getValue else value currentInitializer try Array set initializers value catch IllegalArgumentException Interpreter debug throwTypeError baseType currentInitializer Interpreter debug throwTypeError baseType currentInitializer return initializers private void throwTypeError Class baseType Object initializer int argNum throws EvalError String lhsType Reflect normalizeClassName baseType String rhsType if initializer instanceof Primitive rhsType Primitive initializer getType getName else rhsType Reflect normalizeClassName initializer getClass throw new EvalError rhsType baseType argNum this public class RolloverButton extends JButton public RolloverButton setBorder new EtchedBorder setBorderPainted false setMargin new Insets setRequestFocusEnabled false addMouseListener new MouseOverHandler public RolloverButton Icon icon this setIcon icon public boolean isOpaque return false public void setEnabled boolean super setEnabled setBorderPainted false repaint public void paint Graphics if isEnabled super paint else Graphics2D g2 Graphics2D g2 setComposite super paint g2 private static AlphaComposite AlphaComposite getInstance AlphaComposite SRC_OVER class MouseOverHandler extends MouseAdapter public void mouseEntered MouseEvent if isEnabled setBorderPainted true public void mouseExited MouseEvent setBorderPainted false class PluginListHandler extends HandlerBase PluginListHandler PluginList pluginList String path this pluginList pluginList this path path stateStack new Stack public Object resolveEntity String publicId String systemId if equals systemId return new StringReader return null public void attribute String aname String value boolean isSpecified aname aname null null aname intern value value null null value intern if aname name value else if aname jar value else if aname version value else if aname date value else if aname obsolete equals value else if aname depWhat value else if aname depFrom value else if aname depTo value else if aname depPlugin value else if aname size Integer parseInt value if size Log log Log WARNING this public void doctypeDecl String name String publicId String systemId throws Exception if equals name return Log log Log ERROR this path public void charData char int off int len String tag peekElement String text new String off len if tag description text else if tag pluginSetEntry text else if tag if author null author length author author text else author text else if tag download text else if tag downloadSource text public void startElement String tag tag pushElement tag if tag description null pluginSet new PluginList PluginSet pluginSet name name else if tag description null author null branch null plugin new PluginList Plugin else if tag download null branch new PluginList Branch else if tag downloadSize size else if tag downloadSourceSize size public void endElement String tag if tag null return else tag tag intern popElement if tag pluginList addPluginSet pluginSet pluginSet null pluginSetEntry null else if tag pluginSet plugins addElement pluginSetEntry pluginSetEntry null else if tag plugin jar jar plugin name name plugin author author plugin description description pluginList addPlugin plugin jar null name null author null else if tag branch version version branch date date branch download download branch downloadSize downloadSize branch downloadSource downloadSource branch downloadSourceSize downloadSourceSize branch obsolete obsolete plugin branches addElement branch version null download null obsolete false else if tag PluginList Dependency dep new PluginList Dependency depWhat depFrom depTo depPlugin branch deps addElement dep depWhat null depFrom null depTo null depPlugin null public void startDocument try pushElement null catch Exception printStackTrace public void endDocument pluginList finished private String path private PluginList pluginList private PluginList PluginSet pluginSet private String pluginSetEntry private PluginList Plugin plugin private String jar private String author private PluginList Branch branch private boolean obsolete private String version private String date private String download private int downloadSize private String downloadSource private int downloadSourceSize private int size private String depWhat private String depFrom private String depTo private String depPlugin private String name private String description private Stack stateStack private String pushElement String name name name null null name intern stateStack push name return name private String peekElement return String stateStack peek private String popElement return String stateStack pop public class SearchSettingsChanged extends EBMessage public SearchSettingsChanged EBComponent source super source final class ASCII_UCodeESC_CharStream public static final boolean staticFlag false static final int hexval char throws java io IOException switch case return case return case return case return case return case return case return case return case return case return case case return case case return case case return case case return case case return case case return public int bufpos int bufsize int available int tokenBegin private int bufline private int bufcolumn private int column private int line private java io Reader inputStream private boolean prevCharIsCR false private boolean prevCharIsLF false private char nextCharBuf private char buffer private int maxNextCharInd private int nextCharInd private int inBuf private final void ExpandBuff boolean wrapAround char newbuffer new char bufsize int newbufline new int bufsize int newbufcolumn new int bufsize try if wrapAround System arraycopy buffer tokenBegin newbuffer bufsize tokenBegin System arraycopy buffer newbuffer bufsize tokenBegin bufpos buffer newbuffer System arraycopy bufline tokenBegin newbufline bufsize tokenBegin System arraycopy bufline newbufline bufsize tokenBegin bufpos bufline newbufline System arraycopy bufcolumn tokenBegin newbufcolumn bufsize tokenBegin System arraycopy bufcolumn newbufcolumn bufsize tokenBegin bufpos bufcolumn newbufcolumn bufpos bufsize tokenBegin else System arraycopy buffer tokenBegin newbuffer bufsize tokenBegin buffer newbuffer System arraycopy bufline tokenBegin newbufline bufsize tokenBegin bufline newbufline System arraycopy bufcolumn tokenBegin newbufcolumn bufsize tokenBegin bufcolumn newbufcolumn bufpos tokenBegin catch Throwable throw new Error getMessage available bufsize tokenBegin private final void FillBuff throws java io IOException int if maxNextCharInd maxNextCharInd nextCharInd try if inputStream read nextCharBuf maxNextCharInd maxNextCharInd inputStream close throw new java io IOException else maxNextCharInd return catch java io IOException if bufpos bufpos backup else bufline bufpos line bufcolumn bufpos column throw private final char ReadByte throws java io IOException if nextCharInd maxNextCharInd FillBuff return nextCharBuf nextCharInd public final char BeginToken throws java io IOException if inBuf inBuf return buffer tokenBegin bufpos bufsize bufpos bufpos tokenBegin bufpos return readChar private final void AdjustBuffSize if available bufsize if tokenBegin bufpos available tokenBegin else ExpandBuff false else if available tokenBegin available bufsize else if tokenBegin available ExpandBuff true else available tokenBegin private final void UpdateLineColumn char column if prevCharIsLF prevCharIsLF false line column else if prevCharIsCR prevCharIsCR false if prevCharIsLF true else line column switch case prevCharIsCR true break case prevCharIsLF true break case column column column break default break bufline bufpos line bufcolumn bufpos column public final char readChar throws java io IOException if inBuf inBuf return buffer bufpos bufsize bufpos bufpos char if bufpos available AdjustBuffSize if buffer bufpos char char ReadByte UpdateLineColumn int backSlashCnt if bufpos available AdjustBuffSize try if buffer bufpos char char ReadByte UpdateLineColumn if backSlashCnt if bufpos bufpos bufsize break backup backSlashCnt return catch java io IOException if backSlashCnt backup backSlashCnt return UpdateLineColumn backSlashCnt try while char char ReadByte column buffer bufpos char hexval hexval char char ReadByte hexval char char ReadByte hexval char char ReadByte column catch java io IOException throw new Error line column if backSlashCnt return else backup backSlashCnt return else UpdateLineColumn return public final int getColumn return bufcolumn bufpos public final int getLine return bufline bufpos public final int getEndColumn return bufcolumn bufpos public final int getEndLine return bufline bufpos public final int getBeginColumn return bufcolumn tokenBegin public final int getBeginLine return bufline tokenBegin public final void backup int amount inBuf amount if bufpos amount bufpos bufsize public ASCII_UCodeESC_CharStream java io Reader dstream int startline int startcolumn int buffersize inputStream dstream line startline column startcolumn available bufsize buffersize buffer new char buffersize bufline new int buffersize bufcolumn new int buffersize nextCharBuf new char public ASCII_UCodeESC_CharStream java io Reader dstream int startline int startcolumn this dstream startline startcolumn public void ReInit java io Reader dstream int startline int startcolumn int buffersize inputStream dstream line startline column startcolumn if buffer null buffersize buffer length available bufsize buffersize buffer new char buffersize bufline new int buffersize bufcolumn new int buffersize nextCharBuf new char prevCharIsLF prevCharIsCR false tokenBegin inBuf maxNextCharInd nextCharInd bufpos public void ReInit java io Reader dstream int startline int startcolumn ReInit dstream startline startcolumn public ASCII_UCodeESC_CharStream java io InputStream dstream int startline int startcolumn int buffersize this new java io InputStreamReader dstream startline startcolumn public ASCII_UCodeESC_CharStream java io InputStream dstream int startline int startcolumn this dstream startline startcolumn public void ReInit java io InputStream dstream int startline int startcolumn int buffersize ReInit new java io InputStreamReader dstream startline startcolumn public void ReInit java io InputStream dstream int startline int startcolumn ReInit dstream startline startcolumn public final String GetImage if bufpos tokenBegin return new String buffer tokenBegin bufpos tokenBegin else return new String buffer tokenBegin bufsize tokenBegin new String buffer bufpos public final char GetSuffix int len char ret new char len if bufpos len System arraycopy buffer bufpos len ret len else System arraycopy buffer bufsize len bufpos ret len bufpos System arraycopy buffer ret len bufpos bufpos return ret public void Done nextCharBuf null buffer null bufline null bufcolumn null public void adjustBeginLineColumn int newLine int newCol int start tokenBegin int len if bufpos tokenBegin len bufpos tokenBegin inBuf else len bufsize tokenBegin bufpos inBuf int int nextColDiff columnDiff while len bufline start bufsize bufline start bufsize bufline newLine nextColDiff columnDiff bufcolumn bufcolumn bufcolumn newCol columnDiff columnDiff nextColDiff if len bufline newLine bufcolumn newCol columnDiff while len if bufline start bufsize bufline start bufsize bufline newLine else bufline newLine line bufline column bufcolumn public class IndentFoldHandler extends FoldHandler public IndentFoldHandler super public int getFoldLevel Buffer buffer int lineIndex Segment seg int tabSize buffer getTabSize buffer getLineText lineIndex seg int offset seg offset int count seg count int whitespace boolean seenNonWhiteSpace false loop for int count switch seg array offset case whitespace break case whitespace tabSize whitespace tabSize break default seenNonWhiteSpace true break loop if seenNonWhiteSpace if lineIndex return buffer getFoldLevel lineIndex else return return whitespace public class BSHFormalComment extends SimpleNode public String text public BSHFormalComment int id super id public class ReadWriteLock public synchronized void readLock if activeReaders allowRead activeReaders return waitingReaders while allowRead try wait catch InterruptedException Log log Log ERROR this return waitingReaders activeReaders readers addElement Thread currentThread public synchronized void readUnlock if activeReaders throw new InternalError activeReaders notifyAll public synchronized void writeLock if writerThread null if Thread currentThread writerThread lockCount return if allowWrite claimWriteLock return waitingWriters while allowWrite try wait catch InterruptedException waitingWriters Log log Log ERROR this return waitingWriters claimWriteLock public synchronized void writeUnlock if activeWriters lockCount throw new InternalError if Thread currentThread writerThread throw new InternalError if lockCount activeWriters writerThread null notifyAll public synchronized boolean isWriteLocked return activeWriters private int activeReaders private int activeWriters private int waitingReaders private int waitingWriters private Vector readers new Vector private Thread writerThread private int lockCount private final boolean allowRead return Thread currentThread writerThread waitingWriters activeWriters private final boolean allowWrite return activeReaders activeWriters private void claimWriteLock activeWriters writerThread Thread currentThread lockCount class JJTParserState private java util Stack nodes private java util Stack marks private boolean node_created JJTParserState nodes new java util Stack marks new java util Stack sp mk boolean nodeCreated return node_created void reset nodes removeAllElements marks removeAllElements sp mk Node rootNode return Node nodes elementAt void pushNode Node nodes push sp Node popNode if sp mk mk Integer marks pop intValue return Node nodes pop Node peekNode return Node nodes peek int nodeArity return sp mk void clearNodeScope Node while sp mk popNode mk Integer marks pop intValue void openNodeScope Node marks push new Integer mk mk sp jjtOpen void closeNodeScope Node int num mk Integer marks pop intValue while num Node popNode jjtSetParent jjtAddChild num jjtClose pushNode node_created true void closeNodeScope Node boolean condition if condition int nodeArity mk Integer marks pop intValue while Node popNode jjtSetParent jjtAddChild jjtClose pushNode node_created true else mk Integer marks pop intValue node_created false public abstract class BshClassManager private static BshClassManager manager private static boolean checkedForManager private static Object NOVALUE new Object private static ClassLoader externalClassLoader protected transient static Hashtable absoluteClassCache new Hashtable protected transient static Hashtable absoluteNonClasses new Hashtable public static BshClassManager getClassManager if checkedForManager manager null try if plainClassForName null plainClassForName null Class bcm plainClassForName manager BshClassManager bcm newInstance catch ClassNotFoundException catch Exception System err println checkedForManager true return manager public static boolean classExists String name return classForName name null public static Class classForName String name if manager null return manager getClassForName name else try return plainClassForName name catch ClassNotFoundException return null public static Class plainClassForName String name throws ClassNotFoundException try Class if externalClassLoader null externalClassLoader loadClass name else if bcm null bcm getPlainClassForName name else Class forName name cacheClassInfo name return catch NoClassDefFoundError throw new ClassNotFoundException toString public static void cacheClassInfo String name Class value if value null absoluteClassCache put name value else absoluteNonClasses put name NOVALUE protected void clearCaches absoluteNonClasses new Hashtable absoluteClassCache new Hashtable public static void addCMListener Listener if manager null manager addListener public static void setClassLoader ClassLoader externalCL externalClassLoader externalCL BshClassManager bcm getClassManager if bcm null bcm classLoaderChanged public static interface Listener public void classLoaderChanged public abstract Class getClassForName String name public abstract Class getPlainClassForName String name throws ClassNotFoundException public abstract ClassLoader getBaseLoader public abstract ClassLoader getLoaderForClass String name public abstract void addClassPath URL path throws IOException public abstract void reset public abstract void setClassPath URL cp public abstract void reloadAllClasses throws ClassPathException public abstract void reloadClasses String classNames throws ClassPathException public abstract void reloadPackage String pack throws ClassPathException public abstract void doSuperImport throws EvalError public abstract String getClassNameByUnqName String name throws ClassPathException public abstract void addListener Listener public abstract void removeListener Listener public abstract void dump PrintWriter pw protected abstract void classLoaderChanged public interface OptionPane String getName Component getComponent void init void save public final class REMatch implements Serializable Cloneable private String matchedText int offset int anchor public Object clone try REMatch copy REMatch super clone copy next null copy start int start clone copy end int end clone return copy catch CloneNotSupportedException void assignFrom REMatch other start other start end other end index other index next other next REMatch int subs int anchor int eflags start new int subs end new int subs this anchor anchor this eflags eflags clear anchor void finish CharIndexed text start StringBuffer sb new StringBuffer int for end sb append text charAt matchedText sb toString for start length if start end start end void clear int index offset index this index for int start length start end public String toString return matchedText public int getStartIndex return offset start public int getEndIndex return offset end public String toString int sub if sub start length start sub return return matchedText substring start sub end sub public int getSubStartIndex int sub if sub start length return int start sub return offset public int getStartIndex int sub if sub start length return int start sub return offset public int getSubEndIndex int sub if sub start length return int end sub return offset public int getEndIndex int sub if sub start length return int end sub return offset public String substituteInto String input StringBuffer output new StringBuffer int pos for pos pos input length pos if input charAt pos Character isDigit input charAt pos int val Character digit input charAt pos if val start length output append toString val else output append input charAt pos if pos input length output append input charAt pos return output toString public abstract class WorkRequest implements Runnable public void setAbortable boolean abortable Thread thread Thread currentThread if thread instanceof WorkThread WorkThread thread setAbortable abortable public void setStatus String status Thread thread Thread currentThread if thread instanceof WorkThread WorkThread thread setStatus status public void setProgressValue int value Thread thread Thread currentThread if thread instanceof WorkThread WorkThread thread setProgressValue value public void setProgressMaximum int value Thread thread Thread currentThread if thread instanceof WorkThread WorkThread thread setProgressMaximum value class InstallPluginsDialog extends EnhancedDialog static final int INSTALL static final int UPDATE InstallPluginsDialog JDialog dialog Vector model int mode super dialog mode INSTALL jEdit getProperty jEdit getProperty true JPanel content new JPanel new BorderLayout content setBorder new EmptyBorder setContentPane content JLabel label new JLabel jEdit getProperty content add BorderLayout NORTH label plugins new JCheckBoxList model plugins getSelectionModel addListSelectionListener new ListHandler plugins getModel addTableModelListener new TableModelHandler JScrollPane scroller new JScrollPane plugins scroller setPreferredSize new Dimension content add BorderLayout WEST scroller JPanel panel new JPanel new BorderLayout panel setBorder new TitledBorder jEdit getProperty JPanel labelAndValueBox new JPanel new BorderLayout JPanel labelBox new JPanel new GridLayout mode UPDATE labelBox setBorder new EmptyBorder labelBox add new JLabel jEdit getProperty SwingConstants RIGHT labelBox add new JLabel jEdit getProperty SwingConstants RIGHT labelBox add new JLabel jEdit getProperty SwingConstants RIGHT labelBox add new JLabel jEdit getProperty SwingConstants RIGHT if mode UPDATE labelBox add new JLabel jEdit getProperty SwingConstants RIGHT labelBox add new JLabel jEdit getProperty SwingConstants RIGHT labelBox add new JLabel jEdit getProperty SwingConstants RIGHT labelAndValueBox add BorderLayout WEST labelBox JPanel valueBox new JPanel new GridLayout mode UPDATE valueBox setBorder new EmptyBorder valueBox add name new JLabel valueBox add author new JLabel valueBox add size new JLabel valueBox add latestVersion new JLabel if mode UPDATE valueBox add installedVersion new JLabel valueBox add updated new JLabel valueBox add Box createGlue labelAndValueBox add BorderLayout CENTER valueBox panel add BorderLayout NORTH labelAndValueBox description new JTextArea description setEditable false description setLineWrap true description setWrapStyleWord true panel add BorderLayout CENTER new JScrollPane description content add BorderLayout CENTER panel panel new JPanel new BorderLayout JPanel panel2 new JPanel new GridLayout mode INSTALL Box totalSizeBox new Box BoxLayout X_AXIS totalSizeBox add new JLabel jEdit getProperty totalSizeBox add Box createHorizontalStrut totalSizeBox add totalSize new JLabel panel2 add totalSizeBox panel2 add downloadSource new JCheckBox jEdit getProperty downloadSource setSelected jEdit getBooleanProperty downloadSource addActionListener new ActionHandler if mode INSTALL ButtonGroup grp new ButtonGroup installUser new JRadioButton String settings jEdit getSettingsDirectory if settings null settings jEdit getProperty installUser setEnabled false else settings MiscUtilities constructPath settings installUser setEnabled true String args settings installUser setText jEdit getProperty args grp add installUser panel2 add installUser installSystem new JRadioButton String jEditHome jEdit getJEditHome if jEditHome null jEditHome jEdit getProperty installSystem setEnabled false else jEditHome MiscUtilities constructPath jEditHome installSystem setEnabled true args jEditHome installSystem setText jEdit getProperty args grp add installSystem panel2 add installSystem if installUser isEnabled installUser setSelected true else installSystem setSelected true panel add BorderLayout NORTH panel2 Box box new Box BoxLayout X_AXIS box add Box createGlue selectAll new JButton jEdit getProperty selectAll addActionListener new ActionHandler box add selectAll box add Box createHorizontalStrut install new JButton jEdit getProperty install setEnabled false getRootPane setDefaultButton install install addActionListener new ActionHandler box add install box add Box createHorizontalStrut cancel new JButton jEdit getProperty cancel addActionListener new ActionHandler box add cancel box add Box createHorizontalStrut box add Box createGlue panel add BorderLayout SOUTH box content add BorderLayout SOUTH panel updateTotalSize pack setLocationRelativeTo dialog show public void ok jEdit setBooleanProperty downloadSource isSelected dispose public void cancel cancelled true dispose void installPlugins Roster roster if cancelled return String installDirectory if installUser null installUser isSelected installDirectory MiscUtilities constructPath jEdit getSettingsDirectory else installDirectory MiscUtilities constructPath jEdit getJEditHome Object selected plugins getCheckedValues for int selected length PluginList Plugin plugin PluginList Plugin selected plugin install roster installDirectory downloadSource isSelected private JCheckBoxList plugins private JLabel name private JLabel author private JLabel size private JLabel latestVersion private JLabel installedVersion private JLabel updated private JTextArea description private JLabel totalSize private JCheckBox downloadSource private JRadioButton installUser private JRadioButton installSystem private JButton selectAll private JButton install private JButton cancel private boolean cancelled private Thread thread private void updateInfo Object selected plugins getSelectedValue if selected instanceof PluginList Plugin PluginList Plugin plugin PluginList Plugin selected PluginList Branch branch plugin getCompatibleBranch name setText plugin name author setText plugin author size setText String valueOf downloadSource isSelected branch downloadSourceSize branch downloadSize if branch obsolete latestVersion setText jEdit getProperty else latestVersion setText branch version if installedVersion null installedVersion setText plugin installedVersion updated setText branch date ArrayList deps new ArrayList createDependencyList branch deps deps StringBuffer buf new StringBuffer for int deps size buf append buf append deps get description setText plugin description buf length jEdit getProperty buf toString branch obsolete jEdit getProperty description setCaretPosition else name setText null author setText null size setText null latestVersion setText null if installedVersion null installedVersion setText null updated setText null description setText null private void createDependencyList Vector deps ArrayList append for int deps size PluginList Dependency dep PluginList Dependency deps elementAt if dep what equals dep isSatisfied if append contains dep plugin append add dep plugin PluginList Branch branch dep plugin getCompatibleBranch createDependencyList branch deps append private void updateTotalSize ArrayList selectedPlugins new ArrayList Object selected plugins getCheckedValues install setEnabled selected length for int selected length PluginList Plugin plugin PluginList Plugin selected if selectedPlugins contains plugin selectedPlugins add plugin createDependencyList plugin getCompatibleBranch deps selectedPlugins int for int selectedPlugins size PluginList Branch branch PluginList Plugin selectedPlugins get getCompatibleBranch downloadSource isSelected branch downloadSourceSize branch downloadSize totalSize setText String valueOf class ActionHandler implements ActionListener public void actionPerformed ActionEvent evt Object source evt getSource if source selectAll plugins selectAll if source install ok else if source cancel cancel else if source downloadSource updateInfo updateTotalSize class ListHandler implements ListSelectionListener public void valueChanged ListSelectionEvent evt updateInfo class TableModelHandler implements TableModelListener public void tableChanged TableModelEvent updateTotalSize public class DisplayTokenHandler extends DefaultTokenHandler public void init Segment seg SyntaxStyle styles FontRenderContext fontRenderContext TabExpander expander super init this seg seg this styles styles this fontRenderContext fontRenderContext this expander expander public void setMonospacedCharWidth float charWidth this charWidth charWidth public Chunk getChunks return Chunk firstToken protected Segment seg protected SyntaxStyle styles protected FontRenderContext fontRenderContext protected TabExpander expander protected float protected float charWidth protected Token createToken byte id int offset int length TokenMarker LineContext context if id Token END return null Chunk chunk new Chunk id offset length getParserRuleSet context chunk init seg expander styles fontRenderContext context rules getDefault charWidth chunk width return chunk public interface BrowserListener extends EventListener void filesSelected VFSBrowser browser VFS DirectoryEntry files void filesActivated VFSBrowser browser VFS DirectoryEntry files public class Primitive implements ParserConstants java io Serializable private Object value private static class Special implements java io Serializable private Special public static final Special NULL_VALUE new Special public static final Special VOID_TYPE new Special public static final Primitive NULL new Primitive Special NULL_VALUE public static final Primitive VOID new Primitive Special VOID_TYPE private Primitive Object value if value null throw new InterpreterError this value value public Primitive Number number this Object number public Primitive Boolean value this Object value public Primitive Byte value this Object value public Primitive Short value this Object value public Primitive Character value this Object value public Primitive Integer value this Object value public Primitive Long value this Object value public Primitive Float value this Object value public Primitive Double value this Object value public Primitive boolean value this new Boolean value public Primitive byte value this new Byte value public Primitive short value this new Short value public Primitive char value this new Character value public Primitive int value this new Integer value public Primitive long value this new Long value public Primitive float value this new Float value public Primitive double value this new Double value public Object getValue if value Special NULL_VALUE return null else if value Special VOID_TYPE throw new InterpreterError else return value public String toString if value Special NULL_VALUE return else if value Special VOID_TYPE return else return value toString public Class getType return getType value private Class getType Object if instanceof Boolean return Boolean TYPE else if instanceof Byte return Byte TYPE else if instanceof Short return Short TYPE else if instanceof Character return Character TYPE else if instanceof Integer return Integer TYPE else if instanceof Long return Long TYPE else if instanceof Float return Float TYPE else if instanceof Double return Double TYPE return null public static Object binaryOperation Object obj1 Object obj2 int kind throws EvalError if obj1 NULL obj2 NULL throw new EvalError if obj1 VOID obj2 VOID throw new EvalError Class lhsOrgType obj1 getClass Class rhsOrgType obj2 getClass if obj1 instanceof Primitive obj1 Primitive obj1 getValue if obj2 instanceof Primitive obj2 Primitive obj2 getValue Object operands promotePrimitives obj1 obj2 Object lhs operands Object rhs operands if lhs getClass rhs getClass throw new EvalError lhs getClass rhs getClass Object result try result binaryOperationImpl lhs rhs kind catch ArithmeticException throw new TargetError if lhsOrgType Primitive class rhsOrgType Primitive class return new Primitive result else return result static Object binaryOperationImpl Object lhs Object rhs int kind throws EvalError if lhs instanceof Boolean return booleanBinaryOperation Boolean lhs Boolean rhs kind else if lhs instanceof Integer return intBinaryOperation Integer lhs Integer rhs kind else if lhs instanceof Long return longBinaryOperation Long lhs Long rhs kind else if lhs instanceof Float return floatBinaryOperation Float lhs Float rhs kind else if lhs instanceof Double return doubleBinaryOperation Double lhs Double rhs kind else throw new EvalError static Boolean booleanBinaryOperation Boolean B1 Boolean B2 int kind throws EvalError boolean lhs B1 booleanValue boolean rhs B2 booleanValue switch kind case EQ return new Boolean lhs rhs case NE return new Boolean lhs rhs case BOOL_OR case BOOL_ORX return new Boolean lhs rhs case BOOL_AND case BOOL_ANDX return new Boolean lhs rhs default throw new InterpreterError static Object longBinaryOperation Long L1 Long L2 int kind long lhs L1 longValue long rhs L2 longValue switch kind case LT case LTX return new Boolean lhs rhs case GT case GTX return new Boolean lhs rhs case EQ return new Boolean lhs rhs case LE case LEX return new Boolean lhs rhs case GE case GEX return new Boolean lhs rhs case NE return new Boolean lhs rhs case PLUS return new Long lhs rhs case MINUS return new Long lhs rhs case STAR return new Long lhs rhs case SLASH return new Long lhs rhs case MOD return new Long lhs rhs case LSHIFT case LSHIFTX return new Long lhs rhs case RSIGNEDSHIFT case RSIGNEDSHIFTX return new Long lhs rhs case RUNSIGNEDSHIFT case RUNSIGNEDSHIFTX return new Long lhs rhs case BIT_AND case BIT_ANDX return new Long lhs rhs case BIT_OR case BIT_ORX return new Long lhs rhs case XOR return new Long lhs rhs default throw new InterpreterError static Object intBinaryOperation Integer I1 Integer I2 int kind int lhs I1 intValue int rhs I2 intValue switch kind case LT case LTX return new Boolean lhs rhs case GT case GTX return new Boolean lhs rhs case EQ return new Boolean lhs rhs case LE case LEX return new Boolean lhs rhs case GE case GEX return new Boolean lhs rhs case NE return new Boolean lhs rhs case PLUS return new Integer lhs rhs case MINUS return new Integer lhs rhs case STAR return new Integer lhs rhs case SLASH return new Integer lhs rhs case MOD return new Integer lhs rhs case LSHIFT case LSHIFTX return new Integer lhs rhs case RSIGNEDSHIFT case RSIGNEDSHIFTX return new Integer lhs rhs case RUNSIGNEDSHIFT case RUNSIGNEDSHIFTX return new Integer lhs rhs case BIT_AND case BIT_ANDX return new Integer lhs rhs case BIT_OR case BIT_ORX return new Integer lhs rhs case XOR return new Integer lhs rhs default throw new InterpreterError static Object doubleBinaryOperation Double D1 Double D2 int kind throws EvalError double lhs D1 doubleValue double rhs D2 doubleValue switch kind case LT case LTX return new Boolean lhs rhs case GT case GTX return new Boolean lhs rhs case EQ return new Boolean lhs rhs case LE case LEX return new Boolean lhs rhs case GE case GEX return new Boolean lhs rhs case NE return new Boolean lhs rhs case PLUS return new Double lhs rhs case MINUS return new Double lhs rhs case STAR return new Double lhs rhs case SLASH return new Double lhs rhs case MOD return new Double lhs rhs case LSHIFT case LSHIFTX case RSIGNEDSHIFT case RSIGNEDSHIFTX case RUNSIGNEDSHIFT case RUNSIGNEDSHIFTX throw new EvalError default throw new InterpreterError static Object floatBinaryOperation Float F1 Float F2 int kind throws EvalError float lhs F1 floatValue float rhs F2 floatValue switch kind case LT case LTX return new Boolean lhs rhs case GT case GTX return new Boolean lhs rhs case EQ return new Boolean lhs rhs case LE case LEX return new Boolean lhs rhs case GE case GEX return new Boolean lhs rhs case NE return new Boolean lhs rhs case PLUS return new Float lhs rhs case MINUS return new Float lhs rhs case STAR return new Float lhs rhs case SLASH return new Float lhs rhs case MOD return new Float lhs rhs case LSHIFT case LSHIFTX case RSIGNEDSHIFT case RSIGNEDSHIFTX case RUNSIGNEDSHIFT case RUNSIGNEDSHIFTX throw new EvalError default throw new InterpreterError static Object promoteToInteger Object primitive if primitive instanceof Character return new Integer Character primitive charValue else if primitive instanceof Byte primitive instanceof Short return new Integer Number primitive intValue return primitive static Object promotePrimitives Object lhs Object rhs lhs promoteToInteger lhs rhs promoteToInteger rhs if lhs instanceof Number rhs instanceof Number Number lnum Number lhs Number rnum Number rhs boolean if lnum instanceof Double rnum instanceof Double if rhs new Double rnum doubleValue else lhs new Double lnum doubleValue else if lnum instanceof Float rnum instanceof Float if rhs new Float rnum floatValue else lhs new Float lnum floatValue else if lnum instanceof Long rnum instanceof Long if rhs new Long rnum longValue else lhs new Long lnum longValue return new Object lhs rhs public static Primitive unaryOperation Primitive val int kind throws EvalError if val NULL throw new EvalError if val VOID throw new EvalError Class operandType val getType Object operand promoteToInteger val getValue if operand instanceof Boolean return new Primitive booleanUnaryOperation Boolean operand kind else if operand instanceof Integer int result intUnaryOperation Integer operand kind if kind INCR kind DECR if operandType Byte TYPE return new Primitive byte result if operandType Short TYPE return new Primitive short result if operandType Character TYPE return new Primitive char result return new Primitive result else if operand instanceof Long return new Primitive longUnaryOperation Long operand kind else if operand instanceof Float return new Primitive floatUnaryOperation Float operand kind else if operand instanceof Double return new Primitive doubleUnaryOperation Double operand kind else throw new InterpreterError static boolean booleanUnaryOperation Boolean int kind throws EvalError boolean operand booleanValue switch kind case BANG return operand default throw new EvalError static int intUnaryOperation Integer int kind int operand intValue switch kind case PLUS return operand case MINUS return operand case TILDE return operand case INCR return operand case DECR return operand default throw new InterpreterError static long longUnaryOperation Long int kind long operand longValue switch kind case PLUS return operand case MINUS return operand case TILDE return operand case INCR return operand case DECR return operand default throw new InterpreterError static float floatUnaryOperation Float int kind float operand floatValue switch kind case PLUS return operand case MINUS return operand default throw new InterpreterError static double doubleUnaryOperation Double int kind double operand doubleValue switch kind case PLUS return operand case MINUS return operand default throw new InterpreterError public int intValue throws EvalError if value instanceof Number return Number value intValue else throw new EvalError public boolean booleanValue throws EvalError if value instanceof Boolean return Boolean value booleanValue else throw new EvalError public boolean isNumber return value instanceof Boolean this NULL this VOID public Number numberValue throws EvalError Object value this value if value instanceof Character value new Integer Character value charValue if value instanceof Number return Number value else throw new EvalError public boolean equals Object obj if obj instanceof Primitive return Primitive obj value equals this value else return obj equals this value public static Object unwrap Object obj if obj null return null if obj Primitive VOID return null if obj instanceof Primitive return Primitive obj getValue else return obj class Reflect public static Object invokeObjectMethod Interpreter interpreter Object object String methodName Object args SimpleNode callerInfo throws ReflectError InvocationTargetException EvalError if object instanceof This showThisMethod methodName return This object invokeMethod methodName args interpreter null callerInfo else return invokeMethod object getClass object methodName args false private static boolean showThisMethod String name return name equals name equals public static Object invokeStaticMethod Class clas String methodName Object args throws ReflectError InvocationTargetException EvalError Interpreter debug return invokeMethod clas null methodName args true public static Object getIndex Object array int index throws ReflectError TargetError if Interpreter DEBUG Interpreter debug array index try Object val Array get array index return wrapPrimitive val array getClass getComponentType catch ArrayIndexOutOfBoundsException e1 throw new TargetError e1 catch Exception throw new ReflectError public static void setIndex Object array int index Object val throws ReflectError TargetError try val unwrapPrimitive val Array set array index val catch ArrayStoreException e2 throw new TargetError e2 catch IllegalArgumentException e1 throw new TargetError new ArrayStoreException e1 toString catch Exception throw new ReflectError public static Object getStaticField Class clas String fieldName throws ReflectError return getFieldValue clas null fieldName public static Object getObjectField Object object String fieldName throws ReflectError if object instanceof This return This object namespace getVariable fieldName else try return getFieldValue object getClass object fieldName catch ReflectError if hasObjectPropertyGetter object getClass fieldName return getObjectProperty object fieldName else throw static LHS getLHSStaticField Class clas String fieldName throws ReflectError Field getField clas fieldName return new LHS static LHS getLHSObjectField Object object String fieldName throws ReflectError if object instanceof This return new LHS This object namespace fieldName try Field getField object getClass fieldName return new LHS object catch ReflectError if hasObjectPropertySetter object getClass fieldName return new LHS object fieldName else throw private static Object getFieldValue Class clas Object object String fieldName throws ReflectError try Field getField clas fieldName if null throw new ReflectError fieldName Object value get object Class returnType getType return wrapPrimitive value returnType catch NullPointerException throw new ReflectError fieldName catch IllegalAccessException throw new ReflectError fieldName private static Field getField Class clas String fieldName throws ReflectError try if Capabilities haveAccessibility return findAccessibleField clas fieldName else return clas getField fieldName catch NoSuchFieldException throw new ReflectError fieldName private static Field findAccessibleField Class clas String fieldName throws NoSuchFieldException try return clas getField fieldName catch NoSuchFieldException while clas null try Field field clas getDeclaredField fieldName if ReflectManager RMSetAccessible field return field catch NoSuchFieldException clas clas getSuperclass throw new NoSuchFieldException fieldName private static Object invokeMethod Class clas Object object String name Object args boolean onlyStatic throws ReflectError InvocationTargetException EvalError if object Primitive NULL throw new TargetError name new NullPointerException if object Primitive VOID throw new EvalError name if args null args new Object for int args length if args Primitive VOID throw new ReflectError name Class returnType null Object returnValue null Class types getTypes args unwrapPrimitives args try Method null try findAccessibleMethod clas name types onlyStatic catch SecurityException if null if Interpreter DEBUG Interpreter debug StringUtil methodString name types clas getName if null if types length throw new ReflectError onlyStatic StringUtil methodString name types clas getName Method methods clas getMethods if onlyStatic methods retainStaticMethods methods findMostSpecificMethod name types methods methods clas getMethods if null findExtendedMethod name args methods if null try findAccessibleMethod clas getName getParameterTypes onlyStatic catch SecurityException if null throw new ReflectError onlyStatic StringUtil methodString name types clas getName returnValue invoke object args if returnValue null returnValue Primitive NULL returnType getReturnType catch IllegalAccessException throw new ReflectError StringUtil methodString name types clas getName return wrapPrimitive returnValue returnType private static Method retainStaticMethods Method methods Vector new Vector for int methods length if Modifier isStatic methods getModifiers addElement methods Method ma new Method size copyInto ma return ma static Method findAccessibleMethod Class clas String name Class types boolean onlyStatic Method meth null Vector classQ new Vector classQ addElement clas Method found null while classQ size Class Class classQ firstElement classQ removeElementAt if Modifier isPublic getModifiers Capabilities haveAccessibility try meth getDeclaredMethod name types if Modifier isPublic meth getModifiers Modifier isPublic getModifiers Capabilities haveAccessibility ReflectManager RMSetAccessible meth break catch NoSuchMethodException if isInterface Class superclass getSuperclass if superclass null classQ addElement Object superclass Class intfs getInterfaces for int intfs length classQ addElement Object intfs if found null onlyStatic Modifier isStatic found getModifiers return found return null private static Object wrapPrimitive Object value Class returnType throws ReflectError if value null return Primitive NULL if returnType Void TYPE return Primitive VOID else if returnType isPrimitive if value instanceof Number return new Primitive Number value if value instanceof Boolean return new Primitive Boolean value if value instanceof Character return new Primitive Character value throw new ReflectError else return value public static Class getTypes Object args if args null return new Class Class types new Class args length for int args length if args null throw new InterpreterError if args instanceof Primitive types Primitive args getType else types args getClass return types private static void unwrapPrimitives Object args for int args length args unwrapPrimitive args private static Object unwrapPrimitive Object arg if arg instanceof Primitive return Primitive arg getValue else return arg static Object constructObject String clas Object args throws ReflectError InvocationTargetException Class BshClassManager classForName clas if null throw new ReflectError clas return constructObject args static Object constructObject Class clas Object args throws ReflectError InvocationTargetException for int args length if args Primitive VOID throw new ReflectError clas if clas isInterface throw new ReflectError clas Object obj null Class types getTypes args unwrapPrimitives args Constructor con null Constructor constructors clas getDeclaredConstructors if Interpreter DEBUG Interpreter debug clas con findMostSpecificConstructor types constructors if con null if types length throw new ReflectError clas else con findExtendedConstructor args constructors if con null throw new ReflectError clas try obj con newInstance args catch InstantiationException throw new ReflectError catch IllegalAccessException throw new ReflectError catch IllegalArgumentException throw new ReflectError if obj null throw new ReflectError return obj static Method findMostSpecificMethod String name Class idealMatch Method methods Vector sigs new Vector Vector meths new Vector for int methods length if methods getName equals name meths addElement methods sigs addElement methods getParameterTypes Class candidates new Class sigs size sigs copyInto candidates if Interpreter DEBUG Interpreter debug name int match findMostSpecificSignature idealMatch candidates if match return null else return Method meths elementAt match static Method findExtendedMethod String name Object args Method methods Method bestMatch null Object tempArgs new Object args length for int methods length Method currentMethod methods if name equals currentMethod getName Class parameters currentMethod getParameterTypes if parameters length args length continue try for int parameters length tempArgs NameSpace getAssignableForm args parameters System arraycopy tempArgs args args length return currentMethod catch EvalError return null static Constructor findMostSpecificConstructor Class idealMatch Constructor constructors Class candidates new Class constructors length for int candidates length candidates constructors getParameterTypes int match findMostSpecificSignature idealMatch candidates if match return null else return constructors match static Constructor findExtendedConstructor Object args Constructor constructors Constructor bestMatch null Object tempArgs new Object args length for int constructors length Constructor currentConstructor constructors Class parameters currentConstructor getParameterTypes if parameters length args length continue try for int parameters length tempArgs NameSpace getAssignableForm args parameters System arraycopy tempArgs args args length return currentConstructor catch EvalError return null static int findMostSpecificSignature Class idealMatch Class candidates Class bestMatch null int bestMatchIndex for int candidates length Class targetMatch candidates if isAssignable idealMatch targetMatch bestMatch null isAssignable targetMatch bestMatch bestMatch targetMatch bestMatchIndex if bestMatch null return bestMatchIndex else Interpreter debug return static boolean isAssignable Class from Class to if from null from new Class if to null to new Class if from length to length return false for int from length if to null continue if from null if to isPrimitive continue else return false if isAssignableFrom to from return false return true static boolean isAssignableFrom Class lhs Class rhs if lhs isPrimitive rhs isPrimitive if lhs rhs return true if rhs Byte TYPE lhs Short TYPE lhs Integer TYPE lhs Long TYPE lhs Float TYPE lhs Double TYPE return true if rhs Short TYPE lhs Integer TYPE lhs Long TYPE lhs Float TYPE lhs Double TYPE return true if rhs Character TYPE lhs Integer TYPE lhs Long TYPE lhs Float TYPE lhs Double TYPE return true if rhs Integer TYPE lhs Long TYPE lhs Float TYPE lhs Double TYPE return true if rhs Long TYPE lhs Float TYPE lhs Double TYPE return true if rhs Float TYPE lhs Double TYPE return true else if lhs isAssignableFrom rhs return true return false private static String accessorName String getorset String propName return getorset String valueOf Character toUpperCase propName charAt propName substring public static boolean hasObjectPropertyGetter Class clas String propName String getterName accessorName propName try clas getMethod getterName new Class return true catch NoSuchMethodException return false public static boolean hasObjectPropertySetter Class clas String propName String setterName accessorName propName Class sig new Class clas Method methods clas getMethods for int methods length if methods getName equals setterName return true return false public static Object getObjectProperty Object obj String propName throws ReflectError String accessorName accessorName propName Object args new Object Interpreter debug try try return invokeObjectMethod null obj accessorName args null catch EvalError throw new ReflectError catch InvocationTargetException throw new ReflectError public static void setObjectProperty Object obj String propName Object value throws ReflectError EvalError String accessorName accessorName propName Object args new Object value Interpreter debug try invokeObjectMethod null obj accessorName args null catch InvocationTargetException throw new EvalError public static String normalizeClassName Class type if type isArray return type getName StringBuffer className new StringBuffer try className append getArrayBaseType type getName for int getArrayDimensions type className append catch Exception return className toString public static int getArrayDimensions Class arrayClass if arrayClass isArray return return arrayClass getName lastIndexOf public static Class getArrayBaseType Class arrayClass throws ReflectError if arrayClass isArray throw new ReflectError return arrayClass getComponentType public class ContentManager public ContentManager text new char public final int getLength return length public String getText int start int len if start gapStart return new String text start gapEnd gapStart len else if start len gapStart return new String text start len else return new String text start gapStart start concat new String text gapEnd start len gapStart public void getText int start int len Segment seg if start gapStart seg array text seg offset start gapEnd gapStart seg count len else if start len gapStart seg array text seg offset start seg count len else seg array new char len System arraycopy text start seg array gapStart start System arraycopy text gapEnd seg array gapStart start len start gapStart seg offset seg count len public void insert int start String str int len str length moveGapStart start if gapEnd gapStart len ensureCapacity length len moveGapEnd start len str getChars len text start gapStart len length len public void insert int start Segment seg moveGapStart start if gapEnd gapStart seg count ensureCapacity length seg count moveGapEnd start seg count System arraycopy seg array seg offset text start seg count gapStart seg count length seg count public void char text int length this text text this gapStart this gapEnd this length length public void remove int start int len moveGapStart start gapEnd len length len private char text private int gapStart private int gapEnd private int length private void moveGapStart int newStart int newEnd gapEnd newStart gapStart if newStart gapStart else if newStart gapStart System arraycopy text gapEnd text gapStart newStart gapStart else if newStart gapStart System arraycopy text newStart text newEnd gapStart newStart gapStart newStart gapEnd newEnd private void moveGapEnd int newEnd System arraycopy text gapEnd text newEnd length gapStart gapEnd newEnd private void ensureCapacity int capacity if capacity text length char textN new char capacity System arraycopy text textN length gapEnd gapStart text textN public class WorkThreadPool public WorkThreadPool String name int count listenerList new EventListenerList if count threadGroup new ThreadGroup name threads new WorkThread count for int threads length threads new WorkThread this threadGroup name else Log log Log WARNING this public void start synchronized lock started true if awtRequestCount requestCount queueAWTRunner if threads null for int threads length threads start public void addWorkRequest Runnable run boolean inAWT if threads null run run return synchronized lock if started inAWT requestCount awtRequestCount if SwingUtilities isEventDispatchThread run run else SwingUtilities invokeLater run return Request request new Request run if inAWT if firstAWTRequest null lastAWTRequest null firstAWTRequest lastAWTRequest request else lastAWTRequest next request lastAWTRequest request awtRequestCount if started requestCount queueAWTRunner else if firstRequest null lastRequest null firstRequest lastRequest request else lastRequest next request lastRequest request requestCount lock notify public void waitForRequests if threads null return synchronized waitForAllLock while requestCount try waitForAllLock wait catch InterruptedException ie Log log Log ERROR this ie if SwingUtilities isEventDispatchThread doAWTRequests else try SwingUtilities invokeAndWait new RunRequestsInAWTThread catch Exception Log log Log ERROR this public int getRequestCount return requestCount public int getThreadCount if threads null return else return threads length public WorkThread getThread int index return threads index public void addProgressListener WorkThreadProgressListener listener listenerList add WorkThreadProgressListener class listener public void removeProgressListener WorkThreadProgressListener listener listenerList remove WorkThreadProgressListener class listener Object lock new String Object waitForAllLock new String void fireStatusChanged WorkThread thread final Object listeners listenerList getListenerList if listeners length int index for int threads length if threads thread index break for int listeners length if listeners WorkThreadProgressListener class WorkThreadProgressListener listeners statusUpdate WorkThreadPool this index void fireProgressChanged WorkThread thread final Object listeners listenerList getListenerList if listeners length int index for int threads length if threads thread index break for int listeners length if listeners WorkThreadProgressListener class WorkThreadProgressListener listeners progressUpdate WorkThreadPool this index void requestDone synchronized lock requestCount if requestCount firstAWTRequest null queueAWTRunner Request getNextRequest synchronized lock Request request firstRequest if request null return null firstRequest firstRequest next if firstRequest null lastRequest null if request alreadyRun throw new InternalError request run request alreadyRun true return request private boolean started private ThreadGroup threadGroup private WorkThread threads private Request firstRequest private Request lastRequest private int requestCount private boolean awtRunnerQueued private Request firstAWTRequest private Request lastAWTRequest private int awtRequestCount private EventListenerList listenerList private void doAWTRequests while firstAWTRequest null doAWTRequest getNextAWTRequest private void doAWTRequest Request request try request run run catch Throwable Log log Log ERROR WorkThread class Log log Log ERROR WorkThread class awtRequestCount private void queueAWTRunner if awtRunnerQueued awtRunnerQueued true SwingUtilities invokeLater new RunRequestsInAWTThread private Request getNextAWTRequest Request request firstAWTRequest firstAWTRequest firstAWTRequest next if firstAWTRequest null lastAWTRequest null if request alreadyRun throw new InternalError request run request alreadyRun true return request static int ID static class Request int id ID Runnable run boolean alreadyRun Request next Request Runnable run this run run public String toString return id run class RunRequestsInAWTThread implements Runnable public void run synchronized lock awtRunnerQueued false if requestCount doAWTRequests class Autosave implements ActionListener public static void setInterval int interval if interval if timer null timer stop timer null return interval if timer null timer new Timer interval new Autosave timer start else timer setDelay interval public static void stop if timer null timer stop public void actionPerformed ActionEvent evt if jEdit getFirstView null jEdit saveOpenFiles jEdit getFirstView Buffer bufferArray jEdit getBuffers for int bufferArray length bufferArray autosave private static Timer timer private Autosave public class CompleteWord extends JWindow public static void completeWord View view JEditTextArea textArea view getTextArea Buffer buffer view getBuffer int caretLine textArea getCaretLine int caret textArea getCaretPosition if buffer isEditable textArea getToolkit beep return KeywordMap keywordMap buffer getKeywordMapAtOffset caret String noWordSep getNonAlphaNumericWordChars buffer keywordMap caret String word getWordToComplete buffer caretLine caret noWordSep if word null textArea getToolkit beep return Vector completions getCompletions buffer word keywordMap noWordSep caret if completions size completions size Completion completions get text equals word textArea getToolkit beep else if completions size textArea setSelectedText completions elementAt toString substring word length else textArea scrollToCaret false Point location textArea offsetToXY caret word length location textArea getPainter getFontMetrics getHeight SwingUtilities convertPointToScreen location textArea getPainter new CompleteWord view word completions location noWordSep public CompleteWord View view String word Vector completions Point location String noWordSep super view this noWordSep noWordSep setContentPane new JPanel new BorderLayout public boolean isManagingFocus return false public boolean getFocusTraversalKeysEnabled return false this view view this textArea view getTextArea this buffer view getBuffer this word word words new JList completions words setFont UIManager getFont words setVisibleRowCount Math min completions size words addMouseListener new MouseHandler words setSelectedIndex words setSelectionMode ListSelectionModel SINGLE_SELECTION words setCellRenderer new Renderer JScrollPane scroller new JScrollPane words JScrollPane VERTICAL_SCROLLBAR_ALWAYS JScrollPane HORIZONTAL_SCROLLBAR_NEVER getContentPane add scroller BorderLayout CENTER GUIUtilities requestFocus this words pack setLocation location show KeyHandler keyHandler new KeyHandler addKeyListener keyHandler words addKeyListener keyHandler view setKeyEventInterceptor keyHandler public void dispose view setKeyEventInterceptor null super dispose SwingUtilities invokeLater new Runnable public void run textArea requestFocus private static String getNonAlphaNumericWordChars Buffer buffer KeywordMap keywordMap int caret String noWordSep buffer getStringProperty if noWordSep null noWordSep if keywordMap null String keywordNoWordSep keywordMap getNonAlphaNumericChars if keywordNoWordSep null noWordSep noWordSep keywordNoWordSep return noWordSep private static String getWordToComplete Buffer buffer int caretLine int caret String noWordSep String line buffer getLineText caretLine int dot caret buffer getLineStartOffset caretLine if dot return null char ch line charAt dot if Character isLetterOrDigit ch noWordSep indexOf ch return null int wordStart TextUtilities findWordStart line dot noWordSep String word line substring wordStart dot if word length return null return word private static Vector getCompletions Buffer buffer String word KeywordMap keywordMap String noWordSep int caret Vector completions new Vector int wordLen word length if keywordMap null String keywords keywordMap getKeywords for int keywords length String keywords if regionMatches keywordMap getIgnoreCase word wordLen Completion keyword new Completion true if completions indexOf keyword completions addElement keyword for int buffer getLineCount String line buffer getLineText int start buffer getLineStartOffset if line startsWith word caret start word length String completeWord line noWordSep Completion comp new Completion false if completions indexOf comp completions addElement comp int len line length word length for int len char line charAt if Character isLetterOrDigit noWordSep indexOf if line regionMatches word wordLen caret start word length String completeWord line noWordSep Completion comp new Completion false if completions indexOf comp completions addElement comp MiscUtilities quicksort completions new MiscUtilities StringICaseCompare return completions private static String completeWord String line int offset String noWordSep int wordEnd TextUtilities findWordEnd line offset noWordSep return line substring offset wordEnd private View view private JEditTextArea textArea private Buffer buffer private String word private JList words private String noWordSep private void insertSelected textArea setSelectedText words getSelectedValue toString substring word length dispose static class Completion String text boolean keyword Completion String text boolean keyword this text text this keyword keyword public String toString return text public boolean equals Object obj if obj instanceof Completion return Completion obj text equals text else return false static class Renderer extends DefaultListCellRenderer public Component getListCellRendererComponent JList list Object value int index boolean isSelected boolean cellHasFocus super getListCellRendererComponent list value index isSelected cellHasFocus Completion comp Completion value if comp keyword setFont list getFont deriveFont Font BOLD else setFont list getFont return this class KeyHandler extends KeyAdapter public void keyPressed KeyEvent evt switch evt getKeyCode case KeyEvent VK_TAB case KeyEvent VK_ENTER insertSelected evt consume break case KeyEvent VK_ESCAPE dispose evt consume break case KeyEvent VK_UP int selected words getSelectedIndex if selected selected words getModel getSize else if getFocusOwner words return else selected selected words setSelectedIndex selected words ensureIndexIsVisible selected evt consume break case KeyEvent VK_DOWN if selected words getModel getSize selected else if getFocusOwner words return else selected selected words setSelectedIndex selected words ensureIndexIsVisible selected evt consume break case KeyEvent VK_BACK_SPACE if word length textArea backspace evt consume dispose else word word substring word length textArea backspace int caret textArea getCaretPosition KeywordMap keywordMap buffer getKeywordMapAtOffset caret Vector completions getCompletions buffer word keywordMap noWordSep caret if completions size dispose words setListData completions words setSelectedIndex words setVisibleRowCount Math min completions size pack evt consume break default if evt isActionKey dispose view processKeyEvent evt break public void keyTyped KeyEvent evt char ch evt getKeyChar evt KeyEventWorkaround processKeyEvent evt if evt null return else if ch textArea userInput ch if Character isLetterOrDigit ch noWordSep indexOf ch dispose return word word ch int caret textArea getCaretPosition KeywordMap keywordMap buffer getKeywordMapAtOffset caret Vector completions getCompletions buffer word keywordMap noWordSep caret if completions size dispose return words setListData completions words setSelectedIndex class MouseHandler extends MouseAdapter public void mouseClicked MouseEvent evt insertSelected public class ClassPathException extends EvalError public ClassPathException String msg super msg class BSHThrowStatement extends SimpleNode BSHThrowStatement int id super id public Object eval CallStack callstack Interpreter interpreter throws EvalError Object obj SimpleNode jjtGetChild eval callstack interpreter if obj instanceof Exception throw new EvalError this throw new TargetError Exception obj this class BSHCastExpression extends SimpleNode public BSHCastExpression int id super id public Object eval CallStack callstack Interpreter interpreter throws EvalError NameSpace namespace callstack top Class toType BSHType jjtGetChild getType namespace SimpleNode expression SimpleNode jjtGetChild Object fromValue expression eval callstack interpreter Class fromType fromValue getClass try return castObject fromValue toType catch EvalError reThrow this public static Object castObject Object fromValue Class toType throws EvalError Class fromType fromValue getClass Object result null if toType isPrimitive if fromValue instanceof Primitive result castPrimitive Primitive fromValue toType else castError fromValue getClass toType else if fromValue instanceof Primitive result castPrimitive Primitive fromValue toType else if Capabilities canGenerateInterfaces fromValue instanceof bsh This toType isInterface result bsh This fromValue getInterface toType else if toType isInstance fromValue result fromValue else castError fromType toType if result null throw new InternalError return result public static void castError Class from Class to throws EvalError castError Reflect normalizeClassName from Reflect normalizeClassName to public static void castError String from String to throws EvalError Exception cce new ClassCastException from to throw new TargetError cce public static Primitive castPrimitive Primitive primValue Class toType throws EvalError if primValue Primitive VOID castError Reflect normalizeClassName toType Object value primValue getValue Class fromType primValue getType if toType isPrimitive if primValue Primitive NULL castError toType else return primValue if fromType Boolean TYPE if toType Boolean TYPE castError fromType toType else return primValue if value instanceof Character value new Integer Character value charValue if value instanceof Number Number number Number value if toType Byte TYPE value new Primitive number byteValue else if toType Short TYPE value new Primitive number shortValue else if toType Character TYPE value new Primitive char number intValue else if toType Integer TYPE value new Primitive number intValue else if toType Long TYPE value new Primitive number longValue else if toType Float TYPE value new Primitive number floatValue else if toType Double TYPE value new Primitive number doubleValue else castError fromType toType return Primitive value throw new EvalError public class HandlerBase implements XmlHandler public void startDocument throws java lang Exception public void endDocument throws java lang Exception public Object resolveEntity String publicId String systemId throws java lang Exception return null public void startExternalEntity String systemId throws java lang Exception public void endExternalEntity String systemId throws java lang Exception public void doctypeDecl String name String publicId String systemId throws java lang Exception public void attribute String aname String value boolean isSpecified throws java lang Exception public void startElement String elname throws java lang Exception public void endElement String elname throws java lang Exception public void charData char ch int start int length throws java lang Exception public void ignorableWhitespace char ch int start int length throws java lang Exception public void processingInstruction String target String data throws java lang Exception public void error String message String systemId int line int column throws XmlException java lang Exception throw new XmlException message systemId line column public class ViewUpdate extends EBMessage public static final Object CREATED public static final Object CLOSED public static final Object EDIT_PANE_CHANGED public ViewUpdate View view Object what super view if what null throw new NullPointerException this what what public Object getWhat return what public View getView return View getSource public String paramString return what super paramString private Object what public class TipOfTheDay extends EnhancedDialog public TipOfTheDay View view super view jEdit getProperty false JPanel content new JPanel new BorderLayout content setBorder new EmptyBorder setContentPane content JLabel label new JLabel jEdit getProperty label setFont new Font Font PLAIN label setForeground UIManager getColor content add BorderLayout NORTH label tipText new JEditorPane tipText setEditable false tipText setContentType nextTip JScrollPane scroller new JScrollPane tipText scroller setPreferredSize new Dimension content add BorderLayout CENTER scroller ActionHandler actionHandler new ActionHandler Box buttons new Box BoxLayout X_AXIS showNextTime new JCheckBox jEdit getProperty jEdit getBooleanProperty showNextTime addActionListener actionHandler buttons add showNextTime buttons add Box createHorizontalStrut buttons add Box createGlue nextTip new JButton jEdit getProperty nextTip addActionListener actionHandler buttons add nextTip buttons add Box createHorizontalStrut close new JButton jEdit getProperty close addActionListener actionHandler buttons add close content getRootPane setDefaultButton close Dimension dim nextTip getPreferredSize dim width Math max dim width close getPreferredSize width nextTip setPreferredSize dim close setPreferredSize dim content add BorderLayout SOUTH buttons setDefaultCloseOperation DISPOSE_ON_CLOSE pack setLocationRelativeTo view show public void ok dispose public void cancel dispose private JCheckBox showNextTime private JButton nextTip close private JEditorPane tipText private int currentTip private void nextTip File tips new File MiscUtilities constructPath jEdit getJEditHome listFiles if tips null tips length tipText setText jEdit getProperty return int count tips length int tipToShow currentTip while tipToShow currentTip tips tipToShow getName endsWith tipToShow Math abs new Random nextInt count try tipText setPage tips tipToShow toURL catch Exception Log log Log ERROR this class ActionHandler implements ActionListener public void actionPerformed ActionEvent evt Object source evt getSource if source showNextTime jEdit setBooleanProperty showNextTime isSelected else if source nextTip nextTip else if source close dispose public class OperatingSystem public static final Rectangle getScreenBounds int screenX int Toolkit getDefaultToolkit getScreenSize getWidth int screenY int Toolkit getDefaultToolkit getScreenSize getHeight int if isMacOS screenX else if isWindows screenX screenY else screenX screenY return new Rectangle public static final boolean isDOSDerived return isWindows isOS2 public static final boolean isWindows return os WINDOWS_9x os WINDOWS_NT public static final boolean isWindows9x return os WINDOWS_9x public static final boolean isWindowsNT return os WINDOWS_NT public static final boolean isOS2 return os OS2 public static final boolean isUnix return os UNIX os MAC_OS_X public static final boolean isMacOS return os MAC_OS_X public static final boolean isMacOSLF return isMacOS UIManager getLookAndFeel isNativeLookAndFeel public static final boolean hasJava14 return java14 private static final int UNIX private static final int WINDOWS_9x private static final int WINDOWS_NT private static final int OS2 private static final int MAC_OS_X private static final int UNKNOWN private static int os private static boolean java14 static if System getProperty null os MAC_OS_X else String osName System getProperty if osName indexOf osName indexOf os WINDOWS_9x else if osName indexOf os WINDOWS_NT else if osName indexOf os OS2 else if File separatorChar os UNIX else os UNKNOWN Log log Log WARNING OperatingSystem class osName if System getProperty compareTo System getProperty null java14 true class BSHUnaryExpression extends SimpleNode implements ParserConstants public int kind public boolean postfix false BSHUnaryExpression int id super id public Object eval CallStack callstack Interpreter interpreter throws EvalError SimpleNode node SimpleNode jjtGetChild if node instanceof BSHLHSPrimaryExpression return lhsUnaryOperation BSHLHSPrimaryExpression node toLHS callstack interpreter else return unaryOperation node eval callstack interpreter kind private Object lhsUnaryOperation LHS lhs throws EvalError if Interpreter DEBUG Interpreter debug Object prevalue postvalue prevalue lhs getValue postvalue unaryOperation prevalue kind Object retVal if postfix retVal prevalue else retVal postvalue lhs assign postvalue return retVal private Object unaryOperation Object op int kind throws EvalError if op instanceof Boolean op instanceof Character op instanceof Number return primitiveWrapperUnaryOperation op kind if op instanceof Primitive throw new EvalError tokenImage kind this return Primitive unaryOperation Primitive op kind private Object primitiveWrapperUnaryOperation Object val int kind throws EvalError Class operandType val getClass Object operand Primitive promoteToInteger val if operand instanceof Boolean return new Boolean Primitive booleanUnaryOperation Boolean operand kind else if operand instanceof Integer int result Primitive intUnaryOperation Integer operand kind if kind INCR kind DECR if operandType Byte TYPE return new Byte byte result if operandType Short TYPE return new Short short result if operandType Character TYPE return new Character char result return new Integer result else if operand instanceof Long return new Long Primitive longUnaryOperation Long operand kind else if operand instanceof Float return new Float Primitive floatUnaryOperation Float operand kind else if operand instanceof Double return new Double Primitive doubleUnaryOperation Double operand kind else throw new InterpreterError class BSHReturnStatement extends SimpleNode implements ParserConstants public int kind BSHReturnStatement int id super id public Object eval CallStack callstack Interpreter interpreter throws EvalError Object value if jjtGetNumChildren value SimpleNode jjtGetChild eval callstack interpreter else value Primitive VOID return new ReturnControl kind value public class PanelWindowContainer implements DockableWindowContainer public PanelWindowContainer DockableWindowManager wm String position this wm wm this position position buttons new JPanel new ButtonLayout buttons setBorder new EmptyBorder closeBox new JButton GUIUtilities loadIcon closeBox setRequestFocusEnabled false closeBox setToolTipText jEdit getProperty if OperatingSystem isMacOSLF closeBox putClientProperty int left if position equals DockableWindowManager RIGHT position equals DockableWindowManager LEFT left else left closeBox setMargin new Insets left buttons add closeBox closeBox addActionListener new ActionHandler closeBox addMouseListener new MouseHandler popupButton new JButton GUIUtilities loadIcon popupButton setRequestFocusEnabled false popupButton setToolTipText jEdit getProperty if OperatingSystem isMacOSLF popupButton putClientProperty buttons add popupButton popupButton addMouseListener new MouseHandler buttonGroup new ButtonGroup buttonGroup add nullButton new JToggleButton dockables new Vector dockablePanel new DockablePanel dimension jEdit getIntegerProperty position buttons addMouseListener new MouseHandler public void register final DockableWindowManager Entry entry dockables addElement entry int rotation if position equals DockableWindowManager TOP position equals DockableWindowManager BOTTOM rotation RotatedTextIcon NONE else if position equals DockableWindowManager LEFT rotation RotatedTextIcon CCW else if position equals DockableWindowManager RIGHT rotation RotatedTextIcon CW else throw new InternalError position JToggleButton button new JToggleButton button setMargin new Insets button setRequestFocusEnabled false button setIcon new RotatedTextIcon rotation button getFont entry title button setActionCommand entry factory name button addActionListener new ActionHandler if OperatingSystem isMacOSLF button putClientProperty buttonGroup add button buttons add button button addMouseListener new MouseHandler wm revalidate public void add DockableWindowManager Entry entry dockablePanel add entry factory name entry win public void remove DockableWindowManager Entry entry if entry factory name equals mostRecent mostRecent null int index dockables indexOf entry buttons remove index dockables removeElement entry if entry win null dockablePanel remove entry win if current entry current null show null else wm revalidate public void save DockableWindowManager Entry entry public void showMostRecent if dockables size Toolkit getDefaultToolkit beep return if mostRecent null mostRecent DockableWindowManager Entry dockables get factory name wm showDockableWindow mostRecent public void show final DockableWindowManager Entry entry if current entry if entry null entry win requestFocus entry win requestDefaultFocus return if current null dockablePanel setBorder new DockBorder position if entry null mostRecent entry factory name this current entry dockablePanel showDockable entry factory name int index dockables indexOf entry JToggleButton buttons getComponent index setSelected true entry win requestFocus entry win requestDefaultFocus else current null nullButton setSelected true dockablePanel setBorder null wm getView getTextArea requestFocus wm revalidate dockablePanel repaint public boolean isVisible DockableWindowManager Entry entry return current entry public DockableWindowManager Entry getCurrent return current public String getDockables String retVal new String dockables size for int dockables size DockableWindowManager Entry entry DockableWindowManager Entry dockables elementAt retVal entry factory name return retVal static final int SPLITTER_WIDTH DockablePanel dockablePanel void save jEdit setIntegerProperty position dimension if current null jEdit unsetProperty position else jEdit setProperty position current factory name JPanel getButtonBox return buttons DockablePanel getDockablePanel return dockablePanel void setDimension int dimension if dimension this dimension dimension SPLITTER_WIDTH private DockableWindowManager wm private String position private JPanel buttons private JButton closeBox private JButton popupButton private ButtonGroup buttonGroup private JToggleButton nullButton private int dimension private Vector dockables private DockableWindowManager Entry current private String mostRecent class ActionHandler implements ActionListener public void actionPerformed ActionEvent evt if evt getSource closeBox show null else if wm isDockableWindowVisible evt getActionCommand show null else wm showDockableWindow evt getActionCommand class MouseHandler extends MouseAdapter JPopupMenu popup public void mousePressed MouseEvent evt if evt getSource popupButton GUIUtilities isPopupTrigger evt if popup null popup isVisible popup setVisible false else popup createPopupMenu GUIUtilities showPopupMenu popup Component evt getSource evt getX evt getY private JPopupMenu createPopupMenu JPopupMenu popup new JPopupMenu JMenu floatMenu new JMenu jEdit getProperty String dockables getDockables for int dockables length final String entry dockables JMenuItem selectMenuItem new JMenuItem wm getDockableTitle entry selectMenuItem addActionListener new ActionListener public void actionPerformed ActionEvent evt wm showDockableWindow entry JMenuItem floatMenuItem new JMenuItem wm getDockableTitle entry floatMenuItem addActionListener new ActionListener public void actionPerformed ActionEvent evt wm floatDockableWindow entry popup add selectMenuItem floatMenu add floatMenuItem popup addSeparator popup add floatMenu popup addSeparator JMenuItem config new JMenuItem jEdit getProperty config addActionListener new ActionListener public void actionPerformed ActionEvent evt new org gjt sp jedit options GlobalOptions wm getView popup add config return popup static class DockBorder implements Border String position Insets insets Color color1 Color color2 Color color3 DockBorder String position this position position insets new Insets position equals DockableWindowManager BOTTOM SPLITTER_WIDTH position equals DockableWindowManager RIGHT SPLITTER_WIDTH position equals DockableWindowManager TOP SPLITTER_WIDTH position equals DockableWindowManager LEFT SPLITTER_WIDTH public void paintBorder Component Graphics int int int width int height updateColors if color1 null color2 null color3 null return if position equals DockableWindowManager BOTTOM paintHorizBorder width else if position equals DockableWindowManager RIGHT paintVertBorder height else if position equals DockableWindowManager TOP paintHorizBorder height SPLITTER_WIDTH width else if position equals DockableWindowManager LEFT paintVertBorder width SPLITTER_WIDTH height public Insets getBorderInsets Component return insets public boolean isBorderOpaque return false private void paintHorizBorder Graphics int int int width setColor color3 fillRect width SPLITTER_WIDTH for int width setColor color1 drawLine setColor color2 drawLine setColor color1 drawLine setColor color2 drawLine private void paintVertBorder Graphics int int int height setColor color3 fillRect SPLITTER_WIDTH height for int height setColor color1 drawLine setColor color2 drawLine setColor color1 drawLine setColor color2 drawLine private void updateColors if UIManager getLookAndFeel instanceof MetalLookAndFeel color1 MetalLookAndFeel getControlHighlight color2 MetalLookAndFeel getControlDarkShadow color3 MetalLookAndFeel getControl else color1 color2 color3 null public static class RotatedTextIcon implements Icon public static final int NONE public static final int CW public static final int CCW public RotatedTextIcon int rotate Font font String text this rotate rotate this font font FontRenderContext fontRenderContext new FontRenderContext null true true this text text glyphs font createGlyphVector fontRenderContext text width int glyphs getLogicalBounds getWidth LineMetrics lineMetrics font getLineMetrics text fontRenderContext ascent lineMetrics getAscent height int lineMetrics getHeight renderHints new RenderingHints RenderingHints KEY_ANTIALIASING RenderingHints VALUE_ANTIALIAS_ON renderHints put RenderingHints KEY_FRACTIONALMETRICS RenderingHints VALUE_FRACTIONALMETRICS_ON renderHints put RenderingHints KEY_RENDERING RenderingHints VALUE_RENDER_QUALITY public int getIconWidth return int rotate RotatedTextIcon CW rotate RotatedTextIcon CCW height width public int getIconHeight return int rotate RotatedTextIcon CW rotate RotatedTextIcon CCW width height public void paintIcon Component Graphics int int Graphics2D g2d Graphics2D g2d setFont font AffineTransform oldTransform g2d getTransform RenderingHints oldHints g2d getRenderingHints g2d setRenderingHints renderHints g2d setColor getForeground if rotate RotatedTextIcon NONE g2d drawGlyphVector glyphs ascent else if rotate RotatedTextIcon CW AffineTransform trans new AffineTransform trans concatenate oldTransform trans translate trans rotate Math PI height width g2d setTransform trans g2d drawGlyphVector glyphs height width width height ascent else if rotate RotatedTextIcon CCW AffineTransform trans new AffineTransform trans concatenate oldTransform trans translate trans rotate Math PI height width g2d setTransform trans g2d drawGlyphVector glyphs height width width height ascent g2d setTransform oldTransform g2d setRenderingHints oldHints private int rotate private Font font private String text private GlyphVector glyphs private float width private float height private float ascent private RenderingHints renderHints class ButtonLayout implements LayoutManager public Dimension preferredLayoutSize Container parent Insets insets JComponent parent getBorder getBorderInsets JComponent parent Component comp parent getComponents if comp length return new Dimension else if position equals DockableWindowManager TOP position equals DockableWindowManager BOTTOM return new Dimension comp getPreferredSize height insets top insets bottom else return new Dimension comp getPreferredSize width insets left insets right public Dimension minimumLayoutSize Container parent return preferredLayoutSize parent public void layoutContainer Container parent Insets insets JComponent parent getBorder getBorderInsets JComponent parent Component comp parent getComponents if comp length boolean closeBoxSizeSet false boolean noMore false popupButton setVisible false Dimension parentSize parent getSize int pos position equals DockableWindowManager TOP position equals DockableWindowManager BOTTOM insets left for int comp length Dimension size comp getPreferredSize if position equals DockableWindowManager TOP position equals DockableWindowManager BOTTOM if closeBoxSizeSet closeBox setBounds pos insets top size height size height pos size height closeBoxSizeSet true if noMore pos size width parentSize width comp length closeBox getWidth popupButton setBounds parentSize width size height insets right insets top size height size height popupButton setVisible true comp setVisible false noMore true else comp setBounds pos insets top size width size height comp setVisible true pos size width else if closeBoxSizeSet closeBox setBounds insets left insets top size width size width pos size width closeBoxSizeSet true if noMore pos size height parentSize height comp length closeBox getHeight popupButton setBounds insets top parentSize height size width size width size width popupButton setVisible true comp setVisible false noMore true else comp setBounds insets left pos size width size height comp setVisible true pos size height class DockablePanel extends JPanel DockablePanel super new CardLayout ResizeMouseHandler resizeMouseHandler new ResizeMouseHandler addMouseListener resizeMouseHandler addMouseMotionListener resizeMouseHandler PanelWindowContainer getWindowContainer return PanelWindowContainer this void showDockable String name CardLayout getLayout show this name public Dimension getMinimumSize return new Dimension public Dimension getPreferredSize if current null return new Dimension else if dimension int width super getPreferredSize width dimension width SPLITTER_WIDTH if position equals DockableWindowManager TOP position equals DockableWindowManager BOTTOM return new Dimension dimension SPLITTER_WIDTH else return new Dimension dimension SPLITTER_WIDTH class ResizeMouseHandler extends MouseAdapter implements MouseMotionListener boolean canDrag int dragStartDimension Point dragStart public void mousePressed MouseEvent evt dragStartDimension dimension dragStart evt getPoint public void mouseMoved MouseEvent evt Border border getBorder if border null return Insets insets border getBorderInsets DockablePanel this int cursor Cursor DEFAULT_CURSOR canDrag false if position equals DockableWindowManager TOP if evt getY getHeight insets bottom cursor Cursor N_RESIZE_CURSOR canDrag true else if position equals DockableWindowManager LEFT if evt getX getWidth insets right cursor Cursor W_RESIZE_CURSOR canDrag true else if position equals DockableWindowManager BOTTOM if evt getY insets top cursor Cursor S_RESIZE_CURSOR canDrag true else if position equals DockableWindowManager RIGHT if evt getX insets left cursor Cursor E_RESIZE_CURSOR canDrag true setCursor Cursor getPredefinedCursor cursor public void mouseDragged MouseEvent evt if canDrag return return if position equals DockableWindowManager TOP dimension evt getY dragStartDimension dragStart else if position equals DockableWindowManager LEFT dimension evt getX dragStartDimension dragStart else if position equals DockableWindowManager BOTTOM dimension dragStart evt getY else if position equals DockableWindowManager RIGHT dimension dragStart evt getX if dimension dimension dragStartDimension wm invalidate wm validate public void mouseExited MouseEvent evt setCursor Cursor getPredefinedCursor Cursor DEFAULT_CURSOR final class RETokenBackRef extends REToken private int num private boolean insens RETokenBackRef int subIndex int num boolean insens super subIndex this num num this insens insens boolean match CharIndexed input REMatch mymatch int mymatch start num mymatch end num for int if input charAt mymatch index input charAt return false mymatch index return next input mymatch void dump StringBuffer os os append append num public interface ScrollListener extends java util EventListener void scrolledVertically JEditTextArea textArea void scrolledHorizontally JEditTextArea textArea class CharIndexedCharArray implements CharIndexed Serializable private char private int anchor CharIndexedCharArray char str int index str anchor index public char charAt int index int pos anchor index return pos length pos pos OUT_OF_BOUNDS public boolean isValid return anchor length public boolean move int index return anchor index length public class TargetError extends EvalError Throwable target boolean inNativeCode public TargetError String msg Throwable SimpleNode node boolean inNativeCode super msg node target this inNativeCode inNativeCode public TargetError Throwable SimpleNode node this node false public TargetError String Throwable this null false public Throwable getTarget if target instanceof InvocationTargetException return InvocationTargetException target getTargetException else return target public String toString return super toString printTargetError target public void printStackTrace printStackTrace false System err public void printStackTrace PrintStream out printStackTrace false out public void printStackTrace boolean debug PrintStream out if debug super printStackTrace out System out println target printStackTrace out public String printTargetError Throwable String target toString if Capabilities canGenerateInterfaces xPrintTargetError return public String xPrintTargetError Throwable String getTarget Interpreter new Interpreter try set return String eval getTarget catch EvalError throw new InterpreterError toString public boolean inNativeCode return inNativeCode public class BufferPrinter1_3 private static PrinterJob getPrintJob job PrinterJob getPrinterJob int orientation jEdit getIntegerProperty PageFormat PORTRAIT double width jEdit getDoubleProperty double height jEdit getDoubleProperty double jEdit getDoubleProperty double jEdit getDoubleProperty double pagewidth jEdit getDoubleProperty double pageheight jEdit getDoubleProperty format job defaultPage if width height Paper pap format getPaper pap setImageableArea width height pap setSize pagewidth pageheight format setPaper pap format setOrientation orientation return job public static void pageSetup View view job getPrintJob PageFormat newFormat job pageDialog format if newFormat null format newFormat jEdit setIntegerProperty format getOrientation Paper paper format getPaper jEdit setDoubleProperty paper getImageableWidth jEdit setDoubleProperty paper getImageableHeight jEdit setDoubleProperty paper getImageableX jEdit setDoubleProperty paper getImageableY jEdit setDoubleProperty paper getWidth jEdit setDoubleProperty paper getHeight public static void print final View view final Buffer buffer boolean selection job getPrintJob job setJobName buffer getPath boolean header jEdit getBooleanProperty boolean footer jEdit getBooleanProperty boolean lineNumbers jEdit getBooleanProperty boolean color jEdit getBooleanProperty Font font jEdit getFontProperty BufferPrintable printable new BufferPrintable job null view buffer font header footer lineNumbers color job setPrintable printable format if job printDialog return VFSManager runInWorkThread printable public static PageFormat getPageFormat return format private static PageFormat format private static PrinterJob job class CharIndexedInputStream implements CharIndexed private static final int BUFFER_INCREMENT private BufferedInputStream br private int index private int bufsize BUFFER_INCREMENT private int end UNKNOWN private char cached OUT_OF_BOUNDS private char lookBehind new char OUT_OF_BOUNDS OUT_OF_BOUNDS CharIndexedInputStream InputStream str int index if str instanceof BufferedInputStream br BufferedInputStream str else br new BufferedInputStream str BUFFER_INCREMENT next if index move index private boolean next if end return false try if index br reset int br read br mark bufsize if end cached OUT_OF_BOUNDS return false cached char index catch IOException printStackTrace cached OUT_OF_BOUNDS return false return true public char charAt int index if index return cached else if index end return OUT_OF_BOUNDS else if index return lookBehind else if index return lookBehind else if index return OUT_OF_BOUNDS else if index bufsize try while bufsize index bufsize BUFFER_INCREMENT br reset br mark bufsize br skip index catch IOException else if this index index try br reset br skip index catch IOException char ch OUT_OF_BOUNDS try int br read if end index return ch ch char catch IOException ie return ch public boolean move int index boolean retval true while retval index retval next return retval public boolean isValid return cached OUT_OF_BOUNDS class BSHAllocationExpression extends SimpleNode BSHAllocationExpression int id super id public Object eval CallStack callstack Interpreter interpreter throws EvalError SimpleNode type SimpleNode jjtGetChild SimpleNode args SimpleNode jjtGetChild if type instanceof BSHAmbiguousName BSHAmbiguousName name BSHAmbiguousName type if args instanceof BSHArguments return objectAllocation name BSHArguments args callstack interpreter else return objectArrayAllocation name BSHArrayDimensions args callstack interpreter else return primitiveArrayAllocation BSHPrimitiveType type BSHArrayDimensions args callstack interpreter private Object objectAllocation BSHAmbiguousName nameNode BSHArguments argumentsNode CallStack callstack Interpreter interpreter throws EvalError NameSpace namespace callstack top Class type nameNode toClass namespace Object args argumentsNode getArguments callstack interpreter if args null throw new EvalError this boolean hasBody jjtGetNumChildren if hasBody BSHBlock body BSHBlock jjtGetChild return constructWithBody type args body callstack interpreter else return constructObject type args private Object constructObject Class type Object args throws EvalError try return Reflect constructObject type args catch ReflectError throw new EvalError getMessage this catch InvocationTargetException Interpreter debug getTargetException throw new TargetError getTargetException this true private Object constructWithBody Class type Object args BSHBlock body CallStack callstack Interpreter interpreter throws EvalError if type isInterface throw new EvalError type NameSpace namespace callstack top NameSpace local new NameSpace namespace callstack push local body eval callstack interpreter true callstack pop return local getThis interpreter getInterface type private Object objectArrayAllocation BSHAmbiguousName nameNode BSHArrayDimensions dimensionsNode CallStack callstack Interpreter interpreter throws EvalError NameSpace namespace callstack top Class type nameNode toClass namespace if type null throw new EvalError nameNode getName namespace this Object result dimensionsNode eval type callstack interpreter if result Primitive VOID return result else return arrayNewInstance type dimensionsNode private Object primitiveArrayAllocation BSHPrimitiveType typeNode BSHArrayDimensions dimensionsNode CallStack callstack Interpreter interpreter throws EvalError Class type typeNode getType Object result dimensionsNode eval type callstack interpreter if result Primitive VOID return result return arrayNewInstance type dimensionsNode private Object arrayNewInstance Class type BSHArrayDimensions dimensionsNode throws EvalError try return Array newInstance type dimensionsNode dimensions catch NegativeArraySizeException e1 throw new TargetError e1 catch Exception throw new EvalError getMessage this class BSHMethodInvocation extends SimpleNode BSHMethodInvocation int id super id public Object eval CallStack callstack Interpreter interpreter throws EvalError NameSpace namespace callstack top Name name BSHAmbiguousName jjtGetChild getName namespace Object args BSHArguments jjtGetChild getArguments callstack interpreter try return name invokeMethod interpreter args callstack this catch ReflectError throw new EvalError getMessage this catch java lang reflect InvocationTargetException String msg name Throwable te getTargetException boolean isNative true if te instanceof EvalError if te instanceof TargetError isNative TargetError te inNativeCode else isNative false throw new TargetError msg te this isNative catch EvalError ee ee reThrow this throw new Error public class VFSUpdate extends EBMessage public VFSUpdate String path super null if path null throw new NullPointerException this path path public String getPath return path public String paramString return path super paramString private String path class BSHReturnType extends SimpleNode public boolean isVoid BSHReturnType int id super id public Object getReturnType NameSpace namespace throws EvalError if isVoid return Primitive VOID else return BSHType jjtGetChild getType namespace class BufferPrintable extends WorkRequest implements Printable BufferPrintable PrinterJob job Object format View view Buffer buffer Font font boolean header boolean footer boolean lineNumbers boolean color this job job this format format this view view this buffer buffer this font font this header header this footer footer this lineNumbers lineNumbers styles GUIUtilities loadStyles jEdit getProperty jEdit getIntegerProperty color styles Token NULL new SyntaxStyle textColor null font lineList new ArrayList softWrap new SoftWrapTokenHandler public void run try if format null job print else Method method PrinterJob class getMethod new Class Class forName method invoke job new Object format catch PrinterAbortException ae Log log Log DEBUG this ae catch Exception Log log Log ERROR this final String args toString SwingUtilities invokeLater new Runnable public void run GUIUtilities error view args finally public int print Graphics PageFormat pageFormat int pageIndex throws PrinterException if pageIndex currentPage for int currentPage pageIndex printPage pageFormat true currentPage pageIndex if pageIndex currentPage if end view getStatus setMessage null return NO_SUCH_PAGE currentPageStart currentPhysicalLine currentPage pageIndex else if pageIndex currentPage currentPhysicalLine currentPageStart Object args new Object new Integer pageIndex String message jEdit getProperty args view getStatus setMessage message setStatus message printPage pageFormat pageIndex true return PAGE_EXISTS private static Color headerColor Color lightGray private static Color headerTextColor Color black private static Color footerColor Color lightGray private static Color footerTextColor Color black private static Color lineNumberColor Color gray private static Color textColor Color black private PrinterJob job private Object format private View view private Buffer buffer private Font font private SyntaxStyle styles private boolean header private boolean footer private boolean lineNumbers private int currentPage private int currentPageStart private int currentPhysicalLine private boolean end private LineMetrics lm private ArrayList lineList private SoftWrapTokenHandler softWrap private void printPage Graphics PageFormat pageFormat int pageIndex boolean actuallyPaint Graphics2D gfx Graphics2D gfx setFont font double pageX pageFormat getImageableX double pageY pageFormat getImageableY double pageWidth pageFormat getImageableWidth double pageHeight pageFormat getImageableHeight if header double headerHeight paintHeader gfx pageX pageY pageWidth actuallyPaint pageY headerHeight pageHeight headerHeight if footer double footerHeight paintFooter gfx pageX pageY pageWidth pageHeight pageIndex actuallyPaint pageHeight footerHeight FontRenderContext frc gfx getFontRenderContext double lineNumberWidth if lineNumbers int lineNumberDigits int Math ceil Math log buffer getLineCount Math log char chars new char lineNumberDigits for int chars length chars lineNumberWidth font getStringBounds chars lineNumberDigits frc getWidth else lineNumberWidth int tabSize jEdit getIntegerProperty char chars new char tabSize for int chars length chars double tabWidth font getStringBounds chars tabSize frc getWidth PrintTabExpander new PrintTabExpander tabWidth Segment seg new Segment double lm font getLineMetrics frc print_loop for if currentPhysicalLine buffer getLineCount end true break print_loop lineList clear buffer getLineText currentPhysicalLine seg softWrap init seg styles frc lineList float pageWidth lineNumberWidth buffer markTokens currentPhysicalLine softWrap if lineList size lineList add null if lm getHeight lineList size pageHeight break print_loop if lineNumbers actuallyPaint gfx setFont font gfx setColor lineNumberColor gfx drawString String valueOf currentPhysicalLine float pageX float pageY lm getHeight for int lineList size lm getHeight Chunk chunks Chunk lineList get if chunks null actuallyPaint Chunk paintChunkList seg chunks gfx float pageX lineNumberWidth float pageY Color white false currentPhysicalLine private double paintHeader Graphics2D gfx double pageX double pageY double pageWidth boolean actuallyPaint String headerText jEdit getProperty new String buffer getPath FontRenderContext frc gfx getFontRenderContext lm font getLineMetrics headerText frc Rectangle2D bounds font getStringBounds headerText frc Rectangle2D headerBounds new Rectangle2D Double pageX pageY pageWidth bounds getHeight if actuallyPaint gfx setColor headerColor gfx fill headerBounds gfx setColor headerTextColor gfx drawString headerText float pageX pageWidth bounds getWidth float pageY lm getAscent return headerBounds getHeight private double paintFooter Graphics2D gfx double pageX double pageY double pageWidth double pageHeight int pageIndex boolean actuallyPaint String footerText jEdit getProperty new Object new Date new Integer pageIndex FontRenderContext frc gfx getFontRenderContext lm font getLineMetrics footerText frc Rectangle2D bounds font getStringBounds footerText frc Rectangle2D footerBounds new Rectangle2D Double pageX pageY pageHeight bounds getHeight pageWidth bounds getHeight if actuallyPaint gfx setColor footerColor gfx fill footerBounds gfx setColor footerTextColor gfx drawString footerText float pageX pageWidth bounds getWidth float pageY pageHeight bounds getHeight lm getAscent return footerBounds getHeight static class PrintTabExpander implements TabExpander private double tabWidth public PrintTabExpander double tabWidth this tabWidth tabWidth public float nextTabStop float int tabOffset int ntabs int tabWidth return float ntabs tabWidth public class HyperSearchResult public String path public Buffer buffer public int line public int start public int end public Position startPos public Position endPos public HyperSearchResult Buffer buffer int line int start int end path buffer getPath this line line this start start this end end if buffer isTemporary bufferOpened buffer str line buffer getLineText line replace trim public void bufferOpened Buffer buffer this buffer buffer startPos buffer createPosition Math min buffer getLength start endPos buffer createPosition Math min buffer getLength end public void bufferClosed buffer null start startPos getOffset end endPos getOffset startPos endPos null public Buffer getBuffer if buffer null buffer jEdit openFile null path return buffer public String toString return str public class BeanShellAction extends EditAction public BeanShellAction String name String code String isSelected boolean noRepeat boolean noRecord super name this code code this isSelected isSelected this noRepeat noRepeat this noRecord noRecord sanitizedName name replace replace if isSelected null String cachedIsSelectedName sanitizedName try cachedIsSelected BeanShell cacheBlock cachedIsSelectedName isSelected false catch Exception Log log Log ERROR this new BeanShellErrorDialog null public void invoke View view try if cachedCode null String cachedCodeName sanitizedName cachedCode BeanShell cacheBlock cachedCodeName code false BeanShell runCachedBlock cachedCode view null catch Throwable Log log Log ERROR this new BeanShellErrorDialog view public boolean isToggle return isSelected null public boolean isSelected View view if isSelected null return false try return Boolean TRUE equals BeanShell runCachedBlock cachedIsSelected view null catch Throwable Log log Log ERROR this new BeanShellErrorDialog view return false public boolean noRepeat return noRepeat public boolean noRecord return noRecord public String getCode return code trim private boolean noRepeat private boolean noRecord private String code private String isSelected private BshMethod cachedCode private BshMethod cachedIsSelected private String sanitizedName class ChunkCache ChunkCache JEditTextArea textArea this textArea textArea out new ArrayList noWrap new DisplayTokenHandler softWrap new SoftWrapTokenHandler int getMaxHorizontalScrollWidth int max for int lineInfo length LineInfo info lineInfo if info chunksValid info width max max info width return max int getScreenLineOfOffset int line int offset if line textArea getFirstPhysicalLine return else if line textArea getLastPhysicalLine return else if textArea softWrap int virtLine textArea physicalToVirtual line if virtLine firstLine throw new InternalError return virtLine firstLine else int screenLine if line lastScreenLineP LineInfo last lineInfo lastScreenLine if offset last offset offset last offset last length updateChunksUpTo lastScreenLine return lastScreenLine screenLine for int lineInfo length updateChunksUpTo LineInfo info getLineInfo if info physicalLine line if screenLine else screenLine break else if info physicalLine line if offset info offset offset info offset info length screenLine break if screenLine return else lastScreenLineP line lastScreenLine screenLine return screenLine void recalculateVisibleLines lineInfo new LineInfo textArea getVisibleLines for int lineInfo length lineInfo new LineInfo lastScreenLine lastScreenLineP public static boolean DEBUG false void setFirstLine int firstLine int physFirstLine boolean bufferSwitch if DEBUG System err println this firstLine firstLine physFirstLine bufferSwitch int visibleLines lineInfo length if bufferSwitch textArea softWrap Math abs firstLine this firstLine visibleLines textArea softWrap physFirstLine textArea getLastPhysicalLine if DEBUG System err println for int visibleLines lineInfo chunksValid false else if firstLine this firstLine boolean invalidateAll false int firstScreenLine for int visibleLines if lineInfo chunksValid invalidateAll true break if lineInfo physicalLine physFirstLine firstScreenLine break if invalidateAll invalidateAll else int lastValidLine for int visibleLines if DEBUG System err println if lineInfo lastSubregion break else lineInfo chunksValid false if firstScreenLine visibleLines System arraycopy lineInfo firstScreenLine lineInfo visibleLines firstScreenLine for int visibleLines firstScreenLine visibleLines lineInfo new LineInfo if DEBUG System err println firstScreenLine else if this firstLine firstLine LinkedList list new LinkedList for int firstLine this firstLine if textArea getVirtualLineCount list size visibleLines break int physicalLine textArea virtualToPhysical out clear lineToChunkList physicalLine out if out size out add null getLineInfosForPhysicalLine physicalLine list if list size visibleLines System arraycopy lineInfo lineInfo list size visibleLines list size int firstScreenLine Math min list size visibleLines Iterator iter list iterator for int visibleLines iter hasNext lineInfo LineInfo iter next if DEBUG System err println firstScreenLine lastScreenLine lastScreenLineP this firstLine firstLine void invalidateAll for int lineInfo length if lineInfo chunksValid break lineInfo chunksValid false lastScreenLine lastScreenLineP void invalidateChunksFrom int screenLine for int screenLine lineInfo length lineInfo chunksValid false lastScreenLine lastScreenLineP void invalidateChunksFromPhys int physicalLine for int lineInfo length LineInfo info lineInfo if info chunksValid break if info physicalLine physicalLine invalidateChunksFrom break void lineToChunkList int physicalLine List out if textArea softWrap TextAreaPainter painter textArea getPainter Buffer buffer textArea getBuffer buffer getLineText physicalLine textArea lineSegment softWrap init textArea lineSegment painter getStyles painter getFontRenderContext painter out textArea wrapMargin softWrap setMonospacedCharWidth textArea monospacedHack textArea charWidth buffer markTokens physicalLine softWrap else Chunk chunks lineToChunkList physicalLine if chunks null out add chunks Chunk lineToChunkList int physicalLine TextAreaPainter painter textArea getPainter Buffer buffer textArea getBuffer buffer getLineText physicalLine textArea lineSegment noWrap init textArea lineSegment painter getStyles painter getFontRenderContext painter noWrap setMonospacedCharWidth textArea monospacedHack textArea charWidth buffer markTokens physicalLine noWrap return noWrap getChunks void updateChunksUpTo int lastScreenLine if lineInfo lastScreenLine chunksValid return int firstScreenLine for int lastScreenLine if lineInfo chunksValid firstScreenLine break int physicalLine if firstScreenLine physicalLine textArea getFirstPhysicalLine else int prevPhysLine lineInfo firstScreenLine physicalLine if prevPhysLine physicalLine else physicalLine textArea getFoldVisibilityManager getNextVisibleLine prevPhysLine out clear int offset int length for int firstScreenLine lastScreenLine LineInfo info lineInfo Chunk chunks if out size if physicalLine firstScreenLine physicalLine textArea getFoldVisibilityManager getNextVisibleLine physicalLine if physicalLine info chunks null info chunksValid true info physicalLine continue lineToChunkList physicalLine out info firstSubregion true if out size chunks null offset length else chunks Chunk out get out remove offset if out size length Chunk out get offset offset else length textArea getLineLength physicalLine offset else info firstSubregion false chunks Chunk out get out remove offset chunks offset if out size length Chunk out get offset offset else length textArea getLineLength physicalLine offset boolean lastSubregion out size if lastScreenLine lastScreenLine lineInfo length if info physicalLine physicalLine info lastSubregion lastSubregion lastScreenLine needFullRepaint true else if out size lastScreenLine info physicalLine physicalLine info lastSubregion lastSubregion info offset offset info length length info chunks chunks info chunksValid true LineInfo getLineInfo int screenLine LineInfo info lineInfo screenLine if info chunksValid throw new InternalError screenLine return info public LineInfo getLineInfosForPhysicalLine int physicalLine out clear lineToChunkList physicalLine out if out size out add null ArrayList returnValue new ArrayList out size getLineInfosForPhysicalLine physicalLine returnValue return LineInfo returnValue toArray new LineInfo out size boolean needFullRepaint boolean retVal needFullRepaint needFullRepaint false return retVal private JEditTextArea textArea private int firstLine private LineInfo lineInfo private ArrayList out private int lastScreenLineP private int lastScreenLine private boolean needFullRepaint private DisplayTokenHandler noWrap private SoftWrapTokenHandler softWrap private void getLineInfosForPhysicalLine int physicalLine List list for int out size Chunk chunks Chunk out get LineInfo info new LineInfo info physicalLine physicalLine if info firstSubregion true info offset else info offset chunks offset if out size info lastSubregion true info length textArea getLineLength physicalLine info offset else info length Chunk out get offset info offset info chunksValid true info chunks chunks list add info static class LineInfo int physicalLine int offset int length boolean firstSubregion boolean lastSubregion boolean chunksValid Chunk chunks int width public class BshMethod implements java io Serializable BSHMethodDeclaration method NameSpace declaringNameSpace private Class argTypes BshMethod BSHMethodDeclaration method NameSpace declaringNameSpace this method method this declaringNameSpace declaringNameSpace public Class getArgTypes if argTypes null argTypes method params argTypes return argTypes public String getName return method name public Object invoke Object argValues Interpreter interpreter CallStack callstack throws EvalError return invokeDeclaredMethod argValues interpreter callstack null Object invokeDeclaredMethod Object argValues Interpreter interpreter CallStack callstack SimpleNode callerInfo throws EvalError if argValues null argValues new Object if argValues length method params numArgs try String help String declaringNameSpace get method name interpreter interpreter println help return Primitive VOID catch Exception throw new EvalError method name callerInfo NameSpace localNameSpace new NameSpace declaringNameSpace method name localNameSpace setNode callerInfo for int method params numArgs if method params argTypes null try argValues NameSpace getAssignableForm argValues method params argTypes catch EvalError throw new EvalError method params argNames method name getMessage callerInfo localNameSpace setTypedVariable method params argNames method params argTypes argValues false if argValues Primitive VOID throw new EvalError method params argNames method name callerInfo else localNameSpace setVariable method params argNames argValues callstack push localNameSpace Object ret method block eval callstack interpreter true callstack pop if ret instanceof ReturnControl ReturnControl rs ReturnControl ret if rs kind rs RETURN ret ReturnControl ret value else throw new EvalError method if method returnType null if method returnType Primitive VOID return method returnType try ret NameSpace getAssignableForm ret Class method returnType catch EvalError throw new EvalError method name getMessage method return ret public String toString return method name class BSHImportDeclaration extends SimpleNode public boolean superImport BSHImportDeclaration int id super id public Object eval CallStack callstack Interpreter interpreter throws EvalError if superImport NameSpace doSuperImport else NameSpace namespace callstack top String name BSHAmbiguousName jjtGetChild getName namespace value else return Primitive VOID class BSHAssignment extends SimpleNode implements ParserConstants public int operator BSHAssignment int id super id public Object eval CallStack callstack Interpreter interpreter throws EvalError BSHLHSPrimaryExpression lhsNode BSHLHSPrimaryExpression jjtGetChild if lhsNode null throw new InterpreterError LHS lhs lhsNode toLHS callstack interpreter if lhs null throw new InterpreterError Object rhs SimpleNode jjtGetChild eval callstack interpreter if rhs Primitive VOID throw new EvalError this switch operator case ASSIGN try return lhs assign rhs catch EvalError reThrow this case PLUSASSIGN return lhs assign operation lhs getValue rhs PLUS case MINUSASSIGN return lhs assign operation lhs getValue rhs MINUS case STARASSIGN return lhs assign operation lhs getValue rhs STAR case SLASHASSIGN return lhs assign operation lhs getValue rhs SLASH case ANDASSIGN case ANDASSIGNX return lhs assign operation lhs getValue rhs BIT_AND case ORASSIGN case ORASSIGNX return lhs assign operation lhs getValue rhs BIT_OR case XORASSIGN return lhs assign operation lhs getValue rhs XOR case MODASSIGN return lhs assign operation lhs getValue rhs MOD case LSHIFTASSIGN case LSHIFTASSIGNX return lhs assign operation lhs getValue rhs LSHIFT case RSIGNEDSHIFTASSIGN case RSIGNEDSHIFTASSIGNX return lhs assign operation lhs getValue rhs RSIGNEDSHIFT case RUNSIGNEDSHIFTASSIGN case RUNSIGNEDSHIFTASSIGNX return lhs assign operation lhs getValue rhs RUNSIGNEDSHIFT default throw new InterpreterError private Object operation Object lhs Object rhs int kind throws EvalError if lhs instanceof String rhs Primitive VOID if kind PLUS throw new EvalError this return String lhs rhs if lhs instanceof Primitive rhs instanceof Primitive if lhs Primitive VOID rhs Primitive VOID throw new EvalError this else if lhs Primitive NULL rhs Primitive NULL throw new EvalError this if lhs instanceof Boolean lhs instanceof Character lhs instanceof Number lhs instanceof Primitive rhs instanceof Boolean rhs instanceof Character rhs instanceof Number rhs instanceof Primitive return Primitive binaryOperation lhs rhs kind throw new EvalError lhs getClass tokenImage kind rhs getClass this public class BeanShellErrorDialog extends EnhancedDialog public BeanShellErrorDialog View view Throwable super view jEdit getProperty true JPanel content new JPanel new BorderLayout content setBorder new EmptyBorder setContentPane content Box iconBox new Box BoxLayout Y_AXIS iconBox add new JLabel UIManager getIcon iconBox add Box createGlue content add BorderLayout WEST iconBox JPanel centerPanel new JPanel new BorderLayout centerPanel add BorderLayout NORTH new JLabel jEdit getProperty JTextArea textArea new JTextArea StringWriter new StringWriter printStackTrace new PrintWriter textArea setText toString textArea setLineWrap true textArea setCaretPosition centerPanel add BorderLayout CENTER new JScrollPane textArea content add BorderLayout CENTER centerPanel Box buttons new Box BoxLayout X_AXIS buttons add Box createGlue JButton ok new JButton jEdit getProperty ok addActionListener new ActionHandler buttons add ok buttons add Box createGlue content add BorderLayout SOUTH buttons getRootPane setDefaultButton ok pack setLocationRelativeTo view show public void ok dispose public void cancel dispose class ActionHandler implements ActionListener public void actionPerformed ActionEvent evt dispose class SettingsReloader implements EBComponent public void handleMessage EBMessage msg if msg instanceof VFSUpdate VFSUpdate vmsg VFSUpdate msg maybeReload vmsg getPath private void maybeReload String path SearchFileSet fileset SearchAndReplace getSearchFileSet if fileset instanceof DirectoryListSet DirectoryListSet dirset DirectoryListSet fileset if path startsWith dirset getDirectory dirset invalidateCachedList String jEditHome jEdit getJEditHome String settingsDirectory jEdit getSettingsDirectory if OperatingSystem isDOSDerived OperatingSystem isMacOS path path toLowerCase if jEditHome null jEditHome jEditHome toLowerCase if settingsDirectory null settingsDirectory settingsDirectory toLowerCase if jEditHome null path startsWith jEditHome path path substring jEditHome length else if settingsDirectory null path startsWith settingsDirectory path path substring settingsDirectory length else return if path startsWith File separator path startsWith path path substring if path startsWith Macros loadMacros else if path startsWith path endsWith path endsWith jEdit reloadModes public class EnhancedCheckBoxMenuItem extends JCheckBoxMenuItem public EnhancedCheckBoxMenuItem String label EditAction action super label this action action if action null setEnabled true addActionListener new EditAction Wrapper action shortcutProp1 action getName shortcutProp2 action getName addMouseListener new MouseHandler else setEnabled false setModel new Model public Dimension getPreferredSize Dimension super getPreferredSize String shortcut getShortcut if shortcut null width getFontMetrics acceleratorFont stringWidth shortcut return public void paint Graphics super paint String shortcut getShortcut if shortcut null setFont acceleratorFont setColor getModel isArmed acceleratorSelectionForeground acceleratorForeground FontMetrics fm getFontMetrics Insets insets getInsets drawString shortcut getWidth fm stringWidth shortcut insets right insets left getFont getSize insets top public String getActionCommand return getModel getActionCommand private String shortcutProp1 private String shortcutProp2 private EditAction action private static Font acceleratorFont private static Color acceleratorForeground private static Color acceleratorSelectionForeground private String getShortcut if action null return null else String shortcut1 jEdit getProperty shortcutProp1 String shortcut2 jEdit getProperty shortcutProp2 if shortcut1 null shortcut1 length if shortcut2 null shortcut2 length return null else return shortcut2 else if shortcut2 null shortcut2 length return shortcut1 else return shortcut1 shortcut2 static acceleratorFont UIManager getFont acceleratorFont new Font acceleratorFont getStyle acceleratorFont getSize acceleratorForeground UIManager getColor acceleratorSelectionForeground UIManager getColor class Model extends DefaultButtonModel public boolean isSelected if isShowing return false try return action isSelected GUIUtilities getView EnhancedCheckBoxMenuItem this catch Throwable Log log Log ERROR this return false public void setSelected boolean class MouseHandler extends MouseAdapter public void mouseReleased MouseEvent evt GUIUtilities getView Component evt getSource getStatus setMessage null public void mouseEntered MouseEvent evt String msg action getMouseOverText if msg null GUIUtilities getView Component evt getSource getStatus setMessage msg public void mouseExited MouseEvent evt GUIUtilities getView Component evt getSource getStatus setMessage null public class jEdit public static String getVersion return MiscUtilities buildToVersion getBuild public static String getBuild return public static void main String args String javaVersion System getProperty if javaVersion compareTo System err println javaVersion System err println System exit int level Log WARNING if args length String levelStr args if levelStr length Character isDigit levelStr charAt level Integer parseInt levelStr args null boolean endOpts false settingsDirectory MiscUtilities constructPath System getProperty String portFile boolean restore true boolean noPlugins false boolean noStartupScripts false String userDir System getProperty String scriptFile null for int args length String arg args if arg null continue else if arg length args null else if arg startsWith endOpts if arg equals endOpts true else if arg equals version System err println usage System exit else if arg equals version System exit else if arg equals settingsDirectory null else if arg startsWith settingsDirectory arg substring else if arg startsWith portFile null else if arg equals portFile else if arg startsWith portFile arg substring else if arg startsWith background true else if arg equals gui false else if arg equals restore false else if arg equals noPlugins true else if arg equals noStartupScripts true else if arg startsWith scriptFile arg substring else System err println arg usage System exit args null if settingsDirectory null portFile null portFile MiscUtilities constructPath settingsDirectory portFile else portFile null Log init true level if portFile null new File portFile exists int port key try BufferedReader in new BufferedReader new FileReader portFile String check in readLine if check equals throw new Exception port Integer parseInt in readLine key Integer parseInt in readLine in close Socket socket new Socket InetAddress getByName port DataOutputStream out new DataOutputStream socket getOutputStream out writeInt key String script makeServerScript restore args scriptFile out writeUTF script out close System exit catch Exception Log log Log NOTICE jEdit class Log log Log NOTICE jEdit class Log log Log NOTICE jEdit class Log log Log NOTICE jEdit class Log log Log NOTICE jEdit class if new File settingsDirectory exists GUIUtilities showSplashScreen Writer stream if settingsDirectory null File new File settingsDirectory if exists mkdirs File new File settingsDirectory if exists mkdir String logPath MiscUtilities constructPath settingsDirectory backupSettingsFile new File logPath try stream new BufferedWriter new FileWriter logPath String lineSep System getProperty stream write new Date stream write lineSep stream write stream write lineSep stream write stream write lineSep stream write stream write lineSep stream write stream write lineSep catch Exception printStackTrace stream null else stream null Log setLogWriter stream Log log Log NOTICE jEdit class getVersion Log log Log MESSAGE jEdit class settingsDirectory if portFile null server new EditServer portFile if server isOK server null else if background background false Log log Log WARNING jEdit class initMisc initSystemProperties GUIUtilities advanceSplashProgress BeanShell init initUserProperties initPLAF if OperatingSystem hasJava14 try ClassLoader loader jEdit class getClassLoader Class clazz if loader null clazz loader loadClass else clazz Class forName java lang reflect Method meth clazz getMethod new Class meth invoke null new Object catch Exception Log log Log ERROR jEdit class System exit initActions initDockables GUIUtilities advanceSplashProgress VFSManager init if noPlugins initPlugins if jEditHome null initSiteProperties if settingsDirectory null File history new File MiscUtilities constructPath settingsDirectory if history exists historyModTime history lastModified HistoryModel loadHistory history File recent new File MiscUtilities constructPath settingsDirectory if recent exists recentModTime recent lastModified BufferHistory load recent GUIUtilities advanceSplashProgress sortBuffers getBooleanProperty sortByName getBooleanProperty reloadModes GUIUtilities advanceSplashProgress SearchAndReplace load GUIUtilities advanceSplashProgress for int jars size EditPlugin JAR jars elementAt getClassLoader startAllPlugins Macros loadMacros if noStartupScripts jEditHome null String path MiscUtilities constructPath jEditHome File file new File path if file exists runStartupScripts file if noStartupScripts settingsDirectory null String path MiscUtilities constructPath settingsDirectory File file new File path if file exists file mkdirs else runStartupScripts file if scriptFile null scriptFile MiscUtilities constructPath userDir scriptFile BeanShell runScript null scriptFile null false propertiesChanged GUIUtilities advanceSplashProgress finishStartup gui restore userDir args public static final Properties getProperties return props public static final String getProperty String name return props getProperty name public static final String getProperty String name String def return props getProperty name def public static final String getProperty String name Object args if name null return null if args null return props getProperty name else String value props getProperty name if value null return null else return MessageFormat format value args public static final boolean getBooleanProperty String name return getBooleanProperty name false public static final boolean getBooleanProperty String name boolean def String value getProperty name if value null return def else if value equals value equals value equals return true else if value equals value equals value equals return false else return def public static final int getIntegerProperty String name int def String value getProperty name if value null return def else try return Integer parseInt value trim catch NumberFormatException nf return def public static double getDoubleProperty String name double def String value getProperty name if value null return def else try return Double parseDouble value trim catch NumberFormatException nf return def public static final Font getFontProperty String name return getFontProperty name null public static final Font getFontProperty String name Font def String family getProperty name String sizeString getProperty name String styleString getProperty name if family null sizeString null styleString null return def else int size style try size Integer parseInt sizeString catch NumberFormatException nf return def try style Integer parseInt styleString catch NumberFormatException nf return def return new Font family style size public static Color getColorProperty String name return getColorProperty name Color black public static Color getColorProperty String name Color def String value getProperty name if value null return def else return GUIUtilities parseColor value def public static void setColorProperty String name Color value setProperty name GUIUtilities getColorHexString value public static final void setProperty String name String value if value null String prop String defaultProps get name if prop null prop length props remove name else props put name else String prop String defaultProps get name if value equals prop props remove name else props put name value public static final void setTemporaryProperty String name String value props remove name defaultProps put name value public static final void setBooleanProperty String name boolean value setProperty name value public static final void setIntegerProperty String name int value setProperty name String valueOf value public static final void setDoubleProperty String name double value setProperty name String valueOf value public static final void setFontProperty String name Font value setProperty name value getFamily setIntegerProperty name value getSize setIntegerProperty name value getStyle public static final void unsetProperty String name if defaultProps get name null props put name else props remove name public static final void resetProperty String name props remove name public static void propertiesChanged initKeyBindings Autosave setInterval getIntegerProperty saveCaret getBooleanProperty UIDefaults defaults UIManager getDefaults Font font getFontProperty defaults put font defaults put font ToolTipManager sharedInstance setEnabled jEdit getBooleanProperty initProxy EditBus send new PropertiesChanged null public static String getNotLoadedPluginJARs Vector returnValue new Vector if jEditHome null String systemPluginDir MiscUtilities constructPath jEditHome String list new File systemPluginDir list if list null getNotLoadedPluginJARs returnValue systemPluginDir list if settingsDirectory null String userPluginDir MiscUtilities constructPath settingsDirectory String list new File userPluginDir list if list null getNotLoadedPluginJARs returnValue userPluginDir list String new String returnValue size returnValue copyInto return public static EditPlugin getPlugin String name EditPlugin plugins getPlugins for int plugins length if plugins getClassName equals name return plugins return null public static EditPlugin getPlugins Vector vector new Vector for int jars size EditPlugin JAR jars elementAt getPlugins vector EditPlugin array new EditPlugin vector size vector copyInto array return array public static EditPlugin JAR getPluginJARs EditPlugin JAR array new EditPlugin JAR jars size jars copyInto array return array public static EditPlugin JAR getPluginJAR String path for int jars size EditPlugin JAR jar EditPlugin JAR jars elementAt if jar getPath equals path return jar return null public static void addPluginJAR EditPlugin JAR plugin addActionSet plugin getActions jars addElement plugin public static void addActionSet ActionSet actionSet actionSets addElement actionSet public static ActionSet getActionSets ActionSet retVal new ActionSet actionSets size actionSets copyInto retVal return retVal public static EditAction getAction String name for int actionSets size EditAction action ActionSet actionSets elementAt getAction name if action null return action return null public static ActionSet getActionSetForAction EditAction action for int actionSets size ActionSet set ActionSet actionSets elementAt if set contains action return set return null public static EditAction getActions Vector vec new Vector for int actionSets size ActionSet actionSets elementAt getActions vec EditAction retVal new EditAction vec size vec copyInto retVal return retVal public static void reloadModes modes new Vector if jEditHome null loadModeCatalog true else loadModeCatalog MiscUtilities constructPath jEditHome false if settingsDirectory null File userModeDir new File MiscUtilities constructPath settingsDirectory if userModeDir exists userModeDir mkdirs File userCatalog new File MiscUtilities constructPath settingsDirectory if userCatalog exists try FileWriter out new FileWriter userCatalog out write jEdit getProperty out close catch IOException io Log log Log ERROR jEdit class io loadModeCatalog userCatalog getPath false Buffer buffer buffersFirst while buffer null buffer setMode buffer buffer next public static Mode getMode String name for int modes size Mode mode Mode modes elementAt if mode getName equals name return mode return null public static Mode getModes Mode array new Mode modes size modes copyInto array return array public static String restoreOpenFiles if settingsDirectory null return null File session new File MiscUtilities constructPath settingsDirectory if session exists return null String splitConfig null try BufferedReader in new BufferedReader new FileReader session String line while line in readLine null if line startsWith splitConfig line substring else openFile null line in close catch IOException io Log log Log ERROR jEdit class session Log log Log ERROR jEdit class io return splitConfig public static void saveOpenFiles View view if settingsDirectory null return view getEditPane saveCaretInfo File session new File MiscUtilities constructPath settingsDirectory try String lineSep System getProperty BufferedWriter out new BufferedWriter new FileWriter session Buffer buffer buffersFirst while buffer null if buffer isUntitled out write buffer getPath out write lineSep buffer buffer next out write out write view getSplitConfig out write lineSep out close catch IOException io Log log Log ERROR jEdit class session Log log Log ERROR jEdit class io public static Buffer openFiles View view String parent String args Buffer retVal null Buffer lastBuffer null for int args length String arg args if arg null continue else if arg startsWith arg startsWith if lastBuffer null gotoMarker view lastBuffer arg continue lastBuffer openFile null parent arg false null if retVal null lastBuffer null retVal lastBuffer if view null retVal null view setBuffer retVal return retVal public static Buffer openFile View view String path return openFile view null path false new Hashtable public static Buffer openFile View view String parent String path boolean readOnly boolean newFile return openFile view parent path newFile new Hashtable public static Buffer openFile View view String parent String path boolean readOnly boolean newFile Hashtable props return openFile view parent path newFile props public static Buffer openFile View view String parent String path boolean newFile Hashtable props if view null parent null parent view getBuffer getDirectory if MiscUtilities isURL path if MiscUtilities getProtocolOfURL path equals path path substring path MiscUtilities constructPath parent path if MiscUtilities isURL path path MiscUtilities canonPath path synchronized bufferListLock Buffer buffer getBuffer path if buffer null if view null view setBuffer buffer return buffer if props null props new Hashtable BufferHistory Entry entry BufferHistory getEntry path if entry null saveCaret props get Buffer CARET null props put Buffer CARET new Integer entry caret if entry null props get Buffer ENCODING null if entry encoding null props put Buffer ENCODING entry encoding Buffer newBuffer new Buffer path newFile false props if newBuffer load view false return null addBufferToList newBuffer EditBus send new BufferUpdate newBuffer view BufferUpdate CREATED if view null view setBuffer newBuffer return newBuffer public static Buffer openTemporary View view String parent String path boolean newFile if view null parent null parent view getBuffer getDirectory if MiscUtilities isURL path if MiscUtilities getProtocolOfURL path equals path path substring path MiscUtilities constructPath parent path synchronized bufferListLock Buffer buffer getBuffer path if buffer null return buffer buffer new Buffer path newFile true new Hashtable if buffer load view false return null else return buffer public static void commitTemporary Buffer buffer if buffer isTemporary return addBufferToList buffer buffer commitTemporary EditBus send new BufferUpdate buffer null BufferUpdate CREATED EditBus send new BufferUpdate buffer null BufferUpdate LOAD_STARTED EditBus send new BufferUpdate buffer null BufferUpdate LOADED public static Buffer newFile View view String path if view null view getBuffer null path view getBuffer getDirectory VFS vfs VFSManager getVFSForPath path if vfs getCapabilities VFS WRITE_CAP path System getProperty else path null return newFile view path public static Buffer newFile View view String dir if dir null buffersFirst null buffersFirst buffersLast buffersFirst isUntitled buffersFirst isDirty closeBuffer view buffersFirst return buffersFirst int untitledCount Buffer buffer buffersFirst while buffer null if buffer getName startsWith try untitledCount Math max untitledCount Integer parseInt buffer getName substring catch NumberFormatException nf buffer buffer next return openFile view dir untitledCount true null public static boolean closeBuffer View view Buffer buffer if buffer isPerformingIO VFSManager waitForRequests if VFSManager errorOccurred return false if buffer isDirty Object args buffer getName int result GUIUtilities confirm view args JOptionPane YES_NO_CANCEL_OPTION JOptionPane WARNING_MESSAGE if result JOptionPane YES_OPTION if buffer save view null true return false VFSManager waitForRequests if buffer getBooleanProperty BufferIORequest ERROR_OCCURRED return false else if result JOptionPane NO_OPTION return false view buffer return true public static void View view Buffer buffer if buffer isClosed return if buffer isNewFile view getEditPane saveCaretInfo Integer Integer buffer getProperty Buffer CARET int caret null intValue BufferHistory setEntry buffer getPath caret Selection buffer getProperty Buffer SELECTION buffer getStringProperty Buffer ENCODING removeBufferFromList buffer buffer close EditBus send new BufferUpdate buffer view BufferUpdate CLOSED if buffersFirst null buffersLast null newFile view public static boolean closeAllBuffers View view return closeAllBuffers view false public static boolean closeAllBuffers View view boolean isExiting boolean dirty false Buffer buffer buffersFirst while buffer null if buffer isDirty dirty true break buffer buffer next if dirty boolean ok new CloseDialog view isOK if ok return false VFSManager waitForRequests if VFSManager errorOccurred return false buffer buffersFirst buffersFirst buffersLast null bufferCount while buffer null if buffer isNewFile Integer Integer buffer getProperty Buffer CARET int caret null intValue BufferHistory setEntry buffer getPath caret Selection buffer getProperty Buffer SELECTION buffer getStringProperty Buffer ENCODING buffer close if isExiting EditBus send new BufferUpdate buffer view BufferUpdate CLOSED buffer buffer next if isExiting newFile view return true public static void saveAllBuffers View view boolean confirm if confirm int result GUIUtilities confirm view null JOptionPane YES_NO_OPTION JOptionPane QUESTION_MESSAGE if result JOptionPane YES_OPTION return Buffer current view getBuffer Buffer buffer buffersFirst while buffer null if buffer isDirty if buffer isNewFile view setBuffer buffer buffer save view null true buffer buffer next view setBuffer current public static void reloadAllBuffers final View view boolean confirm if confirm int result GUIUtilities confirm view null JOptionPane YES_NO_OPTION JOptionPane QUESTION_MESSAGE if result JOptionPane YES_OPTION return View viewsFirst while null EditPane panes getEditPanes for int panes length panes saveCaretInfo next Buffer buffers jEdit getBuffers for int buffers length Buffer buffer buffers buffer load view true public static Buffer getBuffer String path boolean caseInsensitiveFilesystem File separatorChar synchronized bufferListLock Buffer buffer buffersFirst while buffer null String buffer getPath if caseInsensitiveFilesystem if equalsIgnoreCase path return buffer else if equals path return buffer buffer buffer next return null public static Buffer getBuffers synchronized bufferListLock Buffer buffers new Buffer bufferCount Buffer buffer buffersFirst for int bufferCount buffers buffer buffer buffer next return buffers public static int getBufferCount return bufferCount public static Buffer getFirstBuffer return buffersFirst public static Buffer getLastBuffer return buffersLast public static InputHandler getInputHandler return inputHandler public static View newView View view Buffer buffer return newView view buffer false public static View newView View view Buffer buffer boolean plainView if view null view showWaitCursor view getEditPane saveCaretInfo View newView new View buffer null plainView newView pack if view null GUIUtilities saveGeometry view view isPlainView view hideWaitCursor GUIUtilities loadGeometry newView plainView addViewToList newView EditBus send new ViewUpdate newView ViewUpdate CREATED newView show if newView viewsFirst newView getTextArea requestFocus if settingsDirectory null getBooleanProperty new HelpViewer else if jEdit getBooleanProperty new TipOfTheDay newView setBooleanProperty false else GUIUtilities requestFocus newView newView getTextArea return newView public static View newView View view return newView view view getSplitConfig false public static View newView View view String splitConfig return newView view splitConfig false public static View newView View view String splitConfig boolean plainView if view null view showWaitCursor view getEditPane saveCaretInfo View newView new View null splitConfig plainView newView pack if view null GUIUtilities saveGeometry view view isPlainView view hideWaitCursor GUIUtilities loadGeometry newView plainView addViewToList newView EditBus send new ViewUpdate newView ViewUpdate CREATED newView show if newView viewsFirst newView getTextArea requestFocus if settingsDirectory null getBooleanProperty new HelpViewer else if jEdit getBooleanProperty new TipOfTheDay newView setBooleanProperty false else GUIUtilities requestFocus newView newView getTextArea return newView public static void closeView View view closeView view true public static View getViews View views new View viewCount View view viewsFirst for int viewCount views view view view next return views public static int getViewCount return viewCount public static View getFirstView return viewsFirst public static View getLastView return viewsLast public static View getActiveView return activeView public static boolean isBackgroundModeEnabled return background public static void showMemoryDialog View view Runtime rt Runtime getRuntime int before int rt freeMemory System gc int after int rt freeMemory int total int rt totalMemory JProgressBar progress new JProgressBar total progress setValue total after progress setStringPainted true progress setString jEdit getProperty new Object new Integer total after new Integer total Object message new Object message getProperty new Object new Integer after before message Box createVerticalStrut message progress message Box createVerticalStrut JOptionPane showMessageDialog view message jEdit getProperty JOptionPane INFORMATION_MESSAGE public static String getJEditHome return jEditHome public static String getSettingsDirectory return settingsDirectory public static void backupSettingsFile File file if settingsDirectory null return String backupDir MiscUtilities constructPath settingsDirectory File dir new File backupDir if dir exists dir mkdirs MiscUtilities saveBackup file null backupDir public static void saveSettings if settingsDirectory null File file1 new File MiscUtilities constructPath settingsDirectory File file2 new File MiscUtilities constructPath settingsDirectory if file2 exists file2 lastModified recentModTime Log log Log WARNING jEdit class file2 else backupSettingsFile file2 BufferHistory save file1 file2 delete file1 renameTo file2 recentModTime file2 lastModified file1 new File MiscUtilities constructPath settingsDirectory file2 new File MiscUtilities constructPath settingsDirectory if file2 exists file2 lastModified historyModTime Log log Log WARNING jEdit class file2 else backupSettingsFile file2 HistoryModel saveHistory file1 file2 delete file1 renameTo file2 historyModTime file2 lastModified SearchAndReplace save Abbrevs save FavoritesVFS saveFavorites file1 new File MiscUtilities constructPath settingsDirectory file2 new File MiscUtilities constructPath settingsDirectory if file2 exists file2 lastModified propsModTime Log log Log WARNING jEdit class file2 else backupSettingsFile file2 try OutputStream out new FileOutputStream file1 props store out out close catch IOException io Log log Log ERROR jEdit class io file2 delete file1 renameTo file2 propsModTime file2 lastModified public static void exit View view boolean reallyExit VFSManager waitForRequests EditBus send new EditorExitRequested view reallyExit background if view null saveOpenFiles view if closeAllBuffers view reallyExit return if reallyExit view viewsFirst while view null closeView view false view view next saveSettings return if view null view close Autosave stop if server null server stopServer EditPlugin plugins getPlugins for int plugins length try plugins stop catch Throwable Log log Log ERROR jEdit class Log log Log ERROR jEdit class EditBus send new EditorExiting null saveSettings Log closeStream System exit static void updatePosition Buffer buffer if sortBuffers removeBufferFromList buffer addBufferToList buffer public static void addMode Mode mode Log log Log DEBUG jEdit class mode getName modes addElement mode Object fileName mode getProperty Log log Log NOTICE jEdit class fileName XmlParser parser new XmlParser XModeHandler xmh new XModeHandler parser mode getName fileName toString parser setHandler xmh try Reader grammar if fileName instanceof URL grammar new BufferedReader new InputStreamReader URL fileName openStream else grammar new BufferedReader new FileReader String fileName parser parse null null grammar catch Throwable Log log Log ERROR jEdit class if instanceof XmlException XmlException xe XmlException int line xe getLine String message xe getMessage Object args fileName new Integer line null message GUIUtilities error null args TokenMarker marker new TokenMarker marker addRuleSet new ParserRuleSet mode mode setTokenMarker marker throws IOException in new BufferedInputStream in if def defaultProps load in else props load in in close static boolean loadActions String path Reader in ActionSet actionSet try ActionListHandler ah new ActionListHandler path actionSet XmlParser parser new XmlParser parser setHandler ah parser parse null null in return true catch XmlException xe int line xe getLine String message xe getMessage Log log Log ERROR jEdit class path line message catch Exception Log log Log ERROR jEdit class return false static void pluginError final String path String messageProp Object args if pluginErrors null pluginErrors new Vector pluginErrors addElement new ErrorListDialog ErrorEntry path messageProp args static void setActiveView View view jEdit activeView view private static String jEditHome private static String settingsDirectory private static long propsModTime historyModTime recentModTime private static Properties defaultProps private static Properties props private static EditServer server private static boolean background private static Vector actionSets private static ActionSet builtInActionSet private static Vector pluginErrors private static Vector jars private static Vector modes private static boolean saveCaret private static InputHandler inputHandler private static JEditMetalTheme theme private static boolean sortBuffers private static boolean sortByName private static int bufferCount private static Buffer buffersFirst private static Buffer buffersLast private static Object bufferListLock new Object private static int viewCount private static View viewsFirst private static View viewsLast private static View activeView private jEdit private static void usage System out println System out println System out println System out println System out println System out println System out println System out println System out println System out println System out println System out println System out println System out println System out println System out println System out println System out println System out println System out println System out println System out println private static void version System out println getVersion private static String makeServerScript boolean restore String args String scriptFile StringBuffer script new StringBuffer String userDir System getProperty script append script append MiscUtilities charsToEscapes userDir script append script append script append args length script append for int args length script append script append script append if args null script append else script append script append MiscUtilities charsToEscapes args script append script append script append restore if scriptFile null scriptFile MiscUtilities constructPath userDir scriptFile script append MiscUtilities charsToEscapes scriptFile return script toString private static void initMisc System getProperties put System getProperty String userAgent getVersion System getProperty System getProperty System getProperty System getProperties put userAgent inputHandler new DefaultInputHandler null jEditHome System getProperty if jEditHome null String classpath System getProperty int index classpath toLowerCase indexOf int start classpath lastIndexOf File pathSeparator index if classpath equalsIgnoreCase jEditHome System getProperty else if index start jEditHome classpath substring start index else jEditHome System getProperty Log log Log WARNING jEdit class Log log Log WARNING jEdit class jEditHome Log log Log WARNING jEdit class Log log Log MESSAGE jEdit class jEditHome jars new Vector EditBus addToBus new SettingsReloader SwingUtilities invokeLater new Runnable public void run Thread currentThread setContextClassLoader new JARClassLoader private static void initSystemProperties defaultProps props new Properties try loadProps jEdit class getResourceAsStream true loadProps jEdit class getResourceAsStream true loadProps jEdit class getResourceAsStream true catch Exception Log log Log ERROR jEdit class Log log Log ERROR jEdit class Log log Log ERROR jEdit class System exit private static void initSiteProperties String siteSettingsDirectory MiscUtilities constructPath jEditHome File siteSettings new File siteSettingsDirectory if siteSettings exists siteSettings isDirectory return String snippets siteSettings list if snippets null return MiscUtilities quicksort snippets new MiscUtilities StringICaseCompare for int snippets length String snippet snippets if snippet toLowerCase endsWith continue try String path MiscUtilities constructPath siteSettingsDirectory snippet Log log Log DEBUG jEdit class path loadProps new FileInputStream new File path true catch FileNotFoundException fnf Log log Log DEBUG jEdit class fnf catch IOException Log log Log ERROR jEdit class snippet Log log Log ERROR jEdit class private static void initActions actionSets new Vector Reader in new BufferedReader new InputStreamReader jEdit class getResourceAsStream builtInActionSet new ActionSet jEdit getProperty if loadActions in builtInActionSet System exit addActionSet builtInActionSet private static void initDockables Reader in new BufferedReader new InputStreamReader jEdit class getResourceAsStream if DockableWindowManager loadDockableWindows in builtInActionSet System exit private static void initPlugins if jEditHome null loadPlugins MiscUtilities constructPath jEditHome if settingsDirectory null File jarsDirectory new File settingsDirectory if jarsDirectory exists jarsDirectory mkdir loadPlugins jarsDirectory getPath private static void initUserProperties props new Properties defaultProps if settingsDirectory null File file new File MiscUtilities constructPath settingsDirectory propsModTime file lastModified try loadProps new FileInputStream file false catch FileNotFoundException fnf Log log Log DEBUG jEdit class fnf catch IOException Log log Log ERROR jEdit class private static void initPLAF theme new JEditMetalTheme theme propertiesChanged MetalLookAndFeel setCurrentTheme theme try String lf getProperty if lf null lf length UIManager setLookAndFeel lf catch Exception Log log Log ERROR jEdit class UIDefaults defaults UIManager getDefaults if jEdit getBooleanProperty Color background new javax swing plaf ColorUIResource jEdit getColorProperty Color foreground new javax swing plaf ColorUIResource jEdit getColorProperty Color caretColor new javax swing plaf ColorUIResource jEdit getColorProperty Color selectionColor new javax swing plaf ColorUIResource jEdit getColorProperty String prefixes for int prefixes length String prefix prefixes defaults put prefix background defaults put prefix background defaults put prefix foreground defaults put prefix foreground defaults put prefix caretColor defaults put prefix foreground defaults put prefix selectionColor defaults put background defaults put foreground defaults put background defaults put foreground defaults put foreground defaults put selectionColor defaults remove defaults remove private static void runStartupScripts File directory if directory isDirectory return File snippets directory listFiles if snippets null return MiscUtilities quicksort snippets new MiscUtilities StringICaseCompare for int snippets length File snippet snippets Macros Handler handler Macros getHandlerForPathName snippet getPath if handler null continue try Macros Macro newMacro handler createMacro snippet getName snippet getPath handler runMacro null newMacro false catch Exception Log log Log ERROR jEdit class private static void initProxy boolean socksEnabled jEdit getBooleanProperty if socksEnabled Log log Log DEBUG jEdit class System getProperties remove System getProperties remove else String socksHost jEdit getProperty if socksHost null System setProperty socksHost Log log Log DEBUG jEdit class socksHost String socksPort jEdit getProperty if socksPort null System setProperty socksPort boolean httpEnabled jEdit getBooleanProperty if httpEnabled Log log Log DEBUG jEdit class System getProperties remove System getProperties remove System getProperties remove System getProperties remove System getProperties remove System getProperties remove Authenticator setDefault null else String host jEdit getProperty if host null return System setProperty host Log log Log DEBUG jEdit class host String port jEdit getProperty if port null System setProperty port String nonProxyHosts jEdit getProperty if nonProxyHosts null System setProperty nonProxyHosts String username jEdit getProperty String password jEdit getProperty if password null password if username null username length Log log Log DEBUG jEdit class Authenticator setDefault new FirewallAuthenticator null else Log log Log DEBUG jEdit class username PasswordAuthentication pw new PasswordAuthentication username password toCharArray Authenticator setDefault new FirewallAuthenticator pw static class FirewallAuthenticator extends Authenticator PasswordAuthentication pw public FirewallAuthenticator PasswordAuthentication pw this pw pw protected PasswordAuthentication getPasswordAuthentication return pw private static void finishStartup final boolean gui final boolean restore final String userDir final String args SwingUtilities invokeLater new Runnable public void run Buffer buffer openFiles null userDir args String splitConfig null if restore settingsDirectory null jEdit getBooleanProperty bufferCount jEdit getBooleanProperty splitConfig restoreOpenFiles if bufferCount gui newFile null EditBus send new EditorStarted null if gui buffer null if buffer null newView null buffer else newView null splitConfig VFSManager start if server null server start GUIUtilities hideSplashScreen Log log Log MESSAGE jEdit class if pluginErrors null String caption jEdit getProperty pluginErrors size new Integer new Integer pluginErrors size new ErrorListDialog jEdit getFirstView jEdit getProperty caption pluginErrors true pluginErrors removeAllElements Toolkit getDefaultToolkit private static void getNotLoadedPluginJARs Vector returnValue String dir String list loop for int list length String name list if name toLowerCase endsWith continue loop String path MiscUtilities constructPath dir name for int jars size EditPlugin JAR jar EditPlugin JAR jars elementAt String jarPath jar getPath String jarName MiscUtilities getFileName jarPath if path equals jarPath continue loop else if new File jarPath exists name equals jarName continue loop returnValue addElement path private static void gotoMarker final View view final Buffer buffer final String marker VFSManager runInAWTThread new Runnable public void run int pos if marker startsWith try int line Integer parseInt marker substring pos buffer getLineStartOffset line catch Exception return else if marker startsWith if marker length return Marker buffer getMarker marker charAt if null return pos getPosition else throw new InternalError if view null view getBuffer buffer view getTextArea setCaretPosition pos else buffer setIntegerProperty Buffer CARET pos private static void addBufferToList Buffer buffer if viewCount buffersFirst null buffersFirst buffersLast buffersFirst isUntitled buffersFirst isDirty Buffer oldBuffersFirst buffersFirst buffersFirst buffersLast buffer EditBus send new BufferUpdate oldBuffersFirst null BufferUpdate CLOSED return bufferCount if buffersFirst null buffersFirst buffersLast buffer return else if sortBuffers String str11 str12 if sortByName str11 buffer getName str12 buffer getDirectory else str11 buffer getDirectory str12 buffer getName Buffer buffersFirst while null String str21 str22 if sortByName str21 getName str22 getDirectory else str21 getDirectory str22 getName int comp MiscUtilities compareStrings str11 str21 true if comp comp MiscUtilities compareStrings str12 str22 true buffer next buffer prev prev prev buffer if buffersFirst buffer prev next buffer else buffersFirst buffer return next buffer prev buffersLast buffersLast next buffer buffersLast buffer private static void removeBufferFromList Buffer buffer synchronized bufferListLock bufferCount if buffer buffersFirst buffer buffersLast buffersFirst buffersLast null return if buffer buffersFirst buffersFirst buffer next buffer next prev null else buffer prev next buffer next if buffer buffersLast buffersLast buffersLast prev buffer prev next null else buffer next prev buffer prev buffer next buffer prev null private static void addViewToList View view viewCount if viewsFirst null viewsFirst viewsLast view else view prev viewsLast viewsLast next view viewsLast view private static void removeViewFromList View view viewCount if viewsFirst viewsLast viewsFirst viewsLast null return if view viewsFirst viewsFirst view next view next prev null else view prev next view next if view viewsLast viewsLast viewsLast prev view prev next null else view next prev view prev private static void closeView View view boolean callExit if viewsFirst viewsLast callExit else EditBus send new ViewUpdate view ViewUpdate CLOSED view close removeViewFromList view if view activeView activeView null private static void loadModeCatalog String path boolean resource Log log Log MESSAGE jEdit class path ModeCatalogHandler handler new ModeCatalogHandler MiscUtilities getParentOfPath path resource XmlParser parser new XmlParser parser setHandler handler try InputStream if resource jEdit class getResourceAsStream path else new FileInputStream path BufferedReader in new BufferedReader new InputStreamReader parser parse null null in catch XmlException xe int line xe getLine String message xe getMessage Log log Log ERROR jEdit class path line message catch Exception Log log Log ERROR jEdit class private static void loadPlugins String directory Log log Log NOTICE jEdit class directory File file new File directory if file exists file isDirectory return String plugins file list if plugins null return MiscUtilities quicksort plugins new MiscUtilities StringICaseCompare for int plugins length String plugin plugins if plugin toLowerCase endsWith continue String path MiscUtilities constructPath directory plugin if plugin equals plugin equals plugin equals plugin equals pluginError path null continue try Log log Log DEBUG jEdit class path new JARClassLoader path catch IOException io Log log Log ERROR jEdit class plugin Log log Log ERROR jEdit class io String args io toString pluginError path args private static void initKeyBindings inputHandler removeAllKeyBindings EditAction actions getActions for int actions length EditAction action actions String shortcut1 jEdit getProperty action getName if shortcut1 null inputHandler addKeyBinding shortcut1 action String shortcut2 jEdit getProperty action getName if shortcut2 null inputHandler addKeyBinding shortcut2 action class BSHForStatement extends SimpleNode implements ParserConstants public boolean hasForInit public boolean hasExpression public boolean hasForUpdate private SimpleNode forInit private SimpleNode expression private SimpleNode forUpdate private SimpleNode statement private boolean parsed BSHForStatement int id super id public Object eval CallStack callstack Interpreter interpreter throws EvalError int if hasForInit forInit SimpleNode jjtGetChild if hasExpression expression SimpleNode jjtGetChild if hasForUpdate forUpdate SimpleNode jjtGetChild statement SimpleNode jjtGetChild NameSpace enclosingNameSpace callstack top BlockNameSpace forNameSpace new BlockNameSpace enclosingNameSpace callstack swap forNameSpace if hasForInit forInit eval callstack interpreter Object returnControl Primitive VOID while true if hasExpression boolean cond BSHIfStatement evaluateCondition expression callstack interpreter if cond break Object ret statement eval callstack interpreter if ret instanceof ReturnControl switch ReturnControl ret kind case RETURN returnControl ret breakout true break case CONTINUE break case BREAK breakout true break if breakout break if hasForUpdate forUpdate eval callstack interpreter return returnControl class BSHAmbiguousName extends SimpleNode public String text BSHAmbiguousName int id super id public Name getName NameSpace namespace return namespace getNameResolver text public Object toObject CallStack callstack Interpreter interpreter throws EvalError return getName callstack top toObject callstack interpreter public Class toClass NameSpace namespace throws EvalError return getName namespace toClass public LHS toLHS CallStack callstack Interpreter interpreter throws EvalError return getName callstack top toLHS callstack interpreter public Object eval CallStack callstack Interpreter interpreter throws EvalError throw new InterpreterError public String toString return text public class FileRootsVFS extends VFS public static final String PROTOCOL public FileRootsVFS super LOW_LATENCY_CAP if OperatingSystem hasJava14 try getSystemDisplayName FileSystemView class getMethod new Class java io File class getRoots FileSystemView class getMethod new Class isFileSystemRoot FileSystemView class getMethod new Class java io File class isFloppyDrive FileSystemView class getMethod new Class java io File class isDrive FileSystemView class getMethod new Class java io File class fsView FileSystemView getFileSystemView Log log Log DEBUG this catch Exception Log log Log DEBUG this public String getParentOfPath String path return PROTOCOL public VFS DirectoryEntry Object session String url Component comp File roots listRoots if roots null return null VFS DirectoryEntry rootDE new VFS DirectoryEntry roots length for int roots length String name roots getPath rootDE session name comp return rootDE public DirectoryEntry Object session String path Component comp File file new File path int type boolean isFloppy boolean isDirectory if isFloppyDrive null try isFloppy Boolean TRUE equals isFloppyDrive invoke fsView new Object file catch Exception isFloppy false else isFloppy path startsWith path startsWith if isDrive null try isDirectory Boolean TRUE equals isDrive invoke fsView new Object file file isDirectory catch Exception isDirectory file isDirectory else isDirectory file isDirectory if isFloppy isDirectory type VFS DirectoryEntry FILESYSTEM if isFileSystemRoot null try if Boolean FALSE equals isFileSystemRoot invoke fsView new Object file type VFS DirectoryEntry DIRECTORY catch Exception else type VFS DirectoryEntry FILE String name if getSystemDisplayName null isFloppy try name path String getSystemDisplayName invoke fsView new Object file catch Exception name path else if OperatingSystem isMacOS name getFileName path else name path return new VFS DirectoryEntry name path path type false private static FileSystemView fsView private static Method getSystemDisplayName private static Method getRoots private static Method isFileSystemRoot private static Method isFloppyDrive private static Method isDrive private static File listRoots if OperatingSystem isMacOS File volumes new File listFiles LinkedList roots new LinkedList roots add new File for int volumes length if volumes isDirectory roots add volumes return File roots toArray new File else File roots File listRoots File desktop null if getRoots null try desktop File getRoots invoke fsView new Object catch Exception Log log Log ERROR FileRootsVFS class getMessage desktop null if desktop null return roots File rootsPlus new File roots length desktop length System arraycopy desktop rootsPlus desktop length System arraycopy roots rootsPlus roots length return rootsPlus class HelpSearchPanel extends JPanel public HelpSearchPanel HelpViewer helpViewer super new BorderLayout this helpViewer helpViewer Box box new Box BoxLayout X_AXIS box add new JLabel jEdit getProperty box add Box createHorizontalStrut box add searchField new HistoryTextField searchField addActionListener new ActionHandler add BorderLayout NORTH box results new JList results addMouseListener new MouseHandler results setSelectionMode ListSelectionModel SINGLE_SELECTION results setCellRenderer new ResultRenderer add BorderLayout CENTER new JScrollPane results private HelpViewer helpViewer private HistoryTextField searchField private JList results private HelpIndex index private HelpIndex getHelpIndex if index null index new HelpIndex try index indexEditorHelp catch Exception index null Log log Log ERROR this GUIUtilities error helpViewer new String toString return index static class ResultIcon implements Icon private static RenderingHints renderingHints static HashMap hints new HashMap hints put RenderingHints KEY_RENDERING RenderingHints VALUE_RENDER_QUALITY hints put RenderingHints KEY_ANTIALIASING RenderingHints VALUE_ANTIALIAS_ON renderingHints new RenderingHints hints private int rank ResultIcon int rank this rank rank public int getIconWidth return public int getIconHeight return public void paintIcon Component Graphics int int Graphics2D g2d Graphics2D create g2d setRenderingHints renderingHints for int if rank g2d setColor UIManager getColor else g2d setColor UIManager getColor g2d fillOval class ResultRenderer extends DefaultListCellRenderer public Component getListCellRendererComponent JList list Object value int index boolean isSelected boolean cellHasFocus super getListCellRendererComponent list null index isSelected cellHasFocus if value instanceof String setIcon null setText String value else Result result Result value setIcon new ResultIcon result rank setText result title return this static class Result String file String title int rank Result HelpIndex HelpFile file int count this file file file this title file title rank count static class ResultCompare implements Comparator public int compare Object o1 Object o2 Result r1 Result o1 Result r2 Result o2 if r1 rank r2 rank return r1 title compareTo r2 title else return r2 rank r1 rank class ActionHandler implements ActionListener public void actionPerformed ActionEvent evt final HelpIndex index getHelpIndex if index null return results setListData new String jEdit getProperty final String text searchField getText final Vector resultModel new Vector VFSManager runInWorkThread new Runnable public void run StringTokenizer st new StringTokenizer text int maxRank while st hasMoreTokens String word st nextToken toLowerCase HelpIndex Word lookup index lookupWord word if lookup null continue for int lookup occurCount HelpIndex Word Occurrence occur lookup occurrences boolean ok false HelpIndex HelpFile file index getFile occur file for int resultModel size Result result Result resultModel elementAt if result file equals file file result rank occur count maxRank Math max result rank maxRank ok true break if ok maxRank Math max occur count maxRank resultModel addElement new Result file occur count if maxRank for int resultModel size Result result Result resultModel elementAt result rank int Math ceil double result rank maxRank Collections sort resultModel new ResultCompare VFSManager runInAWTThread new Runnable public void run if resultModel size results setListData new String jEdit getProperty getToolkit beep else results setListData resultModel public class MouseHandler extends MouseAdapter public void mouseReleased MouseEvent evt int row results locationToIndex evt getPoint if row Result result Result results getModel getElementAt row helpViewer gotoURL result file true public class IOProgressMonitor extends JPanel public IOProgressMonitor super new BorderLayout caption new JLabel updateCaption add BorderLayout NORTH caption threads new ThreadProgress VFSManager getIOThreadPool getThreadCount Box box new Box BoxLayout Y_AXIS for int threads length if box add Box createVerticalStrut threads new ThreadProgress box add threads JPanel threadPanel new JPanel new BorderLayout threadPanel setBorder new EmptyBorder threadPanel add BorderLayout NORTH box add BorderLayout CENTER new JScrollPane threadPanel workThreadHandler new WorkThreadHandler public void addNotify VFSManager getIOThreadPool addProgressListener workThreadHandler super addNotify public void removeNotify VFSManager getIOThreadPool removeProgressListener workThreadHandler super removeNotify private JLabel caption private ThreadProgress threads private WorkThreadHandler workThreadHandler private void updateCaption String args String valueOf VFSManager getIOThreadPool getRequestCount caption setText jEdit getProperty args class WorkThreadHandler implements WorkThreadProgressListener public void statusUpdate final WorkThreadPool pool final int index SwingUtilities invokeLater new Runnable public void run updateCaption threads index update public void progressUpdate final WorkThreadPool pool final int index SwingUtilities invokeLater new Runnable public void run updateCaption threads index update class ThreadProgress extends JPanel public ThreadProgress int index super new BorderLayout this index index Box box new Box BoxLayout Y_AXIS box add Box createGlue box add progress new JProgressBar progress setStringPainted true box add Box createGlue ThreadProgress this add BorderLayout CENTER box abort new JButton jEdit getProperty abort addActionListener new ActionHandler ThreadProgress this add BorderLayout EAST abort update public void update WorkThread thread VFSManager getIOThreadPool getThread index if thread isRequestRunning abort setEnabled true progress setString thread getStatus progress setMaximum thread getProgressMaximum progress setValue thread getProgressValue else abort setEnabled false progress setString jEdit getProperty progress setValue private int index private JProgressBar progress private JButton abort class ActionHandler implements ActionListener public void actionPerformed ActionEvent evt if evt getSource abort int result GUIUtilities confirm IOProgressMonitor this null JOptionPane YES_NO_OPTION JOptionPane QUESTION_MESSAGE if result JOptionPane YES_OPTION VFSManager getIOThreadPool getThread index abortCurrentRequest class PluginListDownloadProgress extends JDialog PluginListDownloadProgress PluginManager window super window jEdit getProperty true this window window JPanel content new JPanel new BorderLayout content setBorder new EmptyBorder setContentPane content JLabel caption new JLabel jEdit getProperty caption setBorder new EmptyBorder content add BorderLayout NORTH caption Box box new Box BoxLayout X_AXIS box add Box createGlue JButton stop new JButton jEdit getProperty stop addActionListener new ActionHandler stop setMaximumSize stop getPreferredSize box add stop box add Box createGlue content add BorderLayout CENTER box addWindowListener new WindowHandler setDefaultCloseOperation DO_NOTHING_ON_CLOSE pack setLocationRelativeTo window setResizable false show PluginList getPluginList return list private PluginManager window private PluginList list private DownloadThread thread class DownloadThread extends Thread public void run try list new PluginList dispose catch XmlException xe dispose int line xe getLine String path jEdit getProperty String message xe getMessage Log log Log ERROR this path line message String pp path String valueOf line message GUIUtilities error window pp catch Exception dispose Log log Log ERROR this String pp toString String ok jEdit getProperty String proxyButton jEdit getProperty int retVal JOptionPane showOptionDialog window jEdit getProperty pp jEdit getProperty JOptionPane YES_NO_OPTION JOptionPane ERROR_MESSAGE null new Object proxyButton ok ok if retVal new GlobalOptions window class ActionHandler implements ActionListener public void actionPerformed ActionEvent evt thread stop dispose class WindowHandler extends WindowAdapter boolean done public void windowOpened WindowEvent evt if done return done true thread new DownloadThread thread start public void windowClosing WindowEvent evt thread stop public class LineElement implements Element public LineElement Buffer buffer int line this buffer buffer this line line public Document getDocument return null public Element getParentElement return null public String getName return null public AttributeSet getAttributes return null public int getStartOffset return buffer getLineStartOffset line public int getEndOffset return buffer getLineEndOffset line public int getElementIndex int offset return public int getElementCount return public Element getElement int line return null public boolean isLeaf return true private Buffer buffer private int line public class BufferUpdate extends EBMessage public static final Object CREATED public static final Object LOAD_STARTED public static final Object LOADED public static final Object CLOSED public static final Object DIRTY_CHANGED public static final Object MARKERS_CHANGED public static final Object SAVING public static final Object SAVED public static final Object PROPERTIES_CHANGED public static final Object MODE_CHANGED public BufferUpdate Buffer buffer View view Object what super buffer this view view if what null throw new NullPointerException this what what public Object getWhat return what public Buffer getBuffer return Buffer getSource public View getView return view public String paramString return what view super paramString private Object what private View view public interface SearchFileSet String getFirstFile View view String getNextFile View view String path String getFiles View view int getFileCount View view String getCode class CommandLineReader extends FilterReader public CommandLineReader Reader in super in static final int normal lastCharNL sentSemi int state lastCharNL public int read throws IOException int if state sentSemi state lastCharNL return while in read if if state lastCharNL state sentSemi else state lastCharNL else state normal return public int read char buff int off int len throws IOException int read if else buff off char return public static void main String args throws Exception Reader in new CommandLineReader new InputStreamReader System in while true System out println in read public class Chunk extends Token public static boolean DEBUG false public static float paintChunkList Segment lineText Chunk chunks Graphics2D gfx float float Color background boolean glyphVector FontMetrics forBackground gfx getFontMetrics float for if chunks null return Chunk start chunks float width int length while chunks null start style chunks style start visible chunks visible start accessable chunks accessable length chunks length width chunks width chunks Chunk chunks next if DEBUG gfx draw new Rectangle2D Float width if start accessable Color bgColor start style getBackgroundColor if bgColor null Graphics2D xorGfx Graphics2D gfx create xorGfx setXORMode background xorGfx setColor bgColor xorGfx fill new Rectangle2D Float forBackground getAscent width forBackground getHeight xorGfx dispose if start visible gfx setFont start style getFont gfx setColor start style getForegroundColor if glyphVector start gv null start next chunks gfx drawGlyphVector start gv else gfx drawChars lineText array lineText offset start offset length int int width public static float offsetToX Chunk chunks int offset if chunks null offset chunks offset throw new ArrayIndexOutOfBoundsException offset chunks offset float while chunks null if chunks accessable offset chunks offset chunks length return chunks offsetToX offset chunks offset chunks width chunks Chunk chunks next return public static int xToOffset Chunk chunks float boolean round float while chunks null if chunks accessable chunks width return chunks xToOffset round chunks width chunks Chunk chunks next return public boolean accessable public boolean visible public boolean monospaced public float charWidth public SyntaxStyle style public float width public GlyphVector gv public Chunk float width int offset ParserRuleSet rules super Token NULL offset rules this width width public Chunk byte id int offset int length ParserRuleSet rules super id offset length rules accessable true public final float getPositions if gv null return null if positions null positions gv getGlyphPositions length null return positions public final float offsetToX int offset if visible return else if monospaced return offset charWidth else return getPositions offset public final int xToOffset float boolean round if visible if round width return offset length else return offset else if monospaced Math max float remainder charWidth int int charWidth if round remainder charWidth return offset else return offset else float pos getPositions for int length float glyphX pos float nextX length width pos if nextX if round nextX glyphX return offset else return offset return public void init Segment seg TabExpander expander float SyntaxStyle styles FontRenderContext fontRenderContext byte defaultID float charWidth style styles id Token WHITESPACE id Token TAB defaultID id if length seg array seg offset offset visible false float newX expander nextTabStop offset length width newX else if charWidth visible monospaced true this charWidth charWidth width charWidth length else visible true String str new String seg array seg offset offset length gv style getFont createGlyphVector fontRenderContext str width float gv getLogicalBounds getWidth private float positions public class EditAbbrevDialog extends JDialog public EditAbbrevDialog Frame frame String abbrev String expansion super frame jEdit getProperty true init abbrev expansion public EditAbbrevDialog Dialog dialog String abbrev String expansion super dialog jEdit getProperty true init abbrev expansion public String getAbbrev if isOK return null return editor getAbbrev public String getExpansion if isOK return null return editor getExpansion private AbbrevEditor editor private JButton ok private JButton cancel private boolean isOK private void init String abbrev String expansion JPanel content new JPanel new BorderLayout content setBorder new EmptyBorder setContentPane content editor new AbbrevEditor editor setAbbrev abbrev editor setExpansion expansion editor setBorder new EmptyBorder content add BorderLayout CENTER editor Box box new Box BoxLayout X_AXIS box add Box createGlue ok new JButton jEdit getProperty ok addActionListener new ActionHandler getRootPane setDefaultButton ok box add ok box add Box createHorizontalStrut cancel new JButton jEdit getProperty cancel addActionListener new ActionHandler box add cancel box add Box createGlue content add BorderLayout SOUTH box KeyListener listener new KeyHandler addKeyListener listener editor getBeforeCaretTextArea addKeyListener listener editor getAfterCaretTextArea addKeyListener listener setDefaultCloseOperation DISPOSE_ON_CLOSE pack setLocationRelativeTo getParent show class ActionHandler implements ActionListener public void actionPerformed ActionEvent evt if evt getSource ok if editor getAbbrev null editor getAbbrev length getToolkit beep return isOK true dispose class KeyHandler extends KeyAdapter public void keyPressed KeyEvent evt if evt getKeyCode KeyEvent VK_ESCAPE dispose public class SelectLineRange extends EnhancedDialog implements ActionListener public SelectLineRange View view super view jEdit getProperty true this view view JPanel content new JPanel new BorderLayout content setBorder new EmptyBorder setContentPane content JLabel label new JLabel jEdit getProperty label setBorder new EmptyBorder content add BorderLayout NORTH label JPanel panel createFieldPanel content add BorderLayout CENTER panel panel new JPanel panel setLayout new BoxLayout panel BoxLayout X_AXIS panel setBorder new EmptyBorder panel add Box createGlue panel add Box createGlue ok new JButton jEdit getProperty ok addActionListener this getRootPane setDefaultButton ok panel add ok panel add Box createHorizontalStrut cancel new JButton jEdit getProperty cancel addActionListener this panel add cancel panel add Box createGlue content add panel BorderLayout SOUTH GUIUtilities requestFocus this startField pack setLocationRelativeTo view show public void ok int startLine int endLine try startLine Integer parseInt startField getText endLine Integer parseInt endField getText catch NumberFormatException nf getToolkit beep return Buffer buffer view getBuffer if startLine endLine buffer getLineCount startLine endLine getToolkit beep return JEditTextArea textArea view getTextArea textArea setSelection new Selection Range buffer getLineStartOffset startLine buffer getLineEndOffset endLine textArea moveCaretPosition buffer getLineEndOffset endLine dispose public void cancel dispose public void actionPerformed ActionEvent evt Object source evt getSource if source ok ok else if source cancel cancel private View view private JTextField startField private JTextField endField private JButton ok private JButton cancel private JPanel createFieldPanel GridBagLayout layout new GridBagLayout JPanel panel new JPanel layout GridBagConstraints cons new GridBagConstraints cons insets new Insets cons gridwidth cons gridheight cons gridx cons gridy cons fill GridBagConstraints BOTH JLabel label new JLabel jEdit getProperty SwingConstants RIGHT layout setConstraints label cons panel add label startField new JTextField cons gridx cons weightx layout setConstraints startField cons panel add startField label new JLabel jEdit getProperty SwingConstants RIGHT cons gridx cons weightx cons gridy layout setConstraints label cons panel add label endField new JTextField cons gridx cons weightx layout setConstraints endField cons panel add endField return panel public class ExplicitFoldHandler extends FoldHandler public ExplicitFoldHandler super public int getFoldLevel Buffer buffer int lineIndex Segment seg if lineIndex return else int tabSize buffer getTabSize int foldLevel buffer getFoldLevel lineIndex buffer getLineText lineIndex seg int offset seg offset int count seg count int openingBrackets closingBrackets for int count switch seg array offset case closingBrackets openingBrackets if openingBrackets foldLevel tabSize openingBrackets break case openingBrackets closingBrackets if closingBrackets if foldLevel tabSize foldLevel tabSize closingBrackets break default closingBrackets openingBrackets break return foldLevel public class GeneralOptionPane extends AbstractOptionPane public GeneralOptionPane super protected void history new JTextField jEdit getProperty addComponent jEdit getProperty history saveCaret new JCheckBox jEdit getProperty saveCaret setSelected jEdit getBooleanProperty addComponent saveCaret sortBuffers new JCheckBox jEdit getProperty sortBuffers setSelected jEdit getBooleanProperty sortBuffers addActionListener new ActionListener public void actionPerformed ActionEvent evt sortByName setEnabled sortBuffers isSelected addComponent sortBuffers sortByName new JCheckBox jEdit getProperty sortByName setSelected jEdit getBooleanProperty sortByName setEnabled sortBuffers isSelected addComponent sortByName sortRecent new JCheckBox jEdit getProperty sortRecent setSelected jEdit getBooleanProperty addComponent sortRecent checkModStatus new JCheckBox jEdit getProperty checkModStatus setSelected jEdit getBooleanProperty addComponent checkModStatus showFullPath new JCheckBox jEdit getProperty showFullPath setSelected jEdit getBooleanProperty addComponent showFullPath showSearchbar new JCheckBox jEdit getProperty showSearchbar setSelected jEdit getBooleanProperty addComponent showSearchbar beepOnSearchAutoWrap new JCheckBox jEdit getProperty beepOnSearchAutoWrap setSelected jEdit getBooleanProperty addComponent beepOnSearchAutoWrap showBufferSwitcher new JCheckBox jEdit getProperty showBufferSwitcher setSelected jEdit getBooleanProperty addComponent showBufferSwitcher showTips new JCheckBox jEdit getProperty showTips setSelected jEdit getBooleanProperty addComponent showTips showSplash new JCheckBox jEdit getProperty String settingsDirectory jEdit getSettingsDirectory if settingsDirectory null showSplash setSelected true else showSplash setSelected new File settingsDirectory exists addComponent showSplash protected void jEdit setProperty history getText jEdit setBooleanProperty saveCaret isSelected jEdit setBooleanProperty sortBuffers isSelected jEdit setBooleanProperty sortByName isSelected jEdit setBooleanProperty sortRecent isSelected jEdit setBooleanProperty checkModStatus isSelected jEdit setBooleanProperty showFullPath isSelected jEdit setBooleanProperty showSearchbar isSelected jEdit setBooleanProperty beepOnSearchAutoWrap isSelected jEdit setBooleanProperty showBufferSwitcher isSelected jEdit setBooleanProperty showTips isSelected String settingsDirectory jEdit getSettingsDirectory if settingsDirectory null File file new File settingsDirectory if showSplash isSelected file delete else try FileOutputStream out new FileOutputStream file out write out close catch IOException io Log log Log ERROR this io private JTextField history private JCheckBox saveCaret private JCheckBox sortBuffers private JCheckBox sortByName private JCheckBox sortRecent private JCheckBox checkModStatus private JCheckBox showFullPath private JCheckBox showSearchbar private JCheckBox beepOnSearchAutoWrap private JCheckBox showBufferSwitcher private JCheckBox showTips private JCheckBox showSplash public class ToolBarManager public ToolBarManager Container top Container bottom this top top this bottom bottom public void addToolBar int group int layer Component toolbar Entry entry new Entry layer toolbar if group View TOP_GROUP addToolBar top topToolBars entry else if group View BOTTOM_GROUP addToolBar bottom bottomToolBars entry else throw new InternalError public void removeToolBar Component toolbar removeToolBar top topToolBars toolbar removeToolBar bottom bottomToolBars toolbar private Container top private Container bottom private ArrayList topToolBars new ArrayList private ArrayList bottomToolBars new ArrayList private void addToolBar Container group ArrayList toolbars Entry entry for int toolbars size if entry layer Entry toolbars get layer toolbars add entry group add entry toolbar return toolbars add entry group add entry toolbar private void removeToolBar Container group ArrayList toolbars Component toolbar for int toolbars size if toolbar Entry toolbars get toolbar group remove toolbar toolbars remove return static class Entry int layer Component toolbar Entry int layer Component toolbar this layer layer this toolbar toolbar public class MiscUtilities public static String canonPath String path if File separatorChar path path replace if path startsWith File separator path path substring String home System getProperty if home endsWith File separator return home path else return home File separator path else if path equals return System getProperty else return path public static boolean isAbsolutePath String path if isURL path return true else if OperatingSystem isDOSDerived if path length path charAt return true if path startsWith return true else if OperatingSystem isUnix if path length path charAt return true return false public static String constructPath String parent String path if MiscUtilities isURL path return path else if path startsWith return path else if OperatingSystem isDOSDerived if path length path charAt return path else if path length path charAt if path charAt path path substring path substring return resolveSymlinks path else if path startsWith return resolveSymlinks path else if OperatingSystem isUnix if path length path charAt return resolveSymlinks path if parent null parent System getProperty if OperatingSystem isDOSDerived path startsWith parent parent substring VFS vfs VFSManager getVFSForPath parent return vfs constructPath parent path public static String constructPath String parent String path1 String path2 return constructPath constructPath parent path1 path2 public static String concatPath String parent String path parent canonPath parent path canonPath path if path startsWith File separator path path substring else if path length path charAt path path replace File separatorChar if parent null parent System getProperty if parent endsWith File separator return parent path else return parent File separator path public static String getFileExtension String name int index name indexOf if index return else return name substring index public static String getFileName String path return VFSManager getVFSForPath path getFileName path public static String getFileNameNoExtension String path String name getFileName path int index name lastIndexOf if index return name else return name substring index public static String getFileParent String path return getParentOfPath path public static String getParentOfPath String path return VFSManager getVFSForPath path getParentOfPath path public static String getFileProtocol String url return getProtocolOfURL url public static String getProtocolOfURL String url return url substring url indexOf public static boolean isURL String str int fsIndex Math max str indexOf File separatorChar str indexOf return false return false int cIndex str indexOf return false return false return true public static void saveBackup File file int backups String backupPrefix String backupSuffix String backupDirectory if backupPrefix null backupPrefix if backupSuffix null backupSuffix String name file getName if backups File backupFile new File backupDirectory backupPrefix name backupSuffix backupFile delete file renameTo backupFile else new File backupDirectory backupPrefix name backupSuffix backups backupSuffix delete for int backups File backup new File backupDirectory backupPrefix name backupSuffix backupSuffix backup renameTo new File backupDirectory backupPrefix name backupSuffix backupSuffix file renameTo new File backupDirectory backupPrefix name backupSuffix backupSuffix public static String fileToClass String name char clsName name toCharArray for int clsName length if clsName clsName return new String clsName clsName length public static String classToFile String name return name replace concat public static int getLeadingWhiteSpace String str int whitespace loop for whitespace str length switch str charAt whitespace case case whitespace break default break loop return whitespace public static int getTrailingWhiteSpace String str int whitespace loop for int str length switch str charAt case case whitespace break default break loop return whitespace public static int getLeadingWhiteSpaceWidth String str int tabSize int whitespace loop for int str length switch str charAt case whitespace break case whitespace tabSize whitespace tabSize break default break loop return whitespace public static int getVirtualWidth Segment seg int tabSize int virtualPosition for int seg count char ch seg array seg offset if ch virtualPosition tabSize virtualPosition tabSize else virtualPosition return virtualPosition public static int getOffsetOfVirtualColumn Segment seg int tabSize int column int totalVirtualWidth int virtualPosition for int seg count char ch seg array seg offset if ch int tabWidth tabSize virtualPosition tabSize if virtualPosition column return else virtualPosition tabWidth else if virtualPosition column return else virtualPosition if totalVirtualWidth null totalVirtualWidth virtualPosition return public static String createWhiteSpace int len int tabSize StringBuffer buf new StringBuffer if tabSize while len buf append else int count len tabSize while count buf append count len tabSize while count buf append return buf toString public static String globToRE String glob StringBuffer buf new StringBuffer boolean backslash false boolean insideGroup false boolean insideNegativeLookahead false for int glob length char glob charAt if backslash buf append buf append backslash false continue switch case backslash true break case buf append break case buf append break case buf append break case buf append if glob length glob charAt buf append insideNegativeLookahead true else insideGroup true break case if insideGroup if insideNegativeLookahead buf append insideNegativeLookahead false buf append else buf append break case if insideNegativeLookahead buf append insideNegativeLookahead false else if insideGroup buf append insideGroup false else buf append break default buf append return buf toString public static String escapesToChars String str StringBuffer buf new StringBuffer for int str length char str charAt switch case if str length buf append break str charAt switch case buf append break case buf append break default buf append break break default buf append return buf toString public static String charsToEscapes String str return charsToEscapes str public static String charsToEscapes String str String toEscape StringBuffer buf new StringBuffer for int str length char str charAt if toEscape indexOf if buf append else if buf append else buf append buf append else buf append return buf toString public static int compareVersions String v1 String v2 return compareStrings v1 v2 false public static int compareStrings String str1 String str2 boolean ignoreCase char char1 str1 toCharArray char char2 str2 toCharArray int len Math min char1 length char2 length for int len len char ch1 char1 char ch2 char2 if Character isDigit ch1 Character isDigit ch2 ch1 ch2 int int for char1 length if Character isDigit char1 break for char2 length if Character isDigit char2 break int len1 int len2 if len1 len2 return else if len1 len2 return else for int len1 ch1 char1 ch2 char2 if ch1 ch2 return ch1 ch2 else if ignoreCase ch1 Character toLowerCase ch1 ch2 Character toLowerCase ch2 if ch1 ch2 return ch1 ch2 return char1 length char2 length public static boolean stringsEqual String s1 String s2 if s1 null if s2 null return true else return false else if s2 null return false else return s1 equals s2 public static void quicksort Object obj Comparator compare Arrays sort obj compare public static void quicksort Vector vector Comparator compare Collections sort vector compare public static void quicksort List list Comparator compare Collections sort list compare public static void quicksort Object obj Compare compare Arrays sort obj compare public static void quicksort Vector vector Compare compare Collections sort vector compare public interface Compare extends Comparator int compare Object obj1 Object obj2 public static class StringCompare implements Compare public int compare Object obj1 Object obj2 return compareStrings obj1 toString obj2 toString false public static class StringICaseCompare implements Compare public int compare Object obj1 Object obj2 return compareStrings obj1 toString obj2 toString true public static class MenuItemCompare implements Compare public int compare Object obj1 Object obj2 return compareStrings JMenuItem obj1 getText JMenuItem obj2 getText true public static String buildToVersion String build if build length return build int major Integer parseInt build substring int minor Integer parseInt build substring int beta Integer parseInt build substring int bugfix Integer parseInt build substring return major minor beta beta bugfix bugfix public static boolean isToolsJarAvailable Log log Log DEBUG MiscUtilities class Vector paths new Vector paths addElement System getProperty try try Class forName catch ClassNotFoundException e1 Class forName Log log Log DEBUG MiscUtilities class return true catch ClassNotFoundException String settingsDir jEdit getSettingsDirectory if settingsDir null String toolsPath constructPath settingsDir paths addElement toolsPath if new File toolsPath exists Log log Log DEBUG MiscUtilities class return true String jEditDir jEdit getJEditHome if jEditDir null String toolsPath constructPath jEditDir paths addElement toolsPath if new File toolsPath exists Log log Log DEBUG MiscUtilities class return true String toolsPath System getProperty if toolsPath toLowerCase endsWith File separator toolsPath toolsPath substring toolsPath length toolsPath constructPath toolsPath paths addElement toolsPath if new File toolsPath exists Log log Log WARNING MiscUtilities class paths toString return false EditPlugin JAR jar jEdit getPluginJAR toolsPath if jar null Log log Log DEBUG MiscUtilities class toolsPath try jEdit addPluginJAR new EditPlugin JAR toolsPath new JARClassLoader toolsPath catch IOException ioex Log log Log ERROR MiscUtilities class toolsPath Log log Log ERROR MiscUtilities class ioex return false else Log log Log DEBUG MiscUtilities class return true public static int parsePermissions String int permissions if length if charAt permissions if charAt permissions if charAt permissions else if charAt permissions else if charAt permissions if charAt permissions if charAt permissions if charAt permissions else if charAt permissions else if charAt permissions if charAt permissions if charAt permissions if charAt permissions else if charAt permissions else if charAt permissions return permissions private MiscUtilities private static String resolveSymlinks String path try return new File path getCanonicalPath catch IOException io return path interface Node extends java io Serializable public void jjtOpen public void jjtClose public void jjtSetParent Node public Node jjtGetParent public void jjtAddChild Node int public Node jjtGetChild int public int jjtGetNumChildren public class Gutter extends JComponent implements SwingConstants public static final int LOWEST_LAYER Integer MIN_VALUE public static final int DEFAULT_LAYER public static final int HIGHEST_LAYER Integer MAX_VALUE public Gutter View view JEditTextArea textArea this view view this textArea textArea setAutoscrolls true setOpaque true extensionMgr new ExtensionManager MouseHandler ml new MouseHandler addMouseListener ml addMouseMotionListener ml addExtension new MarkerHighlight public void paintComponent Graphics Graphics2D gfx Graphics2D Rectangle clip gfx getClipBounds gfx setColor getBackground gfx fillRect clip clip clip width clip height if textArea getBuffer isLoaded return int lineHeight textArea getPainter getFontMetrics getHeight int firstLine clip lineHeight int lastLine clip clip height lineHeight int clip clip lineHeight textArea chunkCache updateChunksUpTo lastLine for int line firstLine line lastLine line lineHeight paintLine gfx line public void addExtension TextAreaExtension extension extensionMgr addExtension DEFAULT_LAYER extension repaint public void addExtension int layer TextAreaExtension extension extensionMgr addExtension layer extension repaint public void removeExtension TextAreaExtension extension extensionMgr removeExtension extension repaint public TextAreaExtension getExtensions return extensionMgr getExtensions public String getToolTipText MouseEvent evt if textArea getBuffer isLoaded return null return extensionMgr getToolTipText evt getX evt getY public void setBorder int width Color color1 Color color2 Color color3 this borderWidth width focusBorder new CompoundBorder new MatteBorder width color3 new MatteBorder width color1 noFocusBorder new CompoundBorder new MatteBorder width color3 new MatteBorder width color2 updateBorder public void updateBorder SwingUtilities invokeLater new Runnable public void run if view getEditPane null return if view getEditPane getTextArea textArea setBorder focusBorder else setBorder noFocusBorder public void setBorder Border border super setBorder border if border null collapsedSize width collapsedSize height else Insets insets border getBorderInsets this collapsedSize width FOLD_MARKER_SIZE insets right collapsedSize height gutterSize height insets top insets bottom gutterSize width FOLD_MARKER_SIZE insets right fm stringWidth revalidate public void setFont Font font super setFont font fm getFontMetrics font baseline fm getAscent Border border getBorder if border null gutterSize width FOLD_MARKER_SIZE border getBorderInsets this right fm stringWidth revalidate public Color getHighlightedForeground return intervalHighlight public void setHighlightedForeground Color highlight intervalHighlight highlight public Color getCurrentLineForeground return currentLineHighlight public void setCurrentLineForeground Color highlight currentLineHighlight highlight public Color getFoldColor return foldColor public void setFoldColor Color foldColor this foldColor foldColor public Dimension getPreferredSize if expanded return gutterSize else return collapsedSize public Dimension getMinimumSize return getPreferredSize public int getLineNumberAlignment return alignment public void setLineNumberAlignment int alignment if this alignment alignment return this alignment alignment repaint public boolean isExpanded return expanded public void setExpanded boolean expanded if this expanded expanded return this expanded expanded textArea revalidate public void toggleExpanded setExpanded expanded public int getHighlightInterval return interval public void setHighlightInterval int interval if interval interval this interval interval repaint public boolean isCurrentLineHighlightEnabled return currentLineHighlightEnabled public void setCurrentLineHighlightEnabled boolean enabled if currentLineHighlightEnabled enabled return currentLineHighlightEnabled enabled repaint public final Color getBracketHighlightColor return bracketHighlightColor public final void setBracketHighlightColor Color bracketHighlightColor this bracketHighlightColor bracketHighlightColor repaint public final boolean isBracketHighlightEnabled return bracketHighlight public final void setBracketHighlightEnabled boolean bracketHighlight this bracketHighlight bracketHighlight repaint public Color getMarkerHighlightColor return markerHighlightColor public void setMarkerHighlightColor Color markerHighlightColor this markerHighlightColor markerHighlightColor public boolean isMarkerHighlightEnabled return markerHighlight public void setMarkerHighlightEnabled boolean markerHighlight this markerHighlight markerHighlight private static final int FOLD_MARKER_SIZE private View view private JEditTextArea textArea private ExtensionManager extensionMgr private int baseline private Dimension gutterSize new Dimension private Dimension collapsedSize new Dimension private Color intervalHighlight private Color currentLineHighlight private Color foldColor private FontMetrics fm private int alignment private int interval private boolean currentLineHighlightEnabled private boolean expanded private boolean bracketHighlight private Color bracketHighlightColor private boolean markerHighlight private Color markerHighlightColor private int borderWidth private Border focusBorder noFocusBorder private void paintLine Graphics2D gfx int line int Buffer buffer textArea getBuffer int lineHeight textArea getPainter getFontMetrics getHeight ChunkCache LineInfo info textArea chunkCache getLineInfo line if info chunksValid System err println int physicalLine info physicalLine if physicalLine int start textArea getScreenLineStartOffset line int end textArea getScreenLineEndOffset line extensionMgr paintValidLine gfx line physicalLine start end else extensionMgr paintInvalidLine gfx line if physicalLine return if info firstSubregion physicalLine buffer getLineCount buffer isFoldStart physicalLine int lineHeight gfx setColor foldColor if textArea getFoldVisibilityManager isLineVisible physicalLine gfx drawLine gfx drawLine gfx drawLine gfx drawLine gfx drawLine else gfx drawLine gfx drawLine gfx drawLine gfx drawLine gfx drawLine else if bracketHighlight int bracketLine textArea getBracketLine int caretLine textArea getCaretLine if textArea isBracketHighlightVisible physicalLine Math min caretLine bracketLine physicalLine Math max caretLine bracketLine int caretScreenLine if caretLine textArea getLastPhysicalLine caretScreenLine Integer MAX_VALUE else caretScreenLine textArea getScreenLineOfOffset textArea getCaretPosition int bracketScreenLine if bracketLine textArea getLastPhysicalLine bracketScreenLine Integer MAX_VALUE else bracketScreenLine textArea chunkCache getScreenLineOfOffset bracketLine textArea getBracketPosition if caretScreenLine bracketScreenLine int tmp caretScreenLine caretScreenLine bracketScreenLine bracketScreenLine tmp gfx setColor bracketHighlightColor if bracketScreenLine caretScreenLine else if line caretScreenLine gfx fillRect lineHeight gfx fillRect lineHeight lineHeight lineHeight else if line bracketScreenLine gfx fillRect lineHeight gfx fillRect lineHeight else if line caretScreenLine line bracketScreenLine gfx fillRect lineHeight if info firstSubregion expanded String number Integer toString physicalLine int offset switch alignment case RIGHT offset gutterSize width collapsedSize width fm stringWidth number break case CENTER offset gutterSize width collapsedSize width fm stringWidth number break case LEFT default offset break boolean highlightCurrentLine currentLineHighlightEnabled textArea selection size if physicalLine textArea getCaretLine highlightCurrentLine gfx setColor currentLineHighlight else if interval line textArea getFirstLine interval gfx setColor intervalHighlight else gfx setColor getForeground gfx drawString number FOLD_MARKER_SIZE offset baseline class MouseHandler extends MouseInputAdapter boolean drag int toolTipInitialDelay toolTipReshowDelay public void mouseEntered MouseEvent ToolTipManager ttm ToolTipManager sharedInstance toolTipInitialDelay ttm getInitialDelay toolTipReshowDelay ttm getReshowDelay ttm setInitialDelay ttm setReshowDelay public void mouseExited MouseEvent evt ToolTipManager ttm ToolTipManager sharedInstance ttm setInitialDelay toolTipInitialDelay ttm setReshowDelay toolTipReshowDelay public void mousePressed MouseEvent if GUIUtilities isPopupTrigger getX getWidth borderWidth translatePoint getWidth textArea mouseHandler mousePressed drag true else Buffer buffer textArea getBuffer int screenLine getY textArea getPainter getFontMetrics getHeight textArea chunkCache updateChunksUpTo screenLine int line textArea chunkCache getLineInfo screenLine physicalLine if line return FoldVisibilityManager foldVisibilityManager textArea getFoldVisibilityManager if buffer isFoldStart line StringBuffer property new StringBuffer if isShiftDown property append if isControlDown property append if isAltDown property append property append String action jEdit getProperty property toString if action null action jEdit getProperty if action null action if action equals foldVisibilityManager expandFold line true textArea selectFold line else if foldVisibilityManager isLineVisible line foldVisibilityManager collapseFold line else if action equals foldVisibilityManager expandFold line true else foldVisibilityManager expandFold line false else if bracketHighlight if textArea isBracketHighlightVisible int bracketLine textArea getBracketLine int caretLine textArea getCaretLine if caretLine bracketLine if caretLine bracketLine int tmp caretLine caretLine bracketLine bracketLine tmp if line caretLine line bracketLine if isControlDown textArea selectToMatchingBracket else textArea goToMatchingBracket public void mouseDragged MouseEvent translatePoint getWidth textArea mouseHandler mouseDragged public void mouseReleased MouseEvent if drag getX getWidth borderWidth translatePoint getWidth textArea mouseHandler mouseReleased drag false class MarkerHighlight extends TextAreaExtension public void paintValidLine Graphics2D gfx int screenLine int physicalLine int start int end int if isMarkerHighlightEnabled Buffer buffer textArea getBuffer if buffer getMarkerInRange start end null gfx setColor getMarkerHighlightColor FontMetrics fm textArea getPainter getFontMetrics gfx fillRect textArea getGutter getWidth fm getHeight public String getToolTipText int int if isMarkerHighlightEnabled int line textArea getPainter getFontMetrics getHeight int start textArea getScreenLineStartOffset line int end textArea getScreenLineEndOffset line if start end return null Marker marker textArea getBuffer getMarkerInRange start end if marker null char shortcut marker getShortcut if shortcut return jEdit getProperty else String args String valueOf shortcut return jEdit getProperty args return null class BSHBinaryExpression extends SimpleNode implements ParserConstants public int kind BSHBinaryExpression int id super id public Object eval CallStack callstack Interpreter interpreter throws EvalError Object lhs SimpleNode jjtGetChild eval callstack interpreter if kind INSTANCEOF if lhs Primitive NULL return new Primitive false if lhs instanceof Primitive return new Primitive false NameSpace namespace callstack top Class rhs BSHType jjtGetChild getType namespace boolean ret Reflect isAssignableFrom rhs lhs getClass return new Primitive ret if kind BOOL_AND kind BOOL_ANDX Object obj lhs if isPrimitiveValue lhs obj Primitive lhs getValue if obj instanceof Boolean Boolean obj booleanValue false return new Primitive false if kind BOOL_OR kind BOOL_ORX Object obj lhs if isPrimitiveValue lhs obj Primitive lhs getValue if obj instanceof Boolean Boolean obj booleanValue true return new Primitive true boolean isLhsWrapper isWrapper lhs Object rhs SimpleNode jjtGetChild eval callstack interpreter boolean isRhsWrapper isWrapper rhs if isLhsWrapper isPrimitiveValue lhs isRhsWrapper isPrimitiveValue rhs if isLhsWrapper isRhsWrapper kind EQ else try return Primitive binaryOperation lhs rhs kind catch TargetError reThrow this switch kind case EQ return new Primitive lhs rhs case NE return new Primitive lhs rhs case PLUS if lhs instanceof String rhs instanceof String return lhs toString rhs toString default if lhs instanceof Primitive rhs instanceof Primitive if lhs Primitive VOID rhs Primitive VOID throw new EvalError this else if lhs Primitive NULL rhs Primitive NULL throw new EvalError this throw new EvalError tokenImage kind this private boolean isPrimitiveValue Object obj return obj instanceof Primitive obj Primitive VOID obj Primitive NULL private boolean isWrapper Object obj return obj instanceof Boolean obj instanceof Character obj instanceof Number public class This implements java io Serializable Runnable NameSpace namespace transient Interpreter declaringInterpreter static This getThis NameSpace namespace Interpreter declaringInterpreter try if Capabilities canGenerateInterfaces return This Reflect constructObject new Object namespace declaringInterpreter else if Capabilities haveSwing return This Reflect constructObject new Object namespace declaringInterpreter else return new This namespace declaringInterpreter catch Exception throw new InterpreterError public Object getInterface Class clas throws EvalError if clas isInstance this return this else throw new EvalError clas protected This NameSpace namespace Interpreter declaringInterpreter this namespace namespace this declaringInterpreter declaringInterpreter public NameSpace getNameSpace return namespace public String toString return namespace name public void run try invokeMethod new Object catch EvalError declaringInterpreter error public Object invokeMethod String name Object args throws EvalError return invokeMethod name args declaringInterpreter null null public Object invokeMethod String name Object args Interpreter interpreter CallStack callstack SimpleNode callerInfo throws EvalError return namespace invokeMethod name args interpreter callstack callerInfo public static void bind This ths NameSpace namespace Interpreter declaringInterpreter ths namespace setParent namespace ths declaringInterpreter declaringInterpreter CallStack newCallStack CallStack callstack new CallStack callstack push namespace return callstack class BSHTryStatement extends SimpleNode BSHTryStatement int id super id public Object eval CallStack callstack Interpreter interpreter throws EvalError BSHBlock tryBlock BSHBlock jjtGetChild Vector catchParams new Vector Vector catchBlocks new Vector int nchild jjtGetNumChildren Node node null int while nchild node jjtGetChild instanceof BSHFormalParameter catchParams addElement node catchBlocks addElement jjtGetChild node null BSHBlock finallyBlock null if node null finallyBlock BSHBlock node TargetError target null Throwable thrown null Object ret null int callstackDepth callstack depth try ret tryBlock eval callstack interpreter catch TargetError target String stackInfo while callstack depth callstackDepth stackInfo callstack pop if target null thrown target getTarget if thrown null int catchParams size for BSHFormalParameter fp BSHFormalParameter catchParams elementAt fp eval callstack top if fp type null try thrown Throwable NameSpace getAssignableForm thrown fp type catch EvalError continue BSHBlock cb BSHBlock catchBlocks elementAt NameSpace enclosingNameSpace callstack top BlockNameSpace cbNameSpace new BlockNameSpace enclosingNameSpace if fp type BSHFormalParameter UNTYPED cbNameSpace setVariable fp name thrown else cbNameSpace setTypedVariable fp name fp type thrown false callstack swap cbNameSpace try ret cb eval callstack interpreter finally callstack swap enclosingNameSpace break if finallyBlock null ret finallyBlock eval callstack interpreter if target null throw target if ret instanceof ReturnControl return ret else return Primitive VOID 