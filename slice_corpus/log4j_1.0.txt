public class ISO8601DateFormat extends AbsoluteTimeDateFormat public ISO8601DateFormat public ISO8601DateFormat TimeZone timeZone super timeZone public StringBuffer format Date date StringBuffer sbuf FieldPosition fieldPosition calendar setTime date int year calendar get Calendar YEAR sbuf append year String month switch calendar get Calendar MONTH case Calendar JANUARY month break case Calendar FEBRUARY month break case Calendar MARCH month break case Calendar APRIL month break case Calendar MAY month break case Calendar JUNE month break case Calendar JULY month break case Calendar AUGUST month break case Calendar SEPTEMBER month break case Calendar OCTOBER month break case Calendar NOVEMBER month break case Calendar DECEMBER month break default month break sbuf append month int day calendar get Calendar DAY_OF_MONTH if day sbuf append sbuf append day sbuf append return super format date sbuf fieldPosition public Date parse java lang String ParsePosition pos return null public class Transform public static void main String args throws Exception PropertyConfigurator disableAll PropertyConfigurator configure Processor processor Processor newInstance XMLReader reader XMLReaderFactory createXMLReader TemplatesBuilder templatesBuilder processor getTemplatesBuilder reader setContentHandler templatesBuilder if templatesBuilder instanceof LexicalHandler templatesBuilder reader parse args Templates templates templatesBuilder getTemplates Transformer transformer templates newTransformer FileOutputStream fos new FileOutputStream args Result result new Result fos Serializer serializer SerializerFactory getSerializer serializer setOutputStream fos transformer setContentHandler serializer asContentHandler org xml sax ContentHandler chandler transformer getInputContentHandler DC dc new DC chandler reader setContentHandler dc if chandler instanceof LexicalHandler chandler else null reader parse args class DC implements ContentHandler static Category cat Category getInstance ContentHandler chandler DC ContentHandler chandler this chandler chandler public void characters char ch int start int length throws org xml sax SAXException cat debug new String ch start length chandler characters ch start length public void endDocument throws org xml sax SAXException cat debug chandler endDocument public void endElement String namespaceURI String localName String qName throws org xml sax SAXException cat debug namespaceURI localName qName chandler endElement namespaceURI localName qName public void endPrefixMapping String prefix throws org xml sax SAXException cat debug prefix chandler endPrefixMapping prefix public void ignorableWhitespace char ch int start int length throws org xml sax SAXException cat debug chandler ignorableWhitespace ch start length public void processingInstruction java lang String target java lang String data throws org xml sax SAXException cat debug chandler processingInstruction target data public void setDocumentLocator Locator locator cat debug chandler setDocumentLocator locator public void skippedEntity String name throws org xml sax SAXException cat debug name chandler skippedEntity name public void startDocument throws org xml sax SAXException cat debug chandler startDocument public void startElement String namespaceURI String localName String qName Attributes atts throws org xml sax SAXException cat debug namespaceURI localName qName if equals qName cat debug if atts instanceof org xml sax helpers AttributesImpl AttributesImpl ai AttributesImpl atts int atts getIndex ai setValue String ts atts getValue cat debug ts chandler startElement namespaceURI localName qName atts public void startPrefixMapping String prefix String uri throws org xml sax SAXException cat debug prefix uri chandler startPrefixMapping prefix uri public class AppenderAttachableImpl implements AppenderAttachable protected Vector appenderList public void addAppender Appender newAppender if newAppender null return if appenderList null appenderList new Vector if appenderList contains newAppender appenderList addElement newAppender public int appendLoopOnAppenders LoggingEvent event int size Appender appender if appenderList null size appenderList size for int size appender Appender appenderList elementAt appender doAppend event return size public Enumeration getAllAppenders if appenderList null return null else return appenderList elements public Appender getAppender String name if appenderList null name null return null int size appenderList size Appender appender for int size appender Appender appenderList elementAt if name equals appender getName return appender return null public void removeAllAppenders if appenderList null int len appenderList size for int len Appender Appender appenderList elementAt close appenderList removeAllElements appenderList null public void removeAppender Appender appender if appender null appenderList null return appenderList removeElement appender public void removeAppender String name if name null appenderList null return int size appenderList size for int size if name equals Appender appenderList elementAt getName appenderList removeElementAt break abstract public class DateLayout extends Layout public final static String NULL_DATE_FORMAT public final static String RELATIVE_TIME_DATE_FORMAT protected FieldPosition pos new FieldPosition final static public String DATE_FORMAT_OPTION final static public String TIMEZONE_OPTION private String timeZoneID private String dateFormatOption protected DateFormat dateFormat protected Date date new Date public void activateOptions setDateFormat dateFormatOption if timeZoneID null dateFormat null dateFormat setTimeZone TimeZone getTimeZone timeZoneID public String getOptionStrings return new String DATE_FORMAT_OPTION TIMEZONE_OPTION public void dateFormat StringBuffer buf LoggingEvent event if dateFormat null date setTime event timeStamp dateFormat format date buf this pos buf append public void setDateFormat DateFormat dateFormat TimeZone timeZone this dateFormat dateFormat this dateFormat setTimeZone timeZone public void setDateFormat String dateFormatType setDateFormat dateFormatType TimeZone getDefault public void setDateFormat String dateFormatType TimeZone timeZone if dateFormatType null this dateFormat null return if dateFormatType equalsIgnoreCase NULL_DATE_FORMAT this dateFormat null else if dateFormatType equalsIgnoreCase RELATIVE_TIME_DATE_FORMAT this dateFormat new RelativeTimeDateFormat else if dateFormatType equalsIgnoreCase AbsoluteTimeDateFormat ABS_TIME_DATE_FORMAT this dateFormat new AbsoluteTimeDateFormat timeZone else if dateFormatType equalsIgnoreCase AbsoluteTimeDateFormat DATE_AND_TIME_DATE_FORMAT this dateFormat new DateTimeDateFormat timeZone else if dateFormatType equalsIgnoreCase AbsoluteTimeDateFormat ISO8601_DATE_FORMAT this dateFormat new ISO8601DateFormat timeZone else this dateFormat new SimpleDateFormat dateFormatType this dateFormat setTimeZone timeZone public void setOption String option String value if option equalsIgnoreCase DATE_FORMAT_OPTION dateFormatOption value toUpperCase else if option equalsIgnoreCase TIMEZONE_OPTION timeZoneID value public abstract class Layout implements OptionHandler public final static String LINE_SEP System getProperty public final static int LINE_SEP_LEN LINE_SEP length abstract public String format LoggingEvent event public String getContentType return public String getHeader return null public String getFooter return null abstract public boolean ignoresThrowable public class SyslogAppender extends AppenderSkeleton final static public int LOG_KERN final static public int LOG_USER final static public int LOG_MAIL final static public int LOG_DAEMON final static public int LOG_AUTH final static public int LOG_SYSLOG final static public int LOG_LPR final static public int LOG_NEWS final static public int LOG_UUCP final static public int LOG_CRON final static public int LOG_AUTHPRIV final static public int LOG_FTP final static public int LOG_LOCAL0 final static public int LOG_LOCAL1 final static public int LOG_LOCAL2 final static public int LOG_LOCAL3 final static public int LOG_LOCAL4 final static public int LOG_LOCAL5 final static public int LOG_LOCAL6 final static public int LOG_LOCAL7 public static final String SYSLOG_HOST_OPTION public static final String FACILITY_OPTION public static final String FACILITY_PRINTING_OPTION protected static final int SYSLOG_HOST_OI protected static final int FACILITY_OI int syslogFacility LOG_USER String facilityStr boolean facilityPrinting false SyslogTracerPrintWriter stp SyslogQuietWriter sqw String syslogHost public SyslogAppender this initSyslogFacilityStr this syslogFacility public SyslogAppender Layout layout int syslogFacility this layout layout this syslogFacility syslogFacility this initSyslogFacilityStr syslogFacility public SyslogAppender Layout layout String syslogHost int syslogFacility this layout syslogFacility setSyslogHost syslogHost public void close closed true sqw null stp null private void initSyslogFacilityStr int syslogFacility switch syslogFacility case LOG_KERN facilityStr break case LOG_USER facilityStr break case LOG_MAIL facilityStr break case LOG_DAEMON facilityStr break case LOG_AUTH facilityStr break case LOG_SYSLOG facilityStr break case LOG_LPR facilityStr break case LOG_NEWS facilityStr break case LOG_UUCP facilityStr break case LOG_CRON facilityStr break case LOG_AUTHPRIV facilityStr break case LOG_FTP facilityStr break case LOG_LOCAL0 facilityStr break case LOG_LOCAL1 facilityStr break case LOG_LOCAL2 facilityStr break case LOG_LOCAL3 facilityStr break case LOG_LOCAL4 facilityStr break case LOG_LOCAL5 facilityStr break case LOG_LOCAL6 facilityStr break case LOG_LOCAL7 facilityStr break default System err println syslogFacility this syslogFacility LOG_USER facilityStr public void append LoggingEvent event if isAsSevereAsThreshold event priority return if sqw null errorHandler error this name return String buffer facilityPrinting facilityStr layout format event sqw setPriority event priority getSyslogEquivalent sqw write buffer if event throwable null event throwable printStackTrace stp else if event throwableInformation null sqw write event throwableInformation public void activateOptions public String getOptionStrings return OptionConverter concatanateArrays super getOptionStrings new String SYSLOG_HOST_OPTION FACILITY_OPTION FACILITY_PRINTING_OPTION public boolean requiresLayout return true public void setFacility String facilityName if facilityName null return if equalsIgnoreCase facilityName this syslogFacility LOG_KERN else if equalsIgnoreCase facilityName this syslogFacility LOG_USER else if equalsIgnoreCase facilityName this syslogFacility LOG_MAIL else if equalsIgnoreCase facilityName this syslogFacility LOG_DAEMON else if equalsIgnoreCase facilityName this syslogFacility LOG_AUTH else if equalsIgnoreCase facilityName this syslogFacility LOG_SYSLOG else if equalsIgnoreCase facilityName this syslogFacility LOG_LPR else if equalsIgnoreCase facilityName this syslogFacility LOG_NEWS else if equalsIgnoreCase facilityName this syslogFacility LOG_UUCP else if equalsIgnoreCase facilityName this syslogFacility LOG_CRON else if equalsIgnoreCase facilityName this syslogFacility LOG_AUTHPRIV else if equalsIgnoreCase facilityName this syslogFacility LOG_FTP else if equalsIgnoreCase facilityName this syslogFacility LOG_LOCAL0 else if equalsIgnoreCase facilityName this syslogFacility LOG_LOCAL1 else if equalsIgnoreCase facilityName this syslogFacility LOG_LOCAL2 else if equalsIgnoreCase facilityName this syslogFacility LOG_LOCAL3 else if equalsIgnoreCase facilityName this syslogFacility LOG_LOCAL4 else if equalsIgnoreCase facilityName this syslogFacility LOG_LOCAL5 else if equalsIgnoreCase facilityName this syslogFacility LOG_LOCAL6 else if equalsIgnoreCase facilityName this syslogFacility LOG_LOCAL7 else System err println facilityName this syslogFacility LOG_USER this initSyslogFacilityStr this syslogFacility if sqw null sqw setSyslogFacility this syslogFacility public void setOption String option String value if value null return super setOption option value if option equals SYSLOG_HOST_OPTION this setSyslogHost value else if option equals FACILITY_PRINTING_OPTION facilityPrinting OptionConverter toBoolean value facilityPrinting else if option equals FACILITY_OPTION this setFacility value public void setSyslogHost String syslogHost this sqw new SyslogQuietWriter new SyslogWriter syslogHost syslogFacility errorHandler this stp new SyslogTracerPrintWriter sqw this syslogHost syslogHost public class DefaultInit static Category cat Category getInstance DefaultInit class getName public static void main String argv cat debug static void Usage String msg System err println msg System err println System exit public class ConcatVsArray static void Usage System err println System exit public static void main String args if args length Usage String s1 args String s2 args int runLength try runLength Integer parseInt args catch java lang NumberFormatException System err println Usage double micros String sa long before new Date getTime for int runLength sa new String s1 s2 micros new Date getTime before runLength System out println micros String before new Date getTime for int runLength s1 s2 micros new Date getTime before runLength System out println micros public class OnlyOnceErrorHandler implements ErrorHandler final String WARN_PREFIX final String ERROR_PREFIX boolean firstTime true public void activateOptions public void error String message Exception int errorCode if firstTime LogLog error message firstTime false public String getOptionStrings return null public void setOption String key String value public void error String message if firstTime LogLog error message firstTime false public class TTCCLayout extends DateLayout final static public String THREAD_PRINTING_OPTION final static public String CATEGORY_PREFIXING_OPTION final static public String CONTEXT_PRINTING_OPTION private boolean threadPrinting true private boolean categoryPrefixing true private boolean contextPrinting true protected final StringBuffer buf new StringBuffer public TTCCLayout this setDateFormat RELATIVE_TIME_DATE_FORMAT null public TTCCLayout String dateFormatType this setDateFormat dateFormatType public String format LoggingEvent event buf setLength dateFormat buf event if this threadPrinting buf append buf append event getThreadName buf append buf append event priority toString buf append if this categoryPrefixing buf append event categoryName buf append if this contextPrinting event getNDC if event ndc null buf append event ndc buf append buf append buf append event message buf append LINE_SEP return buf toString public String getOptionStrings return OptionConverter concatanateArrays super getOptionStrings new String THREAD_PRINTING_OPTION CATEGORY_PREFIXING_OPTION CONTEXT_PRINTING_OPTION public boolean ignoresThrowable return true public void setOption String key String value super setOption key value if key equalsIgnoreCase THREAD_PRINTING_OPTION threadPrinting OptionConverter toBoolean value threadPrinting else if key equalsIgnoreCase CATEGORY_PREFIXING_OPTION categoryPrefixing OptionConverter toBoolean value categoryPrefixing else if key equalsIgnoreCase CONTEXT_PRINTING_OPTION contextPrinting OptionConverter toBoolean value contextPrinting public void setCategoryPrefixing boolean categoryPrefixing this categoryPrefixing categoryPrefixing public void setThreadPrinting boolean threadPrinting this threadPrinting threadPrinting public class Hello static Category cat Category getInstance Hello class public static void main String argv BasicConfigurator configure cat debug cat info public interface OptionHandler void activateOptions String getOptionStrings void setOption String option String value public class BasicConfigurator public static final String DISABLE_OVERRIDE_KEY public static final String INHERITED static String override null String propertyName DISABLE_OVERRIDE_KEY try override System getProperty propertyName override catch SecurityException LogLog debug propertyName if override null if OptionConverter toBoolean override true LogLog debug DISABLE_OVERRIDE_KEY override Category disable Category DISABLE_OVERRIDE protected BasicConfigurator protected void addRenderer String renderedClassName String renderingClassName LogLog debug renderingClassName renderedClassName ObjectRenderer renderer ObjectRenderer OptionConverter instantiateByClassName renderingClassName ObjectRenderer class null if renderer null LogLog error renderingClassName return else try Class renderedClass Class forName renderedClassName Category defaultHierarchy rendererMap put renderedClass renderer catch ClassNotFoundException LogLog error renderedClassName static public void configure Category root Category getRoot root addAppender new FileAppender new PatternLayout PatternLayout TTCC_CONVERSION_PATTERN System out static public void configure Appender appender Category root Category getRoot root addAppender appender static public void disable Priority if Category disable Category DISABLE_OVERRIDE Category disable level static public void disableAll disable Priority FATAL static public void disableDebug disable Priority DEBUG static public void disableInfo disable Priority INFO static public void enableAll Category disable Category DISABLE_OFF public static void flagAsShippedCode disableInfo protected static void overrideAsNeeded String override if override null LogLog debug override if OptionConverter toBoolean override true LogLog debug Category disable Category DISABLE_OVERRIDE public static void resetConfiguration Category defaultHierarchy getRoot setPriority Priority DEBUG Category defaultHierarchy root setResourceBundle null Category disable Category DISABLE_OFF synchronized Category defaultHierarchy ht Enumeration cats Category getCurrentCategories while cats hasMoreElements Category Category cats nextElement setPriority null setAdditivity true setResourceBundle null Category defaultHierarchy rendererMap clear public class SocketNode implements Runnable Socket socket Hierarchy hierarchy ObjectInputStream ois static Category cat Category getInstance SocketNode class getName public SocketNode Socket socket Hierarchy hierarchy this socket socket this hierarchy hierarchy try ois new ObjectInputStream socket getInputStream catch Exception cat error socket public void run LoggingEvent event Category remoteCategory try while true event LoggingEvent ois readObject remoteCategory hierarchy getInstance event categoryName if event priority isGreaterOrEqual remoteCategory getChainedPriority remoteCategory callAppenders event catch java io EOFException cat info catch java net SocketException cat info catch Exception cat error try ois close catch Exception cat info public class L7D static ResourceBundle bundles public static void main String args if args length init args args args else Usage test static void Usage String msg System err println msg System err println L7D class getName System exit static void init String configFile String lanCode String countryCode PropertyConfigurator configure configFile bundles new ResourceBundle try bundles ResourceBundle getBundle new Locale bundles ResourceBundle getBundle new Locale bundles ResourceBundle getBundle new Locale catch MissingResourceException printStackTrace static void test Category root Category getRoot for int bundles length root setResourceBundle bundles root l7dlog Priority DEBUG null root l7dlog Priority INFO null root l7dlog Priority WARN null root l7dlog Priority DEBUG new Object new Integer null root l7dlog Priority ERROR new Object new Integer null root l7dlog Priority ERROR new Object new Integer null root l7dlog Priority INFO null public class MultipleAppenders public static void main String argv PropertyConfigurator configure argv Category root Category getRoot Enumeration e1 root getAllAppenders Vector new Vector while e1 hasMoreElements Appender Appender e1 nextElement addElement String appenderName getName if root getAppender appenderName System out println appenderName System exit root addAppender root addAppender null Enumeration e2 root getAllAppenders for int size if elementAt e2 nextElement if e2 hasMoreElements System out println System exit System out println public class NullEnumeration implements Enumeration private static final NullEnumeration instance new NullEnumeration private NullEnumeration public static NullEnumeration getInstance return instance public boolean hasMoreElements return false public Object nextElement throw new NoSuchElementException public class RollingFileAppender extends FileAppender static final public String MAX_FILE_SIZE_OPTION static final public String MAX_BACKUP_INDEX_OPTION protected long maxFileSize protected int maxBackupIndex public RollingFileAppender super public RollingFileAppender Layout layout OutputStream os super layout os public RollingFileAppender Layout layout Writer writer super layout writer public RollingFileAppender Layout layout String filename boolean append throws IOException super layout filename append public RollingFileAppender Layout layout String filename throws IOException super layout filename public String getOptionStrings return OptionConverter concatanateArrays super getOptionStrings new String MAX_FILE_SIZE_OPTION MAX_BACKUP_INDEX_OPTION public synchronized void setFile String fileName boolean append throws IOException super setFile fileName append if append File new File fileName CountingQuietWriter qw setCount length public synchronized void rollOver File target File file if maxBackupIndex file new File fileName maxBackupIndex if file exists file delete for int maxBackupIndex file new File fileName if file exists target new File fileName file renameTo target target new File fileName file new File fileName file renameTo target try this setFile fileName false catch IOException System err println fileName printStackTrace public void setMaxBackupIndex int maxBackups this maxBackupIndex maxBackups public void setMaxFileSize long maxFileSize this maxFileSize maxFileSize public void setOption String key String value super setOption key value if key equalsIgnoreCase MAX_FILE_SIZE_OPTION maxFileSize OptionConverter toFileSize value maxFileSize else if key equalsIgnoreCase MAX_BACKUP_INDEX_OPTION maxBackupIndex OptionConverter toInt value maxBackupIndex protected void setQWForFiles Writer writer this qw new CountingQuietWriter writer errorHandler protected void subAppend LoggingEvent event super subAppend event if fileName null CountingQuietWriter qw getCount maxFileSize this rollOver public abstract class AppenderSkeleton implements Appender OptionHandler protected Layout layout protected String name protected Priority threshold protected ErrorHandler errorHandler new OnlyOnceErrorHandler protected Filter headFilter protected Filter tailFilter protected boolean closed false public static final String THRESHOLD_OPTION public void activateOptions public void addFilter Filter newFilter if headFilter null headFilter tailFilter newFilter else tailFilter next newFilter tailFilter newFilter abstract protected void append LoggingEvent event public void clearFilters headFilter tailFilter null public void finalize if this closed return LogLog debug name close public ErrorHandler getErrorHandler return this errorHandler public final Filter getFirstFilter return headFilter public final String getName return this name public String getOptionStrings return new String THRESHOLD_OPTION public boolean isAsSevereAsThreshold Priority priority return threshold null priority isGreaterOrEqual threshold public synchronized void doAppend LoggingEvent event if closed LogLog error name if isAsSevereAsThreshold event priority return Filter this headFilter FILTER_LOOP while null switch decide event case Filter DENY return case Filter ACCEPT break FILTER_LOOP case Filter NEUTRAL next this append event public void setErrorHandler ErrorHandler eh if eh null LogLog error else this errorHandler eh public void setLayout Layout layout this layout layout public void setName String name this name name public void setOption String key String value if key equalsIgnoreCase THRESHOLD_OPTION threshold Priority toPriority value public void setThreshold Priority threshold this threshold threshold public class NTMin static Category cat Category getInstance NTMin class getName public static void main String argv init test static void Usage String msg System err println msg System err println NTMin class System exit static void init BasicConfigurator configure new NTEventLogAppender static void test String host NDC push host int cat debug cat info cat warn cat error cat log Priority FATAL cat debug new Exception public class QuietWriter extends FilterWriter protected ErrorHandler errorHandler public QuietWriter Writer writer ErrorHandler errorHandler super writer setErrorHandler errorHandler public void write String string try out write string catch IOException errorHandler error string ErrorCode WRITE_FAILURE public void flush try out flush catch IOException errorHandler error ErrorCode FLUSH_FAILURE public void setErrorHandler ErrorHandler eh if eh null throw new IllegalArgumentException else this errorHandler eh class CategoryKey String name int hashCache CategoryKey String name this name name intern hashCache name hashCode final public int hashCode return hashCache final public boolean equals Object rArg if this rArg return true if rArg null CategoryKey class rArg getClass return name CategoryKey rArg name else return false public class ConfigurationFileParsing public static void main String argv if argv length NDC push PropertyConfigurator configure argv Category root Category getRoot root debug root debug NDC pop else Usage static void Usage String msg System err println msg System err println ConfigurationFileParsing class getName System exit public class Priority int level String levelStr int syslogEquivalent final static int FATAL_INT final static int ERROR_INT final static int WARN_INT final static int INFO_INT final static int DEBUG_INT final static public Priority FATAL new Priority FATAL_INT final static public Priority ERROR new Priority ERROR_INT final static public Priority WARN new Priority WARN_INT final static public Priority INFO new Priority INFO_INT final static public Priority DEBUG new Priority DEBUG_INT protected Priority int level String levelStr int syslogEquivalent this level level this levelStr levelStr this syslogEquivalent syslogEquivalent public final int getSyslogEquivalent return syslogEquivalent final public String toString return levelStr public final int toInt return level public boolean isGreaterOrEqual Priority return level level public static Priority getAllPossiblePriorities return new Priority Priority FATAL Priority ERROR Priority WARN Priority INFO Priority DEBUG public static Priority toPriority String sArg return toPriority sArg Priority DEBUG public static Priority toPriority int val switch val case DEBUG_INT return DEBUG case INFO_INT return INFO case WARN_INT return WARN case ERROR_INT return ERROR case FATAL_INT return FATAL default return DEBUG public static Priority toPriority String sArg Priority defaultPriority if sArg null return defaultPriority String sArg toUpperCase if equals return Priority DEBUG if equals return Priority INFO if equals return Priority WARN if equals return Priority ERROR if equals return Priority FATAL return defaultPriority public class TracerPrintWriter extends PrintWriter protected QuietWriter qWriter public TracerPrintWriter QuietWriter qWriter super qWriter this qWriter qWriter final public void setQuietWriter QuietWriter qWriter this qWriter qWriter public void println Object this qWriter write toString this qWriter write org apache log4j Layout LINE_SEP public void println char this println new String public void println String this qWriter write this qWriter write org apache log4j Layout LINE_SEP public class LocationInfo implements java io Serializable transient String lineNumber transient String fileName transient String className transient String methodName public String fullInfo private static StringWriter sw new StringWriter private static PrintWriter pw new PrintWriter sw public final static String NA static final long serialVersionUID static boolean inVisualAge false try Class dummy Class forName inVisualAge true LogLog debug catch Throwable public LocationInfo Throwable String fqnOfCallingClass if null return String synchronized sw printStackTrace pw sw toString sw getBuffer setLength int ibegin iend ibegin lastIndexOf fqnOfCallingClass if ibegin return ibegin indexOf Layout LINE_SEP ibegin if ibegin return ibegin Layout LINE_SEP_LEN iend indexOf Layout LINE_SEP ibegin if iend return if inVisualAge ibegin lastIndexOf iend if ibegin return ibegin this fullInfo substring ibegin iend public String getClassName if fullInfo null return NA if className null int iend fullInfo lastIndexOf if iend className NA else iend fullInfo lastIndexOf iend if iend className NA else className this fullInfo substring iend return className public String getFileName if fullInfo null return NA if fileName null int iend fullInfo lastIndexOf if iend fileName NA else int ibegin fullInfo lastIndexOf iend fileName this fullInfo substring ibegin iend return fileName public String getLineNumber if fullInfo null return NA if lineNumber null int iend fullInfo lastIndexOf int ibegin fullInfo lastIndexOf iend if ibegin lineNumber NA else lineNumber this fullInfo substring ibegin iend return lineNumber public String getMethodName if fullInfo null return NA if methodName null int iend fullInfo lastIndexOf int ibegin fullInfo lastIndexOf iend if ibegin methodName NA else methodName this fullInfo substring ibegin iend return methodName public class LogLog public static final String CONFIG_DEBUG_KEY protected static boolean configDebugEnabled false private static final String PREFIX private static final String ERR_PREFIX private static final String WARN_PREFIX static try String key System getProperty CONFIG_DEBUG_KEY if key null configDebugEnabled OptionConverter toBoolean key true catch SecurityException System err println PREFIX CONFIG_DEBUG_KEY static public void setInternalDebugging boolean enabled configDebugEnabled enabled public static void debug String msg if configDebugEnabled System out println PREFIX msg public static void debug String msg Throwable if configDebugEnabled System out println PREFIX msg if null printStackTrace System out public static void error String msg System err println ERR_PREFIX msg public static void error String msg Throwable System err println ERR_PREFIX msg if null printStackTrace public static void warn String msg System err println WARN_PREFIX msg public static void warn String msg Throwable System err println WARN_PREFIX msg if null printStackTrace public class BoundedFIFO LoggingEvent buf int numElements int first int next int maxSize public BoundedFIFO int maxSize if maxSize throw new IllegalArgumentException maxSize this maxSize maxSize buf new LoggingEvent maxSize public LoggingEvent get if numElements return null LoggingEvent buf first if first maxSize first numElements return public void put LoggingEvent if numElements maxSize buf next if next maxSize next numElements public int getMaxSize return maxSize public boolean isFull return numElements maxSize public int length return numElements public boolean wasEmpty return numElements public boolean wasFull return numElements maxSize public class LoggingEvent implements java io Serializable private static long startTime System currentTimeMillis transient public String fqnOfCategoryClass public String categoryName transient public Priority priority public String ndc public boolean ndcLookupRequired true public String message public String threadName transient public Throwable throwable public String throwableInformation public long timeStamp public LocationInfo locationInfo static final long serialVersionUID public LoggingEvent String fqnOfCategoryClass Category category Priority priority String message Throwable throwable this fqnOfCategoryClass fqnOfCategoryClass this categoryName category getName this priority priority this message message this throwable throwable timeStamp System currentTimeMillis public static long getStartTime return startTime public String getNDC if ndcLookupRequired ndcLookupRequired false ndc NDC get return ndc public String getThreadName if threadName null threadName Thread currentThread getName return threadName public String getThrowableInformation if throwable null return null if throwableInformation null StringWriter sw new StringWriter PrintWriter pw new PrintWriter sw throwable printStackTrace pw throwableInformation sw toString return throwableInformation private void writeObject ObjectOutputStream oos throws java io IOException this getThreadName this getNDC this getThrowableInformation oos defaultWriteObject oos writeInt priority toInt private void readObject ObjectInputStream ois throws java io IOException ClassNotFoundException ois defaultReadObject priority Priority toPriority ois readInt if locationInfo null locationInfo new LocationInfo null null public void setLocationInformation if locationInfo null locationInfo new LocationInfo new Throwable fqnOfCategoryClass public class Loader extends java lang Object public static Image getGIF_Image String path Image img null try URL url ClassLoader getSystemResource path System out println url img Image Toolkit getDefaultToolkit getImage url catch Exception System out println getMessage return img public static Image getGIF_Image URL url Image img null try System out println url img Image Toolkit getDefaultToolkit getImage url catch Exception System out println getMessage return img public static URL getHTML_Page String path URL url null return url ClassLoader getSystemResource path public class XMLLayout extends Layout private final int DEFAULT_SIZE private final int UPPER_LIMIT private StringBuffer buf new StringBuffer DEFAULT_SIZE private boolean locationInfo false public static final String LOCATION_INFO_OPTION public void activateOptions public String format LoggingEvent event if buf capacity UPPER_LIMIT buf new StringBuffer DEFAULT_SIZE else buf setLength buf append buf append event categoryName buf append buf append event timeStamp buf append buf append event priority buf append buf append event getThreadName buf append buf append buf append event message buf append String ndc event getNDC if ndc null buf append buf append ndc buf append String event getThrowableInformation if null buf append buf append buf append if locationInfo event setLocationInformation buf append buf append event locationInfo getClassName buf append buf append event locationInfo getMethodName buf append buf append event locationInfo getFileName buf append buf append event locationInfo getLineNumber buf append buf append return buf toString public String getOptionStrings return new String LOCATION_INFO_OPTION public boolean ignoresThrowable return false public void setOption String key String value if value null return if key equals LOCATION_INFO_OPTION locationInfo OptionConverter toBoolean value locationInfo final public class RootCategory extends Category public RootCategory Priority priority super this priority priority final public Priority getChainedPriority return priority final public void setPriority Priority priority if priority null LogLog error new Throwable else this priority priority public class ShortSocketServer static Category cat Category getInstance ShortSocketServer class getName static int port static int delay static void delay int amount try Thread currentThread sleep amount catch Exception public static void main String argv if argv length init argv argv argv else usage try LogLog debug port ServerSocket serverSocket new ServerSocket port LogLog debug Socket socket serverSocket accept LogLog debug socket getInetAddress LogLog debug SocketNode sn new SocketNode socket Category getDefaultHierarchy Thread new Thread sn start join catch Exception cat error static void usage String msg System err println msg System err println ShortSocketServer class getName System exit static void init String portStr String configFile String delayStr try port Integer parseInt portStr catch java lang NumberFormatException printStackTrace usage portStr try delay Integer parseInt delayStr catch java lang NumberFormatException printStackTrace usage delayStr PropertyConfigurator configure configFile public class FileAppender extends AppenderSkeleton public static final String FILE_OPTION public static final String IMMEDIATE_FLUSH_OPTION public static final String APPEND_OPTION protected boolean fileAppend true protected boolean immediateFlush true protected QuietWriter qw protected TracerPrintWriter tp protected String fileName null protected boolean qwIsOurs false public FileAppender public FileAppender Layout layout OutputStream os this layout new OutputStreamWriter os public FileAppender Layout layout Writer writer this layout layout this setWriter writer public FileAppender Layout layout String filename boolean append throws IOException this layout layout this setFile filename append public FileAppender Layout layout String filename throws IOException this layout filename true public void activateOptions if fileName null try setFile fileName fileAppend catch java io IOException errorHandler error fileName fileAppend ErrorCode FILE_OPEN_FAILURE public void append LoggingEvent event if checkEntryConditions return subAppend event protected boolean checkEntryConditions if this qw null errorHandler error name return false if this layout null errorHandler error name return false return true public void close this closed true reset protected void closeWriterIfOurs if this qwIsOurs this qw null try this qw close catch java io IOException LogLog error qw public String getOptionStrings return OptionConverter concatanateArrays super getOptionStrings new String FILE_OPTION APPEND_OPTION IMMEDIATE_FLUSH_OPTION public synchronized void setErrorHandler ErrorHandler eh this errorHandler eh if this qwIsOurs this qw null this qw setErrorHandler eh public synchronized void setFile String fileName boolean append throws IOException reset this setQWForFiles new FileWriter fileName append this tp new TracerPrintWriter qw this fileName fileName this qwIsOurs true public void setFile String fileName throws IOException this setFile fileName fileAppend public void setOption String key String value if value null return super setOption key value if key equalsIgnoreCase FILE_OPTION value value trim if value equalsIgnoreCase setWriter new OutputStreamWriter System out else if value equalsIgnoreCase setWriter new OutputStreamWriter System err else fileName value else if key equalsIgnoreCase APPEND_OPTION fileAppend OptionConverter toBoolean value fileAppend else if key equalsIgnoreCase IMMEDIATE_FLUSH_OPTION immediateFlush OptionConverter toBoolean value immediateFlush public synchronized void setWriter Writer writer reset this qw new QuietWriter writer errorHandler this tp new TracerPrintWriter qw this qwIsOurs false protected void setQWForFiles Writer writer this qw new QuietWriter writer errorHandler protected void subAppend LoggingEvent event this qw write this layout format event if layout ignoresThrowable if event throwable null event throwable printStackTrace this tp else if event throwableInformation null this qw write event throwableInformation if this immediateFlush this qw flush public boolean requiresLayout return true protected void reset closeWriterIfOurs this fileName null this qw null this tp null class SyslogTracerPrintWriter extends TracerPrintWriter static String TAB SyslogTracerPrintWriter QuietWriter qWriter super qWriter public void println Object this qWriter write toString public void println String this qWriter write TAB substring public class TextPaneAppender extends AppenderSkeleton JTextPane textpane StyledDocument doc TracerPrintWriter tp StringWriter sw QuietWriter qw Hashtable attributes Hashtable icons private String label private boolean fancy final String LABEL_OPTION final String COLOR_OPTION_FATAL final String COLOR_OPTION_ERROR final String COLOR_OPTION_WARN final String COLOR_OPTION_INFO final String COLOR_OPTION_DEBUG final String COLOR_OPTION_BACKGROUND final String FANCY_OPTION final String FONT_NAME_OPTION final String FONT_SIZE_OPTION public static Image loadIcon String path Image img null try URL url ClassLoader getSystemResource path img Image Toolkit getDefaultToolkit getImage url catch Exception System out println getMessage return img public TextPaneAppender Layout layout String name this this layout layout this name name setTextPane new JTextPane createAttributes createIcons public TextPaneAppender super setTextPane new JTextPane createAttributes createIcons this label this sw new StringWriter this qw new QuietWriter sw errorHandler this tp new TracerPrintWriter qw this fancy true public void close private void createAttributes Priority prio Priority getAllPossiblePriorities attributes new Hashtable for int prio length MutableAttributeSet att new SimpleAttributeSet attributes put prio att StyleConstants setFontSize att StyleConstants setForeground MutableAttributeSet attributes get Priority ERROR Color red StyleConstants setForeground MutableAttributeSet attributes get Priority WARN Color orange StyleConstants setForeground MutableAttributeSet attributes get Priority INFO Color gray StyleConstants setForeground MutableAttributeSet attributes get Priority DEBUG Color black private void createIcons Priority prio Priority getAllPossiblePriorities icons new Hashtable for int prio length if prio equals Priority FATAL icons put prio new ImageIcon loadIcon if prio equals Priority ERROR icons put prio new ImageIcon loadIcon if prio equals Priority WARN icons put prio new ImageIcon loadIcon if prio equals Priority INFO icons put prio new ImageIcon loadIcon if prio equals Priority DEBUG icons put prio new ImageIcon loadIcon public void append LoggingEvent event String text this layout format event String trace if event throwable null event throwable printStackTrace tp for int sw getBuffer length if sw getBuffer charAt sw getBuffer replace trace sw toString sw getBuffer delete sw getBuffer length try if fancy textpane setEditable true textpane insertIcon ImageIcon icons get event priority textpane setEditable false doc insertString doc getLength text trace MutableAttributeSet attributes get event priority catch BadLocationException badex System err println badex textpane setCaretPosition doc getLength public JTextPane getTextPane return textpane public String getLabel return label public String getOptionStrings return new String LABEL_OPTION COLOR_OPTION_FATAL COLOR_OPTION_ERROR COLOR_OPTION_WARN COLOR_OPTION_INFO COLOR_OPTION_DEBUG COLOR_OPTION_BACKGROUND FANCY_OPTION FONT_NAME_OPTION FONT_SIZE_OPTION private Color parseColor String StringTokenizer st new StringTokenizer int val int while st hasMoreTokens val Integer parseInt st nextToken return new Color val val val val public void setLayout Layout layout this layout layout public void setName String name this name name public void setTextPane JTextPane textpane this textpane textpane textpane setEditable false textpane setBackground Color lightGray this doc textpane getStyledDocument private void setColor Priority String StyleConstants setForeground MutableAttributeSet attributes get parseColor private void setFontSize int size Enumeration attributes elements while hasMoreElements StyleConstants setFontSize MutableAttributeSet nextElement size return private void setFontName String name Enumeration attributes elements while hasMoreElements StyleConstants setFontFamily MutableAttributeSet nextElement name return public void setOption String option String value if option equalsIgnoreCase LABEL_OPTION this label value if option equalsIgnoreCase COLOR_OPTION_FATAL setColor Priority FATAL value if option equalsIgnoreCase COLOR_OPTION_ERROR setColor Priority ERROR value if option equalsIgnoreCase COLOR_OPTION_WARN setColor Priority WARN value if option equalsIgnoreCase COLOR_OPTION_INFO setColor Priority INFO value if option equalsIgnoreCase COLOR_OPTION_DEBUG setColor Priority DEBUG value if option equalsIgnoreCase COLOR_OPTION_BACKGROUND textpane setBackground parseColor value if option equalsIgnoreCase FANCY_OPTION fancy OptionConverter toBoolean value fancy if option equalsIgnoreCase FONT_SIZE_OPTION setFontSize Integer parseInt value if option equalsIgnoreCase FONT_NAME_OPTION setFontName value return public boolean requiresLayout return true public class StressAsyncAppender extends Thread static Category root Category getRoot static Random random new Random static final int LOOP_LENGTH static final int BRANCHING_FACTOR static int maxThreads static long msgCounter static int threadCounter static double LOG_2 Math log static Object lock new Object public static void main String args if args length usage DOMConfigurator configure try maxThreads Integer parseInt args catch java lang NumberFormatException System err println usage while true synchronized lock createChildren randomInt BRANCHING_FACTOR try root debug lock wait root debug catch InterruptedException root warn static void usage System err println StressAsyncAppender class getName System exit public StressAsyncAppender public void run int loopLength StressAsyncAppender randomInt LOOP_LENGTH root debug loopLength int createIndex loopLength for int loopLength if createIndex createChildren randomInt BRANCHING_FACTOR synchronized lock root debug msgCounter synchronized lock StressAsyncAppender threadCounter root debug threadCounter if StressAsyncAppender threadCounter root debug public static void createChildren int if return synchronized lock maxThreadsConstrained root debug for int root debug threadCounter new StressAsyncAppender start static public int maxThreadsConstrained int int maxAllowed StressAsyncAppender maxThreads StressAsyncAppender threadCounter return maxAllowed maxAllowed public static int randomInt int int random nextInt return public void delay long millis try Thread currentThread sleep millis catch Exception public class HTMLLayout extends Layout protected final int BUF_SIZE protected final int MAX_CAPACITY private StringBuffer sbuf new StringBuffer BUF_SIZE public static final String LOCATION_INFO_OPTION boolean locationInfo false public void activateOptions public String format LoggingEvent event if sbuf capacity MAX_CAPACITY sbuf new StringBuffer BUF_SIZE else sbuf setLength sbuf append sbuf append sbuf append event timeStamp event getStartTime sbuf append sbuf append sbuf append event getThreadName sbuf append sbuf append if event priority isGreaterOrEqual Priority WARN sbuf append sbuf append event priority sbuf append else sbuf append event priority sbuf append sbuf append sbuf append event categoryName sbuf append sbuf append sbuf append event getNDC sbuf append if locationInfo event setLocationInformation sbuf append sbuf append event locationInfo getFileName sbuf append sbuf append event locationInfo getLineNumber sbuf append sbuf append sbuf append event message sbuf append sbuf append if event throwable null sbuf append sbuf append getThrowableAsHTML event throwable sbuf append return sbuf toString public String getContentType return public String getHeader StringBuffer sbuf new StringBuffer sbuf append sbuf append sbuf append sbuf append if locationInfo sbuf append sbuf append return sbuf toString public String getFooter return public String getOptionStrings return new String LOCATION_INFO_OPTION String getThrowableAsHTML Throwable throwable if throwable null return null StringWriter sw new StringWriter HTMLPrintWriter hpw new HTMLPrintWriter sw throwable printStackTrace hpw return sw toString public boolean ignoresThrowable return false public void setOption String key String value if value null return if key equals LOCATION_INFO_OPTION locationInfo OptionConverter toBoolean value locationInfo static class HTMLPrintWriter extends PrintWriter static String TRACE_PREFIX public HTMLPrintWriter Writer writer super writer public void println char write TRACE_PREFIX this write public void println String write TRACE_PREFIX this write public class SystemTime static int RUN_LENGTH static public void main String args double systemCurrentTimeLoop System out println currentThreadNameloop System out println static double systemCurrentTimeLoop long before System currentTimeMillis long for int RUN_LENGTH System currentTimeMillis return System currentTimeMillis before RUN_LENGTH static double currentThreadNameloop long before System currentTimeMillis String for int RUN_LENGTH Thread currentThread getName return System currentTimeMillis before RUN_LENGTH public class MessageRenderer implements ObjectRenderer public MessageRenderer public String doRender Object if instanceof Message StringBuffer sbuf new StringBuffer Message Message try sbuf append switch getJMSDeliveryMode case DeliveryMode NON_PERSISTENT sbuf append break case DeliveryMode PERSISTENT sbuf append break default sbuf append sbuf append sbuf append getJMSCorrelationID sbuf append sbuf append getJMSDestination sbuf append sbuf append getJMSExpiration sbuf append sbuf append getJMSMessageID sbuf append sbuf append getJMSPriority sbuf append sbuf append getJMSRedelivered sbuf append sbuf append getJMSReplyTo sbuf append sbuf append getJMSTimestamp sbuf append sbuf append getJMSType catch JMSException LogLog error return sbuf toString else return toString public class SyslogWriter extends Writer final int SYSLOG_PORT static String syslogHost private InetAddress address private DatagramSocket ds public SyslogWriter String syslogHost this syslogHost syslogHost try this address InetAddress getByName syslogHost catch UnknownHostException LogLog error syslogHost try this ds new DatagramSocket catch SocketException printStackTrace LogLog error syslogHost public void write char buf int off int len throws IOException this write new String buf off len public void write String string throws IOException DatagramPacket packet new DatagramPacket string getBytes string length address SYSLOG_PORT if this ds null ds send packet public void flush public void close public class NOPWriter extends Writer public void write char cbuf throws IOException public void write char cbuf int off int len throws IOException public void write int throws IOException public void write String throws IOException public void write String int off int len throws IOException public void flush throws IOException public void close throws IOException System err println public class TCategory extends Category implements OptionHandler private static TFactory factory new TFactory static String instanceFQCN TCategory class getName public static final String SUFFIX_OPTION String suffix public TCategory String name super name public void activateOptions public void debug String message log instanceFQCN Priority DEBUG message suffix null public static Category getInstance String name return Category getInstance name factory public String getOptionStrings return new String SUFFIX_OPTION public void setOption String option String value System out println option value if option null return if option equalsIgnoreCase SUFFIX_OPTION this suffix value System out println suffix public void trace String message if disable TPriority TRACE_INT return if TPriority TRACE isGreaterOrEqual this getChainedPriority callAppenders new LoggingEvent instanceFQCN this TPriority TRACE message null public void trace String message Exception if disable TPriority TRACE_INT return if TPriority TRACE isGreaterOrEqual this getChainedPriority callAppenders new LoggingEvent instanceFQCN this TPriority TRACE message private static class TFactory implements CategoryFactory TFactory public Category makeNewCategoryInstance String name return new TCategory name public interface Appender void addFilter Filter newFilter public void clearFilters public void close public void doAppend LoggingEvent event public String getName public void setErrorHandler ErrorHandler errorHandler public void setLayout Layout layout public void setName String name public boolean requiresLayout public class XPriority extends Priority static final int TRACE_INT static final int FATAL_INT static final int SYSLOG_FATAL_INT static final int SYSLOG_TRACE_INT public static final XPriority TRACE new XPriority TRACE_INT public static final XPriority FATAL new XPriority FATAL_INT FATAL_INT protected XPriority int level String strLevel int syslogEquiv super level strLevel syslogEquiv public static Priority toPriority String sArg if sArg null return XPriority TRACE String stringVal sArg toUpperCase if stringVal equals return XPriority TRACE if stringVal equals return XPriority FATAL return Priority toPriority sArg public static Priority toPriority int throws IllegalArgumentException switch case TRACE_INT return XPriority TRACE case FATAL_INT return XPriority FATAL return Priority toPriority public class CategoryWrapper Category static String FQCN CategoryWrapper class getName CategoryWrapper String name Category getInstance name public static void main String argv Layout layout new PatternLayout Appender out new FileAppender layout System out CategoryWrapper w1 new CategoryWrapper w1 addAppender out w1 print public void addAppender Appender appender addAppender appender public void print String msg log FQCN Priority DEBUG msg null static void Usage String msg System err println msg System err println CategoryWrapper class getName System exit public class NTEventLogAppender extends AppenderSkeleton private int private static final int FATAL Priority FATAL toInt private static final int ERROR Priority ERROR toInt private static final int WARN Priority WARN toInt private static final int INFO Priority INFO toInt private static final int DEBUG Priority DEBUG toInt public NTEventLogAppender this null null null public NTEventLogAppender String source this null source null public NTEventLogAppender String server String source this server source null public NTEventLogAppender Layout layout this null null layout public NTEventLogAppender String source Layout layout this null source layout public NTEventLogAppender String server String source Layout layout if source null source if layout null this layout new TTCCLayout else this layout layout try registerEventSource server source catch Exception printStackTrace public void close public void append LoggingEvent event StringWriter sw_writer new StringWriter PrintWriter pw_writer new PrintWriter sw_writer pw_writer print layout format event if event throwable null event throwable printStackTrace pw_writer pw_writer close int nt_category event priority toInt if nt_category FATAL nt_category DEBUG nt_category INFO reportEvent sw_writer toString nt_category public void finalize deregisterEventSource public boolean requiresLayout return true native private int registerEventSource String server String source native private void reportEvent int handle String message int priority native private void deregisterEventSource int handle static System loadLibrary public class SMTPAppender extends AppenderSkeleton public static final String TO_OPTION public static final String FROM_OPTION public static final String SUBJECT_OPTION public static final String SMTP_HOST_OPTION public static final String BUFFER_SIZE_OPTION public static final String EVALUATOR_CLASS_OPTION public static final String LOCATION_INFO_OPTION String to String from String subject String smtpHost int bufferSize CyclicBuffer cb new CyclicBuffer bufferSize Session session Message msg boolean locationInfo false TriggeringEventEvaluator evaluator public SMTPAppender this new DefaultEvaluator public SMTPAppender TriggeringEventEvaluator evaluator this evaluator evaluator public void activateOptions Properties props System getProperties if smtpHost null props put smtpHost session Session getDefaultInstance props null msg new MimeMessage session try if from null msg setFrom getAddress from else msg setFrom msg setRecipients Message RecipientType TO parseAddress to if subject null msg setSubject subject catch MessagingException LogLog error public void append LoggingEvent event if checkEntryConditions return event getThreadName event getNDC if locationInfo event setLocationInformation cb add event if evaluator isTriggeringEvent event sendBuffer protected boolean checkEntryConditions if this msg null errorHandler error return false if this evaluator null errorHandler error name return false if this layout null errorHandler error name return false return true public void close this closed true InternetAddress getAddress String addressStr try return new InternetAddress addressStr catch AddressException errorHandler error addressStr ErrorCode ADDRESS_PARSE_FAILURE return null public String getOptionStrings return OptionConverter concatanateArrays super getOptionStrings new String TO_OPTION FROM_OPTION SUBJECT_OPTION SMTP_HOST_OPTION BUFFER_SIZE_OPTION EVALUATOR_CLASS_OPTION LOCATION_INFO_OPTION InternetAddress parseAddress String addressStr try return InternetAddress parse addressStr true catch AddressException errorHandler error addressStr ErrorCode ADDRESS_PARSE_FAILURE return null public boolean requiresLayout return true protected void sendBuffer try MimeBodyPart part new MimeBodyPart StringBuffer sbuf new StringBuffer String layout getHeader if null sbuf append int len cb length for int len sbuf append layout format cb get layout getFooter if null sbuf append part setContent sbuf toString layout getContentType Multipart mp new MimeMultipart mp addBodyPart part msg setContent mp msg setSentDate new Date Transport send msg catch Exception LogLog error public void setOption String option String value if value null return super setOption option value if option equals TO_OPTION to value else if option equals FROM_OPTION from value else if option equals SMTP_HOST_OPTION smtpHost value else if option equals SUBJECT_OPTION subject value else if option equals EVALUATOR_CLASS_OPTION evaluator TriggeringEventEvaluator OptionConverter instantiateByClassName value TriggeringEventEvaluator class evaluator else if option equals BUFFER_SIZE_OPTION bufferSize OptionConverter toInt value bufferSize cb resize bufferSize else if option equals LOCATION_INFO_OPTION locationInfo OptionConverter toBoolean value locationInfo class DefaultEvaluator implements TriggeringEventEvaluator public boolean isTriggeringEvent LoggingEvent event return event priority isGreaterOrEqual Priority ERROR public class SMTPMin static Category cat Category getInstance SMTPMin class public static void main String argv if argv length init argv else usage NDC push test static void usage String msg System err println msg System err println SMTPMin class getName System exit static void init String configFile PropertyConfigurator configure configFile static void test int cat debug cat debug new Exception cat info cat warn cat error cat log Priority FATAL Category shutdown Thread currentThread getThreadGroup list public class StringMatchFilter extends Filter public static final String STRING_TO_MATCH_OPTION public static final String ACCEPT_ON_MATCH_OPTION boolean acceptOnMatch true String stringToMatch public int decide LoggingEvent event if event message null stringToMatch null return Filter NEUTRAL if event message instanceof String String msg String event message if msg indexOf stringToMatch return Filter NEUTRAL if acceptOnMatch return Filter ACCEPT else return Filter DENY return Filter NEUTRAL public String getOptionStrings return new String STRING_TO_MATCH_OPTION ACCEPT_ON_MATCH_OPTION public void setOption String key String value if key equalsIgnoreCase STRING_TO_MATCH_OPTION stringToMatch value else if key equalsIgnoreCase ACCEPT_ON_MATCH_OPTION acceptOnMatch OptionConverter toBoolean value acceptOnMatch public class NewVsSetLen static String static int BIGBUF_LEN static int SBUF_LEN static int RUN_LENGTH BIGBUF_LEN static char sbuf new char SBUF_LEN static char bigbuf new char BIGBUF_LEN for int SBUF_LEN sbuf char for int BIGBUF_LEN bigbuf char static public void main String args int for int len SBUF_LEN len BIGBUF_LEN len RUN_LENGTH System out println len for int second second System out println second RUN_LENGTH len int newBuffer len second System out print int setLen len second System out println if second second else second static double newBuffer int size int second long before System currentTimeMillis for int RUN_LENGTH StringBuffer buf new StringBuffer SBUF_LEN buf append sbuf sbuf length buf append bigbuf size buf toString for int second StringBuffer buf new StringBuffer SBUF_LEN buf append sbuf SBUF_LEN buf toString return System currentTimeMillis before RUN_LENGTH static double setLen int size int second long before System currentTimeMillis StringBuffer buf new StringBuffer SBUF_LEN for int RUN_LENGTH buf append sbuf sbuf length buf append bigbuf size buf toString buf setLength for int second buf append sbuf SBUF_LEN buf toString buf setLength return System currentTimeMillis before RUN_LENGTH public abstract class PatternConverter public PatternConverter next int min int max boolean leftAlign false protected PatternConverter protected PatternConverter FormattingInfo fi min fi min max fi max leftAlign fi leftAlign abstract protected String convert LoggingEvent event public void format StringBuffer sbuf LoggingEvent String convert if null if min spacePad sbuf min return int len length if len max sbuf append substring len max else if len min if leftAlign sbuf append spacePad sbuf min len else spacePad sbuf min len sbuf append else sbuf append public void spacePad StringBuffer sbuf int length while length sbuf append SPACES length for int if length sbuf append SPACES public class ReportParserError implements org xml sax ErrorHandler void report String msg org xml sax SAXParseException LogLog error msg getMessage getLineNumber getColumnNumber getSystemId getPublicId public void warning org xml sax SAXParseException report public void error org xml sax SAXParseException report public void fatalError org xml sax SAXParseException report public class DenyAllFilter extends Filter public int decide LoggingEvent event return Filter DENY public String getOptionStrings return null public void setOption String key String value public class XCategory extends Category implements OptionHandler private static XFactory factory new XFactory static String instanceFQCN XCategory class getName public static final String SUFFIX_OPTION String suffix public XCategory String name super name public void activateOptions public void debug String message log instanceFQCN Priority DEBUG message suffix null public static Category getInstance String name return Category getInstance name factory public String getOptionStrings return new String SUFFIX_OPTION public void setOption String option String value if option null return if option equalsIgnoreCase SUFFIX_OPTION this suffix value LogLog debug suffix public void trace String message if disable XPriority TRACE_INT return if XPriority TRACE isGreaterOrEqual this getChainedPriority callAppenders new LoggingEvent instanceFQCN this XPriority TRACE message null private static class XFactory implements CategoryFactory XFactory public Category makeNewCategoryInstance String name return new XCategory name public class TP static Category cat Category getInstance TP class getName public static void main String argv JFrame frame new JFrame Category root Category getRoot PatternLayout layout new PatternLayout TextPaneAppender ap new TextPaneAppender layout JTextPane textPane ap getTextPane textPane setPreferredSize new Dimension frame getContentPane add textPane frame pack ap getTextPane setVisible true frame setVisible true root addAppender ap cat debug cat debug public class SocketMin static Category cat Category getInstance SyslogMin class getName static SocketAppender public static void main String argv if argv length init argv argv else usage NDC push if argv equals loop else test close static void usage String msg System err println msg System err println SocketMin class System exit static void init String host String portStr Category root Category getRoot BasicConfigurator configure try int port Integer parseInt portStr cat info host port new SocketAppender host port setName root addAppender catch java lang NumberFormatException printStackTrace usage portStr catch Exception System err println printStackTrace System exit static void loop Category root Category getRoot InputStreamReader in new InputStreamReader System in System out println int int while true cat debug cat info cat warn cat error new Exception try in read catch Exception return if break if break if System out println root removeAppender static void test int cat debug cat info cat warn cat error cat log Priority FATAL cat debug new Exception class Base64 final static int MAX_LINE static byte asciiEncoding static char charEnc new char static for int charEnc char charEnc char for int charEnc char charEnc charEnc static String toString byte inbuf return toString inbuf inbuf length static String toString byte inbuf int offset int length StringBuffer output new StringBuffer length int in char out new char int offset boolean ended false int last offset length int int bitsRead while ended in bitsRead for if last ended true break in in inbuf bitsRead while bitsRead bitsRead output append charEnc in bitsRead if bitsRead output append charEnc in output append else if bitsRead output append charEnc in output append return output toString public static void main String args byte inbuf new byte MAX_LINE while true try int read System in read inbuf MAX_LINE if read break System out println read System out println Base64 toString inbuf read catch Exception System out println class StressCategory static Priority priority new Priority Priority DEBUG Priority INFO Priority WARN Priority ERROR Priority FATAL static Priority defaultPriority Category getRoot getPriority static int LENGTH static String names static Category cat static CT ct static Random random new Random public static void main String args LENGTH args length if LENGTH System err println StressCategory class getName System exit if LENGTH System err println names new String LENGTH for int LENGTH names args cat new Category LENGTH ct new CT LENGTH permute static void permute int if LENGTH createLoop else for int LENGTH swap names permute swap names static void swap String names int int String names names names names public static void permutationDump System out print for int LENGTH System out print names System out println static void createLoop int if LENGTH for int LENGTH if ct null cat null else cat Category getInstance ct catstr cat setPriority ct priority test Category defaultHierarchy clear else ct null createLoop ct new CT names null createLoop int random nextInt if ct new CT names priority createLoop static void test for int LENGTH if checkCorrectness System out println permutationDump ctDump catDump System exit static void ctDump for int LENGTH if ct null System out println ct catstr ct priority else System out println static void catDump for int LENGTH if cat null System out println cat name cat getPriority else System out println static boolean checkCorrectness int CT localCT ct if localCT null return true Priority expected getExpectedPrioriy localCT Priority purported cat getChainedPriority if expected purported System out println localCT catstr expected System out println cat name purported return false return true static Priority getExpectedPrioriy CT ctParam Priority priority ctParam priority if priority null return priority String catstr ctParam catstr for int catstr lastIndexOf catstr length catstr lastIndexOf String substr catstr substring for int LENGTH if ct null substr equals ct catstr Priority ct priority if null return return defaultPriority static class CT public String catstr public Priority priority CT String catstr Priority priority this catstr catstr this priority priority public class DOMConfigurator extends BasicConfigurator implements Configurator static final String CONFIGURATION_TAG static final String RENDERER_TAG static final String APPENDER_TAG static final String APPENDER_REF_TAG static final String PARAM_TAG static final String LAYOUT_TAG static final String CATEGORY static final String NAME_ATTR static final String CLASS_ATTR static final String VALUE_ATTR static final String ROOT_TAG static final String PRIORITY_TAG static final String FILTER_TAG static final String ERROR_HANDLER_TAG static final String REF_ATTR static final String ADDITIVITY_ATTR static final String SCFO_ATTR static final String CONFIG_DEBUG_ATTR static final String RENDERING_CLASS_ATTR static final String RENDERED_CLASS_ATTR static final String EMPTY_STR static final Class ONE_STRING_PARAM new Class String class final static String dbfKey Hashtable appenderBag public DOMConfigurator appenderBag new Hashtable protected Appender findAppenderByReference Element appenderRef String appenderName appenderRef getAttribute REF_ATTR Appender appender Appender appenderBag get appenderName if appender null return appender else Document doc appenderRef getOwnerDocument Element element null NodeList list doc getElementsByTagName for int list getLength Node node list item NamedNodeMap map node getAttributes Node attrNode map getNamedItem if appenderName equals attrNode getNodeValue element Element node break if element null LogLog error appenderName return null else appender parseAppender element appenderBag put appenderName appender return appender protected Appender parseAppender Element appenderElement String className appenderElement getAttribute CLASS_ATTR LogLog debug className try Object instance Class forName className newInstance Appender appender Appender instance appender setName appenderElement getAttribute NAME_ATTR NodeList children appenderElement getChildNodes final int length children getLength for int loop loop length loop Node currentNode children item loop if currentNode getNodeType Node ELEMENT_NODE Element currentElement Element currentNode if currentElement getTagName equals PARAM_TAG if appender instanceof OptionHandler parseParameters currentElement OptionHandler appender else if currentElement getTagName equals LAYOUT_TAG appender setLayout parseLayout currentElement else if currentElement getTagName equals FILTER_TAG parseFilters currentElement appender else if currentElement getTagName equals ERROR_HANDLER_TAG parseErrorHandler currentElement appender else if currentElement getTagName equals APPENDER_REF_TAG String refName currentElement getAttribute REF_ATTR if appender instanceof AppenderAttachable AppenderAttachable aa AppenderAttachable appender LogLog debug refName appender getName aa addAppender findAppenderByReference currentElement else LogLog error refName appender getName if appender instanceof OptionHandler OptionHandler appender activateOptions return appender catch Exception oops LogLog error oops return null protected void parseErrorHandler Element element Appender appender ErrorHandler eh ErrorHandler OptionConverter instantiateByClassName element getAttribute CLASS_ATTR org apache log4j spi ErrorHandler class null if eh null NodeList children element getChildNodes final int length children getLength for int loop loop length loop Node currentNode children item loop if currentNode getNodeType Node ELEMENT_NODE Element currentElement Element currentNode String tagName currentElement getTagName if tagName equals PARAM_TAG parseParameters currentElement eh appender setErrorHandler eh protected void parseParameters Element elem OptionHandler oh String name elem getAttribute NAME_ATTR String value elem getAttribute VALUE_ATTR LogLog debug name value if oh instanceof OptionHandler value null oh setOption name OptionConverter convertSpecialChars value protected void parseFilters Element element Appender appender String clazz element getAttribute CLASS_ATTR Filter filter Filter OptionConverter instantiateByClassName clazz org apache log4j spi Filter class null if filter null NodeList children element getChildNodes final int length children getLength for int loop loop length loop Node currentNode children item loop if currentNode getNodeType Node ELEMENT_NODE Element currentElement Element currentNode String tagName currentElement getTagName if tagName equals PARAM_TAG parseParameters currentElement filter appender addFilter filter protected void parseCategory Element categoryElement Hierarchy hierarchy String catName categoryElement getAttribute NAME_ATTR Category cat String className categoryElement getAttribute CLASS_ATTR if EMPTY_STR equals className LogLog debug cat hierarchy getInstance catName else LogLog debug className try Class clazz Class forName className Method getInstanceMethod clazz getMethod ONE_STRING_PARAM cat Category getInstanceMethod invoke null new Object catName catch Exception oops LogLog error catName oops return synchronized cat cat setAdditivity OptionConverter toBoolean categoryElement getAttribute ADDITIVITY_ATTR true parseChildrenOfCategoryElement categoryElement cat false protected void parseRoot Element rootElement Hierarchy hierarchy Category root hierarchy getRoot synchronized root parseChildrenOfCategoryElement rootElement root true protected void parseChildrenOfCategoryElement Element catElement Category cat boolean isRoot cat removeAllAppenders NodeList children catElement getChildNodes final int length children getLength for int loop loop length loop Node currentNode children item loop if currentNode getNodeType Node ELEMENT_NODE Element currentElement Element currentNode String tagName currentElement getTagName if tagName equals APPENDER_REF_TAG Element appenderRef Element currentNode Appender appender findAppenderByReference appenderRef String refName appenderRef getAttribute REF_ATTR if appender null LogLog debug refName cat getName else LogLog debug refName cat addAppender appender else if tagName equals PRIORITY_TAG parsePriority currentElement cat isRoot else if tagName equals PARAM_TAG if cat instanceof OptionHandler OptionHandler oh OptionHandler cat parseParameters currentElement oh oh activateOptions protected Layout parseLayout Element layout_element String className layout_element getAttribute CLASS_ATTR LogLog debug className try Object instance Class forName className newInstance Layout layout Layout instance NodeList params layout_element getChildNodes final int length params getLength for int loop loop length loop Node currentNode Node params item loop if currentNode getNodeType Node ELEMENT_NODE Element currentElement Element currentNode String tagName currentElement getTagName if tagName equals PARAM_TAG parseParameters currentElement layout layout activateOptions return layout catch Exception oops LogLog error oops return null protected void parserRenderer Element element String renderingClass element getAttribute RENDERING_CLASS_ATTR String renderedClass element getAttribute RENDERED_CLASS_ATTR addRenderer renderedClass renderingClass protected void parsePriority Element element Category cat boolean isRoot String catName cat getName if isRoot catName String priStr element getAttribute VALUE_ATTR LogLog debug catName priStr if BasicConfigurator INHERITED equals priStr if isRoot LogLog error else cat setPriority null else String className element getAttribute CLASS_ATTR if EMPTY_STR equals className cat setPriority Priority toPriority priStr else LogLog debug className try Class clazz Class forName className Method toPriorityMethod clazz getMethod ONE_STRING_PARAM Priority pri Priority toPriorityMethod invoke null new Object priStr cat setPriority pri catch Exception oops LogLog error priStr oops return LogLog debug catName cat getPriority static public void configure Element element DOMConfigurator configurator new DOMConfigurator configurator parse element Category getDefaultHierarchy static public void configureAndWatch String configFilename configureAndWatch configFilename FileWatchdog DEFAULT_DELAY static public void configureAndWatch String configFilename long delay XMLWatchdog xdog new XMLWatchdog configFilename xdog setDelay delay xdog start public void doConfigure String filename Hierarchy hierarchy try doConfigure new FileInputStream filename hierarchy catch IOException LogLog error filename public void doConfigure URL url Hierarchy hierarchy try doConfigure url openStream hierarchy catch IOException LogLog error url public void doConfigure InputStream input Hierarchy hierarchy throws FactoryConfigurationError DocumentBuilderFactory dbf null try LogLog debug System getProperty dbfKey dbf DocumentBuilderFactory newInstance LogLog debug LogLog debug dbf getClass getName catch FactoryConfigurationError fce Exception fce getException LogLog debug throw fce try dbf setValidating true DocumentBuilder docBuilder dbf newDocumentBuilder InputSource inputSource new InputSource input URL dtdURL DOMConfigurator class getResource if dtdURL null LogLog error else LogLog debug dtdURL toString inputSource setSystemId dtdURL toString Document doc docBuilder parse inputSource parse doc getDocumentElement hierarchy catch Exception LogLog error input static public void configure String filename throws FactoryConfigurationError new DOMConfigurator doConfigure filename Category getDefaultHierarchy protected void parse Element element Hierarchy hierarchy if element getTagName equals CONFIGURATION_TAG LogLog error return String confDebug element getAttribute CONFIG_DEBUG_ATTR LogLog debug confDebug if confDebug equals confDebug equals LogLog setInternalDebugging OptionConverter toBoolean confDebug true else LogLog debug CONFIG_DEBUG_ATTR String override element getAttribute SCFO_ATTR LogLog debug override if override equals override equals overrideAsNeeded override else LogLog debug SCFO_ATTR NodeList children element getChildNodes final int length children getLength for int loop loop length loop Node currentNode children item loop if currentNode getNodeType Node ELEMENT_NODE Element currentElement Element currentNode String tagName currentElement getTagName if tagName equals CATEGORY parseCategory currentElement hierarchy else if tagName equals ROOT_TAG parseRoot currentElement hierarchy else if tagName equals RENDERER_TAG parserRenderer currentElement class XMLWatchdog extends FileWatchdog XMLWatchdog String filename super filename public void doOnChange new DOMConfigurator doConfigure filename Category getDefaultHierarchy public class SimpleLayout extends Layout StringBuffer sbuf new StringBuffer public SimpleLayout public void activateOptions public String format LoggingEvent event sbuf setLength sbuf append event priority toString sbuf append sbuf append event message sbuf append LINE_SEP return sbuf toString public String getOptionStrings return new String public boolean ignoresThrowable return true public void setOption String option String value public abstract class Filter implements OptionHandler public Filter next public static final int DENY public static final int NEUTRAL public static final int ACCEPT public void activateOptions abstract public int decide LoggingEvent event public class FormattingInfo int min int max boolean leftAlign false void reset min max leftAlign false void dump LogLog debug min max leftAlign public class SocketAppender extends AppenderSkeleton InetAddress address int port String hostName ObjectOutputStream oos int reconnectionDelay boolean locationInfo false private Connector connector int counter private static final int RESET_FREQUENCY public static final String REMOTE_HOST_OPTION public static final String PORT_OPTION public static final String LOCATION_INFO_OPTION public static final String RECONNECTION_DELAY_OPTION public SocketAppender public SocketAppender InetAddress address int port this address address this port port this hostName address getHostName connect address port public SocketAppender String host int port this port port this hostName host this address getAddressByName host connect address port public void activateOptions connect address port public void close this closed true cleanUp public void cleanUp if oos null try oos close catch IOException LogLog error oos null if connector null connector interrupt void connect InetAddress address int port if this address null return try cleanUp oos new ObjectOutputStream new Socket address port getOutputStream catch IOException LogLog error address getHostName fireConnector public void append LoggingEvent event if address null errorHandler error this name return if oos null try if locationInfo event setLocationInformation oos writeObject event oos flush if counter RESET_FREQUENCY counter oos reset catch IOException oos null LogLog debug fireConnector void fireConnector if connector null LogLog debug connector new Connector connector setDaemon true connector setPriority Thread MIN_PRIORITY connector start InetAddress getAddressByName String host try return InetAddress getByName host catch Exception LogLog error host return null public String getOptionStrings return OptionConverter concatanateArrays super getOptionStrings new String REMOTE_HOST_OPTION PORT_OPTION LOCATION_INFO_OPTION RECONNECTION_DELAY_OPTION public boolean requiresLayout return false public void setOption String option String value if value null return super setOption option value if option equals REMOTE_HOST_OPTION address getAddressByName value else if option equals PORT_OPTION port OptionConverter toInt value port else if option equals LOCATION_INFO_OPTION locationInfo OptionConverter toBoolean value locationInfo else if option equals RECONNECTION_DELAY_OPTION reconnectionDelay OptionConverter toInt value reconnectionDelay class Connector extends Thread public void run Socket socket while isInterrupted try sleep reconnectionDelay LogLog debug address getHostName socket new Socket address port synchronized this oos new ObjectOutputStream socket getOutputStream connector null break catch InterruptedException LogLog debug return catch java net ConnectException LogLog debug address getHostName catch IOException LogLog debug address getHostName public class AbsoluteTimeDateFormat extends DateFormat public final static String ABS_TIME_DATE_FORMAT public final static String DATE_AND_TIME_DATE_FORMAT public final static String ISO8601_DATE_FORMAT public AbsoluteTimeDateFormat setCalendar Calendar getInstance public AbsoluteTimeDateFormat TimeZone timeZone setCalendar Calendar getInstance timeZone public StringBuffer format Date date StringBuffer sbuf FieldPosition fieldPosition calendar setTime date int hour calendar get Calendar HOUR_OF_DAY if hour sbuf append sbuf append hour sbuf append int mins calendar get Calendar MINUTE if mins sbuf append sbuf append mins sbuf append int secs calendar get Calendar SECOND if secs sbuf append sbuf append secs sbuf append int millis calendar get Calendar MILLISECOND if millis sbuf append if millis sbuf append sbuf append millis return sbuf public Date parse String ParsePosition pos return null public class DelayedLoop static Category cat Category getInstance DelayedLoop class static int loopLength public static void main String argv if argv length init argv else usage test static void usage String msg System err println msg System err println DelayedLoop class getName System exit static void init String configFile if configFile endsWith DOMConfigurator configureAndWatch configFile else PropertyConfigurator configureAndWatch configFile static void test int while true cat debug try Thread currentThread sleep catch Exception public interface ObjectRenderer public String doRender Object public class SimpleSocketServer static Category cat Category getInstance SimpleSocketServer class getName static int port public static void main String argv if argv length init argv argv else usage try cat info port ServerSocket serverSocket new ServerSocket port while true cat info Socket socket serverSocket accept cat info socket getInetAddress cat info new Thread new SocketNode socket Category getDefaultHierarchy start catch Exception printStackTrace static void usage String msg System err println msg System err println SimpleSocketServer class getName System exit static void init String portStr String configFile try port Integer parseInt portStr catch java lang NumberFormatException printStackTrace usage portStr PropertyConfigurator configure configFile public class CountingQuietWriter extends QuietWriter protected long count public CountingQuietWriter Writer writer ErrorHandler eh super writer eh public void write String string try out write string count string length catch IOException errorHandler error ErrorCode WRITE_FAILURE public long getCount return count public void setCount long count this count count public class ListVsVector static int RUN_LENGTH static Vector new Vector static Chain head static String tmp static public void main String args addElement addElement addElement addElement addElement Chain new Chain head next new Chain next next new Chain next next new Chain next next new Chain double loopChain System out println loopVector System out println static double loopChain long before System currentTimeMillis Chain for int RUN_LENGTH head while null tmp next return System currentTimeMillis before RUN_LENGTH static double loopVector long before System currentTimeMillis int size size for int RUN_LENGTH for int size tmp String elementAt return System currentTimeMillis before RUN_LENGTH static class Chain public String public Chain next Chain String this void setNext Chain next public class JMSAppender extends AppenderSkeleton TopicConnection topicConnection TopicSession topicSession TopicPublisher topicPublisher static String TOPIC_CONNECTION_FACTORY_BINDING_NAME_OPTION static String TOPIC_BINDING_NAME_OPTION String topicBindingName String tcfBindingName public JMSAppender protected Object lookup Context ctx String name throws NamingException try return ctx lookup name catch NameNotFoundException LogLog error name throw public void activateOptions TopicConnectionFactory topicConnectionFactory try Context ctx new InitialContext topicConnectionFactory TopicConnectionFactory lookup ctx tcfBindingName topicConnection topicConnectionFactory createTopicConnection topicConnection start topicSession topicConnection createTopicSession false Session AUTO_ACKNOWLEDGE Topic topic Topic lookup ctx topicBindingName topicPublisher topicSession createPublisher topic ctx close catch Exception errorHandler error name ErrorCode GENERIC_FAILURE protected boolean checkEntryConditions String fail null if this topicConnection null fail else if this topicSession null fail else if this topicPublisher null fail if fail null errorHandler error fail name return false else return true public void close if this closed return LogLog debug name this closed true try if topicSession null topicSession close if topicConnection null topicConnection close catch Exception LogLog error name topicPublisher null topicSession null topicConnection null public void append LoggingEvent event if checkEntryConditions return try ObjectMessage msg topicSession createObjectMessage msg setObject event topicPublisher publish msg catch Exception errorHandler error name ErrorCode GENERIC_FAILURE public String getOptionStrings return OptionConverter concatanateArrays super getOptionStrings new String TOPIC_BINDING_NAME_OPTION TOPIC_CONNECTION_FACTORY_BINDING_NAME_OPTION public void setOption String key String value if value null return super setOption key value if key equals TOPIC_BINDING_NAME_OPTION topicBindingName value else if key equals TOPIC_CONNECTION_FACTORY_BINDING_NAME_OPTION tcfBindingName value public boolean requiresLayout return false public interface TriggeringEventEvaluator public boolean isTriggeringEvent LoggingEvent event public interface CategoryFactory public Category makeNewCategoryInstance String name public class SocketServer static String GENERIC static String CONFIG_FILE_EXT static Category cat Category getInstance SocketServer class static SocketServer server static int port Hashtable hierarchyMap Hierarchy genericHierarchy File dir public static void main String argv if argv length init argv argv argv else usage try cat info port ServerSocket serverSocket new ServerSocket port while true cat info Socket socket serverSocket accept InetAddress inetAddress socket getInetAddress cat info inetAddress Hierarchy Hierarchy server hierarchyMap get inetAddress if null server configureHierarchy inetAddress cat info new Thread new SocketNode socket start catch Exception printStackTrace static void usage String msg System err println msg System err println SocketServer class getName System exit static void init String portStr String configFile String dirStr try port Integer parseInt portStr catch java lang NumberFormatException printStackTrace usage portStr PropertyConfigurator configure configFile File dir new File dirStr if dir isDirectory usage dirStr server new SocketServer dir public SocketServer File directory this dir directory hierarchyMap new Hashtable Hierarchy configureHierarchy InetAddress inetAddress cat info inetAddress String inetAddress toString int indexOf if cat warn inetAddress return genericHierarchy else String key substring File configFile new File dir key CONFIG_FILE_EXT if configFile exists Hierarchy new Hierarchy new RootCategory Priority DEBUG hierarchyMap put inetAddress try new PropertyConfigurator doConfigure configFile toURL catch MalformedURLException cat error configFile return else cat warn configFile return genericHierarchy Hierarchy genericHierarchy if genericHierarchy null File new File dir GENERIC CONFIG_FILE_EXT if exists genericHierarchy new Hierarchy new RootCategory Priority DEBUG try new PropertyConfigurator doConfigure toURL genericHierarchy catch MalformedURLException cat error genericHierarchy Category getDefaultHierarchy else cat warn genericHierarchy Category getDefaultHierarchy return genericHierarchy public class PatternParser private static final char ESCAPE_CHAR private static final int LITERAL_STATE private static final int CONVERTER_STATE private static final int MINUS_STATE private static final int DOT_STATE private static final int MIN_STATE private static final int MAX_STATE static final int FULL_LOCATION_CONVERTER static final int METHOD_LOCATION_CONVERTER static final int CLASS_LOCATION_CONVERTER static final int LINE_LOCATION_CONVERTER static final int FILE_LOCATION_CONVERTER static final int RELATIVE_TIME_CONVERTER static final int THREAD_CONVERTER static final int PRIORITY_CONVERTER static final int NDC_CONVERTER static final int MESSAGE_CONVERTER int state protected StringBuffer currentLiteral new StringBuffer protected int patternLength protected int PatternConverter head PatternConverter tail protected FormattingInfo formattingInfo new FormattingInfo protected String pattern public PatternParser String pattern this pattern pattern patternLength pattern length state LITERAL_STATE private void addToList PatternConverter pc if head null head tail pc else tail next pc tail pc private String extractOption if patternLength pattern charAt int end pattern indexOf if end String pattern substring end end return return null private int extractPrecisionOption String opt extractOption int if opt null try Integer parseInt opt if LogLog error opt catch NumberFormatException LogLog error opt return public PatternConverter parse char while patternLength pattern charAt switch state case LITERAL_STATE if patternLength currentLiteral append continue if ESCAPE_CHAR switch pattern charAt case ESCAPE_CHAR currentLiteral append break case currentLiteral append Layout LINE_SEP break default if currentLiteral length addToList new LiteralPatternConverter currentLiteral toString currentLiteral setLength state CONVERTER_STATE formattingInfo reset else currentLiteral append break case CONVERTER_STATE currentLiteral append switch case formattingInfo leftAlign true break case state DOT_STATE break default if formattingInfo min state MIN_STATE else finalizeConverter break case MIN_STATE currentLiteral append if formattingInfo min formattingInfo min else if state DOT_STATE else finalizeConverter break case DOT_STATE currentLiteral append if formattingInfo max state MAX_STATE else LogLog error state LITERAL_STATE break case MAX_STATE currentLiteral append if formattingInfo max formattingInfo max else finalizeConverter state LITERAL_STATE break if currentLiteral length addToList new LiteralPatternConverter currentLiteral toString return head protected void finalizeConverter char PatternConverter pc null switch case pc new CategoryPatternConverter formattingInfo extractPrecisionOption currentLiteral setLength break case pc new ClassNamePatternConverter formattingInfo extractPrecisionOption currentLiteral setLength break case String dateFormatStr AbsoluteTimeDateFormat ISO8601_DATE_FORMAT DateFormat df String dOpt extractOption if dOpt null dateFormatStr dOpt if dateFormatStr equalsIgnoreCase AbsoluteTimeDateFormat ISO8601_DATE_FORMAT df new ISO8601DateFormat else if dateFormatStr equalsIgnoreCase AbsoluteTimeDateFormat ABS_TIME_DATE_FORMAT df new AbsoluteTimeDateFormat else if dateFormatStr equalsIgnoreCase AbsoluteTimeDateFormat DATE_AND_TIME_DATE_FORMAT df new DateTimeDateFormat else try df new SimpleDateFormat dateFormatStr catch IllegalArgumentException LogLog error dateFormatStr df DateFormat OptionConverter instantiateByClassName DateFormat class null pc new DatePatternConverter formattingInfo df currentLiteral setLength break case pc new LocationPatternConverter formattingInfo FILE_LOCATION_CONVERTER currentLiteral setLength break case pc new LocationPatternConverter formattingInfo FULL_LOCATION_CONVERTER currentLiteral setLength break case pc new LocationPatternConverter formattingInfo LINE_LOCATION_CONVERTER currentLiteral setLength break case pc new BasicPatternConverter formattingInfo MESSAGE_CONVERTER currentLiteral setLength break case pc new LocationPatternConverter formattingInfo METHOD_LOCATION_CONVERTER currentLiteral setLength break case pc new BasicPatternConverter formattingInfo PRIORITY_CONVERTER currentLiteral setLength break case pc new BasicPatternConverter formattingInfo RELATIVE_TIME_CONVERTER currentLiteral setLength break case pc new BasicPatternConverter formattingInfo THREAD_CONVERTER currentLiteral setLength break case pc new BasicPatternConverter formattingInfo NDC_CONVERTER currentLiteral setLength break default LogLog error pc new LiteralPatternConverter currentLiteral toString currentLiteral setLength addConverter pc protected void addConverter PatternConverter pc currentLiteral setLength addToList pc state LITERAL_STATE formattingInfo reset private static class BasicPatternConverter extends PatternConverter int type BasicPatternConverter FormattingInfo formattingInfo int type super formattingInfo this type type public String convert LoggingEvent event switch type case RELATIVE_TIME_CONVERTER return Long toString event timeStamp LoggingEvent getStartTime case THREAD_CONVERTER return event getThreadName case PRIORITY_CONVERTER return event priority toString case NDC_CONVERTER return event getNDC case MESSAGE_CONVERTER return event message default return null private static class LiteralPatternConverter extends PatternConverter private String literal LiteralPatternConverter String value literal value public final void format StringBuffer sbuf LoggingEvent event sbuf append literal public String convert LoggingEvent event return literal private static class DatePatternConverter extends PatternConverter private DateFormat df private Date date DatePatternConverter FormattingInfo formattingInfo DateFormat df super formattingInfo date new Date this df df public String convert LoggingEvent event date setTime System currentTimeMillis return df format date private class LocationPatternConverter extends PatternConverter int type LocationPatternConverter FormattingInfo formattingInfo int type super formattingInfo this type type public String convert LoggingEvent event event setLocationInformation switch type case FULL_LOCATION_CONVERTER return event locationInfo fullInfo case METHOD_LOCATION_CONVERTER return event locationInfo getMethodName case LINE_LOCATION_CONVERTER return event locationInfo getLineNumber case FILE_LOCATION_CONVERTER return event locationInfo getFileName default return null private static abstract class NamedPatternConverter extends PatternConverter int precision NamedPatternConverter FormattingInfo formattingInfo int precision super formattingInfo this precision precision abstract String getFullyQualifiedName LoggingEvent event public String convert LoggingEvent event String getFullyQualifiedName event if precision return else int len length int end len for int precision end lastIndexOf end if end return return substring end len private class ClassNamePatternConverter extends NamedPatternConverter ClassNamePatternConverter FormattingInfo formattingInfo int precision super formattingInfo precision String getFullyQualifiedName LoggingEvent event event setLocationInformation return event locationInfo getClassName private class CategoryPatternConverter extends NamedPatternConverter CategoryPatternConverter FormattingInfo formattingInfo int precision super formattingInfo precision String getFullyQualifiedName LoggingEvent event return event categoryName public interface Configurator void doConfigure URL url Hierarchy hierarchy class DefaultRenderer implements ObjectRenderer DefaultRenderer public String doRender Object return toString public class StressNDC extends Thread static Category root Category getRoot static Random random new Random static final int LOOP_LENGTH static final int PUSH_MISS LOOP_LENGTH static final int POP_MISS PUSH_MISS static int maxThreads static int msgCounter static int threadCounter static double LOG_2 Math log static Object lock new Object public static void main String args root setPriority Priority DEBUG BasicConfigurator configure if args length usage try maxThreads Integer parseInt args catch java lang NumberFormatException System err println usage root debug NDC push while true synchronized lock createChildren randomInt BRANCHING_FACTOR try root debug lock wait root debug catch InterruptedException root warn static void usage System err println System exit Stack parentDC public StressNDC Stack parentDC this setName randomID this parentDC parentDC public void run NDC inherit parentDC int loopLength StressNDC randomInt LOOP_LENGTH root debug loopLength int createIndex loopLength for int loopLength if createIndex createChildren randomInt BRANCHING_FACTOR if randomInt PUSH_MISS String id randomID root debug id NDC push id root debug StressNDC msgCounter if randomInt POP_MISS root debug NDC pop synchronized lock StressNDC threadCounter root debug threadCounter if StressNDC threadCounter root debug if loopLength root debug NDC remove public static void createChildren int if return synchronized lock maxThreadsConstained root debug for int root debug threadCounter new StressNDC NDC cloneStack start static public int maxThreadsConstained int int maxAllowed StressNDC maxThreads StressNDC threadCounter return maxAllowed maxAllowed public static int randomInt int int random nextInt return public static String randomID return Integer toHexString random nextInt public class ResilientFileAppender extends FileAppender File file public ResilientFileAppender public ResilientFileAppender Layout layout Writer writer super layout writer protected boolean checkEntryConditions if super checkEntryConditions return false if file null file exists file new File fileName try setFile fileName catch java io IOException LogLog error fileName fileAppend return true public void setFile String fileName boolean append throws IOException super setFile fileName append file new File fileName protected void reset super reset file null public interface AppenderAttachable public void addAppender Appender newAppender public Enumeration getAllAppenders public Appender getAppender String name void removeAllAppenders void removeAppender Appender appender void removeAppender String name public interface ErrorHandler extends OptionHandler void error String message Exception int errorCode void error String message public class JMSSink static public void main String args if args length usage String tcfBindingName args String topicBindingName args PropertyConfigurator configure args Category getDefaultHierarchy addRenderer Message class new MessageRenderer try Context ctx new InitialContext TopicConnectionFactory topicConnectionFactory topicConnectionFactory TopicConnectionFactory lookup ctx tcfBindingName TopicConnection topicConnection topicConnectionFactory createTopicConnection topicConnection start TopicSession topicSession topicConnection createTopicSession false Session AUTO_ACKNOWLEDGE Topic topic Topic ctx lookup topicBindingName TopicSubscriber topicSubscriber topicSession createDurableSubscriber topic LoggingEvent event Category remoteCategory while true ObjectMessage msg ObjectMessage topicSubscriber receive event LoggingEvent msg getObject remoteCategory Category getInstance event categoryName remoteCategory callAppenders event catch Exception LogLog error protected static Object lookup Context ctx String name throws NamingException try return ctx lookup name catch NameNotFoundException LogLog error name throw static void usage String msg System err println msg System err println JMSSink class getName System exit public class ExternallyRolledFileAppender extends RollingFileAppender static final public String PORT_OPTION static final public String ROLL_OVER static final public String OK int port HUP hup public ExternallyRolledFileAppender public void activateOptions super activateOptions if port if hup null hup interrupt hup new HUP this port hup setDaemon true hup start public String getOptionStrings return OptionConverter concatanateArrays super getOptionStrings new String PORT_OPTION public void setOption String option String value super setOption option value if option equalsIgnoreCase PORT_OPTION port OptionConverter toInt value port LogLog debug port class HUP extends Thread int port ExternallyRolledFileAppender er HUP ExternallyRolledFileAppender er int port this er er this port port public void run while isInterrupted try ServerSocket serverSocket new ServerSocket port while true Socket socket serverSocket accept LogLog debug socket getInetAddress new Thread new HUPNode socket er start catch Exception printStackTrace class HUPNode implements Runnable Socket socket DataInputStream dis DataOutputStream dos ExternallyRolledFileAppender er public HUPNode Socket socket ExternallyRolledFileAppender er this socket socket this er er try dis new DataInputStream socket getInputStream dos new DataOutputStream socket getOutputStream catch Exception printStackTrace public void run try String line dis readUTF LogLog debug if ExternallyRolledFileAppender ROLL_OVER equals line synchronized er er rollOver dos writeUTF ExternallyRolledFileAppender OK else dos writeUTF dos close catch Exception LogLog error public class TextPaneAppenderExample implements ActionListener JFrame mainframe ButtonGroup priorities TextPaneAppender tpa Category gui Priority prio JTabbedPane logview public TextPaneAppenderExample mainframe new JFrame mainframe setSize logview new JTabbedPane createLogger createMenuBar mainframe setVisible true mainframe getContentPane add logview public void createLogger tpa new TextPaneAppender new PatternLayout logview addTab new JScrollPane tpa getTextPane gui Category getInstance this getClass getName gui addAppender tpa public void createMenuBar JMenu file new JMenu JMenuItem exit new JMenuItem exit addActionListener new ActionListener public void actionPerformed ActionEvent ae System exit file add exit JMenuBar mb new JMenuBar mb add file JMenu logevent new JMenu JMenu selectprio new JMenu prio Priority getAllPossiblePriorities JRadioButtonMenuItem priority new JRadioButtonMenuItem prio length priorities new ButtonGroup for int prio length if priority new JRadioButtonMenuItem prio toString true else priority new JRadioButtonMenuItem prio toString priority setActionCommand prio toString selectprio add priority priorities add priority logevent add selectprio JMenuItem lognow new JMenuItem lognow addActionListener this logevent add lognow mb add logevent mainframe setJMenuBar mb public void actionPerformed ActionEvent ae String logtext JOptionPane showInputDialog if logtext null logtext int String name priorities getSelection getActionCommand while prio toString equals name gui log prio logtext static public void main String args TextPaneAppenderExample tpex new TextPaneAppenderExample public class Logging static int runLength static int delay static int burstLen static int DELAY_MULT burstLen static Category cat Category getInstance static void Usage String msg System err println msg System err println System exit public static void main String argv if argv length init argv argv null null else if argv length init argv argv argv argv else Usage NDC push double delta String msg if delay delta NoDelayLoop cat msg else delta DelayedLoop cat msg System out print int delta Category shutdown static void init String configFile String runLengthStr String delayStr String burstLenStr try runLength Integer parseInt runLengthStr if delayStr null delay Integer parseInt delayStr if delayStr null burstLen Integer parseInt burstLenStr DELAY_MULT burstLen catch java lang NumberFormatException printStackTrace DOMConfigurator configure configFile static double NoDelayLoop Category category String msg long before System currentTimeMillis for int runLength category info msg return System currentTimeMillis before runLength static double DelayedLoop Category category String msg long before System currentTimeMillis int Thread currentThread Thread currentThread for int runLength category info msg if burstLen try currentThread sleep delay catch Exception double actualTime System currentTimeMillis before runLength System out println actualTime return actualTime delay DELAY_MULT public class Min public static void main String argv if argv length ProgramInit argv else Usage test1 static void Usage String msg System err println msg System err println System exit static void ProgramInit String layoutType Appender appender null Layout layout null if layoutType equals layout new SimpleLayout else if layoutType equals layout new TTCCLayout AbsoluteTimeDateFormat DATE_AND_TIME_DATE_FORMAT else Usage layoutType appender new FileAppender layout System out BasicConfigurator configure appender static void test1 int Category ERR Category getInstance ERR setPriority Priority ERROR Category INF Category getInstance INF setPriority Priority INFO Category INF_ERR Category getInstance INF_ERR setPriority Priority ERROR Category DEB Category getInstance DEB setPriority Priority DEBUG Category INF_UNDEF Category getInstance Category INF_ERR_UNDEF Category getInstance Category UNDEF Category getInstance ERR error INF error INF warn INF info INF_UNDEF error INF_UNDEF warn INF_UNDEF info INF_ERR error INF_ERR_UNDEF log Priority FATAL INF_ERR_UNDEF error DEB error DEB warn DEB info DEB debug UNDEF error UNDEF warn UNDEF info UNDEF debug new Exception ERR warn ERR info ERR debug INF debug INF_UNDEF debug INF_ERR warn INF_ERR info INF_ERR debug INF_ERR_UNDEF warn INF_ERR_UNDEF info INF_ERR_UNDEF debug INF info public class OptionConverter static String DELIM_START static char DELIM_STOP static int DELIM_START_LEN static int DELIM_STOP_LEN static StringBuffer sbuf new StringBuffer private OptionConverter public static String concatanateArrays String String int len length length String new String len System arraycopy length System arraycopy length length return public static String convertSpecialChars String char int len length StringBuffer sbuf new StringBuffer len int while len charAt if charAt if else if else if else if else if else if else if else if sbuf append return sbuf toString public static Object instantiateByKey Properties props String key Class superClass Object defaultValue String className props getProperty key if className null LogLog error key return defaultValue return OptionConverter instantiateByClassName className trim superClass defaultValue public static boolean toBoolean String value boolean dEfault if value null return dEfault String trimmedVal value trim if equalsIgnoreCase trimmedVal return true if equalsIgnoreCase trimmedVal return false return dEfault public static int toInt String value int dEfault if value null String value trim try return Integer valueOf intValue catch NumberFormatException LogLog error printStackTrace return dEfault public static long toFileSize String value long dEfault if value null return dEfault String value trim toUpperCase long multiplier int index if index indexOf multiplier substring index else if index indexOf multiplier substring index else if index indexOf multiplier substring index if null try return Long valueOf longValue multiplier catch NumberFormatException LogLog error LogLog error value return dEfault public static String findAndSubst String key Properties props String value props getProperty key if value null return null try return substVars value props catch IllegalArgumentException LogLog error value return value public static Object instantiateByClassName String className Class superClass Object defaultValue if className null try Class classObj Class forName className if superClass isAssignableFrom classObj LogLog error className superClass getName return classObj newInstance catch Exception LogLog error className return defaultValue public static String substVars String val Properties props throws IllegalArgumentException sbuf setLength int int while true val indexOf DELIM_START if if return val else sbuf append val substring val length return sbuf toString else sbuf append val substring val indexOf DELIM_STOP if throw new IllegalArgumentException val else DELIM_START_LEN String key val substring String replacement System getProperty key if replacement null props null replacement props getProperty key if replacement null sbuf append replacement DELIM_STOP_LEN static public void selectAndConfigure URL url Hierarchy hierarchy String clazz url getRef Configurator configurator null if clazz null LogLog debug clazz configurator Configurator instantiateByClassName clazz Configurator class null if configurator null LogLog error clazz return else String filename url getFile if filename null filename endsWith try configurator new DOMConfigurator catch NoClassDefFoundError LogLog warn return else configurator new PropertyConfigurator configurator doConfigure url hierarchy public class SpacePad static public void main String args StringBuffer sbuf new StringBuffer for int sbuf setLength sbuf append spacePad sbuf sbuf append System out println sbuf toString sbuf setLength sbuf append spacePad sbuf sbuf append System out println sbuf toString static public void spacePad StringBuffer sbuf int length while length sbuf append SPACES length for int if length sbuf append SPACES public class RendererMap Hashtable map static ObjectRenderer defaultRenderer new DefaultRenderer public RendererMap map new Hashtable public String findAndRender Object if null return null else return get getClass doRender public ObjectRenderer get Object if null return null else return get getClass public ObjectRenderer get Class clazz ObjectRenderer null for Class clazz null getSuperclass ObjectRenderer map get if null return searchInterfaces if null return return defaultRenderer ObjectRenderer searchInterfaces Class ObjectRenderer ObjectRenderer map get if null return else Class ia getInterfaces for int ia length searchInterfaces ia if null return return null public ObjectRenderer getDefaultRenderer return defaultRenderer public void clear map clear public void put Class clazz ObjectRenderer or map put clazz or public class SysoutConfigurator implements Configurator public void doConfigure java net URL url Hierarchy hierarchy Category getRoot addAppender new FileAppender new SimpleLayout System out public class CyclicBuffer LoggingEvent ea int first int last int numElems int maxSize public CyclicBuffer int maxSize throws IllegalArgumentException if maxSize throw new IllegalArgumentException maxSize this maxSize maxSize ea new LoggingEvent maxSize first last numElems public void add LoggingEvent event ea last event if last maxSize last if numElems maxSize numElems else if first maxSize first public LoggingEvent get int if numElems return null return ea first maxSize public int getMaxSize return maxSize public LoggingEvent get LoggingEvent null if numElems numElems ea first ea first null if first maxSize first return public int length return numElems public void resize int newSize if newSize throw new IllegalArgumentException newSize if newSize numElems LoggingEvent temp new LoggingEvent newSize int loopLen newSize numElems newSize numElems for int loopLen temp ea first ea first null if first numElems first ea temp first numElems loopLen maxSize newSize class DefaultCategoryFactory implements CategoryFactory DefaultCategoryFactory public Category makeNewCategoryInstance String name return new Category name public class SyslogQuietWriter extends QuietWriter int syslogFacility int priority public SyslogQuietWriter Writer writer int syslogFacility ErrorHandler eh super writer eh this syslogFacility syslogFacility public void setPriority int priority this priority priority public void setSyslogFacility int syslogFacility this syslogFacility syslogFacility public void write String string super write syslogFacility priority string public class AsyncAppender extends AppenderSkeleton implements AppenderAttachable public static final String LOCATION_INFO_OPTION static final int BUFFER_SIZE BoundedFIFO bf new BoundedFIFO BUFFER_SIZE AppenderAttachableImpl aai Dispatcher dispatcher boolean locationInfo false public AsyncAppender aai new AppenderAttachableImpl dispatcher new Dispatcher bf aai dispatcher start synchronized public void addAppender Appender newAppender aai addAppender newAppender public void append LoggingEvent event event getNDC event getThreadName if locationInfo event setLocationInformation synchronized bf if bf isFull try bf wait catch InterruptedException LogLog error bf put event if bf wasEmpty bf notify public void close return closed true dispatcher interrupt try dispatcher join catch InterruptedException LogLog error dispatcher null bf null public Enumeration getAllAppenders return aai getAllAppenders public Appender getAppender String name return aai getAppender name public String getOptionStrings return OptionConverter concatanateArrays super getOptionStrings new String LOCATION_INFO_OPTION public boolean requiresLayout return false synchronized public void removeAllAppenders aai removeAllAppenders synchronized public void removeAppender Appender appender aai removeAppender appender synchronized public void removeAppender String name aai removeAppender name public void setOption String option String value if value null return super setOption option value if option equals LOCATION_INFO_OPTION locationInfo OptionConverter toBoolean value locationInfo class Dispatcher extends Thread BoundedFIFO bf AppenderAttachableImpl aai Dispatcher BoundedFIFO bf AppenderAttachableImpl aai this bf bf this aai aai this setPriority Thread MIN_PRIORITY public void run LoggingEvent event while true synchronized bf if bf length if interrupted return try bf wait catch InterruptedException break event bf get if bf wasFull bf notify if aai null aai appendLoopOnAppenders event public class DateTimeDateFormat extends AbsoluteTimeDateFormat String shortMonths public DateTimeDateFormat super shortMonths new DateFormatSymbols getShortMonths public DateTimeDateFormat TimeZone timeZone this setCalendar Calendar getInstance timeZone public StringBuffer format Date date StringBuffer sbuf FieldPosition fieldPosition calendar setTime date int day calendar get Calendar DAY_OF_MONTH if day sbuf append sbuf append day sbuf append sbuf append shortMonths calendar get Calendar MONTH sbuf append int year calendar get Calendar YEAR sbuf append year sbuf append return super format date sbuf fieldPosition public Date parse java lang String ParsePosition pos return null public class Loop public static void main String args Category root Category getRoot Category cat Category getInstance Loop class getName if args length usage String host args int port try port Integer valueOf args intValue catch NumberFormatException usage args SocketAppender sa new SocketAppender host port Layout layout new PatternLayout FileAppender so new FileAppender layout System out root addAppender sa root addAppender so int while true NDC push cat debug root info NDC pop static void usage String msg System err println msg System err println Loop class getName System exit public class ThreadGroupRenderer implements ObjectRenderer public ThreadGroupRenderer public String doRender Object if instanceof ThreadGroup StringBuffer sbuf new StringBuffer ThreadGroup tg ThreadGroup sbuf append sbuf append tg getName sbuf append sbuf append tg getMaxPriority sbuf append Thread new Thread tg activeCount tg enumerate for int length sbuf append Layout LINE_SEP sbuf append sbuf append getName sbuf append sbuf append getPriority sbuf append sbuf append isDaemon sbuf append return sbuf toString else return toString public class SyslogMin static Category CAT Category getInstance SyslogMin class getName public static void main String argv if argv length ProgramInit argv else Usage test static void Usage String msg System err println msg System err println SyslogMin class System exit static void ProgramInit String configFile int port PropertyConfigurator configure configFile static void test String host NDC push host int CAT debug CAT info CAT warn CAT error CAT log Priority FATAL CAT debug new Exception public class Loop static Category cat Category getInstance Loop class getName static int loopLength public static void main String argv if argv length init argv argv else usage test static void usage String msg System err println msg System err println Loop class getName System exit static void init String configFile String loopStr PropertyConfigurator configure configFile try loopLength Integer parseInt loopStr catch java lang NumberFormatException printStackTrace usage loopStr static void test for int loopLength Thread yield cat debug public class Roller static Category cat Category getInstance Roller class getName static String host static int port Roller public static void main String argv BasicConfigurator configure if argv length init argv argv else usage roll static void usage String msg System err println msg System err println Roller class getName System exit static void init String hostArg String portArg host hostArg try port Integer parseInt portArg catch java lang NumberFormatException usage portArg static void roll try Socket socket new Socket host port DataOutputStream dos new DataOutputStream socket getOutputStream DataInputStream dis new DataInputStream socket getInputStream dos writeUTF ExternallyRolledFileAppender ROLL_OVER String rc dis readUTF if ExternallyRolledFileAppender OK equals rc cat info else cat warn rc System exit catch IOException cat error host port System exit System exit public class TPriority extends Priority static final int TRACE_INT static final int SYSLOG_TRACE_INT private static String TRACE_STR public static final TPriority TRACE new TPriority TRACE_INT protected TPriority int level String strLevel int syslogEquiv super level strLevel syslogEquiv public static Priority toPriority String sArg if sArg null return TPriority TRACE String stringVal sArg toUpperCase if stringVal equalsIgnoreCase TRACE_STR return TPriority TRACE return Priority toPriority sArg public static Priority toPriority int throws IllegalArgumentException switch case TRACE_INT return TPriority TRACE return Priority toPriority public interface ErrorCode public final int GENERIC_FAILURE public final int WRITE_FAILURE public final int FLUSH_FAILURE public final int CLOSE_FAILURE public final int FILE_OPEN_FAILURE public final int MISSING_LAYOUT public final int ADDRESS_PARSE_FAILURE public class RelativeTimeDateFormat extends DateFormat protected final long startTime public RelativeTimeDateFormat this startTime System currentTimeMillis public StringBuffer format Date date StringBuffer sbuf FieldPosition fieldPosition return sbuf append date getTime startTime public Date parse java lang String ParsePosition pos return null public class PriorityMatchFilter extends Filter public static final String PRIORITY_TO_MATCH_OPTION public static final String ACCEPT_ON_MATCH_OPTION boolean acceptOnMatch true Priority priorityToMatch public int decide LoggingEvent event if this priorityToMatch null return Filter NEUTRAL boolean matchOccured false if this priorityToMatch event priority matchOccured true if this acceptOnMatch matchOccured return Filter DENY else return Filter ACCEPT public String getOptionStrings return new String PRIORITY_TO_MATCH_OPTION ACCEPT_ON_MATCH_OPTION public void setOption String key String value if key equalsIgnoreCase PRIORITY_TO_MATCH_OPTION priorityToMatch Priority toPriority value null else if key equalsIgnoreCase ACCEPT_ON_MATCH_OPTION acceptOnMatch OptionConverter toBoolean value acceptOnMatch public class PatternLayout extends Layout final static public String CONVERSION_PATTERN_OPTION public final static String DEFAULT_CONVERSION_PATTERN public final static String TTCC_CONVERSION_PATTERN protected final int BUF_SIZE protected final int MAX_CAPACITY private StringBuffer sbuf new StringBuffer BUF_SIZE private PatternConverter head private String timezone public PatternLayout this DEFAULT_CONVERSION_PATTERN public PatternLayout String pattern head createPatternParser pattern null DEFAULT_CONVERSION_PATTERN pattern parse public void activateOptions protected PatternParser createPatternParser String pattern return new PatternParser pattern public String format LoggingEvent event if sbuf capacity MAX_CAPACITY sbuf new StringBuffer BUF_SIZE else sbuf setLength PatternConverter head while null format sbuf event next return sbuf toString public String getOptionStrings return new String CONVERSION_PATTERN_OPTION public boolean ignoresThrowable return true public void setConversionPattern String conversionPattern setOption CONVERSION_PATTERN_OPTION conversionPattern public void setOption String option String value if value null return if option equalsIgnoreCase CONVERSION_PATTERN_OPTION head createPatternParser value parse public abstract class FileWatchdog extends Thread static final public long DEFAULT_DELAY protected String filename protected long delay DEFAULT_DELAY File file long lastModif boolean warnedAlready false protected FileWatchdog String filename this filename filename file new File filename setDaemon true checkAndConfigure public void setDelay long delay this delay delay abstract protected void doOnChange protected void checkAndConfigure if file exists long file lastModified if lastModif lastModif doOnChange warnedAlready false else if warnedAlready LogLog debug filename warnedAlready true public void run while interrupted try Thread currentThread sleep delay catch InterruptedException checkAndConfigure public class NotLogging static int runLength final static int INITIAL_HASH_SIZE static String SHORT_MSG static Category SHORT_CAT Category getInstance static Category MEDIUM_CAT Category getInstance static Category LONG_CAT Category getInstance static Category INEXISTENT_SHORT_CAT Category getInstance static Category INEXISTENT_MEDIUM_CAT Category getInstance static Category INEXISTENT_LONG_CAT Category getInstance static Category CAT_ARRAY new Category SHORT_CAT MEDIUM_CAT LONG_CAT INEXISTENT_SHORT_CAT INEXISTENT_MEDIUM_CAT INEXISTENT_LONG_CAT static void Usage System err println System exit public static void main String argv if argv length Usage ProgramInit argv double delta System out println for int CAT_ARRAY length delta SimpleMessage CAT_ARRAY SHORT_MSG runLength System out println delta CAT_ARRAY getName System out println for int CAT_ARRAY length delta FullyOptimizedComplexMessage CAT_ARRAY runLength System out println delta CAT_ARRAY getName System out println for int CAT_ARRAY length delta ComplexMessage CAT_ARRAY runLength System out println delta CAT_ARRAY getName static void ProgramInit String args try runLength Integer parseInt args catch java lang NumberFormatException System err println Usage FileAppender appender new FileAppender new SimpleLayout System err if equals args else if equals args System out println BasicConfigurator disableInfo else Usage SHORT_CAT setPriority Priority INFO Category getRoot setPriority Priority INFO static double SimpleMessage Category category String msg long runLength long before System currentTimeMillis for int runLength category debug msg return System currentTimeMillis before runLength static double FullyOptimizedComplexMessage Category category long runLength long before System currentTimeMillis for int runLength if category isDebugEnabled category debug return System currentTimeMillis before runLength static double ComplexMessage Category category long runLength long before System currentTimeMillis for int runLength category debug return System currentTimeMillis before runLength public class Hierarchy static private CategoryFactory defaultFactory new DefaultCategoryFactory Hashtable ht Category root RendererMap rendererMap public Hierarchy Category root ht new Hashtable this root root this root setHierarchy this rendererMap new RendererMap public void addRenderer Class classToRender ObjectRenderer or rendererMap put classToRender or public void clear ht clear public Category exists String name Object ht get new CategoryKey name if instanceof Category return Category else return null public Category getInstance String name return getInstance name defaultFactory public Category getInstance String name CategoryFactory factory CategoryKey key new CategoryKey name Category category synchronized ht Object ht get key if null category factory makeNewCategoryInstance name category setHierarchy this ht put key category updateParents category return category else if instanceof Category return Category else if instanceof ProvisionNode category factory makeNewCategoryInstance name category setHierarchy this ht put key category updateChildren ProvisionNode category updateParents category return category else public RendererMap getRendererMap return rendererMap public Category getRoot return root final private void updateParents Category cat String name cat name int length name length boolean parentFound false for int name lastIndexOf length name lastIndexOf String substr name substring Object ht get key if null ProvisionNode pn new ProvisionNode cat ht put key pn else if instanceof Category parentFound true cat parent Category break else if instanceof ProvisionNode ProvisionNode addElement cat else Exception new IllegalStateException getClass printStackTrace if parentFound cat parent root final private void updateChildren ProvisionNode pn Category cat final int last pn size childLoop for int last Category Category pn elementAt if parent null parent name startsWith cat name continue childLoop while parent null parent name startsWith cat name parent cat parent parent parent cat public void shutdown Category root getRoot root closeNestedAppenders synchronized ht Enumeration cats Category getCurrentCategories while cats hasMoreElements Category Category cats nextElement closeNestedAppenders root removeAllAppenders cats Category getCurrentCategories while cats hasMoreElements Category Category cats nextElement removeAllAppenders public class NullAppender extends AppenderSkeleton public static String public String public NullAppender public NullAppender Layout layout this layout layout public void close public void doAppend LoggingEvent event if layout null layout format event public void append LoggingEvent event public boolean requiresLayout return true public class ROFile static Category cat Category getInstance ROFile class getName public static void main String argv if argv length init argv else Usage test static void Usage String msg System err println msg System err println ROFile class getName System exit static void init String configFile PropertyConfigurator configure configFile static void test int cat debug public class Shallow static Category cat Category getInstance Shallow class public static void main String argv if argv length init argv else usage test static void usage String msg System err println msg System err println Shallow class getName System exit static void init String configFile PropertyConfigurator configure configFile static void test int NDC push Category root Category getRoot cat debug root debug cat info root info cat warn root warn cat error root error cat log Priority FATAL root log Priority FATAL Exception new Exception cat debug root debug cat info root info cat warn root warn cat error root error cat log Priority FATAL root log Priority FATAL Category shutdown System gc static void delay int amount try Thread currentThread sleep amount catch Exception class ProvisionNode extends Vector ProvisionNode Category cat super this addElement cat public class XMLSample static Category cat Category getInstance XMLSample class getName public static void main String argv if argv length init argv else Usage sample static void Usage String msg System err println msg System err println XMLSample class getName System exit static void init String configFile DOMConfigurator configure configFile static void sample int Category root Category getRoot cat debug cat warn cat error Exception new Exception cat debug 