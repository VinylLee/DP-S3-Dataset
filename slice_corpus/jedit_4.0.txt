public class MacrosMenu extends EnhancedMenu implements EBComponent public MacrosMenu super updateMacrosMenu public void addNotify super addNotify EditBus addToBus this public void removeNotify super removeNotify EditBus removeFromBus this public void handleMessage EBMessage msg if msg instanceof MacrosChanged updateMacrosMenu private void updateMacrosMenu for int getMenuComponentCount if getMenuComponent instanceof JSeparator break else remove int count getMenuComponentCount Vector macroVector Macros getMacroHierarchy createMacrosMenu this macroVector if count getMenuComponentCount add GUIUtilities loadMenuItem private void createMacrosMenu JMenu menu Vector vector int start for int start vector size Object obj vector elementAt if obj instanceof Macros Macro Macros Macro macro Macros Macro obj menu add new EnhancedMenuItem macro getLabel macro else if obj instanceof Vector Vector subvector Vector obj String name String subvector elementAt JMenu submenu new JMenu name createMacrosMenu submenu subvector if submenu getMenuComponentCount submenu add GUIUtilities loadMenuItem menu add submenu public class ModeOptionPane extends AbstractOptionPane public ModeOptionPane super protected void Mode modes jEdit getModes String modeNames new String modes length modeProps new ModeProperties modes length for int modes length modeProps new ModeProperties modes modeNames modes getName mode new JComboBox modeNames mode addActionListener new ActionHandler addComponent jEdit getProperty mode useDefaults new JCheckBox jEdit getProperty useDefaults addActionListener new ActionHandler addComponent useDefaults addComponent jEdit getProperty filenameGlob new JTextField addComponent jEdit getProperty firstlineGlob new JTextField addComponent jEdit getProperty noWordSep new JTextField String foldModes FoldHandler getFoldModes addComponent jEdit getProperty folding new JComboBox foldModes addComponent jEdit getProperty collapseFolds new JTextField String wrapModes addComponent jEdit getProperty wrap new JComboBox wrapModes String lineLens addComponent jEdit getProperty maxLineLen new JComboBox lineLens maxLineLen setEditable true String tabSizes addComponent jEdit getProperty tabSize new JComboBox tabSizes tabSize setEditable true addComponent jEdit getProperty indentSize new JComboBox tabSizes indentSize setEditable true addComponent noTabs new JCheckBox jEdit getProperty addComponent indentOnTab new JCheckBox jEdit getProperty addComponent indentOnEnter new JCheckBox jEdit getProperty selectMode protected void saveMode for int modeProps length modeProps save private ModeProperties modeProps private ModeProperties current private JComboBox mode private JCheckBox useDefaults private JTextField filenameGlob private JTextField firstlineGlob private JTextField noWordSep private JComboBox folding private JTextField collapseFolds private JComboBox wrap private JComboBox maxLineLen private JComboBox tabSize private JComboBox indentSize private JCheckBox noTabs private JCheckBox indentOnTab private JCheckBox indentOnEnter private void saveMode current useDefaults useDefaults isSelected current filenameGlob filenameGlob getText current firstlineGlob firstlineGlob getText current noWordSep noWordSep getText current folding String folding getSelectedItem current collapseFolds collapseFolds getText current wrap String wrap getSelectedItem current maxLineLen String maxLineLen getSelectedItem current tabSize String tabSize getSelectedItem current indentSize String indentSize getSelectedItem current noTabs noTabs isSelected current indentOnEnter indentOnEnter isSelected current indentOnTab indentOnTab isSelected private void selectMode current modeProps mode getSelectedIndex current edited true current load useDefaults setSelected current useDefaults filenameGlob setText current filenameGlob firstlineGlob setText current firstlineGlob noWordSep setText current noWordSep folding setSelectedItem current folding collapseFolds setText current collapseFolds wrap setSelectedItem current wrap maxLineLen setSelectedItem current maxLineLen tabSize setSelectedItem current tabSize indentSize setSelectedItem current indentSize noTabs setSelected current noTabs indentOnTab setSelected current indentOnTab indentOnEnter setSelected current indentOnEnter updateEnabled private void updateEnabled boolean enabled modeProps mode getSelectedIndex useDefaults filenameGlob setEnabled enabled firstlineGlob setEnabled enabled noWordSep setEnabled enabled folding setEnabled enabled collapseFolds setEnabled enabled wrap setEnabled enabled maxLineLen setEnabled enabled tabSize setEnabled enabled indentSize setEnabled enabled noTabs setEnabled enabled indentOnTab setEnabled enabled indentOnEnter setEnabled enabled class ActionHandler implements ActionListener public void actionPerformed ActionEvent evt if evt getSource mode saveMode selectMode else if evt getSource useDefaults modeProps mode getSelectedIndex useDefaults useDefaults isSelected updateEnabled class ModeProperties Mode mode boolean edited boolean loaded boolean useDefaults String filenameGlob String firstlineGlob String noWordSep String folding String collapseFolds String wrap String maxLineLen String tabSize String indentSize boolean noTabs boolean indentOnTab boolean indentOnEnter ModeProperties Mode mode this mode mode void load if loaded return loaded true mode loadIfNecessary useDefaults jEdit getBooleanProperty mode getName filenameGlob String mode getProperty firstlineGlob String mode getProperty noWordSep String mode getProperty folding mode getProperty toString collapseFolds mode getProperty toString wrap mode getProperty toString maxLineLen mode getProperty toString tabSize mode getProperty toString indentSize mode getProperty toString noTabs mode getBooleanProperty indentOnTab mode getBooleanProperty indentOnEnter mode getBooleanProperty void save if edited return String prefix mode getName jEdit setBooleanProperty prefix useDefaults if useDefaults jEdit resetProperty prefix jEdit resetProperty prefix jEdit resetProperty prefix jEdit resetProperty prefix jEdit resetProperty prefix jEdit resetProperty prefix jEdit resetProperty prefix jEdit resetProperty prefix jEdit resetProperty prefix jEdit resetProperty prefix jEdit resetProperty prefix jEdit resetProperty prefix else jEdit setProperty prefix filenameGlob jEdit setProperty prefix firstlineGlob jEdit setProperty prefix noWordSep jEdit setProperty prefix folding jEdit setProperty prefix collapseFolds jEdit setProperty prefix wrap jEdit setProperty prefix maxLineLen jEdit setProperty prefix tabSize jEdit setProperty prefix indentSize jEdit setBooleanProperty prefix noTabs jEdit setBooleanProperty prefix indentOnTab jEdit setBooleanProperty prefix indentOnEnter public class ExplicitFoldHandler extends FoldHandler public ExplicitFoldHandler super public int getFoldLevel Buffer buffer int lineIndex Segment seg if lineIndex return else int tabSize buffer getTabSize int foldLevel buffer getFoldLevel lineIndex buffer getLineText lineIndex seg int offset seg offset int count seg count int openingBrackets closingBrackets for int count switch seg array offset case closingBrackets openingBrackets if openingBrackets foldLevel tabSize openingBrackets break case openingBrackets closingBrackets if closingBrackets if foldLevel tabSize foldLevel tabSize closingBrackets break default closingBrackets openingBrackets break return foldLevel public class GeneralOptionPane extends AbstractOptionPane public GeneralOptionPane super protected void history new JTextField jEdit getProperty addComponent jEdit getProperty history saveCaret new JCheckBox jEdit getProperty saveCaret setSelected jEdit getBooleanProperty addComponent saveCaret sortBuffers new JCheckBox jEdit getProperty sortBuffers setSelected jEdit getBooleanProperty sortBuffers addActionListener new ActionListener public void actionPerformed ActionEvent evt sortByName setEnabled sortBuffers isSelected addComponent sortBuffers sortByName new JCheckBox jEdit getProperty sortByName setSelected jEdit getBooleanProperty sortByName setEnabled sortBuffers isSelected addComponent sortByName sortRecent new JCheckBox jEdit getProperty sortRecent setSelected jEdit getBooleanProperty addComponent sortRecent checkModStatus new JCheckBox jEdit getProperty checkModStatus setSelected jEdit getBooleanProperty addComponent checkModStatus showFullPath new JCheckBox jEdit getProperty showFullPath setSelected jEdit getBooleanProperty addComponent showFullPath showSearchbar new JCheckBox jEdit getProperty showSearchbar setSelected jEdit getBooleanProperty addComponent showSearchbar beepOnSearchAutoWrap new JCheckBox jEdit getProperty beepOnSearchAutoWrap setSelected jEdit getBooleanProperty addComponent beepOnSearchAutoWrap showBufferSwitcher new JCheckBox jEdit getProperty showBufferSwitcher setSelected jEdit getBooleanProperty addComponent showBufferSwitcher showTips new JCheckBox jEdit getProperty showTips setSelected jEdit getBooleanProperty addComponent showTips showSplash new JCheckBox jEdit getProperty String settingsDirectory jEdit getSettingsDirectory if settingsDirectory null showSplash setSelected true else showSplash setSelected new File settingsDirectory exists addComponent showSplash protected void jEdit setProperty history getText jEdit setBooleanProperty saveCaret isSelected jEdit setBooleanProperty sortBuffers isSelected jEdit setBooleanProperty sortByName isSelected jEdit setBooleanProperty sortRecent isSelected jEdit setBooleanProperty checkModStatus isSelected jEdit setBooleanProperty showFullPath isSelected jEdit setBooleanProperty showSearchbar isSelected jEdit setBooleanProperty beepOnSearchAutoWrap isSelected jEdit setBooleanProperty showBufferSwitcher isSelected jEdit setBooleanProperty showTips isSelected String settingsDirectory jEdit getSettingsDirectory if settingsDirectory null File file new File settingsDirectory if showSplash isSelected file delete else try FileOutputStream out new FileOutputStream file out write out close catch IOException io Log log Log ERROR this io private JTextField history private JCheckBox saveCaret private JCheckBox sortBuffers private JCheckBox sortByName private JCheckBox sortRecent private JCheckBox checkModStatus private JCheckBox showFullPath private JCheckBox showSearchbar private JCheckBox beepOnSearchAutoWrap private JCheckBox showBufferSwitcher private JCheckBox showTips private JCheckBox showSplash public class ReflectManagerImpl extends ReflectManager public boolean setAccessible Object obj if obj instanceof AccessibleObject AccessibleObject obj setAccessible true return true else return false public class CurrentDirectoryMenu extends EnhancedMenu public CurrentDirectoryMenu super public void setPopupMenuVisible boolean if final View view GUIUtilities getView this if getMenuComponentCount removeAll final String path MiscUtilities getParentOfPath view getBuffer getPath JMenuItem mi new JMenuItem path mi setIcon FileCellRenderer openDirIcon mi addActionListener new ActionListener public void actionPerformed ActionEvent evt VFSBrowser browseDirectory view path add mi addSeparator if view getBuffer getFile null mi new JMenuItem jEdit getProperty mi setEnabled false add mi super setPopupMenuVisible return File dir new File path JMenu current this ActionListener listener new ActionListener public void actionPerformed ActionEvent evt jEdit openFile view evt getActionCommand String backupPrefix jEdit getProperty String backupSuffix jEdit getProperty String list dir list if list null list length mi new JMenuItem jEdit getProperty mi setEnabled false add mi else MiscUtilities quicksort list new MiscUtilities StringICaseCompare for int list length String name list if name endsWith continue if name startsWith name endsWith continue if backupPrefix length name startsWith backupPrefix backupSuffix length name endsWith backupSuffix continue File file new File path name if file isDirectory continue mi new JMenuItem name mi setActionCommand file getPath mi addActionListener listener mi setIcon FileCellRenderer fileIcon if current getItemCount list length JMenu newCurrent new JMenu jEdit getProperty current add newCurrent current newCurrent current add mi super setPopupMenuVisible public class JCheckBoxList extends JTable public JCheckBoxList Object items setModel items public JCheckBoxList Vector items setModel items public void setModel Object items setModel new CheckBoxListModel items init public void setModel Vector items setModel new CheckBoxListModel items init public Object getCheckedValues Vector values new Vector CheckBoxListModel model CheckBoxListModel getModel for int model items size Entry entry Entry model items elementAt if entry checked values addElement entry value Object retVal new Object values size values copyInto retVal return retVal public Entry getValues CheckBoxListModel model CheckBoxListModel getModel Entry retVal new Entry model items size model items copyInto retVal return retVal public Object getSelectedValue int row getSelectedRow if row return null else return getModel getValueAt row private void init getSelectionModel setSelectionMode ListSelectionModel SINGLE_SELECTION setShowGrid false setAutoResizeMode JTable AUTO_RESIZE_LAST_COLUMN TableColumn column getColumnModel getColumn int checkBoxWidth new JCheckBox getPreferredSize width column setPreferredWidth checkBoxWidth column setMinWidth checkBoxWidth column setWidth checkBoxWidth column setMaxWidth checkBoxWidth column setResizable false public static class Entry boolean checked Object value public Entry boolean checked Object value this checked checked this value value public boolean isChecked return checked public Object getValue return value class CheckBoxListModel extends AbstractTableModel Vector items CheckBoxListModel Vector items new Vector size for int size items addElement createEntry elementAt CheckBoxListModel Object items new Vector length for int length items addElement createEntry private JCheckBoxList Entry createEntry Object obj if obj instanceof JCheckBoxList Entry return JCheckBoxList Entry obj else return new JCheckBoxList Entry false obj public int getRowCount return items size public int getColumnCount return public String getColumnName int col return null public Object getValueAt int row int col JCheckBoxList Entry entry JCheckBoxList Entry items elementAt row switch col case return new Boolean entry checked case return entry value default throw new InternalError public Class getColumnClass int col switch col case return Boolean class case return String class default throw new InternalError public boolean isCellEditable int row int col return col public void setValueAt Object value int row int col if col JCheckBoxList Entry items elementAt row checked value equals Boolean TRUE fireTableRowsUpdated row row interface Node extends java io Serializable public void jjtOpen public void jjtClose public void jjtSetParent Node public Node jjtGetParent public void jjtAddChild Node int public Node jjtGetChild int public int jjtGetNumChildren public class ColorOptionPane extends AbstractOptionPane public static final EmptyBorder noFocusBorder new EmptyBorder public ColorOptionPane super protected void setLayout new BorderLayout add BorderLayout CENTER createColorTableScroller protected void colorModel save private ColorTableModel colorModel private JTable colorTable private JScrollPane createColorTableScroller colorModel createColorTableModel colorTable new JTable colorModel colorTable setRowSelectionAllowed false colorTable setColumnSelectionAllowed false colorTable setCellSelectionEnabled false colorTable getTableHeader setReorderingAllowed false colorTable addMouseListener new MouseHandler TableColumnModel tcm colorTable getColumnModel TableColumn colorColumn tcm getColumn colorColumn setCellRenderer new ColorTableModel ColorRenderer Dimension colorTable getPreferredSize height Math min height JScrollPane scroller new JScrollPane colorTable scroller setPreferredSize return scroller private ColorTableModel createColorTableModel return new ColorTableModel class MouseHandler extends MouseAdapter public void mouseClicked MouseEvent evt int row colorTable rowAtPoint evt getPoint if row return Color color JColorChooser showDialog ColorOptionPane this jEdit getProperty Color colorModel getValueAt row if color null colorModel setValueAt color row class ColorTableModel extends AbstractTableModel private Vector colorChoices ColorTableModel colorChoices new Vector addColorChoice addColorChoice addColorChoice addColorChoice addColorChoice addColorChoice addColorChoice addColorChoice addColorChoice addColorChoice addColorChoice addColorChoice addColorChoice addColorChoice addColorChoice addColorChoice addColorChoice addColorChoice MiscUtilities quicksort colorChoices new MiscUtilities StringCompare public int getColumnCount return public int getRowCount return colorChoices size public Object getValueAt int row int col ColorChoice ch ColorChoice colorChoices elementAt row switch col case return ch label case return ch color default return null public void setValueAt Object value int row int col ColorChoice ch ColorChoice colorChoices elementAt row if col ch color Color value fireTableRowsUpdated row row public String getColumnName int index switch index case return jEdit getProperty case return jEdit getProperty default return null public void save for int colorChoices size ColorChoice ch ColorChoice colorChoices elementAt jEdit setColorProperty ch property ch color private void addColorChoice String label String property colorChoices addElement new ColorChoice jEdit getProperty label property jEdit getColorProperty property static class ColorChoice String label String property Color color ColorChoice String label String property Color color this label label this property property this color color public String toString return label static class ColorRenderer extends JLabel implements TableCellRenderer public ColorRenderer setOpaque true setBorder StyleOptionPane noFocusBorder public Component getTableCellRendererComponent JTable table Object value boolean isSelected boolean cellHasFocus int row int col if isSelected setBackground table getSelectionBackground setForeground table getSelectionForeground else setBackground table getBackground setForeground table getForeground if value null setBackground Color value setBorder cellHasFocus UIManager getBorder StyleOptionPane noFocusBorder return this public class BoyerMooreSearchMatcher implements SearchMatcher public BoyerMooreSearchMatcher String pattern String replace boolean ignoreCase boolean reverseSearch boolean beanshell String replaceMethod if ignoreCase this pattern pattern toUpperCase toCharArray else this pattern pattern toCharArray if reverseSearch char tmp new char this pattern length for int tmp length tmp this pattern this pattern length this pattern tmp this replace replace this ignoreCase ignoreCase this reverseSearch reverseSearch if beanshell replace null replace length this beanshell true this replaceMethod replaceMethod replaceNS new NameSpace BeanShell getNameSpace generateSkipArray generateSuffixArray public int nextMatch CharIndexed text boolean start boolean end boolean firstTime int pos match text if pos return null else return new int pos pos pattern length public String substitute String text throws Exception if beanshell replaceNS setVariable text Object obj BeanShell runCachedBlock replaceMethod null replaceNS if obj null return else return obj toString else return replace public int match CharIndexed text int pos int anchor int pattern_end pattern length char ch int bad_char int good_suffix SEARCH while text isValid for pos pattern_end pos pos ch text charAt pos if ignoreCase ch Character toUpperCase ch if ch pattern pos bad_char pos skip getSkipIndex ch good_suffix suffix pos int skip bad_char good_suffix bad_char good_suffix anchor skip text move skip continue SEARCH return anchor return private char pattern private String replace private boolean ignoreCase private boolean reverseSearch private boolean beanshell private String replaceMethod private NameSpace replaceNS private int skip private int suffix private void generateSkipArray skip new int if pattern length return int pos do skip getSkipIndex pattern pos pos while pos pattern length private static final int getSkipIndex char ch return int ch private void generateSuffixArray int pattern length int suffix new int int tmp new int tmp for int while pattern pattern if suffix suffix tmp tmp int tmp for if suffix suffix suffix if tmp public class PluginResURLConnection extends URLConnection public PluginResURLConnection URL url throws IOException super url String file url getFile int index file indexOf if index plugin null resource file else int start if file charAt start else start plugin file substring start index resource file substring index if plugin null resource startsWith resource resource substring public void connect throws IOException if connected if plugin null in jEdit class getResourceAsStream resource else EditPlugin JAR plugins jEdit getPluginJARs for int plugins length EditPlugin JAR jar plugins if MiscUtilities getFileName jar getPath equalsIgnoreCase plugin in jar getClassLoader getResourceAsStream resource break if in null throw new IOException resource connected true public InputStream getInputStream throws IOException connect return in public String getHeaderField String name if name equals String lcResource resource toLowerCase if lcResource endsWith return else if lcResource endsWith return else if lcResource endsWith return else if lcResource endsWith return else if lcResource endsWith lcResource endsWith return else return null else return null private InputStream in private String plugin private String resource public class JARClassLoader extends ClassLoader public JARClassLoader public JARClassLoader String path throws IOException zipFile new ZipFile path jar new EditPlugin JAR path this Enumeration entires zipFile entries while entires hasMoreElements ZipEntry entry ZipEntry entires nextElement String name entry getName String lname name toLowerCase if lname equals jEdit loadActions path new BufferedReader new InputStreamReader zipFile getInputStream entry jar getActions if lname equals DockableWindowManager loadDockableWindows path new BufferedReader new InputStreamReader zipFile getInputStream entry jar getActions else if lname endsWith jEdit loadProps zipFile getInputStream entry true else if name endsWith classHash put MiscUtilities fileToClass name this if name endsWith pluginClasses addElement name jEdit addPluginJAR jar public Class loadClass String clazz boolean resolveIt throws ClassNotFoundException Object obj classHash get clazz if obj NO_CLASS throw new ClassNotFoundException clazz else if obj instanceof ClassLoader JARClassLoader classLoader JARClassLoader obj return classLoader clazz resolveIt try Class cls ClassLoader parentLoader getClass getClassLoader if parentLoader null cls parentLoader loadClass clazz else cls findSystemClass clazz return cls catch ClassNotFoundException cnf classHash put clazz NO_CLASS throw cnf public InputStream getResourceAsStream String name if zipFile null return null try ZipEntry entry zipFile getEntry name if entry null return getSystemResourceAsStream name else return zipFile getInputStream entry catch IOException io Log log Log ERROR this io return null public URL getResource String name if zipFile null return null ZipEntry entry zipFile getEntry name if entry null return getSystemResource name try return new URL getResourceAsPath name catch MalformedURLException mu Log log Log ERROR this mu return null public String getResourceAsPath String name if zipFile null return null if name startsWith name name return MiscUtilities getFileName jar getPath name public void closeZipFile if zipFile null return try zipFile close catch IOException io Log log Log ERROR this io zipFile null public ZipFile getZipFile return zipFile void startAllPlugins for int pluginClasses size String name String pluginClasses elementAt name MiscUtilities fileToClass name try loadPluginClass name catch Throwable Log log Log ERROR this name Log log Log ERROR this jar addPlugin new EditPlugin Broken name String args toString jEdit pluginError jar getPath args private static final Object NO_CLASS new Object private static Hashtable classHash new Hashtable private EditPlugin JAR jar private Vector pluginClasses new Vector private ZipFile zipFile private void loadPluginClass String name throws Exception EditPlugin plugins jEdit getPlugins for int plugins length if plugins getClass getName equals name jEdit pluginError jar getPath null return if name equals jEdit getProperty equals OperatingSystem hasJava14 jar addPlugin new EditPlugin Broken name jEdit pluginError jar getPath null return if checkDependencies name jar addPlugin new EditPlugin Broken name return Class clazz loadClass name true int modifiers clazz getModifiers if Modifier isInterface modifiers Modifier isAbstract modifiers EditPlugin class isAssignableFrom clazz String label jEdit getProperty name String version jEdit getProperty name if version null Log log Log ERROR this name jar addPlugin new EditPlugin Broken name return jar getActions setLabel jEdit getProperty new String label Log log Log NOTICE this label version jar addPlugin EditPlugin clazz newInstance private boolean checkDependencies String name int String dep while dep jEdit getProperty name null int index dep indexOf if index Log log Log ERROR this name dep return false String what dep substring index String arg dep substring index if what equals if MiscUtilities compareStrings System getProperty arg false String args arg System getProperty jEdit pluginError jar getPath args return false else if what equals if arg length Log log Log ERROR this arg return false if MiscUtilities compareStrings jEdit getBuild arg false String needs MiscUtilities buildToVersion arg String args needs jEdit getVersion jEdit pluginError jar getPath args return false else if what equals int index2 arg indexOf if index2 Log log Log ERROR this name dep return false String plugin arg substring index2 String needVersion arg substring index2 String currVersion jEdit getProperty plugin if currVersion null String args needVersion plugin jEdit pluginError jar getPath args return false if MiscUtilities compareStrings currVersion needVersion false String args needVersion plugin currVersion jEdit pluginError jar getPath args return false if jEdit getPlugin plugin instanceof EditPlugin Broken String args plugin jEdit pluginError jar getPath args return false else if what equals try loadClass arg false catch Exception String args arg jEdit pluginError jar getPath args return false else Log log Log ERROR this name dep return false return true private Class String clazz boolean resolveIt throws ClassNotFoundException Class cls findLoadedClass clazz if cls null if resolveIt resolveClass cls return cls String name MiscUtilities classToFile clazz try ZipEntry entry zipFile getEntry name if entry null throw new ClassNotFoundException clazz InputStream in zipFile getInputStream entry int len int entry getSize byte data new byte len int success int offset while success len len success offset success success in read data offset len if success Log log Log ERROR this clazz zipFile getName throw new ClassNotFoundException clazz cls defineClass clazz data data length if resolveIt resolveClass cls return cls catch IOException io Log log Log ERROR this io throw new ClassNotFoundException clazz public class DefaultInputHandler extends InputHandler public DefaultInputHandler View view super view bindings currentBindings new Hashtable public DefaultInputHandler View view DefaultInputHandler copy super view bindings currentBindings copy bindings public void addKeyBinding String keyBinding EditAction action Hashtable current bindings StringTokenizer st new StringTokenizer keyBinding while st hasMoreTokens KeyStroke keyStroke parseKeyStroke st nextToken if keyStroke null return if st hasMoreTokens Object current get keyStroke if instanceof Hashtable current Hashtable else new Hashtable current put keyStroke current Hashtable else current put keyStroke action public void removeKeyBinding String keyBinding throw new InternalError public void removeAllKeyBindings bindings clear public Object getKeyBinding String keyBinding Hashtable current bindings StringTokenizer st new StringTokenizer keyBinding while st hasMoreTokens KeyStroke keyStroke parseKeyStroke st nextToken if keyStroke null return null if st hasMoreTokens Object current get keyStroke if instanceof Hashtable current Hashtable else return else return current get keyStroke return null public boolean isPrefixActive return bindings currentBindings public void keyPressed KeyEvent evt int keyCode evt getKeyCode int modifiers evt getModifiers if evt isControlDown evt isAltDown evt isMetaDown if keyCode KeyEvent VK_A keyCode KeyEvent VK_Z keyCode KeyEvent VK_0 keyCode KeyEvent VK_9 return else if keyCode KeyEvent VK_SPACE return else if readNextChar null if keyCode KeyEvent VK_ESCAPE readNextChar null view getStatus setMessage null else if evt isActionKey keyCode KeyEvent VK_TAB keyCode KeyEvent VK_ENTER return else KeyStroke keyStroke KeyStroke getKeyStroke keyCode modifiers Object currentBindings get keyStroke if null if currentBindings bindings Toolkit getDefaultToolkit beep repeatCount repeat false evt consume currentBindings bindings else if modifiers keyCode KeyEvent VK_ENTER keyCode KeyEvent VK_TAB userInput char keyCode evt consume if readNextChar null readNextChar null view getStatus setMessage null if instanceof EditAction currentBindings bindings invokeAction EditAction evt consume else if instanceof Hashtable currentBindings Hashtable evt consume if null switch evt getKeyCode case KeyEvent VK_NUMPAD0 case KeyEvent VK_NUMPAD1 case KeyEvent VK_NUMPAD2 case KeyEvent VK_NUMPAD3 case KeyEvent VK_NUMPAD4 case KeyEvent VK_NUMPAD5 case KeyEvent VK_NUMPAD6 case KeyEvent VK_NUMPAD7 case KeyEvent VK_NUMPAD8 case KeyEvent VK_NUMPAD9 case KeyEvent VK_MULTIPLY case KeyEvent VK_ADD case KeyEvent VK_DECIMAL case KeyEvent VK_DIVIDE KeyEventWorkaround numericKeypadKey break public void keyTyped KeyEvent evt char evt getKeyChar if return KeyStroke keyStroke switch case keyStroke KeyStroke getKeyStroke KeyEvent VK_SPACE evt getModifiers break case keyStroke KeyStroke getKeyStroke KeyEvent VK_TAB evt getModifiers break case keyStroke KeyStroke getKeyStroke KeyEvent VK_ENTER evt getModifiers break default keyStroke KeyStroke getKeyStroke break Object currentBindings get keyStroke if instanceof Hashtable currentBindings Hashtable else if instanceof EditAction currentBindings bindings invokeAction EditAction else currentBindings bindings if repeat Character isDigit repeatCount repeatCount view getStatus setMessage null else userInput public static KeyStroke parseKeyStroke String keyStroke if keyStroke null return null int modifiers int index keyStroke indexOf if index for int index switch Character toUpperCase keyStroke charAt case modifiers InputEvent ALT_MASK break case if OperatingSystem isMacOS modifiers InputEvent META_MASK else modifiers InputEvent CTRL_MASK break case if OperatingSystem isMacOS modifiers InputEvent CTRL_MASK else modifiers InputEvent META_MASK break case modifiers InputEvent SHIFT_MASK break String key keyStroke substring index if key length char ch key charAt if modifiers return KeyStroke getKeyStroke ch else return KeyStroke getKeyStroke Character toUpperCase ch modifiers else if key length Log log Log ERROR DefaultInputHandler class keyStroke return null else int ch try ch KeyEvent class getField concat key getInt null catch Exception Log log Log ERROR DefaultInputHandler class keyStroke return null return KeyStroke getKeyStroke ch modifiers private Hashtable bindings private Hashtable currentBindings public class EditingOptionPane extends AbstractOptionPane public EditingOptionPane super protected void Mode modes jEdit getModes String defaultModeString jEdit getProperty String modeNames new String modes length int index for int modes length Mode modes modeNames getName if defaultModeString equals getName index defaultMode new JComboBox modeNames defaultMode setSelectedIndex index addComponent jEdit getProperty defaultMode undoCount new JTextField jEdit getProperty addComponent jEdit getProperty undoCount defaultNoWordSep new JTextField jEdit getProperty addComponent jEdit getProperty defaultNoWordSep String foldModes FoldHandler getFoldModes addComponent jEdit getProperty defaultFolding new JComboBox foldModes defaultFolding setSelectedItem jEdit getProperty defaultCollapseFolds new JTextField jEdit getProperty addComponent jEdit getProperty defaultCollapseFolds String wrapModes addComponent jEdit getProperty defaultWrap new JComboBox wrapModes defaultWrap setSelectedItem jEdit getProperty String lineLens defaultMaxLineLen new JComboBox lineLens defaultMaxLineLen setEditable true defaultMaxLineLen setSelectedItem jEdit getProperty addComponent jEdit getProperty defaultMaxLineLen String tabSizes defaultTabSize new JComboBox tabSizes defaultTabSize setEditable true defaultTabSize setSelectedItem jEdit getProperty addComponent jEdit getProperty defaultTabSize defaultIndentSize new JComboBox tabSizes defaultIndentSize setEditable true defaultIndentSize setSelectedItem jEdit getProperty addComponent jEdit getProperty defaultIndentSize defaultNoTabs new JCheckBox jEdit getProperty defaultNoTabs setSelected jEdit getBooleanProperty addComponent defaultNoTabs defaultIndentOnTab new JCheckBox jEdit getProperty defaultIndentOnTab setSelected jEdit getBooleanProperty addComponent defaultIndentOnTab defaultIndentOnEnter new JCheckBox jEdit getProperty defaultIndentOnEnter setSelected jEdit getBooleanProperty addComponent defaultIndentOnEnter protected void jEdit setProperty String defaultMode getSelectedItem jEdit setProperty undoCount getText jEdit setProperty defaultNoWordSep getText jEdit setProperty String defaultFolding getSelectedItem jEdit setProperty defaultCollapseFolds getText jEdit setProperty String defaultWrap getSelectedItem jEdit setProperty String defaultMaxLineLen getSelectedItem jEdit setProperty String defaultTabSize getSelectedItem jEdit setProperty String defaultIndentSize getSelectedItem jEdit setBooleanProperty defaultNoTabs isSelected jEdit setBooleanProperty defaultIndentOnTab isSelected jEdit setBooleanProperty defaultIndentOnEnter isSelected private JComboBox defaultMode private JTextField undoCount private JTextField defaultNoWordSep private JComboBox defaultFolding private JTextField defaultCollapseFolds private JComboBox defaultWrap private JComboBox defaultMaxLineLen private JComboBox defaultTabSize private JComboBox defaultIndentSize private JCheckBox defaultNoTabs private JCheckBox defaultIndentOnTab private JCheckBox defaultIndentOnEnter public interface ConsoleInterface public Reader getIn public PrintStream getOut public PrintStream getErr public void println String public void print String public void error String public class JEditTextArea extends JComponent public JEditTextArea View view enableEvents AWTEvent FOCUS_EVENT_MASK AWTEvent KEY_EVENT_MASK this view view selection new Vector chunkCache new ChunkCache this painter new TextAreaPainter this gutter new Gutter view this bufferHandler new BufferChangeHandler listenerList new EventListenerList caretEvent new MutableCaretEvent bracketLine bracketPosition blink true lineSegment new Segment returnValue new Point runnables new ArrayList setLayout new ScrollLayout add LEFT gutter add CENTER painter add RIGHT vertical new JScrollBar JScrollBar VERTICAL add BOTTOM horizontal new JScrollBar JScrollBar HORIZONTAL horizontal setValues if UIManager getLookAndFeel instanceof MetalLookAndFeel setBorder new TextAreaBorder vertical putClientProperty Boolean FALSE horizontal putClientProperty Boolean FALSE vertical addAdjustmentListener new AdjustHandler horizontal addAdjustmentListener new AdjustHandler mouseHandler new MouseHandler painter addMouseListener mouseHandler painter addMouseMotionListener mouseHandler addFocusListener new FocusHandler focusedComponent this public final TextAreaPainter getPainter return painter public final Gutter getGutter return gutter public FoldVisibilityManager getFoldVisibilityManager return foldVisibilityManager public final boolean isCaretBlinkEnabled return caretBlinks public void setCaretBlinkEnabled boolean caretBlinks this caretBlinks caretBlinks if caretBlinks blink false if buffer null invalidateLine caretLine public final int getElectricScroll return electricScroll public final void setElectricScroll int electricScroll this electricScroll electricScroll public final boolean isQuickCopyEnabled return quickCopy public final void setQuickCopyEnabled boolean quickCopy this quickCopy quickCopy public final Buffer getBuffer return buffer public void setBuffer Buffer buffer if this buffer buffer return try bufferChanging true if this buffer null setFirstLine selectNone caretLine caret caretScreenLine bracketLine bracketPosition this buffer foldVisibilityManager this buffer removeBufferChangeListener bufferHandler this buffer buffer buffer addBufferChangeListener bufferHandler bufferHandlerInstalled true foldVisibilityManager buffer this chunkCache setFirstLine physFirstLine foldVisibilityManager getFirstVisibleLine propertiesChanged recalculateLastPhysicalLine finally bufferChanging false public final boolean isEditable return buffer isEditable public final JPopupMenu getRightClickPopup return popup public final void setRightClickPopup JPopupMenu popup this popup popup public final int getFirstLine return firstLine public void setFirstLine int firstLine if firstLine this firstLine return firstLine view synchroScrollVertical this firstLine public void int firstLine firstLine Math max Math min getVirtualLineCount firstLine this firstLine firstLine physFirstLine virtualToPhysical firstLine maxHorizontalScrollWidth chunkCache setFirstLine firstLine recalculateLastPhysicalLine if this firstLine vertical getValue updateScrollBars painter repaint gutter repaint fireScrollEvent true public final int getVisibleLines return visibleLines public final int getFirstPhysicalLine return physFirstLine public final int getLastPhysicalLine return physLastLine public final int getHorizontalOffset return horizontalOffset public void setHorizontalOffset int horizontalOffset if horizontalOffset this horizontalOffset return horizontalOffset view synchroScrollHorizontal this horizontalOffset public void int horizontalOffset this horizontalOffset horizontalOffset if horizontalOffset horizontal getValue updateScrollBars painter repaint fireScrollEvent false public void updateScrollBars if vertical null visibleLines int lineCount getVirtualLineCount if softWrap lineCount visibleLines if lineCount firstLine visibleLines int newFirstLine Math max lineCount visibleLines if newFirstLine firstLine setFirstLine newFirstLine return vertical setValues firstLine visibleLines lineCount vertical setUnitIncrement vertical setBlockIncrement visibleLines int width painter getWidth if horizontal null width maxHorizontalScrollWidth painter repaint horizontal setUnitIncrement painter getFontMetrics charWidth horizontal setBlockIncrement width public void scrollUpLine if firstLine setFirstLine firstLine else getToolkit beep public void scrollUpPage if firstLine int newFirstLine firstLine visibleLines setFirstLine newFirstLine else getToolkit beep public void scrollDownLine int numLines getVirtualLineCount if softWrap firstLine numLines firstLine visibleLines numLines setFirstLine firstLine else getToolkit beep public void scrollDownPage int numLines getVirtualLineCount if firstLine visibleLines numLines int newFirstLine firstLine visibleLines setFirstLine newFirstLine visibleLines numLines newFirstLine numLines visibleLines else getToolkit beep public void scrollToCaret boolean doElectricScroll scrollTo caretLine caret buffer getLineStartOffset caretLine doElectricScroll public void scrollTo int line int offset boolean doElectricScroll int doElectricScroll visibleLines electricScroll if visibleLines setFirstLine physicalToVirtual Math max line return int screenLine getScreenLineOfOffset buffer getLineStartOffset line offset Point point if screenLine int height painter getFontMetrics getHeight Rectangle rect new Rectangle height painter getWidth visibleLines height height point offsetToXY line offset returnValue if rect contains point return else point null if line physLastLine int count chunkCache getLineInfosForPhysicalLine physLastLine length chunkCache getLineInfosForPhysicalLine physLastLine length while count count chunkCache getLineInfosForPhysicalLine physFirstLine length firstLine physFirstLine foldVisibilityManager getNextVisibleLine physFirstLine else if screenLine if line physLastLine int count chunkCache getLineInfosForPhysicalLine physLastLine length while count count chunkCache getLineInfosForPhysicalLine physFirstLine length firstLine physFirstLine foldVisibilityManager getNextVisibleLine physFirstLine int virtualLine foldVisibilityManager physicalToVirtual line if virtualLine firstLine firstLine Math max firstLine physFirstLine foldVisibilityManager virtualToPhysical firstLine else if softWrap virtualLine foldVisibilityManager getVirtualLineCount visibleLines firstLine foldVisibilityManager getVirtualLineCount visibleLines physFirstLine foldVisibilityManager virtualToPhysical firstLine else physFirstLine line int count for if foldVisibilityManager isLineVisible physFirstLine int incr chunkCache getLineInfosForPhysicalLine physFirstLine length if count incr visibleLines break else count incr if physFirstLine break else physFirstLine foldVisibilityManager getPrevVisibleLine physFirstLine firstLine physicalToVirtual physFirstLine else if screenLine firstLine int count screenLine while count firstLine count chunkCache getLineInfosForPhysicalLine physFirstLine length firstLine physFirstLine foldVisibilityManager getPrevVisibleLine physFirstLine else if screenLine visibleLines int count visibleLines screenLine while count firstLine getVirtualLineCount count chunkCache getLineInfosForPhysicalLine physFirstLine length firstLine physFirstLine foldVisibilityManager getNextVisibleLine physFirstLine chunkCache setFirstLine firstLine recalculateLastPhysicalLine if point null point offsetToXY line offset returnValue if point null return if point horizontalOffset Math min horizontalOffset point charWidth else if point painter getWidth charWidth horizontalOffset horizontalOffset painter getWidth point charWidth updateScrollBars painter repaint gutter repaint view synchroScrollVertical this firstLine view synchroScrollHorizontal this horizontalOffset fireScrollEvent true fireScrollEvent false public final void addScrollListener ScrollListener listener listenerList add ScrollListener class listener public final void removeScrollListener ScrollListener listener listenerList remove ScrollListener class listener public int getPhysicalLineOfScreenLine int screenLine return chunkCache getLineInfo screenLine physicalLine public int getScreenLineOfOffset int offset int line buffer getLineOfOffset offset offset buffer getLineStartOffset line return chunkCache getScreenLineOfOffset line offset public int getScreenLineStartOffset int line chunkCache updateChunksUpTo line ChunkCache LineInfo lineInfo chunkCache getLineInfo line if lineInfo physicalLine return return buffer getLineStartOffset lineInfo physicalLine lineInfo offset public int getScreenLineEndOffset int line chunkCache updateChunksUpTo line ChunkCache LineInfo lineInfo chunkCache getLineInfo line if lineInfo physicalLine return return buffer getLineStartOffset lineInfo physicalLine lineInfo offset lineInfo length public int xyToOffset int int return xyToOffset true public int xyToOffset int int boolean round FontMetrics fm painter getFontMetrics int height fm getHeight int line height if line line visibleLines return chunkCache updateChunksUpTo line ChunkCache LineInfo lineInfo chunkCache getLineInfo line if lineInfo chunksValid System err println if lineInfo physicalLine return getLineEndOffset foldVisibilityManager getLastVisibleLine else int offset chunkCache xToOffset lineInfo chunks horizontalOffset round if offset offset lineInfo offset lineInfo length offset lineInfo offset lineInfo length return getLineStartOffset lineInfo physicalLine offset public Point offsetToXY int offset int line buffer getLineOfOffset offset offset buffer getLineStartOffset line Point retVal new Point return offsetToXY line offset retVal public Point offsetToXY int line int offset Point retVal int screenLine chunkCache getScreenLineOfOffset line offset if screenLine if line physFirstLine return null else if line physLastLine return null else throw new InternalError line offset screenLine physFirstLine physLastLine FontMetrics fm painter getFontMetrics retVal screenLine fm getHeight ChunkCache LineInfo info chunkCache getLineInfo screenLine if info chunksValid System err println retVal int horizontalOffset chunkCache offsetToX info chunks offset return retVal public void invalidateScreenLineRange int start int end if chunkCache needFullRepaint recalculateLastPhysicalLine gutter repaint painter repaint return if start end int tmp end end start start tmp FontMetrics fm painter getFontMetrics int start fm getHeight int height end start fm getHeight painter repaint painter getWidth height gutter repaint gutter getWidth height public void invalidateLine int line if line physFirstLine line physLastLine foldVisibilityManager isLineVisible line return int startLine int endLine for int visibleLines chunkCache updateChunksUpTo ChunkCache LineInfo info chunkCache getLineInfo if info physicalLine line info physicalLine startLine startLine if info physicalLine line info lastSubregion info physicalLine endLine break if chunkCache needFullRepaint recalculateLastPhysicalLine endLine visibleLines else if endLine endLine visibleLines invalidateScreenLineRange startLine endLine public void invalidateLineRange int start int end if end start int tmp end end start start tmp if end physFirstLine start physLastLine return int startScreenLine int endScreenLine for int visibleLines chunkCache updateChunksUpTo ChunkCache LineInfo info chunkCache getLineInfo if info physicalLine start info physicalLine startScreenLine startScreenLine if info physicalLine end info lastSubregion info physicalLine endScreenLine break if startScreenLine startScreenLine if chunkCache needFullRepaint recalculateLastPhysicalLine endScreenLine visibleLines else if endScreenLine endScreenLine visibleLines invalidateScreenLineRange startScreenLine endScreenLine public void invalidateSelectedLines invalidateLine caretLine for int selection size Selection Selection selection elementAt invalidateLineRange startLine endLine public int physicalToVirtual int line return foldVisibilityManager physicalToVirtual line public int virtualToPhysical int line return foldVisibilityManager virtualToPhysical line public final int getBufferLength return buffer getLength public final int getLineCount return buffer getLineCount public final int getVirtualLineCount return foldVisibilityManager getVirtualLineCount public final int getLineOfOffset int offset return buffer getLineOfOffset offset public int getLineStartOffset int line return buffer getLineStartOffset line public int getLineEndOffset int line return buffer getLineEndOffset line public int getLineLength int line return buffer getLineLength line public final String getText int start int len return buffer getText start len public final void getText int start int len Segment segment buffer getText start len segment public final String getLineText int lineIndex return buffer getLineText lineIndex public final void getLineText int lineIndex Segment segment buffer getLineText lineIndex segment public String getText return buffer getText buffer getLength public void setText String text try buffer beginCompoundEdit buffer remove buffer getLength buffer insert text finally buffer endCompoundEdit public final void selectAll setSelection new Selection Range buffer getLength moveCaretPosition buffer getLength true public void selectLine int caretLine getCaretLine int start getLineStartOffset caretLine int end getLineEndOffset caretLine Selection new Selection Range start end if multi addToSelection else setSelection moveCaretPosition end public void selectParagraph int caretLine getCaretLine if getLineLength caretLine view getToolkit beep return int start caretLine int end caretLine while start if getLineLength start break else start while end getLineCount if getLineLength end break else end int selectionStart getLineStartOffset start int selectionEnd getLineEndOffset end Selection new Selection Range selectionStart selectionEnd if multi addToSelection else setSelection moveCaretPosition selectionEnd public void selectWord int line getCaretLine int lineStart getLineStartOffset line int offset getCaretPosition lineStart if getLineLength line return String lineText getLineText line String noWordSep buffer getStringProperty if offset getLineLength line offset int wordStart TextUtilities findWordStart lineText offset noWordSep int wordEnd TextUtilities findWordEnd lineText offset noWordSep Selection new Selection Range lineStart wordStart lineStart wordEnd if multi addToSelection else setSelection moveCaretPosition lineStart wordEnd public void selectToMatchingBracket int offset caret buffer getLineStartOffset caretLine if buffer getLineLength caretLine return if offset buffer getLineLength caretLine offset int bracket TextUtilities findMatchingBracket buffer caretLine offset if bracket Selection if bracket caret new Selection Range bracket caret else moveCaretPosition caret false new Selection Range caret bracket addToSelection return public void selectBlock String openBrackets String closeBrackets Selection getSelectionAtOffset caret int start end if null start end caret else start start end end String text getText buffer getLength int count char openBracket char closeBracket if start view getToolkit beep return backward_scan while start char text charAt start int index openBrackets indexOf if index if count openBracket closeBracket closeBrackets charAt index break backward_scan else if closeBrackets indexOf count count if openBracket getToolkit beep return else forward_scan do char text charAt end if closeBracket if count end break forward_scan else if openBracket count while end buffer getLength new Selection Range start end if multi addToSelection else setSelection moveCaretPosition end public final void invertSelection Selection newSelection new Selection selection size int lastOffset for int selection size Selection Selection selection elementAt newSelection new Selection Range lastOffset getStart lastOffset getEnd newSelection selection size new Selection Range lastOffset buffer getLength setSelection newSelection public int getSelectionCount return selection size public Selection getSelection Selection sel new Selection selection size selection copyInto sel return sel public void selectNone setSelection Selection null public void setSelection Selection selection invalidateSelectedLines this selection removeAllElements if selection null for int selection length selection fireCaretEvent public void setSelection Selection selection invalidateSelectedLines this selection removeAllElements if selection null selection fireCaretEvent public void addToSelection Selection selection if selection null for int selection length selection invalidateLine caretLine fireCaretEvent public void addToSelection Selection selection selection invalidateLine caretLine fireCaretEvent public Selection getSelectionAtOffset int offset if selection null for int selection size Selection Selection selection elementAt if offset start offset end return return null public void removeFromSelection Selection sel selection removeElement sel invalidateLineRange sel startLine sel endLine invalidateLine caretLine fireCaretEvent public void removeFromSelection int offset Selection sel getSelectionAtOffset offset if sel null return selection removeElement sel invalidateLineRange sel startLine sel endLine invalidateLine caretLine fireCaretEvent public void resizeSelection int offset int end boolean rect Selection getSelectionAtOffset offset if null invalidateLineRange startLine endLine selection removeElement if end offset int tmp offset offset end end tmp Selection newSel if rect newSel new Selection Rect offset end else newSel new Selection Range offset end newSel fireCaretEvent public void extendSelection int offset int end Selection getSelectionAtOffset offset if null invalidateLineRange startLine endLine selection removeElement if offset start offset end end end else if offset end offset start if end offset int tmp end end offset offset tmp new Selection Range offset end fireCaretEvent public String getSelectedText Selection StringBuffer buf new StringBuffer getSelectedText buf return buf toString public String getSelectedText String separator if selection size return null StringBuffer buf new StringBuffer for int selection size if buf append separator getSelectedText Selection selection elementAt buf return buf toString public String getSelectedText return getSelectedText public void setSelectedText Selection String selectedText if isEditable throw new InternalError try buffer beginCompoundEdit if instanceof Selection Rect int start start getLineStartOffset startLine int end end getLineStartOffset endLine if end start int tmp end end start start tmp int lastNewline int currNewline for int startLine endLine int lineStart getLineStartOffset int lineEnd getLineEndOffset int rectStart Math min lineEnd lineStart start buffer remove rectStart Math min lineEnd rectStart end start if selectedText null continue currNewline selectedText indexOf lastNewline if currNewline currNewline selectedText length buffer insert rectStart selectedText substring lastNewline currNewline lastNewline Math min selectedText length currNewline if selectedText null currNewline selectedText length int offset getLineEndOffset endLine buffer insert offset buffer insert offset selectedText substring currNewline else buffer remove start end start if selectedText null selectedText length buffer insert start selectedText finally buffer endCompoundEdit public void setSelectedText String selectedText if isEditable throw new InternalError Selection selection getSelection if selection length buffer insert caret selectedText else try buffer beginCompoundEdit for int selection length setSelectedText selection selectedText finally buffer endCompoundEdit selectNone public int getSelectedLines if selection size return new int caretLine Integer line Hashtable hash new Hashtable for int selection size Selection Selection selection elementAt int endLine end getLineStartOffset endLine endLine endLine for int startLine endLine line new Integer hash put line line int returnValue new int hash size int Enumeration keys hash keys while keys hasMoreElements line Integer keys nextElement returnValue line intValue Arrays sort returnValue return returnValue public void showSelectLineRangeDialog new SelectLineRange view public final void blinkCaret if caretBlinks blink blink invalidateLine caretLine else blink true public void centerCaret int offset getScreenLineStartOffset visibleLines if offset getToolkit beep else setCaretPosition offset public void setCaretPosition int newCaret invalidateSelectedLines selection removeAllElements moveCaretPosition newCaret true public void setCaretPosition int newCaret boolean doElectricScroll invalidateSelectedLines selection removeAllElements moveCaretPosition newCaret doElectricScroll public void moveCaretPosition int newCaret moveCaretPosition newCaret true public void moveCaretPosition int newCaret boolean doElectricScroll if newCaret newCaret buffer getLength throw new IllegalArgumentException newCaret blink true caretTimer restart if caret newCaret if focusedComponent this finishCaretUpdate doElectricScroll false return int newCaretLine getLineOfOffset newCaret magicCaret if foldVisibilityManager isLineVisible newCaretLine if foldVisibilityManager isNarrowed int collapseFolds buffer getIntegerProperty if collapseFolds foldVisibilityManager expandFolds collapseFolds else foldVisibilityManager expandAllFolds else foldVisibilityManager expandFold newCaretLine false if caretLine newCaretLine if caretScreenLine invalidateScreenLineRange caretScreenLine caretScreenLine else caretScreenLine chunkCache getScreenLineOfOffset newCaretLine newCaret buffer getLineStartOffset newCaretLine invalidateLineRange caretLine newCaretLine caret newCaret caretLine newCaretLine if focusedComponent this finishCaretUpdate doElectricScroll true public int getCaretPosition return caret public int getCaretLine return caretLine public final int getMagicCaretPosition if magicCaret magicCaret offsetToX caretLine caret getLineStartOffset caretLine return magicCaret public final void setMagicCaretPosition int magicCaret this magicCaret magicCaret public final void addCaretListener CaretListener listener listenerList add CaretListener class listener public final void removeCaretListener CaretListener listener listenerList remove CaretListener class listener public final int getBracketPosition return bracketPosition public final int getBracketLine return bracketLine public void goToNextBracket boolean select String text getText caret buffer getLength caret int newCaret loop for int text length switch text charAt case case case newCaret caret break loop if newCaret getToolkit beep else if select extendSelection caret newCaret else if multi selectNone moveCaretPosition newCaret public void goToNextCharacter boolean select if select selection size Selection getSelectionAtOffset caret if null if multi if caret end moveCaretPosition end return else setCaretPosition end return if caret buffer getLength getToolkit beep int newCaret if caret getLineEndOffset caretLine int line foldVisibilityManager getNextVisibleLine caretLine if line getToolkit beep return newCaret getLineStartOffset line else newCaret caret if select extendSelection caret newCaret else if multi selectNone moveCaretPosition newCaret public void goToNextLine boolean select ChunkCache LineInfo lineInfos chunkCache getLineInfosForPhysicalLine caretLine int caretFromStartOfLine caret buffer getLineStartOffset caretLine int subregion getSubregionOfOffset caretFromStartOfLine lineInfos int magic this magicCaret if magic magic subregionOffsetToX lineInfos subregion caretFromStartOfLine int newCaret if subregion lineInfos length newCaret buffer getLineStartOffset caretLine xToSubregionOffset lineInfos subregion magic true else int nextLine foldVisibilityManager getNextVisibleLine caretLine if nextLine int end getLineEndOffset caretLine if caret end getToolkit beep return else newCaret end else lineInfos chunkCache getLineInfosForPhysicalLine nextLine newCaret getLineStartOffset nextLine xToSubregionOffset lineInfos magic true if select extendSelection caret newCaret else if multi selectNone moveCaretPosition newCaret this magicCaret magic public void goToNextMarker boolean select Vector markers buffer getMarkers if markers size getToolkit beep return Marker marker null for int markers size Marker Marker markers get if getPosition caret marker break if marker null marker Marker markers get if select extendSelection caret marker getPosition else if multi selectNone moveCaretPosition marker getPosition public void goToNextPage boolean select int lineCount getVirtualLineCount int magic getMagicCaretPosition if firstLine visibleLines lineCount setFirstLine lineCount visibleLines else setFirstLine firstLine visibleLines int newLine virtualToPhysical Math min lineCount physicalToVirtual caretLine visibleLines int newCaret getLineStartOffset newLine xToOffset newLine magic if select extendSelection caret newCaret else if multi selectNone moveCaretPosition newCaret setMagicCaretPosition magic public void goToNextParagraph boolean select int lineNo getCaretLine int newCaret getBufferLength boolean foundBlank false loop for int lineNo getLineCount if foldVisibilityManager isLineVisible continue getLineText lineSegment for int lineSegment count switch lineSegment array lineSegment offset case case break default if foundBlank newCaret getLineStartOffset break loop else continue loop foundBlank true if select extendSelection caret newCaret else if multi selectNone moveCaretPosition newCaret public void goToNextWord boolean select int lineStart getLineStartOffset caretLine int newCaret caret lineStart String lineText getLineText caretLine if newCaret lineText length int nextLine foldVisibilityManager getNextVisibleLine caretLine if nextLine getToolkit beep return newCaret getLineStartOffset nextLine else String noWordSep buffer getStringProperty newCaret TextUtilities findWordEnd lineText newCaret noWordSep lineStart if select extendSelection caret newCaret else if multi selectNone moveCaretPosition newCaret public void goToPrevBracket boolean select String text getText caret int newCaret loop for int getCaretPosition switch text charAt case case case newCaret break loop if newCaret getToolkit beep else if select extendSelection caret newCaret else if multi selectNone moveCaretPosition newCaret public void goToPrevCharacter boolean select if select selection size Selection getSelectionAtOffset caret if null if multi if caret start moveCaretPosition start return else setCaretPosition start return int newCaret if caret getLineStartOffset caretLine int line foldVisibilityManager getPrevVisibleLine caretLine if line getToolkit beep return newCaret getLineEndOffset line else newCaret caret if select extendSelection caret newCaret else if multi selectNone moveCaretPosition newCaret public void goToPrevLine boolean select ChunkCache LineInfo lineInfos chunkCache getLineInfosForPhysicalLine caretLine int caretFromStartOfLine caret buffer getLineStartOffset caretLine int subregion getSubregionOfOffset caretFromStartOfLine lineInfos int magic this magicCaret if magic magic subregionOffsetToX lineInfos subregion caretFromStartOfLine int newCaret if subregion newCaret buffer getLineStartOffset caretLine xToSubregionOffset lineInfos subregion magic true else int prevLine foldVisibilityManager getPrevVisibleLine caretLine if prevLine int start getLineStartOffset caretLine if caret start getToolkit beep return else newCaret start else lineInfos chunkCache getLineInfosForPhysicalLine prevLine newCaret getLineStartOffset prevLine xToSubregionOffset lineInfos lineInfos length magic true if select extendSelection caret newCaret else if multi selectNone moveCaretPosition newCaret this magicCaret magic public void goToPrevMarker boolean select Vector markers buffer getMarkers if markers size getToolkit beep return Marker marker null for int markers size Marker Marker markers elementAt if getPosition caret marker break if marker null marker Marker markers get markers size if select extendSelection caret marker getPosition else if multi selectNone moveCaretPosition marker getPosition public void goToPrevPage boolean select if firstLine visibleLines setFirstLine else setFirstLine firstLine visibleLines int magic getMagicCaretPosition int newLine virtualToPhysical Math max physicalToVirtual caretLine visibleLines int newCaret getLineStartOffset newLine xToOffset newLine magic if select extendSelection caret newCaret else if multi selectNone moveCaretPosition newCaret setMagicCaretPosition magic public void goToPrevParagraph boolean select int lineNo caretLine int newCaret boolean foundBlank false loop for int lineNo if foldVisibilityManager isLineVisible continue getLineText lineSegment for int lineSegment count switch lineSegment array lineSegment offset case case break default if foundBlank newCaret getLineEndOffset break loop else continue loop foundBlank true if select extendSelection caret newCaret else if multi selectNone moveCaretPosition newCaret public void goToPrevWord boolean select int lineStart getLineStartOffset caretLine int newCaret caret lineStart String lineText getLineText caretLine if newCaret if lineStart view getToolkit beep return else int prevLine foldVisibilityManager getPrevVisibleLine caretLine if prevLine getToolkit beep return newCaret getLineEndOffset prevLine else String noWordSep buffer getStringProperty newCaret TextUtilities findWordStart lineText newCaret noWordSep lineStart if select extendSelection caret newCaret else if multi selectNone moveCaretPosition newCaret public void smartHome boolean select if jEdit getBooleanProperty goToStartOfLine select else switch view getInputHandler getLastActionCount case goToStartOfWhiteSpace select break case goToStartOfLine select break goToFirstVisibleLine select break public void smartEnd boolean select if jEdit getBooleanProperty goToEndOfLine select else switch view getInputHandler getLastActionCount case goToEndOfWhiteSpace select break case goToEndOfLine select break goToLastVisibleLine select break public void goToStartOfLine boolean select Macros Recorder recorder view getMacroRecorder if recorder null recorder record select Selection getSelectionAtOffset caret int line select null caretLine startLine int newCaret getLineStartOffset line if select extendSelection caret newCaret else if multi selectNone moveCaretPosition newCaret public void goToEndOfLine boolean select Macros Recorder recorder view getMacroRecorder if recorder null recorder record select Selection getSelectionAtOffset caret int line select null caretLine endLine int newCaret getLineEndOffset line if select extendSelection caret newCaret else if multi selectNone moveCaretPosition newCaret setMagicCaretPosition Integer MAX_VALUE public void goToStartOfWhiteSpace boolean select Macros Recorder recorder view getMacroRecorder if recorder null recorder record select Selection getSelectionAtOffset caret int line offset if select null line caretLine offset caret buffer getLineStartOffset line else line startLine offset start buffer getLineStartOffset line int firstIndent ChunkCache LineInfo lineInfos chunkCache getLineInfosForPhysicalLine line int subregion getSubregionOfOffset offset lineInfos if subregion firstIndent MiscUtilities getLeadingWhiteSpace getLineText line if firstIndent getLineLength line firstIndent firstIndent getLineStartOffset line else firstIndent getLineStartOffset line lineInfos subregion offset if select extendSelection caret firstIndent else if multi selectNone moveCaretPosition firstIndent public void goToEndOfWhiteSpace boolean select Macros Recorder recorder view getMacroRecorder if recorder null recorder record select Selection getSelectionAtOffset caret int line offset if select null line caretLine offset caret getLineStartOffset line else line endLine offset end getLineStartOffset line int lastIndent ChunkCache LineInfo lineInfos chunkCache getLineInfosForPhysicalLine line int subregion getSubregionOfOffset offset lineInfos if subregion lineInfos length lastIndent getLineLength line MiscUtilities getTrailingWhiteSpace getLineText line if lastIndent lastIndent getLineLength line lastIndent getLineStartOffset line else lastIndent getLineStartOffset line lineInfos subregion offset lineInfos subregion length if select extendSelection caret lastIndent else if multi selectNone moveCaretPosition lastIndent public void goToFirstVisibleLine boolean select Macros Recorder recorder view getMacroRecorder if recorder null recorder record select int firstVisibleLine firstLine electricScroll int firstVisible getScreenLineStartOffset firstVisibleLine if firstVisible firstVisible getLineStartOffset foldVisibilityManager getFirstVisibleLine if select extendSelection caret firstVisible else if multi selectNone moveCaretPosition firstVisible public void goToLastVisibleLine boolean select Macros Recorder recorder view getMacroRecorder if recorder null recorder record select int lastVisible if firstLine visibleLines getVirtualLineCount lastVisible getLineEndOffset foldVisibilityManager getLastVisibleLine else lastVisible getScreenLineEndOffset visibleLines electricScroll if lastVisible lastVisible getLineEndOffset foldVisibilityManager getLastVisibleLine if select extendSelection caret lastVisible else if multi selectNone moveCaretPosition lastVisible public void goToBufferStart boolean select int start buffer getLineStartOffset foldVisibilityManager getFirstVisibleLine if select extendSelection caret start else if multi selectNone moveCaretPosition start public void goToBufferEnd boolean select int end buffer getLineEndOffset foldVisibilityManager getLastVisibleLine if select extendSelection caret end else if multi selectNone moveCaretPosition end public void goToMatchingBracket if getLineLength caretLine int dot caret getLineStartOffset caretLine int bracket TextUtilities findMatchingBracket buffer caretLine Math max dot if bracket selectNone moveCaretPosition bracket false return getToolkit beep public void showGoToLineDialog String line GUIUtilities input view null if line null return try int lineNumber Integer parseInt line setCaretPosition getLineStartOffset lineNumber catch Exception getToolkit beep public void userInput char ch if isEditable getToolkit beep return if ch Abbrevs getExpandOnInput Abbrevs expandAbbrev view false return else if ch if selection size Selection sel Selection selection elementAt if sel startLine sel endLine sel start buffer getLineStartOffset sel startLine sel end buffer getLineEndOffset sel startLine insertTab else shiftIndentRight else if selection size shiftIndentRight else if buffer getBooleanProperty String text buffer getLineText caretLine int start buffer getLineStartOffset caretLine int whiteSpace MiscUtilities getLeadingWhiteSpace text if caret start whiteSpace buffer indentLine caretLine true false return else insertTab else insertTab return else if ch try buffer beginCompoundEdit setSelectedText if buffer getBooleanProperty buffer indentLine caretLine true false finally buffer endCompoundEdit return else String str String valueOf ch if selection size setSelectedText str return if ch if doWordWrap true return else doWordWrap false try if overwrite buffer beginCompoundEdit int caretLineEnd getLineEndOffset caretLine if caretLineEnd caret buffer remove caret buffer insert caret str finally if overwrite buffer endCompoundEdit String indentOpenBrackets String buffer getProperty String indentCloseBrackets String buffer getProperty if indentCloseBrackets null indentCloseBrackets indexOf ch indentOpenBrackets null indentOpenBrackets indexOf ch buffer indentLine caretLine false true public final boolean isOverwriteEnabled return overwrite public final void setOverwriteEnabled boolean overwrite blink true caretTimer restart this overwrite overwrite invalidateLine caretLine if view getStatus null view getStatus updateMiscStatus public final void toggleOverwriteEnabled setOverwriteEnabled overwrite public void backspace if buffer isEditable getToolkit beep return if selection size setSelectedText null else if caret getToolkit beep return buffer remove caret public void backspaceWord if buffer isEditable getToolkit beep return if selection size setSelectedText return int lineStart getLineStartOffset caretLine int caret lineStart String lineText getLineText caretLine if if lineStart getToolkit beep return else String noWordSep buffer getStringProperty TextUtilities findWordStart lineText noWordSep buffer remove lineStart caret lineStart public void delete if buffer isEditable getToolkit beep return if selection size setSelectedText null else if caret buffer getLength getToolkit beep return buffer remove caret public void deleteToEndOfLine if buffer isEditable getToolkit beep return buffer remove caret getLineEndOffset caretLine caret public void deleteLine if buffer isEditable getToolkit beep return int start getLineStartOffset caretLine int end getLineEndOffset caretLine if end buffer getLength if start start end int offsetToX caretLine caret start buffer remove start end start int lastLine buffer getLineCount if caretLine lastLine setCaretPosition buffer getLineStartOffset lastLine xToOffset caretLine else setCaretPosition start xToOffset caretLine public void deleteParagraph if buffer isEditable getToolkit beep return int start end buffer getLength loop for int caretLine getLineText lineSegment for int lineSegment count switch lineSegment array lineSegment offset case case break default continue loop start getLineStartOffset break loop loop for int caretLine getLineCount getLineText lineSegment for int lineSegment count switch lineSegment array lineSegment offset case case break default continue loop end getLineEndOffset break loop buffer remove start end start public void deleteToStartOfLine if buffer isEditable getToolkit beep return buffer remove getLineStartOffset caretLine caret getLineStartOffset caretLine public void deleteWord if buffer isEditable getToolkit beep return if selection size setSelectedText return int lineStart getLineStartOffset caretLine int caret lineStart String lineText getLineText caretLine if lineText length if lineStart buffer getLength getToolkit beep return else String noWordSep buffer getStringProperty TextUtilities findWordEnd lineText noWordSep buffer remove caret lineStart caret public final boolean isMultipleSelectionEnabled return multi public final void toggleMultipleSelectionEnabled multi multi if view getStatus null view getStatus updateMiscStatus public final void setMultipleSelectionEnabled boolean multi JEditTextArea multi multi EditBus send new MultiSelectStatusChanged null public void goToMarker char shortcut boolean select Marker marker buffer getMarker shortcut if marker null getToolkit beep return int pos marker getPosition if select extendSelection caret pos else if multi selectNone moveCaretPosition pos public void addMarker Selection selection getSelection for int selection length Selection selection if startLine endLine if startLine caretLine buffer addMarker start if endLine caretLine buffer addMarker end buffer addOrRemoveMarker caret public void swapMarkerAndCaret char shortcut Marker marker buffer getMarker shortcut if marker null getToolkit beep return int caret getCaretPosition setCaretPosition marker getPosition buffer addMarker shortcut caret public void goToParentFold int line int level buffer getFoldLevel caretLine for int caretLine if buffer getFoldLevel level line break if line getToolkit beep return int magic getMagicCaretPosition int newCaret buffer getLineStartOffset line xToOffset line magic if multi selectNone moveCaretPosition newCaret setMagicCaretPosition magic public void goToNextFold boolean select int line caretLine int nextFold for int caretLine buffer getLineCount if buffer isFoldStart foldVisibilityManager isLineVisible nextFold break if nextFold getToolkit beep return int magic getMagicCaretPosition int newCaret buffer getLineStartOffset nextFold xToOffset nextFold magic if select extendSelection caret newCaret else if multi selectNone moveCaretPosition newCaret setMagicCaretPosition magic public void goToPrevFold boolean select int line caretLine int prevFold for int caretLine if buffer isFoldStart foldVisibilityManager isLineVisible prevFold break if prevFold getToolkit beep return int magic getMagicCaretPosition int newCaret buffer getLineStartOffset prevFold xToOffset prevFold magic if select extendSelection caret newCaret else if multi selectNone moveCaretPosition newCaret setMagicCaretPosition magic public void collapseFold int offsetToX caretLine caret getLineStartOffset caretLine foldVisibilityManager collapseFold caretLine if foldVisibilityManager isLineVisible caretLine return int line foldVisibilityManager getPrevVisibleLine caretLine if multi selectNone moveCaretPosition buffer getLineStartOffset line xToOffset line public void expandFold boolean fully int offsetToX caretLine caret getLineStartOffset caretLine int line foldVisibilityManager expandFold caretLine fully if line if multi selectNone moveCaretPosition getLineStartOffset line xToOffset line public void selectFold selectFold caretLine public void selectFold int line int lines buffer getFoldAtLine line int newCaret getLineEndOffset lines Selection new Selection Range getLineStartOffset lines newCaret if multi addToSelection else setSelection moveCaretPosition newCaret public void narrowToFold int lines buffer getFoldAtLine caretLine if lines lines buffer getLineCount getToolkit beep else foldVisibilityManager narrow lines lines public void narrowToSelection if selection size getToolkit beep return Selection sel Selection selection elementAt foldVisibilityManager narrow sel getStartLine sel getEndLine selectNone public void addExplicitFold if buffer getStringProperty equals GUIUtilities error view null return String lineComment buffer getContextSensitiveProperty caret String commentStart buffer getContextSensitiveProperty caret String commentEnd buffer getContextSensitiveProperty caret String start end if lineComment null start lineComment end lineComment else if commentStart null commentEnd null start commentStart commentEnd end commentStart commentEnd else start end try buffer beginCompoundEdit if selection size String line buffer getLineText caretLine String whitespace line substring MiscUtilities getLeadingWhiteSpace line int loc caret start length start start whitespace buffer insert caret start buffer insert caret end moveCaretPosition loc false else int loc for int selection size Selection Selection selection elementAt String line buffer getLineText startLine String whitespace line substring MiscUtilities getLeadingWhiteSpace line loc start start length buffer insert start start whitespace buffer insert end end setCaretPosition loc false finally buffer endCompoundEdit public void lineComment String comment buffer getContextSensitiveProperty caret if buffer isEditable comment null comment length getToolkit beep return comment comment buffer beginCompoundEdit int lines getSelectedLines try for int lines length String text getLineText lines buffer insert getLineStartOffset lines MiscUtilities getLeadingWhiteSpace text comment finally buffer endCompoundEdit selectNone public void rangeComment String commentStart buffer getContextSensitiveProperty caret String commentEnd buffer getContextSensitiveProperty caret if buffer isEditable commentStart null commentEnd null commentStart length commentEnd length getToolkit beep return commentStart commentStart commentEnd commentEnd try buffer beginCompoundEdit Selection selection getSelection if selection length int oldCaret caret buffer insert caret commentStart buffer insert caret commentEnd setCaretPosition oldCaret commentStart length for int selection length Selection selection if instanceof Selection Range buffer insert start commentStart buffer insert end commentEnd else if instanceof Selection Rect for int startLine endLine buffer insert getStart buffer commentStart int end getEnd buffer endLine commentStart length buffer insert end commentEnd selectNone finally buffer endCompoundEdit public void formatParagraph if buffer isEditable getToolkit beep return if maxLineLen getToolkit beep return Selection selection getSelection if selection length buffer beginCompoundEdit for int selection length Selection selection setSelectedText TextUtilities format getSelectedText maxLineLen buffer endCompoundEdit else int lineNo getCaretLine int start end buffer getLength loop for int lineNo getLineText lineSegment for int lineSegment count switch lineSegment array lineSegment offset case case break default continue loop start getLineStartOffset break loop loop for int lineNo getLineCount getLineText lineSegment for int lineSegment count switch lineSegment array lineSegment offset case case break default continue loop end getLineEndOffset break loop try buffer beginCompoundEdit String text buffer getText start end start buffer remove start end start buffer insert start TextUtilities format text maxLineLen finally buffer endCompoundEdit public void spacesToTabs Selection selection getSelection if buffer isEditable getToolkit beep return buffer beginCompoundEdit if selection length setText TextUtilities spacesToTabs getText buffer getTabSize else for int selection length Selection selection setSelectedText TextUtilities spacesToTabs getSelectedText buffer getTabSize buffer endCompoundEdit public void tabsToSpaces Selection selection getSelection if buffer isEditable getToolkit beep return buffer beginCompoundEdit if selection length setText TextUtilities tabsToSpaces getText buffer getTabSize else for int selection length Selection selection setSelectedText TextUtilities tabsToSpaces getSelectedText buffer getTabSize buffer endCompoundEdit public void toUpperCase Selection selection getSelection if buffer isEditable selection length getToolkit beep return buffer beginCompoundEdit for int selection length Selection selection setSelectedText getSelectedText toUpperCase buffer endCompoundEdit public void toLowerCase Selection selection getSelection if buffer isEditable selection length getToolkit beep return buffer beginCompoundEdit for int selection length Selection selection setSelectedText getSelectedText toLowerCase buffer endCompoundEdit public void removeTrailingWhiteSpace if buffer isEditable getToolkit beep else buffer removeTrailingWhiteSpace getSelectedLines public void indentSelectedLines if buffer isEditable getToolkit beep else buffer indentLines getSelectedLines selectNone public void shiftIndentLeft if buffer isEditable getToolkit beep else buffer shiftIndentLeft getSelectedLines public void shiftIndentRight if buffer isEditable getToolkit beep else buffer shiftIndentRight getSelectedLines public void joinLines int start getLineStartOffset caretLine int end getLineEndOffset caretLine if end buffer getLength getToolkit beep return buffer remove end MiscUtilities getLeadingWhiteSpace buffer getLineText caretLine setCaretPosition end public void showWordCountDialog String selection getSelectedText if selection null doWordCount view selection return doWordCount view buffer getText buffer getLength public void addNotify super addNotify ToolTipManager sharedInstance registerComponent painter ToolTipManager sharedInstance registerComponent gutter if bufferHandlerInstalled bufferHandlerInstalled true buffer addBufferChangeListener bufferHandler recalculateVisibleLines recalculateLastPhysicalLine public void removeNotify super removeNotify ToolTipManager sharedInstance unregisterComponent painter ToolTipManager sharedInstance unregisterComponent gutter if focusedComponent this focusedComponent null if bufferHandlerInstalled buffer removeBufferChangeListener bufferHandler bufferHandlerInstalled false public boolean hasFocus Component this while instanceof Window if null return false getParent Component focusOwner Window getFocusOwner boolean hasFocus focusOwner this if hasFocus focusedComponent this focusedComponent this return hasFocus public void grabFocus super grabFocus hasFocus public boolean getFocusTraversalKeysEnabled return false public void processKeyEvent KeyEvent evt evt KeyEventWorkaround processKeyEvent evt if evt null return if view isClosed return InputHandler inputHandler view getInputHandler KeyListener keyEventInterceptor view getKeyEventInterceptor switch evt getID case KeyEvent KEY_TYPED if keyEventInterceptor null keyEventInterceptor keyTyped evt else inputHandler keyTyped evt break case KeyEvent KEY_PRESSED if keyEventInterceptor null keyEventInterceptor keyPressed evt else inputHandler keyPressed evt break case KeyEvent KEY_RELEASED if keyEventInterceptor null keyEventInterceptor keyReleased evt else inputHandler keyReleased evt break if evt isConsumed super processKeyEvent evt public void propertiesChanged if buffer null return int buffer getTabSize char foo new char for int foo length foo tabSize float painter getFont getStringBounds foo painter getFontRenderContext getWidth charWidth int Math round painter getFont getStringBounds foo painter getFontRenderContext getWidth String wrap buffer getStringProperty softWrap wrap equals hardWrap wrap equals maxLineLen buffer getIntegerProperty if maxLineLen if softWrap wrapToWidth true wrapMargin painter getWidth charWidth else wrapToWidth false wrapMargin else foo new char maxLineLen for int foo length foo wrapToWidth false wrapMargin int painter getFont getStringBounds foo maxLineLen painter getFontRenderContext getWidth maxHorizontalScrollWidth updateScrollBars chunkCache invalidateAll gutter repaint painter repaint public boolean setOrigin int firstLine int horizontalOffset setFirstLine firstLine setHorizontalOffset horizontalOffset return true public int lineToY int line FontMetrics fm painter getFontMetrics return line firstLine fm getHeight fm getLeading fm getDescent public int yToLine int FontMetrics fm painter getFontMetrics int height fm getHeight return Math max Math min getVirtualLineCount height firstLine public int offsetToX int line int offset ChunkCache Chunk chunks chunkCache getLineInfoBackwardsCompatibility line chunks return int horizontalOffset chunkCache offsetToX chunks offset public int xToOffset int line int horizontalOffset ChunkCache Chunk chunks chunkCache getLineInfoBackwardsCompatibility line chunks int offset chunkCache xToOffset chunks true if offset offset getLineLength line return offset public int xToOffset int line int boolean round horizontalOffset ChunkCache Chunk chunks chunkCache getLineInfoBackwardsCompatibility line chunks int offset chunkCache xToOffset chunks round if offset offset getLineLength line return offset public final int getSelectionStart if selection size return caret return Selection selection elementAt getStart public int getSelectionStart int line if selection size return caret return Selection selection elementAt getStart buffer line public final int getSelectionStartLine if selection size return caret return Selection selection elementAt getStartLine public final void setSelectionStart int selectionStart select selectionStart getSelectionEnd true public final int getSelectionEnd if selection size return caret return Selection selection elementAt getEnd public int getSelectionEnd int line if selection size return caret return Selection selection elementAt getEnd buffer line public final int getSelectionEndLine if selection size return caret return Selection selection elementAt getEndLine public final void setSelectionEnd int selectionEnd select getSelectionStart selectionEnd true public final int getMarkPosition Selection getSelectionAtOffset caret if null return caret if start caret return end else if end caret return start else return caret public final int getMarkLine if selection size return caretLine Selection Selection selection elementAt if start caret return endLine else if end caret return startLine else return caretLine public void select int start int end select start end true public void select int start int end boolean doElectricScroll selectNone int newStart newEnd if start end newStart start newEnd end else newStart end newEnd start setSelection new Selection Range newStart newEnd moveCaretPosition end doElectricScroll public boolean isSelectionRectangular Selection getSelectionAtOffset caret if null return false else return instanceof Selection Rect Segment lineSegment MouseHandler mouseHandler ChunkCache chunkCache int maxHorizontalScrollWidth boolean softWrap boolean hardWrap float tabSize int wrapMargin boolean wrapToWidth int charWidth boolean scrollBarsInitialized Vector selection Point returnValue final boolean isCaretVisible return blink hasFocus final boolean isBracketHighlightVisible return bracketLine hasFocus foldVisibilityManager isLineVisible bracketLine foldVisibilityManager isLineVisible caretLine void updateMaxHorizontalScrollWidth int max chunkCache getMaxHorizontalScrollWidth if max maxHorizontalScrollWidth maxHorizontalScrollWidth max horizontal setValues Math max Math min maxHorizontalScrollWidth charWidth painter getWidth horizontalOffset painter getWidth maxHorizontalScrollWidth charWidth void recalculateVisibleLines if painter null return int height painter getHeight int lineHeight painter getFontMetrics getHeight visibleLines height lineHeight chunkCache recalculateVisibleLines propertiesChanged void foldStructureChanged chunkCache invalidateAll while foldVisibilityManager isLineVisible physFirstLine physFirstLine physFirstLine setFirstLine physicalToVirtual physFirstLine updateScrollBars recalculateLastPhysicalLine gutter repaint painter repaint for int lineInfos length ChunkCache LineInfo info lineInfos if offset info offset offset info offset info length return return boolean round int offset chunkCache xToOffset info chunks horizontalOffset round if offset offset info offset info length offset info offset info length return offset return int horizontalOffset chunkCache offsetToX info chunks offset private static String CENTER private static String RIGHT private static String LEFT private static String BOTTOM private static Timer caretTimer private static JEditTextArea focusedComponent private View view private Gutter gutter private TextAreaPainter painter private JPopupMenu popup private EventListenerList listenerList private MutableCaretEvent caretEvent private boolean caretBlinks private boolean blink private int firstLine private int physFirstLine private int physLastLine private int screenLastLine private int visibleLines private int electricScroll private int horizontalOffset private boolean quickCopy private JScrollBar vertical private JScrollBar horizontal private boolean bufferChanging private Buffer buffer private FoldVisibilityManager foldVisibilityManager private BufferChangeHandler bufferHandler private boolean bufferHandlerInstalled private int caret private int caretLine private int caretScreenLine private int bracketPosition private int bracketLine private int magicCaret private static boolean multi private boolean overwrite private int maxLineLen private boolean queuedRecalcLastPhys private boolean queuedScrollTo private boolean queuedScrollToElectric private boolean queuedFireCaretEvent private ArrayList runnables private void Selection addMe if addMe start addMe start else if addMe end buffer getLength addMe end buffer getLength if addMe start addMe end throw new IllegalArgumentException addMe start addMe end else if addMe start addMe end return for int selection size Selection Selection selection elementAt if addMe addMe start Math min start addMe start addMe end Math max end addMe end selection removeElement addMe startLine getLineOfOffset addMe start addMe endLine getLineOfOffset addMe end boolean added false for int selection size Selection Selection selection elementAt if addMe start start selection insertElementAt addMe added true break if added selection addElement addMe invalidateLineRange addMe startLine addMe endLine private boolean Selection s1 Selection s2 if s1 start s2 start s1 start s2 end s1 end s2 start s1 end s2 end return true else return false private void getSelectedText Selection StringBuffer buf if instanceof Selection Rect int start start getLineStartOffset startLine int end end getLineStartOffset endLine if end start int tmp end end start start tmp for int startLine endLine int lineStart getLineStartOffset int lineEnd getLineEndOffset int lineLen lineEnd lineStart lineStart Math min lineStart start lineEnd lineLen Math min end start lineEnd lineStart getText lineStart lineLen lineSegment buf append lineSegment array lineSegment offset lineSegment count if endLine buf append else getText start end start lineSegment buf append lineSegment array lineSegment offset lineSegment count private void finishCaretUpdate boolean doElectricScroll boolean fireCaretEvent this queuedScrollToElectric doElectricScroll this queuedFireCaretEvent fireCaretEvent Runnable new Runnable public void run scrollToCaret queuedScrollToElectric updateBracketHighlight if queuedFireCaretEvent fireCaretEvent queuedScrollTo queuedScrollToElectric queuedFireCaretEvent false if buffer isTransactionInProgress if queuedScrollTo queuedScrollTo true runnables add else run private void fireCaretEvent Object listeners listenerList getListenerList for int listeners length if listeners CaretListener class CaretListener listeners caretUpdate caretEvent private void fireScrollEvent boolean vertical Object listeners listenerList getListenerList for int listeners length if listeners ScrollListener class if vertical ScrollListener listeners scrolledVertically this else ScrollListener listeners scrolledHorizontally this private void insertTab int tabSize buffer getTabSize if buffer getBooleanProperty int lineStart getLineStartOffset caretLine String line getText lineStart caret lineStart int pos for int line length switch line charAt pos case pos break default if pos tabSize pos break setSelectedText MiscUtilities createWhiteSpace tabSize pos else setSelectedText private boolean doWordWrap boolean spaceInserted if hardWrap maxLineLen return false buffer getLineText caretLine lineSegment int start getLineStartOffset caretLine int end getLineEndOffset caretLine int len end start int caretPos caret start for int caretPos len char ch lineSegment array lineSegment offset if ch ch return false boolean returnValue false int tabSize buffer getTabSize String wordBreakChars buffer getStringProperty int lastWordOffset boolean lastWasSpace true boolean initialWhiteSpace true int initialWhiteSpaceLength for int caretPos char ch lineSegment array lineSegment offset if ch if initialWhiteSpace initialWhiteSpaceLength logicalLength tabSize logicalLength tabSize if lastWasSpace logicalLength maxLineLen lastWordOffset lastWasSpace true else if ch if initialWhiteSpace initialWhiteSpaceLength logicalLength if lastWasSpace logicalLength maxLineLen lastWordOffset lastWasSpace true else if wordBreakChars null wordBreakChars indexOf ch initialWhiteSpace false logicalLength if lastWasSpace logicalLength maxLineLen lastWordOffset lastWasSpace true else initialWhiteSpace false logicalLength lastWasSpace false int insertNewLineAt if spaceInserted logicalLength maxLineLen caretPos insertNewLineAt caretPos returnValue true else if logicalLength maxLineLen lastWordOffset insertNewLineAt lastWordOffset else continue try buffer beginCompoundEdit buffer insert start insertNewLineAt buffer indentLine caretLine true true finally buffer endCompoundEdit return returnValue return false private void doWordCount View view String text char chars text toCharArray int characters chars length int words if characters words else words int lines boolean word false for int chars length switch chars case case lines case case if word words word false break default word true break Object args new Integer characters new Integer words new Integer lines GUIUtilities message view args private void updateBracketHighlight if painter isBracketHighlightEnabled return if bracketLine invalidateLineRange bracketLine caretLine int offset caret getLineStartOffset caretLine if offset int bracketOffset TextUtilities findMatchingBracket buffer caretLine offset buffer getLineCount if bracketOffset bracketLine getLineOfOffset bracketOffset bracketPosition bracketOffset getLineStartOffset bracketLine invalidateLineRange bracketLine caretLine if bracketLine physFirstLine bracketLine physLastLine showBracketStatusMessage bracketLine caretLine return bracketLine bracketPosition private void showBracketStatusMessage boolean backward String text buffer getLineText bracketLine trim if backward bracketLine text length switch text charAt case case case case case case text buffer getLineText bracketLine trim text break text text replace view getStatus setMessageAndClear jEdit getProperty new String text void recalculateLastPhysicalLine if softWrap chunkCache updateChunksUpTo visibleLines for int visibleLines ChunkCache LineInfo info chunkCache getLineInfo if info physicalLine physLastLine info physicalLine screenLastLine break else int virtLastLine Math min foldVisibilityManager getVirtualLineCount firstLine visibleLines screenLastLine virtLastLine firstLine physLastLine foldVisibilityManager virtualToPhysical virtLastLine static class TextAreaBorder extends AbstractBorder private static final Insets insets new Insets public void paintBorder Component Graphics int int int width int height translate setColor MetalLookAndFeel getControlDarkShadow drawRect width height setColor MetalLookAndFeel getControlHighlight drawLine width width height drawLine height width height setColor MetalLookAndFeel getControl drawLine width width drawLine height height translate public Insets getBorderInsets Component return new Insets class ScrollLayout implements LayoutManager public void addLayoutComponent String name Component comp if name equals CENTER center comp else if name equals RIGHT right comp else if name equals LEFT left comp else if name equals BOTTOM bottom comp public void removeLayoutComponent Component comp if center comp center null else if right comp right null else if left comp left null else if bottom comp bottom null public Dimension preferredLayoutSize Container parent Dimension dim new Dimension Border border getBorder Insets insets if border null insets new Insets else insets getBorder getBorderInsets JEditTextArea this dim width insets left insets right dim height insets top insets bottom Dimension leftPref left getPreferredSize dim width leftPref width Dimension centerPref center getPreferredSize dim width centerPref width dim height centerPref height Dimension rightPref right getPreferredSize dim width rightPref width Dimension bottomPref bottom getPreferredSize dim height bottomPref height return dim public Dimension minimumLayoutSize Container parent Dimension dim new Dimension Border border getBorder Insets insets if border null insets new Insets else insets getBorder getBorderInsets JEditTextArea this dim width insets left insets right dim height insets top insets bottom Dimension leftPref left getMinimumSize dim width leftPref width Dimension centerPref center getMinimumSize dim width centerPref width dim height centerPref height Dimension rightPref right getMinimumSize dim width rightPref width Dimension bottomPref bottom getMinimumSize dim height bottomPref height return dim public void layoutContainer Container parent Dimension size parent getSize Border border getBorder Insets insets if border null insets new Insets else insets getBorder getBorderInsets JEditTextArea this int itop insets top int ileft insets left int ibottom insets bottom int iright insets right int rightWidth right getPreferredSize width int leftWidth left getPreferredSize width int bottomHeight bottom getPreferredSize height int centerWidth Math max size width leftWidth rightWidth ileft iright int centerHeight Math max size height bottomHeight itop ibottom left setBounds ileft itop leftWidth centerHeight center setBounds ileft leftWidth itop centerWidth centerHeight right setBounds ileft leftWidth centerWidth itop rightWidth centerHeight bottom setBounds ileft itop centerHeight Math max size width rightWidth ileft iright bottomHeight Component center Component left Component right Component bottom static class CaretBlinker implements ActionListener public void actionPerformed ActionEvent evt if focusedComponent null focusedComponent hasFocus focusedComponent blinkCaret class MutableCaretEvent extends CaretEvent MutableCaretEvent super JEditTextArea this public int getDot return getCaretPosition public int getMark return getMarkPosition class AdjustHandler implements AdjustmentListener public void adjustmentValueChanged final AdjustmentEvent evt if scrollBarsInitialized return if evt getAdjustable vertical setFirstLine vertical getValue else setHorizontalOffset horizontal getValue class ComponentHandler extends ComponentAdapter public void componentResized ComponentEvent evt class BufferChangeHandler implements BufferChangeListener public void foldLevelChanged Buffer buffer int start int end if bufferChanging end buffer isLoaded invalidateLineRange start end public void contentInserted Buffer buffer int startLine int start int numLines int length chunkCache invalidateChunksFromPhys startLine if numLines softWrap foldVisibilityManager getLastVisibleLine numLines physLastLine int oldScreenLastLine screenLastLine recalculateLastPhysicalLine invalidateScreenLineRange oldScreenLastLine screenLastLine if buffer isLoaded return repaintAndScroll startLine numLines for int selection size Selection Selection selection elementAt boolean changed false if instanceof Selection Rect start start instanceof Selection Range start start start length startLine getLineOfOffset start changed true if end start end length endLine getLineOfOffset end changed true if changed invalidateLineRange startLine endLine if caret start moveCaretPosition caret length true else moveCaretPosition caret public void contentRemoved Buffer buffer int startLine int start int numLines int length if buffer isLoaded return chunkCache invalidateChunksFromPhys startLine repaintAndScroll startLine numLines if numLines softWrap foldVisibilityManager getLastVisibleLine numLines physLastLine Runnable new Runnable public void run queuedRecalcLastPhys false int oldScreenLastLine screenLastLine recalculateLastPhysicalLine invalidateScreenLineRange oldScreenLastLine screenLastLine if buffer isTransactionInProgress if queuedRecalcLastPhys queuedRecalcLastPhys true runnables add else run int end start length for int selection size Selection Selection selection elementAt boolean changed false if start start start end start start changed true else if start end start length changed true if end start end end end start changed true else if end end end length changed true if start end selection removeElement invalidateLineRange startLine endLine else if changed startLine getLineOfOffset start endLine getLineOfOffset end invalidateLineRange startLine endLine if caret start caret end moveCaretPosition start false else if caret end moveCaretPosition caret length false else moveCaretPosition caret public void transactionComplete Buffer buffer for int runnables size Runnable runnables get run runnables clear private void repaintAndScroll int startLine int numLines if numLines invalidateLine startLine else if startLine firstLine setFirstLine firstLine numLines else updateScrollBars invalidateScreenLineRange chunkCache getScreenLineOfOffset startLine screenLastLine class FocusHandler implements FocusListener public void focusGained FocusEvent evt if bufferChanging return if bracketLine invalidateLineRange bracketLine caretLine else invalidateLine caretLine view updateGutterBorders public void focusLost FocusEvent evt if isShowing return if bracketLine invalidateLineRange bracketLine caretLine else invalidateLine caretLine class MouseHandler extends MouseInputAdapter private int dragStartLine private int dragStartOffset private int dragStart private int clickCount private boolean dragged private boolean quickCopyDrag private boolean clearStatus public void mousePressed MouseEvent evt view getInputHandler resetLastActionCount grabFocus if GUIUtilities isPopupTrigger evt popup null if popup isVisible popup setVisible false else GUIUtilities showPopupMenu popup painter evt getX evt getY return quickCopyDrag isQuickCopyEnabled evt getModifiers MouseEvent BUTTON2_MASK blink true invalidateLine caretLine int evt getX int evt getY dragStart xyToOffset painter isBlockCaretEnabled dragStartLine getLineOfOffset dragStart dragStartOffset dragStart getLineStartOffset dragStartLine dragged false clickCount evt getClickCount switch clickCount case doSingleClick evt break case doDoubleClick evt break doTripleClick evt break public void mouseReleased MouseEvent evt if getSelectionCount Registers setRegister getSelectedText if dragged if quickCopyDrag String text getSelectedText selectNone setSelectedText text else if isQuickCopyEnabled evt getModifiers InputEvent BUTTON2_MASK moveCaretPosition dragStart false if isEditable getToolkit beep else Registers paste JEditTextArea this dragged false if clearStatus clearStatus false view getStatus setMessage null private void doSingleClick MouseEvent evt boolean control OperatingSystem isMacOS evt isMetaDown OperatingSystem isMacOS evt isControlDown if evt isShiftDown resizeSelection getMarkPosition dragStart control moveCaretPosition dragStart false dragStartLine getMarkLine dragStart getMarkPosition dragStartOffset dragStart getLineStartOffset dragStartLine else if control if multi selectNone moveCaretPosition xyToOffset evt getX evt getY false false selectToMatchingBracket else if multi selectNone if quickCopyDrag moveCaretPosition dragStart false private void doDoubleClick MouseEvent evt if getLineLength dragStartLine return String lineText getLineText dragStartLine String noWordSep buffer getStringProperty if dragStartOffset getLineLength dragStartLine dragStartOffset int wordStart TextUtilities findWordStart lineText dragStartOffset noWordSep int wordEnd TextUtilities findWordEnd lineText dragStartOffset noWordSep int lineStart getLineStartOffset dragStartLine addToSelection new Selection Range lineStart wordStart lineStart wordEnd if quickCopyDrag quickCopyDrag false moveCaretPosition lineStart wordEnd false dragged true private void doTripleClick MouseEvent evt int newCaret getLineEndOffset dragStartLine addToSelection new Selection Range getLineStartOffset dragStartLine newCaret if quickCopyDrag quickCopyDrag false moveCaretPosition newCaret public void mouseDragged MouseEvent evt if GUIUtilities isPopupTrigger evt popup null popup isVisible return if evt getY setFirstLine getFirstLine else if evt getY getHeight setFirstLine getFirstLine boolean rect OperatingSystem isMacOS evt isMetaDown OperatingSystem isMacOS evt isControlDown if quickCopyDrag view getStatus setMessage jEdit getProperty clearStatus true else if evt isControlDown view getStatus setMessage jEdit getProperty clearStatus true switch clickCount case doSingleDrag evt rect break case doDoubleDrag evt rect break doTripleDrag evt rect break private void doSingleDrag MouseEvent evt boolean rect int dot xyToOffset evt getX Math max Math min painter getHeight evt getY painter isBlockCaretEnabled dragged true resizeSelection dragStart dot rect if quickCopyDrag int line buffer getLineOfOffset dot scrollTo line dot buffer getLineStartOffset line false else if dot caret return moveCaretPosition dot false private void doDoubleDrag MouseEvent evt boolean rect int markLineStart getLineStartOffset dragStartLine int markLineLength getLineLength dragStartLine int mark dragStartOffset int pos xyToOffset evt getX Math max Math min painter getHeight evt getY painter isBlockCaretEnabled int line getLineOfOffset pos int lineStart getLineStartOffset line int lineLength getLineLength line int offset pos lineStart String lineText getLineText line String markLineText getLineText dragStartLine String noWordSep buffer getStringProperty if markLineStart dragStartOffset lineStart offset if offset offset lineLength offset TextUtilities findWordStart lineText offset noWordSep if markLineLength mark TextUtilities findWordEnd markLineText mark noWordSep else if offset lineLength offset TextUtilities findWordEnd lineText offset noWordSep if mark mark markLineLength mark TextUtilities findWordStart markLineText mark noWordSep if lineStart offset caret return resizeSelection markLineStart mark lineStart offset rect if quickCopyDrag moveCaretPosition lineStart offset false private void doTripleDrag MouseEvent evt boolean rect int offset xyToOffset evt getX Math max Math min painter getHeight evt getY false int mouseLine getLineOfOffset offset int mark int mouse if dragStartLine mouseLine mark getLineEndOffset dragStartLine if offset getLineEndOffset mouseLine mouse offset else mouse getLineStartOffset mouseLine else mark getLineStartOffset dragStartLine if offset getLineStartOffset mouseLine mouse offset else if offset getLineEndOffset mouseLine mouseLine getBuffer getLineCount mouse getLineEndOffset mouseLine else mouse getLineEndOffset mouseLine mouse Math min getBuffer getLength mouse if mouse caret return dragged true resizeSelection mark mouse rect moveCaretPosition mouse false static caretTimer new Timer new CaretBlinker caretTimer setInitialDelay caretTimer start class BSHFormalParameters extends SimpleNode int numArgs String argNames Class argTypes BSHFormalParameters int id super id public Object eval NameSpace namespace throws EvalError numArgs jjtGetNumChildren argNames new String numArgs argTypes new Class numArgs for int numArgs BSHFormalParameter param BSHFormalParameter jjtGetChild param eval namespace argNames param name argTypes param type return Primitive VOID public abstract class ReflectManager private static ReflectManager rfm public static ReflectManager getReflectManager if rfm null Class clas try clas BshClassManager plainClassForName rfm ReflectManager clas newInstance catch Exception throw new Unavailable return rfm public static boolean RMSetAccessible Object obj throws Unavailable return getReflectManager setAccessible obj public abstract boolean setAccessible Object public class PluginManager extends JDialog public PluginManager Frame frame super frame jEdit getProperty true JPanel content new JPanel new BorderLayout content setBorder new EmptyBorder setContentPane content JLabel caption new JLabel jEdit getProperty caption setBorder new EmptyBorder content add BorderLayout NORTH caption tree new JTree tree setCellRenderer new Renderer tree setRootVisible false tree setVisibleRowCount tree addTreeSelectionListener new TreeHandler JPanel panel new JPanel new BorderLayout panel add BorderLayout CENTER new JScrollPane tree JPanel panel2 new JPanel new BorderLayout panel2 setBorder new EmptyBorder JPanel labelBox new JPanel new GridLayout labelBox setBorder new EmptyBorder labelBox add new JLabel jEdit getProperty SwingConstants RIGHT labelBox add new JLabel jEdit getProperty SwingConstants RIGHT labelBox add new JLabel jEdit getProperty SwingConstants RIGHT panel2 add BorderLayout WEST labelBox JPanel valueBox new JPanel new GridLayout valueBox add name new JLabel valueBox add author new JLabel valueBox add version new JLabel panel2 add BorderLayout CENTER valueBox panel add BorderLayout SOUTH panel2 content add BorderLayout CENTER panel JPanel buttons new JPanel buttons setLayout new BoxLayout buttons BoxLayout X_AXIS buttons setBorder new EmptyBorder buttons add Box createGlue remove new JButton jEdit getProperty remove addActionListener new ActionHandler buttons add remove buttons add Box createHorizontalStrut update new JButton jEdit getProperty update addActionListener new ActionHandler buttons add update buttons add Box createHorizontalStrut install new JButton jEdit getProperty install addActionListener new ActionHandler buttons add install buttons add Box createHorizontalStrut close new JButton jEdit getProperty close addActionListener new ActionHandler buttons add close buttons add Box createGlue content add BorderLayout SOUTH buttons updateTree setDefaultCloseOperation DISPOSE_ON_CLOSE pack setLocationRelativeTo frame show private JTree tree private JLabel name private JLabel author private JLabel version private JButton remove private JButton update private JButton install private JButton close private void updateTree DefaultMutableTreeNode treeRoot new DefaultMutableTreeNode DefaultTreeModel treeModel new DefaultTreeModel treeRoot DefaultMutableTreeNode loadedTree new DefaultMutableTreeNode jEdit getProperty true DefaultMutableTreeNode notLoadedTree new DefaultMutableTreeNode jEdit getProperty true DefaultMutableTreeNode newTree new DefaultMutableTreeNode jEdit getProperty true EditPlugin plugins jEdit getPlugins for int plugins length EditPlugin plugin plugins String path plugin getJAR getPath if new File path exists continue if plugin instanceof EditPlugin Broken Entry entry new Entry path plugin getClassName true notLoadedTree add new DefaultMutableTreeNode entry else Entry entry new Entry path plugin getClassName false loadedTree add new DefaultMutableTreeNode entry if notLoadedTree getChildCount treeRoot add notLoadedTree if loadedTree getChildCount treeRoot add loadedTree String newPlugins jEdit getNotLoadedPluginJARs for int newPlugins length Entry entry new Entry newPlugins null false newTree add new DefaultMutableTreeNode entry if newTree getChildCount treeRoot add newTree tree setModel treeModel for int tree getRowCount tree expandRow remove setEnabled false name setText null author setText null version setText null class Entry String clazz String name version author Vector jars boolean broken Entry String path String clazz boolean broken Entry this clazz clazz Entry this broken broken jars new Vector jars addElement path if clazz null Entry this name path else Entry this name jEdit getProperty clazz if name null name clazz Entry this version jEdit getProperty clazz Entry this author jEdit getProperty clazz String jarsProp jEdit getProperty clazz if jarsProp null String directory MiscUtilities getParentOfPath path StringTokenizer st new StringTokenizer jarsProp while st hasMoreElements jars addElement MiscUtilities constructPath directory st nextToken public String toString return Entry this name class ActionHandler implements ActionListener public void actionPerformed ActionEvent evt Object source evt getSource if source close dispose else if source remove TreePath selected tree getSelectionModel getSelectionPaths StringBuffer buf new StringBuffer Roster roster new Roster for int selected length Object last DefaultMutableTreeNode selected getLastPathComponent getUserObject if last instanceof Entry Entry entry Entry last for int entry jars size String jar String entry jars elementAt if buf length buf append buf append jar roster addOperation new Roster Remove jar String args buf toString if GUIUtilities confirm PluginManager this args JOptionPane YES_NO_OPTION JOptionPane QUESTION_MESSAGE JOptionPane YES_OPTION new PluginManagerProgress PluginManager this roster updateTree else if source update PluginList list new PluginListDownloadProgress PluginManager this getPluginList if list null return if jEdit getSettingsDirectory null GUIUtilities error PluginManager this null return Vector plugins new Vector for int list plugins size PluginList Plugin plugin PluginList Plugin list plugins elementAt PluginList Branch branch plugin getCompatibleBranch if branch null branch canSatisfyDependencies plugin installedVersion null MiscUtilities compareStrings branch version plugin installedVersion false plugins addElement plugin if plugins size GUIUtilities message PluginManager this null return Roster roster new Roster new InstallPluginsDialog PluginManager this plugins InstallPluginsDialog UPDATE installPlugins roster if roster isEmpty return new PluginManagerProgress PluginManager this roster updateTree else if source install PluginList list new PluginListDownloadProgress PluginManager this getPluginList if list null return if jEdit getSettingsDirectory null jEdit getJEditHome null GUIUtilities error PluginManager this null return Vector plugins new Vector for int list plugins size PluginList Plugin plugin PluginList Plugin list plugins elementAt if plugin installed null plugin canBeInstalled plugins addElement plugin Roster roster new Roster new InstallPluginsDialog PluginManager this plugins InstallPluginsDialog INSTALL installPlugins roster if roster isEmpty return new PluginManagerProgress PluginManager this roster updateTree class TreeHandler implements TreeSelectionListener public void valueChanged TreeSelectionEvent evt TreePath selection evt getPath DefaultMutableTreeNode node if selection null node null else node DefaultMutableTreeNode selection getLastPathComponent name setText null author setText null version setText null if node null node isLeaf node getUserObject instanceof Entry remove setEnabled true Entry entry Entry node getUserObject if entry clazz null name setText entry name author setText entry author version setText entry version else remove setEnabled false class Renderer extends DefaultTreeCellRenderer public Component getTreeCellRendererComponent JTree tree Object value boolean selected boolean expanded boolean leaf int row boolean hasFocus super getTreeCellRendererComponent tree value selected expanded leaf row hasFocus setIcon null return this class BSHPrimaryExpression extends SimpleNode BSHPrimaryExpression int id super id public Object eval CallStack callstack Interpreter interpreter throws EvalError Object obj jjtGetChild int jjtGetNumChildren for int obj BSHPrimarySuffix jjtGetChild doSuffix obj callstack interpreter if obj instanceof SimpleNode if obj instanceof BSHAmbiguousName obj BSHAmbiguousName obj toObject callstack interpreter else obj SimpleNode obj eval callstack interpreter return obj public class Java14 public static void init JFrame setDefaultLookAndFeelDecorated jEdit getBooleanProperty JDialog setDefaultLookAndFeelDecorated jEdit getBooleanProperty KeyboardFocusManager setCurrentKeyboardFocusManager new MyFocusManager EditBus addToBus new EBComponent public void handleMessage EBMessage msg if msg instanceof ViewUpdate ViewUpdate vu ViewUpdate msg if vu getWhat ViewUpdate CREATED vu getView setFocusTraversalPolicy new MyFocusTraversalPolicy Clipboard selection Toolkit getDefaultToolkit getSystemSelection if selection null Log log Log DEBUG Java14 class Registers setRegister new Registers ClipboardRegister selection static class MyFocusManager extends DefaultKeyboardFocusManager MyFocusManager setDefaultFocusTraversalPolicy new LayoutFocusTraversalPolicy public boolean postProcessKeyEvent KeyEvent evt if evt isConsumed Component comp Component evt getSource if comp isShowing return true for if comp instanceof View View comp processKeyEvent evt return true else if comp null comp instanceof Window comp instanceof JEditTextArea break else comp comp getParent return super postProcessKeyEvent evt static class MyFocusTraversalPolicy extends LayoutFocusTraversalPolicy public Component getDefaultComponent Container focusCycleRoot return View focusCycleRoot getTextArea public abstract class EBMessage public EBMessage EBComponent source this source source public EBComponent getSource return source public void veto vetoed true public boolean isVetoed return vetoed public String toString return getClass getName paramString public String paramString return source private EBComponent source private boolean vetoed public static abstract class NonVetoable extends EBMessage public NonVetoable EBComponent source super source public void veto throw new InternalError public class AbbrevsOptionPane extends AbstractOptionPane public AbbrevsOptionPane super protected void setLayout new BorderLayout JPanel panel new JPanel new BorderLayout JPanel panel2 new JPanel panel2 setLayout new BoxLayout panel2 BoxLayout X_AXIS panel2 setBorder new EmptyBorder panel2 add Box createGlue expandOnInput new JCheckBox jEdit getProperty Abbrevs getExpandOnInput panel2 add expandOnInput panel2 add Box createGlue panel add panel2 BorderLayout NORTH JPanel panel3 new JPanel panel3 setLayout new BoxLayout panel3 BoxLayout X_AXIS panel3 setBorder new EmptyBorder panel3 add Box createGlue JLabel label new JLabel jEdit getProperty label setBorder new EmptyBorder panel3 add label Hashtable Abbrevs getModeAbbrevs modeAbbrevs new Hashtable Mode modes jEdit getModes String sets new String modes length sets for int modes length String name modes getName sets name modeAbbrevs put name new AbbrevsModel Hashtable get name setsComboBox new JComboBox sets ActionHandler actionHandler new ActionHandler setsComboBox addActionListener actionHandler panel3 add setsComboBox panel3 add Box createGlue panel add panel3 BorderLayout SOUTH add BorderLayout NORTH panel globalAbbrevs new AbbrevsModel Abbrevs getGlobalAbbrevs abbrevsTable new JTable globalAbbrevs abbrevsTable setAutoResizeMode JTable AUTO_RESIZE_ALL_COLUMNS abbrevsTable getTableHeader setReorderingAllowed false abbrevsTable getTableHeader addMouseListener new HeaderMouseHandler abbrevsTable getSelectionModel addListSelectionListener new SelectionHandler abbrevsTable addMouseListener new TableMouseHandler Dimension abbrevsTable getPreferredSize height Math min height JScrollPane scroller new JScrollPane abbrevsTable scroller setPreferredSize add BorderLayout CENTER scroller JPanel buttons new JPanel buttons setLayout new BoxLayout buttons BoxLayout X_AXIS buttons setBorder new EmptyBorder buttons add Box createGlue add new JButton jEdit getProperty add addActionListener actionHandler buttons add add buttons add Box createHorizontalStrut edit new JButton jEdit getProperty edit addActionListener actionHandler buttons add edit buttons add Box createHorizontalStrut remove new JButton jEdit getProperty remove addActionListener actionHandler buttons add remove buttons add Box createGlue add BorderLayout SOUTH buttons updateEnabled protected void if abbrevsTable getCellEditor null abbrevsTable getCellEditor stopCellEditing Abbrevs setExpandOnInput expandOnInput isSelected Abbrevs setGlobalAbbrevs globalAbbrevs toHashtable Hashtable modeHash new Hashtable Enumeration keys modeAbbrevs keys Enumeration values modeAbbrevs elements while keys hasMoreElements modeHash put keys nextElement AbbrevsModel values nextElement toHashtable Abbrevs setModeAbbrevs modeHash private JComboBox setsComboBox private JCheckBox expandOnInput private JTable abbrevsTable private AbbrevsModel globalAbbrevs private Hashtable modeAbbrevs private JButton add private JButton edit private JButton remove private void updateEnabled int selectedRow abbrevsTable getSelectedRow edit setEnabled selectedRow remove setEnabled selectedRow private void edit AbbrevsModel abbrevsModel AbbrevsModel abbrevsTable getModel int row abbrevsTable getSelectedRow String abbrev String abbrevsModel getValueAt row String expansion String abbrevsModel getValueAt row EditAbbrevDialog dialog new EditAbbrevDialog AbbrevsOptionPane this abbrev expansion abbrev dialog getAbbrev expansion dialog getExpansion if abbrev null expansion null abbrevsModel setValueAt abbrev row abbrevsModel setValueAt expansion row class HeaderMouseHandler extends MouseAdapter public void mouseClicked MouseEvent evt switch abbrevsTable getTableHeader columnAtPoint evt getPoint case AbbrevsModel abbrevsTable getModel sort break case AbbrevsModel abbrevsTable getModel sort break class TableMouseHandler extends MouseAdapter public void mouseClicked MouseEvent evt if evt getClickCount edit class SelectionHandler implements ListSelectionListener public void valueChanged ListSelectionEvent evt updateEnabled class ActionHandler implements ActionListener public void actionPerformed ActionEvent evt AbbrevsModel abbrevsModel AbbrevsModel abbrevsTable getModel Object source evt getSource if source setsComboBox String selected String setsComboBox getSelectedItem if selected equals abbrevsTable setModel globalAbbrevs else abbrevsTable setModel AbbrevsModel modeAbbrevs get selected updateEnabled else if source add EditAbbrevDialog dialog new EditAbbrevDialog AbbrevsOptionPane this null null String abbrev dialog getAbbrev String expansion dialog getExpansion if abbrev null abbrev length expansion null expansion length abbrevsModel add abbrev expansion int index abbrevsModel getRowCount abbrevsTable getSelectionModel setSelectionInterval index index Rectangle rect abbrevsTable getCellRect index true abbrevsTable scrollRectToVisible rect updateEnabled else if source edit edit else if source remove int selectedRow abbrevsTable getSelectedRow abbrevsModel remove selectedRow updateEnabled class AbbrevsModel extends AbstractTableModel Vector abbrevs AbbrevsModel abbrevs new Vector AbbrevsModel Hashtable abbrevHash this if abbrevHash null Enumeration abbrevEnum abbrevHash keys Enumeration expandEnum abbrevHash elements while abbrevEnum hasMoreElements abbrevs addElement new Abbrev String abbrevEnum nextElement String expandEnum nextElement sort void sort int col MiscUtilities quicksort abbrevs new AbbrevCompare col fireTableDataChanged void add String abbrev String expansion abbrevs addElement new Abbrev abbrev expansion fireTableStructureChanged void remove int index abbrevs removeElementAt index fireTableStructureChanged public Hashtable toHashtable Hashtable hash new Hashtable for int abbrevs size Abbrev abbrev Abbrev abbrevs elementAt if abbrev abbrev length abbrev expand length hash put abbrev abbrev abbrev expand return hash public int getColumnCount return public int getRowCount return abbrevs size public Object getValueAt int row int col Abbrev abbrev Abbrev abbrevs elementAt row switch col case return abbrev abbrev case return abbrev expand default return null public boolean isCellEditable int row int col return false public void setValueAt Object value int row int col if value null value Abbrev abbrev Abbrev abbrevs elementAt row if col abbrev abbrev String value else abbrev expand String value fireTableRowsUpdated row row public String getColumnName int index switch index case return jEdit getProperty case return jEdit getProperty default return null class AbbrevCompare implements MiscUtilities Compare int col AbbrevCompare int col this col col public int compare Object obj1 Object obj2 Abbrev a1 Abbrev obj1 Abbrev a2 Abbrev obj2 if col String abbrev1 a1 abbrev toLowerCase String abbrev2 a2 abbrev toLowerCase return MiscUtilities compareStrings abbrev1 abbrev2 true else String expand1 a1 expand toLowerCase String expand2 a2 expand toLowerCase return MiscUtilities compareStrings expand1 expand2 true class Abbrev Abbrev Abbrev String abbrev String expand this abbrev abbrev this expand expand String abbrev String expand public class AboutDialog extends EnhancedDialog public AboutDialog View view super view jEdit getProperty true JPanel content new JPanel new BorderLayout content setBorder new EmptyBorder setContentPane content content add BorderLayout CENTER new AboutPanel JPanel buttonPanel new JPanel buttonPanel setLayout new BoxLayout buttonPanel BoxLayout X_AXIS buttonPanel setBorder new EmptyBorder buttonPanel add Box createGlue close new JButton jEdit getProperty close addActionListener new ActionHandler getRootPane setDefaultButton close buttonPanel add close buttonPanel add Box createGlue content add BorderLayout SOUTH buttonPanel pack setResizable false setLocationRelativeTo view show public void ok dispose public void cancel dispose private JButton close class ActionHandler implements ActionListener public void actionPerformed ActionEvent evt dispose static class AboutPanel extends JComponent ImageIcon image Vector text int scrollPosition AnimationThread thread AboutPanel setFont UIManager getFont setForeground new Color image new ImageIcon getClass getResource setBorder new MatteBorder Color black text new Vector StringTokenizer st new StringTokenizer jEdit getProperty while st hasMoreTokens text addElement st nextToken scrollPosition thread new AnimationThread public void paintComponent Graphics Graphics2D Graphics2D image paintIcon this FontMetrics fm getFontMetrics int height fm getHeight int firstLine scrollPosition height int firstLineOffset height scrollPosition height int lastLine scrollPosition height int firstLineOffset for int firstLine lastLine if text size String line String text elementAt drawString line fm stringWidth line fm getHeight String args jEdit getVersion String version jEdit getProperty args drawString version fm stringWidth version public Dimension getPreferredSize return new Dimension image getIconWidth image getIconHeight public void addNotify super addNotify thread start public void removeNotify super removeNotify thread stop class AnimationThread extends Thread AnimationThread super setPriority Thread MIN_PRIORITY public void run for long start System currentTimeMillis scrollPosition FontMetrics fm getFontMetrics getFont int max text size fm getHeight if scrollPosition max scrollPosition try Thread sleep Math max System currentTimeMillis start catch InterruptedException ie repaint public class SearchDialog extends EnhancedDialog implements EBComponent public static final int CURRENT_BUFFER public static final int ALL_BUFFERS public static final int DIRECTORY public static void showSearchDialog View view String searchString int searchIn SearchDialog dialog SearchDialog viewHash get view if dialog null if OperatingSystem isUnix OperatingSystem isMacOS dialog setVisible false dialog setVisible true dialog setSearchString searchString searchIn GUIUtilities requestFocus dialog dialog find dialog toFront dialog requestFocus else dialog new SearchDialog view searchString searchIn viewHash put view dialog public SearchDialog View view String searchString this view searchString CURRENT_BUFFER public SearchDialog View view String searchString int searchIn super view jEdit getProperty false this view view JPanel content new JPanel new BorderLayout content setBorder new EmptyBorder setContentPane content JPanel centerPanel new JPanel new BorderLayout centerPanel add BorderLayout NORTH createFieldPanel centerPanel add BorderLayout CENTER createSearchSettingsPanel content add BorderLayout CENTER centerPanel content add BorderLayout SOUTH createMultiFilePanel content add BorderLayout EAST createButtonsPanel ignoreCase setSelected SearchAndReplace getIgnoreCase regexp setSelected SearchAndReplace getRegexp wrap setSelected SearchAndReplace getAutoWrapAround if SearchAndReplace getReverseSearch searchBack setSelected true else searchForward setSelected true if SearchAndReplace getBeanShellReplace replace setModel beanShellReplace setSelected true else replace setModel stringReplace setSelected true SearchFileSet fileset SearchAndReplace getSearchFileSet if fileset instanceof DirectoryListSet filter setText DirectoryListSet fileset getFileFilter directory setText DirectoryListSet fileset getDirectory searchSubDirectories setSelected DirectoryListSet fileset isRecursive else String path if view getBuffer getVFS instanceof FileVFS path MiscUtilities getParentOfPath view getBuffer getPath else path System getProperty directory setText path if fileset instanceof AllBufferSet filter setText AllBufferSet fileset getFileFilter else filter setText MiscUtilities getFileExtension view getBuffer getName searchSubDirectories setSelected true directory addCurrentToHistory keepDialog setSelected jEdit getBooleanProperty setSearchString searchString searchIn pack jEdit unsetProperty jEdit unsetProperty jEdit unsetProperty jEdit unsetProperty GUIUtilities loadGeometry this show EditBus addToBus this GUIUtilities requestFocus this find public void setSearchString String searchString int searchIn if searchString null find setText null else if searchString indexOf find setText searchString find selectAll else if searchIn CURRENT_BUFFER searchSelection setSelected true hyperSearch setSelected true if searchIn CURRENT_BUFFER if searchSelection isSelected searchCurrentBuffer setSelected true hyperSearch setSelected jEdit getBooleanProperty else if searchIn ALL_BUFFERS searchAllBuffers setSelected true hyperSearch setSelected true else if searchIn DIRECTORY hyperSearch setSelected true searchDirectory setSelected true updateEnabled public void ok try setCursor Cursor getPredefinedCursor Cursor WAIT_CURSOR if save return if hyperSearch isSelected searchSelection isSelected if SearchAndReplace hyperSearch view searchSelection isSelected closeOrKeepDialog else if SearchAndReplace find view closeOrKeepDialog finally setCursor Cursor getPredefinedCursor Cursor DEFAULT_CURSOR public void cancel save GUIUtilities saveGeometry this dispose public void handleMessage EBMessage msg if msg instanceof SearchSettingsChanged ignoreCase setSelected SearchAndReplace getIgnoreCase regexp setSelected SearchAndReplace getRegexp else if msg instanceof ViewUpdate ViewUpdate vmsg ViewUpdate msg if vmsg getView view vmsg getWhat ViewUpdate CLOSED viewHash remove view public void dispose EditBus removeFromBus this viewHash remove view super dispose private static HashMap viewHash new HashMap private View view private HistoryTextField find replace private JRadioButton stringReplace beanShellReplace private JCheckBox keepDialog ignoreCase regexp hyperSearch wrap private JRadioButton searchBack searchForward private JRadioButton searchSelection searchCurrentBuffer searchAllBuffers searchDirectory private HistoryTextField filter directory private JCheckBox searchSubDirectories private JButton choose closeBtn private JPanel createFieldPanel ButtonActionHandler actionHandler new ButtonActionHandler JPanel fieldPanel new JPanel new VariableGridLayout VariableGridLayout FIXED_NUM_COLUMNS fieldPanel setBorder new EmptyBorder JLabel label new JLabel jEdit getProperty label setDisplayedMnemonic jEdit getProperty charAt find new HistoryTextField Dimension size find getPreferredSize size width find getFontMetrics find getFont charWidth find setPreferredSize size find addActionListener actionHandler label setLabelFor find label setBorder new EmptyBorder fieldPanel add label fieldPanel add find label new JLabel jEdit getProperty label setDisplayedMnemonic jEdit getProperty charAt label setBorder new EmptyBorder fieldPanel add label ButtonGroup grp new ButtonGroup ReplaceActionHandler replaceActionHandler new ReplaceActionHandler Box replaceModeBox new Box BoxLayout X_AXIS stringReplace new MyJRadioButton jEdit getProperty stringReplace addActionListener replaceActionHandler grp add stringReplace replaceModeBox add stringReplace replaceModeBox add Box createHorizontalStrut beanShellReplace new MyJRadioButton jEdit getProperty beanShellReplace addActionListener replaceActionHandler grp add beanShellReplace replaceModeBox add beanShellReplace fieldPanel add replaceModeBox fieldPanel add Box createVerticalStrut replace new HistoryTextField replace addActionListener actionHandler label setLabelFor replace fieldPanel add replace return fieldPanel private JPanel createSearchSettingsPanel JPanel searchSettings new JPanel new VariableGridLayout VariableGridLayout FIXED_NUM_COLUMNS searchSettings setBorder new EmptyBorder SettingsActionHandler actionHandler new SettingsActionHandler ButtonGroup fileset new ButtonGroup ButtonGroup direction new ButtonGroup searchSettings add new JLabel jEdit getProperty searchSettings add new JLabel jEdit getProperty searchSettings add new JLabel jEdit getProperty searchSelection new JRadioButton jEdit getProperty searchSelection setMnemonic jEdit getProperty charAt fileset add searchSelection searchSettings add searchSelection searchSelection addActionListener actionHandler keepDialog new JCheckBox jEdit getProperty keepDialog setMnemonic jEdit getProperty charAt searchSettings add keepDialog searchBack new JRadioButton jEdit getProperty searchBack setMnemonic jEdit getProperty charAt direction add searchBack searchSettings add searchBack searchBack addActionListener actionHandler searchCurrentBuffer new JRadioButton jEdit getProperty searchCurrentBuffer setMnemonic jEdit getProperty charAt fileset add searchCurrentBuffer searchSettings add searchCurrentBuffer searchCurrentBuffer addActionListener actionHandler ignoreCase new JCheckBox jEdit getProperty ignoreCase setMnemonic jEdit getProperty charAt searchSettings add ignoreCase ignoreCase addActionListener actionHandler searchForward new JRadioButton jEdit getProperty searchForward setMnemonic jEdit getProperty charAt direction add searchForward searchSettings add searchForward searchForward addActionListener actionHandler searchAllBuffers new JRadioButton jEdit getProperty searchAllBuffers setMnemonic jEdit getProperty charAt fileset add searchAllBuffers searchSettings add searchAllBuffers searchAllBuffers addActionListener actionHandler regexp new JCheckBox jEdit getProperty regexp setMnemonic jEdit getProperty charAt searchSettings add regexp regexp addActionListener actionHandler wrap new JCheckBox jEdit getProperty wrap setMnemonic jEdit getProperty charAt searchSettings add wrap wrap addActionListener actionHandler searchDirectory new JRadioButton jEdit getProperty searchDirectory setMnemonic jEdit getProperty charAt fileset add searchDirectory searchSettings add searchDirectory searchDirectory addActionListener actionHandler hyperSearch new JCheckBox jEdit getProperty hyperSearch setMnemonic jEdit getProperty charAt searchSettings add hyperSearch hyperSearch addActionListener actionHandler return searchSettings private JPanel createMultiFilePanel JPanel multifile new JPanel GridBagLayout layout new GridBagLayout multifile setLayout layout GridBagConstraints cons new GridBagConstraints cons gridy cons gridwidth cons gridheight cons anchor GridBagConstraints WEST cons fill GridBagConstraints HORIZONTAL MultiFileActionHandler actionListener new MultiFileActionHandler filter new HistoryTextField filter addActionListener actionListener cons insets new Insets JLabel label new JLabel jEdit getProperty SwingConstants RIGHT label setBorder new EmptyBorder label setDisplayedMnemonic jEdit getProperty charAt label setLabelFor filter cons weightx layout setConstraints label cons multifile add label cons insets new Insets cons weightx layout setConstraints filter cons multifile add filter cons gridy directory new HistoryTextField directory addActionListener actionListener label new JLabel jEdit getProperty SwingConstants RIGHT label setBorder new EmptyBorder label setDisplayedMnemonic jEdit getProperty charAt label setLabelFor directory cons insets new Insets cons weightx layout setConstraints label cons multifile add label cons insets new Insets cons weightx cons gridwidth layout setConstraints directory cons multifile add directory choose new JButton jEdit getProperty choose setMnemonic jEdit getProperty charAt cons insets new Insets cons weightx cons gridwidth layout setConstraints choose cons multifile add choose choose addActionListener actionListener cons insets new Insets cons gridy cons gridwidth searchSubDirectories new JCheckBox jEdit getProperty searchSubDirectories setMnemonic jEdit getProperty charAt layout setConstraints searchSubDirectories cons multifile add searchSubDirectories return multifile private Box createButtonsPanel Box box new Box BoxLayout Y_AXIS ButtonActionHandler actionHandler new ButtonActionHandler box add Box createVerticalStrut JPanel grid new JPanel new GridLayout findBtn new JButton jEdit getProperty getRootPane setDefaultButton findBtn grid add findBtn findBtn addActionListener actionHandler replaceAndFindBtn new JButton jEdit getProperty replaceAndFindBtn setMnemonic jEdit getProperty charAt grid add replaceAndFindBtn replaceAndFindBtn addActionListener actionHandler replaceAllBtn new JButton jEdit getProperty replaceAllBtn setMnemonic jEdit getProperty charAt grid add replaceAllBtn replaceAllBtn addActionListener actionHandler closeBtn new JButton jEdit getProperty grid add closeBtn closeBtn addActionListener actionHandler grid setMaximumSize grid getPreferredSize box add grid box add Box createGlue return box private void updateEnabled wrap setEnabled hyperSearch isSelected searchSelection isSelected boolean reverseEnabled hyperSearch isSelected searchCurrentBuffer isSelected searchBack setEnabled reverseEnabled regexp isSelected searchForward setEnabled reverseEnabled if reverseEnabled searchForward setSelected true filter setEnabled searchAllBuffers isSelected searchDirectory isSelected boolean directoryEnabled searchDirectory isSelected directory setEnabled directoryEnabled choose setEnabled directoryEnabled searchSubDirectories setEnabled directoryEnabled findBtn setEnabled searchSelection isSelected hyperSearch isSelected replaceAndFindBtn setEnabled hyperSearch isSelected searchSelection isSelected private boolean save String filter this filter getText this filter addCurrentToHistory if filter length filter SearchFileSet fileset SearchAndReplace getSearchFileSet if searchSelection isSelected fileset new CurrentBufferSet else if searchCurrentBuffer isSelected fileset new CurrentBufferSet jEdit setBooleanProperty hyperSearch isSelected else if searchAllBuffers isSelected fileset new AllBufferSet filter else if searchDirectory isSelected String directory this directory getText this directory addCurrentToHistory boolean recurse searchSubDirectories isSelected if fileset instanceof DirectoryListSet DirectoryListSet dset DirectoryListSet fileset if dset getDirectory equals directory dset getFileFilter equals filter dset isRecursive recurse fileset new DirectoryListSet directory filter recurse else fileset new DirectoryListSet directory filter recurse else fileset null jEdit setBooleanProperty keepDialog isSelected boolean ok true if fileset getFileCount GUIUtilities error this null ok false else SearchAndReplace setSearchFileSet fileset if find getText length find addCurrentToHistory SearchAndReplace setSearchString find getText replace addCurrentToHistory SearchAndReplace setReplaceString replace getText else ok false return ok private void closeOrKeepDialog if keepDialog isSelected if hyperSearch isSelected toFront requestFocus find requestFocus return else GUIUtilities saveGeometry this dispose class MyJRadioButton extends JRadioButton MyJRadioButton String label super label public boolean isFocusTraversable return false class ReplaceActionHandler implements ActionListener public void actionPerformed ActionEvent evt replace setModel beanShellReplace isSelected SearchAndReplace setBeanShellReplace beanShellReplace isSelected class SettingsActionHandler implements ActionListener public void actionPerformed ActionEvent evt Object source evt getSource if source ignoreCase SearchAndReplace setIgnoreCase ignoreCase isSelected else if source regexp SearchAndReplace setRegexp regexp isSelected else if source searchBack source searchForward SearchAndReplace setReverseSearch searchBack isSelected else if source wrap SearchAndReplace setAutoWrapAround wrap isSelected else if source searchCurrentBuffer hyperSearch setSelected false else if source searchSelection source searchAllBuffers source searchDirectory hyperSearch setSelected true updateEnabled class MultiFileActionHandler implements ActionListener public void actionPerformed ActionEvent evt if evt getSource choose File dir new File directory getText JFileChooser chooser new JFileChooser dir getParent chooser setFileSelectionMode JFileChooser DIRECTORIES_ONLY chooser setSelectedFile dir if chooser showOpenDialog SearchDialog this JFileChooser APPROVE_OPTION directory setText chooser getSelectedFile getPath ok class ButtonActionHandler implements ActionListener public void actionPerformed ActionEvent evt Object source evt getSource if source closeBtn cancel else if source findBtn source find source replace ok else if source replaceAndFindBtn save if SearchAndReplace replace view ok else getToolkit beep else if source replaceAllBtn setCursor Cursor getPredefinedCursor Cursor WAIT_CURSOR save if searchSelection isSelected if SearchAndReplace replace view closeOrKeepDialog else getToolkit beep else if SearchAndReplace replaceAll view closeOrKeepDialog else getToolkit beep setCursor Cursor getPredefinedCursor Cursor DEFAULT_CURSOR final class RETokenLookAhead extends REToken REToken re boolean negative RETokenLookAhead REToken re boolean negative throws REException super this re re this negative negative boolean match CharIndexed input REMatch mymatch REMatch trymatch REMatch mymatch clone REMatch trymatch1 REMatch mymatch clone REMatch newMatch null if re match input trymatch if negative return false if next input trymatch1 newMatch trymatch1 if newMatch null if negative return false mymatch assignFrom newMatch return true if negative return next input mymatch return false void dump StringBuffer os os append os append negative re dumpAll os os append public final class RESyntax implements Serializable static final String DEFAULT_LINE_SEPARATOR System getProperty private static final String SYNTAX_IS_FINAL RE getLocalizedMessage private BitSet bits private boolean isFinal false private String lineSeparator DEFAULT_LINE_SEPARATOR public static final int RE_BACKSLASH_ESCAPE_IN_LISTS public static final int RE_BK_PLUS_QM public static final int RE_CHAR_CLASSES public static final int RE_CONTEXT_INDEP_ANCHORS public static final int RE_CONTEXT_INDEP_OPS public static final int RE_CONTEXT_INVALID_OPS public static final int RE_DOT_NEWLINE public static final int RE_DOT_NOT_NULL public static final int RE_INTERVALS public static final int RE_LIMITED_OPS public static final int RE_NO_BK_BRACES public static final int RE_NO_BK_PARENS public static final int RE_NO_BK_REFS public static final int RE_NO_BK_VBAR public static final int RE_NO_EMPTY_RANGES public static final int RE_UNMATCHED_RIGHT_PAREN_ORD public static final int RE_HAT_LISTS_NOT_NEWLINE public static final int RE_STINGY_OPS public static final int RE_CHAR_CLASS_ESCAPES public static final int RE_PURE_GROUPING public static final int RE_LOOKAHEAD public static final int RE_STRING_ANCHORS public static final int RE_COMMENTS public static final int RE_CHAR_CLASS_ESC_IN_LISTS private static final int BIT_TOTAL public static final RESyntax RE_SYNTAX_AWK public static final RESyntax RE_SYNTAX_ED public static final RESyntax RE_SYNTAX_EGREP public static final RESyntax RE_SYNTAX_EMACS public static final RESyntax RE_SYNTAX_GREP public static final RESyntax RE_SYNTAX_POSIX_AWK public static final RESyntax RE_SYNTAX_POSIX_BASIC public static final RESyntax RE_SYNTAX_POSIX_EGREP public static final RESyntax RE_SYNTAX_POSIX_EXTENDED public static final RESyntax RE_SYNTAX_POSIX_MINIMAL_BASIC public static final RESyntax RE_SYNTAX_POSIX_MINIMAL_EXTENDED public static final RESyntax RE_SYNTAX_SED public static final RESyntax RE_SYNTAX_PERL4 public static final RESyntax RE_SYNTAX_PERL5 public static final RESyntax RE_SYNTAX_PERL5_S public static final RESyntax RE_SYNTAX_JAVA_1_4 static RE_SYNTAX_EMACS new RESyntax makeFinal RESyntax RE_SYNTAX_POSIX_COMMON new RESyntax set RE_CHAR_CLASSES set RE_DOT_NEWLINE set RE_DOT_NOT_NULL set RE_INTERVALS set RE_NO_EMPTY_RANGES makeFinal RE_SYNTAX_POSIX_BASIC new RESyntax RE_SYNTAX_POSIX_COMMON set RE_BK_PLUS_QM makeFinal RE_SYNTAX_POSIX_EXTENDED new RESyntax RE_SYNTAX_POSIX_COMMON set RE_CONTEXT_INDEP_ANCHORS set RE_CONTEXT_INDEP_OPS set RE_NO_BK_BRACES set RE_NO_BK_PARENS set RE_NO_BK_VBAR set RE_UNMATCHED_RIGHT_PAREN_ORD makeFinal RE_SYNTAX_AWK new RESyntax set RE_BACKSLASH_ESCAPE_IN_LISTS set RE_DOT_NOT_NULL set RE_NO_BK_PARENS set RE_NO_BK_REFS set RE_NO_BK_VBAR set RE_NO_EMPTY_RANGES set RE_UNMATCHED_RIGHT_PAREN_ORD makeFinal RE_SYNTAX_POSIX_AWK new RESyntax RE_SYNTAX_POSIX_EXTENDED set RE_BACKSLASH_ESCAPE_IN_LISTS makeFinal RE_SYNTAX_GREP new RESyntax set RE_BK_PLUS_QM set RE_CHAR_CLASSES set RE_HAT_LISTS_NOT_NEWLINE set RE_INTERVALS set RE_NEWLINE_ALT makeFinal RE_SYNTAX_EGREP new RESyntax set RE_CHAR_CLASSES set RE_CONTEXT_INDEP_ANCHORS set RE_CONTEXT_INDEP_OPS set RE_HAT_LISTS_NOT_NEWLINE set RE_NEWLINE_ALT set RE_NO_BK_PARENS set RE_NO_BK_VBAR makeFinal RE_SYNTAX_POSIX_EGREP new RESyntax RE_SYNTAX_EGREP set RE_INTERVALS set RE_NO_BK_BRACES makeFinal RE_SYNTAX_ED new RESyntax RE_SYNTAX_POSIX_BASIC makeFinal RE_SYNTAX_SED new RESyntax RE_SYNTAX_POSIX_BASIC makeFinal RE_SYNTAX_POSIX_MINIMAL_BASIC new RESyntax RE_SYNTAX_POSIX_COMMON set RE_LIMITED_OPS makeFinal RE_SYNTAX_POSIX_MINIMAL_EXTENDED new RESyntax RE_SYNTAX_POSIX_COMMON set RE_CONTEXT_INDEP_ANCHORS set RE_CONTEXT_INVALID_OPS set RE_NO_BK_BRACES set RE_NO_BK_PARENS set RE_NO_BK_REFS set RE_NO_BK_VBAR set RE_UNMATCHED_RIGHT_PAREN_ORD makeFinal RE_SYNTAX_PERL4 new RESyntax set RE_BACKSLASH_ESCAPE_IN_LISTS set RE_CONTEXT_INDEP_ANCHORS set RE_INTERVALS set RE_NO_BK_BRACES set RE_NO_BK_PARENS set RE_NO_BK_VBAR set RE_NO_EMPTY_RANGES makeFinal RE_SYNTAX_PERL4_S new RESyntax RE_SYNTAX_PERL4 set RE_DOT_NEWLINE makeFinal RE_SYNTAX_PERL5 new RESyntax RE_SYNTAX_PERL4 makeFinal RE_SYNTAX_PERL5_S new RESyntax RE_SYNTAX_PERL5 set RE_DOT_NEWLINE makeFinal RE_SYNTAX_JAVA_1_4 new RESyntax RE_SYNTAX_PERL5 makeFinal public RESyntax bits new BitSet BIT_TOTAL public RESyntax makeFinal isFinal true return this public RESyntax RESyntax other bits BitSet other bits clone public boolean get int index return bits get index public RESyntax set int index if isFinal throw new IllegalAccessError SYNTAX_IS_FINAL bits set index return this public RESyntax clear int index if isFinal throw new IllegalAccessError SYNTAX_IS_FINAL bits clear index return this public RESyntax setLineSeparator String aSeparator if isFinal throw new IllegalAccessError SYNTAX_IS_FINAL lineSeparator aSeparator return this public String getLineSeparator return lineSeparator public class AllBufferSet extends BufferListSet public AllBufferSet String glob this glob glob public String getFileFilter return glob public String getCode return MiscUtilities charsToEscapes glob private String glob protected String Buffer buffers jEdit getBuffers Vector vector new Vector buffers length RE filter try filter new RE MiscUtilities globToRE glob catch Exception Log log Log ERROR DirectoryListSet class return null for int buffers length Buffer buffer buffers if filter isMatch buffer getName vector addElement buffer getPath String retVal new String vector size vector copyInto retVal return retVal public class FoldVisibilityManager public FoldVisibilityManager Buffer buffer OffsetManager offsetMgr JEditTextArea textArea this buffer buffer this offsetMgr offsetMgr this textArea textArea public boolean isNarrowed return narrowed public int getVirtualLineCount return offsetMgr getVirtualLineCount index public final boolean isLineVisible int line if line line offsetMgr getLineCount throw new ArrayIndexOutOfBoundsException line try buffer readLock return offsetMgr isLineVisible line index finally buffer readUnlock public int getFirstVisibleLine try buffer readLock for int buffer getLineCount if offsetMgr isLineVisible index return finally buffer readUnlock return public int getLastVisibleLine try buffer readLock for int buffer getLineCount if offsetMgr isLineVisible index return finally buffer readUnlock return public int getNextVisibleLine int line if line line offsetMgr getLineCount throw new ArrayIndexOutOfBoundsException line try buffer readLock if line buffer getLineCount return for int line buffer getLineCount if offsetMgr isLineVisible index return return finally buffer readUnlock public int getPrevVisibleLine int line if line line offsetMgr getLineCount throw new ArrayIndexOutOfBoundsException line try buffer readLock if line return for int line if offsetMgr isLineVisible index return return finally buffer readUnlock public int physicalToVirtual int line try buffer readLock if line throw new ArrayIndexOutOfBoundsException line else if line offsetMgr getLineCount throw new ArrayIndexOutOfBoundsException line buffer getLineCount if getVirtualLineCount buffer getLineCount return line while offsetMgr isLineVisible line index line line if line offsetMgr isLineVisible line index return if lastPhysical line if lastVirtual lastVirtual offsetMgr getVirtualLineCount index throw new ArrayIndexOutOfBoundsException lastVirtual else if line lastPhysical lastPhysical for if lastPhysical line break if offsetMgr isLineVisible lastPhysical index lastVirtual if lastPhysical buffer getLineCount break else lastPhysical if lastVirtual lastVirtual offsetMgr getVirtualLineCount index throw new ArrayIndexOutOfBoundsException lastVirtual else if line lastPhysical lastPhysical line line for if lastPhysical line break if offsetMgr isLineVisible lastPhysical index lastVirtual if lastPhysical break else lastPhysical if lastVirtual lastVirtual offsetMgr getVirtualLineCount index throw new ArrayIndexOutOfBoundsException lastVirtual else lastPhysical while offsetMgr isLineVisible lastPhysical index lastPhysical lastVirtual for if lastPhysical line break if offsetMgr isLineVisible lastPhysical index lastVirtual if lastPhysical buffer getLineCount break else lastPhysical if lastVirtual lastVirtual offsetMgr getVirtualLineCount index throw new ArrayIndexOutOfBoundsException lastVirtual return lastVirtual finally buffer readUnlock public int virtualToPhysical int line try buffer readLock if line throw new ArrayIndexOutOfBoundsException line else if line offsetMgr getVirtualLineCount index throw new ArrayIndexOutOfBoundsException line offsetMgr getVirtualLineCount index if getVirtualLineCount buffer getLineCount return line if lastVirtual line if lastPhysical lastPhysical buffer getLineCount throw new ArrayIndexOutOfBoundsException lastPhysical else if line lastVirtual lastVirtual for if offsetMgr isLineVisible lastPhysical index if lastVirtual line break else lastVirtual if lastPhysical buffer getLineCount break else lastPhysical if lastPhysical lastPhysical buffer getLineCount throw new ArrayIndexOutOfBoundsException lastPhysical else if line lastVirtual lastVirtual line line for if offsetMgr isLineVisible lastPhysical index if lastVirtual line break else lastVirtual if lastPhysical break else lastPhysical if lastPhysical lastPhysical buffer getLineCount throw new ArrayIndexOutOfBoundsException lastPhysical else lastPhysical while offsetMgr isLineVisible lastPhysical index lastPhysical lastVirtual for if offsetMgr isLineVisible lastPhysical index if lastVirtual line break else lastVirtual if lastPhysical buffer getLineCount break else lastPhysical if lastPhysical lastPhysical buffer getLineCount throw new ArrayIndexOutOfBoundsException lastPhysical return lastPhysical finally buffer readUnlock public void collapseFold int line int lineCount buffer getLineCount int start int end lineCount try buffer writeLock if line line buffer getLineCount buffer isFoldStart line offsetMgr isLineVisible line index line int initialFoldLevel buffer getFoldLevel line if line lineCount buffer getFoldLevel line initialFoldLevel start line for int line lineCount if buffer getFoldLevel initialFoldLevel end break else boolean ok false for int line if buffer getFoldLevel initialFoldLevel start ok true break if ok return for int line lineCount if buffer getFoldLevel initialFoldLevel end break int delta end start for int start end if offsetMgr isLineVisible index offsetMgr setLineVisible index false else delta if delta return offsetMgr setVirtualLineCount index offsetMgr getVirtualLineCount index delta finally buffer writeUnlock foldStructureChanged int virtualLine physicalToVirtual start if textArea getFirstLine virtualLine textArea setFirstLine virtualLine textArea getElectricScroll public int expandFold int line boolean fully int returnValue int lineCount buffer getLineCount int start int end lineCount int delta try buffer writeLock int initialFoldLevel buffer getFoldLevel line if line lineCount offsetMgr isLineVisible line index offsetMgr isLineVisible line index buffer getFoldLevel line initialFoldLevel start line for int line lineCount buffer getFoldLevel initialFoldLevel end break else boolean ok false for int line if offsetMgr isLineVisible index buffer getFoldLevel initialFoldLevel start ok true break if ok return for int line lineCount if offsetMgr isLineVisible index buffer getFoldLevel initialFoldLevel getLastVisibleLine end break initialFoldLevel buffer getFoldLevel start for int start end buffer getFoldLevel for int start end if buffer getFoldLevel initialFoldLevel if returnValue buffer isFoldStart returnValue if offsetMgr isLineVisible index fully delta offsetMgr setLineVisible index true else if offsetMgr isLineVisible index delta offsetMgr setLineVisible index true offsetMgr setVirtualLineCount index offsetMgr getVirtualLineCount index delta if fully offsetMgr isLineVisible line index expandFold line false return returnValue finally buffer writeUnlock foldStructureChanged int virtualLine physicalToVirtual start int firstLine textArea getFirstLine int visibleLines textArea getVisibleLines if virtualLine delta firstLine visibleLines delta visibleLines textArea setFirstLine virtualLine delta visibleLines return returnValue public void expandAllFolds try buffer writeLock narrowed false if offsetMgr getVirtualLineCount index buffer getLineCount return offsetMgr setVirtualLineCount index buffer getLineCount for int buffer getLineCount offsetMgr setLineVisible index true foldStructureChanged finally buffer writeUnlock public void expandFolds char digit if digit digit Toolkit getDefaultToolkit beep return else expandFolds int digit public void expandFolds int foldLevel try buffer writeLock narrowed false offsetMgr setVirtualLineCount index buffer getLineCount int newVirtualLineCount foldLevel foldLevel buffer getIndentSize boolean seenVisibleLine false for int buffer getLineCount if seenVisibleLine buffer getFoldLevel foldLevel seenVisibleLine true offsetMgr setLineVisible index true newVirtualLineCount else offsetMgr setLineVisible index false offsetMgr setVirtualLineCount index newVirtualLineCount finally buffer writeUnlock foldStructureChanged public void narrow int start int end if start end start end offsetMgr getLineCount throw new ArrayIndexOutOfBoundsException start end if start offsetMgr getLineCount offsetMgr isLineVisible start index expandFold start false int virtualLineCount offsetMgr getVirtualLineCount index for int start if offsetMgr isLineVisible index virtualLineCount offsetMgr setLineVisible index false for int end buffer getLineCount if offsetMgr isLineVisible index virtualLineCount offsetMgr setLineVisible index false offsetMgr setVirtualLineCount index virtualLineCount narrowed true foldStructureChanged GUIUtilities getView textArea getStatus setMessageAndClear jEdit getProperty public final void int index this index index lastPhysical lastVirtual public final void index public final int return index public void int startLine if lastPhysical startLine lastPhysical lastVirtual public void foldStructureChanged lastPhysical lastVirtual textArea foldStructureChanged private Buffer buffer private OffsetManager offsetMgr private JEditTextArea textArea private int index private int lastPhysical private int lastVirtual private boolean narrowed class ReturnControl implements ParserConstants public int kind public Object value public ReturnControl int kind Object value this kind kind this value value public class BufferSwitcher extends JComboBox public BufferSwitcher EditPane editPane this editPane editPane setRenderer new BufferCellRenderer setMaximumRowCount addActionListener new ActionHandler public void updateBufferList if jEdit getBufferCount return updating true setModel new DefaultComboBoxModel jEdit getBuffers setSelectedItem editPane getBuffer updating false private EditPane editPane private boolean updating class ActionHandler implements ActionListener public void actionPerformed ActionEvent evt if updating Buffer buffer Buffer getSelectedItem if buffer null editPane setBuffer buffer class BufferCellRenderer extends DefaultListCellRenderer public Component getListCellRendererComponent JList list Object value int index boolean isSelected boolean cellHasFocus super getListCellRendererComponent list value index isSelected cellHasFocus Buffer buffer Buffer value if buffer null setIcon null else setIcon buffer getIcon return this public class OffsetManager public OffsetManager Buffer buffer this buffer buffer lineInfo new long lineInfo VISIBLE_SHIFT lineContext new TokenMarker LineContext lineCount positions new PosBottomHalf virtualLineCounts new int for int virtualLineCounts public final int getLineCount return lineCount public final int getVirtualLineCount int index return virtualLineCounts index public final void setVirtualLineCount int index int lineCount virtualLineCounts index lineCount public int getLineOfOffset int offset int start int end lineCount for switch end start case if getLineEndOffset start offset return start else return start case if getLineEndOffset start offset if getLineEndOffset end offset return end else return end else return start default int pivot end start int value getLineEndOffset pivot if value offset return pivot else if value offset start pivot else end pivot break public final int getLineEndOffset int line return int lineInfo line END_MASK public final boolean isFoldLevelValid int line return lineInfo line FOLD_LEVEL_VALID_MASK public final int getFoldLevel int line return int lineInfo line FOLD_LEVEL_MASK FOLD_LEVEL_SHIFT public final void setFoldLevel int line int level lineInfo line lineInfo line FOLD_LEVEL_MASK long level FOLD_LEVEL_SHIFT FOLD_LEVEL_VALID_MASK public final boolean isLineVisible int line int index long mask index VISIBLE_SHIFT return lineInfo line mask public final void setLineVisible int line int index boolean visible long mask index VISIBLE_SHIFT if visible lineInfo line lineInfo line mask else lineInfo line lineInfo line mask public final int getScreenLineCount int line return int lineInfo line SCREEN_LINES_MASK SCREEN_LINES_SHIFT public final void setScreenLineCount int line int count lineInfo line lineInfo line SCREEN_LINES_MASK long count SCREEN_LINES_SHIFT public final boolean isLineContextValid int line return lineInfo line CONTEXT_VALID_MASK public final TokenMarker LineContext getLineContext int line return lineContext line public final void setLineContext int line TokenMarker LineContext context lineContext line context lineInfo line CONTEXT_VALID_MASK public synchronized Position createPosition int offset PosBottomHalf bh null for int positionCount PosBottomHalf positions if offset offset bh break else if offset offset bh new PosBottomHalf offset growPositionArray System arraycopy positions positions positionCount positionCount positions bh break if bh null bh new PosBottomHalf offset growPositionArray positions positionCount bh return new PosTopHalf bh public void expandFolds int foldLevel int newVirtualLineCount if foldLevel newVirtualLineCount lineCount else foldLevel foldLevel buffer getIndentSize boolean seenVisibleLine false for int lineCount if seenVisibleLine buffer getFoldLevel foldLevel seenVisibleLine true lineInfo VISIBLE_MASK newVirtualLineCount else lineInfo VISIBLE_MASK for int virtualLineCounts length virtualLineCounts newVirtualLineCount public void contentInserted int startLine int offset int numLines int length IntegerArray endOffsets int endLine startLine numLines if numLines lineCount numLines if lineInfo length lineCount long lineInfoN new long lineCount System arraycopy lineInfo lineInfoN lineInfo length lineInfo lineInfoN TokenMarker LineContext lineContextN new TokenMarker LineContext lineCount System arraycopy lineContext lineContextN lineContext length lineContext lineContextN System arraycopy lineInfo startLine lineInfo endLine lineCount endLine System arraycopy lineContext startLine lineContext endLine lineCount endLine int foldLevel buffer getFoldLevel startLine long visible VISIBLE_SHIFT if startLine for int startLine visible lineInfo VISIBLE_MASK break for int numLines lineInfo startLine offset endOffsets get FOLD_LEVEL_VALID_MASK CONTEXT_VALID_MASK visible if visible VISIBLE_SHIFT virtualLineCounts numLines if visible VISIBLE_SHIFT virtualLineCounts numLines if visible VISIBLE_SHIFT virtualLineCounts numLines if visible VISIBLE_SHIFT virtualLineCounts numLines if visible VISIBLE_SHIFT virtualLineCounts numLines if visible VISIBLE_SHIFT virtualLineCounts numLines if visible VISIBLE_SHIFT virtualLineCounts numLines if visible VISIBLE_SHIFT virtualLineCounts numLines for int endLine lineCount setLineEndOffset getLineEndOffset length updatePositionsForInsert offset length public void contentRemoved int startLine int offset int numLines int length for int numLines long info lineInfo startLine if info VISIBLE_SHIFT virtualLineCounts if info VISIBLE_SHIFT virtualLineCounts if info VISIBLE_SHIFT virtualLineCounts if info VISIBLE_SHIFT virtualLineCounts if info VISIBLE_SHIFT virtualLineCounts if info VISIBLE_SHIFT virtualLineCounts if info VISIBLE_SHIFT virtualLineCounts if info VISIBLE_SHIFT virtualLineCounts if numLines lineCount numLines System arraycopy lineInfo startLine numLines lineInfo startLine lineCount startLine System arraycopy lineContext startLine numLines lineContext startLine lineCount startLine for int startLine lineCount setLineEndOffset getLineEndOffset length updatePositionsForRemove offset length public void lineInfoChangedFrom int startLine for int startLine lineCount lineInfo FOLD_LEVEL_VALID_MASK CONTEXT_VALID_MASK lineContext null private static final long END_MASK private static final long FOLD_LEVEL_MASK private static final int FOLD_LEVEL_SHIFT private static final long VISIBLE_MASK private static final int VISIBLE_SHIFT private static final long FOLD_LEVEL_VALID_MASK private static final long CONTEXT_VALID_MASK private static final long SCREEN_LINES_MASK private static final long SCREEN_LINES_SHIFT private Buffer buffer private long lineInfo private TokenMarker LineContext lineContext private int lineCount private PosBottomHalf positions private int positionCount private int virtualLineCounts private final void setLineEndOffset int line int end lineInfo line lineInfo line END_MASK FOLD_LEVEL_VALID_MASK CONTEXT_VALID_MASK end private void growPositionArray if positions length positionCount PosBottomHalf newPositions new PosBottomHalf positionCount System arraycopy positions newPositions positionCount positions newPositions private synchronized void removePosition PosBottomHalf bh int index for int positionCount if positions bh index break System arraycopy positions index positions index positionCount index positions positionCount null private void updatePositionsForInsert int offset int length if positionCount return int start getPositionAtOffset offset for int start positionCount PosBottomHalf bh positions if bh offset offset Log log Log ERROR this bh offset else bh offset length private void updatePositionsForRemove int offset int length if positionCount return int start getPositionAtOffset offset for int start positionCount PosBottomHalf bh positions if bh offset offset Log log Log ERROR this bh offset else if bh offset offset length bh offset offset else bh offset length private int getPositionAtOffset int offset int start int end positionCount PosBottomHalf bh loop for switch end start case bh positions start if bh offset offset start break loop case bh positions end if bh offset offset start end else bh positions start if bh offset offset start break loop default int pivot start end bh positions pivot if bh offset offset end pivot else start pivot break return start static class PosTopHalf implements Position PosBottomHalf bh PosTopHalf PosBottomHalf bh this bh bh bh ref public int getOffset return bh offset public void finalize bh unref class PosBottomHalf int offset int ref PosBottomHalf int offset this offset offset void ref ref void unref if ref removePosition this public class FirewallOptionPane extends AbstractOptionPane public FirewallOptionPane super public void addComponent cEnabled new JCheckBox jEdit getProperty addComponent jEdit getProperty tHost new JTextField jEdit getProperty addComponent jEdit getProperty tPort new JTextField jEdit getProperty addComponent jEdit getProperty tUser new JTextField jEdit getProperty addComponent jEdit getProperty tPass new JPasswordField jEdit getProperty addComponent jEdit getProperty tNonProxy new JTextField jEdit getProperty boolean enabled jEdit getBooleanProperty cEnabled setSelected enabled tHost setEnabled enabled tPort setEnabled enabled tUser setEnabled enabled tPass setEnabled enabled tNonProxy setEnabled enabled cEnabled addActionListener new ActionListener public void actionPerformed ActionEvent boolean enbld cEnabled isSelected cEnabled setSelected enbld tHost setEnabled enbld tPort setEnabled enbld tUser setEnabled enbld tPass setEnabled enbld tNonProxy setEnabled enbld public void jEdit setBooleanProperty cEnabled isSelected jEdit setProperty tHost getText jEdit setProperty tPort getText jEdit setProperty tUser getText jEdit setProperty new String tPass getPassword jEdit setProperty tNonProxy getText private JCheckBox cEnabled private JTextField tHost private JTextField tPort private JTextField tUser private JPasswordField tPass private JTextField tNonProxy public class View extends JFrame implements EBComponent public static final int TOP_GROUP public static final int BOTTOM_GROUP public static final int DEFAULT_GROUP TOP_GROUP public static final int TOP_LAYER Integer MAX_VALUE public static final int DEFAULT_LAYER public static final int BOTTOM_LAYER Integer MIN_VALUE public static final int ABOVE_SYSTEM_BAR_LAYER public static final int SYSTEM_BAR_LAYER public static final int SEARCH_BAR_LAYER public static final int BELOW_SEARCH_BAR_LAYER public static final int ABOVE_STATUS_BAR_LAYER public static final int STATUS_BAR_LAYER public static final int BELOW_STATUS_BAR_LAYER public DockableWindowManager getDockableWindowManager return dockableWindowManager public JToolBar getToolBar return toolBar public void addToolBar Component toolBar addToolBar DEFAULT_GROUP DEFAULT_LAYER toolBar public void addToolBar int group Component toolBar addToolBar group DEFAULT_LAYER toolBar public void addToolBar int group int layer Component toolBar toolBarManager addToolBar group layer toolBar getRootPane revalidate public void removeToolBar Component toolBar toolBarManager removeToolBar toolBar getRootPane revalidate public synchronized void showWaitCursor if waitCount Cursor cursor Cursor getPredefinedCursor Cursor WAIT_CURSOR setCursor cursor EditPane editPanes getEditPanes for int editPanes length EditPane editPane editPanes editPane getTextArea getPainter setCursor cursor public synchronized void hideWaitCursor if waitCount waitCount if waitCount Cursor cursor Cursor getPredefinedCursor Cursor DEFAULT_CURSOR setCursor cursor cursor Cursor getPredefinedCursor Cursor TEXT_CURSOR EditPane editPanes getEditPanes for int editPanes length EditPane editPane editPanes editPane getTextArea getPainter setCursor cursor public final SearchBar getSearchBar return searchBar public StatusBar getStatus return status public KeyListener getKeyEventInterceptor return keyEventInterceptor public void setKeyEventInterceptor KeyListener listener this keyEventInterceptor listener public InputHandler getInputHandler return inputHandler public void setInputHandler InputHandler inputHandler this inputHandler inputHandler public Macros Recorder getMacroRecorder return recorder public void setMacroRecorder Macros Recorder recorder this recorder recorder public void processKeyEvent KeyEvent evt if isClosed return if getFocusOwner instanceof JComponent JComponent comp JComponent getFocusOwner InputMap map comp getInputMap ActionMap am comp getActionMap if map null am null comp isEnabled Object binding map get KeyStroke getKeyStrokeForEvent evt if binding null am get binding null return if getFocusOwner instanceof JTextComponent if evt getID KeyEvent KEY_PRESSED switch evt getKeyCode case KeyEvent VK_BACK_SPACE case KeyEvent VK_TAB case KeyEvent VK_ENTER return Keymap keymap JTextComponent getFocusOwner getKeymap if keymap getAction KeyStroke getKeyStrokeForEvent evt null return if evt isConsumed return evt KeyEventWorkaround processKeyEvent evt if evt null return switch evt getID case KeyEvent KEY_TYPED if keyEventInterceptor null else if inputHandler isPrefixActive getTextArea hasFocus inputHandler keyTyped evt break case KeyEvent KEY_PRESSED if keyEventInterceptor null keyEventInterceptor keyPressed evt else inputHandler keyPressed evt break case KeyEvent KEY_RELEASED if keyEventInterceptor null keyEventInterceptor keyReleased evt else inputHandler keyReleased evt break if evt isConsumed super processKeyEvent evt public void splitHorizontally split JSplitPane VERTICAL_SPLIT public void splitVertically split JSplitPane HORIZONTAL_SPLIT public void split int orientation editPane saveCaretInfo EditPane oldEditPane editPane setEditPane createEditPane oldEditPane getBuffer editPane loadCaretInfo JComponent oldParent JComponent oldEditPane getParent if oldParent instanceof JSplitPane JSplitPane oldSplitPane JSplitPane oldParent int dividerPos oldSplitPane getDividerLocation Component left oldSplitPane getLeftComponent final JSplitPane newSplitPane new JSplitPane orientation oldEditPane editPane if left oldEditPane oldSplitPane setLeftComponent newSplitPane else oldSplitPane setRightComponent newSplitPane oldSplitPane setDividerLocation dividerPos SwingUtilities invokeLater new Runnable public void run newSplitPane setDividerLocation editPane focusOnTextArea else JSplitPane newSplitPane splitPane new JSplitPane orientation oldEditPane editPane newSplitPane setBorder null oldParent add splitPane oldParent revalidate Dimension size if oldParent instanceof JSplitPane size oldParent getSize else size oldEditPane getSize newSplitPane setDividerLocation orientation JSplitPane VERTICAL_SPLIT size height size width SwingUtilities invokeLater new Runnable public void run editPane focusOnTextArea public void unsplit if splitPane null EditPane editPanes getEditPanes for int editPanes length EditPane editPanes if editPane close JComponent parent JComponent splitPane getParent parent remove splitPane parent add editPane parent revalidate splitPane null updateTitle SwingUtilities invokeLater new Runnable public void run editPane focusOnTextArea public void nextTextArea EditPane editPanes getEditPanes for int editPanes length if editPane editPanes if editPanes length editPanes focusOnTextArea else editPanes focusOnTextArea break public void prevTextArea EditPane editPanes getEditPanes for int editPanes length if editPane editPanes if editPanes editPanes length focusOnTextArea else editPanes focusOnTextArea break public JSplitPane getSplitPane return splitPane public Buffer getBuffer return editPane getBuffer public void setBuffer Buffer buffer editPane setBuffer buffer public JEditTextArea getTextArea return editPane getTextArea public EditPane getEditPane return editPane public EditPane getEditPanes if splitPane null EditPane ep editPane return ep else Vector vec new Vector getEditPanes vec splitPane EditPane ep new EditPane vec size vec copyInto ep return ep public String getSplitConfig StringBuffer splitConfig new StringBuffer splitConfig append getBuffer getPath return splitConfig toString public void updateGutterBorders EditPane editPanes getEditPanes for int editPanes length editPanes getTextArea getGutter updateBorder public boolean isSynchroScrollEnabled return synchroScroll public void toggleSynchroScrollEnabled setSynchroScrollEnabled synchroScroll public void setSynchroScrollEnabled boolean synchroScroll this synchroScroll synchroScroll JEditTextArea textArea getTextArea int firstLine textArea getFirstLine int horizontalOffset textArea getHorizontalOffset synchroScrollVertical textArea firstLine synchroScrollHorizontal textArea horizontalOffset public void synchroScrollVertical JEditTextArea textArea int firstLine if synchroScroll return EditPane editPanes getEditPanes for int editPanes length if editPanes getTextArea textArea editPanes getTextArea firstLine public void synchroScrollHorizontal JEditTextArea textArea int horizontalOffset if synchroScroll return EditPane editPanes getEditPanes for int editPanes length if editPanes getTextArea textArea editPanes getTextArea horizontalOffset public void quickIncrementalSearch boolean word if searchBar null getToolkit beep return JEditTextArea textArea getTextArea String text textArea getSelectedText if text null word textArea selectWord text textArea getSelectedText else if text null text indexOf text null searchBar setHyperSearch false searchBar getField setText text searchBar getField requestFocus searchBar getField selectAll public void quickHyperSearch boolean word JEditTextArea textArea getTextArea String text textArea getSelectedText if text null word textArea selectWord text textArea getSelectedText if text null text indexOf HistoryModel getModel addItem text SearchAndReplace setSearchString text SearchAndReplace setSearchFileSet new CurrentBufferSet SearchAndReplace hyperSearch this else if searchBar null getToolkit beep return searchBar setHyperSearch true searchBar getField setText null searchBar getField requestFocus searchBar getField selectAll public boolean isClosed return closed public View getNext return next public View getPrev return prev public void handleMessage EBMessage msg if msg instanceof PropertiesChanged propertiesChanged else if msg instanceof SearchSettingsChanged if searchBar null searchBar update else if msg instanceof BufferUpdate handleBufferUpdate BufferUpdate msg else if msg instanceof EditPaneUpdate handleEditPaneUpdate EditPaneUpdate msg else if msg instanceof MultiSelectStatusChanged status updateMiscStatus View prev View next View Buffer buffer String splitConfig enableEvents AWTEvent KEY_EVENT_MASK setIconImage GUIUtilities getEditorIcon dockableWindowManager new DockableWindowManager this JPanel topToolBars new JPanel new VariableGridLayout VariableGridLayout FIXED_NUM_COLUMNS JPanel bottomToolBars new JPanel new VariableGridLayout VariableGridLayout FIXED_NUM_COLUMNS toolBarManager new ToolBarManager topToolBars bottomToolBars getContentPane add BorderLayout NORTH topToolBars getContentPane add BorderLayout CENTER dockableWindowManager getContentPane add BorderLayout SOUTH bottomToolBars status new StatusBar this addToolBar BOTTOM_GROUP STATUS_BAR_LAYER status setJMenuBar GUIUtilities loadMenuBar inputHandler new DefaultInputHandler this DefaultInputHandler jEdit getInputHandler Component comp restoreSplitConfig buffer splitConfig dockableWindowManager add comp status updateBufferStatus status updateMiscStatus EditBus addToBus this propertiesChanged setDefaultCloseOperation DO_NOTHING_ON_CLOSE addWindowListener new WindowHandler dockableWindowManager init void close closed true dockableWindowManager close GUIUtilities saveGeometry this EditBus removeFromBus this dispose EditPane editPanes getEditPanes for int editPanes length editPanes close toolBarManager null toolBar null searchBar null splitPane null inputHandler null recorder null setContentPane new JPanel void updateTitle Vector buffers new Vector EditPane editPanes getEditPanes for int editPanes length Buffer buffer editPanes getBuffer if buffers indexOf buffer buffers addElement buffer StringBuffer title new StringBuffer jEdit getProperty for int buffers size if title append Buffer buffer Buffer buffers elementAt title append showFullPath buffer isNewFile buffer getPath buffer getName setTitle title toString private boolean closed private DockableWindowManager dockableWindowManager private ToolBarManager toolBarManager private JToolBar toolBar private SearchBar searchBar private boolean synchroScroll private EditPane editPane private JSplitPane splitPane private StatusBar status private KeyListener keyEventInterceptor private InputHandler inputHandler private Macros Recorder recorder private int waitCount private boolean showFullPath private void getEditPanes Vector vec Component comp if comp instanceof EditPane vec addElement comp else if comp instanceof JSplitPane JSplitPane split JSplitPane comp getEditPanes vec split getLeftComponent getEditPanes vec split getRightComponent private void getSplitConfig JSplitPane splitPane StringBuffer splitConfig Component left splitPane getLeftComponent if left instanceof JSplitPane getSplitConfig JSplitPane left splitConfig else splitConfig append splitConfig append EditPane left getBuffer getPath Component right splitPane getRightComponent if right instanceof JSplitPane getSplitConfig JSplitPane right splitConfig else splitConfig append splitConfig append EditPane right getBuffer getPath splitConfig append splitPane getOrientation JSplitPane VERTICAL_SPLIT private Component restoreSplitConfig Buffer buffer String splitConfig if buffer null return editPane createEditPane buffer else if splitConfig null return editPane createEditPane jEdit getFirstBuffer Stack stack new Stack StringTokenizer st new StringTokenizer splitConfig while st hasMoreTokens String token st nextToken if token equals stack push splitPane new JSplitPane JSplitPane VERTICAL_SPLIT Component stack pop Component stack pop splitPane setBorder null splitPane setDividerLocation else if token equals stack push splitPane new JSplitPane JSplitPane HORIZONTAL_SPLIT Component stack pop Component stack pop splitPane setBorder null splitPane setDividerLocation else buffer jEdit getBuffer token if buffer null buffer jEdit getFirstBuffer stack push editPane createEditPane buffer return Component stack peek private void propertiesChanged loadToolBars showFullPath jEdit getBooleanProperty updateTitle dockableWindowManager propertiesChanged SwingUtilities updateComponentTreeUI getRootPane private void loadToolBars if jEdit getBooleanProperty if toolBar null toolBarManager removeToolBar toolBar toolBar GUIUtilities loadToolBar addToolBar TOP_GROUP SYSTEM_BAR_LAYER toolBar else if toolBar null removeToolBar toolBar toolBar null if jEdit getBooleanProperty if searchBar null searchBar new SearchBar this addToolBar TOP_GROUP SEARCH_BAR_LAYER searchBar else if searchBar null removeToolBar searchBar searchBar null private EditPane createEditPane Buffer buffer EditPane editPane new EditPane this buffer JEditTextArea textArea editPane getTextArea textArea addFocusListener new FocusHandler textArea addCaretListener new CaretHandler textArea addScrollListener new ScrollHandler EditBus send new EditPaneUpdate editPane EditPaneUpdate CREATED return editPane private void setEditPane EditPane editPane this editPane editPane status repaintCaretStatus status updateBufferStatus status updateMiscStatus private void handleBufferUpdate BufferUpdate msg Buffer buffer msg getBuffer if msg getWhat BufferUpdate DIRTY_CHANGED if buffer isDirty EditPane editPanes getEditPanes for int editPanes length if editPanes getBuffer buffer updateTitle break private void handleEditPaneUpdate EditPaneUpdate msg if msg getEditPane getView this msg getWhat EditPaneUpdate BUFFER_CHANGED status repaintCaretStatus status updateBufferStatus status updateMiscStatus class CaretHandler implements CaretListener public void caretUpdate CaretEvent evt status repaintCaretStatus status updateMiscStatus class FocusHandler extends FocusAdapter public void focusGained FocusEvent evt Component comp Component evt getSource while comp instanceof EditPane if comp null return comp comp getParent setEditPane EditPane comp class ScrollHandler implements ScrollListener public void scrolledVertically JEditTextArea textArea if getTextArea textArea status repaintCaretStatus public void scrolledHorizontally JEditTextArea textArea class WindowHandler extends WindowAdapter public void windowActivated WindowEvent evt final Vector buffers new Vector EditPane editPanes getEditPanes for int editPanes length Buffer buffer EditPane editPanes getBuffer if buffers contains buffer continue else buffers addElement buffer SwingUtilities invokeLater new Runnable public void run for int buffers size Buffer buffers elementAt checkModTime View this public void windowClosing WindowEvent evt jEdit closeView View this public abstract class VFS public static final int READ_CAP public static final int WRITE_CAP public static final int BROWSE_CAP public static final int DELETE_CAP public static final int RENAME_CAP public static final int MKDIR_CAP public VFS String name this name name public VFS String name int caps this name name this caps caps public String getName return name public int getCapabilities return caps public String showBrowseDialog Object session Component comp return null public String getFileName String path if path equals return path int count Math max path length int index Math max path lastIndexOf count path lastIndexOf File separatorChar count if index index path indexOf if index index path length return path return path substring index public String getParentOfPath String path int count Math max path length int index path lastIndexOf File separatorChar count if index index path lastIndexOf count if index index path lastIndexOf return path substring index public String constructPath String parent String path return parent path public char getFileSeparator return public Object createVFSSession String path Component comp return new Object public boolean load View view Buffer buffer String path if getCapabilities READ_CAP VFSManager error view path new String name return false Object session createVFSSession path view if session null return false if getCapabilities WRITE_CAP buffer setReadOnly true BufferIORequest request new BufferIORequest BufferIORequest LOAD view buffer session this path if buffer isTemporary request run else VFSManager runInWorkThread request return true public boolean save View view Buffer buffer String path if getCapabilities WRITE_CAP VFSManager error view path new String name return false Object session createVFSSession path view if session null return false if path equals buffer getPath buffer unsetProperty Buffer BACKED_UP VFSManager runInWorkThread new BufferIORequest BufferIORequest SAVE view buffer session this path return true public boolean insert View view Buffer buffer String path if getCapabilities READ_CAP VFSManager error view path new String name return false Object session createVFSSession path view if session null return false VFSManager runInWorkThread new BufferIORequest BufferIORequest INSERT view buffer session this path return true public String Object session String path Component comp throws IOException return path public DirectoryEntry Object session String directory Component comp throws IOException VFSManager error comp directory new String name return null public DirectoryEntry Object session String path Component comp throws IOException return null public static class DirectoryEntry implements Serializable public static final int FILE public static final int DIRECTORY public static final int FILESYSTEM public String name public String path public String deletePath public int type public long length public boolean hidden public DirectoryEntry String name String path String deletePath int type long length boolean hidden this name name this path path this deletePath deletePath this type type this length length this hidden hidden protected boolean colorCalculated protected Color color public Color getColor if colorCalculated colorCalculated true color getDefaultColorFor name return color public String toString return name public boolean Object session String path Component comp throws IOException return false public boolean Object session String from String to Component comp throws IOException return false public boolean Object session String directory Component comp throws IOException return false public void Object session String path Component comp throws IOException public InputStream Object session String path boolean ignoreErrors Component comp throws IOException VFSManager error comp path new String name return null public OutputStream Object session String path Component comp throws IOException VFSManager error comp path new String name return null public void Object session Buffer buffer Component comp public void Object session Component comp throws IOException public static Color getDefaultColorFor String name synchronized lock if colors null loadColors for int colors size ColorEntry entry ColorEntry colors elementAt if entry re isMatch name return entry color return null private String name private int caps private static Vector colors private static Object lock new Object static EditBus addToBus new EBComponent public void handleMessage EBMessage msg if msg instanceof PropertiesChanged synchronized lock colors null private static void loadColors synchronized lock colors new Vector if jEdit getBooleanProperty return try String glob int while glob jEdit getProperty null colors addElement new ColorEntry new RE MiscUtilities globToRE glob jEdit getColorProperty Color black catch REException Log log Log ERROR VFS class Log log Log ERROR VFS class static class ColorEntry RE re Color color ColorEntry RE re Color color this re re this color color public class JEditMetalTheme extends DefaultMetalTheme public String getName return public ColorUIResource getSystemTextColor return getBlack public FontUIResource getControlTextFont return primaryFont public FontUIResource getSystemTextFont return secondaryFont public FontUIResource getUserTextFont return secondaryFont public FontUIResource getMenuTextFont return primaryFont public void propertiesChanged primaryFont new FontUIResource jEdit getFontProperty super getControlTextFont secondaryFont new FontUIResource jEdit getFontProperty super getSystemTextFont private FontUIResource primaryFont private FontUIResource secondaryFont public abstract class BufferChangeAdapter implements BufferChangeListener public void foldLevelChanged Buffer buffer int start int end public void contentInserted Buffer buffer int startLine int offset int numLines int length public void contentRemoved Buffer buffer int startLine int offset int numLines int length public void transactionComplete Buffer buffer final class RETokenEndSub extends REToken RETokenEndSub int subIndex super subIndex boolean match CharIndexed input REMatch mymatch mymatch end subIndex mymatch index return next input mymatch void dump StringBuffer os final class RETokenRange extends REToken private char lo hi private boolean insens RETokenRange int subIndex char lo char hi boolean ins super subIndex this lo insens ins Character toLowerCase lo lo this hi ins Character toLowerCase hi hi int getMinimumLength return boolean match CharIndexed input REMatch mymatch char input charAt mymatch index if CharIndexed OUT_OF_BOUNDS return false if insens Character toLowerCase if lo hi mymatch index return next input mymatch return false void dump StringBuffer os os append lo append append hi public class VFSManager public static void init int count jEdit getIntegerProperty ioThreadPool new WorkThreadPool count registerVFS FavoritesVFS PROTOCOL new FavoritesVFS if OperatingSystem isDOSDerived registerVFS FileRootsVFS PROTOCOL new FileRootsVFS public static void start ioThreadPool start public static VFS getFileVFS return fileVFS public static VFS getUrlVFS return urlVFS public static VFS getVFSByName String name return VFS vfsHash get name public static VFS getVFSForProtocol String protocol if protocol equals return fileVFS else VFS vfs VFS protocolHash get protocol if vfs null return vfs else return urlVFS public static VFS getVFSForPath String path if MiscUtilities isURL path return getVFSForProtocol MiscUtilities getProtocolOfURL path else return fileVFS public static void registerVFS String protocol VFS vfs Log log Log DEBUG VFSManager class vfs getName protocol vfsHash put vfs getName vfs protocolHash put protocol vfs public static Enumeration getFilesystems return vfsHash elements public static WorkThreadPool getIOThreadPool return ioThreadPool public static void waitForRequests ioThreadPool waitForRequests public static boolean errorOccurred return error public static int getRequestCount return ioThreadPool getRequestCount public static void runInAWTThread Runnable run ioThreadPool addWorkRequest run true public static void runInWorkThread Runnable run ioThreadPool addWorkRequest run false public static void error final Component comp final String error final Object args if SwingUtilities isEventDispatchThread GUIUtilities error comp error args return VFSManager error true runInAWTThread new Runnable public void run VFSManager error false if comp null comp isShowing GUIUtilities error null error args else GUIUtilities error comp error args public static void error Component comp final String path String messageProp Object args final Frame frame JOptionPane getFrameForComponent comp synchronized errorLock error true errors addElement new ErrorListDialog ErrorEntry path messageProp args if errors size final String caption jEdit getProperty errors size new Integer new Integer errors size VFSManager runInAWTThread new Runnable public void run new ErrorListDialog frame isShowing frame jEdit getFirstView jEdit getProperty caption errors false errors removeAllElements error false public static void sendVFSUpdate VFS vfs String path boolean parent if parent sendVFSUpdate vfs vfs getParentOfPath path false sendVFSUpdate vfs path false else if path length path endsWith path endsWith java io File separator path path substring path length synchronized vfsUpdateLock for int vfsUpdates size VFSUpdate msg VFSUpdate vfsUpdates elementAt if msg getPath equals path return vfsUpdates addElement new VFSUpdate path if vfsUpdates size VFSManager runInAWTThread new SendVFSUpdatesSafely static class SendVFSUpdatesSafely implements Runnable public void run synchronized vfsUpdateLock for int vfsUpdates size EditBus send VFSUpdate vfsUpdates elementAt vfsUpdates removeAllElements private static WorkThreadPool ioThreadPool private static VFS fileVFS private static VFS urlVFS private static Hashtable vfsHash private static Hashtable protocolHash private static boolean error private static Object errorLock private static Vector errors private static Object vfsUpdateLock private static Vector vfsUpdates static errorLock new Object errors new Vector fileVFS new FileVFS urlVFS new UrlVFS vfsHash new Hashtable protocolHash new Hashtable vfsUpdateLock new Object vfsUpdates new Vector private VFSManager public class BufferOptions extends EnhancedDialog public BufferOptions View view Buffer buffer super view jEdit getProperty true this view view this buffer buffer JPanel content new JPanel new BorderLayout content setBorder new EmptyBorder setContentPane content ActionHandler actionListener new ActionHandler AbstractOptionPane panel new AbstractOptionPane null public void addComponent Component comp super addComponent comp public void addComponent String label Component comp super addComponent label comp public void addSeparator String separator super addSeparator separator panel addSeparator String lineSeps jEdit getProperty jEdit getProperty jEdit getProperty lineSeparator new JComboBox lineSeps String lineSep buffer getStringProperty Buffer LINESEP if lineSep null lineSep System getProperty if equals lineSep lineSeparator setSelectedIndex else if equals lineSep lineSeparator setSelectedIndex else if equals lineSep lineSeparator setSelectedIndex panel addComponent jEdit getProperty lineSeparator DefaultComboBoxModel encodings new DefaultComboBoxModel StringTokenizer st new StringTokenizer jEdit getProperty while st hasMoreTokens encodings addElement st nextToken encoding new JComboBox encodings encoding setEditable true encoding setSelectedItem buffer getStringProperty Buffer ENCODING panel addComponent jEdit getProperty encoding gzipped new JCheckBox jEdit getProperty gzipped setSelected buffer getBooleanProperty Buffer GZIPPED panel addComponent gzipped trailingEOL new JCheckBox jEdit getProperty trailingEOL setSelected buffer getBooleanProperty Buffer TRAILING_EOL panel addComponent trailingEOL panel addSeparator modes jEdit getModes String bufferMode buffer getMode getName int index String modeNames new String modes length for int modes length Mode mode modes modeNames mode getName if bufferMode equals mode getName index mode new JComboBox modeNames mode setSelectedIndex index mode addActionListener actionListener panel addComponent jEdit getProperty mode String foldModes FoldHandler getFoldModes folding new JComboBox foldModes folding setSelectedItem buffer getStringProperty panel addComponent jEdit getProperty folding String wrapModes wrap new JComboBox wrapModes wrap setSelectedItem buffer getStringProperty panel addComponent jEdit getProperty wrap String lineLengths maxLineLen new JComboBox lineLengths maxLineLen setEditable true maxLineLen setSelectedItem buffer getStringProperty panel addComponent jEdit getProperty maxLineLen String tabSizes tabSize new JComboBox tabSizes tabSize setEditable true tabSize setSelectedItem buffer getStringProperty panel addComponent jEdit getProperty tabSize indentSize new JComboBox tabSizes indentSize setEditable true indentSize setSelectedItem buffer getStringProperty panel addComponent jEdit getProperty indentSize noTabs new JCheckBox jEdit getProperty noTabs setSelected buffer getBooleanProperty panel addComponent noTabs indentOnTab new JCheckBox jEdit getProperty indentOnTab setSelected buffer getBooleanProperty panel addComponent indentOnTab indentOnEnter new JCheckBox jEdit getProperty indentOnEnter setSelected buffer getBooleanProperty panel addComponent indentOnEnter content add BorderLayout NORTH panel JPanel buttons new JPanel buttons setLayout new BoxLayout buttons BoxLayout X_AXIS buttons setBorder new EmptyBorder buttons add Box createGlue ok new JButton jEdit getProperty ok addActionListener actionListener getRootPane setDefaultButton ok buttons add ok buttons add Box createHorizontalStrut cancel new JButton jEdit getProperty cancel addActionListener actionListener buttons add cancel buttons add Box createGlue content add BorderLayout SOUTH buttons pack setLocationRelativeTo view show public void ok int index mode getSelectedIndex buffer setMode modes index index lineSeparator getSelectedIndex String lineSep if index lineSep else if index lineSep else if index lineSep else throw new InternalError String oldLineSep buffer getStringProperty Buffer LINESEP if oldLineSep null oldLineSep System getProperty if oldLineSep equals lineSep buffer setStringProperty lineSep buffer setDirty true String encoding String this encoding getSelectedItem String oldEncoding buffer getStringProperty Buffer ENCODING if oldEncoding equals encoding buffer setStringProperty Buffer ENCODING encoding buffer setDirty true EditBus send new BufferUpdate buffer view BufferUpdate ENCODING_CHANGED boolean gzippedValue gzipped isSelected boolean oldGzipped buffer getBooleanProperty Buffer GZIPPED if gzippedValue oldGzipped buffer setBooleanProperty Buffer GZIPPED gzippedValue buffer setDirty true boolean trailingEOLValue trailingEOL isSelected boolean oldTrailingEOL buffer getBooleanProperty Buffer TRAILING_EOL if trailingEOLValue oldTrailingEOL buffer setBooleanProperty Buffer TRAILING_EOL trailingEOLValue buffer setDirty true String foldMode String folding getSelectedItem String oldFoldMode buffer getStringProperty buffer setStringProperty foldMode buffer setStringProperty String wrap getSelectedItem try buffer setProperty new Integer maxLineLen getSelectedItem toString catch NumberFormatException nf try buffer setProperty new Integer tabSize getSelectedItem toString catch NumberFormatException nf try buffer setProperty new Integer indentSize getSelectedItem toString catch NumberFormatException nf buffer setBooleanProperty noTabs isSelected buffer setBooleanProperty indentOnTab isSelected buffer setBooleanProperty indentOnEnter isSelected buffer propertiesChanged View views jEdit getViews for int views length EditPane panes views getEditPanes for int panes length EditPane pane panes if pane getBuffer buffer pane getTextArea propertiesChanged dispose public void cancel dispose private View view private Buffer buffer private Mode modes private JComboBox mode private JComboBox lineSeparator private JComboBox encoding private JCheckBox gzipped private JCheckBox trailingEOL private JComboBox folding private JComboBox wrap private JComboBox maxLineLen private JComboBox tabSize private JComboBox indentSize private JCheckBox noTabs private JCheckBox indentOnTab private JCheckBox indentOnEnter private JButton ok private JButton cancel class ActionHandler implements ActionListener public void actionPerformed ActionEvent evt Object source evt getSource if source ok ok else if source cancel cancel else if source mode Mode jEdit getMode String mode getSelectedItem folding setSelectedItem getProperty wrap setSelectedItem getProperty maxLineLen setSelectedItem getProperty tabSize setSelectedItem getProperty indentSize setSelectedItem getProperty indentOnTab setSelected getBooleanProperty indentOnEnter setSelected getBooleanProperty noTabs setSelected getBooleanProperty public interface CharIndexed char OUT_OF_BOUNDS char charAt int index boolean move int index boolean isValid public class InterpreterError extends RuntimeException public InterpreterError String super public class Registers public static void copy JEditTextArea textArea char register String selection textArea getSelectedText if selection null return setRegister register selection HistoryModel getModel addItem selection public static void append JEditTextArea textArea char register append textArea register false public static void append JEditTextArea textArea char register String separator append textArea register separator false public static void append JEditTextArea textArea char register String separator boolean cut if cut textArea isEditable textArea getToolkit beep return String selection textArea getSelectedText if selection null return Register reg getRegister register String registerContents reg toString if reg null registerContents null if registerContents endsWith separator selection registerContents selection else selection registerContents separator selection setRegister register selection HistoryModel getModel addItem selection if cut textArea setSelectedText public static void cut JEditTextArea textArea char register if textArea isEditable String selection textArea getSelectedText if selection null return setRegister register selection HistoryModel getModel addItem selection textArea setSelectedText else textArea getToolkit beep public static void paste JEditTextArea textArea char register if textArea isEditable textArea getToolkit beep return Register reg getRegister register if reg null textArea getToolkit beep return else String selection reg toString if selection null textArea getToolkit beep return int magic textArea getMagicCaretPosition textArea setSelectedText selection if textArea getCaretPosition textArea getLineEndOffset textArea getCaretLine textArea setMagicCaretPosition magic else HistoryModel getModel addItem selection public static Register getRegister char name if registers null name registers length return null else return registers name public static void setRegister char name Register newRegister if name registers length Register newRegisters new Register Math min name System arraycopy registers newRegisters registers length registers newRegisters registers name newRegister public static void setRegister char name String value if name registers length Register newRegisters new Register Math min name System arraycopy registers newRegisters registers length registers newRegisters registers name new StringRegister value else Register register registers name if register null register setValue value else registers name new StringRegister value public static void clearRegister char name if name registers length return Register register registers name if name name register setValue else registers name null public static Register getRegisters return registers public interface Register String toString void setValue String value public static class ClipboardRegister implements Register Clipboard clipboard public ClipboardRegister Clipboard clipboard this clipboard clipboard public void setValue String value StringSelection selection new StringSelection value clipboard setContents selection null public String toString try String selection String clipboard getContents this getTransferData DataFlavor stringFlavor boolean trailingEOL selection endsWith selection endsWith System getProperty BufferedReader in new BufferedReader new StringReader selection StringBuffer buf new StringBuffer String line while line in readLine null buf append line buf append if trailingEOL buf setLength buf length return buf toString catch Exception Log log Log NOTICE this return null public static class StringRegister implements Register private String value public StringRegister String value this value value public void setValue String value this value value public String toString return value public void dispose private static Register registers private Registers static registers new Register registers new ClipboardRegister Toolkit getDefaultToolkit getSystemClipboard class BSHTernaryExpression extends SimpleNode BSHTernaryExpression int id super id public Object eval CallStack callstack Interpreter interpreter throws EvalError SimpleNode cond SimpleNode jjtGetChild evalTrue SimpleNode jjtGetChild evalFalse SimpleNode jjtGetChild if BSHIfStatement evaluateCondition cond callstack interpreter return evalTrue eval callstack interpreter else return evalFalse eval callstack interpreter public class DirectoryListSet extends BufferListSet public DirectoryListSet String directory String glob boolean recurse this directory directory this glob glob this recurse recurse public String getDirectory return directory public String getFileFilter return glob public boolean isRecursive return recurse public String getCode return MiscUtilities charsToEscapes directory MiscUtilities charsToEscapes glob recurse protected String return MiscUtilities listDirectory directory glob recurse private String directory private String glob private boolean recurse public class StatusBar extends JPanel implements WorkThreadProgressListener public StatusBar View view super new BorderLayout setBorder BorderFactory createEmptyBorder this view view Border border BorderFactory createLoweredBevelBorder MouseHandler mouseHandler new MouseHandler caretStatus new VICaretStatus caretStatus setBorder border caretStatus setToolTipText jEdit getProperty caretStatus addMouseListener mouseHandler add BorderLayout WEST caretStatus messagePanel new JPanel messagePanel setLayout new BorderLayout messagePanel setBorder border messagePanel setPreferredSize caretStatus getPreferredSize add BorderLayout CENTER messagePanel message new JLabel message setBorder BorderFactory createEmptyBorder setMessageComponent message Box box new Box BoxLayout X_AXIS mode new JLabel mode setBorder border mode setToolTipText jEdit getProperty mode addMouseListener mouseHandler box add mode box add Box createHorizontalStrut encoding new JLabel encoding setBorder border encoding setToolTipText jEdit getProperty encoding addMouseListener mouseHandler box add encoding box add Box createHorizontalStrut FontMetrics fm getFontMetrics UIManager getFont foldMode new JLabel foldMode setHorizontalAlignment SwingConstants CENTER foldMode setBorder border foldMode setToolTipText jEdit getProperty foldMode addMouseListener mouseHandler int inc String foldModes FoldHandler getFoldModes for int foldModes length inc Math max inc fm stringWidth foldModes Dimension dim foldMode getPreferredSize dim width inc foldMode setPreferredSize dim box add foldMode box add Box createHorizontalStrut multiSelect new JLabel multiSelect setHorizontalAlignment SwingConstants CENTER multiSelect setBorder border multiSelect setToolTipText jEdit getProperty multiSelect addMouseListener mouseHandler dim multiSelect getPreferredSize dim width Math max fm stringWidth fm stringWidth multiSelect setPreferredSize dim box add multiSelect box add Box createHorizontalStrut overwrite new JLabel overwrite setHorizontalAlignment SwingConstants CENTER overwrite setBorder border overwrite setToolTipText jEdit getProperty overwrite addMouseListener mouseHandler dim overwrite getPreferredSize dim width Math max fm stringWidth fm stringWidth overwrite setPreferredSize dim box add overwrite box add Box createHorizontalStrut memory new MemoryStatus memory setBorder border memory addMouseListener mouseHandler box add memory dim memory getPreferredSize dim width fm stringWidth dim height multiSelect getPreferredSize height memory setPreferredSize dim add BorderLayout EAST box public void addNotify super addNotify VFSManager getIOThreadPool addProgressListener this public void removeNotify super removeNotify VFSManager getIOThreadPool removeProgressListener this public void statusUpdate final WorkThreadPool threadPool int threadIndex SwingUtilities invokeLater new Runnable public void run int requestCount threadPool getRequestCount if requestCount setMessageAndClear jEdit getProperty else if requestCount setMessage jEdit getProperty else Object args new Integer requestCount setMessage jEdit getProperty args public void progressUpdate WorkThreadPool threadPool int threadIndex public void setMessageAndClear String message setMessage message tempTimer new Timer new ActionListener public void actionPerformed ActionEvent evt if isShowing setMessage null tempTimer setInitialDelay tempTimer setRepeats false tempTimer start public void setMessage String message if tempTimer null tempTimer stop tempTimer null setMessageComponent this message if message null InputHandler inputHandler view getInputHandler if inputHandler isRepeatEnabled int repeatCount inputHandler getRepeatCount this message setText jEdit getProperty new Object repeatCount String valueOf repeatCount else if view getMacroRecorder null this message setText jEdit getProperty else this message setText null else this message setText message public void setMessageComponent Component comp if comp null messageComp comp return messageComp comp messagePanel add BorderLayout CENTER messageComp public void repaintCaretStatus caretStatus repaint public void updateBufferStatus Buffer buffer view getBuffer mode setText buffer getMode getName encoding setText buffer getStringProperty public void updateMiscStatus JEditTextArea textArea view getTextArea multiSelect setText textArea isMultipleSelectionEnabled overwrite setText textArea isOverwriteEnabled foldMode setText String textArea getBuffer getProperty private View view private VICaretStatus caretStatus private JPanel messagePanel private Component messageComp private JLabel message private JLabel mode private JLabel encoding private JLabel foldMode private JLabel multiSelect private JLabel overwrite private MemoryStatus memory private Timer tempTimer static final String testStr class MouseHandler extends MouseAdapter public void mouseClicked MouseEvent evt Object source evt getSource if source caretStatus if evt getClickCount view getTextArea showGoToLineDialog else if source mode source encoding if evt getClickCount new BufferOptions view view getBuffer else if source foldMode String text foldMode getText String foldModes FoldHandler getFoldModes for int foldModes length if text equals foldModes foldModes length text foldModes break JEditTextArea textArea view getTextArea Buffer buffer view getBuffer buffer setStringProperty text buffer propertiesChanged else if source multiSelect view getTextArea toggleMultipleSelectionEnabled else if source overwrite view getTextArea toggleOverwriteEnabled else if source memory if evt getClickCount jEdit showMemoryDialog view memory repaint class VICaretStatus extends JComponent public VICaretStatus VICaretStatus this setForeground UIManager getColor VICaretStatus this setBackground UIManager getColor VICaretStatus this setFont UIManager getFont Font font VICaretStatus this getFont FontRenderContext frc new FontRenderContext null false false Rectangle2D bounds font getStringBounds testStr frc lm font getLineMetrics testStr frc Dimension size new Dimension int bounds getWidth int bounds getHeight VICaretStatus this setPreferredSize size public void paintComponent Graphics Buffer buffer view getBuffer if buffer isLoaded return JEditTextArea textArea view getTextArea int currLine textArea getCaretLine int dot textArea getCaretPosition textArea getLineStartOffset currLine int virtualPosition getVirtualPosition dot buffer textArea buf setLength buf append Integer toString currLine buf append buf append Integer toString dot if virtualPosition dot buf append buf append Integer toString virtualPosition buf append int firstLine textArea getFirstLine int visible textArea getVisibleLines int lineCount textArea getVirtualLineCount if visible lineCount buf append else if firstLine buf append else if firstLine visible lineCount buf append else float percent float firstLine float lineCount buf append Integer toString int percent buf append drawString buf toString VICaretStatus this getBorder getBorderInsets this left int VICaretStatus this getHeight lm getHeight lm getAscent private Segment seg new Segment private LineMetrics lm private int getVirtualPosition int dot Buffer buffer JEditTextArea textArea int line textArea getCaretLine textArea getLineText line seg int virtualPosition int tabSize buffer getTabSize for int seg count dot char ch seg array seg offset if ch virtualPosition tabSize virtualPosition tabSize else virtualPosition return virtualPosition class MemoryStatus extends JComponent implements ActionListener public MemoryStatus MemoryStatus this setDoubleBuffered true MemoryStatus this setForeground UIManager getColor MemoryStatus this setBackground UIManager getColor MemoryStatus this setFont UIManager getFont public void addNotify super addNotify timer new Timer this timer start ToolTipManager sharedInstance registerComponent this public void removeNotify timer stop ToolTipManager sharedInstance unregisterComponent this public String getToolTipText Runtime runtime Runtime getRuntime int freeMemory int runtime freeMemory int totalMemory int runtime totalMemory int usedMemory totalMemory freeMemory Integer args new Integer usedMemory new Integer totalMemory return jEdit getProperty args public void actionPerformed ActionEvent evt MemoryStatus this repaint public void paintComponent Graphics Insets insets MemoryStatus this getBorder getBorderInsets this Runtime runtime Runtime getRuntime int freeMemory int runtime freeMemory int totalMemory int runtime totalMemory int usedMemory totalMemory freeMemory int width MemoryStatus this getWidth insets left insets right float fraction float usedMemory totalMemory setColor UIManager getColor fillRect insets left insets top int width fraction MemoryStatus this getHeight insets top insets bottom String str usedMemory totalMemory FontMetrics fm getFontMetrics Graphics g2 create g2 setClip insets left insets top int width fraction MemoryStatus this getHeight insets top insets bottom g2 setColor UIManager getColor g2 drawString str insets left width fm stringWidth str insets top fm getAscent g2 dispose g2 create g2 setClip insets left int width fraction insets top MemoryStatus this getWidth insets left int width fraction MemoryStatus this getHeight insets top insets bottom g2 setColor MemoryStatus this getForeground g2 drawString str insets left width fm stringWidth str insets top fm getAscent g2 dispose private Timer timer class XThis extends This Hashtable interfaces InvocationHandler invocationHandler new Handler XThis NameSpace namespace Interpreter declaringInterp super namespace declaringInterp public String toString return namespace name String toStringShowInts Class ints StringBuffer sb new StringBuffer toString for int ints length sb append ints getName ints length return sb toString public Object getInterface Class clas if interfaces null interfaces new Hashtable Object interf interfaces get clas if interf null interf Proxy newProxyInstance clas getClassLoader new Class clas invocationHandler interfaces put clas interf return interf class Handler implements InvocationHandler java io Serializable public Object invoke Object proxy Method method Object args throws EvalError try return invokeImpl proxy method args catch EvalError ee Interpreter debug XThis this toString ee throw ee public Object invokeImpl Object proxy Method method Object args throws EvalError Class sig Reflect getTypes args BshMethod bmethod namespace getMethod method getName sig if bmethod null return Primitive unwrap bmethod invokeDeclaredMethod args declaringInterpreter callstack null bmethod namespace getMethod new Class null null if bmethod null return Primitive unwrap bmethod invokeDeclaredMethod new Object method getName args declaringInterpreter callstack null if method getName equals return toStringShowInts proxy getClass getInterfaces if method getName equals return new Integer this hashCode if method getName equals Object obj args return new Boolean proxy obj throw new EvalError method getName namespace name public class Mode public Mode String name this name name props new Hashtable public void init try String filenameGlob String getProperty if filenameGlob null filenameGlob length filenameRE new RE MiscUtilities globToRE filenameGlob RE REG_ICASE String firstlineGlob String getProperty if firstlineGlob null firstlineGlob length firstlineRE new RE MiscUtilities globToRE firstlineGlob RE REG_ICASE catch REException re Log log Log ERROR this name Log log Log ERROR this re public TokenMarker getTokenMarker loadIfNecessary return marker public void setTokenMarker TokenMarker marker this marker marker public void loadIfNecessary if marker null jEdit loadMode this public Object getProperty String key String prefix name String property jEdit getProperty prefix key if property null property length Object value try value new Integer property catch NumberFormatException nf value property return value Object value props get key if value null return value String global jEdit getProperty key if global null try return new Integer global catch NumberFormatException nf return global else return null public boolean getBooleanProperty String key Object value getProperty key if equals value equals value equals value return true else return false public void setProperty String key Object value props put key value public void unsetProperty String key props remove key public void setProperties Hashtable props String filenameGlob String getProperty String firstlineGlob String getProperty this props props if filenameGlob null props put filenameGlob if firstlineGlob null props put firstlineGlob public boolean accept String fileName String firstLine if filenameRE null filenameRE isMatch fileName return true if firstlineRE null firstlineRE isMatch firstLine return true return false public String getName return name public String toString return getClass getName getName private String name private Hashtable props private RE firstlineRE private RE filenameRE private TokenMarker marker class BSHLiteral extends SimpleNode public Object value BSHLiteral int id super id public Object eval CallStack callstack Interpreter interpreter throws EvalError if value null throw new InterpreterError value return value private char getEscapeChar char ch switch ch case ch break case ch break case ch break case ch break case ch break case case case break return ch public void charSetup String str char ch str charAt if ch ch str charAt if Character isDigit ch ch char Integer parseInt str substring else ch getEscapeChar ch value new Primitive new Character ch void stringSetup String str StringBuffer buffer new StringBuffer for int str length char ch str charAt if ch ch str charAt if Character isDigit ch int endPos while endPos if Character isDigit str charAt endPos endPos else break ch char Integer parseInt str substring endPos endPos else ch getEscapeChar ch buffer append ch value buffer toString public class FileCellRenderer extends DefaultTreeCellRenderer public static Icon fileIcon GUIUtilities loadIcon public static Icon dirIcon GUIUtilities loadIcon public static Icon openDirIcon GUIUtilities loadIcon public static Icon filesystemIcon GUIUtilities loadIcon public static Icon loadingIcon GUIUtilities loadIcon public FileCellRenderer plainFont UIManager getFont boldFont plainFont deriveFont Font BOLD setBorder new EmptyBorder public Component getTreeCellRendererComponent JTree tree Object value boolean sel boolean expanded boolean leaf int row boolean focus super getTreeCellRendererComponent tree value sel expanded leaf row focus DefaultMutableTreeNode treeNode DefaultMutableTreeNode value Object userObject treeNode getUserObject if userObject instanceof VFS DirectoryEntry VFS DirectoryEntry file VFS DirectoryEntry userObject underlined jEdit getBuffer file path null setIcon showIcons getIconForFile file expanded null setFont file type VFS DirectoryEntry FILE plainFont boldFont setText file name if sel Color color file getColor setForeground color null UIManager getColor color else if userObject instanceof BrowserView LoadingPlaceholder setIcon showIcons loadingIcon null setFont plainFont setText jEdit getProperty underlined false else if userObject instanceof String setIcon showIcons dirIcon null setFont boldFont setText String userObject underlined false else setIcon null setText null return this public void paintComponent Graphics if underlined Font font getFont FontMetrics fm getFontMetrics getFont int getIcon null getIcon getIconWidth getIconTextGap setColor getForeground drawLine fm getAscent fm stringWidth getText fm getAscent super paintComponent boolean showIcons void propertiesChanged showIcons jEdit getBooleanProperty private Font plainFont private Font boldFont private boolean underlined private Icon getIconForFile VFS DirectoryEntry file boolean expanded if file type VFS DirectoryEntry DIRECTORY return expanded openDirIcon dirIcon else if file type VFS DirectoryEntry FILESYSTEM return filesystemIcon else return fileIcon public class TextUtilities public static Token getTokenAtOffset Token tokens int offset if offset tokens id Token END return tokens int tokenListOffset for if tokens id Token END throw new ArrayIndexOutOfBoundsException if tokenListOffset tokens length offset return tokens else tokenListOffset tokens length tokens tokens next public static int findMatchingBracket Buffer buffer int line int offset return findMatchingBracket buffer line offset buffer getLineCount public static int findMatchingBracket Buffer buffer int line int offset int startLine int endLine if offset offset buffer getLineLength line throw new ArrayIndexOutOfBoundsException offset buffer getLineLength line Segment lineText new Segment buffer getLineText line lineText char lineText array lineText offset offset switch case cprime direction true break case cprime direction false break case cprime direction true break case cprime direction false break case cprime direction true break case cprime direction false break default return int count Buffer TokenList tokenList buffer markTokens line byte idOfBracket getTokenAtOffset tokenList getFirstToken offset id boolean haveTokens true if direction offset for for int offset lineText count char ch lineText array lineText offset if ch if haveTokens tokenList buffer markTokens line haveTokens true if getTokenAtOffset tokenList getFirstToken id idOfBracket count else if ch cprime if haveTokens tokenList buffer markTokens line haveTokens true if getTokenAtOffset tokenList getFirstToken id idOfBracket count if count return buffer getLineStartOffset line line if line endLine break buffer getLineText line lineText offset haveTokens false else offset for for int offset char ch lineText array lineText offset if ch if haveTokens tokenList buffer markTokens line haveTokens true if getTokenAtOffset tokenList getFirstToken id idOfBracket count else if ch cprime if haveTokens tokenList buffer markTokens line haveTokens true if getTokenAtOffset tokenList getFirstToken id idOfBracket count if count return buffer getLineStartOffset line line if line startLine break buffer getLineText line lineText offset lineText count haveTokens false return public static int findWordStart String line int pos String noWordSep char ch line charAt pos if noWordSep null noWordSep int type if Character isWhitespace ch type WHITESPACE else if Character isLetterOrDigit ch noWordSep indexOf ch type WORD_CHAR else type SYMBOL int whiteSpaceEnd loop for int pos ch line charAt switch type case WHITESPACE if Character isWhitespace ch break else case WORD_CHAR if Character isLetterOrDigit ch noWordSep indexOf ch break else case SYMBOL if Character isWhitespace ch return else if Character isLetterOrDigit ch noWordSep indexOf ch return else break return whiteSpaceEnd public static int findWordEnd String line int pos String noWordSep if pos pos char ch line charAt pos if noWordSep null noWordSep int type if Character isWhitespace ch type WHITESPACE else if Character isLetterOrDigit ch noWordSep indexOf ch type WORD_CHAR else type SYMBOL boolean seenWhiteSpace false loop for int pos line length ch line charAt switch type case WHITESPACE if Character isWhitespace ch break else case WORD_CHAR if Character isLetterOrDigit ch noWordSep indexOf ch break else case SYMBOL if Character isWhitespace ch return else if Character isLetterOrDigit ch noWordSep indexOf ch return else break return line length public static boolean regionMatches boolean ignoreCase Segment text int offset char match int length offset match length char textArray text array if length text offset text count return false for int offset length char c1 textArray char c2 match if ignoreCase c1 Character toUpperCase c1 c2 Character toUpperCase c2 if c1 c2 return false return true public static String spacesToTabs String in int tabSize StringBuffer buf new StringBuffer int width int whitespace for int in length switch in charAt case whitespace width break case int tab tabSize width tabSize width tab whitespace tab break case if whitespace buf append MiscUtilities createWhiteSpace whitespace tabSize whitespace width buf append break default if whitespace buf append MiscUtilities createWhiteSpace whitespace tabSize whitespace buf append in charAt width break if whitespace buf append MiscUtilities createWhiteSpace whitespace tabSize return buf toString public static String tabsToSpaces String in int tabSize StringBuffer buf new StringBuffer int width for int in length switch in charAt case int count tabSize width tabSize width count while count buf append break case width buf append in charAt break default width buf append in charAt break return buf toString public static String format String text int maxLineLength StringBuffer buf new StringBuffer StringBuffer word new StringBuffer int lineLength boolean newline true boolean space false char chars text toCharArray for int chars length char chars switch case if chars length if lineLength word length maxLineLength buf append else if space word length buf append buf append word word setLength buf append newline true space false break else if newline if lineLength word length maxLineLength buf append else if space word length buf append buf append word word setLength buf append newline space false lineLength break else newline true case if lineLength word length maxLineLength buf append lineLength newline true else if space lineLength word length buf append lineLength space false else space true buf append word lineLength word length word setLength break default newline false if lineLength space true word append break if lineLength word length maxLineLength buf append else if space word length buf append buf append word return buf toString public static final int MIXED public static final int LOWER_CASE public static final int UPPER_CASE public static final int TITLE_CASE public static int getStringCase String str if str length return MIXED int state char ch str charAt if Character isLetter ch if Character isUpperCase ch state UPPER_CASE else state LOWER_CASE for int str length ch str charAt if Character isLetter ch continue switch state case UPPER_CASE if Character isLowerCase ch if state TITLE_CASE else return MIXED break case LOWER_CASE case TITLE_CASE if Character isUpperCase ch return MIXED break return state public static String toTitleCase String str if str length return str else return Character toUpperCase str charAt str substring toLowerCase private static final int WHITESPACE private static final int WORD_CHAR private static final int SYMBOL public class TextAreaOptionPane extends AbstractOptionPane public TextAreaOptionPane super public void font new FontSelector jEdit getFontProperty addComponent jEdit getProperty font lineHighlight new JCheckBox jEdit getProperty lineHighlight setSelected jEdit getBooleanProperty addComponent lineHighlight bracketHighlight new JCheckBox jEdit getProperty bracketHighlight setSelected jEdit getBooleanProperty addComponent bracketHighlight eolMarkers new JCheckBox jEdit getProperty eolMarkers setSelected jEdit getBooleanProperty addComponent eolMarkers wrapGuide new JCheckBox jEdit getProperty wrapGuide setSelected jEdit getBooleanProperty addComponent wrapGuide blinkCaret new JCheckBox jEdit getProperty blinkCaret setSelected jEdit getBooleanProperty addComponent blinkCaret blockCaret new JCheckBox jEdit getProperty blockCaret setSelected jEdit getBooleanProperty addComponent blockCaret electricBorders new JCheckBox jEdit getProperty electricBorders setSelected equals jEdit getProperty addComponent electricBorders homeEnd new JCheckBox jEdit getProperty homeEnd setSelected jEdit getBooleanProperty addComponent homeEnd middleMousePaste new JCheckBox jEdit getProperty middleMousePaste setSelected jEdit getBooleanProperty addComponent middleMousePaste antiAlias new JCheckBox jEdit getProperty antiAlias setSelected jEdit getBooleanProperty addComponent antiAlias fracFontMetrics new JCheckBox jEdit getProperty fracFontMetrics setSelected jEdit getBooleanProperty addComponent fracFontMetrics parseFully new JCheckBox jEdit getProperty parseFully setSelected jEdit getBooleanProperty addComponent parseFully public void jEdit setFontProperty font getFont jEdit setBooleanProperty lineHighlight isSelected jEdit setBooleanProperty bracketHighlight isSelected jEdit setBooleanProperty eolMarkers isSelected jEdit setBooleanProperty wrapGuide isSelected jEdit setBooleanProperty blinkCaret isSelected jEdit setBooleanProperty blockCaret isSelected jEdit setIntegerProperty electricBorders isSelected jEdit setBooleanProperty homeEnd isSelected jEdit setBooleanProperty middleMousePaste isSelected jEdit setBooleanProperty antiAlias isSelected jEdit setBooleanProperty fracFontMetrics isSelected jEdit setBooleanProperty parseFully isSelected private FontSelector font private JCheckBox lineHighlight private JCheckBox bracketHighlight private JCheckBox eolMarkers private JCheckBox wrapGuide private JCheckBox blinkCaret private JCheckBox blockCaret private JCheckBox electricBorders private JCheckBox homeEnd private JCheckBox middleMousePaste private JCheckBox antiAlias private JCheckBox fracFontMetrics private JCheckBox parseFully class CharIndexedReader implements CharIndexed private static final int BUFFER_INCREMENT private final BufferedReader br private int index private int bufsize BUFFER_INCREMENT private int end UNKNOWN private char cached OUT_OF_BOUNDS private char lookBehind new char OUT_OF_BOUNDS OUT_OF_BOUNDS CharIndexedReader Reader reader int index if reader instanceof BufferedReader br BufferedReader reader else br new BufferedReader reader BUFFER_INCREMENT next if index move index private boolean next lookBehind lookBehind lookBehind cached if end cached OUT_OF_BOUNDS return false try if index br reset int br read br mark bufsize if end cached OUT_OF_BOUNDS return false cached char index catch IOException printStackTrace cached OUT_OF_BOUNDS return false return true public char charAt int index if index return cached else if index end return OUT_OF_BOUNDS else if index bufsize try while bufsize index bufsize BUFFER_INCREMENT br reset br mark bufsize br skip index catch IOException else if this index index try br reset br skip index catch IOException else if index return lookBehind else if index return lookBehind else if index return OUT_OF_BOUNDS char ch OUT_OF_BOUNDS try int br read if end index return ch ch char catch IOException ie return ch public boolean move int index boolean retval true while retval index retval next return retval public boolean isValid return cached OUT_OF_BOUNDS public class Log public static final int MAXLINES public static final int DEBUG public static final int MESSAGE public static final int NOTICE public static final int WARNING public static final int ERROR public static void init boolean stdio int level if stdio if System out realOut System err realErr System setOut createPrintStream NOTICE null System setErr createPrintStream ERROR null Log level level log MESSAGE Log class String props for int props length log MESSAGE Log class props System getProperty props public static void setLogWriter Writer stream if Log stream null stream null try stream write logDocument getText logDocument getLength stream flush catch Exception Log stream stream public static Document getLogDocument return logDocument public static void flushStream if stream null try stream flush catch IOException io io printStackTrace realErr public static void closeStream if stream null try stream close stream null catch IOException io io printStackTrace realErr public static void log int urgency Object source Object message String if source null Thread currentThread getName if null Thread currentThread getClass getName else if source instanceof Class Class source getName else source getClass getName int index lastIndexOf if index substring index if message instanceof Throwable urgency source Throwable message else String String valueOf message synchronized LOCK StringTokenizer st new StringTokenizer while st hasMoreTokens urgency st nextToken private static Object LOCK new Object private static Document logDocument private static int level WARNING private static Writer stream private static String lineSep private static PrintStream realOut private static PrintStream realErr static level WARNING realOut System out realErr System err logDocument new PlainDocument lineSep System getProperty private static PrintStream createPrintStream final int urgency final Object source return new PrintStream new OutputStream public void write int byte barray byte write barray public void write byte int off int len String str new String off len log urgency source str private static void final int urgency final Object source final Throwable message PrintStream out createPrintStream urgency source synchronized LOCK message printStackTrace out private static void int urgency String source String message String urgencyString urgencyToString urgency String fullMessage urgencyString source message try logDocument insertString logDocument getLength fullMessage null logDocument insertString logDocument getLength null Element map logDocument getDefaultRootElement int lines map getElementCount if lines MAXLINES Element first map getElement Element last map getElement lines MAXLINES logDocument remove first getStartOffset last getEndOffset if stream null stream write fullMessage stream write lineSep catch Exception printStackTrace realErr message urgencyString message if urgency level if urgency ERROR realErr print message else realOut print message private static String urgencyToString int urgency switch urgency case DEBUG return case MESSAGE return case NOTICE return case WARNING return case ERROR return throw new IllegalArgumentException urgency public class EvalError extends Exception SimpleNode node String message public EvalError String setMessage public EvalError String SimpleNode node this this node node public String toString String trace if node null trace node getLineNumber node getSourceFile node getText else trace return getMessage trace public void reThrow String msg throws EvalError reThrow msg null public void reThrow SimpleNode node throws EvalError reThrow null node public void reThrow String addMsg SimpleNode addNode throws EvalError prependMessage addMsg addNode addNode throw this void setNode SimpleNode node this node node SimpleNode getNode return node public String getErrorText if node null return node getText else return public int getErrorLineNumber if node null return node getLineNumber else return public String getErrorSourceFile if node null return node getSourceFile else return public String getMessage return message public void setMessage String message protected void prependMessage String if null message message protected void addNode SimpleNode addNode SimpleNode node this node if node null addNode null node addNode public class KeywordMap public KeywordMap boolean ignoreCase this ignoreCase this ignoreCase ignoreCase noWordSep new StringBuffer public KeywordMap boolean ignoreCase int mapLength this mapLength mapLength this ignoreCase ignoreCase map new Keyword mapLength public byte lookup Segment text int offset int length if length return Token NULL Keyword map getSegmentMapKey text offset length while null if length keyword length next continue if TextUtilities regionMatches ignoreCase text offset keyword return id next return Token NULL public void add String keyword byte id int key getStringMapKey keyword char chars keyword toCharArray loop for int chars length char ch chars if Character isLetterOrDigit ch for int noWordSep length if noWordSep charAt ch continue loop noWordSep append ch map key new Keyword chars id map key public String getNonAlphaNumericChars return noWordSep toString public String getKeywords Vector vector new Vector for int map length Keyword keyword map while keyword null vector addElement new String keyword keyword keyword keyword next String retVal new String vector size vector copyInto retVal return retVal public boolean getIgnoreCase return ignoreCase public void setIgnoreCase boolean ignoreCase this ignoreCase ignoreCase protected int mapLength protected int getStringMapKey String return Character toUpperCase charAt Character toUpperCase charAt length mapLength protected int getSegmentMapKey Segment int off int len return Character toUpperCase array off Character toUpperCase array off len mapLength class Keyword public Keyword char keyword byte id Keyword next this keyword keyword this id id this next next public char keyword public byte id public Keyword next private Keyword map private boolean ignoreCase private StringBuffer noWordSep public class ContextOptionPane extends AbstractOptionPane public ContextOptionPane super protected void setLayout new BorderLayout JLabel caption new JLabel jEdit getProperty add BorderLayout NORTH caption String contextMenu jEdit getProperty StringTokenizer st new StringTokenizer contextMenu listModel new DefaultListModel while st hasMoreTokens String actionName String st nextToken if actionName equals listModel addElement new ContextOptionPane MenuItem else EditAction action jEdit getAction actionName if action null continue String label action getLabel if label null continue listModel addElement new ContextOptionPane MenuItem actionName label list new JList listModel list setSelectionMode ListSelectionModel SINGLE_SELECTION list addListSelectionListener new ListHandler add BorderLayout CENTER new JScrollPane list JPanel buttons new JPanel buttons setBorder new EmptyBorder buttons setLayout new BoxLayout buttons BoxLayout X_AXIS buttons add Box createGlue ActionHandler actionHandler new ActionHandler add new JButton jEdit getProperty add addActionListener actionHandler buttons add add buttons add Box createHorizontalStrut remove new JButton jEdit getProperty remove addActionListener actionHandler buttons add remove buttons add Box createHorizontalStrut moveUp new JButton jEdit getProperty moveUp addActionListener actionHandler buttons add moveUp buttons add Box createHorizontalStrut moveDown new JButton jEdit getProperty moveDown addActionListener actionHandler buttons add moveDown buttons add Box createGlue updateButtons add BorderLayout SOUTH buttons static class MenuItemCompare implements MiscUtilities Compare public int compare Object obj1 Object obj2 return MiscUtilities compareStrings MenuItem obj1 label MenuItem obj2 label true protected void StringBuffer buf new StringBuffer for int listModel getSize if buf append buf append MenuItem listModel elementAt actionName jEdit setProperty buf toString private DefaultListModel listModel private JList list private JButton add private JButton remove private JButton moveUp moveDown private void updateButtons int index list getSelectedIndex remove setEnabled index listModel getSize moveUp setEnabled index moveDown setEnabled index index listModel getSize static class MenuItem String actionName String label MenuItem String actionName String label this actionName actionName this label GUIUtilities prettifyMenuLabel label public String toString return label class ActionHandler implements ActionListener public void actionPerformed ActionEvent evt Object source evt getSource if source add ContextAddDialog dialog new ContextAddDialog ContextOptionPane this String selection dialog getSelection if selection null return int index list getSelectedIndex if index index listModel getSize else index MenuItem menuItem if selection equals menuItem new ContextOptionPane MenuItem else menuItem new ContextOptionPane MenuItem selection jEdit getAction selection getLabel listModel insertElementAt menuItem index list setSelectedIndex index list ensureIndexIsVisible index else if source remove int index list getSelectedIndex listModel removeElementAt index updateButtons else if source moveUp int index list getSelectedIndex Object selected list getSelectedValue listModel removeElementAt index listModel insertElementAt selected index list setSelectedIndex index list ensureIndexIsVisible index else if source moveDown int index list getSelectedIndex Object selected list getSelectedValue listModel removeElementAt index listModel insertElementAt selected index list setSelectedIndex index list ensureIndexIsVisible index class ListHandler implements ListSelectionListener public void valueChanged ListSelectionEvent evt updateButtons class ContextAddDialog extends EnhancedDialog public ContextAddDialog Component comp super JOptionPane getFrameForComponent comp jEdit getProperty true JPanel content new JPanel new BorderLayout content setBorder new EmptyBorder setContentPane content ActionHandler actionHandler new ActionHandler ButtonGroup grp new ButtonGroup JPanel typePanel new JPanel new GridLayout typePanel setBorder new EmptyBorder typePanel add new JLabel jEdit getProperty separator new JRadioButton jEdit getProperty separator addActionListener actionHandler grp add separator typePanel add separator action new JRadioButton jEdit getProperty action addActionListener actionHandler grp add action action setSelected true typePanel add action content add BorderLayout NORTH typePanel JPanel actionPanel new JPanel new BorderLayout ActionSet actionsList jEdit getActionSets Vector vec new Vector actionsList length for int actionsList length ActionSet actionSet actionsList if actionSet getActionCount vec addElement actionSet combo new JComboBox vec combo addActionListener actionHandler actionPanel add BorderLayout NORTH combo list new JList list setVisibleRowCount actionPanel add BorderLayout CENTER new JScrollPane list content add BorderLayout CENTER actionPanel JPanel southPanel new JPanel southPanel setLayout new BoxLayout southPanel BoxLayout X_AXIS southPanel setBorder new EmptyBorder southPanel add Box createGlue ok new JButton jEdit getProperty ok addActionListener actionHandler getRootPane setDefaultButton ok southPanel add ok southPanel add Box createHorizontalStrut cancel new JButton jEdit getProperty cancel addActionListener actionHandler southPanel add cancel southPanel add Box createGlue content add BorderLayout SOUTH southPanel updateList pack setLocationRelativeTo JOptionPane getFrameForComponent comp show public void ok isOK true dispose public void cancel dispose public String getSelection if isOK return null if separator isSelected return else if action isSelected return ContextOptionPane MenuItem list getSelectedValue actionName else throw new InternalError private boolean isOK private JRadioButton separator action private JComboBox combo private JList list private JButton ok cancel private void updateList ActionSet actionSet ActionSet combo getSelectedItem EditAction actions actionSet getActions Vector listModel new Vector actions length for int actions length EditAction action actions String label action getLabel if label null continue listModel addElement new ContextOptionPane MenuItem action getName label MiscUtilities quicksort listModel new ContextOptionPane MenuItemCompare list setListData listModel class ActionHandler implements ActionListener public void actionPerformed ActionEvent evt Object source evt getSource if source instanceof JRadioButton combo setEnabled action isSelected list setEnabled action isSelected if source ok ok else if source cancel cancel else if source combo updateList class BSHSwitchLabel extends SimpleNode boolean isDefault public BSHSwitchLabel int id super id public Object eval CallStack callstack Interpreter interpreter throws EvalError if isDefault SimpleNode label SimpleNode jjtGetChild return label eval callstack interpreter public class UrlVFS extends VFS public UrlVFS super public int getCapabilities return READ_CAP WRITE_CAP public String constructPath String parent String path if parent endsWith return parent path else return parent path public InputStream Object session String path boolean ignoreErrors Component comp throws IOException try return new URL path openStream catch MalformedURLException mu Log log Log ERROR this mu String args mu getMessage VFSManager error comp path args return null public OutputStream Object session String path Component comp throws IOException try return new URL path openConnection getOutputStream catch MalformedURLException mu Log log Log ERROR this mu String args mu getMessage VFSManager error comp path args return null public class XmlException extends Exception private String message private String systemId private int line private int column public XmlException String message String systemId int line int column this message message this systemId systemId this line line this column column public String getMessage return message public String getSystemId return systemId public int getLine return line public int getColumn return column class BSHPrimarySuffix extends SimpleNode public static final int CLASS INDEX NAME PROPERTY public int operation Object index public String field BSHPrimarySuffix int id super id public Object doSuffix Object obj CallStack callstack Interpreter interpreter throws EvalError if operation CLASS if obj instanceof BSHType NameSpace namespace callstack top return BSHType obj getType namespace else throw new EvalError this if obj instanceof SimpleNode if obj instanceof BSHAmbiguousName obj BSHAmbiguousName obj toObject callstack interpreter else obj SimpleNode obj eval callstack interpreter try switch operation case INDEX return doIndex obj callstack interpreter case NAME return doName obj callstack interpreter case PROPERTY return doProperty obj callstack interpreter default throw new InterpreterError catch ReflectError throw new EvalError this catch InvocationTargetException throw new TargetError getTargetException this true private Object doName Object obj CallStack callstack Interpreter interpreter throws EvalError ReflectError InvocationTargetException if field equals obj getClass isArray return new Primitive Array getLength obj if jjtGetNumChildren return Reflect getObjectField obj field else Object oa BSHArguments jjtGetChild getArguments callstack interpreter try return Reflect invokeObjectMethod interpreter obj field oa this catch EvalError ee throw new EvalError ee getMessage this static int getIndexAux Object obj CallStack callstack Interpreter interpreter SimpleNode callerNode throws EvalError if obj getClass isArray throw new EvalError callerNode int index try Object indexVal SimpleNode callerNode jjtGetChild eval callstack interpreter if indexVal instanceof Primitive indexVal NameSpace getAssignableForm indexVal Integer TYPE index Primitive indexVal intValue catch EvalError Interpreter debug reThrow callerNode throw new Error return index private Object doIndex Object obj CallStack callstack Interpreter interpreter throws EvalError ReflectError int index getIndexAux obj callstack interpreter this return Reflect getIndex obj index private Object doProperty Object obj CallStack callstack Interpreter interpreter throws EvalError if obj Primitive VOID throw new EvalError this if obj instanceof Primitive throw new EvalError this Object value SimpleNode jjtGetChild eval callstack interpreter if value instanceof String throw new EvalError this if obj instanceof Hashtable Object val Hashtable obj get String value if val null val Primitive NULL return val try return Reflect getObjectProperty obj String value catch ReflectError Interpreter debug toString throw new EvalError value this public class Abbrevs public static boolean getExpandOnInput return expandOnInput public static void setExpandOnInput boolean expandOnInput Abbrevs expandOnInput expandOnInput public static boolean expandAbbrev View view boolean add Buffer buffer view getBuffer JEditTextArea textArea view getTextArea if buffer isEditable view getToolkit beep return false int line textArea getCaretLine int lineStart buffer getLineStartOffset line int caret textArea getCaretPosition String lineText buffer getLineText line if lineText length if add view getToolkit beep return false int pos caret lineStart if pos if add view getToolkit beep return false pp removeAllElements int wordStart String abbrev if lineText charAt pos wordStart lineText indexOf wordStart TextUtilities findWordStart lineText wordStart buffer getStringProperty abbrev lineText substring wordStart pos int lastIndex for int abbrev length if abbrev charAt pp addElement abbrev substring lastIndex lastIndex pp addElement abbrev substring lastIndex abbrev String pp elementAt else wordStart TextUtilities findWordStart lineText pos buffer getStringProperty abbrev lineText substring wordStart pos Expansion expand expandAbbrev buffer getMode getName abbrev buffer getBooleanProperty buffer getTabSize pp if expand null if add new AddAbbrevDialog view abbrev return false else buffer beginCompoundEdit try lineText buffer getText lineStart wordStart int leadingIndent MiscUtilities getLeadingWhiteSpaceWidth lineText buffer getTabSize buffer remove lineStart wordStart pos wordStart buffer insert lineStart wordStart expand text if expand caretPosition textArea setCaretPosition lineStart wordStart expand caretPosition String whiteSpace MiscUtilities createWhiteSpace leadingIndent buffer getBooleanProperty buffer getTabSize for int line line expand lineCount buffer insert buffer getLineStartOffset whiteSpace finally buffer endCompoundEdit return true public static Hashtable getGlobalAbbrevs if loaded load return globalAbbrevs public static void setGlobalAbbrevs Hashtable globalAbbrevs abbrevsChanged true Abbrevs globalAbbrevs globalAbbrevs public static Hashtable getModeAbbrevs if loaded load return modes public static void setModeAbbrevs Hashtable modes abbrevsChanged true Abbrevs modes modes public static void addGlobalAbbrev String abbrev String expansion if loaded load globalAbbrevs put abbrev expansion abbrevsChanged true public static void addModeAbbrev String mode String abbrev String expansion if loaded load Hashtable modeAbbrevs Hashtable modes get mode if modeAbbrevs null modeAbbrevs new Hashtable modes put mode modeAbbrevs modeAbbrevs put abbrev expansion abbrevsChanged true static void save jEdit setBooleanProperty expandOnInput String settings jEdit getSettingsDirectory if abbrevsChanged settings null File file1 new File MiscUtilities constructPath settings File file2 new File MiscUtilities constructPath settings if file2 exists file2 lastModified abbrevsModTime Log log Log WARNING Abbrevs class file2 else jEdit backupSettingsFile file2 try saveAbbrevs new FileWriter file1 catch Exception Log log Log ERROR Abbrevs class file1 Log log Log ERROR Abbrevs class file2 delete file1 renameTo file2 abbrevsModTime file2 lastModified private static boolean loaded private static boolean abbrevsChanged private static long abbrevsModTime private static boolean expandOnInput private static Hashtable globalAbbrevs private static Hashtable modes private static Vector pp new Vector private Abbrevs static expandOnInput jEdit getBooleanProperty private static void load globalAbbrevs new Hashtable modes new Hashtable String settings jEdit getSettingsDirectory if settings null File file new File MiscUtilities constructPath settings abbrevsModTime file lastModified try loadAbbrevs new FileReader file loaded true catch FileNotFoundException fnf catch Exception Log log Log ERROR Abbrevs class file Log log Log ERROR Abbrevs class if loaded try loadAbbrevs new InputStreamReader Abbrevs class getResourceAsStream catch Exception Log log Log ERROR Abbrevs class Log log Log ERROR Abbrevs class loaded true private static Expansion expandAbbrev String mode String abbrev int softTabSize Vector pp if loaded load String expand null Hashtable modeAbbrevs Hashtable modes get mode if modeAbbrevs null expand String modeAbbrevs get abbrev if expand null expand String globalAbbrevs get abbrev if expand null return null else return new Expansion expand softTabSize pp private static void loadAbbrevs Reader throws Exception BufferedReader in new BufferedReader Hashtable currentAbbrevs null String line while line in readLine null if line length continue else if line startsWith line indexOf if line equals currentAbbrevs globalAbbrevs else String mode line substring line length currentAbbrevs Hashtable modes get mode if currentAbbrevs null currentAbbrevs new Hashtable modes put mode currentAbbrevs else int index line indexOf currentAbbrevs put line substring index line substring index in close private static void saveAbbrevs Writer throws Exception BufferedWriter out new BufferedWriter String lineSep System getProperty out write out write lineSep saveAbbrevs out globalAbbrevs Enumeration keys modes keys Enumeration values modes elements while keys hasMoreElements out write out write String keys nextElement out write out write lineSep saveAbbrevs out Hashtable values nextElement out close private static void saveAbbrevs Writer out Hashtable abbrevs throws Exception String lineSep System getProperty Enumeration keys abbrevs keys Enumeration values abbrevs elements while keys hasMoreElements String abbrev String keys nextElement out write abbrev out write out write values nextElement toString out write lineSep static class Expansion String text int caretPosition int lineCount Expansion String text int softTabSize Vector pp StringBuffer buf new StringBuffer boolean backslash false for int text length char ch text charAt if backslash backslash false if ch caretPosition buf length else if ch buf append lineCount else if ch if softTabSize buf append else for int softTabSize buf append else buf append ch else if ch backslash true else if ch if text length ch text charAt if Character isDigit ch ch int pos ch if pos pp size buf append pp elementAt pos else buf append buf append ch else buf append else buf append ch this text buf toString class BSHPrimitiveType extends SimpleNode public Class type BSHPrimitiveType int id super id public Class getType return type public class XModeHandler extends HandlerBase public XModeHandler XmlParser parser String modeName String path this modeName modeName this parser parser this path path stateStack new Stack public Object resolveEntity String publicId String systemId if equals systemId return new StringReader return null public void attribute String aname String value boolean isSpecified String tag peekElement aname aname null null aname intern value value null null value intern if aname propName value else if aname propValue value else if aname lastTokenID stringToToken value else if aname lastAtLineStart isSpecified value false else if aname lastNoLineBreak isSpecified value false else if aname lastNoWordBreak isSpecified value false else if aname lastExcludeMatch isSpecified value false else if aname lastIgnoreCase isSpecified value true else if aname lastHighlightDigits isSpecified value false else if aname try if isSpecified termChar Integer parseInt value catch NumberFormatException error value termChar else if aname lastEscape value else if aname lastSetName value else if aname lastDelegateSet value else if aname lastDefaultID stringToToken value public void doctypeDecl String name String publicId String systemId throws Exception if equalsIgnoreCase name return error name public void charData char int off int len String tag peekElement String text new String off len if tag tag tag tag tag tag lastStart text else if tag lastEnd text else lastKeyword text public void startElement String tag tag pushElement tag if tag mode jEdit getMode modeName if mode null mode new Mode modeName jEdit addMode mode else if tag keywords new KeywordMap true else if tag rules new ParserRuleSet lastSetName mode rules setIgnoreCase lastIgnoreCase rules setHighlightDigits lastHighlightDigits rules setEscape lastEscape rules setDefault lastDefaultID public void endElement String name if name null return String tag popElement if name equalsIgnoreCase tag if tag mode init mode setTokenMarker marker else if tag props put propName propValue else if tag if peekElement equals rules setProperties props else mode setProperties props props new Hashtable else if tag keywords setIgnoreCase lastIgnoreCase lastIgnoreCase true else if tag rules setKeywords keywords marker addRuleSet lastSetName rules keywords null lastSetName null lastEscape null lastIgnoreCase true lastHighlightDigits false lastDefaultID Token NULL rules null else if tag rules setTerminateChar termChar termChar else if tag if lastStart null error return rules addRule ParserRuleFactory createWhitespaceRule lastStart lastStart null lastEnd null else if tag if lastStart null error return rules addRule ParserRuleFactory createEOLSpanRule lastStart lastTokenID lastAtLineStart lastExcludeMatch lastStart null lastEnd null lastTokenID Token NULL lastAtLineStart false lastExcludeMatch false else if tag if lastStart null error return rules addRule ParserRuleFactory createMarkPreviousRule lastStart lastTokenID lastAtLineStart lastExcludeMatch lastStart null lastEnd null lastTokenID Token NULL lastAtLineStart false lastExcludeMatch false else if tag if lastStart null error return rules addRule ParserRuleFactory createMarkFollowingRule lastStart lastTokenID lastAtLineStart lastExcludeMatch lastStart null lastEnd null lastTokenID Token NULL lastAtLineStart false lastExcludeMatch false else if tag if lastStart null error return rules addRule ParserRuleFactory createSequenceRule lastStart lastTokenID lastAtLineStart lastStart null lastEnd null lastTokenID Token NULL lastAtLineStart false else if tag if lastDelegateSet null rules addRule ParserRuleFactory createSpanRule lastStart lastEnd lastTokenID lastNoLineBreak lastAtLineStart lastExcludeMatch lastNoWordBreak else if lastDelegateSet indexOf lastDelegateSet modeName lastDelegateSet rules addRule ParserRuleFactory createDelegateSpanRule lastStart lastEnd lastDelegateSet lastTokenID lastNoLineBreak lastAtLineStart lastExcludeMatch lastNoWordBreak lastStart null lastEnd null lastTokenID Token NULL lastAtLineStart false lastNoLineBreak false lastExcludeMatch false lastNoWordBreak false lastDelegateSet null else if tag addKeyword lastKeyword Token NULL else if tag addKeyword lastKeyword Token COMMENT1 else if tag addKeyword lastKeyword Token COMMENT2 else if tag addKeyword lastKeyword Token LITERAL1 else if tag addKeyword lastKeyword Token LITERAL2 else if tag addKeyword lastKeyword Token LABEL else if tag addKeyword lastKeyword Token KEYWORD1 else if tag addKeyword lastKeyword Token KEYWORD2 else if tag addKeyword lastKeyword Token KEYWORD3 else if tag addKeyword lastKeyword Token FUNCTION else if tag addKeyword lastKeyword Token MARKUP else if tag addKeyword lastKeyword Token OPERATOR else if tag addKeyword lastKeyword Token DIGIT else throw new InternalError public void startDocument marker new TokenMarker marker setName modeName props new Hashtable pushElement null private XmlParser parser private String modeName private String path private TokenMarker marker private KeywordMap keywords private Mode mode private Stack stateStack private String propName private String propValue private Hashtable props private String lastStart private String lastEnd private String lastKeyword private String lastSetName private String lastEscape private String lastDelegateSet private ParserRuleSet rules private byte lastDefaultID Token NULL private byte lastTokenID private int termChar private boolean lastNoLineBreak private boolean lastNoWordBreak private boolean lastAtLineStart private boolean lastExcludeMatch private boolean lastIgnoreCase true private boolean lastHighlightDigits private byte stringToToken String value if value return Token NULL else if value return Token COMMENT1 else if value return Token COMMENT2 else if value return Token LITERAL1 else if value return Token LITERAL2 else if value return Token LABEL else if value return Token KEYWORD1 else if value return Token KEYWORD2 else if value return Token KEYWORD3 else if value return Token FUNCTION else if value return Token MARKUP else if value return Token OPERATOR else if value return Token DIGIT else if value return Token INVALID else error value return Token NULL private void addKeyword String byte id if null error return if keywords null return keywords add id private String pushElement String name name name null null name intern stateStack push name return name private String peekElement return String stateStack peek private String popElement return String stateStack pop private void error String msg jEdit getProperty msg private void error String msg String subst jEdit getProperty msg new String subst private void error String msg Throwable jEdit getProperty msg new String toString Log log Log ERROR this private void String msg Object args path new Integer parser getLineNumber new Integer parser getColumnNumber msg GUIUtilities error null args public final class UncheckedRE extends RE public UncheckedRE Object pattern this pattern RESyntax RE_SYNTAX_PERL5 public UncheckedRE Object pattern int cflags this pattern cflags RESyntax RE_SYNTAX_PERL5 public UncheckedRE Object pattern int cflags RESyntax syntax try initialize pattern cflags syntax catch REException throw new RuntimeException getMessage public class FloatingWindowContainer extends JFrame implements DockableWindowContainer public FloatingWindowContainer DockableWindowManager dockableWindowManager this dockableWindowManager dockableWindowManager setIconImage GUIUtilities getPluginIcon setDefaultCloseOperation DISPOSE_ON_CLOSE public void register DockableWindowManager Entry entry this entry entry setTitle entry title getContentPane add BorderLayout CENTER entry win pack GUIUtilities loadGeometry this entry name show public void add DockableWindowManager Entry entry public void save DockableWindowManager Entry entry GUIUtilities saveGeometry this entry name public void remove DockableWindowManager Entry entry super dispose public void show final DockableWindowManager Entry entry toFront requestFocus SwingUtilities invokeLater new Runnable public void run entry win requestDefaultFocus public boolean isVisible DockableWindowManager Entry entry return true public void dispose dockableWindowManager removeDockableWindow entry name private DockableWindowManager dockableWindowManager private DockableWindowManager Entry entry public abstract class BufferListSet implements SearchFileSet public String getFirstFile View view if files null files if files null files length return null else return files public String getNextFile View view String file if files null files if files null files length return null if file null file view getBuffer getPath for int files length if files equals file return file return getFirstFile view else for int files length if files equals file return files return null public String getFiles View view if files null files if files null files length return null else return files public int getFileCount if files null files if files null return else return files length public String getCode return null protected abstract String private String files public class TokenMarker public static final int MAJOR_ACTIONS public static final int WHITESPACE public static final int SPAN public static final int MARK_PREVIOUS public static final int MARK_FOLLOWING public static final int EOL_SPAN public static final int ACTION_HINTS public static final int EXCLUDE_MATCH public static final int AT_LINE_START public static final int NO_LINE_BREAK public static final int NO_WORD_BREAK public static final int IS_ESCAPE public static final int DELEGATE public TokenMarker ruleSets new Hashtable public void addRuleSet String setName ParserRuleSet rules if rules null return if setName null setName ruleSets put rulePfx concat setName rules if setName equals mainRuleSet rules public ParserRuleSet getMainRuleSet return mainRuleSet public ParserRuleSet getRuleSet String setName ParserRuleSet rules rules ParserRuleSet ruleSets get setName if rules null setName startsWith rulePfx int delim setName indexOf String modeName setName substring delim Mode mode jEdit getMode modeName if mode null Log log Log ERROR TokenMarker class modeName rules null else TokenMarker marker mode getTokenMarker rules marker getRuleSet setName ruleSets put setName rules if rules null Log log Log ERROR this setName return rules public String getName return name public void setName String name if name null throw new NullPointerException this name name rulePfx name concat public LineContext markTokens LineContext prevContext Buffer TokenList tokenList Segment line this context new LineContext if prevContext null context rules getMainRuleSet else context parent prevContext parent context inRule prevContext inRule context rules prevContext rules lastOffset lastKeyword line offset lineLength line count line offset int terminateChar context rules getTerminateChar int searchLimit terminateChar terminateChar line count line offset terminateChar lineLength escaped false boolean boolean tempEscaped Segment tempPattern ParserRule rule LineContext tempContext for pos line offset pos searchLimit pos if context parent null tempContext context context context parent pattern array context inRule searchChars pattern count context inRule sequenceLengths pattern offset context inRule sequenceLengths handleRule tokenList line context inRule context tempContext if if escaped escaped false else if pos lastOffset if context inRule null markKeyword tokenList line lastKeyword pos tokenList addToken pos lastOffset context rules getDefault context rules else if context inRule action NO_LINE_BREAK NO_WORD_BREAK tokenList addToken pos lastOffset context inRule token context rules else tokenList addToken pos lastOffset Token INVALID context rules context LineContext context parent clone if context inRule action EXCLUDE_MATCH EXCLUDE_MATCH tokenList addToken pattern count context rules getDefault context rules else tokenList addToken pattern count context inRule token context rules context inRule null lastKeyword lastOffset pos pattern count continue if rule context rules getEscapeRule null tempPattern pattern pattern context rules getEscapePattern tempEscaped escaped handleRule tokenList line rule pattern tempPattern if if tempEscaped escaped false continue rule context inRule if rule null rule action SPAN SPAN pattern array rule searchChars pattern count rule sequenceLengths pattern offset rule sequenceLengths if handleRule tokenList line rule rule action SOFT_SPAN escaped false continue rule context rules getRules line array pos while rule null pattern array rule searchChars if context inRule rule rule action SPAN SPAN pattern count rule sequenceLengths pattern offset rule sequenceLengths else pattern count rule sequenceLengths pattern offset if handleRule tokenList line rule break rule rule next escaped false if context inRule null markKeyword tokenList line lastKeyword lineLength if lastOffset lineLength if context inRule null tokenList addToken lineLength lastOffset context rules getDefault context rules else if context inRule action SPAN SPAN context inRule action NO_LINE_BREAK NO_WORD_BREAK tokenList addToken lineLength lastOffset Token INVALID context rules context inRule null else tokenList addToken lineLength lastOffset context inRule token context rules if context inRule action MARK_FOLLOWING MARK_FOLLOWING context inRule null tokenList addToken Token END context rules return context intern private static final int SOFT_SPAN MARK_FOLLOWING NO_WORD_BREAK private String name private String rulePfx private Hashtable ruleSets private ParserRuleSet mainRuleSet private LineContext context private Segment pattern new Segment new char private int lastOffset private int lastKeyword private int lineLength private int pos private boolean escaped private boolean handleRule Buffer TokenList tokenList Segment line ParserRule checkRule if pattern count return true if lineLength pos pattern count return true char for int pattern count pattern array pattern offset line array pos if context rules getIgnoreCase Character toLowerCase Character toLowerCase return true if escaped pos pattern count return false else if checkRule action IS_ESCAPE IS_ESCAPE escaped true pos pattern count return false if context inRule checkRule context inRule null context inRule action SOFT_SPAN if context inRule action NO_WORD_BREAK NO_WORD_BREAK tokenList addToken pos lastOffset Token INVALID context rules else tokenList addToken pos lastOffset context inRule token context rules lastOffset lastKeyword pos context inRule null if context inRule null if checkRule action AT_LINE_START AT_LINE_START if checkRule action MARK_PREVIOUS lastKeyword pos line offset return true markKeyword tokenList line lastKeyword pos if checkRule action MARK_PREVIOUS MARK_PREVIOUS lastKeyword pos pattern count if checkRule action WHITESPACE WHITESPACE if lastOffset pos tokenList addToken pos lastOffset context rules getDefault context rules switch checkRule action MAJOR_ACTIONS case tokenList addToken pattern count checkRule token context rules lastOffset pos pattern count break case SPAN context inRule checkRule if checkRule action DELEGATE DELEGATE if checkRule action EXCLUDE_MATCH EXCLUDE_MATCH tokenList addToken pattern count context rules getDefault context rules lastOffset pos pattern count else lastOffset pos else String setName new String checkRule searchChars checkRule sequenceLengths checkRule sequenceLengths checkRule sequenceLengths ParserRuleSet delegateSet getRuleSet setName if delegateSet null if checkRule action EXCLUDE_MATCH EXCLUDE_MATCH tokenList addToken pattern count context rules getDefault context rules else tokenList addToken pattern count checkRule token context rules lastOffset pos pattern count context new LineContext delegateSet context break case EOL_SPAN if checkRule action EXCLUDE_MATCH EXCLUDE_MATCH tokenList addToken pattern count context rules getDefault context rules tokenList addToken lineLength pos pattern count checkRule token context rules else tokenList addToken lineLength pos checkRule token context rules lastOffset lineLength lastKeyword lineLength pos lineLength return false case MARK_PREVIOUS if lastKeyword lastOffset tokenList addToken lastKeyword lastOffset context rules getDefault context rules lastOffset lastKeyword if checkRule action EXCLUDE_MATCH EXCLUDE_MATCH tokenList addToken pos lastOffset checkRule token context rules tokenList addToken pattern count context rules getDefault context rules else tokenList addToken pos lastOffset pattern count checkRule token context rules lastOffset pos pattern count break case MARK_FOLLOWING context inRule checkRule if checkRule action EXCLUDE_MATCH EXCLUDE_MATCH tokenList addToken pattern count context rules getDefault context rules lastOffset pos pattern count else lastOffset pos break default throw new InternalError lastKeyword lastOffset else if checkRule action SPAN SPAN if checkRule action DELEGATE DELEGATE context inRule null if checkRule action EXCLUDE_MATCH EXCLUDE_MATCH tokenList addToken pos lastOffset checkRule token context rules tokenList addToken pattern count context rules getDefault context rules else tokenList addToken pos pattern count lastOffset checkRule token context rules lastKeyword lastOffset pos pattern count return true private void markKeyword Buffer TokenList tokenList Segment line int start int end KeywordMap keywords context rules getKeywords int len end start if context rules getHighlightDigits boolean digit true char array line array boolean octal false boolean hex false boolean seenSomeDigits false loop for int len char ch array start switch ch case if octal true seenSomeDigits true continue loop case case case case case case case case case seenSomeDigits true continue loop case case if octal hex true continue loop else break case case case case if hex continue loop else if len seenSomeDigits continue loop else break case case if len seenSomeDigits continue loop else break case case if seenSomeDigits continue loop else break case case case case case case if hex continue loop else break case case continue loop default break digit false break loop if digit seenSomeDigits if start lastOffset tokenList addToken start lastOffset context rules getDefault context rules tokenList addToken len Token DIGIT context rules lastKeyword lastOffset end return if keywords null byte id keywords lookup line start len if id Token NULL if start lastOffset tokenList addToken start lastOffset context rules getDefault context rules tokenList addToken len id context rules lastKeyword lastOffset end public static class LineContext static int count static int countGC public String getAllocationStatistics return count count countGC intern size static Hashtable intern new Hashtable public LineContext parent public ParserRule inRule public ParserRuleSet rules public LineContext ParserRule ParserRuleSet rs this inRule rules rs public LineContext ParserRuleSet rs LineContext lc this rules rs parent lc null null LineContext lc clone public LineContext ParserRule this inRule public LineContext count public LineContext intern Object obj intern get this if obj null intern put this this return this else return LineContext obj public void finalize countGC public int hashCode if inRule null return inRule hashCode else if rules null return rules hashCode else return public boolean equals Object obj if obj instanceof LineContext LineContext lc LineContext obj if lc parent null if parent null return false if parent null return false else if lc parent equals parent return false return lc inRule inRule lc rules rules else return false public Object clone LineContext lc new LineContext lc inRule inRule lc rules rules lc parent parent null null LineContext parent clone return lc public abstract class Selection implements Cloneable public int getStart return start public int getEnd return end public int getStartLine return startLine public int getEndLine return endLine public abstract int getStart Buffer buffer int line public abstract int getEnd Buffer buffer int line public String toString return getClass getName start end startLine endLine public Object clone try return super clone catch CloneNotSupportedException throw new InternalError int start end startLine endLine protected Selection protected Selection Selection copy start copy start end copy end protected Selection int start int end this start start this end end public static class Range extends Selection public Range super public Range Selection sel super sel public Range int start int end super start end public int getStart Buffer buffer int line if line startLine return start else return buffer getLineStartOffset line public int getEnd Buffer buffer int line if line endLine return end else return buffer getLineEndOffset line public static class Rect extends Selection public Rect super public Rect Selection sel super sel public Rect int start int end super start end public int getStart Buffer buffer int line if line startLine return start else int start buffer getLineStartOffset startLine int end buffer getLineStartOffset endLine return Math min buffer getLineEndOffset line buffer getLineStartOffset line Math min public int getEnd Buffer buffer int line if line endLine return end else int start buffer getLineStartOffset startLine int end buffer getLineStartOffset endLine return Math min buffer getLineEndOffset line buffer getLineStartOffset line Math max public class Token public static final byte NULL public static final byte COMMENT1 public static final byte COMMENT2 public static final byte LITERAL1 public static final byte LITERAL2 public static final byte LABEL public static final byte KEYWORD1 public static final byte KEYWORD2 public static final byte KEYWORD3 public static final byte FUNCTION public static final byte MARKUP public static final byte OPERATOR public static final byte DIGIT public static final byte ID_COUNT public static final byte END public int length public byte id public ParserRuleSet rules public Token prev public Token next public Token int length byte id ParserRuleSet rules this length length this id id this rules rules public String toString return id length public class TextAreaPainter extends JComponent implements TabExpander public static final int LOWEST_LAYER Integer MIN_VALUE public static final int BACKGROUND_LAYER public static final int LINE_BACKGROUND_LAYER public static final int BELOW_SELECTION_LAYER public static final int SELECTION_LAYER public static final int WRAP_GUIDE_LAYER public static final int BELOW_MOST_EXTENSIONS_LAYER public static final int DEFAULT_LAYER public static final int BRACKET_HIGHLIGHT_LAYER public static final int HIGHEST_LAYER Integer MAX_VALUE public TextAreaPainter JEditTextArea textArea enableEvents AWTEvent FOCUS_EVENT_MASK AWTEvent KEY_EVENT_MASK AWTEvent MOUSE_EVENT_MASK this textArea textArea extensionMgr new ExtensionManager setAutoscrolls true setOpaque true setCursor Cursor getPredefinedCursor Cursor TEXT_CURSOR fontRenderContext new FontRenderContext null false false addExtension LINE_BACKGROUND_LAYER lineBackground new PaintLineBackground addExtension SELECTION_LAYER new PaintSelection addExtension WRAP_GUIDE_LAYER new WrapGuide addExtension BRACKET_HIGHLIGHT_LAYER new BracketHighlight public void setBounds int int int width int height if getX getY width getWidth height getHeight return super setBounds width height textArea recalculateVisibleLines textArea recalculateLastPhysicalLine textArea propertiesChanged textArea scrollBarsInitialized true public boolean isManagingFocus return false public boolean getFocusTraversalKeysEnabled return false public final SyntaxStyle getStyles return styles public final void setStyles SyntaxStyle styles this styles styles styles Token NULL new SyntaxStyle getForeground null getFont repaint public final Color getCaretColor return caretColor public final void setCaretColor Color caretColor this caretColor caretColor if textArea getBuffer null textArea invalidateLine textArea getCaretLine public final Color getSelectionColor return selectionColor public final void setSelectionColor Color selectionColor this selectionColor selectionColor if textArea getBuffer null textArea invalidateSelectedLines public final Color getLineHighlightColor return lineHighlightColor public final void setLineHighlightColor Color lineHighlightColor this lineHighlightColor lineHighlightColor if textArea getBuffer null textArea invalidateLine textArea getCaretLine public final boolean isLineHighlightEnabled return lineHighlight public final void setLineHighlightEnabled boolean lineHighlight this lineHighlight lineHighlight if textArea getBuffer null textArea invalidateSelectedLines public final Color getFoldedLineColor return foldedLineColor public final void setFoldedLineColor Color foldedLineColor this foldedLineColor foldedLineColor repaint public final Color getBracketHighlightColor return bracketHighlightColor public final void setBracketHighlightColor Color bracketHighlightColor this bracketHighlightColor bracketHighlightColor if textArea getBuffer null textArea invalidateLine textArea getBracketLine public final boolean isBracketHighlightEnabled return bracketHighlight public final void setBracketHighlightEnabled boolean bracketHighlight this bracketHighlight bracketHighlight if textArea getBuffer null textArea invalidateLine textArea getBracketLine public final boolean isBlockCaretEnabled return blockCaret public final void setBlockCaretEnabled boolean blockCaret this blockCaret blockCaret if textArea getBuffer null textArea invalidateLine textArea getCaretLine public final Color getEOLMarkerColor return eolMarkerColor public final void setEOLMarkerColor Color eolMarkerColor this eolMarkerColor eolMarkerColor repaint public final boolean getEOLMarkersPainted return eolMarkers public final void setEOLMarkersPainted boolean eolMarkers this eolMarkers eolMarkers repaint public final Color getWrapGuideColor return wrapGuideColor public final void setWrapGuideColor Color wrapGuideColor this wrapGuideColor wrapGuideColor repaint public final boolean isWrapGuidePainted return wrapGuide public final void setWrapGuidePainted boolean wrapGuide this wrapGuide wrapGuide repaint public void setAntiAliasEnabled boolean antiAlias this antiAlias antiAlias updateRenderingHints public boolean isAntiAliasEnabled return antiAlias public void setFractionalFontMetricsEnabled boolean fracFontMetrics this fracFontMetrics fracFontMetrics updateRenderingHints public boolean isFractionalFontMetricsEnabled return fracFontMetrics public FontRenderContext getFontRenderContext return fontRenderContext public void addCustomHighlight TextAreaHighlight highlight Log log Log WARNING this highlight public void removeCustomHighlight TextAreaHighlight highlight Log log Log WARNING this highlight public void addExtension TextAreaExtension extension extensionMgr addExtension DEFAULT_LAYER extension repaint public void addExtension int layer TextAreaExtension extension extensionMgr addExtension layer extension repaint public void removeExtension TextAreaExtension extension extensionMgr removeExtension extension repaint public String getToolTipText MouseEvent evt if textArea getBuffer isLoaded return null return extensionMgr getToolTipText evt getX evt getY public FontMetrics getFontMetrics return fm public void setFont Font font super setFont font fm getFontMetrics font textArea recalculateVisibleLines public void paintComponent Graphics long start System currentTimeMillis Graphics2D gfx Graphics2D gfx setRenderingHints renderingHints fontRenderContext gfx getFontRenderContext Rectangle clipRect gfx getClipBounds gfx setColor getBackground gfx fillRect clipRect clipRect clipRect width clipRect height Buffer buffer textArea getBuffer if buffer isLoaded return int textArea getHorizontalOffset int height fm getHeight int firstInvalid clipRect height int lastInvalid clipRect clipRect height height textArea chunkCache updateChunksUpTo lastInvalid int lineCount textArea getVirtualLineCount int clipRect clipRect height try boolean updateMaxHorizontalScrollWidth false for int line firstInvalid line lastInvalid line ChunkCache LineInfo lineInfo textArea chunkCache getLineInfo line if lineInfo chunksValid System err println lineInfo width paintLine gfx buffer lineInfo line if lineInfo width textArea maxHorizontalScrollWidth updateMaxHorizontalScrollWidth true height if buffer isNextLineRequested int clipRect clipRect height textArea chunkCache invalidateChunksFrom lastInvalid repaint getWidth getHeight if updateMaxHorizontalScrollWidth textArea updateMaxHorizontalScrollWidth catch Exception Log log Log ERROR this firstInvalid lastInvalid Log log Log ERROR this public float nextTabStop float int tabOffset int ntabs int textArea tabSize return ntabs textArea tabSize public Dimension getPreferredSize Dimension dim new Dimension char foo new char for int foo length foo dim width int getFont getStringBounds foo foo length fontRenderContext getWidth dim height fm getHeight return dim public Dimension getMinimumSize return getPreferredSize private JEditTextArea textArea private SyntaxStyle styles private Color caretColor private Color selectionColor private Color lineHighlightColor private Color foldedLineColor private Color bracketHighlightColor private Color eolMarkerColor private Color wrapGuideColor private boolean blockCaret private boolean lineHighlight private boolean bracketHighlight private boolean eolMarkers private boolean wrapGuide private boolean antiAlias private boolean fracFontMetrics private FontMetrics fm private ExtensionManager extensionMgr private PaintLineBackground lineBackground private RenderingHints renderingHints private FontRenderContext fontRenderContext private void updateRenderingHints HashMap hints new HashMap if antiAlias hints put RenderingHints KEY_RENDERING RenderingHints VALUE_RENDER_QUALITY hints put RenderingHints KEY_ANTIALIASING RenderingHints VALUE_ANTIALIAS_ON hints put RenderingHints KEY_TEXT_ANTIALIASING RenderingHints VALUE_TEXT_ANTIALIAS_ON else hints put RenderingHints KEY_ANTIALIASING RenderingHints VALUE_ANTIALIAS_OFF hints put RenderingHints KEY_TEXT_ANTIALIASING RenderingHints VALUE_TEXT_ANTIALIAS_OFF hints put RenderingHints KEY_FRACTIONALMETRICS fracFontMetrics RenderingHints VALUE_FRACTIONALMETRICS_ON RenderingHints VALUE_FRACTIONALMETRICS_OFF renderingHints new RenderingHints hints fontRenderContext new FontRenderContext null antiAlias fracFontMetrics private int paintLine Graphics2D gfx Buffer buffer ChunkCache LineInfo lineInfo int screenLine int int int physicalLine lineInfo physicalLine if physicalLine extensionMgr paintInvalidLine gfx screenLine else int start textArea getScreenLineStartOffset screenLine int end textArea getScreenLineEndOffset screenLine extensionMgr paintValidLine gfx screenLine physicalLine start end Font defaultFont getFont Color defaultColor getForeground gfx setFont defaultFont gfx setColor defaultColor float baseLine fm getHeight fm getLeading fm getDescent if lineInfo chunks null ChunkCache paintChunkList lineInfo chunks gfx baseLine lineBackground bgColor true gfx setFont defaultFont gfx setColor eolMarkerColor if lineInfo lastSubregion gfx drawString Math max textArea getHorizontalOffset textArea wrapMargin textArea charWidth baseLine textArea charWidth else if lineBackground collapsedFold int nextLine textArea getFoldVisibilityManager getNextVisibleLine physicalLine if nextLine nextLine buffer getLineCount int count nextLine physicalLine String str count gfx drawString str baseLine int getFont getStringBounds str fontRenderContext getWidth else if eolMarkers gfx drawString baseLine textArea charWidth paintCaret gfx physicalLine start end lineBackground bgColor return private void paintCaret Graphics2D gfx int physicalLine int start int end int Color bgColor if textArea isCaretVisible return int caret textArea getCaretPosition if caret start caret end return int offset caret textArea getLineStartOffset physicalLine textArea offsetToXY physicalLine offset textArea returnValue int caretX textArea returnValue int height fm getHeight gfx setColor caretColor if blockCaret Graphics2D blockgfx Graphics2D gfx create blockgfx setXORMode bgColor if textArea isOverwriteEnabled blockgfx fillRect caretX height height textArea charWidth height else blockgfx fillRect caretX textArea charWidth height blockgfx dispose else if textArea isOverwriteEnabled gfx drawLine caretX height caretX textArea charWidth height else gfx drawLine caretX caretX height class PaintLineBackground extends TextAreaExtension boolean collapsedFold Color bgColor public void paintValidLine Graphics2D gfx int screenLine int physicalLine int start int end int JEditTextArea textArea TextAreaPainter this textArea Buffer buffer textArea getBuffer collapsedFold physicalLine buffer getLineCount buffer isFoldStart physicalLine textArea getFoldVisibilityManager isLineVisible physicalLine int caret textArea getCaretPosition boolean paintLineHighlight isLineHighlightEnabled caret start caret end textArea selection size if paintLineHighlight bgColor lineHighlightColor else if collapsedFold bgColor foldedLineColor else bgColor getBackground if paintLineHighlight collapsedFold gfx setColor bgColor gfx fillRect getWidth fm getHeight class PaintSelection extends TextAreaExtension public void paintValidLine Graphics2D gfx int screenLine int physicalLine int start int end int if textArea selection size return gfx setColor getSelectionColor for int textArea selection size paintSelection gfx screenLine physicalLine start end Selection textArea selection get private void paintSelection Graphics2D gfx int screenLine int physicalLine int start int end int Selection if end start start end return int selStartScreenLine textArea getScreenLineOfOffset start int selEndScreenLine textArea getScreenLineOfOffset end int lineStart textArea getLineStartOffset physicalLine start lineStart end lineStart int x1 x2 if instanceof Selection Rect int lineLen textArea getLineLength physicalLine int startOffset Math min lineLen start textArea getLineStartOffset startLine int endOffset Math min lineLen end textArea getLineStartOffset endLine if end startOffset start endOffset return x1 startOffset start textArea offsetToXY physicalLine startOffset textArea returnValue x2 endOffset end getWidth textArea offsetToXY physicalLine endOffset textArea returnValue if x1 x2 int tmp x2 x2 x1 x1 tmp else if selStartScreenLine selEndScreenLine selStartScreenLine x1 textArea offsetToXY physicalLine start lineStart textArea returnValue x2 textArea offsetToXY physicalLine end lineStart textArea returnValue else if screenLine selStartScreenLine x1 textArea offsetToXY physicalLine start lineStart textArea returnValue x2 getWidth else if screenLine selEndScreenLine x1 x2 textArea offsetToXY physicalLine end lineStart textArea returnValue else x1 x2 getWidth if x1 x2 x2 gfx fillRect x1 x2 x1 fm getHeight class WrapGuide extends TextAreaExtension public void paintValidLine Graphics2D gfx int screenLine int physicalLine int start int end int paintInvalidLine gfx screenLine public void paintInvalidLine Graphics2D gfx int screenLine int if textArea wrapToWidth textArea wrapMargin isWrapGuidePainted gfx setColor getWrapGuideColor int textArea getHorizontalOffset textArea wrapMargin gfx drawLine fm getHeight public String getToolTipText int int if textArea wrapToWidth textArea wrapMargin isWrapGuidePainted int wrapGuidePos textArea wrapMargin textArea getHorizontalOffset if Math abs wrapGuidePos return String valueOf textArea getBuffer getProperty return null class BracketHighlight extends TextAreaExtension public void paintValidLine Graphics2D gfx int screenLine int physicalLine int start int end int if isBracketHighlightEnabled textArea isBracketHighlightVisible return int bracketLine textArea getBracketLine int bracketOffset textArea getBracketPosition if bracketLine bracketOffset return int bracketLineStart textArea getLineStartOffset bracketLine if bracketOffset bracketLineStart start bracketOffset bracketLineStart end return textArea offsetToXY bracketLine bracketOffset textArea returnValue gfx setColor getBracketHighlightColor gfx drawRect textArea returnValue int gfx getFont getStringBounds getFontRenderContext getWidth fm getHeight class BSHIfStatement extends SimpleNode BSHIfStatement int id super id public Object eval CallStack callstack Interpreter interpreter throws EvalError Object ret null if evaluateCondition SimpleNode jjtGetChild callstack interpreter ret SimpleNode jjtGetChild eval callstack interpreter else if jjtGetNumChildren ret SimpleNode jjtGetChild eval callstack interpreter if ret instanceof ReturnControl return ret else return Primitive VOID public static boolean evaluateCondition SimpleNode condExp CallStack callstack Interpreter interpreter throws EvalError Object obj condExp eval callstack interpreter if obj instanceof Primitive if obj Primitive VOID throw new EvalError condExp obj Primitive obj getValue if obj instanceof Boolean return Boolean obj booleanValue else throw new EvalError condExp public class BrowserColorsOptionPane extends AbstractOptionPane public BrowserColorsOptionPane super protected void setLayout new BorderLayout colorsModel new BrowserColorsModel colorsTable new JTable colorsModel colorsTable setAutoResizeMode JTable AUTO_RESIZE_ALL_COLUMNS colorsTable getTableHeader setReorderingAllowed false colorsTable addMouseListener new MouseHandler colorsTable getSelectionModel addListSelectionListener new SelectionHandler TableColumnModel tcm colorsTable getColumnModel tcm getColumn setCellRenderer new BrowserColorsModel ColorRenderer Dimension colorsTable getPreferredSize height Math min height JScrollPane scroller new JScrollPane colorsTable scroller setPreferredSize add BorderLayout CENTER scroller JPanel buttons new JPanel buttons setLayout new BoxLayout buttons BoxLayout X_AXIS buttons setBorder new EmptyBorder buttons add Box createGlue add new JButton jEdit getProperty add addActionListener new ActionHandler buttons add add buttons add Box createHorizontalStrut remove new JButton jEdit getProperty remove addActionListener new ActionHandler buttons add remove buttons add Box createGlue add BorderLayout SOUTH buttons updateEnabled protected void colorsModel save private BrowserColorsModel colorsModel private JTable colorsTable private JButton add private JButton remove private void updateEnabled int selectedRow colorsTable getSelectedRow remove setEnabled selectedRow class SelectionHandler implements ListSelectionListener public void valueChanged ListSelectionEvent evt updateEnabled class ActionHandler implements ActionListener public void actionPerformed ActionEvent evt Object source evt getSource if source add colorsModel add else if source remove int selectedRow colorsTable getSelectedRow colorsModel remove selectedRow updateEnabled class MouseHandler extends MouseAdapter public void mouseClicked MouseEvent evt Point evt getPoint int row colorsTable rowAtPoint int column colorsTable columnAtPoint if row column return Color color JColorChooser showDialog BrowserColorsOptionPane this jEdit getProperty Color colorsModel getValueAt row if color null colorsModel setValueAt color row class BrowserColorsModel extends AbstractTableModel Vector entries BrowserColorsModel entries new Vector int String glob while glob jEdit getProperty null entries addElement new Entry glob jEdit getColorProperty Color black void add entries addElement new Entry UIManager getColor fireTableRowsInserted entries size entries size void remove int index entries removeElementAt index fireTableRowsDeleted entries size entries size void save int for entries size Entry entry Entry entries elementAt jEdit setProperty entry glob jEdit setColorProperty entry color jEdit unsetProperty jEdit unsetProperty public int getColumnCount return public int getRowCount return entries size public Object getValueAt int row int col Entry entry Entry entries elementAt row switch col case return entry glob case return entry color default return null public boolean isCellEditable int row int col return col public void setValueAt Object value int row int col Entry entry Entry entries elementAt row if col entry glob String value else entry color Color value fireTableRowsUpdated row row public String getColumnName int index switch index case return jEdit getProperty case return jEdit getProperty default return null public Class getColumnClass int col switch col case return String class case return Color class default throw new InternalError static class Entry String glob Color color Entry String glob Color color this glob glob this color color static class ColorRenderer extends JLabel implements TableCellRenderer public ColorRenderer setOpaque true setBorder StyleOptionPane noFocusBorder public Component getTableCellRendererComponent JTable table Object value boolean isSelected boolean cellHasFocus int row int col if isSelected setBackground table getSelectionBackground setForeground table getSelectionForeground else setBackground table getBackground setForeground table getForeground if value null setBackground Color value setBorder cellHasFocus UIManager getBorder StyleOptionPane noFocusBorder return this public class EditBus public static void addToBus EBComponent comp synchronized components components addElement comp copyComponents null public static void removeFromBus EBComponent comp synchronized components components removeElement comp copyComponents null public static EBComponent getComponents synchronized components if copyComponents null copyComponents new EBComponent components size components copyInto copyComponents return copyComponents public static void send EBMessage message Log log Log DEBUG EditBus class message toString EBComponent comps getComponents for int comps length try comps handleMessage message if message isVetoed break catch Throwable Log log Log ERROR EditBus class Log log Log ERROR EditBus class public static Object getNamedList Object tag Object list Object listArrays get tag if list null return list Vector listVector Vector listVectors get tag if listVector null list new Object listVector size listVector copyInto list listArrays put tag list return list return null public static Enumeration getNamedLists return listVectors keys public static void addToNamedList Object tag Object entry if tag equals org gjt sp jedit gui DockableWindow DOCKABLE_WINDOW_LIST org gjt sp jedit gui DockableWindowManager registerDockableWindow String entry null false jEdit getActionSets else Vector listVector Vector listVectors get tag if listVector null listVector new Vector listVectors put tag listVector listVector addElement entry listArrays remove tag public static void removeFromNamedList Object tag Object entry Vector listVector Vector listVectors get tag if listVector null return listVector removeElement entry listArrays remove tag private static Vector components new Vector private static EBComponent copyComponents private static Hashtable listVectors new Hashtable private static Hashtable listArrays new Hashtable private EditBus public class VariableGridLayout implements LayoutManager2 java io Serializable public static final int FIXED_NUM_ROWS public static final int FIXED_NUM_COLUMNS public VariableGridLayout int mode int size int hgap int vgap if mode FIXED_NUM_ROWS mode FIXED_NUM_COLUMNS throw new IllegalArgumentException mode if size throw new IllegalArgumentException size if hgap throw new IllegalArgumentException hgap if vgap throw new IllegalArgumentException vgap this mode mode this size size this hgap hgap this vgap vgap public VariableGridLayout int mode int size this mode size public VariableGridLayout this FIXED_NUM_ROWS public void addLayoutComponent String name Component component public void addLayoutComponent Component component Object constraints public void removeLayoutComponent Component component public float getLayoutAlignmentX Container container return public float getLayoutAlignmentY Container container return public Dimension preferredLayoutSize Container parent return getLayoutSize parent public Dimension minimumLayoutSize Container parent return getLayoutSize parent public Dimension maximumLayoutSize Container parent return getLayoutSize parent public void layoutContainer Container parent synchronized parent getTreeLock int ncomponents parent getComponentCount if ncomponents return int total_height for int nrows for int ncols if ncomponents Dimension parent getComponent getPreferredSize row_heights Math max row_heights height col_widths Math max col_widths width else break total_height row_heights int total_width for int ncols total_width col_widths Dimension parent_size parent getSize Insets insets parent getInsets int free_height parent_size height insets top insets bottom nrows vgap int free_width parent_size width insets left insets right ncols hgap if total_height free_height double dy double free_height double total_height for int nrows row_heights int double row_heights dy if total_width free_width double dx double free_width double total_width for int ncols col_widths int double col_widths dx for int insets top nrows row_heights vgap for int insets left ncols col_widths hgap if ncomponents parent getComponent setBounds col_widths row_heights public void invalidateLayout Container container int ncomponents container getComponentCount int old_nrows nrows int old_ncols ncols if this mode FIXED_NUM_ROWS nrows this size ncols ncomponents nrows nrows else ncols this size nrows ncomponents ncols ncols if old_nrows nrows row_heights new int nrows if old_ncols ncols col_widths new int ncols public int getRows return nrows public int getColumns return ncols public String toString return getClass getName mode size hgap vgap private Dimension getLayoutSize Container parent int which synchronized parent getTreeLock int ncomponents parent getComponentCount int int for int nrows int row_height for int ncols if ncomponents switch which case row_height Math max row_height parent getComponent getMinimumSize height break case row_height Math max row_height parent getComponent getMaximumSize height break default row_height Math max row_height parent getComponent getPreferredSize height break else break row_height for int ncols int col_width for int nrows int ncols if ncomponents switch which case col_width Math max col_width parent getComponent getMinimumSize width break case col_width Math max col_width parent getComponent getMaximumSize width break default col_width Math max col_width parent getComponent getPreferredSize width break else break col_width Insets insets parent getInsets return new Dimension insets left insets right ncols hgap insets top insets bottom nrows vgap private int mode private int size private int hgap private int vgap private transient int nrows private transient int ncols private transient int row_heights null private transient int col_widths null public class GutterOptionPane extends AbstractOptionPane public GutterOptionPane super public void lineNumbersEnabled new JCheckBox jEdit getProperty lineNumbersEnabled setSelected jEdit getBooleanProperty addComponent lineNumbersEnabled gutterFont new FontSelector jEdit getFontProperty new Font Font PLAIN addComponent jEdit getProperty gutterFont gutterBorderWidth new JTextField jEdit getProperty addComponent jEdit getProperty gutterBorderWidth gutterHighlightInterval new JTextField jEdit getProperty addComponent jEdit getProperty gutterHighlightInterval String alignments new String gutterNumberAlignment new JComboBox alignments String alignment jEdit getProperty if equals alignment gutterNumberAlignment setSelectedIndex else if equals alignment gutterNumberAlignment setSelectedIndex else gutterNumberAlignment setSelectedIndex addComponent jEdit getProperty gutterNumberAlignment gutterCurrentLineHighlightEnabled new JCheckBox jEdit getProperty gutterCurrentLineHighlightEnabled setSelected jEdit getBooleanProperty addComponent gutterCurrentLineHighlightEnabled gutterBracketHighlightEnabled new JCheckBox jEdit getProperty gutterBracketHighlightEnabled setSelected jEdit getBooleanProperty addComponent gutterBracketHighlightEnabled gutterMarkerHighlightEnabled new JCheckBox jEdit getProperty gutterMarkerHighlightEnabled setSelected jEdit getBooleanProperty addComponent gutterMarkerHighlightEnabled public void jEdit setFontProperty gutterFont getFont jEdit setProperty gutterBorderWidth getText jEdit setProperty gutterHighlightInterval getText String alignment null switch gutterNumberAlignment getSelectedIndex case alignment break case alignment break case default alignment jEdit setProperty alignment jEdit setBooleanProperty lineNumbersEnabled isSelected jEdit setBooleanProperty gutterCurrentLineHighlightEnabled isSelected jEdit setBooleanProperty gutterBracketHighlightEnabled isSelected jEdit setBooleanProperty gutterMarkerHighlightEnabled isSelected private FontSelector gutterFont private JTextField gutterBorderWidth private JTextField gutterHighlightInterval private JComboBox gutterNumberAlignment private JCheckBox lineNumbersEnabled private JCheckBox gutterCurrentLineHighlightEnabled private JCheckBox gutterBracketHighlightEnabled private JCheckBox gutterMarkerHighlightEnabled public class StyleOptionPane extends AbstractOptionPane public static final EmptyBorder noFocusBorder new EmptyBorder public StyleOptionPane super protected void setLayout new BorderLayout add BorderLayout CENTER createStyleTableScroller protected void styleModel save private StyleTableModel styleModel private JTable styleTable private JScrollPane createStyleTableScroller styleModel createStyleTableModel styleTable new JTable styleModel styleTable setRowSelectionAllowed false styleTable setColumnSelectionAllowed false styleTable setCellSelectionEnabled false styleTable getTableHeader setReorderingAllowed false styleTable addMouseListener new MouseHandler TableColumnModel tcm styleTable getColumnModel TableColumn styleColumn tcm getColumn styleColumn setCellRenderer new StyleTableModel StyleRenderer Dimension styleTable getPreferredSize height Math min height JScrollPane scroller new JScrollPane styleTable scroller setPreferredSize return scroller private StyleTableModel createStyleTableModel return new StyleTableModel class MouseHandler extends MouseAdapter public void mouseClicked MouseEvent evt int row styleTable rowAtPoint evt getPoint if row return SyntaxStyle style new StyleEditor StyleOptionPane this SyntaxStyle styleModel getValueAt row getStyle if style null styleModel setValueAt style row class StyleTableModel extends AbstractTableModel private Vector styleChoices StyleTableModel styleChoices new Vector addStyleChoice addStyleChoice addStyleChoice addStyleChoice addStyleChoice addStyleChoice addStyleChoice addStyleChoice addStyleChoice addStyleChoice addStyleChoice addStyleChoice addStyleChoice MiscUtilities quicksort styleChoices new MiscUtilities StringCompare public int getColumnCount return public int getRowCount return styleChoices size public Object getValueAt int row int col StyleChoice ch StyleChoice styleChoices elementAt row switch col case return ch label case return ch style default return null public void setValueAt Object value int row int col StyleChoice ch StyleChoice styleChoices elementAt row if col ch style SyntaxStyle value fireTableRowsUpdated row row public String getColumnName int index switch index case return jEdit getProperty case return jEdit getProperty default return null public void save for int styleChoices size StyleChoice ch StyleChoice styleChoices elementAt jEdit setProperty ch property GUIUtilities getStyleString ch style private void addStyleChoice String label String property styleChoices addElement new StyleChoice jEdit getProperty label property GUIUtilities parseStyle jEdit getProperty property static class StyleChoice String label String property SyntaxStyle style StyleChoice String label String property SyntaxStyle style this label label this property property this style style public String toString return label static class StyleRenderer extends JLabel implements TableCellRenderer public StyleRenderer setOpaque true setBorder StyleOptionPane noFocusBorder setText public Component getTableCellRendererComponent JTable table Object value boolean isSelected boolean cellHasFocus int row int col if value null SyntaxStyle style SyntaxStyle value setForeground style getForegroundColor if style getBackgroundColor null setBackground style getBackgroundColor else setBackground jEdit getColorProperty setFont style getFont setBorder cellHasFocus UIManager getBorder StyleOptionPane noFocusBorder return this class StyleEditor extends EnhancedDialog implements ActionListener StyleEditor Component comp SyntaxStyle style super JOptionPane getFrameForComponent comp jEdit getProperty true JPanel content new JPanel new BorderLayout content setBorder new EmptyBorder setContentPane content GridBagLayout layout new GridBagLayout JPanel panel new JPanel layout GridBagConstraints cons new GridBagConstraints cons gridx cons gridy cons gridwidth cons gridheight cons fill GridBagConstraints BOTH cons weightx cons insets new Insets italics new JCheckBox jEdit getProperty italics setSelected style getFont isItalic layout setConstraints italics cons panel add italics cons gridy bold new JCheckBox jEdit getProperty bold setSelected style getFont isBold layout setConstraints bold cons panel add bold cons gridy cons gridwidth Color fg style getForegroundColor fgColorCheckBox new JCheckBox jEdit getProperty fgColorCheckBox setSelected fg null fgColorCheckBox addActionListener this layout setConstraints fgColorCheckBox cons panel add fgColorCheckBox cons gridx fgColor new JButton fgColor setEnabled fg null fgColor setRequestFocusEnabled false fgColor addActionListener this fgColor setMargin new Insets if fg null fgColor setBackground jEdit getColorProperty else fgColor setBackground fg layout setConstraints fgColor cons panel add fgColor cons gridx cons gridy Color bg style getBackgroundColor bgColorCheckBox new JCheckBox jEdit getProperty bgColorCheckBox setSelected bg null bgColorCheckBox addActionListener this layout setConstraints bgColorCheckBox cons panel add bgColorCheckBox cons gridx bgColor new JButton bgColor setEnabled bg null bgColor setRequestFocusEnabled false bgColor addActionListener this bgColor setMargin new Insets if bg null bgColor setBackground jEdit getColorProperty else bgColor setBackground bg layout setConstraints bgColor cons panel add bgColor content add BorderLayout CENTER panel Box box new Box BoxLayout X_AXIS box add Box createGlue box add ok new JButton jEdit getProperty getRootPane setDefaultButton ok ok addActionListener this box add Box createHorizontalStrut box add cancel new JButton jEdit getProperty cancel addActionListener this box add Box createGlue content add BorderLayout SOUTH box Dimension screen getToolkit getScreenSize pack setLocationRelativeTo JOptionPane getFrameForComponent comp show public void actionPerformed ActionEvent evt Object source evt getSource if source ok ok else if source cancel cancel else if source fgColor source bgColor JButton JButton source Color JColorChooser showDialog this jEdit getProperty getBackground if null setBackground else if source fgColorCheckBox fgColor setEnabled fgColorCheckBox isSelected else if source bgColorCheckBox bgColor setEnabled bgColorCheckBox isSelected public void ok okClicked true dispose public void cancel dispose public SyntaxStyle getStyle if okClicked return null Color foreground fgColorCheckBox isSelected fgColor getBackground null Color background bgColorCheckBox isSelected bgColor getBackground null return new SyntaxStyle foreground background new Font italics isSelected Font ITALIC bold isSelected Font BOLD private JCheckBox italics private JCheckBox bold private JCheckBox fgColorCheckBox private JButton fgColor private JCheckBox bgColorCheckBox private JButton bgColor private JButton ok private JButton cancel private boolean okClicked class BSHArrayInitializer extends SimpleNode BSHArrayInitializer int id super id public Object eval CallStack callstack Interpreter interpreter throws EvalError throw new EvalError public Object eval Class baseType int dimensions CallStack callstack Interpreter interpreter throws EvalError int numInitializers jjtGetNumChildren dima numInitializers Object initializers Array newInstance baseType dima for int numInitializers SimpleNode node SimpleNode jjtGetChild Object currentInitializer if node instanceof BSHArrayInitializer if dimensions throw new EvalError this currentInitializer BSHArrayInitializer node eval baseType dimensions callstack interpreter else currentInitializer node eval callstack interpreter if currentInitializer Primitive VOID throw new EvalError this Object value if currentInitializer instanceof Primitive value Primitive currentInitializer getValue else value currentInitializer try Array set initializers value catch IllegalArgumentException Interpreter debug throwTypeError baseType currentInitializer Interpreter debug throwTypeError baseType currentInitializer return initializers private void throwTypeError Class baseType Object initializer int argNum throws EvalError String lhsType Reflect normalizeClassName baseType String rhsType if initializer instanceof Primitive rhsType Primitive initializer getType getName else rhsType Reflect normalizeClassName initializer getClass throw new EvalError rhsType baseType argNum this public class DummyFoldHandler extends FoldHandler public DummyFoldHandler super public int getFoldLevel Buffer buffer int lineIndex Segment seg return public class RecentDirectoriesMenu extends EnhancedMenu public RecentDirectoriesMenu super public void setPopupMenuVisible boolean if final View view GUIUtilities getView this if getMenuComponentCount removeAll ActionListener actionListener new ActionListener public void actionPerformed ActionEvent evt VFSBrowser browseDirectory view evt getActionCommand view getStatus setMessage null MouseListener mouseListener new MouseAdapter public void mouseEntered MouseEvent evt view getStatus setMessage JMenuItem evt getSource getActionCommand public void mouseExited MouseEvent evt view getStatus setMessage null HistoryModel model HistoryModel getModel if model getSize add GUIUtilities loadMenuItem super setPopupMenuVisible return boolean sort jEdit getBooleanProperty Vector menuItems new Vector for int model getSize String path model getItem VFS vfs VFSManager getVFSForPath path JMenuItem menuItem new JMenuItem vfs getFileName path menuItem setActionCommand path menuItem addActionListener actionListener menuItem addMouseListener mouseListener menuItem setIcon FileCellRenderer dirIcon if sort menuItems addElement menuItem else add menuItem if sort MiscUtilities quicksort menuItems new MiscUtilities MenuItemCompare for int menuItems size add JMenuItem menuItems elementAt super setPopupMenuVisible public class RootElement implements Element public RootElement Buffer buffer this buffer buffer public Document getDocument return null public Element getParentElement return null public String getName return null public AttributeSet getAttributes return null public int getStartOffset return public int getEndOffset return buffer getLength public int getElementIndex int offset return buffer getLineOfOffset offset public int getElementCount return buffer getLineCount public Element getElement int line return new LineElement buffer line public boolean isLeaf return false private Buffer buffer public class IndentFoldHandler extends FoldHandler public IndentFoldHandler super public int getFoldLevel Buffer buffer int lineIndex Segment seg int tabSize buffer getTabSize buffer getLineText lineIndex seg int offset seg offset int count seg count int whitespace boolean seenNonWhiteSpace false loop for int count switch seg array offset case whitespace break case whitespace tabSize whitespace tabSize break default seenNonWhiteSpace true break loop if seenNonWhiteSpace if lineIndex return buffer getFoldLevel lineIndex else return return whitespace public class BeanShellAction extends EditAction public BeanShellAction String name String code String isSelected boolean noRepeat boolean noRecord super name this code code this isSelected isSelected this noRepeat noRepeat this noRecord noRecord sanitizedName name replace replace if isSelected null String cachedIsSelectedName sanitizedName try cachedIsSelected BeanShell cacheBlock cachedIsSelectedName isSelected true catch Exception Log log Log ERROR this new BeanShellErrorDialog null toString public void invoke View view try if cachedCode null String cachedCodeName sanitizedName cachedCode BeanShell cacheBlock cachedCodeName code true BeanShell runCachedBlock cachedCode view null catch Throwable Log log Log ERROR this new BeanShellErrorDialog view toString public boolean isToggle return isSelected null public boolean isSelected View view if isSelected null return false try return Boolean TRUE equals BeanShell runCachedBlock cachedIsSelected view null catch Throwable Log log Log ERROR this new BeanShellErrorDialog view toString return false public boolean noRepeat return noRepeat public boolean noRecord return noRecord public String getCode return code trim private boolean noRepeat private boolean noRecord private String code private String isSelected private String cachedCode private String cachedIsSelected private String sanitizedName public class ChunkCache public static void lineToChunkList Segment seg Token tokens SyntaxStyle styles FontRenderContext fontRenderContext TabExpander float wrapMargin java util List out if wrapMargin wrapMargin float float endX boolean seenNonWhiteSpace false boolean addedNonWhiteSpace false boolean lastWasSpace false float firstNonWhiteSpace Chunk first null Chunk current null Chunk end null int tokenListOffset while tokens id Token END int flushIndex tokenListOffset for int tokenListOffset tokenListOffset tokens length char ch seg array seg offset if ch ch wrapMargin if flushIndex Chunk newChunk new Chunk tokens id seg flushIndex styles fontRenderContext if current null current next newChunk current newChunk newChunk width lastWasSpace false seenNonWhiteSpace true if end null lastWasSpace addedNonWhiteSpace wrapMargin wrapMargin if first null out add first first new Chunk firstNonWhiteSpace end offset first next end next end next null firstNonWhiteSpace endX if first null first current if ch Chunk newChunk new Chunk tokens id seg styles fontRenderContext if first null first current newChunk else current next newChunk current newChunk current width else if ch Chunk newChunk new Chunk tokens id seg styles fontRenderContext if first null first current newChunk else current next newChunk current newChunk float newX nextTabStop tokenListOffset current width newX newX current length if first null first current end current endX if flushIndex flushIndex lastWasSpace true addedNonWhiteSpace seenNonWhiteSpace if seenNonWhiteSpace firstNonWhiteSpace else if tokenListOffset tokens length if flushIndex Chunk newChunk new Chunk tokens id seg flushIndex styles fontRenderContext if current null current next newChunk current newChunk newChunk width seenNonWhiteSpace true lastWasSpace false if seg count wrapMargin wrapMargin addedNonWhiteSpace end null if first null out add first first new Chunk firstNonWhiteSpace end offset first next end next end next null firstNonWhiteSpace endX if first null first current addedNonWhiteSpace seenNonWhiteSpace tokenListOffset tokens length tokens tokens next if first null out add first public static float paintChunkList Chunk chunks Graphics2D gfx float float Color background boolean glyphVector FontMetrics forBackground gfx getFontMetrics float Chunk first chunks Font lastFont null Color lastColor null while chunks null if chunks inaccessable Font font chunks style getFont Color bgColor chunks style getBackgroundColor if bgColor null float x2 chunks width Graphics2D xorGfx Graphics2D gfx create xorGfx setXORMode background xorGfx setColor bgColor xorGfx fill new Rectangle2D Float forBackground getAscent x2 forBackground getHeight xorGfx dispose if chunks str null gfx setFont font gfx setColor chunks style getForegroundColor if glyphVector gfx drawGlyphVector chunks text else gfx drawString chunks str chunks width chunks chunks next return public static float offsetToX Chunk chunks int offset if chunks null offset chunks offset throw new ArrayIndexOutOfBoundsException offset chunks offset float while chunks null if chunks inaccessable offset chunks offset chunks length if chunks text null break else return chunks positions offset chunks offset chunks width chunks chunks next return public static int xToOffset Chunk chunks float boolean round float while chunks null if chunks inaccessable chunks width if chunks text null if round chunks width return chunks offset chunks length else return chunks offset else float xInChunk for int chunks length float glyphX chunks positions float nextX chunks length chunks width chunks positions if nextX xInChunk if round nextX xInChunk xInChunk glyphX return chunks offset else return chunks offset chunks width chunks chunks next return public static class Chunk public boolean inaccessable public float width public SyntaxStyle style public int offset public int length public String str public GlyphVector text public float positions public Chunk next Chunk float width int offset inaccessable true this width width this offset offset Chunk int tokenType Segment seg int offset int end SyntaxStyle styles FontRenderContext fontRenderContext style styles tokenType if offset end length end offset str new String seg array seg offset offset length text style getFont createGlyphVector fontRenderContext str width float text getLogicalBounds getWidth positions text getGlyphPositions length null this offset offset ChunkCache JEditTextArea textArea this textArea textArea out new ArrayList int getMaxHorizontalScrollWidth int max for int lineInfo length LineInfo info lineInfo if info chunksValid info width max max info width return max int getScreenLineOfOffset int line int offset if line textArea getFirstPhysicalLine return else if line textArea getLastPhysicalLine return else if textArea softWrap return textArea physicalToVirtual line textArea getFirstLine else int screenLine if line lastScreenLineP LineInfo last lineInfo lastScreenLine if offset last offset offset last offset last length updateChunksUpTo lastScreenLine return lastScreenLine screenLine for int lineInfo length updateChunksUpTo LineInfo info getLineInfo if info physicalLine line if screenLine else screenLine break else if info physicalLine line if offset info offset offset info offset info length screenLine break if screenLine return else lastScreenLineP line lastScreenLine screenLine return screenLine void recalculateVisibleLines lineInfo new LineInfo textArea getVisibleLines for int lineInfo length lineInfo new LineInfo lastScreenLine lastScreenLineP void setFirstLine int firstLine if textArea softWrap Math abs firstLine this firstLine lineInfo length for int lineInfo length lineInfo chunksValid false else if firstLine this firstLine System arraycopy lineInfo firstLine this firstLine lineInfo lineInfo length firstLine this firstLine for int lineInfo length firstLine this firstLine lineInfo length lineInfo new LineInfo else if this firstLine firstLine System arraycopy lineInfo lineInfo this firstLine firstLine lineInfo length this firstLine firstLine for int this firstLine firstLine lineInfo new LineInfo lastScreenLine lastScreenLineP this firstLine firstLine void invalidateAll for int lineInfo length lineInfo chunksValid false lastScreenLine lastScreenLineP void invalidateChunksFrom int screenLine for int screenLine lineInfo length lineInfo chunksValid false lastScreenLine lastScreenLineP void invalidateChunksFromPhys int physicalLine for int lineInfo length if lineInfo physicalLine physicalLine invalidateChunksFrom break void lineToChunkList int physicalLine ArrayList out TextAreaPainter painter textArea getPainter Buffer buffer textArea getBuffer buffer getLineText physicalLine textArea lineSegment lineToChunkList textArea lineSegment buffer markTokens physicalLine getFirstToken painter getStyles painter getFontRenderContext painter textArea softWrap textArea wrapMargin out void updateChunksUpTo int lastScreenLine if textArea softWrap return if lineInfo lastScreenLine chunksValid return int firstScreenLine for int lastScreenLine if lineInfo chunksValid firstScreenLine break int physicalLine if firstScreenLine physicalLine textArea getFirstPhysicalLine else int prevPhysLine lineInfo firstScreenLine physicalLine if prevPhysLine physicalLine else physicalLine textArea getFoldVisibilityManager getNextVisibleLine prevPhysLine out clear int offset int length for int firstScreenLine lastScreenLine LineInfo info lineInfo Chunk chunks if out size if physicalLine firstScreenLine physicalLine textArea getFoldVisibilityManager getNextVisibleLine physicalLine if physicalLine info chunks null info chunksValid true info physicalLine continue lineToChunkList physicalLine out info firstSubregion true if out size chunks null offset length else chunks Chunk out get out remove offset if out size length Chunk out get offset offset else length textArea getLineLength physicalLine offset else info firstSubregion false chunks Chunk out get out remove offset chunks offset if out size length Chunk out get offset offset else length textArea getLineLength physicalLine offset boolean lastSubregion out size if lastScreenLine lastScreenLine lineInfo length if info physicalLine physicalLine info lastSubregion lastSubregion lastScreenLine needFullRepaint true else if out size lastScreenLine info physicalLine physicalLine info lastSubregion lastSubregion info offset offset info length length info chunks chunks info chunksValid true LineInfo getLineInfo int screenLine LineInfo info lineInfo screenLine if textArea softWrap if info chunksValid Log log Log ERROR this screenLine return info else if info chunksValid int virtLine screenLine firstLine if virtLine textArea getVirtualLineCount info chunks null info chunksValid true info physicalLine else info physicalLine textArea getFoldVisibilityManager virtualToPhysical virtLine out clear lineToChunkList info physicalLine out info firstSubregion true info lastSubregion true info offset info length textArea getLineLength info physicalLine info chunks out size null Chunk out get info chunksValid true return info public LineInfo getLineInfosForPhysicalLine int physicalLine out clear lineToChunkList physicalLine out if out size out add null LineInfo returnValue new LineInfo out size for int out size Chunk chunks Chunk out get LineInfo info new LineInfo info physicalLine physicalLine if info firstSubregion true info offset else info offset chunks offset if out size info lastSubregion true info length textArea getLineLength physicalLine info offset else info length Chunk out get offset info offset info chunksValid true info chunks chunks returnValue info return returnValue boolean needFullRepaint boolean retVal needFullRepaint needFullRepaint false return retVal LineInfo getLineInfoBackwardsCompatibility int physicalLineIndex LineInfo info new LineInfo out clear Buffer buffer textArea getBuffer buffer getLineText physicalLineIndex textArea lineSegment TextAreaPainter painter textArea getPainter lineToChunkList textArea lineSegment buffer markTokens physicalLineIndex getFirstToken painter getStyles painter getFontRenderContext painter out if out size info chunks null else info chunks Chunk out get info physicalLine physicalLineIndex info chunksValid true return info private JEditTextArea textArea private int firstLine private LineInfo lineInfo private ArrayList out private int lastScreenLineP private int lastScreenLine private boolean needFullRepaint static class LineInfo int physicalLine int offset int length boolean firstSubregion boolean lastSubregion boolean chunksValid Chunk chunks int width class BshMethod implements java io Serializable BSHMethodDeclaration method NameSpace declaringNameSpace private Class argTypes BshMethod BSHMethodDeclaration method NameSpace declaringNameSpace this method method this declaringNameSpace declaringNameSpace public Class getArgTypes if argTypes null argTypes method params argTypes return argTypes public Object invokeDeclaredMethod Object argValues Interpreter interpreter CallStack callstack SimpleNode callerInfo throws EvalError if argValues null argValues new Object if argValues length method params numArgs try String help String declaringNameSpace get method name interpreter interpreter println help return Primitive VOID catch Exception throw new EvalError method name callerInfo NameSpace localNameSpace new NameSpace declaringNameSpace method name localNameSpace setNode callerInfo for int method params numArgs if method params argTypes null try argValues NameSpace getAssignableForm argValues method params argTypes catch EvalError throw new EvalError method params argNames method name getMessage callerInfo localNameSpace setTypedVariable method params argNames method params argTypes argValues false if argValues Primitive VOID throw new EvalError method params argNames method name callerInfo else localNameSpace setVariable method params argNames argValues callstack push localNameSpace Object ret method block eval callstack interpreter true callstack pop if ret instanceof ReturnControl ReturnControl rs ReturnControl ret if rs kind rs RETURN ret ReturnControl ret value else throw new EvalError method if method returnType null if method returnType Primitive VOID return method returnType try ret NameSpace getAssignableForm ret Class method returnType catch EvalError throw new EvalError method name getMessage method return ret public String toString return method name public class ReadWriteLock public synchronized void readLock if activeReaders allowRead activeReaders return waitingReaders while allowRead try wait catch InterruptedException Log log Log ERROR this return waitingReaders activeReaders readers addElement Thread currentThread public synchronized void readUnlock if activeReaders throw new InternalError activeReaders notifyAll public synchronized void writeLock if writerThread null if Thread currentThread writerThread lockCount return if allowWrite claimWriteLock return waitingWriters while allowWrite try wait catch InterruptedException waitingWriters Log log Log ERROR this return waitingWriters claimWriteLock public synchronized void writeUnlock if activeWriters lockCount throw new InternalError if Thread currentThread writerThread throw new InternalError if lockCount activeWriters writerThread null notifyAll public synchronized boolean isWriteLocked return activeWriters private int activeReaders private int activeWriters private int waitingReaders private int waitingWriters private Vector readers new Vector private Thread writerThread private int lockCount private final boolean allowRead return Thread currentThread writerThread waitingWriters activeWriters private final boolean allowWrite return activeReaders activeWriters private void claimWriteLock activeWriters writerThread Thread currentThread lockCount public class REException extends Exception private int type private int pos public static final int REG_BADRPT public static final int REG_BADBR public static final int REG_EBRACE public static final int REG_EBRACK public static final int REG_ERANGE public static final int REG_ECTYPE public static final int REG_EPAREN public static final int REG_ESUBREG public static final int REG_EEND public static final int REG_ESCAPE public static final int REG_BADPAT public static final int REG_ESIZE public static final int REG_ESPACE REException String msg int type int position super msg this type type this pos position public int getType return type public int getPosition return pos public String getMessage Object args new Integer pos StringBuffer sb new StringBuffer String prefix RE getLocalizedMessage sb append MessageFormat format prefix args sb append sb append super getMessage return sb toString class BSHLHSPrimaryExpression extends SimpleNode BSHLHSPrimaryExpression int id super id public LHS toLHS CallStack callstack Interpreter interpreter throws EvalError int childNum SimpleNode prefixNode SimpleNode jjtGetChild childNum Object prefixValue null LHS lhs null if prefixNode instanceof BSHAmbiguousName lhs BSHAmbiguousName prefixNode toLHS callstack interpreter else prefixValue SimpleNode prefixNode eval callstack interpreter if prefixValue null lhs BSHLHSPrimarySuffix jjtGetChild childNum doLHSSuffix prefixValue callstack interpreter int numChildren jjtGetNumChildren while childNum numChildren lhs BSHLHSPrimarySuffix jjtGetChild childNum doLHSSuffix lhs getValue callstack interpreter return lhs public class StringUtil public static String split String String delim Vector new Vector StringTokenizer st new StringTokenizer delim while st hasMoreTokens addElement st nextToken String sa new String size copyInto sa return sa public static String bubbleSort String in Vector new Vector for int in length addElement in int size boolean swap true while swap swap false for int if String elementAt compareTo String elementAt String tmp String elementAt removeElementAt insertElementAt tmp swap true String out new String copyInto out return out public static String maxCommonPrefix String one String two int while one regionMatches two return one substring public static String methodString String name Class types StringBuffer sb new StringBuffer name if types length sb append for int types length Class types sb append null getName if types length Class types types length sb append null getName sb append sb append return sb toString class Name implements java io Serializable public NameSpace namespace String value null private boolean literalThisReference private boolean literalCallerReference private void reset evalName value evalBaseObject null callstackDepth literalThisReference false literalCallerReference false public Name NameSpace namespace String this namespace namespace value public Object toObject CallStack callstack Interpreter interpreter throws EvalError return toObject callstack interpreter false synchronized public Object toObject CallStack callstack Interpreter interpreter boolean forceClass throws EvalError reset Object obj null while evalName null obj consumeNextObjectField callstack interpreter forceClass if obj null throw new InterpreterError return obj private Object consumeNextObjectField CallStack callstack Interpreter interpreter boolean forceClass throws EvalError if evalBaseObject null isCompound evalName forceClass Object obj resolveThisFieldReference callstack namespace interpreter evalName false if obj Primitive VOID if evalBaseObject null evalBaseObject instanceof This forceClass String varName prefix evalName Interpreter debug varName Object obj if evalBaseObject null obj resolveThisFieldReference callstack namespace interpreter varName false else obj resolveThisFieldReference callstack This evalBaseObject namespace interpreter varName true if obj Primitive VOID Interpreter debug varName namespace evalName suffix evalName return evalBaseObject obj if evalBaseObject null Interpreter debug evalName Class clas null int for countParts evalName if clas namespace getClass prefix evalName null break if clas null evalName suffix evalName countParts evalName return evalBaseObject new ClassIdentifier clas Interpreter debug evalName if evalBaseObject null if isCompound evalName else throw new EvalError evalName throw new TargetError value new NullPointerException throw new EvalError value if evalBaseObject instanceof Primitive throw new EvalError value if evalBaseObject instanceof ClassIdentifier Class clas ClassIdentifier evalBaseObject getTargetClass String field prefix evalName Object obj null try obj Reflect getStaticField clas field catch ReflectError if obj null String iclass clas getName field Class namespace getClass iclass if null obj new ClassIdentifier if obj null throw new EvalError field clas evalName suffix evalName return evalBaseObject obj if forceClass throw new EvalError value String field prefix evalName if field equals evalBaseObject getClass isArray Object obj new Primitive Array getLength evalBaseObject evalName suffix evalName return evalBaseObject obj try Object obj Reflect getObjectField evalBaseObject field evalName suffix evalName return evalBaseObject obj throw new EvalError field evalBaseObject Object resolveThisFieldReference CallStack callstack NameSpace thisNamespace Interpreter interpreter String varName boolean specialFieldsVisible throws EvalError Object obj null boolean wasThis false wasCaller false if varName equals if specialFieldsVisible throw new EvalError obj thisNamespace getThis interpreter wasThis true if obj null if varName equals obj thisNamespace getSuper getThis interpreter else if varName equals obj thisNamespace getGlobal getThis interpreter if obj null specialFieldsVisible if varName equals obj thisNamespace else if varName equals obj thisNamespace getVariableNames else if varName equals obj thisNamespace getMethodNames else if varName equals if literalThisReference obj interpreter else throw new EvalError if obj null specialFieldsVisible varName equals if literalThisReference literalCallerReference if callstack null throw new InterpreterError obj callstack get callstackDepth getThis interpreter else throw new EvalError wasCaller true if obj null specialFieldsVisible varName equals if literalThisReference if callstack null throw new InterpreterError obj callstack else throw new EvalError if obj null obj thisNamespace getVariable varName literalThisReference wasThis literalCallerReference wasCaller return obj synchronized public Class toClass throws EvalError reset Class clas namespace getClass evalName if clas null Object obj null try obj toObject null null true if obj instanceof ClassIdentifier clas ClassIdentifier obj getTargetClass if clas null throw new EvalError value return clas synchronized public LHS toLHS CallStack callstack Interpreter interpreter throws EvalError reset if isCompound evalName return new LHS namespace evalName Object obj null try while isCompound evalName obj consumeNextObjectField callstack interpreter false catch EvalError throw new EvalError if obj null throw new InterpreterError if obj instanceof This Interpreter debug return new LHS This obj namespace evalName if evalName null try if obj instanceof ClassIdentifier Class clas ClassIdentifier obj getTargetClass return Reflect getLHSStaticField clas evalName else return Reflect getLHSObjectField obj evalName catch ReflectError throw new EvalError throw new InterpreterError private BshMethod toLocalMethod Object args Class sig Reflect getTypes args return namespace getMethod value sig public Object invokeMethod Interpreter interpreter Object args CallStack callstack SimpleNode callerInfo throws EvalError ReflectError InvocationTargetException if Name isCompound value return invokeLocalMethod interpreter args callstack callerInfo Name targetName namespace getNameResolver Name prefix value String methodName Name suffix value Object obj targetName toObject callstack interpreter if obj Primitive VOID throw new EvalError methodName targetName if obj instanceof Name ClassIdentifier if obj instanceof Primitive if obj Primitive NULL throw new TargetError new NullPointerException interpreter error return Reflect invokeObjectMethod interpreter obj methodName args callerInfo Interpreter debug targetName Class clas Name ClassIdentifier obj getTargetClass if clas null return Reflect invokeStaticMethod clas methodName args throw new EvalError targetName public Object invokeLocalMethod Interpreter interpreter Object args CallStack callstack SimpleNode callerInfo throws EvalError ReflectError InvocationTargetException Interpreter debug value BshMethod meth toLocalMethod args if meth null return meth invokeDeclaredMethod args interpreter callstack callerInfo else Interpreter debug value String commandName value InputStream in Interpreter class getResourceAsStream commandName if in null Interpreter debug commandName if interpreter null throw new InterpreterError interpreter eval new InputStreamReader in namespace commandName meth toLocalMethod args if meth null return meth invokeDeclaredMethod args interpreter callstack callerInfo else throw new EvalError commandName commandName value Class BshClassManager classForName commandName if null throw new EvalError value Object invokeArgs new Object args length invokeArgs interpreter invokeArgs namespace System arraycopy args invokeArgs args length try return Reflect invokeStaticMethod invokeArgs catch ReflectError Interpreter debug try String String Reflect invokeStaticMethod null interpreter println return Primitive VOID catch ReflectError Interpreter debug throw new EvalError static boolean isCompound String value return countParts value static int countParts String value if value null return int count int index while index value indexOf index count return count static String prefix String value if isCompound value return null return prefix value countParts value static String prefix String value int parts if parts return null int count int index while index value indexOf index count parts return index value value substring index static String suffix String name if isCompound name return null return suffix name countParts name public static String suffix String value int parts if parts return null int count int index value length while index value lastIndexOf index count parts return index value value substring index public String toString return value static class ClassIdentifier Class clas public ClassIdentifier Class clas this clas clas public Class getTargetClass return clas public String toString return clas getName public class OpenWithEncodingMenu extends EnhancedMenu public OpenWithEncodingMenu super ActionListener listener new ActionListener public void actionPerformed ActionEvent evt Hashtable props new Hashtable props put evt getActionCommand jEdit showOpenFileDialog GUIUtilities getView Component evt getSource props String systemEncoding System getProperty JMenuItem mi new JMenuItem jEdit getProperty mi setActionCommand systemEncoding mi addActionListener listener add mi mi new JMenuItem jEdit getProperty mi setActionCommand jEdit getProperty systemEncoding mi addActionListener listener add mi addSeparator StringTokenizer st new StringTokenizer jEdit getProperty while st hasMoreTokens mi new JMenuItem st nextToken mi addActionListener listener add mi addSeparator add GUIUtilities loadMenuItem public final class REMatch implements Serializable Cloneable private String matchedText int offset int anchor public Object clone try REMatch copy REMatch super clone copy next null copy start int start clone copy end int end clone return copy catch CloneNotSupportedException void assignFrom REMatch other start other start end other end index other index next other next REMatch int subs int anchor int eflags start new int subs end new int subs this anchor anchor this eflags eflags clear anchor void finish CharIndexed text start StringBuffer sb new StringBuffer int for end sb append text charAt matchedText sb toString for start length if start end start end void clear int index offset index this index for int start length start end public String toString return matchedText public int getStartIndex return offset start public int getEndIndex return offset end public String toString int sub if sub start length start sub return return matchedText substring start sub end sub public int getSubStartIndex int sub if sub start length return int start sub return offset public int getStartIndex int sub if sub start length return int start sub return offset public int getSubEndIndex int sub if sub start length return int end sub return offset public int getEndIndex int sub if sub start length return int end sub return offset public String substituteInto String input StringBuffer output new StringBuffer int pos for pos pos input length pos if input charAt pos Character isDigit input charAt pos int val Character digit input charAt pos if val start length output append toString val else output append input charAt pos if pos input length output append input charAt pos return output toString public abstract class WorkRequest implements Runnable public void setAbortable boolean abortable Thread thread Thread currentThread if thread instanceof WorkThread WorkThread thread setAbortable abortable public void setStatus String status Thread thread Thread currentThread if thread instanceof WorkThread WorkThread thread setStatus status public void setProgressValue int value Thread thread Thread currentThread if thread instanceof WorkThread WorkThread thread setProgressValue value public void setProgressMaximum int value Thread thread Thread currentThread if thread instanceof WorkThread WorkThread thread setProgressMaximum value class InstallPluginsDialog extends EnhancedDialog static final int INSTALL static final int UPDATE InstallPluginsDialog JDialog dialog Vector model int mode super JOptionPane getFrameForComponent dialog mode INSTALL jEdit getProperty jEdit getProperty true JPanel content new JPanel new BorderLayout content setBorder new EmptyBorder setContentPane content JLabel label new JLabel jEdit getProperty content add BorderLayout NORTH label plugins new JCheckBoxList model plugins getSelectionModel addListSelectionListener new ListHandler plugins getModel addTableModelListener new TableModelHandler JScrollPane scroller new JScrollPane plugins scroller setPreferredSize new Dimension content add BorderLayout WEST scroller JPanel panel new JPanel new BorderLayout panel setBorder new TitledBorder jEdit getProperty JPanel labelAndValueBox new JPanel new BorderLayout JPanel labelBox new JPanel new GridLayout mode UPDATE labelBox setBorder new EmptyBorder labelBox add new JLabel jEdit getProperty SwingConstants RIGHT labelBox add new JLabel jEdit getProperty SwingConstants RIGHT labelBox add new JLabel jEdit getProperty SwingConstants RIGHT labelBox add new JLabel jEdit getProperty SwingConstants RIGHT if mode UPDATE labelBox add new JLabel jEdit getProperty SwingConstants RIGHT labelBox add new JLabel jEdit getProperty SwingConstants RIGHT labelBox add new JLabel jEdit getProperty SwingConstants RIGHT labelAndValueBox add BorderLayout WEST labelBox JPanel valueBox new JPanel new GridLayout mode UPDATE valueBox setBorder new EmptyBorder valueBox add name new JLabel valueBox add author new JLabel valueBox add size new JLabel valueBox add latestVersion new JLabel if mode UPDATE valueBox add installedVersion new JLabel valueBox add updated new JLabel valueBox add Box createGlue labelAndValueBox add BorderLayout CENTER valueBox panel add BorderLayout NORTH labelAndValueBox description new JTextArea description setEditable false description setLineWrap true description setWrapStyleWord true panel add BorderLayout CENTER new JScrollPane description content add BorderLayout CENTER panel panel new JPanel new BorderLayout JPanel panel2 new JPanel new GridLayout mode INSTALL Box totalSizeBox new Box BoxLayout X_AXIS totalSizeBox add new JLabel jEdit getProperty totalSizeBox add Box createHorizontalStrut totalSizeBox add totalSize new JLabel panel2 add totalSizeBox panel2 add downloadSource new JCheckBox jEdit getProperty downloadSource setSelected jEdit getBooleanProperty downloadSource addActionListener new ActionHandler if mode INSTALL ButtonGroup grp new ButtonGroup installUser new JRadioButton String settings jEdit getSettingsDirectory if settings null settings jEdit getProperty installUser setEnabled false else settings MiscUtilities constructPath settings installUser setEnabled true String args settings installUser setText jEdit getProperty args grp add installUser panel2 add installUser installSystem new JRadioButton String jEditHome jEdit getJEditHome if jEditHome null jEditHome jEdit getProperty installSystem setEnabled false else jEditHome MiscUtilities constructPath jEditHome installSystem setEnabled true args jEditHome installSystem setText jEdit getProperty args grp add installSystem panel2 add installSystem if installUser isEnabled installUser setSelected true else installSystem setSelected true panel add BorderLayout NORTH panel2 Box box new Box BoxLayout X_AXIS box add Box createGlue install new JButton jEdit getProperty install setEnabled false getRootPane setDefaultButton install install addActionListener new ActionHandler box add install box add Box createHorizontalStrut cancel new JButton jEdit getProperty cancel addActionListener new ActionHandler box add cancel box add Box createHorizontalStrut box add Box createGlue panel add BorderLayout SOUTH box content add BorderLayout SOUTH panel updateTotalSize pack setLocationRelativeTo dialog show public void ok jEdit setBooleanProperty downloadSource isSelected dispose public void cancel cancelled true dispose void installPlugins Roster roster if cancelled return String installDirectory if installUser null installUser isSelected installDirectory MiscUtilities constructPath jEdit getSettingsDirectory else installDirectory MiscUtilities constructPath jEdit getJEditHome Object selected plugins getCheckedValues for int selected length PluginList Plugin plugin PluginList Plugin selected plugin install roster installDirectory downloadSource isSelected private JCheckBoxList plugins private JLabel name private JLabel author private JLabel size private JLabel latestVersion private JLabel installedVersion private JLabel updated private JTextArea description private JLabel totalSize private JCheckBox downloadSource private JRadioButton installUser private JRadioButton installSystem private JButton install private JButton cancel private boolean cancelled private Thread thread private void updateInfo Object selected plugins getSelectedValue if selected instanceof PluginList Plugin PluginList Plugin plugin PluginList Plugin selected PluginList Branch branch plugin getCompatibleBranch name setText plugin name author setText plugin author size setText String valueOf downloadSource isSelected branch downloadSourceSize branch downloadSize if branch obsolete latestVersion setText jEdit getProperty else latestVersion setText branch version if installedVersion null installedVersion setText plugin installedVersion updated setText branch date ArrayList deps new ArrayList createDependencyList branch deps deps StringBuffer buf new StringBuffer for int deps size buf append buf append deps get description setText plugin description buf length jEdit getProperty buf toString branch obsolete jEdit getProperty description setCaretPosition else name setText null author setText null latestVersion setText null if installedVersion null installedVersion setText null updated setText null description setText null private void createDependencyList Vector deps ArrayList append for int deps size PluginList Dependency dep PluginList Dependency deps elementAt if dep what equals dep isSatisfied if append contains dep plugin append add dep plugin PluginList Branch branch dep plugin getCompatibleBranch createDependencyList branch deps append private void updateTotalSize ArrayList selectedPlugins new ArrayList Object selected plugins getCheckedValues install setEnabled selected length for int selected length PluginList Plugin plugin PluginList Plugin selected if selectedPlugins contains plugin selectedPlugins add plugin createDependencyList plugin getCompatibleBranch deps selectedPlugins int for int selectedPlugins size PluginList Branch branch PluginList Plugin selectedPlugins get getCompatibleBranch downloadSource isSelected branch downloadSourceSize branch downloadSize totalSize setText String valueOf class ActionHandler implements ActionListener public void actionPerformed ActionEvent evt Object source evt getSource if source install ok else if source cancel cancel else if source downloadSource updateInfo updateTotalSize class ListHandler implements ListSelectionListener public void valueChanged ListSelectionEvent evt updateInfo class TableModelHandler implements TableModelListener public void tableChanged TableModelEvent updateTotalSize public interface XmlHandler public void startDocument throws java lang Exception public void endDocument throws java lang Exception public Object resolveEntity String publicId String systemId throws java lang Exception public void startExternalEntity String systemId throws java lang Exception public void endExternalEntity String systemId throws java lang Exception public void doctypeDecl String name String publicId String systemId throws java lang Exception public void attribute String aname String value boolean isSpecified throws java lang Exception public void startElement String elname throws java lang Exception public void endElement String elname throws java lang Exception public void charData char ch int start int length throws java lang Exception public void ignorableWhitespace char ch int start int length throws java lang Exception public void processingInstruction String target String data throws java lang Exception public void error String message String systemId int line int column throws java lang Exception public class ParserRule public final char searchChars public final int sequenceLengths public final int action public final byte token public ParserRule next ParserRule char searchChars int sequenceLengths int action byte token this searchChars searchChars this sequenceLengths sequenceLengths this action action this token token public class SplashScreen extends Canvas public SplashScreen setCursor Cursor getPredefinedCursor Cursor WAIT_CURSOR image getToolkit getImage getClass getResource MediaTracker tracker new MediaTracker this tracker addImage image try tracker waitForAll catch Exception Log log Log ERROR this win new Window new Frame Dimension screen getToolkit getScreenSize Dimension size new Dimension image getWidth this image getHeight this win setSize size win setLayout new BorderLayout win add BorderLayout CENTER this win setLocation screen width size width screen height size height win validate win show public void dispose win dispose public synchronized void advance progress repaint try wait catch InterruptedException ie Log log Log ERROR this ie public void update Graphics paint public synchronized void paint Graphics Dimension size getSize if offscreenImg null offscreenImg createImage size width size height offscreenGfx offscreenImg getGraphics offscreenGfx setColor Color black offscreenGfx drawRect size width size height offscreenGfx drawImage image this offscreenGfx setColor new Color offscreenGfx fillRect progress drawImage offscreenImg this notify private Window win private Image image private Image offscreenImg private Graphics offscreenGfx private int progress public class ViewRegisters extends EnhancedDialog public ViewRegisters View view super view jEdit getProperty true JPanel content new JPanel new BorderLayout content setBorder new EmptyBorder setContentPane content JPanel panel new JPanel new BorderLayout panel setBorder new EmptyBorder JLabel label new JLabel jEdit getProperty label setBorder new EmptyBorder panel add BorderLayout NORTH label DefaultListModel registerModel new DefaultListModel registerList new JList registerModel registerList setSelectionMode ListSelectionModel SINGLE_SELECTION registerList setCellRenderer new Renderer Registers Register registers Registers getRegisters int index for int registers length Registers Register reg registers if reg null continue String value reg toString if value null value length continue registerModel addElement new Character char if registerModel getSize registerModel addElement jEdit getProperty panel add BorderLayout CENTER new JScrollPane registerList content add BorderLayout WEST panel panel new JPanel new BorderLayout panel setBorder new EmptyBorder label new JLabel jEdit getProperty label setBorder new EmptyBorder panel add BorderLayout NORTH label contentTextArea new JTextArea contentTextArea setEditable false panel add BorderLayout CENTER new JScrollPane contentTextArea content add BorderLayout CENTER panel panel new JPanel panel setLayout new BoxLayout panel BoxLayout X_AXIS panel setBorder new EmptyBorder close new JButton jEdit getProperty close addActionListener new ActionHandler panel add Box createGlue panel add close panel add Box createGlue getRootPane setDefaultButton close content add BorderLayout SOUTH panel registerList addListSelectionListener new ListHandler registerList setSelectedIndex index pack setLocationRelativeTo view show public void ok dispose public void cancel dispose private JList registerList private JTextArea contentTextArea private JButton close class Renderer extends DefaultListCellRenderer public Component getListCellRendererComponent JList list Object value int index boolean isSelected boolean cellHasFocus super getListCellRendererComponent list value index isSelected cellHasFocus if value instanceof Character char name Character value charValue String label if name label else if name label else if name label jEdit getProperty else if name label jEdit getProperty else label String valueOf char name setText label return this class ActionHandler implements ActionListener public void actionPerformed ActionEvent evt if evt getSource close cancel class ListHandler implements ListSelectionListener public void valueChanged ListSelectionEvent evt Object value registerList getSelectedValue if value instanceof Character return char name Character value charValue Registers Register reg Registers getRegister name if reg null return contentTextArea setText reg toString contentTextArea setCaretPosition public class BrowserCommandsMenu extends JPopupMenu public BrowserCommandsMenu VFSBrowser browser VFS DirectoryEntry file this browser browser if file null this file file VFS vfs VFSManager getVFSForPath file deletePath boolean delete vfs getCapabilities VFS DELETE_CAP boolean rename vfs getCapabilities VFS RENAME_CAP if jEdit getBuffer file path null if browser getMode VFSBrowser BROWSER add createMenuItem add createMenuItem add createMenuItem else add createMenuItem add createMenuItem else if file type VFS DirectoryEntry DIRECTORY file type VFS DirectoryEntry FILESYSTEM add createMenuItem else if browser getMode VFSBrowser BROWSER add createMenuItem else add createMenuItem add createMenuItem add createOpenEncodingMenu add createMenuItem if rename add createMenuItem if delete add createMenuItem addSeparator add createMenuItem add createMenuItem add createMenuItem add createMenuItem add createMenuItem addSeparator if browser getMode VFSBrowser BROWSER add createMenuItem add createMenuItem if browser getMode VFSBrowser BROWSER addSeparator add createMenuItem addSeparator showHiddenFiles new JCheckBoxMenuItem jEdit getProperty showHiddenFiles setActionCommand showHiddenFiles setSelected browser getShowHiddenFiles showHiddenFiles addActionListener new ActionHandler add showHiddenFiles public void update showHiddenFiles setSelected browser getShowHiddenFiles private VFSBrowser browser private VFS DirectoryEntry file private VFS vfs private JCheckBoxMenuItem showHiddenFiles private JMenuItem createMenuItem String name String label jEdit getProperty name JMenuItem mi new JMenuItem label mi setActionCommand name mi addActionListener new ActionHandler return mi private JMenu createOpenEncodingMenu ActionListener listener new ActionHandler JMenu openEncoding new JMenu jEdit getProperty String systemEncoding System getProperty JMenuItem mi new JMenuItem jEdit getProperty mi setActionCommand systemEncoding mi addActionListener listener openEncoding add mi mi new JMenuItem jEdit getProperty mi setActionCommand jEdit getProperty systemEncoding mi addActionListener listener openEncoding add mi openEncoding addSeparator StringTokenizer st new StringTokenizer jEdit getProperty while st hasMoreTokens String encoding st nextToken mi new JMenuItem encoding mi setActionCommand encoding mi addActionListener listener openEncoding add mi openEncoding addSeparator mi new JMenuItem jEdit getProperty mi setActionCommand mi addActionListener listener openEncoding add mi return openEncoding class ActionHandler implements ActionListener public void actionPerformed ActionEvent evt View view browser getView String actionCommand evt getActionCommand if actionCommand startsWith Hashtable props new Hashtable props put Buffer ENCODING actionCommand substring jEdit openFile view null file path false props else if actionCommand equals String encoding GUIUtilities input browser null jEdit getProperty System getProperty if encoding null return Hashtable props new Hashtable props put Buffer ENCODING encoding jEdit openFile view null file path false props else if actionCommand equals jEdit openFile view file path else if actionCommand equals Buffer buffer jEdit openFile null file path if buffer null jEdit newView view buffer else if actionCommand equals view getBuffer insertFile view file path else if actionCommand equals browser filesActivated false false else if actionCommand equals Buffer buffer jEdit getBuffer file path if buffer null jEdit closeBuffer view buffer else if actionCommand equals browser setDirectory file path else if actionCommand equals browser rename file path else if actionCommand equals browser delete file deletePath else if actionCommand equals String path browser getDirectory VFS vfs VFSManager getVFSForPath path browser setDirectory vfs getParentOfPath path else if actionCommand equals browser reloadDirectory else if actionCommand equals browser rootDirectory else if actionCommand equals browser setDirectory System getProperty else if actionCommand equals Buffer buffer browser getView getBuffer browser setDirectory buffer getVFS getParentOfPath buffer getPath else if actionCommand equals browser newFile else if actionCommand equals browser mkdir else if actionCommand equals browser searchInDirectory else if actionCommand equals browser setShowHiddenFiles browser getShowHiddenFiles browser reloadDirectory public class EnhancedMenu extends JMenu public EnhancedMenu String name String label jEdit getProperty name concat if label null label name char mnemonic int index label indexOf if index label length index mnemonic Character toLowerCase label charAt index label label substring index concat label substring index else mnemonic setText label if OperatingSystem isMacOS setMnemonic mnemonic String menuItems jEdit getProperty name if menuItems null StringTokenizer st new StringTokenizer menuItems while st hasMoreTokens String menuItemName st nextToken if menuItemName equals addSeparator else if menuItemName startsWith add GUIUtilities loadMenu menuItemName substring else add GUIUtilities loadMenuItem menuItemName public class Capabilities private static boolean accessibility false public static boolean haveSwing return classExists public static boolean canGenerateInterfaces return classExists public static boolean haveAccessibility return accessibility classExists classExists public static void setAccessibility boolean accessibility private static Hashtable classes new Hashtable public static boolean classExists String name Object classes get name if null try Class forName name catch ClassNotFoundException if null classes put return null public static class Unavailable extends RuntimeException public Unavailable String super class Autosave implements ActionListener public static void setInterval int interval if interval if timer null timer stop timer null return interval if timer null timer new Timer interval new Autosave timer start else timer setDelay interval public static void stop if timer null timer stop public void actionPerformed ActionEvent evt if jEdit getFirstView null jEdit saveOpenFiles jEdit getFirstView Buffer bufferArray jEdit getBuffers for int bufferArray length bufferArray autosave private static Timer timer private Autosave public class CompleteWord extends JWindow public static void completeWord View view JEditTextArea textArea view getTextArea Buffer buffer view getBuffer int caretLine textArea getCaretLine int caret textArea getCaretPosition if buffer isEditable textArea getToolkit beep return KeywordMap keywordMap buffer getKeywordMapAtOffset caret String noWordSep getNonAlphaNumericWordChars buffer keywordMap caret String word getWordToComplete buffer caretLine caret noWordSep if word null textArea getToolkit beep return Vector completions getCompletions buffer word keywordMap noWordSep caret if completions size completions size Completion completions get text equals word textArea getToolkit beep else if completions size textArea setSelectedText completions elementAt toString substring word length else textArea scrollToCaret false Point location textArea offsetToXY caret word length location textArea getPainter getFontMetrics getHeight SwingUtilities convertPointToScreen location textArea getPainter new CompleteWord view word completions location public CompleteWord View view String word Vector completions Point location super view this view view this textArea view getTextArea this buffer view getBuffer this word word words new JList completions words setFont UIManager getFont words setVisibleRowCount Math min completions size words addMouseListener new MouseHandler words setSelectedIndex words setSelectionMode ListSelectionModel SINGLE_SELECTION words setCellRenderer new Renderer JScrollPane scroller new JScrollPane words JScrollPane VERTICAL_SCROLLBAR_ALWAYS JScrollPane HORIZONTAL_SCROLLBAR_NEVER getContentPane add scroller BorderLayout CENTER GUIUtilities requestFocus this words pack setLocation location show KeyHandler keyHandler new KeyHandler addKeyListener keyHandler words addKeyListener keyHandler view setKeyEventInterceptor keyHandler public void dispose view setKeyEventInterceptor null super dispose SwingUtilities invokeLater new Runnable public void run textArea requestFocus private static String getNonAlphaNumericWordChars Buffer buffer KeywordMap keywordMap int caret String noWordSep buffer getStringProperty if noWordSep null noWordSep if keywordMap null String keywordNoWordSep keywordMap getNonAlphaNumericChars if keywordNoWordSep null noWordSep noWordSep keywordNoWordSep return noWordSep private static String getWordToComplete Buffer buffer int caretLine int caret String noWordSep String line buffer getLineText caretLine int dot caret buffer getLineStartOffset caretLine if dot return null char ch line charAt dot if Character isLetterOrDigit ch noWordSep indexOf ch return null int wordStart TextUtilities findWordStart line dot noWordSep String word line substring wordStart dot if word length return null return word private static Vector getCompletions Buffer buffer String word KeywordMap keywordMap String noWordSep int caret Vector completions new Vector int wordLen word length if keywordMap null String keywords keywordMap getKeywords for int keywords length String keywords if regionMatches keywordMap getIgnoreCase word wordLen Completion keyword new Completion true if completions indexOf keyword completions addElement keyword for int buffer getLineCount String line buffer getLineText int start buffer getLineStartOffset if line startsWith word caret start word length String completeWord line noWordSep Completion comp new Completion false if completions indexOf comp completions addElement comp int len line length word length for int len char line charAt if Character isLetterOrDigit noWordSep indexOf if line regionMatches word wordLen caret start word length String completeWord line noWordSep Completion comp new Completion false if completions indexOf comp completions addElement comp MiscUtilities quicksort completions new MiscUtilities StringICaseCompare return completions private static String completeWord String line int offset String noWordSep int wordEnd TextUtilities findWordEnd line offset noWordSep return line substring offset wordEnd private View view private JEditTextArea textArea private Buffer buffer private String word private JList words private void insertSelected textArea setSelectedText words getSelectedValue toString substring word length dispose static class Completion String text boolean keyword Completion String text boolean keyword this text text this keyword keyword public String toString return text public boolean equals Object obj if obj instanceof Completion return Completion obj text equals text else return false static class Renderer extends DefaultListCellRenderer public Component getListCellRendererComponent JList list Object value int index boolean isSelected boolean cellHasFocus super getListCellRendererComponent list value index isSelected cellHasFocus Completion comp Completion value if comp keyword setFont list getFont deriveFont Font BOLD else setFont list getFont return this class KeyHandler extends KeyAdapter public void keyPressed KeyEvent evt switch evt getKeyCode case KeyEvent VK_ENTER insertSelected evt consume break case KeyEvent VK_ESCAPE dispose evt consume break case KeyEvent VK_UP int selected words getSelectedIndex if selected selected words getModel getSize else if getFocusOwner words return else selected selected words setSelectedIndex selected words ensureIndexIsVisible selected evt consume break case KeyEvent VK_DOWN if selected words getModel getSize selected else if getFocusOwner words return else selected selected words setSelectedIndex selected words ensureIndexIsVisible selected evt consume break case KeyEvent VK_BACK_SPACE if word length textArea backspace evt consume dispose else word word substring word length textArea backspace int caret textArea getCaretPosition KeywordMap keywordMap buffer getKeywordMapAtOffset caret String noWordSep getNonAlphaNumericWordChars buffer keywordMap caret Vector completions getCompletions buffer word keywordMap noWordSep caret if completions size dispose words setListData completions words setSelectedIndex evt consume break default if evt isActionKey dispose view processKeyEvent evt break public void keyTyped KeyEvent evt char ch evt getKeyChar evt KeyEventWorkaround processKeyEvent evt if evt null return else if ch word word ch textArea userInput ch int caret textArea getCaretPosition KeywordMap keywordMap buffer getKeywordMapAtOffset caret String noWordSep getNonAlphaNumericWordChars buffer keywordMap caret Vector completions getCompletions buffer word keywordMap noWordSep caret if completions size dispose words setListData completions words setSelectedIndex class MouseHandler extends MouseAdapter public void mouseClicked MouseEvent evt insertSelected public class ClassPathException extends EvalError public ClassPathException String msg super msg public interface SearchMatcher int nextMatch CharIndexed text boolean start boolean end boolean firstTime String substitute String text throws Exception class ParseException extends EvalError String sourceFile public ParseException Token currentTokenVal int expectedTokenSequencesVal String tokenImageVal this specialConstructor true currentToken currentTokenVal expectedTokenSequences expectedTokenSequencesVal tokenImage tokenImageVal public ParseException this specialConstructor false public ParseException String message super message specialConstructor false protected boolean specialConstructor public Token currentToken public int expectedTokenSequences public String tokenImage public String getMessage return getMessage false public String getMessage boolean debug if specialConstructor return super getMessage String expected int maxSize for int expectedTokenSequences length if maxSize expectedTokenSequences length maxSize expectedTokenSequences length for int expectedTokenSequences length expected tokenImage expectedTokenSequences if expectedTokenSequences expectedTokenSequences length expected expected eol String retval sourceFile Token tok currentToken next for int maxSize if retval if tok kind retval tokenImage break retval add_escapes tok image tok tok next retval currentToken next beginLine currentToken next beginColumn eol if debug if expectedTokenSequences length retval eol else retval eol retval expected return retval protected String eol System getProperty protected String add_escapes String str StringBuffer retval new StringBuffer char ch for int str length switch str charAt case continue case retval append continue case retval append continue case retval append continue case retval append continue case retval append continue case retval append continue case retval append continue case retval append continue default if ch str charAt ch String Integer toString ch retval append substring length length else retval append ch continue return retval toString public String getErrorText int maxSize for int expectedTokenSequences length if maxSize expectedTokenSequences length maxSize expectedTokenSequences length String retval Token tok currentToken next for int maxSize if retval if tok kind retval tokenImage break retval add_escapes tok image tok tok next return retval public int getErrorLineNumber return currentToken next beginLine public String getErrorSourceFile return sourceFile public void setErrorSourceFile String file this sourceFile file public String toString return getMessage class Token implements java io Serializable public int kind public int beginLine beginColumn endLine endColumn public String image public Token next public Token specialToken public final String toString return image public static final Token newToken int ofKind switch ofKind default return new Token class JThis extends This implements ActionListener AdjustmentListener ComponentListener ContainerListener FocusListener ItemListener KeyListener MouseListener MouseMotionListener TextListener WindowListener PropertyChangeListener AncestorListener CaretListener CellEditorListener ChangeListener DocumentListener HyperlinkListener InternalFrameListener ListDataListener ListSelectionListener MenuDragMouseListener MenuKeyListener MenuListener MouseInputListener PopupMenuListener TableColumnModelListener TableModelListener TreeExpansionListener TreeModelListener TreeSelectionListener TreeWillExpandListener UndoableEditListener JThis NameSpace namespace Interpreter declaringInterp super namespace declaringInterp public String toString return namespace name void event String name Object event BshMethod method method namespace getMethod new Class null if method null try method invokeDeclaredMethod new Object event declaringInterpreter callstack null catch EvalError declaringInterpreter error method namespace getMethod name new Class null if method null try method invokeDeclaredMethod new Object event declaringInterpreter callstack null catch EvalError declaringInterpreter error public void ancestorAdded AncestorEvent event public void ancestorRemoved AncestorEvent event public void ancestorMoved AncestorEvent event public void caretUpdate CaretEvent event public void editingStopped ChangeEvent event public void editingCanceled ChangeEvent event public void stateChanged ChangeEvent event public void insertUpdate DocumentEvent event public void removeUpdate DocumentEvent event public void changedUpdate DocumentEvent event public void hyperlinkUpdate HyperlinkEvent event public void internalFrameOpened InternalFrameEvent event public void internalFrameClosing InternalFrameEvent event public void internalFrameClosed InternalFrameEvent event public void internalFrameIconified InternalFrameEvent event public void internalFrameDeiconified InternalFrameEvent event public void internalFrameActivated InternalFrameEvent event public void internalFrameDeactivated InternalFrameEvent event public void intervalAdded ListDataEvent event public void intervalRemoved ListDataEvent event public void contentsChanged ListDataEvent event public void valueChanged ListSelectionEvent event public void menuDragMouseEntered MenuDragMouseEvent event public void menuDragMouseExited MenuDragMouseEvent event public void menuDragMouseDragged MenuDragMouseEvent event public void menuDragMouseReleased MenuDragMouseEvent event public void menuKeyTyped MenuKeyEvent event public void menuKeyPressed MenuKeyEvent event public void menuKeyReleased MenuKeyEvent event public void menuSelected MenuEvent event public void menuDeselected MenuEvent event public void menuCanceled MenuEvent event public void popupMenuWillBecomeVisible PopupMenuEvent event public void popupMenuWillBecomeInvisible PopupMenuEvent event public void popupMenuCanceled PopupMenuEvent event public void columnAdded TableColumnModelEvent event public void columnRemoved TableColumnModelEvent event public void columnMoved TableColumnModelEvent event public void columnMarginChanged ChangeEvent event public void columnSelectionChanged ListSelectionEvent event public void tableChanged TableModelEvent event public void treeExpanded TreeExpansionEvent event public void treeCollapsed TreeExpansionEvent event public void treeNodesChanged TreeModelEvent event public void treeNodesInserted TreeModelEvent event public void treeNodesRemoved TreeModelEvent event public void treeStructureChanged TreeModelEvent event public void valueChanged TreeSelectionEvent event public void treeWillExpand TreeExpansionEvent event public void treeWillCollapse TreeExpansionEvent event public void undoableEditHappened UndoableEditEvent event public void actionPerformed ActionEvent event public void adjustmentValueChanged AdjustmentEvent event public void componentResized ComponentEvent event public void componentMoved ComponentEvent event public void componentShown ComponentEvent event public void componentHidden ComponentEvent event public void componentAdded ContainerEvent event public void componentRemoved ContainerEvent event public void focusGained FocusEvent event public void focusLost FocusEvent event public void itemStateChanged ItemEvent event public void keyTyped KeyEvent event public void keyPressed KeyEvent event public void keyReleased KeyEvent event public void mouseClicked MouseEvent event public void mousePressed MouseEvent event public void mouseReleased MouseEvent event public void mouseEntered MouseEvent event public void mouseExited MouseEvent event public void mouseDragged MouseEvent event public void mouseMoved MouseEvent event public void textValueChanged TextEvent event public void windowOpened WindowEvent event public void windowClosing WindowEvent event public void windowClosed WindowEvent event public void windowIconified WindowEvent event public void windowDeiconified WindowEvent event public void windowActivated WindowEvent event public void windowDeactivated WindowEvent event public void propertyChange PropertyChangeEvent event public void vetoableChange PropertyChangeEvent event public boolean imageUpdate java awt Image img int infoflags int int int width int height BshMethod method namespace getMethod new Class null null null null null null if method null try method invokeDeclaredMethod new Object img new Primitive infoflags new Primitive new Primitive new Primitive width new Primitive height declaringInterpreter callstack null catch EvalError declaringInterpreter error return true public class EditorExitRequested extends EBMessage NonVetoable public EditorExitRequested View view super view public View getView return View getSource public class BrowserIORequest extends WorkRequest public static final int LIST_DIRECTORY public static final int DELETE public static final int RENAME public static final int MKDIR public BrowserIORequest int type VFSBrowser browser Object session VFS vfs String path1 String path2 DefaultMutableTreeNode node this type type this browser browser this session session this vfs vfs this path1 path1 this path2 path2 this node node public void run switch type case LIST_DIRECTORY listDirectory break case DELETE delete break case RENAME rename break case MKDIR mkdir break if type LIST_DIRECTORY browser endRequest public String toString String typeString switch type case LIST_DIRECTORY typeString break case DELETE typeString break case RENAME typeString break case MKDIR typeString break default typeString break return getClass getName typeString vfs path1 path2 private int type private VFSBrowser browser private Object session private VFS vfs private String path1 private String path2 private DefaultMutableTreeNode node private void listDirectory VFS DirectoryEntry directory null String args path1 setStatus jEdit getProperty args String canonPath null try setAbortable true canonPath vfs session path1 browser directory vfs session canonPath browser catch IOException io setAbortable false String pp io toString VFSManager error browser path1 pp catch WorkThread Abort finally try vfs session browser catch IOException io setAbortable false String pp io toString VFSManager error browser path1 pp setAbortable false browser directoryLoaded node canonPath directory private void delete try setAbortable true String args path1 setStatus jEdit getProperty args try path1 vfs session path1 browser if vfs session path1 browser VFSManager error browser path1 null catch IOException io String pp io toString VFSManager error browser path1 pp catch WorkThread Abort finally try vfs session browser catch IOException io String pp io toString VFSManager error browser path1 pp private void rename try setAbortable true String args path1 path2 setStatus jEdit getProperty args try path1 vfs session path1 browser path2 vfs session path2 browser VFS DirectoryEntry file vfs session path2 browser if file null VFSManager error browser path1 new String path2 else if vfs session path1 path2 browser VFSManager error browser path1 new String path2 catch IOException io String pp io toString VFSManager error browser path1 pp catch WorkThread Abort finally try vfs session browser catch IOException io String pp io toString VFSManager error browser path1 pp private void mkdir try setAbortable true String args path1 setStatus jEdit getProperty args try path1 vfs session path1 browser if vfs session path1 browser VFSManager error browser path1 null catch IOException io args io toString VFSManager error browser path1 args catch WorkThread Abort finally try vfs session browser catch IOException io String args io toString VFSManager error browser path1 args public class PanelWindowContainer implements DockableWindowContainer public PanelWindowContainer DockableWindowManager wm String position this wm wm this position position buttons new JPanel new ButtonLayout closeBox new JButton GUIUtilities loadIcon closeBox setRequestFocusEnabled false closeBox setToolTipText jEdit getProperty int left if position equals DockableWindowManager RIGHT position equals DockableWindowManager LEFT left else left closeBox setMargin new Insets left buttons add closeBox closeBox addActionListener new ActionHandler popupButton new JButton GUIUtilities loadIcon popupButton setRequestFocusEnabled false popupButton setToolTipText jEdit getProperty buttons add popupButton popupButton addMouseListener new MouseHandler popup new JPopupMenu buttonGroup new ButtonGroup buttonGroup add nullButton new JToggleButton dockables new Vector dockablePanel new DockablePanel dimension jEdit getIntegerProperty position buttons addMouseListener new MouseHandler public void register final DockableWindowManager Entry entry dockables addElement entry int rotation if position equals DockableWindowManager TOP position equals DockableWindowManager BOTTOM rotation RotatedTextIcon NONE else if position equals DockableWindowManager LEFT rotation RotatedTextIcon CCW else if position equals DockableWindowManager RIGHT rotation RotatedTextIcon CW else throw new InternalError position JToggleButton button new JToggleButton button setMargin new Insets button setRequestFocusEnabled false button setIcon new RotatedTextIcon rotation button getFont entry title button setActionCommand entry name button addActionListener new ActionHandler buttonGroup add button buttons add button button addMouseListener new MouseHandler JMenuItem menuItem new JMenuItem entry title menuItem addActionListener new ActionListener public void actionPerformed ActionEvent evt wm showDockableWindow entry name popup add menuItem wm revalidate public void add DockableWindowManager Entry entry dockablePanel add entry name entry win public void remove DockableWindowManager Entry entry int index dockables indexOf entry buttons remove index dockables removeElement entry if entry win null dockablePanel remove entry win if current entry current null show null else wm revalidate public void save DockableWindowManager Entry entry public void show final DockableWindowManager Entry entry if current entry if entry null entry win requestDefaultFocus return if current null dockablePanel setBorder new DockBorder position if entry null this current entry dockablePanel showDockable entry name int index dockables indexOf entry JToggleButton buttons getComponent index setSelected true SwingUtilities invokeLater new Runnable public void run entry win requestDefaultFocus else current null nullButton setSelected true dockablePanel setBorder null wm getView getTextArea requestFocus wm revalidate dockablePanel repaint public boolean isVisible DockableWindowManager Entry entry return current entry public DockableWindowManager Entry getCurrent return current void save jEdit setIntegerProperty position dimension if current null jEdit unsetProperty position else jEdit setProperty position current name JPanel getButtonBox return buttons DockablePanel getDockablePanel return dockablePanel void setDimension int dimension if dimension this dimension dimension SPLITTER_WIDTH private static final int SPLITTER_WIDTH private DockableWindowManager wm private String position private JPanel buttons private JButton closeBox private JButton popupButton private ButtonGroup buttonGroup private JToggleButton nullButton private int dimension private Vector dockables private DockablePanel dockablePanel private DockableWindowManager Entry current private JPopupMenu popup class ActionHandler implements ActionListener public void actionPerformed ActionEvent evt if evt getSource closeBox show null else if wm isDockableWindowVisible evt getActionCommand show null else wm showDockableWindow evt getActionCommand class MouseHandler extends MouseAdapter public void mousePressed MouseEvent evt if evt getSource popupButton GUIUtilities isPopupTrigger evt if popup isVisible popup setVisible false else GUIUtilities showPopupMenu popup Component evt getSource evt getX evt getY static class DockBorder implements Border String position Insets insets Color color1 Color color2 Color color3 DockBorder String position this position position insets new Insets position equals DockableWindowManager BOTTOM SPLITTER_WIDTH position equals DockableWindowManager RIGHT SPLITTER_WIDTH position equals DockableWindowManager TOP SPLITTER_WIDTH position equals DockableWindowManager LEFT SPLITTER_WIDTH public void paintBorder Component Graphics int int int width int height updateColors if color1 null color2 null color3 null return if position equals DockableWindowManager BOTTOM paintHorizBorder width else if position equals DockableWindowManager RIGHT paintVertBorder height else if position equals DockableWindowManager TOP paintHorizBorder height SPLITTER_WIDTH width else if position equals DockableWindowManager LEFT paintVertBorder width SPLITTER_WIDTH height public Insets getBorderInsets Component return insets public boolean isBorderOpaque return false private void paintHorizBorder Graphics int int int width setColor color3 fillRect width SPLITTER_WIDTH for int width setColor color1 drawLine setColor color2 drawLine setColor color1 drawLine setColor color2 drawLine private void paintVertBorder Graphics int int int height setColor color3 fillRect SPLITTER_WIDTH height for int height setColor color1 drawLine setColor color2 drawLine setColor color1 drawLine setColor color2 drawLine private void updateColors if UIManager getLookAndFeel instanceof MetalLookAndFeel color1 MetalLookAndFeel getControlHighlight color2 MetalLookAndFeel getControlDarkShadow color3 MetalLookAndFeel getControl else color1 color2 color3 null class RotatedTextIcon implements Icon static final int NONE static final int CW static final int CCW int rotate Font font GlyphVector glyphs float width float height float ascent RenderingHints renderHints RotatedTextIcon int rotate Font font String text this rotate rotate this font font FontRenderContext fontRenderContext new FontRenderContext null true true glyphs font createGlyphVector fontRenderContext text width int glyphs getLogicalBounds getWidth LineMetrics lineMetrics font getLineMetrics text fontRenderContext ascent lineMetrics getAscent height int lineMetrics getHeight renderHints new RenderingHints RenderingHints KEY_ANTIALIASING RenderingHints VALUE_ANTIALIAS_ON renderHints put RenderingHints KEY_FRACTIONALMETRICS RenderingHints VALUE_FRACTIONALMETRICS_ON renderHints put RenderingHints KEY_RENDERING RenderingHints VALUE_RENDER_QUALITY public int getIconWidth return int rotate RotatedTextIcon CW rotate RotatedTextIcon CCW height width public int getIconHeight return int rotate RotatedTextIcon CW rotate RotatedTextIcon CCW width height public void paintIcon Component Graphics int int Graphics2D g2d Graphics2D g2d setFont font AffineTransform oldTransform g2d getTransform RenderingHints oldHints g2d getRenderingHints g2d setRenderingHints renderHints g2d setColor getForeground if rotate RotatedTextIcon NONE g2d drawGlyphVector glyphs ascent else if rotate RotatedTextIcon CW AffineTransform trans new AffineTransform trans concatenate oldTransform trans translate trans rotate Math PI height width g2d setTransform trans g2d drawGlyphVector glyphs height width width height ascent else if rotate RotatedTextIcon CCW AffineTransform trans new AffineTransform trans concatenate oldTransform trans translate trans rotate Math PI height width g2d setTransform trans g2d drawGlyphVector glyphs height width width height ascent g2d setTransform oldTransform g2d setRenderingHints oldHints class ButtonLayout implements LayoutManager public Dimension preferredLayoutSize Container parent Component comp parent getComponents if comp length return new Dimension else if position equals DockableWindowManager TOP position equals DockableWindowManager BOTTOM return new Dimension comp getPreferredSize height else return new Dimension comp getPreferredSize width public Dimension minimumLayoutSize Container parent Component comp parent getComponents if comp length return new Dimension else if position equals DockableWindowManager TOP position equals DockableWindowManager BOTTOM return new Dimension comp getMinimumSize height else return new Dimension comp getMinimumSize width public void layoutContainer Container parent Component comp parent getComponents if comp length boolean closeBoxSizeSet false boolean noMore false popupButton setVisible false Dimension parentSize parent getSize int pos for int comp length Dimension size comp getPreferredSize if position equals DockableWindowManager TOP position equals DockableWindowManager BOTTOM if closeBoxSizeSet closeBox setBounds size height size height pos size height closeBoxSizeSet true if noMore pos size width parentSize width comp length closeBox getWidth popupButton setBounds parentSize width size height size height size height popupButton setVisible true comp setVisible false noMore true else comp setBounds pos size width size height comp setVisible true pos size width else if closeBoxSizeSet closeBox setBounds size width size width pos size width closeBoxSizeSet true if noMore pos size height parentSize height comp length closeBox getHeight popupButton setBounds parentSize height size width size width size width popupButton setVisible true comp setVisible false noMore true else comp setBounds pos size width size height comp setVisible true pos size height class DockablePanel extends JPanel DockablePanel super new CardLayout ResizeMouseHandler resizeMouseHandler new ResizeMouseHandler addMouseListener resizeMouseHandler addMouseMotionListener resizeMouseHandler void showDockable String name CardLayout getLayout show this name public Dimension getMinimumSize return new Dimension public Dimension getPreferredSize if current null return new Dimension else if dimension int width super getPreferredSize width dimension width SPLITTER_WIDTH if position equals DockableWindowManager TOP position equals DockableWindowManager BOTTOM return new Dimension dimension SPLITTER_WIDTH else return new Dimension dimension SPLITTER_WIDTH class ResizeMouseHandler extends MouseAdapter implements MouseMotionListener boolean canDrag int dragStartDimension Point dragStart public void mousePressed MouseEvent evt dragStartDimension dimension dragStart evt getPoint public void mouseMoved MouseEvent evt Border border getBorder if border null return Insets insets border getBorderInsets DockablePanel this int cursor Cursor DEFAULT_CURSOR canDrag false if position equals DockableWindowManager TOP if evt getY getHeight insets bottom cursor Cursor N_RESIZE_CURSOR canDrag true else if position equals DockableWindowManager LEFT if evt getX getWidth insets right cursor Cursor W_RESIZE_CURSOR canDrag true else if position equals DockableWindowManager BOTTOM if evt getY insets top cursor Cursor S_RESIZE_CURSOR canDrag true else if position equals DockableWindowManager RIGHT if evt getX insets left cursor Cursor E_RESIZE_CURSOR canDrag true setCursor Cursor getPredefinedCursor cursor public void mouseDragged MouseEvent evt if canDrag return return if position equals DockableWindowManager TOP dimension evt getY dragStartDimension dragStart else if position equals DockableWindowManager LEFT dimension evt getX dragStartDimension dragStart else if position equals DockableWindowManager BOTTOM dimension dragStart evt getY else if position equals DockableWindowManager RIGHT dimension dragStart evt getX if dimension dimension dragStartDimension wm invalidate wm validate public void mouseExited MouseEvent evt setCursor Cursor getPredefinedCursor Cursor DEFAULT_CURSOR final class RETokenBackRef extends REToken private int num private boolean insens RETokenBackRef int subIndex int num boolean insens super subIndex this num num this insens insens boolean match CharIndexed input REMatch mymatch int mymatch start num mymatch end num for int if input charAt mymatch index input charAt return false mymatch index return next input mymatch void dump StringBuffer os os append append num public interface ScrollListener extends java util EventListener void scrolledVertically JEditTextArea textArea void scrolledHorizontally JEditTextArea textArea class CharIndexedCharArray implements CharIndexed Serializable private char private int anchor CharIndexedCharArray char str int index str anchor index public char charAt int index int pos anchor index return pos length pos pos OUT_OF_BOUNDS public boolean isValid return anchor length public boolean move int index return anchor index length public class TargetError extends EvalError Throwable target boolean inNativeCode public TargetError String msg Throwable SimpleNode node boolean inNativeCode super msg node target this inNativeCode inNativeCode public TargetError Throwable SimpleNode node this node false public TargetError String Throwable this null false public Throwable getTarget if target instanceof InvocationTargetException return InvocationTargetException target getTargetException else return target public String toString return super toString printTargetError target public void printStackTrace printStackTrace false System err public void printStackTrace PrintStream out printStackTrace false out public void printStackTrace boolean debug PrintStream out if debug super printStackTrace out System out println target printStackTrace out public String printTargetError Throwable String target toString if Capabilities canGenerateInterfaces xPrintTargetError return public String xPrintTargetError Throwable String getTarget Interpreter new Interpreter try set return String eval getTarget catch EvalError throw new InterpreterError toString public boolean inNativeCode return inNativeCode class CharIndexedInputStream implements CharIndexed private static final int BUFFER_INCREMENT private BufferedInputStream br private int index private int bufsize BUFFER_INCREMENT private int end UNKNOWN private char cached OUT_OF_BOUNDS private char lookBehind new char OUT_OF_BOUNDS OUT_OF_BOUNDS CharIndexedInputStream InputStream str int index if str instanceof BufferedInputStream br BufferedInputStream str else br new BufferedInputStream str BUFFER_INCREMENT next if index move index private boolean next if end return false try if index br reset int br read br mark bufsize if end cached OUT_OF_BOUNDS return false cached char index catch IOException printStackTrace cached OUT_OF_BOUNDS return false return true public char charAt int index if index return cached else if index end return OUT_OF_BOUNDS else if index return lookBehind else if index return lookBehind else if index return OUT_OF_BOUNDS else if index bufsize try while bufsize index bufsize BUFFER_INCREMENT br reset br mark bufsize br skip index catch IOException else if this index index try br reset br skip index catch IOException char ch OUT_OF_BOUNDS try int br read if end index return ch ch char catch IOException ie return ch public boolean move int index boolean retval true while retval index retval next return retval public boolean isValid return cached OUT_OF_BOUNDS class BSHAllocationExpression extends SimpleNode BSHAllocationExpression int id super id public Object eval CallStack callstack Interpreter interpreter throws EvalError SimpleNode type SimpleNode jjtGetChild SimpleNode args SimpleNode jjtGetChild if type instanceof BSHAmbiguousName BSHAmbiguousName name BSHAmbiguousName type if args instanceof BSHArguments return objectAllocation name BSHArguments args callstack interpreter else return objectArrayAllocation name BSHArrayDimensions args callstack interpreter else return primitiveArrayAllocation BSHPrimitiveType type BSHArrayDimensions args callstack interpreter private Object objectAllocation BSHAmbiguousName nameNode BSHArguments argumentsNode CallStack callstack Interpreter interpreter throws EvalError NameSpace namespace callstack top Class type nameNode toClass namespace Object args argumentsNode getArguments callstack interpreter if args null throw new EvalError this boolean hasBody jjtGetNumChildren if hasBody BSHBlock body BSHBlock jjtGetChild return constructWithBody type args body callstack interpreter else return constructObject type args private Object constructObject Class type Object args throws EvalError try return Reflect constructObject type args catch ReflectError throw new EvalError getMessage this catch InvocationTargetException Interpreter debug getTargetException throw new TargetError getTargetException this true private Object constructWithBody Class type Object args BSHBlock body CallStack callstack Interpreter interpreter throws EvalError if type isInterface throw new EvalError type NameSpace namespace callstack top NameSpace local new NameSpace namespace callstack push local body eval callstack interpreter true callstack pop return local getThis interpreter getInterface type private Object objectArrayAllocation BSHAmbiguousName nameNode BSHArrayDimensions dimensionsNode CallStack callstack Interpreter interpreter throws EvalError NameSpace namespace callstack top Class type nameNode toClass namespace if type null throw new EvalError nameNode getName namespace this Object result dimensionsNode eval type callstack interpreter if result Primitive VOID return result else return arrayNewInstance type dimensionsNode private Object primitiveArrayAllocation BSHPrimitiveType typeNode BSHArrayDimensions dimensionsNode CallStack callstack Interpreter interpreter throws EvalError Class type typeNode getType Object result dimensionsNode eval type callstack interpreter if result Primitive VOID return result return arrayNewInstance type dimensionsNode private Object arrayNewInstance Class type BSHArrayDimensions dimensionsNode throws EvalError try return Array newInstance type dimensionsNode dimensions catch NegativeArraySizeException e1 throw new TargetError e1 catch Exception throw new EvalError getMessage this class BSHMethodInvocation extends SimpleNode BSHMethodInvocation int id super id public Object eval CallStack callstack Interpreter interpreter throws EvalError NameSpace namespace callstack top Name name BSHAmbiguousName jjtGetChild getName namespace Object args BSHArguments jjtGetChild getArguments callstack interpreter try return name invokeMethod interpreter args callstack this catch ReflectError throw new EvalError getMessage this catch java lang reflect InvocationTargetException String msg name Throwable te getTargetException boolean isNative true if te instanceof EvalError if te instanceof TargetError isNative TargetError te inNativeCode else isNative false throw new TargetError msg te this isNative catch EvalError ee ee reThrow this throw new Error public class VFSUpdate extends EBMessage public VFSUpdate String path super null if path null throw new NullPointerException this path path public String getPath return path public String paramString return super paramString path private String path class BSHReturnType extends SimpleNode public boolean isVoid BSHReturnType int id super id public Object getReturnType NameSpace namespace throws EvalError if isVoid return Primitive VOID else return BSHType jjtGetChild getType namespace class BufferPrintable implements Printable BufferPrintable Buffer buffer Font font boolean header boolean footer boolean lineNumbers boolean color this buffer buffer this font font this header header this footer footer this lineNumbers lineNumbers styles GUIUtilities loadStyles jEdit getProperty jEdit getIntegerProperty color styles Token NULL new SyntaxStyle textColor null font lineList new ArrayList public int print Graphics PageFormat pageFormat int pageIndex throws PrinterException if pageIndex currentPage currentLine currentPageStart else if end return NO_SUCH_PAGE currentPageStart currentLine currentPage pageIndex double pageX pageFormat getImageableX double pageY pageFormat getImageableY double pageWidth pageFormat getImageableWidth double pageHeight pageFormat getImageableHeight Graphics2D gfx Graphics2D gfx setFont font if header double headerHeight paintHeader gfx pageX pageY pageWidth pageY headerHeight pageHeight headerHeight if footer double footerHeight paintFooter gfx pageX pageY pageWidth pageHeight pageIndex pageHeight footerHeight FontRenderContext frc gfx getFontRenderContext int lineNumberDigits int Math ceil Math log buffer getLineCount Math log char chars new char lineNumberDigits for int chars length chars double lineNumberWidth font getStringBounds chars lineNumberDigits frc getWidth int tabSize jEdit getIntegerProperty chars new char tabSize for int chars length chars double tabWidth font getStringBounds chars tabSize frc getWidth PrintTabExpander new PrintTabExpander pageX tabWidth Segment seg new Segment double print_loop for if currentLine lineList size buffer getLineText currentPhysicalLine seg lm font getLineMetrics seg array seg offset seg count frc Token tokens buffer markTokens currentPhysicalLine getFirstToken lineList add new Integer currentPhysicalLine ChunkCache lineToChunkList seg tokens styles frc float pageWidth lineNumberWidth lineList if lineList size currentLine lineList add null lm getHeight if pageHeight break print_loop Object obj lineList get currentLine if obj instanceof Integer if lineNumbers gfx setFont font gfx setColor lineNumberColor String lineNumberString String valueOf obj gfx drawString lineNumberString float pageX float pageY obj lineList get currentLine if obj null ChunkCache Chunk line ChunkCache Chunk obj ChunkCache paintChunkList line gfx float pageX lineNumberWidth float pageY Color white false if currentPhysicalLine buffer getLineCount currentLine lineList size end true break print_loop return PAGE_EXISTS private static Color headerColor Color lightGray private static Color headerTextColor Color black private static Color footerColor Color lightGray private static Color footerTextColor Color black private static Color lineNumberColor Color gray private static Color textColor Color black private Buffer buffer private Font font private SyntaxStyle styles private boolean header private boolean footer private boolean lineNumbers private int currentPage private int currentPageStart private int currentLine private int currentPhysicalLine private boolean end private LineMetrics lm private ArrayList lineList private double paintHeader Graphics2D gfx double pageX double pageY double pageWidth String headerText jEdit getProperty new String buffer getPath FontRenderContext frc gfx getFontRenderContext gfx setColor headerColor Rectangle2D bounds font getStringBounds headerText frc Rectangle2D headerBounds new Rectangle2D Double pageX pageY pageWidth bounds getHeight gfx fill headerBounds gfx setColor headerTextColor lm font getLineMetrics headerText frc gfx drawString headerText float pageX pageWidth bounds getWidth float pageY lm getAscent return headerBounds getHeight private double paintFooter Graphics2D gfx double pageX double pageY double pageWidth double pageHeight int pageIndex String footerText jEdit getProperty new Object new Date new Integer pageIndex FontRenderContext frc gfx getFontRenderContext gfx setColor footerColor Rectangle2D bounds font getStringBounds footerText frc Rectangle2D footerBounds new Rectangle2D Double pageX pageY pageHeight bounds getHeight pageWidth bounds getHeight gfx fill footerBounds gfx setColor footerTextColor lm font getLineMetrics footerText frc gfx drawString footerText float pageX pageWidth bounds getWidth float pageY pageHeight bounds getHeight lm getAscent return footerBounds getHeight static class PrintTabExpander implements TabExpander private double pageX private double tabWidth public PrintTabExpander double pageX double tabWidth this pageX pageX this tabWidth tabWidth public float nextTabStop float int tabOffset int ntabs int pageX tabWidth return float ntabs tabWidth pageX public class HyperSearchResult public String path public Buffer buffer public int line public int start public int end public Position startPos public Position endPos public HyperSearchResult Buffer buffer int line int start int end path buffer getPath this line line this start start this end end if buffer isTemporary bufferOpened buffer str line buffer getLineText line replace trim public void bufferOpened Buffer buffer this buffer buffer startPos buffer createPosition start endPos buffer createPosition end public void bufferClosed buffer null startPos endPos null public Buffer getBuffer if buffer null buffer jEdit openFile null path return buffer public String toString return str class BSHImportDeclaration extends SimpleNode public boolean superImport BSHImportDeclaration int id super id public Object eval CallStack callstack Interpreter interpreter throws EvalError if superImport NameSpace doSuperImport else NameSpace namespace callstack top String name BSHAmbiguousName jjtGetChild getName namespace value else return Primitive VOID class BSHAssignment extends SimpleNode implements ParserConstants public int operator BSHAssignment int id super id public Object eval CallStack callstack Interpreter interpreter throws EvalError BSHLHSPrimaryExpression lhsNode BSHLHSPrimaryExpression jjtGetChild if lhsNode null throw new InterpreterError LHS lhs lhsNode toLHS callstack interpreter if lhs null throw new InterpreterError Object rhs SimpleNode jjtGetChild eval callstack interpreter if rhs Primitive VOID throw new EvalError this switch operator case ASSIGN try return lhs assign rhs catch EvalError reThrow this case PLUSASSIGN return lhs assign operation lhs getValue rhs PLUS case MINUSASSIGN return lhs assign operation lhs getValue rhs MINUS case STARASSIGN return lhs assign operation lhs getValue rhs STAR case SLASHASSIGN return lhs assign operation lhs getValue rhs SLASH case ANDASSIGN case ANDASSIGNX return lhs assign operation lhs getValue rhs BIT_AND case ORASSIGN case ORASSIGNX return lhs assign operation lhs getValue rhs BIT_OR case XORASSIGN return lhs assign operation lhs getValue rhs XOR case MODASSIGN return lhs assign operation lhs getValue rhs MOD case LSHIFTASSIGN case LSHIFTASSIGNX return lhs assign operation lhs getValue rhs LSHIFT case RSIGNEDSHIFTASSIGN case RSIGNEDSHIFTASSIGNX return lhs assign operation lhs getValue rhs RSIGNEDSHIFT case RUNSIGNEDSHIFTASSIGN case RUNSIGNEDSHIFTASSIGNX return lhs assign operation lhs getValue rhs RUNSIGNEDSHIFT default throw new InterpreterError private Object operation Object lhs Object rhs int kind throws EvalError if lhs instanceof String rhs Primitive VOID if kind PLUS throw new EvalError this return String lhs rhs if lhs instanceof Primitive rhs instanceof Primitive if lhs Primitive VOID rhs Primitive VOID throw new EvalError this else if lhs Primitive NULL rhs Primitive NULL throw new EvalError this if lhs instanceof Boolean lhs instanceof Character lhs instanceof Number lhs instanceof Primitive rhs instanceof Boolean rhs instanceof Character rhs instanceof Number rhs instanceof Primitive return Primitive binaryOperation lhs rhs kind throw new EvalError lhs getClass tokenImage kind rhs getClass this public class BeanShellErrorDialog extends EnhancedDialog public BeanShellErrorDialog View view String message super view jEdit getProperty true JPanel content new JPanel new BorderLayout content setBorder new EmptyBorder setContentPane content Box iconBox new Box BoxLayout Y_AXIS iconBox add new JLabel UIManager getIcon iconBox add Box createGlue content add BorderLayout WEST iconBox JPanel centerPanel new JPanel new BorderLayout JPanel caption new JPanel new GridLayout caption setBorder new EmptyBorder caption add new JLabel jEdit getProperty caption add new JLabel jEdit getProperty centerPanel add BorderLayout NORTH caption JTextArea textArea new JTextArea textArea setText message textArea setLineWrap true textArea setWrapStyleWord true centerPanel add BorderLayout CENTER new JScrollPane textArea content add BorderLayout CENTER centerPanel Box buttons new Box BoxLayout X_AXIS buttons add Box createGlue JButton ok new JButton jEdit getProperty ok addActionListener new ActionHandler buttons add ok buttons add Box createGlue content add BorderLayout SOUTH buttons getRootPane setDefaultButton ok pack setLocationRelativeTo view show public void ok dispose public void cancel dispose class ActionHandler implements ActionListener public void actionPerformed ActionEvent evt dispose class SettingsReloader implements EBComponent public void handleMessage EBMessage msg if msg instanceof VFSUpdate VFSUpdate vmsg VFSUpdate msg maybeReload vmsg getPath private void maybeReload String path String jEditHome jEdit getJEditHome String settingsDirectory jEdit getSettingsDirectory String osName System getProperty if OperatingSystem isDOSDerived OperatingSystem isMacOS path path toLowerCase if jEditHome null jEditHome jEditHome toLowerCase if settingsDirectory null settingsDirectory settingsDirectory toLowerCase if jEditHome null path startsWith jEditHome path path substring jEditHome length else if settingsDirectory null path startsWith settingsDirectory path path substring settingsDirectory length else return if path startsWith File separator path startsWith path path substring if path startsWith Macros loadMacros else if path endsWith path endsWith File separator jEdit reloadModes public class EnhancedCheckBoxMenuItem extends JCheckBoxMenuItem public EnhancedCheckBoxMenuItem String label EditAction action super label this action action if action null setEnabled true addActionListener new EditAction Wrapper action shortcutProp1 action getName shortcutProp2 action getName addMouseListener new MouseHandler else setEnabled false setModel new Model public Dimension getPreferredSize Dimension super getPreferredSize String shortcut getShortcut if shortcut null width getFontMetrics acceleratorFont stringWidth shortcut return public void paint Graphics super paint String shortcut getShortcut if shortcut null setFont acceleratorFont setColor getModel isArmed acceleratorSelectionForeground acceleratorForeground FontMetrics fm getFontMetrics Insets insets getInsets drawString shortcut getWidth fm stringWidth shortcut insets right insets left getFont getSize insets top public String getActionCommand return getModel getActionCommand private String shortcutProp1 private String shortcutProp2 private EditAction action private static Font acceleratorFont private static Color acceleratorForeground private static Color acceleratorSelectionForeground private String getShortcut if action null return null else String shortcut1 jEdit getProperty shortcutProp1 String shortcut2 jEdit getProperty shortcutProp2 if shortcut1 null shortcut1 length if shortcut2 null shortcut2 length return null else return shortcut2 else if shortcut2 null shortcut2 length return shortcut1 else return shortcut1 shortcut2 static acceleratorFont UIManager getFont acceleratorFont new Font acceleratorFont getStyle acceleratorFont getSize acceleratorForeground UIManager getColor acceleratorSelectionForeground UIManager getColor class Model extends DefaultButtonModel public boolean isSelected if isShowing return false try return action isSelected GUIUtilities getView EnhancedCheckBoxMenuItem this catch Throwable Log log Log ERROR this return false public void setSelected boolean class MouseHandler extends MouseAdapter public void mouseReleased MouseEvent evt GUIUtilities getView Component evt getSource getStatus setMessage null public void mouseEntered MouseEvent evt String msg action getMouseOverText if msg null GUIUtilities getView Component evt getSource getStatus setMessage msg public void mouseExited MouseEvent evt GUIUtilities getView Component evt getSource getStatus setMessage null public class jEdit public static String getVersion return MiscUtilities buildToVersion getBuild public static String getBuild return public static void main String args String javaVersion System getProperty if javaVersion compareTo System err println javaVersion System err println System exit int level Log WARNING if args length String levelStr args if levelStr length Character isDigit levelStr charAt level Integer parseInt levelStr args null boolean endOpts false settingsDirectory MiscUtilities constructPath System getProperty String portFile boolean restore true boolean noPlugins false boolean noStartupScripts false String userDir System getProperty String scriptFile null for int args length String arg args if arg null continue else if arg length args null else if arg startsWith endOpts if arg equals endOpts true else if arg equals version System err println usage System exit else if arg equals version System exit else if arg equals settingsDirectory null else if arg startsWith settingsDirectory arg substring else if arg startsWith portFile null else if arg equals portFile else if arg startsWith portFile arg substring else if arg startsWith background true else if arg equals gui false else if arg equals restore false else if arg equals noPlugins true else if arg equals noStartupScripts true else if arg startsWith scriptFile arg substring else System err println arg usage System exit args null if settingsDirectory null portFile null portFile MiscUtilities constructPath settingsDirectory portFile else portFile null Log init true level if portFile null new File portFile exists int port key try BufferedReader in new BufferedReader new FileReader portFile String check in readLine if check equals throw new Exception port Integer parseInt in readLine key Integer parseInt in readLine in close Socket socket new Socket InetAddress getByName port DataOutputStream out new DataOutputStream socket getOutputStream out writeInt key String script makeServerScript restore args scriptFile out writeUTF script out close System exit catch Exception Log log Log NOTICE jEdit class Log log Log NOTICE jEdit class Log log Log NOTICE jEdit class Log log Log NOTICE jEdit class Log log Log NOTICE jEdit class if new File settingsDirectory exists GUIUtilities showSplashScreen Writer stream if settingsDirectory null File new File settingsDirectory if exists mkdirs File new File settingsDirectory if exists mkdir String logPath MiscUtilities constructPath settingsDirectory backupSettingsFile new File logPath try stream new BufferedWriter new FileWriter logPath catch Exception printStackTrace stream null else stream null Log setLogWriter stream Log log Log NOTICE jEdit class getVersion Log log Log MESSAGE jEdit class settingsDirectory if portFile null server new EditServer portFile if server isOK server null else if background background false System err println initMisc initSystemProperties if jEditHome null initSiteProperties GUIUtilities advanceSplashProgress BeanShell init initUserProperties initPLAF if OperatingSystem hasJava14 System getProperty null try ClassLoader loader jEdit class getClassLoader Class clazz if loader null clazz loader loadClass else clazz Class forName java lang reflect Method meth clazz getMethod new Class meth invoke null new Object catch Exception Log log Log ERROR jEdit class System exit initActions initDockables GUIUtilities advanceSplashProgress VFSManager init if noPlugins initPlugins if settingsDirectory null File history new File MiscUtilities constructPath settingsDirectory if history exists historyModTime history lastModified HistoryModel loadHistory history File recent new File MiscUtilities constructPath settingsDirectory if recent exists recentModTime recent lastModified BufferHistory load recent GUIUtilities advanceSplashProgress sortBuffers getBooleanProperty sortByName getBooleanProperty reloadModes GUIUtilities advanceSplashProgress SearchAndReplace load GUIUtilities advanceSplashProgress for int jars size EditPlugin JAR jars elementAt getClassLoader startAllPlugins Macros loadMacros if noStartupScripts jEditHome null String path MiscUtilities constructPath jEditHome File file new File path if file exists runStartupScripts file if noStartupScripts settingsDirectory null String path MiscUtilities constructPath settingsDirectory File file new File path if file exists file mkdirs else runStartupScripts file if scriptFile null scriptFile MiscUtilities constructPath userDir scriptFile BeanShell runScript null scriptFile null false propertiesChanged GUIUtilities advanceSplashProgress Buffer buffer openFiles null userDir args if buffer null gui true String splitConfig null if restore settingsDirectory null jEdit getBooleanProperty bufferCount jEdit getBooleanProperty splitConfig restoreOpenFiles if bufferCount gui newFile null final Buffer buffer final String splitConfig final boolean gui GUIUtilities advanceSplashProgress SwingUtilities invokeLater new Runnable public void run EditBus send new EditorStarted null if View view if null view newView null else view newView null VFSManager start if server null server start GUIUtilities hideSplashScreen Log log Log MESSAGE jEdit class if pluginErrors null String caption jEdit getProperty pluginErrors size new Integer new Integer pluginErrors size new ErrorListDialog jEdit getFirstView jEdit getProperty caption pluginErrors true pluginErrors removeAllElements public static final Properties getProperties return props public static final String getProperty String name return props getProperty name public static final String getProperty String name String def return props getProperty name def public static final String getProperty String name Object args if name null return null if args null return props getProperty name else String value props getProperty name if value null return null else return MessageFormat format value args public static final boolean getBooleanProperty String name return getBooleanProperty name false public static final boolean getBooleanProperty String name boolean def String value getProperty name if value null return def else if value equals value equals value equals return true else if value equals value equals value equals return false else return def public static final int getIntegerProperty String name int def String value getProperty name if value null return def else try return Integer parseInt value catch NumberFormatException nf return def public static final Font getFontProperty String name return getFontProperty name null public static final Font getFontProperty String name Font def String family getProperty name String sizeString getProperty name String styleString getProperty name if family null sizeString null styleString null return def else int size style try size Integer parseInt sizeString catch NumberFormatException nf return def try style Integer parseInt styleString catch NumberFormatException nf return def return new Font family style size public static Color getColorProperty String name return getColorProperty name Color black public static Color getColorProperty String name Color def String value getProperty name if value null return def else return GUIUtilities parseColor value def public static void setColorProperty String name Color value setProperty name GUIUtilities getColorHexString value public static final void setProperty String name String value if value null value length String prop String defaultProps get name if prop null prop length props remove name else props put name else String prop String defaultProps get name if value equals prop props remove name else props put name value public static final void setTemporaryProperty String name String value props remove name defaultProps put name value public static final void setBooleanProperty String name boolean value setProperty name value public static final void setIntegerProperty String name int value setProperty name String valueOf value public static final void setFontProperty String name Font value setProperty name value getFamily setIntegerProperty name value getSize setIntegerProperty name value getStyle public static final void unsetProperty String name if defaultProps get name null props put name else props remove name public static final void resetProperty String name props remove name public static void propertiesChanged initKeyBindings Autosave setInterval getIntegerProperty saveCaret getBooleanProperty UIDefaults defaults UIManager getDefaults Font font getFontProperty defaults put font defaults put font initProxy EditBus send new PropertiesChanged null public static String getNotLoadedPluginJARs Vector returnValue new Vector if jEditHome null String systemPluginDir MiscUtilities constructPath jEditHome String list new File systemPluginDir list if list null getNotLoadedPluginJARs returnValue systemPluginDir list if settingsDirectory null String userPluginDir MiscUtilities constructPath settingsDirectory String list new File userPluginDir list if list null getNotLoadedPluginJARs returnValue userPluginDir list String new String returnValue size returnValue copyInto return public static EditPlugin getPlugin String name EditPlugin plugins getPlugins for int plugins length if plugins getClassName equals name return plugins return null public static EditPlugin getPlugins Vector vector new Vector for int jars size EditPlugin JAR jars elementAt getPlugins vector EditPlugin array new EditPlugin vector size vector copyInto array return array public static EditPlugin JAR getPluginJARs EditPlugin JAR array new EditPlugin JAR jars size jars copyInto array return array public static EditPlugin JAR getPluginJAR String path for int jars size EditPlugin JAR jar EditPlugin JAR jars elementAt if jar getPath equals path return jar return null public static void addPluginJAR EditPlugin JAR plugin addActionSet plugin getActions jars addElement plugin public static void addActionSet ActionSet actionSet actionSets addElement actionSet public static ActionSet getActionSets ActionSet retVal new ActionSet actionSets size actionSets copyInto retVal return retVal public static EditAction getAction String name for int actionSets size EditAction action ActionSet actionSets elementAt getAction name if action null return action return null public static ActionSet getActionSetForAction EditAction action for int actionSets size ActionSet set ActionSet actionSets elementAt if set contains action return set return null public static EditAction getActions Vector vec new Vector for int actionSets size ActionSet actionSets elementAt getActions vec EditAction retVal new EditAction vec size vec copyInto retVal return retVal public static void reloadModes modes new Vector if jEditHome null loadModeCatalog true else loadModeCatalog MiscUtilities constructPath jEditHome false if settingsDirectory null File userModeDir new File MiscUtilities constructPath settingsDirectory if userModeDir exists userModeDir mkdirs File userCatalog new File MiscUtilities constructPath settingsDirectory if userCatalog exists try FileWriter out new FileWriter userCatalog out write jEdit getProperty out close catch IOException io Log log Log ERROR jEdit class io loadModeCatalog userCatalog getPath false Buffer buffer buffersFirst while buffer null buffer setMode buffer buffer next public static Mode getMode String name for int modes size Mode mode Mode modes elementAt if mode getName equals name return mode return null public static Mode getModes Mode array new Mode modes size modes copyInto array return array public static void showOpenFileDialog View view showOpenFileDialog view null public static void showOpenFileWithOtherEncodingDialog View view String encoding GUIUtilities input view null jEdit getProperty System getProperty if encoding null return Macros Recorder recorder view getMacroRecorder if recorder null recorder record recorder record encoding recorder record Hashtable props new Hashtable props put Buffer ENCODING encoding showOpenFileDialog view props public static void showOpenFileDialog View view Hashtable props String files GUIUtilities showVFSFileDialog view null VFSBrowser OPEN_DIALOG true Buffer buffer null if files null for int files length Buffer newBuffer openFile null null files false props if newBuffer null buffer newBuffer if buffer null view setBuffer buffer public static String restoreOpenFiles if settingsDirectory null return null File session new File MiscUtilities constructPath settingsDirectory if session exists return null String splitConfig null try BufferedReader in new BufferedReader new FileReader session String line while line in readLine null if line startsWith splitConfig line substring else openFile null line in close catch IOException io Log log Log ERROR jEdit class session Log log Log ERROR jEdit class io return splitConfig public static void saveOpenFiles View view if settingsDirectory null return view getEditPane saveCaretInfo Buffer current view getBuffer File session new File MiscUtilities constructPath settingsDirectory try String lineSep System getProperty BufferedWriter out new BufferedWriter new FileWriter session Buffer buffer buffersFirst while buffer null if buffer isUntitled out write buffer getPath out write lineSep buffer buffer next out write out write view getSplitConfig out write lineSep out close catch IOException io Log log Log ERROR jEdit class session Log log Log ERROR jEdit class io public static Buffer openFiles View view String parent String args Buffer retVal null Buffer lastBuffer null for int args length String arg args if arg null continue else if arg startsWith arg startsWith if lastBuffer null gotoMarker view lastBuffer arg continue lastBuffer openFile null parent arg false null if retVal null lastBuffer null retVal lastBuffer if view null retVal null view setBuffer retVal return retVal public static Buffer openFile View view String path return openFile view null path false new Hashtable public static Buffer openFile View view String parent String path boolean readOnly boolean newFile return openFile view parent path newFile new Hashtable public static Buffer openFile View view String parent String path boolean readOnly boolean newFile Hashtable props return openFile view parent path newFile props public static Buffer openFile View view String parent String path boolean newFile Hashtable props if view null parent null parent MiscUtilities getParentOfPath view getBuffer getPath if MiscUtilities isURL path if MiscUtilities getProtocolOfURL path equals path path substring path MiscUtilities constructPath parent path if MiscUtilities isURL path path MiscUtilities canonPath path synchronized bufferListLock Buffer buffer getBuffer path if buffer null if view null view setBuffer buffer return buffer if props null props new Hashtable BufferHistory Entry entry BufferHistory getEntry path if entry null saveCaret props get Buffer CARET null int caret entry caret props put Buffer CARET new Integer entry caret if entry selection null props put Buffer SELECTION entry getSelection if entry null props get Buffer ENCODING null if entry encoding null props put Buffer ENCODING entry encoding Buffer newBuffer new Buffer path newFile false props if newBuffer load view false return null addBufferToList newBuffer EditBus send new BufferUpdate newBuffer view BufferUpdate CREATED if view null view setBuffer newBuffer return newBuffer public static Buffer openTemporary View view String parent String path boolean newFile if view null parent null parent MiscUtilities getParentOfPath view getBuffer getPath if MiscUtilities isURL path if MiscUtilities getProtocolOfURL path equals path path substring path MiscUtilities constructPath parent path synchronized bufferListLock Buffer buffer getBuffer path if buffer null return buffer buffer new Buffer path newFile true new Hashtable if buffer load view false return null else return buffer public static void commitTemporary Buffer buffer if buffer isTemporary return addBufferToList buffer buffer commitTemporary EditBus send new BufferUpdate buffer null BufferUpdate CREATED public static Buffer newFile View view String path if view null view getBuffer null path MiscUtilities getParentOfPath view getBuffer getPath VFS vfs VFSManager getVFSForPath path if vfs getCapabilities VFS WRITE_CAP path System getProperty else path null return newFile view path public static Buffer newFile View view String dir if dir null buffersFirst null buffersFirst buffersLast buffersFirst isUntitled buffersFirst isDirty closeBuffer view buffersFirst return buffersFirst int untitledCount Buffer buffer buffersFirst while buffer null if buffer getName startsWith try untitledCount Math max untitledCount Integer parseInt buffer getName substring catch NumberFormatException nf buffer buffer next return openFile view dir untitledCount true null public static boolean closeBuffer View view Buffer buffer if buffer isPerformingIO VFSManager waitForRequests if VFSManager errorOccurred return false if buffer isDirty Object args buffer getName int result GUIUtilities confirm view args JOptionPane YES_NO_CANCEL_OPTION JOptionPane WARNING_MESSAGE if result JOptionPane YES_OPTION if buffer save view null true return false else if result JOptionPane NO_OPTION return false view buffer return true public static void View view Buffer buffer if buffer isClosed return if buffer isNewFile view getEditPane saveCaretInfo Integer Integer buffer getProperty Buffer CARET int caret null intValue BufferHistory setEntry buffer getPath caret Selection buffer getProperty Buffer SELECTION buffer getStringProperty Buffer ENCODING removeBufferFromList buffer buffer close EditBus send new BufferUpdate buffer view BufferUpdate CLOSED if buffersFirst null buffersLast null newFile view public static boolean closeAllBuffers View view return closeAllBuffers view false public static boolean closeAllBuffers View view boolean isExiting boolean dirty false Buffer buffer buffersFirst while buffer null if buffer isDirty dirty true break buffer buffer next if dirty boolean ok new CloseDialog view isOK if ok return false VFSManager waitForRequests if VFSManager errorOccurred return false buffer buffersFirst buffersFirst buffersLast null bufferCount while buffer null if buffer isNewFile Integer Integer buffer getProperty Buffer CARET int caret null intValue BufferHistory setEntry buffer getPath caret Selection buffer getProperty Buffer SELECTION buffer getStringProperty Buffer ENCODING buffer close if isExiting EditBus send new BufferUpdate buffer view BufferUpdate CLOSED buffer buffer next if isExiting newFile view return true public static void saveAllBuffers View view boolean confirm if confirm int result GUIUtilities confirm view null JOptionPane YES_NO_OPTION JOptionPane QUESTION_MESSAGE if result JOptionPane YES_OPTION return Buffer current view getBuffer Buffer buffer buffersFirst while buffer null if buffer isDirty if buffer isNewFile view setBuffer buffer buffer save view null true buffer buffer next view setBuffer current public static void reloadAllBuffers final View view boolean confirm if confirm int result GUIUtilities confirm view null JOptionPane YES_NO_OPTION JOptionPane QUESTION_MESSAGE if result JOptionPane YES_OPTION return View viewsFirst while null EditPane panes getEditPanes for int panes length panes saveCaretInfo next Buffer buffers jEdit getBuffers for int buffers length Buffer buffer buffers buffer load view true public static Buffer getBuffer String path boolean caseInsensitiveFilesystem File separatorChar synchronized bufferListLock Buffer buffer buffersFirst while buffer null String buffer getPath if caseInsensitiveFilesystem if equalsIgnoreCase path return buffer else if equals path return buffer buffer buffer next return null public static Buffer getBuffers Buffer buffers new Buffer bufferCount Buffer buffer buffersFirst for int bufferCount buffers buffer buffer buffer next return buffers public static int getBufferCount return bufferCount public static Buffer getFirstBuffer return buffersFirst public static Buffer getLastBuffer return buffersLast public static InputHandler getInputHandler return inputHandler public static View newView View view Buffer buffer if view null view showWaitCursor view getEditPane saveCaretInfo View newView new View buffer null newView pack if view null GUIUtilities saveGeometry view view hideWaitCursor GUIUtilities loadGeometry newView addViewToList newView EditBus send new ViewUpdate newView ViewUpdate CREATED GUIUtilities requestFocus newView newView getTextArea newView show if newView viewsFirst if settingsDirectory null getBooleanProperty new HelpViewer else if jEdit getBooleanProperty new TipOfTheDay newView setBooleanProperty false return newView public static View newView View view return newView view view getSplitConfig public static View newView View view String splitConfig if view null view showWaitCursor view getEditPane saveCaretInfo View newView new View null splitConfig newView pack if view null GUIUtilities saveGeometry view view hideWaitCursor GUIUtilities loadGeometry newView addViewToList newView EditBus send new ViewUpdate newView ViewUpdate CREATED GUIUtilities requestFocus newView newView getTextArea newView show if newView viewsFirst if settingsDirectory null getBooleanProperty new HelpViewer else if jEdit getBooleanProperty new TipOfTheDay newView setBooleanProperty false return newView public static void closeView View view closeView view true public static View getViews View views new View viewCount View view viewsFirst for int viewCount views view view view next return views public static int getViewCount return viewCount public static View getFirstView return viewsFirst public static View getLastView return viewsLast public static boolean isBackgroundModeEnabled return background public static void showMemoryDialog View view Runtime rt Runtime getRuntime int before int rt freeMemory System gc int after int rt freeMemory int total int rt totalMemory JProgressBar progress new JProgressBar total progress setValue total after progress setStringPainted true progress setString jEdit getProperty new Object new Integer total after new Integer total Object message new Object message getProperty new Object new Integer after before message Box createVerticalStrut message progress message Box createVerticalStrut JOptionPane showMessageDialog view message jEdit getProperty JOptionPane INFORMATION_MESSAGE public static String getJEditHome return jEditHome public static String getSettingsDirectory return settingsDirectory public static void backupSettingsFile File file if settingsDirectory null return String backupDir MiscUtilities constructPath settingsDirectory File dir new File backupDir if dir exists dir mkdirs MiscUtilities saveBackup file null backupDir public static void saveSettings if settingsDirectory null File file1 new File MiscUtilities constructPath settingsDirectory File file2 new File MiscUtilities constructPath settingsDirectory if file2 exists file2 lastModified recentModTime Log log Log WARNING jEdit class file2 else backupSettingsFile file2 BufferHistory save file1 file2 delete file1 renameTo file2 recentModTime file2 lastModified file1 new File MiscUtilities constructPath settingsDirectory file2 new File MiscUtilities constructPath settingsDirectory if file2 exists file2 lastModified historyModTime Log log Log WARNING jEdit class file2 else backupSettingsFile file2 HistoryModel saveHistory file1 file2 delete file1 renameTo file2 historyModTime file2 lastModified SearchAndReplace save Abbrevs save FavoritesVFS saveFavorites file1 new File MiscUtilities constructPath settingsDirectory file2 new File MiscUtilities constructPath settingsDirectory if file2 exists file2 lastModified propsModTime Log log Log WARNING jEdit class file2 else backupSettingsFile file2 try OutputStream out new FileOutputStream file1 props store out out close catch IOException io Log log Log ERROR jEdit class io file2 delete file1 renameTo file2 propsModTime file2 lastModified public static void exit View view boolean reallyExit VFSManager waitForRequests EditBus send new EditorExitRequested view reallyExit background saveOpenFiles view if closeAllBuffers view reallyExit return if reallyExit view viewsFirst while view null closeView view false view view next saveSettings return view close Autosave stop if server null server stopServer EditPlugin plugins getPlugins for int plugins length try plugins stop catch Throwable Log log Log ERROR jEdit class Log log Log ERROR jEdit class EditBus send new EditorExiting null saveSettings Log closeStream System exit static void updatePosition Buffer buffer if sortBuffers removeBufferFromList buffer addBufferToList buffer public static void addMode Mode mode Log log Log DEBUG jEdit class mode getName modes addElement mode Object fileName mode getProperty Log log Log NOTICE jEdit class fileName XmlParser parser new XmlParser XModeHandler xmh new XModeHandler parser mode getName fileName toString parser setHandler xmh try Reader grammar if fileName instanceof URL grammar new BufferedReader new InputStreamReader URL fileName openStream else grammar new BufferedReader new FileReader String fileName parser parse null null grammar catch Throwable Log log Log ERROR jEdit class if instanceof XmlException XmlException xe XmlException int line xe getLine String message xe getMessage Object args fileName new Integer line message GUIUtilities error null args TokenMarker marker new TokenMarker marker addRuleSet new ParserRuleSet mode mode setTokenMarker marker throws IOException in new BufferedInputStream in if def defaultProps load in else props load in in close static boolean loadActions String path Reader in ActionSet actionSet try Log log Log DEBUG jEdit class path ActionListHandler ah new ActionListHandler path actionSet XmlParser parser new XmlParser parser setHandler ah parser parse null null in return true catch XmlException xe int line xe getLine String message xe getMessage Log log Log ERROR jEdit class path line message catch Exception Log log Log ERROR jEdit class return false static void pluginError final String path String messageProp Object args if pluginErrors null pluginErrors new Vector pluginErrors addElement new ErrorListDialog ErrorEntry path messageProp args private static String jEditHome private static String settingsDirectory private static long propsModTime historyModTime recentModTime private static Properties defaultProps private static Properties props private static EditServer server private static boolean background private static Vector actionSets private static ActionSet builtInActionSet private static Vector pluginErrors private static Vector jars private static Vector modes private static Vector recent private static boolean saveCaret private static InputHandler inputHandler private static JEditMetalTheme theme private static boolean sortBuffers private static boolean sortByName private static int bufferCount private static Buffer buffersFirst private static Buffer buffersLast private static Object bufferListLock new Object private static int viewCount private static View viewsFirst private static View viewsLast private jEdit private static void usage System out println System out println System out println System out println System out println System out println System out println System out println System out println System out println System out println System out println System out println System out println System out println System out println System out println System out println System out println System out println System out println System out println private static void version System out println getVersion private static String makeServerScript boolean restore String args String scriptFile StringBuffer script new StringBuffer String userDir System getProperty script append script append MiscUtilities charsToEscapes userDir script append script append script append args length script append for int args length script append script append script append if args null script append else script append script append MiscUtilities charsToEscapes args script append script append script append restore if scriptFile null scriptFile MiscUtilities constructPath userDir scriptFile script append MiscUtilities charsToEscapes scriptFile return script toString private static void initMisc System getProperties put System getProperty String userAgent getVersion System getProperty System getProperty System getProperty System getProperties put userAgent inputHandler new DefaultInputHandler null jEditHome System getProperty if jEditHome null String classpath System getProperty int index classpath toLowerCase indexOf int start classpath lastIndexOf File pathSeparator index if classpath equalsIgnoreCase jEditHome System getProperty else if index start jEditHome classpath substring start index else jEditHome System getProperty Log log Log WARNING jEdit class Log log Log WARNING jEdit class jEditHome Log log Log WARNING jEdit class Log log Log MESSAGE jEdit class jEditHome jars new Vector EditBus addToBus new SettingsReloader SwingUtilities invokeLater new Runnable public void run Thread currentThread setContextClassLoader new JARClassLoader private static void initSystemProperties defaultProps props new Properties try loadProps jEdit class getResourceAsStream true loadProps jEdit class getResourceAsStream true loadProps jEdit class getResourceAsStream true catch Exception Log log Log ERROR jEdit class Log log Log ERROR jEdit class Log log Log ERROR jEdit class System exit private static void initSiteProperties String siteSettingsDirectory MiscUtilities constructPath jEditHome File siteSettings new File siteSettingsDirectory if siteSettings exists siteSettings isDirectory return String snippets siteSettings list if snippets null return MiscUtilities quicksort snippets new MiscUtilities StringICaseCompare for int snippets length String snippet snippets if snippet toLowerCase endsWith continue try String path MiscUtilities constructPath siteSettingsDirectory snippet Log log Log DEBUG jEdit class path loadProps new FileInputStream new File path true catch FileNotFoundException fnf Log log Log DEBUG jEdit class fnf catch IOException Log log Log ERROR jEdit class snippet Log log Log ERROR jEdit class private static void initActions actionSets new Vector Reader in new BufferedReader new InputStreamReader jEdit class getResourceAsStream builtInActionSet new ActionSet jEdit getProperty if loadActions in builtInActionSet System exit addActionSet builtInActionSet private static void initDockables Reader in new BufferedReader new InputStreamReader jEdit class getResourceAsStream if DockableWindowManager loadDockableWindows in builtInActionSet System exit private static void initPlugins if jEditHome null loadPlugins MiscUtilities constructPath jEditHome if settingsDirectory null File jarsDirectory new File settingsDirectory if jarsDirectory exists jarsDirectory mkdir loadPlugins jarsDirectory getPath private static void initUserProperties props new Properties defaultProps if settingsDirectory null File file new File MiscUtilities constructPath settingsDirectory propsModTime file lastModified try loadProps new FileInputStream file false catch FileNotFoundException fnf Log log Log DEBUG jEdit class fnf catch IOException Log log Log ERROR jEdit class private static void initPLAF theme new JEditMetalTheme theme propertiesChanged MetalLookAndFeel setCurrentTheme theme try String lf getProperty if lf null lf length UIManager setLookAndFeel lf catch Exception Log log Log ERROR jEdit class UIDefaults defaults UIManager getDefaults if jEdit getBooleanProperty Color background new javax swing plaf ColorUIResource jEdit getColorProperty Color foreground new javax swing plaf ColorUIResource jEdit getColorProperty Color caretColor new javax swing plaf ColorUIResource jEdit getColorProperty Color selectionColor new javax swing plaf ColorUIResource jEdit getColorProperty String prefixes for int prefixes length String prefix prefixes defaults put prefix background defaults put prefix background defaults put prefix foreground defaults put prefix foreground defaults put prefix caretColor defaults put prefix foreground defaults put prefix selectionColor defaults put background defaults put foreground defaults put background defaults put foreground defaults put foreground defaults put selectionColor defaults remove defaults remove private static void runStartupScripts File directory if directory isDirectory return String snippets directory list if snippets null return MiscUtilities quicksort snippets new MiscUtilities StringICaseCompare for int snippets length String snippet snippets if snippet toLowerCase endsWith continue String path new File directory snippet getPath BeanShell runScript null path null false private static void initProxy boolean enabled jEdit getBooleanProperty if enabled Log log Log DEBUG jEdit class System getProperties remove System getProperties remove System getProperties remove System getProperties remove System getProperties remove System getProperties remove Authenticator setDefault null else String host jEdit getProperty if host null return System setProperty host Log log Log DEBUG jEdit class host String port jEdit getProperty if port null System setProperty port String nonProxyHosts jEdit getProperty if nonProxyHosts null System setProperty nonProxyHosts String username jEdit getProperty String password jEdit getProperty if password null password if username null username length Log log Log DEBUG jEdit class Authenticator setDefault new FirewallAuthenticator null else Log log Log DEBUG jEdit class username PasswordAuthentication pw new PasswordAuthentication username password toCharArray Authenticator setDefault new FirewallAuthenticator pw static class FirewallAuthenticator extends Authenticator PasswordAuthentication pw public FirewallAuthenticator PasswordAuthentication pw this pw pw protected PasswordAuthentication getPasswordAuthentication return pw private static void getNotLoadedPluginJARs Vector returnValue String dir String list loop for int list length String name list if name toLowerCase endsWith continue loop String path MiscUtilities constructPath dir name for int jars size EditPlugin JAR jar EditPlugin JAR jars elementAt String jarPath jar getPath String jarName MiscUtilities getFileName jarPath if path equals jarPath continue loop else if new File jarPath exists name equals jarName continue loop returnValue addElement path private static void gotoMarker final View view final Buffer buffer final String marker VFSManager runInAWTThread new Runnable public void run int pos if marker startsWith try int line Integer parseInt marker substring pos buffer getLineStartOffset line catch Exception return else if marker startsWith if marker length return Marker buffer getMarker marker charAt if null return pos getPosition else throw new InternalError if view null view getBuffer buffer view getTextArea setCaretPosition pos else buffer setIntegerProperty Buffer CARET pos private static void addBufferToList Buffer buffer if viewCount buffersFirst null buffersFirst buffersLast buffersFirst isUntitled buffersFirst isDirty Buffer oldBuffersFirst buffersFirst buffersFirst buffersLast buffer EditBus send new BufferUpdate oldBuffersFirst null BufferUpdate CLOSED return bufferCount if buffersFirst null buffersFirst buffersLast buffer return else if sortBuffers String name1 sortByName buffer toString buffer getPath Buffer buffersFirst while null String name2 sortByName toString getPath if MiscUtilities compareStrings name1 name2 true buffer next buffer prev prev prev buffer if buffersFirst buffer prev next buffer else buffersFirst buffer return next buffer prev buffersLast buffersLast next buffer buffersLast buffer private static void removeBufferFromList Buffer buffer synchronized bufferListLock bufferCount if buffer buffersFirst buffer buffersLast buffersFirst buffersLast null return if buffer buffersFirst buffersFirst buffer next buffer next prev null else buffer prev next buffer next if buffer buffersLast buffersLast buffersLast prev buffer prev next null else buffer next prev buffer prev buffer next buffer prev null private static void addViewToList View view viewCount if viewsFirst null viewsFirst viewsLast view else view prev viewsLast viewsLast next view viewsLast view private static void removeViewFromList View view viewCount if viewsFirst viewsLast viewsFirst viewsLast null return if view viewsFirst viewsFirst view next view next prev null else view prev next view next if view viewsLast viewsLast viewsLast prev view prev next null else view next prev view prev private static void closeView View view boolean callExit if viewsFirst viewsLast callExit else EditBus send new ViewUpdate view ViewUpdate CLOSED view close removeViewFromList view private static void loadModeCatalog String path boolean resource Log log Log MESSAGE jEdit class path ModeCatalogHandler handler new ModeCatalogHandler MiscUtilities getParentOfPath path resource XmlParser parser new XmlParser parser setHandler handler try InputStream if resource jEdit class getResourceAsStream path else new FileInputStream path BufferedReader in new BufferedReader new InputStreamReader parser parse null null in catch XmlException xe int line xe getLine String message xe getMessage Log log Log ERROR jEdit class path line message catch Exception Log log Log ERROR jEdit class private static void loadPlugins String directory Log log Log NOTICE jEdit class directory File file new File directory if file exists file isDirectory return String plugins file list if plugins null return MiscUtilities quicksort plugins new MiscUtilities StringICaseCompare for int plugins length String plugin plugins if plugin toLowerCase endsWith continue String path MiscUtilities constructPath directory plugin if plugin equals plugin equals plugin equals plugin equals pluginError path null continue try Log log Log DEBUG jEdit class path new JARClassLoader path catch IOException io Log log Log ERROR jEdit class plugin Log log Log ERROR jEdit class io String args io toString pluginError path args private static void initKeyBindings inputHandler removeAllKeyBindings EditAction actions getActions for int actions length EditAction action actions String shortcut1 jEdit getProperty action getName if shortcut1 null inputHandler addKeyBinding shortcut1 action String shortcut2 jEdit getProperty action getName if shortcut2 null inputHandler addKeyBinding shortcut2 action class BSHForStatement extends SimpleNode implements ParserConstants public boolean hasForInit public boolean hasExpression public boolean hasForUpdate private SimpleNode forInit private SimpleNode expression private SimpleNode forUpdate private SimpleNode statement private boolean parsed BSHForStatement int id super id public Object eval CallStack callstack Interpreter interpreter throws EvalError int if hasForInit forInit SimpleNode jjtGetChild if hasExpression expression SimpleNode jjtGetChild if hasForUpdate forUpdate SimpleNode jjtGetChild statement SimpleNode jjtGetChild NameSpace enclosingNameSpace callstack top BlockNameSpace forNameSpace new BlockNameSpace enclosingNameSpace callstack swap forNameSpace if hasForInit forInit eval callstack interpreter Object returnControl Primitive VOID while true if hasExpression boolean cond BSHIfStatement evaluateCondition expression callstack interpreter if cond break Object ret statement eval callstack interpreter if ret instanceof ReturnControl switch ReturnControl ret kind case RETURN returnControl ret breakout true break case CONTINUE break case BREAK breakout true break if breakout break if hasForUpdate forUpdate eval callstack interpreter return returnControl class BSHAmbiguousName extends SimpleNode public String text BSHAmbiguousName int id super id public Name getName NameSpace namespace return namespace getNameResolver text public Object toObject CallStack callstack Interpreter interpreter throws EvalError return getName callstack top toObject callstack interpreter public Class toClass NameSpace namespace throws EvalError return getName namespace toClass public LHS toLHS CallStack callstack Interpreter interpreter throws EvalError return getName callstack top toLHS callstack interpreter public Object eval CallStack callstack Interpreter interpreter throws EvalError throw new InterpreterError public String toString return text public class FileRootsVFS extends VFS public static final String PROTOCOL public FileRootsVFS super try method FileSystemView class getMethod new Class java io File class fsView FileSystemView getFileSystemView Log log Log DEBUG this catch Exception Log log Log DEBUG this public int getCapabilities public String getParentOfPath String path return PROTOCOL public VFS DirectoryEntry Object session String url Component comp File roots File listRoots if roots null return null VFS DirectoryEntry rootDE new VFS DirectoryEntry roots length for int roots length String name roots getPath rootDE session name comp return rootDE public DirectoryEntry Object session String path Component comp String name path if method null name startsWith name startsWith try name name String method invoke fsView new Object new File path catch Exception return new VFS DirectoryEntry name path path VFS DirectoryEntry FILESYSTEM false private FileSystemView fsView private Method method public class RESearchMatcher implements SearchMatcher public static final RESyntax RE_SYNTAX_JEDIT new RESyntax RESyntax RE_SYNTAX_PERL5 set RESyntax RE_CHAR_CLASSES setLineSeparator public RESearchMatcher String search String replace boolean ignoreCase boolean beanshell String replaceMethod throws Exception if beanshell replace null replace length this beanshell true this replaceMethod replaceMethod replaceNS new NameSpace BeanShell getNameSpace else this replace MiscUtilities escapesToChars replace re new RE search ignoreCase RE REG_ICASE RE REG_MULTILINE RE_SYNTAX_JEDIT public int nextMatch CharIndexed text boolean start boolean end boolean firstTime int flags if start flags RE REG_NOTBOL if end flags RE REG_NOTEOL REMatch match re getMatch text flags if match null return null int match getStartIndex int match getEndIndex if firstTime text move if text charAt CharIndexed OUT_OF_BOUNDS return null match re getMatch text flags RE REG_NOTBOL if match null return null else match getStartIndex match getEndIndex int result return result public String substitute String text throws Exception REMatch match re getMatch text if match null return null if beanshell int count re getNumSubs for int count replaceNS setVariable match toString Object obj BeanShell runCachedBlock replaceMethod null replaceNS if obj null return else return obj toString else return match substituteInto replace private String replace private RE re private boolean beanshell private String replaceMethod private NameSpace replaceNS public class HyperSearchRequest extends WorkRequest public HyperSearchRequest View view SearchMatcher matcher HyperSearchResults results Selection selection this view view this matcher matcher this results results this resultTreeModel results getTreeModel this resultTreeRoot DefaultMutableTreeNode resultTreeModel getRoot this selection selection public void run SearchFileSet fileset SearchAndReplace getSearchFileSet setProgressMaximum fileset getFileCount setStatus jEdit getProperty int resultCount int bufferCount String files fileset getFiles view try if selection null Buffer buffer jEdit openTemporary null null files false if buffer null return bufferCount resultCount searchInSelection buffer else int current loop for int files length setProgressValue current Buffer buffer jEdit openTemporary null null files false if buffer null continue loop int thisResultCount doHyperSearch buffer buffer getLength if thisResultCount bufferCount resultCount thisResultCount catch final Exception Log log Log ERROR this SwingUtilities invokeLater new Runnable public void run GUIUtilities error view new String toString catch WorkThread Abort finally final int resultCount final int bufferCount VFSManager runInAWTThread new Runnable public void run results searchDone private View view private SearchMatcher matcher private HyperSearchResults results private DefaultTreeModel resultTreeModel private DefaultMutableTreeNode resultTreeRoot private Selection selection private int searchInSelection Buffer buffer throws Exception setAbortable false final DefaultMutableTreeNode bufferNode new DefaultMutableTreeNode buffer getPath int resultCount for int selection length Selection selection resultCount doHyperSearch buffer getStart getEnd setAbortable true return resultCount private int doHyperSearch Buffer buffer int start int end throws Exception setAbortable false final DefaultMutableTreeNode bufferNode new DefaultMutableTreeNode buffer getPath int resultCount doHyperSearch buffer start end bufferNode if resultCount resultTreeRoot insert bufferNode resultTreeRoot getChildCount SwingUtilities invokeLater new Runnable public void run resultTreeModel reload resultTreeRoot setAbortable true return resultCount private int doHyperSearch Buffer buffer int start int end DefaultMutableTreeNode bufferNode int resultCount try buffer readLock Segment text new Segment int offset start int length end int line loop for int counter counter buffer getText offset length offset text int match matcher nextMatch new CharIndexedSegment text false offset length buffer getLength counter if match null break loop int matchStart offset match int matchEnd offset match offset match int newLine buffer getLineOfOffset offset if line newLine continue loop line newLine resultCount bufferNode add new DefaultMutableTreeNode new HyperSearchResult buffer line matchStart matchEnd false finally buffer readUnlock return resultCount class ExtensionManager void addExtension int layer TextAreaExtension ext Entry entry new Entry layer ext for int extensions size int Entry extensions get layer if layer extensions add entry return extensions add entry void removeExtension TextAreaExtension ext for int extensions size Entry entry Entry extensions get if entry ext ext extensions remove return void paintValidLine Graphics2D gfx int screenLine int physicalLine int start int end int for int extensions size TextAreaExtension ext Entry extensions get ext try ext paintValidLine gfx screenLine physicalLine start end catch Throwable Log log Log ERROR this extensions remove void paintInvalidLine Graphics2D gfx int screenLine int for int extensions size TextAreaExtension ext Entry extensions get ext try ext paintInvalidLine gfx screenLine catch Throwable Log log Log ERROR this extensions remove String getToolTipText int int for int extensions size TextAreaExtension ext Entry extensions get ext String toolTip ext getToolTipText if toolTip null return toolTip return null private ArrayList extensions new ArrayList static class Entry int layer TextAreaExtension ext Entry int layer TextAreaExtension ext this layer layer this ext ext class BlockNameSpace extends NameSpace public BlockNameSpace NameSpace parent throws EvalError super parent parent name public void setVariable String name Object throws EvalError if weHaveVar name super setVariable name else getParent setVariable name boolean weHaveVar String name return super getVariableImpl name false null public NameSpace getSuper return getParent getSuper This getThis Interpreter declaringInterpreter return getParent getThis declaringInterpreter public abstract class InputHandler extends KeyAdapter public InputHandler View view this view view public void processKeyEvent KeyEvent evt switch evt getID case KeyEvent KEY_TYPED keyTyped evt break case KeyEvent KEY_PRESSED keyPressed evt break case KeyEvent KEY_RELEASED keyReleased evt break public abstract void addKeyBinding String keyBinding EditAction action public abstract void removeKeyBinding String keyBinding public abstract void removeAllKeyBindings public boolean isPrefixActive return false public boolean isRepeatEnabled return repeat public void setRepeatEnabled boolean repeat boolean oldRepeat this repeat this repeat repeat repeatCount if oldRepeat repeat view getStatus setMessage null public int getRepeatCount return repeat repeatCount repeatCount public void setRepeatCount int repeatCount boolean oldRepeat this repeat repeat true this repeatCount repeatCount if oldRepeat repeat view getStatus setMessage null public EditAction getLastAction return lastAction public int getLastActionCount return lastActionCount public void readNextChar String msg String code view getStatus setMessage msg readNextChar code public void readNextChar String code readNextChar code public void resetLastActionCount lastAction null lastActionCount public void invokeAction EditAction action Buffer buffer view getBuffer if lastAction action lastActionCount else lastAction action lastActionCount boolean repeat int getRepeatCount if action noRepeat action invoke view else if REPEAT_COUNT_THRESHOLD String label action getLabel if label null label action getName else label GUIUtilities prettifyMenuLabel label Object pp label new Integer if GUIUtilities confirm view pp JOptionPane WARNING_MESSAGE JOptionPane YES_NO_OPTION JOptionPane YES_OPTION repeat false repeatCount view getStatus setMessage null return try buffer beginCompoundEdit for int action invoke view finally buffer endCompoundEdit Macros Recorder recorder view getMacroRecorder if recorder null action noRecord recorder record action getCode if if readNextChar null return repeat false repeatCount view getStatus setMessage null private static final int REPEAT_COUNT_THRESHOLD protected View view protected boolean repeat protected int repeatCount protected EditAction lastAction protected int lastActionCount protected String readNextChar protected void userInput char ch lastAction null if readNextChar null invokeReadNextChar ch else JEditTextArea textArea view getTextArea Buffer buffer view getBuffer int getRepeatCount if textArea userInput ch else if REPEAT_COUNT_THRESHOLD Object pp String valueOf ch new Integer if GUIUtilities confirm view pp JOptionPane WARNING_MESSAGE JOptionPane YES_NO_OPTION JOptionPane YES_OPTION repeat false repeatCount view getStatus setMessage null return for int textArea userInput ch Macros Recorder recorder view getMacroRecorder if recorder null recorder record ch setRepeatEnabled false protected void invokeReadNextChar char ch Buffer buffer view getBuffer String charStr MiscUtilities charsToEscapes String valueOf ch int index while index readNextChar indexOf readNextChar readNextChar substring index charStr readNextChar substring index Macros Recorder recorder view getMacroRecorder if recorder null recorder record getRepeatCount readNextChar if getRepeatCount try buffer beginCompoundEdit BeanShell eval view BeanShell getNameSpace getRepeatCount readNextChar finally buffer endCompoundEdit else BeanShell eval view BeanShell getNameSpace readNextChar readNextChar null view getStatus setMessage null public class BufferPrinter public static void pageSetup View view PrinterJob job PrinterJob getPrinterJob if format null format job defaultPage PageFormat newFormat job pageDialog format if newFormat null format newFormat public static void print View view Buffer buffer boolean selection PrinterJob job PrinterJob getPrinterJob if format null format job defaultPage Font font jEdit getFontProperty boolean header jEdit getBooleanProperty boolean footer jEdit getBooleanProperty boolean lineNumbers jEdit getBooleanProperty boolean color jEdit getBooleanProperty job setJobName buffer getPath job setPrintable new BufferPrintable buffer font header footer lineNumbers color format if job printDialog return try job print catch PrinterAbortException ae Log log Log DEBUG BufferPrinter class ae catch PrinterException Log log Log ERROR BufferPrinter class String args toString GUIUtilities error view args private static PageFormat format public class ParserRuleFactory public static final ParserRule createSpanRule String begin String end byte id boolean noLineBreak boolean atLineStart boolean excludeMatch boolean noWordBreak int ruleAction TokenMarker SPAN noLineBreak TokenMarker NO_LINE_BREAK atLineStart TokenMarker AT_LINE_START excludeMatch TokenMarker EXCLUDE_MATCH noWordBreak TokenMarker NO_WORD_BREAK String strings new String strings begin strings end int ruleSeqLengths getStringLengthArray strings char ruleChars getCharArray strings ruleSeqLengths return new ParserRule ruleChars ruleSeqLengths ruleAction id public static final ParserRule createDelegateSpanRule String begin String end String delegateSet byte id boolean noLineBreak boolean atLineStart boolean excludeMatch boolean noWordBreak int ruleAction TokenMarker SPAN TokenMarker DELEGATE noLineBreak TokenMarker NO_LINE_BREAK atLineStart TokenMarker AT_LINE_START excludeMatch TokenMarker EXCLUDE_MATCH noWordBreak TokenMarker NO_WORD_BREAK String strings new String strings begin strings end strings delegateSet int ruleSeqLengths getStringLengthArray strings char ruleChars getCharArray strings ruleSeqLengths return new ParserRule ruleChars ruleSeqLengths ruleAction id public static final ParserRule createEOLSpanRule String seq byte id boolean atLineStart boolean excludeMatch int ruleAction TokenMarker EOL_SPAN atLineStart TokenMarker AT_LINE_START excludeMatch TokenMarker EXCLUDE_MATCH String strings new String strings seq int ruleSeqLengths new int char ruleChars if seq null ruleSeqLengths seq length ruleChars seq toCharArray else ruleChars new char return new ParserRule ruleChars ruleSeqLengths ruleAction id public static final ParserRule createMarkPreviousRule String seq byte id boolean atLineStart boolean excludeMatch int ruleAction TokenMarker MARK_PREVIOUS atLineStart TokenMarker AT_LINE_START excludeMatch TokenMarker EXCLUDE_MATCH String strings new String strings seq int ruleSeqLengths new int char ruleChars if seq null ruleSeqLengths seq length ruleChars seq toCharArray else ruleChars new char return new ParserRule ruleChars ruleSeqLengths ruleAction id public static final ParserRule createMarkFollowingRule String seq byte id boolean atLineStart boolean excludeMatch int ruleAction TokenMarker MARK_FOLLOWING atLineStart TokenMarker AT_LINE_START excludeMatch TokenMarker EXCLUDE_MATCH String strings new String strings seq int ruleSeqLengths new int char ruleChars if seq null ruleSeqLengths seq length ruleChars seq toCharArray else ruleChars new char return new ParserRule ruleChars ruleSeqLengths ruleAction id public static final ParserRule createSequenceRule String seq byte id boolean atLineStart int ruleAction atLineStart TokenMarker AT_LINE_START String strings new String strings seq int ruleSeqLengths new int char ruleChars if seq null ruleSeqLengths seq length ruleChars seq toCharArray else ruleChars new char return new ParserRule ruleChars ruleSeqLengths ruleAction id public static final ParserRule createEscapeRule String seq int ruleAction TokenMarker IS_ESCAPE String strings new String strings seq int ruleSeqLengths new int char ruleChars if seq null ruleSeqLengths seq length ruleChars seq toCharArray else ruleChars new char return new ParserRule ruleChars ruleSeqLengths ruleAction Token NULL public static final ParserRule createWhitespaceRule String seq int ruleAction TokenMarker WHITESPACE String strings new String strings seq int ruleSeqLengths new int char ruleChars if seq null ruleSeqLengths seq length ruleChars seq toCharArray else ruleChars new char return new ParserRule ruleChars ruleSeqLengths ruleAction Token NULL private static char getCharArray String strings int lengthArray if lengthArray null lengthArray length return new char char chars int charArrayLength for int lengthArray length charArrayLength lengthArray chars new char charArrayLength int copyOffset for int strings length if strings null System arraycopy strings toCharArray chars copyOffset lengthArray copyOffset lengthArray return chars private static int getStringLengthArray String strings int stringLengthArray if strings null return new int stringLengthArray new int strings length for int strings length if strings null stringLengthArray strings length return stringLengthArray class CommandLineReader extends FilterReader public CommandLineReader Reader in super in static final int normal lastCharNL sentSemi int state lastCharNL public int read throws IOException int if state sentSemi state lastCharNL return while in read if if state lastCharNL state sentSemi else state lastCharNL else state normal return public int read char buff int off int len throws IOException int read if else buff off char return public static void main String args throws Exception Reader in new CommandLineReader new InputStreamReader System in while true System out println in read class BSHThrowStatement extends SimpleNode BSHThrowStatement int id super id public Object eval CallStack callstack Interpreter interpreter throws EvalError Object obj SimpleNode jjtGetChild eval callstack interpreter if obj instanceof Exception throw new EvalError this throw new TargetError Exception obj this public class EditAbbrevDialog extends JDialog public EditAbbrevDialog Component comp String abbrev String expansion super JOptionPane getFrameForComponent comp jEdit getProperty true this comp comp JPanel content new JPanel new BorderLayout content setBorder new EmptyBorder setContentPane content editor new AbbrevEditor editor setAbbrev abbrev editor setExpansion expansion editor setBorder new EmptyBorder content add BorderLayout CENTER editor Box box new Box BoxLayout X_AXIS box add Box createGlue ok new JButton jEdit getProperty ok addActionListener new ActionHandler getRootPane setDefaultButton ok box add ok box add Box createHorizontalStrut cancel new JButton jEdit getProperty cancel addActionListener new ActionHandler box add cancel box add Box createGlue content add BorderLayout SOUTH box KeyListener listener new KeyHandler addKeyListener listener editor getBeforeCaretTextArea addKeyListener listener editor getAfterCaretTextArea addKeyListener listener setDefaultCloseOperation DISPOSE_ON_CLOSE pack setLocationRelativeTo comp show public String getAbbrev if isOK return null return editor getAbbrev public String getExpansion if isOK return null return editor getExpansion private Component comp private AbbrevEditor editor private JButton ok private JButton cancel private boolean isOK class ActionHandler implements ActionListener public void actionPerformed ActionEvent evt if evt getSource ok if editor getAbbrev null editor getAbbrev length getToolkit beep return isOK true dispose class KeyHandler extends KeyAdapter public void keyPressed KeyEvent evt if evt getKeyCode KeyEvent VK_ESCAPE dispose public class SelectLineRange extends EnhancedDialog implements ActionListener public SelectLineRange View view super view jEdit getProperty true this view view JPanel content new JPanel new BorderLayout content setBorder new EmptyBorder setContentPane content JLabel label new JLabel jEdit getProperty label setBorder new EmptyBorder content add BorderLayout NORTH label JPanel panel createFieldPanel content add BorderLayout CENTER panel panel new JPanel panel setLayout new BoxLayout panel BoxLayout X_AXIS panel setBorder new EmptyBorder panel add Box createGlue panel add Box createGlue ok new JButton jEdit getProperty ok addActionListener this getRootPane setDefaultButton ok panel add ok panel add Box createHorizontalStrut cancel new JButton jEdit getProperty cancel addActionListener this panel add cancel panel add Box createGlue content add panel BorderLayout SOUTH GUIUtilities requestFocus this startField pack setLocationRelativeTo view show public void ok int startLine int endLine try startLine Integer parseInt startField getText endLine Integer parseInt endField getText catch NumberFormatException nf getToolkit beep return Buffer buffer view getBuffer if startLine endLine buffer getLineCount startLine endLine getToolkit beep return JEditTextArea textArea view getTextArea textArea setSelection new Selection Range buffer getLineStartOffset startLine buffer getLineEndOffset endLine textArea moveCaretPosition buffer getLineEndOffset endLine dispose public void cancel dispose public void actionPerformed ActionEvent evt Object source evt getSource if source ok ok else if source cancel cancel private View view private JTextField startField private JTextField endField private JButton ok private JButton cancel private JPanel createFieldPanel GridBagLayout layout new GridBagLayout JPanel panel new JPanel layout GridBagConstraints cons new GridBagConstraints cons insets new Insets cons gridwidth cons gridheight cons gridx cons gridy cons fill GridBagConstraints BOTH JLabel label new JLabel jEdit getProperty SwingConstants RIGHT layout setConstraints label cons panel add label startField new JTextField cons gridx cons weightx layout setConstraints startField cons panel add startField label new JLabel jEdit getProperty SwingConstants RIGHT cons gridx cons weightx cons gridy layout setConstraints label cons panel add label endField new JTextField cons gridx cons weightx layout setConstraints endField cons panel add endField return panel class BSHSwitchStatement extends SimpleNode implements ParserConstants public BSHSwitchStatement int id super id public Object eval CallStack callstack Interpreter interpreter throws EvalError int numchild jjtGetNumChildren int child SimpleNode switchExp SimpleNode jjtGetChild child Object switchVal switchExp eval callstack interpreter BSHSwitchLabel label Object node ReturnControl returnControl null if child numchild throw new EvalError label BSHSwitchLabel jjtGetChild child while child numchild returnControl null if label isDefault label eval callstack interpreter equals switchVal while child numchild node jjtGetChild child if node instanceof BSHSwitchLabel continue Object value SimpleNode node eval callstack interpreter if value instanceof ReturnControl returnControl ReturnControl value break else while child numchild node jjtGetChild child if node instanceof BSHSwitchLabel label BSHSwitchLabel node break if returnControl null returnControl kind RETURN return returnControl else return Primitive VOID public class FavoritesVFS extends VFS public static final String PROTOCOL public FavoritesVFS super instance this public int getCapabilities public String getParentOfPath String path return PROTOCOL public VFS DirectoryEntry Object session String url Component comp synchronized lock if favorites null loadFavorites VFS DirectoryEntry retVal new VFS DirectoryEntry favorites size for int retVal length String favorite String favorites get retVal session favorite comp return retVal public DirectoryEntry Object session String path Component comp return new VFS DirectoryEntry path path path VFS DirectoryEntry DIRECTORY false public boolean Object session String path Component comp synchronized lock path path substring PROTOCOL length favorites remove path VFSManager sendVFSUpdate this PROTOCOL false return true public static void loadFavorites favorites new ArrayList synchronized lock String favorite int while favorite jEdit getProperty null favorites add favorite public static void addToFavorites String path synchronized lock if favorites null loadFavorites if favorites contains path favorites add path VFSManager sendVFSUpdate instance PROTOCOL false public static void saveFavorites synchronized lock if favorites null return for int favorites size jEdit setProperty String favorites get jEdit unsetProperty favorites size public static Object getFavorites synchronized lock if favorites null loadFavorites return favorites toArray private static FavoritesVFS instance private static Object lock new Object private static ArrayList favorites class ModeCatalogHandler extends HandlerBase ModeCatalogHandler String directory boolean resource this directory directory this resource resource public Object resolveEntity String publicId String systemId if equals systemId return new StringReader return null public void attribute String aname String value boolean isSpecified aname aname null null aname intern if aname modeName value else if aname if value null Log log Log ERROR this directory modeName else file value else if aname filenameGlob value else if aname firstlineGlob value public void doctypeDecl String name String publicId String systemId throws Exception if equals name equals name return Log log Log ERROR this directory public void endElement String name if name equals Mode mode jEdit getMode modeName if mode null mode new Mode modeName jEdit addMode mode Object path if resource path jEdit class getResource directory file else path MiscUtilities constructPath directory file mode setProperty path if filenameGlob null mode setProperty filenameGlob else mode unsetProperty if firstlineGlob null mode setProperty firstlineGlob else mode unsetProperty mode init modeName file filenameGlob firstlineGlob null private String directory private boolean resource private String modeName private String file private String filenameGlob private String firstlineGlob public interface TextAreaHighlight void paintHighlight Graphics gfx int line int String getToolTipText MouseEvent evt public class ToolBarManager public ToolBarManager Container top Container bottom this top top this bottom bottom public void addToolBar int group int layer Component toolbar Entry entry new Entry layer toolbar if group View TOP_GROUP addToolBar top topToolBars entry else if group View BOTTOM_GROUP addToolBar bottom bottomToolBars entry else throw new InternalError public void removeToolBar Component toolbar removeToolBar top topToolBars toolbar removeToolBar bottom bottomToolBars toolbar private Container top private Container bottom private ArrayList topToolBars new ArrayList private ArrayList bottomToolBars new ArrayList private void addToolBar Container group ArrayList toolbars Entry entry for int toolbars size if entry layer Entry toolbars get layer toolbars add entry group add entry toolbar return toolbars add entry Component comp entry toolbar if OperatingSystem isMacOS group bottom Box box new Box BoxLayout X_AXIS box add comp box add Box createHorizontalStrut group add box int nComps group getComponentCount if nComps box Box group getComponent nComps group remove nComps group add box getComponent nComps else group add comp private void removeToolBar Container group ArrayList toolbars Component toolbar for int toolbars size if toolbar Entry toolbars get toolbar if OperatingSystem isMacOS group bottom toolbars size Box box Box group getComponent group remove if toolbars size box remove toolbar group getComponent group remove box add toolbar group add box else group remove toolbar toolbars remove return static class Entry int layer Component toolbar Entry int layer Component toolbar this layer layer this toolbar toolbar public abstract class EBPlugin extends EditPlugin implements EBComponent public void handleMessage EBMessage message protected EBPlugin public class MiscUtilities public static String canonPath String path if File separatorChar path path replace if path startsWith File separator path path substring String home System getProperty if home endsWith File separator return home path else return home File separator path else if path equals return System getProperty else return path public static String constructPath String parent String path if MiscUtilities isURL path return path else if path startsWith return path else if OperatingSystem isDOSDerived if path length path charAt return path else if path length path charAt if path charAt path path substring path substring return resolveSymlinks path else if path startsWith return resolveSymlinks path else if OperatingSystem isUnix if path length path charAt return resolveSymlinks path if parent null parent System getProperty if OperatingSystem isDOSDerived path startsWith parent parent substring VFS vfs VFSManager getVFSForPath parent return vfs constructPath parent path public static String constructPath String parent String path1 String path2 return constructPath constructPath parent path1 path2 public static String concatPath String parent String path parent canonPath parent path canonPath path if path startsWith File separator path path substring else if path length path charAt path path replace File separatorChar if parent null parent System getProperty if parent endsWith File separator return parent path else return parent File separator path public static String getFileExtension String name int index name indexOf if index return else return name substring index public static String getFileName String path return VFSManager getVFSForPath path getFileName path public static String getFileNameNoExtension String path String name getFileName path int index name lastIndexOf if index return name else return name substring index public static String getFileParent String path return getParentOfPath path public static String getParentOfPath String path return VFSManager getVFSForPath path getParentOfPath path public static String getFileProtocol String url return getProtocolOfURL url public static String getProtocolOfURL String url return url substring url indexOf public static boolean isURL String str int fsIndex Math max str indexOf File separatorChar str indexOf return false return false int cIndex str indexOf return false return false return true public static void saveBackup File file int backups String backupPrefix String backupSuffix String backupDirectory if backupPrefix null backupPrefix if backupSuffix null backupSuffix String name file getName if backups file renameTo new File backupDirectory backupPrefix name backupSuffix else new File backupDirectory backupPrefix name backupSuffix backups backupSuffix delete for int backups File backup new File backupDirectory backupPrefix name backupSuffix backupSuffix backup renameTo new File backupDirectory backupPrefix name backupSuffix backupSuffix file renameTo new File backupDirectory backupPrefix name backupSuffix backupSuffix public static int getLeadingWhiteSpace String str int whitespace loop for whitespace str length switch str charAt whitespace case case whitespace break default break loop return whitespace public static int getTrailingWhiteSpace String str int whitespace loop for int str length switch str charAt case case whitespace break default break loop return whitespace public static int getLeadingWhiteSpaceWidth String str int tabSize int whitespace loop for int str length switch str charAt case whitespace break case whitespace tabSize whitespace tabSize break default break loop return whitespace public static String createWhiteSpace int len int tabSize StringBuffer buf new StringBuffer if tabSize while len buf append else int count len tabSize while count buf append count len tabSize while count buf append return buf toString public static String globToRE String glob StringBuffer buf new StringBuffer boolean backslash false boolean insideGroup false boolean insideNegativeLookahead false for int glob length char glob charAt if backslash buf append buf append backslash false continue switch case backslash true break case buf append break case buf append break case buf append break case buf append if glob length glob charAt buf append insideNegativeLookahead true else insideGroup true break case if insideGroup if insideNegativeLookahead buf append insideNegativeLookahead false buf append else buf append break case if insideNegativeLookahead buf append insideNegativeLookahead false else if insideGroup buf append insideGroup false else buf append break default buf append return buf toString public static String escapesToChars String str StringBuffer buf new StringBuffer for int str length char str charAt switch case if str length buf append break str charAt switch case buf append break case buf append break default buf append break break default buf append return buf toString public static String charsToEscapes String str return charsToEscapes str false public static String charsToEscapes String str boolean history StringBuffer buf new StringBuffer for int str length char str charAt switch case buf append break case buf append break case if history buf append else buf append break case if history buf append else buf append break case if history buf append else buf append break case if history buf append else buf append break case buf append break default buf append break return buf toString public static int compareVersions String v1 String v2 return compareStrings v1 v2 false public static int compareStrings String str1 String str2 boolean ignoreCase char char1 str1 toCharArray char char2 str2 toCharArray int len Math min char1 length char2 length for int len len char ch1 char1 char ch2 char2 if Character isDigit ch1 Character isDigit ch2 ch1 ch2 int int for char1 length if Character isDigit char1 break for char2 length if Character isDigit char2 break int len1 int len2 if len1 len2 return else if len1 len2 return else for int len1 ch1 char1 ch2 char2 if ch1 ch2 return ch1 ch2 else if ignoreCase ch1 Character toLowerCase ch1 ch2 Character toLowerCase ch2 if ch1 ch2 return ch1 ch2 return char1 length char2 length public static void quicksort Object obj Comparator compare Arrays sort obj compare public static void quicksort Vector vector Comparator compare Collections sort vector compare public static void quicksort List list Comparator compare Collections sort list compare public static void quicksort Object obj Compare compare Arrays sort obj compare public static void quicksort Vector vector Compare compare Collections sort vector compare public interface Compare extends Comparator int compare Object obj1 Object obj2 public static class StringCompare implements Compare public int compare Object obj1 Object obj2 return compareStrings obj1 toString obj2 toString false public static class StringICaseCompare implements Compare public int compare Object obj1 Object obj2 return compareStrings obj1 toString obj2 toString true public static class MenuItemCompare implements Compare public int compare Object obj1 Object obj2 return compareStrings JMenuItem obj1 getText JMenuItem obj2 getText true public static String fileToClass String name char clsName name toCharArray for int clsName length if clsName clsName return new String clsName clsName length public static String classToFile String name return name replace concat public static String buildToVersion String build if build length return build int major Integer parseInt build substring int minor Integer parseInt build substring int beta Integer parseInt build substring int bugfix Integer parseInt build substring return major minor beta beta bugfix bugfix public static boolean isToolsJarAvailable Log log Log DEBUG MiscUtilities class Vector paths new Vector paths addElement System getProperty try try Class forName catch ClassNotFoundException e1 Class forName Log log Log DEBUG MiscUtilities class return true catch ClassNotFoundException String settingsDir jEdit getSettingsDirectory if settingsDir null String toolsPath constructPath settingsDir paths addElement toolsPath if new File toolsPath exists Log log Log DEBUG MiscUtilities class return true String jEditDir jEdit getJEditHome if jEditDir null String toolsPath constructPath jEditDir paths addElement toolsPath if new File toolsPath exists Log log Log DEBUG MiscUtilities class return true String toolsPath System getProperty if toolsPath toLowerCase endsWith File separator toolsPath toolsPath substring toolsPath length toolsPath constructPath toolsPath paths addElement toolsPath if new File toolsPath exists Log log Log WARNING MiscUtilities class paths toString return false EditPlugin JAR jar jEdit getPluginJAR toolsPath if jar null Log log Log DEBUG MiscUtilities class toolsPath try jEdit addPluginJAR new EditPlugin JAR toolsPath new JARClassLoader toolsPath catch IOException ioex Log log Log ERROR MiscUtilities class toolsPath Log log Log ERROR MiscUtilities class ioex return false else Log log Log DEBUG MiscUtilities class return true public static String listDirectory String directory String glob boolean recurse Log log Log DEBUG MiscUtilities class directory Vector files new Vector RE filter try filter new RE globToRE glob catch Exception Log log Log ERROR MiscUtilities class return null listDirectory new Vector files new File directory filter recurse String retVal new String files size files copyInto retVal quicksort retVal new StringICaseCompare return retVal private MiscUtilities private static void listDirectory Vector stack Vector files File directory RE filter boolean recurse if stack contains directory Log log Log ERROR MiscUtilities class directory getPath return else stack addElement directory File directory listFiles if null return for int length File file if file isDirectory if recurse try file new File file getCanonicalPath catch IOException io listDirectory stack files file filter recurse else if filter isMatch file getName continue String path file getPath Log log Log DEBUG MiscUtilities class path files addElement path private static String resolveSymlinks String path try return new File path getCanonicalPath catch IOException io return path class RETokenStart extends REToken RETokenStart int subIndex String newline super subIndex this newline newline boolean match CharIndexed input REMatch mymatch if newline null int len newline length if mymatch offset len boolean found true char char ch input charAt mymatch index len do newline charAt if ch found false break ch input charAt mymatch index len while len if found return next input mymatch if mymatch eflags RE REG_NOTBOL return false if mymatch eflags RE REG_ANCHORINDEX return mymatch anchor mymatch offset next input mymatch false else return mymatch index mymatch offset next input mymatch false void dump StringBuffer os os append public class Gutter extends JComponent implements SwingConstants public static final int LOWEST_LAYER Integer MIN_VALUE public static final int DEFAULT_LAYER public static final int HIGHEST_LAYER Integer MAX_VALUE public Gutter View view JEditTextArea textArea this view view this textArea textArea setAutoscrolls true setOpaque true extensionMgr new ExtensionManager MouseHandler ml new MouseHandler addMouseListener ml addMouseMotionListener ml addExtension new MarkerHighlight public void paintComponent Graphics Graphics2D gfx Graphics2D Rectangle clip gfx getClipBounds gfx setColor getBackground gfx fillRect clip clip clip width clip height if textArea getBuffer isLoaded return int lineHeight textArea getPainter getFontMetrics getHeight int firstLine clip lineHeight int lastLine clip clip height lineHeight FontMetrics pfm textArea getPainter getFontMetrics Color fg getForeground int baseline int this baseline lineHeight pfm getDescent boolean highlightCurrentLine currentLineHighlightEnabled textArea selection size int clip clip lineHeight Buffer buffer textArea getBuffer textArea chunkCache updateChunksUpTo lastLine for int line firstLine line lastLine line lineHeight ChunkCache LineInfo info textArea chunkCache getLineInfo line if info chunksValid System err println int physicalLine info physicalLine if physicalLine int start textArea getScreenLineStartOffset line int end textArea getScreenLineEndOffset line extensionMgr paintValidLine gfx line physicalLine start end else extensionMgr paintInvalidLine gfx line if physicalLine return if info firstSubregion physicalLine buffer getLineCount buffer isFoldStart physicalLine int lineHeight gfx setColor foldColor if textArea getFoldVisibilityManager isLineVisible physicalLine gfx drawLine gfx drawLine gfx drawLine gfx drawLine gfx drawLine else gfx drawLine gfx drawLine gfx drawLine gfx drawLine gfx drawLine else if bracketHighlight int bracketLine textArea getBracketLine int caretLine textArea getCaretLine if textArea isBracketHighlightVisible physicalLine Math min caretLine bracketLine physicalLine Math max caretLine bracketLine int caretScreenLine if caretLine textArea getLastPhysicalLine caretScreenLine Integer MAX_VALUE else caretScreenLine textArea getScreenLineOfOffset textArea getCaretPosition int bracketScreenLine if bracketLine textArea getLastPhysicalLine bracketScreenLine Integer MAX_VALUE else bracketScreenLine textArea chunkCache getScreenLineOfOffset bracketLine textArea getBracketPosition if caretScreenLine bracketScreenLine int tmp caretScreenLine caretScreenLine bracketScreenLine bracketScreenLine tmp gfx setColor bracketHighlightColor if bracketScreenLine caretScreenLine else if line caretScreenLine gfx fillRect lineHeight gfx fillRect lineHeight lineHeight lineHeight else if line bracketScreenLine gfx fillRect lineHeight gfx fillRect lineHeight else if line caretScreenLine line bracketScreenLine gfx fillRect lineHeight if info firstSubregion expanded String number Integer toString physicalLine int offset switch alignment case RIGHT offset gutterSize width collapsedSize width fm stringWidth number break case CENTER offset gutterSize width collapsedSize width fm stringWidth number break case LEFT default offset break if physicalLine textArea getCaretLine highlightCurrentLine gfx setColor currentLineHighlight else if interval line textArea getFirstLine interval gfx setColor intervalHighlight else gfx setColor fg gfx drawString number FOLD_MARKER_SIZE offset baseline public void addCustomHighlight TextAreaHighlight highlight Log log Log WARNING this highlight public void removeCustomHighlight TextAreaHighlight highlight Log log Log WARNING this highlight public void addExtension TextAreaExtension extension extensionMgr addExtension DEFAULT_LAYER extension repaint public void addExtension int layer TextAreaExtension extension extensionMgr addExtension layer extension repaint public void removeExtension TextAreaExtension extension extensionMgr removeExtension extension repaint public String getToolTipText MouseEvent evt if textArea getBuffer isLoaded return null return extensionMgr getToolTipText evt getX evt getY public void setBorder int width Color color1 Color color2 Color color3 this borderWidth width focusBorder new CompoundBorder new MatteBorder width color3 new MatteBorder width color1 noFocusBorder new CompoundBorder new MatteBorder width color3 new MatteBorder width color2 updateBorder public void updateBorder SwingUtilities invokeLater new Runnable public void run if view getEditPane null return if view getEditPane getTextArea textArea setBorder focusBorder else setBorder noFocusBorder public void setBorder Border border super setBorder border if border null collapsedSize width collapsedSize height else Insets insets border getBorderInsets this collapsedSize width FOLD_MARKER_SIZE insets right collapsedSize height gutterSize height insets top insets bottom gutterSize width FOLD_MARKER_SIZE insets right fm stringWidth revalidate public void setFont Font font super setFont font fm getFontMetrics font baseline fm getAscent Border border getBorder if border null gutterSize width FOLD_MARKER_SIZE border getBorderInsets this right fm stringWidth revalidate public Color getHighlightedForeground return intervalHighlight public void setHighlightedForeground Color highlight intervalHighlight highlight public Color getCurrentLineForeground return currentLineHighlight public void setCurrentLineForeground Color highlight currentLineHighlight highlight public Color getFoldColor return foldColor public void setFoldColor Color foldColor this foldColor foldColor public Dimension getPreferredSize if expanded return gutterSize else return collapsedSize public Dimension getMinimumSize return getPreferredSize public int getLineNumberAlignment return alignment public void setLineNumberAlignment int alignment if this alignment alignment return this alignment alignment repaint public boolean isExpanded return expanded public void setExpanded boolean expanded if this expanded expanded return this expanded expanded textArea revalidate public void toggleExpanded setExpanded expanded public int getHighlightInterval return interval public void setHighlightInterval int interval if interval interval this interval interval repaint public boolean isCurrentLineHighlightEnabled return currentLineHighlightEnabled public void setCurrentLineHighlightEnabled boolean enabled if currentLineHighlightEnabled enabled return currentLineHighlightEnabled enabled repaint public final Color getBracketHighlightColor return bracketHighlightColor public final void setBracketHighlightColor Color bracketHighlightColor this bracketHighlightColor bracketHighlightColor repaint public final boolean isBracketHighlightEnabled return bracketHighlight public final void setBracketHighlightEnabled boolean bracketHighlight this bracketHighlight bracketHighlight repaint public Color getMarkerHighlightColor return markerHighlightColor public void setMarkerHighlightColor Color markerHighlightColor this markerHighlightColor markerHighlightColor public boolean isMarkerHighlightEnabled return markerHighlight public void setMarkerHighlightEnabled boolean markerHighlight this markerHighlight markerHighlight private static final int FOLD_MARKER_SIZE private View view private JEditTextArea textArea private ExtensionManager extensionMgr private int baseline private Dimension gutterSize new Dimension private Dimension collapsedSize new Dimension private Color intervalHighlight private Color currentLineHighlight private Color foldColor private FontMetrics fm private int alignment private int interval private boolean currentLineHighlightEnabled private boolean expanded private boolean bracketHighlight private Color bracketHighlightColor private boolean markerHighlight private Color markerHighlightColor private int borderWidth private Border focusBorder noFocusBorder class MouseHandler extends MouseInputAdapter boolean drag int toolTipInitialDelay toolTipReshowDelay public void mouseEntered MouseEvent ToolTipManager ttm ToolTipManager sharedInstance toolTipInitialDelay ttm getInitialDelay toolTipReshowDelay ttm getReshowDelay ttm setInitialDelay ttm setReshowDelay public void mouseExited MouseEvent evt ToolTipManager ttm ToolTipManager sharedInstance ttm setInitialDelay toolTipInitialDelay ttm setReshowDelay toolTipReshowDelay public void mousePressed MouseEvent if GUIUtilities isPopupTrigger getX getWidth borderWidth translatePoint getWidth textArea mouseHandler mousePressed drag true else Buffer buffer textArea getBuffer int screenLine getY textArea getPainter getFontMetrics getHeight textArea chunkCache updateChunksUpTo screenLine int line textArea chunkCache getLineInfo screenLine physicalLine if line return FoldVisibilityManager foldVisibilityManager textArea getFoldVisibilityManager if buffer isFoldStart line if isControlDown foldVisibilityManager expandFold line true textArea selectFold line else if foldVisibilityManager isLineVisible line foldVisibilityManager collapseFold line else foldVisibilityManager expandFold line isShiftDown else if bracketHighlight if textArea isBracketHighlightVisible int bracketLine textArea getBracketLine int caretLine textArea getCaretLine if caretLine bracketLine if caretLine bracketLine int tmp caretLine caretLine bracketLine bracketLine tmp if line caretLine line bracketLine if isControlDown textArea selectToMatchingBracket else textArea goToMatchingBracket public void mouseDragged MouseEvent translatePoint getWidth textArea mouseHandler mouseDragged public void mouseReleased MouseEvent if drag getX getWidth borderWidth translatePoint getWidth textArea mouseHandler mouseReleased drag false class MarkerHighlight extends TextAreaExtension public void paintValidLine Graphics2D gfx int screenLine int physicalLine int start int end int if isMarkerHighlightEnabled Buffer buffer textArea getBuffer if buffer getMarkerInRange start end null gfx setColor getMarkerHighlightColor FontMetrics fm textArea getPainter getFontMetrics gfx fillRect textArea getGutter getWidth fm getHeight public String getToolTipText int int if isMarkerHighlightEnabled int start textArea xyToOffset if start return null int end textArea getScreenLineEndOffset textArea getScreenLineOfOffset start Marker marker textArea getBuffer getMarkerInRange start end if marker null char shortcut marker getShortcut if shortcut return jEdit getProperty else String args String valueOf shortcut return jEdit getProperty args return null class BSHBinaryExpression extends SimpleNode implements ParserConstants public int kind BSHBinaryExpression int id super id public Object eval CallStack callstack Interpreter interpreter throws EvalError Object lhs SimpleNode jjtGetChild eval callstack interpreter if kind INSTANCEOF if lhs Primitive NULL return new Primitive false if lhs instanceof Primitive return new Primitive false NameSpace namespace callstack top Class rhs BSHType jjtGetChild getType namespace boolean ret Reflect isAssignableFrom rhs lhs getClass return new Primitive ret if kind BOOL_AND kind BOOL_ANDX Object obj lhs if isPrimitiveValue lhs obj Primitive lhs getValue if obj instanceof Boolean Boolean obj booleanValue false return new Primitive false if kind BOOL_OR kind BOOL_ORX Object obj lhs if isPrimitiveValue lhs obj Primitive lhs getValue if obj instanceof Boolean Boolean obj booleanValue true return new Primitive true boolean isLhsWrapper isWrapper lhs Object rhs SimpleNode jjtGetChild eval callstack interpreter boolean isRhsWrapper isWrapper rhs if isLhsWrapper isPrimitiveValue lhs isRhsWrapper isPrimitiveValue rhs if isLhsWrapper isRhsWrapper kind EQ else try return Primitive binaryOperation lhs rhs kind catch TargetError reThrow this switch kind case EQ return new Primitive lhs rhs case NE return new Primitive lhs rhs case PLUS if lhs instanceof String rhs instanceof String return lhs toString rhs toString default if lhs instanceof Primitive rhs instanceof Primitive if lhs Primitive VOID rhs Primitive VOID throw new EvalError this else if lhs Primitive NULL rhs Primitive NULL throw new EvalError this throw new EvalError tokenImage kind this private boolean isPrimitiveValue Object obj return obj instanceof Primitive obj Primitive VOID obj Primitive NULL private boolean isWrapper Object obj return obj instanceof Boolean obj instanceof Character obj instanceof Number public class This implements java io Serializable Runnable NameSpace namespace transient Interpreter declaringInterpreter transient CallStack callstack static This getThis NameSpace namespace Interpreter declaringInterpreter try if Capabilities canGenerateInterfaces return This Reflect constructObject new Object namespace declaringInterpreter else if Capabilities haveSwing return This Reflect constructObject new Object namespace declaringInterpreter else return new This namespace declaringInterpreter catch Exception throw new InterpreterError public Object getInterface Class clas throws EvalError if clas isInstance this return this else throw new EvalError clas protected This NameSpace namespace Interpreter declaringInterpreter this namespace namespace this declaringInterpreter declaringInterpreter initCallStack namespace public NameSpace getNameSpace return namespace public String toString return namespace name public void run try invokeMethod new Object catch EvalError declaringInterpreter error public Object invokeMethod String name Object args throws EvalError return invokeMethod name args declaringInterpreter null null public Object invokeMethod String name Object args Interpreter interpreter CallStack callstack SimpleNode callerInfo throws EvalError return namespace invokeMethod name args interpreter callstack callerInfo public static void bind This ths NameSpace namespace Interpreter declaringInterpreter ths namespace setParent namespace ths declaringInterpreter declaringInterpreter ths initCallStack namespace private final void initCallStack NameSpace namespace callstack new CallStack callstack push namespace class BSHTryStatement extends SimpleNode BSHTryStatement int id super id public Object eval CallStack callstack Interpreter interpreter throws EvalError BSHBlock tryBlock BSHBlock jjtGetChild Vector catchParams new Vector Vector catchBlocks new Vector int nchild jjtGetNumChildren Node node null int while nchild node jjtGetChild instanceof BSHFormalParameter catchParams addElement node catchBlocks addElement jjtGetChild node null BSHBlock finallyBlock null if node null finallyBlock BSHBlock node TargetError target null Throwable thrown null Object ret null int callstackDepth callstack depth try ret tryBlock eval callstack interpreter catch TargetError target String stackInfo while callstack depth callstackDepth stackInfo callstack pop if target null thrown target getTarget if thrown null int catchParams size for NameSpace namespace callstack top BSHFormalParameter fp BSHFormalParameter catchParams elementAt fp eval namespace if fp type null try thrown Throwable NameSpace getAssignableForm thrown fp type catch EvalError continue BSHBlock cb BSHBlock catchBlocks elementAt if fp type BSHFormalParameter UNTYPED namespace setVariable fp name thrown else namespace setTypedVariable fp name fp type thrown false ret cb eval callstack interpreter break if finallyBlock null ret finallyBlock eval callstack interpreter if target null throw target if ret instanceof ReturnControl return ret else return Primitive VOID class BSHWhileStatement extends SimpleNode implements ParserConstants public boolean isDoStatement BSHWhileStatement int id super id public Object eval CallStack callstack Interpreter interpreter throws EvalError int numChild jjtGetNumChildren SimpleNode condExp body null if isDoStatement condExp SimpleNode jjtGetChild body SimpleNode jjtGetChild else condExp SimpleNode jjtGetChild body SimpleNode jjtGetChild boolean doOnceFlag isDoStatement while doOnceFlag BSHIfStatement evaluateCondition condExp callstack interpreter continue Object ret body eval callstack interpreter boolean breakout false if ret instanceof ReturnControl switch ReturnControl ret kind case RETURN return ret case CONTINUE continue case BREAK breakout true break if breakout break doOnceFlag false return Primitive VOID public class HelpViewer extends JFrame implements EBComponent public HelpViewer this public HelpViewer URL url this url toString public HelpViewer String url super jEdit getProperty setIconImage GUIUtilities getEditorIcon try baseURL new File MiscUtilities constructPath jEdit getJEditHome toURL toString catch MalformedURLException mu Log log Log ERROR this mu history new String nodes new Hashtable ActionHandler actionListener new ActionHandler JToolBar toolBar new JToolBar toolBar setFloatable false toolBar putClientProperty Boolean TRUE JLabel label new JLabel jEdit getProperty label setBorder new EmptyBorder toolBar add label Box box new Box BoxLayout Y_AXIS box add Box createGlue urlField new JTextField urlField addKeyListener new KeyHandler Dimension dim urlField getPreferredSize dim width Integer MAX_VALUE urlField setMaximumSize dim box add urlField box add Box createGlue toolBar add box toolBar add Box createHorizontalStrut JPanel buttons new JPanel buttons setLayout new BoxLayout buttons BoxLayout X_AXIS buttons setBorder new EmptyBorder back new JButton GUIUtilities loadIcon back setToolTipText jEdit getProperty back addActionListener actionListener back setRequestFocusEnabled false toolBar add back forward new JButton GUIUtilities loadIcon forward addActionListener actionListener forward setToolTipText jEdit getProperty forward setRequestFocusEnabled false toolBar add forward back setPreferredSize forward getPreferredSize getContentPane add BorderLayout NORTH toolBar createTOC toc new TOCTree tocModel toc putClientProperty toc setCellRenderer new TOCCellRenderer toc setEditable false toc setRootVisible false toc setShowsRootHandles true DefaultMutableTreeNode node DefaultMutableTreeNode nodes get if node null toc expandPath new TreePath node getPath viewer new JEditorPane viewer setEditable false viewer addHyperlinkListener new LinkHandler viewer setFont new Font Font PLAIN final JSplitPane splitter new JSplitPane JSplitPane HORIZONTAL_SPLIT new JScrollPane toc new JScrollPane viewer splitter setBorder null getContentPane add BorderLayout CENTER splitter gotoURL url true setDefaultCloseOperation DISPOSE_ON_CLOSE getRootPane setPreferredSize new Dimension pack GUIUtilities loadGeometry this EditBus addToBus this show SwingUtilities invokeLater new Runnable public void run splitter setDividerLocation public void gotoURL String url boolean addToHistory String shortURL if MiscUtilities isURL url if url startsWith baseURL shortURL url substring baseURL length if shortURL startsWith shortURL shortURL substring else shortURL null else shortURL url if baseURL endsWith url baseURL url else url baseURL url viewer setCursor Cursor getDefaultCursor int index url indexOf URL null try new URL url urlField setText toString viewer setPage if addToHistory history historyPos url if historyPos history length System arraycopy history history history length history historyPos null else historyPos catch MalformedURLException mf Log log Log ERROR this mf String args url mf getMessage GUIUtilities error this args return catch IOException io Log log Log ERROR this io String args url io toString GUIUtilities error this args return if shortURL null DefaultMutableTreeNode node DefaultMutableTreeNode nodes get shortURL if node null return TreePath path new TreePath tocModel getPathToRoot node toc expandPath path toc setSelectionPath path toc scrollPathToVisible path public void dispose EditBus removeFromBus this GUIUtilities saveGeometry this super dispose public void handleMessage EBMessage msg if msg instanceof PropertiesChanged SwingUtilities updateComponentTreeUI getRootPane private String baseURL private JButton back private JButton forward private DefaultTreeModel tocModel private JTree toc private Hashtable nodes private JEditorPane viewer private JTextField urlField private String history private int historyPos private void createTOC DefaultMutableTreeNode root new DefaultMutableTreeNode root add createNode jEdit getProperty root add createNode jEdit getProperty root add createNode jEdit getProperty root add createNode jEdit getProperty root add createNode jEdit getProperty root add createNode jEdit getProperty root add createNode jEdit getProperty loadTOC root loadTOC root DefaultMutableTreeNode pluginDocs new DefaultMutableTreeNode jEdit getProperty true EditPlugin plugins jEdit getPlugins for int plugins length EditPlugin plugin plugins EditPlugin JAR jar plugin getJAR if jar null continue String name plugin getClassName String docs jEdit getProperty name String label jEdit getProperty name if docs null if label null docs null URL url jar getClassLoader getResource docs if url null pluginDocs add createNode url toString label if pluginDocs getChildCount root add pluginDocs tocModel new DefaultTreeModel root private void loadTOC DefaultMutableTreeNode root String path TOCHandler new TOCHandler root MiscUtilities getParentOfPath path XmlParser parser new XmlParser parser setHandler try parser parse null null new InputStreamReader new URL baseURL path openStream catch XmlException xe int line xe getLine String message xe getMessage Log log Log ERROR this path line message catch Exception Log log Log NOTICE this private DefaultMutableTreeNode createNode String href String title DefaultMutableTreeNode node new DefaultMutableTreeNode new HelpNode href title true nodes put href node return node static class HelpNode String href title HelpNode String href String title this href href this title title public String toString return title class TOCHandler extends HandlerBase String dir TOCHandler DefaultMutableTreeNode root String dir nodes new Stack node root this dir dir public void attribute String aname String value boolean isSpecified if aname equals href value public void charData char int off int len if tag equals StringBuffer buf new StringBuffer for int len char ch off if ch Character isWhitespace ch buf append ch title buf toString public void startElement String name tag name public void endElement String name if name null return if name equals DefaultMutableTreeNode newNode createNode dir href title node add newNode nodes push node node newNode else if name equals node DefaultMutableTreeNode nodes pop private String tag private String title private String href private DefaultMutableTreeNode node private Stack nodes class TOCTree extends JTree TOCTree TreeModel model super model ToolTipManager sharedInstance registerComponent this public final String getToolTipText MouseEvent evt TreePath path getPathForLocation evt getX evt getY if path null Rectangle cellRect getPathBounds path if cellRect null cellRectIsVisible cellRect return path getLastPathComponent toString return null public final Point getToolTipLocation MouseEvent evt TreePath path getPathForLocation evt getX evt getY if path null Rectangle cellRect getPathBounds path if cellRect null cellRectIsVisible cellRect return new Point cellRect cellRect return null protected void processMouseEvent MouseEvent evt ToolTipManager ttm ToolTipManager sharedInstance switch evt getID case MouseEvent MOUSE_ENTERED toolTipInitialDelay ttm getInitialDelay toolTipReshowDelay ttm getReshowDelay ttm setInitialDelay ttm setReshowDelay super processMouseEvent evt break case MouseEvent MOUSE_EXITED ttm setInitialDelay toolTipInitialDelay ttm setReshowDelay toolTipReshowDelay super processMouseEvent evt break case MouseEvent MOUSE_CLICKED TreePath path getPathForLocation evt getX evt getY if path null if isPathSelected path setSelectionPath path Object obj DefaultMutableTreeNode path getLastPathComponent getUserObject if obj instanceof HelpNode toc expandPath path return HelpNode node HelpNode obj gotoURL node href true super processMouseEvent evt break default super processMouseEvent evt break private int toolTipInitialDelay private int toolTipReshowDelay private boolean cellRectIsVisible Rectangle cellRect Rectangle vr TOCTree this getVisibleRect return vr contains cellRect cellRect vr contains cellRect cellRect width cellRect cellRect height class TOCCellRenderer extends DefaultTreeCellRenderer EmptyBorder border new EmptyBorder public Component getTreeCellRendererComponent JTree tree Object value boolean sel boolean expanded boolean leaf int row boolean focus super getTreeCellRendererComponent tree value sel expanded leaf row focus setIcon leaf FileCellRenderer fileIcon expanded FileCellRenderer openDirIcon FileCellRenderer dirIcon setBorder border return this class ActionHandler implements ActionListener public void actionPerformed ActionEvent evt Object source evt getSource if source back if historyPos getToolkit beep else String url history historyPos gotoURL url false else if source forward if history length historyPos getToolkit beep else String url history historyPos if url null getToolkit beep else historyPos gotoURL url false class LinkHandler implements HyperlinkListener public void hyperlinkUpdate HyperlinkEvent evt if evt getEventType HyperlinkEvent EventType ACTIVATED if evt instanceof HTMLFrameHyperlinkEvent HTMLDocument viewer getDocument processHTMLFrameHyperlinkEvent HTMLFrameHyperlinkEvent evt else URL url evt getURL if url null gotoURL url toString true else if evt getEventType HyperlinkEvent EventType ENTERED viewer setCursor Cursor getPredefinedCursor Cursor HAND_CURSOR else if evt getEventType HyperlinkEvent EventType EXITED viewer setCursor Cursor getDefaultCursor class KeyHandler extends KeyAdapter public void keyPressed KeyEvent evt if evt getKeyCode KeyEvent VK_ENTER gotoURL urlField getText true public class CreateDockableWindow extends EBMessage public CreateDockableWindow View view String name String position super view if name null throw new NullPointerException this name name this position position public View getView return View getSource public String getDockableWindowName return name public void setDockableWindow DockableWindow win this win win veto public DockableWindow getDockableWindow return win public String getPosition return position public String paramString return super paramString name position private String name private String position private DockableWindow win class BSHBlock extends SimpleNode BSHBlock int id super id public Object eval CallStack callstack Interpreter interpreter throws EvalError return eval callstack interpreter false public Object eval CallStack callstack Interpreter interpreter boolean overrideNamespace throws EvalError Object ret Primitive VOID int statements jjtGetNumChildren NameSpace enclosingNameSpace null if overrideNamespace enclosingNameSpace callstack top BlockNameSpace bodyNameSpace new BlockNameSpace enclosingNameSpace callstack swap bodyNameSpace for int statements SimpleNode node SimpleNode jjtGetChild ret node eval callstack interpreter if ret instanceof ReturnControl break if overrideNamespace callstack swap enclosingNameSpace return ret public class GUIUtilities public static final Icon NEW_BUFFER_ICON loadIcon public static final Icon DIRTY_BUFFER_ICON loadIcon public static final Icon READ_ONLY_BUFFER_ICON loadIcon public static final Icon NORMAL_BUFFER_ICON loadIcon public static final Icon WINDOW_ICON loadIcon public static Icon loadIcon String iconName if icons null icons new Hashtable Icon icon Icon icons get iconName if icon null return icon if iconName startsWith icon new ImageIcon iconName substring else URL url GUIUtilities class getResource iconName if url null Log log Log ERROR GUIUtilities class iconName return null icon new ImageIcon url icons put iconName icon return icon public static Image getEditorIcon return ImageIcon WINDOW_ICON getImage public static Image getPluginIcon return ImageIcon WINDOW_ICON getImage public static JMenuBar loadMenuBar String name String menus jEdit getProperty name StringTokenizer st new StringTokenizer menus JMenuBar mbar new JMenuBar while st hasMoreTokens String menu st nextToken if menu equals loadPluginsMenu mbar else mbar add loadMenu menu return mbar public static JMenu loadMenu View view String name return loadMenu name public static JMenu loadMenu String name if name equals return new OpenWithEncodingMenu else if name equals return new RecentFilesMenu else if name equals return new RecentDirectoriesMenu else if name equals return new CurrentDirectoryMenu else if name equals return new MarkersMenu else if name equals return new MacrosMenu else return new EnhancedMenu name public static JPopupMenu loadPopupMenu String name JPopupMenu menu new JPopupMenu String menuItems jEdit getProperty name if menuItems null StringTokenizer st new StringTokenizer menuItems while st hasMoreTokens String menuItemName st nextToken if menuItemName equals menu addSeparator else if menuItemName startsWith menu add loadMenu menuItemName substring else menu add loadMenuItem menuItemName false return menu public static JMenuItem loadMenuItem String name return loadMenuItem name true public static JMenuItem loadMenuItem String name boolean setMnemonic EditAction action jEdit getAction name String label action null jEdit getProperty name action getLabel if label null label name char mnemonic int index label indexOf if index label length index mnemonic Character toLowerCase label charAt index label label substring index concat label substring index else mnemonic JMenuItem mi if action null action isToggle mi new EnhancedCheckBoxMenuItem label action else mi new EnhancedMenuItem label action if OperatingSystem isMacOS setMnemonic mnemonic mi setMnemonic mnemonic return mi public static JToolBar loadToolBar String name JToolBar toolBar new JToolBar toolBar setFloatable false toolBar putClientProperty Boolean TRUE String buttons jEdit getProperty name if buttons null StringTokenizer st new StringTokenizer buttons while st hasMoreTokens String button st nextToken if button equals toolBar addSeparator else JButton loadToolButton button if null toolBar add return toolBar public static EnhancedButton loadToolButton String name EditAction action jEdit getAction name String label action null jEdit getProperty name action getLabel if label null label name Icon icon String iconName jEdit getProperty name if iconName null return null else icon loadIcon iconName if icon null return null String toolTip prettifyMenuLabel label String shortcut1 jEdit getProperty name String shortcut2 jEdit getProperty name if shortcut1 null shortcut2 null toolTip toolTip shortcut1 null shortcut1 shortcut1 null shortcut2 null shortcut2 null shortcut2 return new EnhancedButton icon toolTip action public static String prettifyMenuLabel String label int index label indexOf if index label label substring index concat label substring index return label public static void message Component comp String name Object args hideSplashScreen JOptionPane showMessageDialog comp jEdit getProperty name concat args jEdit getProperty name concat args JOptionPane INFORMATION_MESSAGE public static void error Component comp String name Object args hideSplashScreen JOptionPane showMessageDialog comp jEdit getProperty name concat args jEdit getProperty name concat args JOptionPane ERROR_MESSAGE public static String input Component comp String name Object def return input comp name null def public static String inputProperty Component comp String name String def return inputProperty comp name null def public static String input Component comp String name Object args Object def hideSplashScreen String retVal String JOptionPane showInputDialog comp jEdit getProperty name concat args jEdit getProperty name concat JOptionPane QUESTION_MESSAGE null null def return retVal public static String inputProperty Component comp String name Object args String def hideSplashScreen String retVal String JOptionPane showInputDialog comp jEdit getProperty name concat args jEdit getProperty name concat JOptionPane QUESTION_MESSAGE null null jEdit getProperty def if retVal null jEdit setProperty def retVal return retVal public static int confirm Component comp String name Object args int buttons int type hideSplashScreen return JOptionPane showConfirmDialog comp jEdit getProperty name args jEdit getProperty name buttons type public static String showVFSFileDialog View view String path int type boolean multipleSelection hideSplashScreen VFSFileChooserDialog fileChooser new VFSFileChooserDialog view path type multipleSelection String selectedFiles fileChooser getSelectedFiles if selectedFiles null return null return selectedFiles public static Color parseColor String name return parseColor name Color black public static Color parseColor String name Color defaultColor if name null return defaultColor else if name startsWith try return Color decode name catch NumberFormatException nf return defaultColor else if equals name return Color red else if equals name return Color green else if equals name return Color blue else if equals name return Color yellow else if equals name return Color orange else if equals name return Color white else if equals name return Color lightGray else if equals name return Color gray else if equals name return Color darkGray else if equals name return Color black else if equals name return Color cyan else if equals name return Color magenta else if equals name return Color pink else return defaultColor public static String getColorHexString Color String colString Integer toHexString getRGB return substring colString length concat colString public static SyntaxStyle parseStyle String str String family int size throws IllegalArgumentException return parseStyle str family size true public static SyntaxStyle parseStyle String str String family int size boolean color throws IllegalArgumentException Color fgColor Color black Color bgColor null boolean italic false boolean bold false StringTokenizer st new StringTokenizer str while st hasMoreTokens String st nextToken if startsWith if color fgColor GUIUtilities parseColor substring Color black else if startsWith if color bgColor GUIUtilities parseColor substring null else if startsWith for int length if charAt italic true else if charAt bold true else throw new IllegalArgumentException else throw new IllegalArgumentException return new SyntaxStyle fgColor bgColor new Font family italic Font ITALIC bold Font BOLD size public static String getStyleString SyntaxStyle style StringBuffer buf new StringBuffer if style getForegroundColor null buf append getColorHexString style getForegroundColor if style getBackgroundColor null buf append getColorHexString style getBackgroundColor if style getFont isPlain buf append style getFont isItalic style getFont isBold return buf toString public static SyntaxStyle loadStyles String family int size return loadStyles family size true public static SyntaxStyle loadStyles String family int size boolean color SyntaxStyle styles new SyntaxStyle Token ID_COUNT try styles Token COMMENT1 GUIUtilities parseStyle jEdit getProperty family size color styles Token COMMENT2 GUIUtilities parseStyle jEdit getProperty family size color styles Token LITERAL1 GUIUtilities parseStyle jEdit getProperty family size color styles Token LITERAL2 GUIUtilities parseStyle jEdit getProperty family size color styles Token LABEL GUIUtilities parseStyle jEdit getProperty family size color styles Token KEYWORD1 GUIUtilities parseStyle jEdit getProperty family size color styles Token KEYWORD2 GUIUtilities parseStyle jEdit getProperty family size color styles Token KEYWORD3 GUIUtilities parseStyle jEdit getProperty family size color styles Token FUNCTION GUIUtilities parseStyle jEdit getProperty family size color styles Token MARKUP GUIUtilities parseStyle jEdit getProperty family size color styles Token OPERATOR GUIUtilities parseStyle jEdit getProperty family size color styles Token DIGIT GUIUtilities parseStyle jEdit getProperty family size color styles Token INVALID GUIUtilities parseStyle jEdit getProperty family size color catch Exception Log log Log ERROR GUIUtilities class return styles public static void loadGeometry Window win String name int width height adjust_x adjust_y adjust_width adjust_height Dimension size win getSize width jEdit getIntegerProperty name size width height jEdit getIntegerProperty name size height Component parent win getParent if parent null Dimension screen win getToolkit getScreenSize screen width width screen height height else Rectangle bounds parent getBounds bounds bounds width width bounds bounds height height jEdit getIntegerProperty name jEdit getIntegerProperty name adjust_x jEdit getIntegerProperty name adjust_y jEdit getIntegerProperty name adjust_width jEdit getIntegerProperty name adjust_height jEdit getIntegerProperty name Rectangle desired new Rectangle width height Rectangle required new Rectangle adjust_x adjust_y width adjust_width height adjust_height win setBounds required win setBounds desired public static void saveGeometry Window win String name Rectangle bounds win getBounds jEdit setIntegerProperty name bounds jEdit setIntegerProperty name bounds jEdit setIntegerProperty name bounds width jEdit setIntegerProperty name bounds height public static void hideSplashScreen if splash null splash dispose splash null public static void requestFocus final Window win final Component comp win addWindowListener new WindowAdapter public void windowActivated WindowEvent evt comp requestFocus win removeWindowListener this public static boolean isPopupTrigger MouseEvent evt if OperatingSystem isMacOS return evt isControlDown else return evt getModifiers InputEvent BUTTON3_MASK public static void showPopupMenu JPopupMenu popup Component comp int int Point new Point SwingUtilities convertPointToScreen comp Dimension size popup getPreferredSize Dimension screen Toolkit getDefaultToolkit getScreenSize boolean horiz false boolean vert false int origX if size width screen width size width screen width screen width size width horiz true if size height screen height size height screen height screen height size height vert true if horiz vert origX size width popup show comp public static View getView Component comp for if comp instanceof JComponent Component real Component JComponent comp getClientProperty if real null comp real if comp instanceof View return View comp else if comp instanceof JPopupMenu comp JPopupMenu comp getInvoker else if comp null comp comp getParent else break return null static void showSplashScreen splash new SplashScreen static void advanceSplashProgress if splash null splash advance private static SplashScreen splash private static Hashtable icons private GUIUtilities private static void loadPluginsMenu JMenuBar mbar Vector pluginMenuItems new Vector EditPlugin pluginArray jEdit getPlugins for int pluginArray length try EditPlugin plugin pluginArray plugin createMenuItems pluginMenuItems catch Throwable Log log Log ERROR GUIUtilities class Log log Log ERROR GUIUtilities class JMenu menu new EnhancedMenu if pluginMenuItems isEmpty menu add GUIUtilities loadMenuItem mbar add menu return MiscUtilities quicksort pluginMenuItems new MiscUtilities MenuItemCompare if pluginMenuItems size for int pluginMenuItems size menu add JMenuItem pluginMenuItems get mbar add menu else int menuCount menu setText menu getText menuCount for int pluginMenuItems size menu add JMenuItem pluginMenuItems get if menu getMenuComponentCount mbar add menu menu new JMenu String valueOf menuCount if menu getMenuComponentCount mbar add menu public interface EBComponent void handleMessage EBMessage message public class KeyEventWorkaround public static KeyEvent processKeyEvent KeyEvent evt int keyCode evt getKeyCode char ch evt getKeyChar switch evt getID case KeyEvent KEY_PRESSED switch keyCode case KeyEvent VK_ALT case KeyEvent VK_ALT_GRAPH case KeyEvent VK_CONTROL case KeyEvent VK_SHIFT case KeyEvent VK_META case KeyEvent VK_DEAD_GRAVE case KeyEvent VK_DEAD_ACUTE case KeyEvent VK_DEAD_CIRCUMFLEX case KeyEvent VK_DEAD_TILDE case KeyEvent VK_DEAD_MACRON case KeyEvent VK_DEAD_BREVE case KeyEvent VK_DEAD_ABOVEDOT case KeyEvent VK_DEAD_DIAERESIS case KeyEvent VK_DEAD_ABOVERING case KeyEvent VK_DEAD_DOUBLEACUTE case KeyEvent VK_DEAD_CARON case KeyEvent VK_DEAD_CEDILLA case KeyEvent VK_DEAD_OGONEK case KeyEvent VK_DEAD_IOTA case KeyEvent VK_DEAD_VOICED_SOUND case KeyEvent VK_DEAD_SEMIVOICED_SOUND case return null default switch keyCode case KeyEvent VK_NUMPAD0 case KeyEvent VK_NUMPAD1 case KeyEvent VK_NUMPAD2 case KeyEvent VK_NUMPAD3 case KeyEvent VK_NUMPAD4 case KeyEvent VK_NUMPAD5 case KeyEvent VK_NUMPAD6 case KeyEvent VK_NUMPAD7 case KeyEvent VK_NUMPAD8 case KeyEvent VK_NUMPAD9 case KeyEvent VK_MULTIPLY case KeyEvent VK_ADD case KeyEvent VK_DECIMAL case KeyEvent VK_DIVIDE last LAST_NUMKEYPAD lastKeyTime System currentTimeMillis return evt if OperatingSystem isMacOS handleBrokenKeys evt keyCode else last LAST_NOTHING break return evt case KeyEvent KEY_TYPED if ch ch ch ch return null if OperatingSystem isMacOS if evt isControlDown evt isMetaDown return null else if evt isControlDown evt isAltDown evt isMetaDown return null if last LAST_MOD switch ch case case case case case case case last LAST_NOTHING return null if last LAST_NUMKEYPAD System currentTimeMillis lastKeyTime last LAST_NOTHING if ch ch ch ch ch ch ch return null else if last LAST_BROKEN System currentTimeMillis lastKeyTime Character isLetter ch last LAST_NOTHING return null else if last LAST_ALT System currentTimeMillis lastKeyTime last LAST_NOTHING return null return evt case KeyEvent KEY_RELEASED if keyCode KeyEvent VK_ALT if OperatingSystem isWindows OperatingSystem hasJava14 last LAST_MOD return evt default return evt public static void numericKeypadKey last LAST_NOTHING private static long lastKeyTime private static int last private static final int LAST_NOTHING private static final int LAST_ALT private static final int LAST_BROKEN private static final int LAST_NUMKEYPAD private static final int LAST_MOD private static void handleBrokenKeys KeyEvent evt int keyCode if evt isAltDown evt isControlDown evt isMetaDown last LAST_NOTHING return else if evt isAltDown evt isControlDown evt isMetaDown last LAST_NOTHING return if evt isAltDown last LAST_ALT switch keyCode case KeyEvent VK_LEFT case KeyEvent VK_RIGHT case KeyEvent VK_UP case KeyEvent VK_DOWN case KeyEvent VK_DELETE case KeyEvent VK_BACK_SPACE case KeyEvent VK_TAB case KeyEvent VK_ENTER last LAST_NOTHING break default if keyCode KeyEvent VK_A keyCode KeyEvent VK_Z last LAST_BROKEN else last LAST_NOTHING break lastKeyTime System currentTimeMillis public class PastePrevious extends EnhancedDialog implements ActionListener ListSelectionListener MouseListener public PastePrevious View view super view jEdit getProperty true this view view JPanel content new JPanel new BorderLayout content setBorder new EmptyBorder setContentPane content clipHistory HistoryModel getModel clips new JList new AbstractListModel public int getSize return clipHistory getSize public Object getElementAt int index StringBuffer buf new StringBuffer String item clipHistory getItem index boolean ws true for int item length char ch item charAt if Character isWhitespace ch if ws else buf append ws true else ws false buf append ch return buf toString clips setVisibleRowCount clips addMouseListener this clips addListSelectionListener this insert new JButton jEdit getProperty cancel new JButton jEdit getProperty JLabel label new JLabel jEdit getProperty label setBorder new EmptyBorder content add BorderLayout NORTH label JScrollPane scroller new JScrollPane clips Dimension dim scroller getPreferredSize scroller setPreferredSize new Dimension dim height content add scroller BorderLayout CENTER JPanel panel new JPanel panel setLayout new BoxLayout panel BoxLayout X_AXIS panel setBorder new EmptyBorder panel add Box createGlue panel add insert panel add Box createHorizontalStrut panel add cancel panel add Box createGlue content add panel BorderLayout SOUTH if clipHistory getSize clips setSelectedIndex updateButtons getRootPane setDefaultButton insert insert addActionListener this cancel addActionListener this GUIUtilities requestFocus this clips pack setLocationRelativeTo view show public void ok int selected clips getSelectedIndex if selected view getToolkit beep return String clip clipHistory getItem selected view getTextArea setSelectedText clip dispose public void cancel dispose public void actionPerformed ActionEvent evt Object source evt getSource if source insert ok else if source cancel cancel public void mouseClicked MouseEvent evt if evt getClickCount ok public void mouseEntered MouseEvent evt public void mouseExited MouseEvent evt public void mousePressed MouseEvent evt public void valueChanged ListSelectionEvent evt updateButtons private View view private JList clips private HistoryModel clipHistory private JButton insert private JButton cancel private void updateButtons int selected clips getSelectedIndex insert setEnabled selected public class EditPane extends JPanel implements EBComponent public View getView return view public Buffer getBuffer return buffer public void setBuffer final Buffer buffer if this buffer buffer return if buffer insideCompoundEdit buffer endCompoundEdit recentBuffer this buffer if recentBuffer null saveCaretInfo this buffer buffer textArea setBuffer buffer if init view updateTitle if bufferSwitcher null if bufferSwitcher getSelectedItem buffer bufferSwitcher setSelectedItem buffer EditBus send new EditPaneUpdate this EditPaneUpdate BUFFER_CHANGED SwingUtilities invokeLater new Runnable public void run if view getEditPane EditPane this bufferSwitcher null bufferSwitcher isPopupVisible focusOnTextArea Runnable runnable new Runnable public void run loadCaretInfo buffer checkModTime view if buffer isPerformingIO VFSManager runInAWTThread runnable else runnable run public void prevBuffer Buffer buffer this buffer getPrev if buffer null setBuffer jEdit getLastBuffer else setBuffer buffer public void nextBuffer Buffer buffer this buffer getNext if buffer null setBuffer jEdit getFirstBuffer else setBuffer buffer public void recentBuffer if recentBuffer null setBuffer recentBuffer else getToolkit beep public void focusOnTextArea textArea grabFocus public JEditTextArea getTextArea return textArea public void saveCaretInfo buffer setIntegerProperty Buffer CARET textArea getCaretPosition buffer setIntegerProperty Buffer SCROLL_VERT textArea getFirstPhysicalLine buffer setIntegerProperty Buffer SCROLL_HORIZ textArea getHorizontalOffset public void loadCaretInfo Integer caret Integer buffer getProperty Buffer CARET Integer firstLine Integer buffer getProperty Buffer SCROLL_VERT Integer horizontalOffset Integer buffer getProperty Buffer SCROLL_HORIZ if caret null textArea setCaretPosition Math min caret intValue buffer getLength if firstLine null textArea setFirstLine textArea physicalToVirtual firstLine intValue if horizontalOffset null textArea setHorizontalOffset horizontalOffset intValue view getStatus setMessage null public void handleMessage EBMessage msg if msg instanceof PropertiesChanged propertiesChanged loadBufferSwitcher else if msg instanceof BufferUpdate handleBufferUpdate BufferUpdate msg public final Dimension getMinimumSize return new Dimension EditPane View view Buffer buffer super new BorderLayout init true this view view EditBus addToBus this textArea new JEditTextArea view add BorderLayout CENTER textArea propertiesChanged if buffer null setBuffer jEdit getFirstBuffer else setBuffer buffer loadBufferSwitcher init false void close saveCaretInfo EditBus send new EditPaneUpdate this EditPaneUpdate DESTROYED EditBus removeFromBus this private boolean init private View view private Buffer buffer private Buffer recentBuffer private BufferSwitcher bufferSwitcher private JEditTextArea textArea private void propertiesChanged TextAreaPainter painter textArea getPainter painter setFont UIManager getFont painter setBracketHighlightEnabled jEdit getBooleanProperty painter setBracketHighlightColor jEdit getColorProperty painter setEOLMarkersPainted jEdit getBooleanProperty painter setEOLMarkerColor jEdit getColorProperty painter setWrapGuidePainted jEdit getBooleanProperty painter setWrapGuideColor jEdit getColorProperty painter setCaretColor jEdit getColorProperty painter setSelectionColor jEdit getColorProperty painter setBackground jEdit getColorProperty painter setForeground jEdit getColorProperty painter setBlockCaretEnabled jEdit getBooleanProperty painter setFoldedLineColor jEdit getColorProperty painter setLineHighlightEnabled jEdit getBooleanProperty painter setLineHighlightColor jEdit getColorProperty painter setAntiAliasEnabled jEdit getBooleanProperty painter setFractionalFontMetricsEnabled jEdit getBooleanProperty painter setStyles GUIUtilities loadStyles jEdit getProperty jEdit getIntegerProperty Gutter gutter textArea getGutter gutter setExpanded jEdit getBooleanProperty int interval jEdit getIntegerProperty gutter setHighlightInterval interval gutter setCurrentLineHighlightEnabled jEdit getBooleanProperty gutter setBracketHighlightEnabled jEdit getBooleanProperty gutter setBracketHighlightColor jEdit getColorProperty gutter setBackground jEdit getColorProperty gutter setForeground jEdit getColorProperty gutter setHighlightedForeground jEdit getColorProperty gutter setFoldColor jEdit getColorProperty gutter setMarkerHighlightColor jEdit getColorProperty gutter setMarkerHighlightEnabled jEdit getBooleanProperty gutter setCurrentLineForeground jEdit getColorProperty String alignment jEdit getProperty if equals alignment gutter setLineNumberAlignment Gutter RIGHT else if equals alignment gutter setLineNumberAlignment Gutter CENTER gutter setLineNumberAlignment Gutter LEFT gutter setFont jEdit getFontProperty int width jEdit getIntegerProperty gutter setBorder width jEdit getColorProperty jEdit getColorProperty textArea getPainter getBackground textArea setCaretBlinkEnabled jEdit getBooleanProperty textArea setElectricScroll jEdit getIntegerProperty textArea setRightClickPopup GUIUtilities loadPopupMenu textArea setQuickCopyEnabled jEdit getBooleanProperty textArea propertiesChanged private void loadBufferSwitcher if jEdit getBooleanProperty if bufferSwitcher null bufferSwitcher new BufferSwitcher this add BorderLayout NORTH bufferSwitcher bufferSwitcher updateBufferList revalidate else if bufferSwitcher null remove bufferSwitcher revalidate bufferSwitcher null private void handleBufferUpdate BufferUpdate msg Buffer msg getBuffer if msg getWhat BufferUpdate CREATED if bufferSwitcher null bufferSwitcher updateBufferList if buffer isClosed setBuffer jEdit getFirstBuffer recentBuffer null else if msg getWhat BufferUpdate CLOSED if bufferSwitcher null bufferSwitcher updateBufferList if buffer Buffer newBuffer recentBuffer null recentBuffer getPrev if newBuffer null newBuffer isClosed setBuffer newBuffer else if jEdit getBufferCount setBuffer jEdit getFirstBuffer recentBuffer null else if recentBuffer recentBuffer null else if msg getWhat BufferUpdate LOAD_STARTED if buffer textArea setCaretPosition textArea getPainter repaint else if msg getWhat BufferUpdate DIRTY_CHANGED if buffer if bufferSwitcher null if buffer isDirty bufferSwitcher repaint else bufferSwitcher updateBufferList else if msg getWhat BufferUpdate LOADED if buffer textArea repaint textArea updateScrollBars if bufferSwitcher null bufferSwitcher updateBufferList if view getEditPane this StatusBar status view getStatus status repaintCaretStatus status updateBufferStatus status updateMiscStatus loadCaretInfo else if msg getWhat BufferUpdate MARKERS_CHANGED if buffer textArea getGutter repaint else if msg getWhat BufferUpdate MODE_CHANGED if buffer textArea propertiesChanged if view getEditPane this view getStatus updateBufferStatus else if msg getWhat BufferUpdate ENCODING_CHANGED if buffer if view getEditPane this view getStatus updateBufferStatus else if msg getWhat BufferUpdate FOLD_HANDLER_CHANGED if buffer textArea getFoldVisibilityManager foldStructureChanged textArea repaint if view getEditPane this view getStatus updateMiscStatus else if msg getWhat BufferUpdate SAVED if buffer textArea propertiesChanged public class CurrentBufferSet implements SearchFileSet public String getFirstFile View view return view getBuffer getPath public String getNextFile View view String file if file null return view getBuffer getPath else return null public String getFiles View view return new String view getBuffer getPath public int getFileCount return public String getCode return public class SearchBar extends JPanel public SearchBar final View view setLayout new BoxLayout this BoxLayout X_AXIS this view view add Box createHorizontalStrut JLabel label new JLabel jEdit getProperty add label add Box createHorizontalStrut add find new HistoryTextField find setSelectAllOnFocus true Dimension max find getPreferredSize max width Integer MAX_VALUE find setMaximumSize max ActionHandler actionHandler new ActionHandler find addKeyListener new KeyHandler find addActionListener actionHandler find getDocument addDocumentListener new DocumentHandler Insets margin new Insets add Box createHorizontalStrut add ignoreCase new JCheckBox jEdit getProperty ignoreCase addActionListener actionHandler ignoreCase setMargin margin add Box createHorizontalStrut add regexp new JCheckBox jEdit getProperty regexp addActionListener actionHandler regexp setMargin margin add Box createHorizontalStrut add hyperSearch new JCheckBox jEdit getProperty hyperSearch addActionListener actionHandler hyperSearch setMargin margin update timer new Timer new ActionListener public void actionPerformed ActionEvent evt if incrementalSearch searchStart searchReverse if incrementalSearch searchReverse view getBuffer getLength searchReverse view getStatus setMessageAndClear jEdit getProperty public HistoryTextField getField return find public void setHyperSearch boolean hyperSearch jEdit setBooleanProperty hyperSearch this hyperSearch setSelected hyperSearch public void update ignoreCase setSelected SearchAndReplace getIgnoreCase regexp setSelected SearchAndReplace getRegexp hyperSearch setSelected jEdit getBooleanProperty private View view private HistoryTextField find private JCheckBox ignoreCase regexp hyperSearch private Timer timer private int searchStart private boolean searchReverse private void find boolean reverse timer stop String text find getText if text length jEdit setBooleanProperty hyperSearch isSelected new SearchDialog view null else if hyperSearch isSelected find setText null SearchAndReplace setSearchString text SearchAndReplace setSearchFileSet new CurrentBufferSet SearchAndReplace hyperSearch view else int start JEditTextArea textArea view getTextArea Selection textArea getSelectionAtOffset textArea getCaretPosition if null start textArea getCaretPosition else if reverse start getStart else start getEnd if incrementalSearch start reverse if incrementalSearch reverse view getBuffer getLength reverse view getStatus setMessageAndClear jEdit getProperty else view getStatus setMessageAndClear jEdit getProperty if jEdit getBooleanProperty getToolkit beep private boolean incrementalSearch int start boolean reverse SearchAndReplace setSearchFileSet new CurrentBufferSet SearchAndReplace setSearchString find getText SearchAndReplace setReverseSearch reverse try if SearchAndReplace find view view getBuffer start return true catch Exception Log log Log DEBUG this return true return false private void timerIncrementalSearch int start boolean reverse this searchStart start this searchReverse reverse timer stop timer setRepeats false timer setInitialDelay timer start class ActionHandler implements ActionListener public void actionPerformed ActionEvent evt Object source evt getSource if evt getSource find find false else if evt getSource hyperSearch jEdit setBooleanProperty hyperSearch isSelected update else if evt getSource ignoreCase SearchAndReplace setIgnoreCase ignoreCase isSelected else if evt getSource regexp SearchAndReplace setRegexp regexp isSelected class DocumentHandler implements DocumentListener public void insertUpdate DocumentEvent evt if hyperSearch isSelected int start JEditTextArea textArea view getTextArea Selection textArea getSelectionAtOffset textArea getCaretPosition if null start textArea getCaretPosition else start getStart timerIncrementalSearch start false public void removeUpdate DocumentEvent evt if hyperSearch isSelected String text find getText if text length if regexp isSelected timerIncrementalSearch false else int start JEditTextArea textArea view getTextArea Selection textArea getSelectionAtOffset textArea getCaretPosition if null start textArea getCaretPosition else start getStart timerIncrementalSearch start true public void changedUpdate DocumentEvent evt class KeyHandler extends KeyAdapter public void keyPressed KeyEvent evt switch evt getKeyCode case KeyEvent VK_LEFT case KeyEvent VK_RIGHT if hyperSearch isSelected evt consume view getEditPane focusOnTextArea view getEditPane getTextArea processKeyEvent evt break case KeyEvent VK_ESCAPE evt consume view getEditPane focusOnTextArea break case KeyEvent VK_ENTER if evt isShiftDown evt consume find regexp isSelected false true break public class CloseDialog extends EnhancedDialog public CloseDialog View view super view jEdit getProperty true this view view JPanel content new JPanel new BorderLayout content setBorder new EmptyBorder setContentPane content Box iconBox new Box BoxLayout Y_AXIS iconBox add new JLabel UIManager getIcon iconBox add Box createGlue content add BorderLayout WEST iconBox JPanel centerPanel new JPanel new BorderLayout JLabel label new JLabel jEdit getProperty label setBorder new EmptyBorder centerPanel add BorderLayout NORTH label bufferList new JList bufferModel new DefaultListModel bufferList setVisibleRowCount bufferList addListSelectionListener new ListHandler Buffer buffers jEdit getBuffers for int buffers length Buffer buffer buffers if buffer isDirty bufferModel addElement buffer getPath centerPanel add BorderLayout CENTER new JScrollPane bufferList content add BorderLayout CENTER centerPanel ActionHandler actionListener new ActionHandler Box buttons new Box BoxLayout X_AXIS buttons add Box createGlue buttons add selectAll new JButton jEdit getProperty selectAll setMnemonic jEdit getProperty charAt selectAll addActionListener actionListener buttons add Box createHorizontalStrut buttons add save new JButton jEdit getProperty save setMnemonic jEdit getProperty charAt save addActionListener actionListener buttons add Box createHorizontalStrut buttons add discard new JButton jEdit getProperty discard setMnemonic jEdit getProperty charAt discard addActionListener actionListener buttons add Box createHorizontalStrut buttons add cancel new JButton jEdit getProperty cancel addActionListener actionListener buttons add Box createGlue bufferList setSelectedIndex content add BorderLayout SOUTH buttons GUIUtilities requestFocus this bufferList pack setLocationRelativeTo view show public boolean isOK return ok public void ok public void cancel dispose private View view private JList bufferList private DefaultListModel bufferModel private JButton selectAll private JButton save private JButton discard private JButton cancel boolean selectAllFlag private void updateButtons int index bufferList getSelectedIndex save getModel setEnabled index discard getModel setEnabled index class ActionHandler implements ActionListener public void actionPerformed ActionEvent evt Object source evt getSource if source selectAll try selectAllFlag true bufferList setSelectionInterval bufferModel getSize finally selectAllFlag false bufferList requestFocus else if source save Object paths bufferList getSelectedValues for int paths length String path String paths Buffer buffer jEdit getBuffer path if buffer save view null true return VFSManager waitForRequests jEdit view buffer bufferModel removeElement path if bufferModel getSize ok true dispose else bufferList setSelectedIndex bufferList requestFocus else if source discard Object paths bufferList getSelectedValues for int paths length String path String paths Buffer buffer jEdit getBuffer path jEdit view buffer bufferModel removeElement path if bufferModel getSize ok true dispose else bufferList setSelectedIndex bufferList requestFocus else if source cancel cancel class ListHandler implements ListSelectionListener public void valueChanged ListSelectionEvent evt if selectAllFlag return int index bufferList getSelectedIndex if index view setBuffer jEdit getBuffer String bufferModel getElementAt index updateButtons public class SegmentBuffer extends Segment public SegmentBuffer int capacity ensureCapacity capacity public void append char ch ensureCapacity count array offset count ch count public void append char text int off int len ensureCapacity count len System arraycopy text off array count len count len private void ensureCapacity int capacity if array null array new char capacity else if capacity array length char arrayN new char capacity System arraycopy array arrayN count array arrayN public class BeanShell public static void evalSelection View view JEditTextArea textArea String command textArea getSelectedText if command null view getToolkit beep return Object returnValue eval view global command if returnValue null textArea setSelectedText returnValue toString public static void showEvaluateDialog View view String command GUIUtilities input view null if command null if command endsWith command command int repeat view getInputHandler getRepeatCount if view getMacroRecorder null view getMacroRecorder record repeat command Object returnValue null try for int repeat returnValue view global command catch Throwable Log log Log ERROR BeanShell class handleException view null if returnValue null String args returnValue toString GUIUtilities message view args public static void showEvaluateLinesDialog View view String command GUIUtilities input view null JEditTextArea textArea view getTextArea Buffer buffer view getBuffer Selection selection textArea getSelection if selection length command null command length view getToolkit beep return if command endsWith command command if view getMacroRecorder null view getMacroRecorder record command try buffer beginCompoundEdit for int selection length Selection selection for int getStartLine getEndLine if getEnd textArea getLineStartOffset break global setVariable new Integer global setVariable new Integer getStartLine int start getStart buffer int end getEnd buffer String text buffer getText start end start global setVariable text Object returnValue view global command if returnValue null buffer remove start end start buffer insert start returnValue toString catch Throwable Log log Log ERROR BeanShell class handleException view null finally buffer endCompoundEdit textArea selectNone public static void showRunScriptDialog View view Macros showRunScriptDialog view public static void runScript View view String path Reader in boolean ownNamespace try view path in ownNamespace catch Throwable Log log Log ERROR BeanShell class handleException view path public static void View view String path Reader in boolean ownNamespace throws Exception Log log Log MESSAGE BeanShell class path NameSpace namespace if ownNamespace namespace new NameSpace global else namespace global Interpreter interp createInterpreter namespace VFS vfs null Object session null try if in null Buffer buffer jEdit getBuffer path vfs VFSManager getVFSForPath path session vfs createVFSSession path view if session null return if buffer null if buffer isLoaded VFSManager waitForRequests in new StringReader buffer getText buffer getLength else in new BufferedReader new InputStreamReader vfs session path false view if view null EditPane editPane view getEditPane interp set view interp set editPane interp set editPane getBuffer interp set editPane getTextArea running true interp eval in namespace path catch Exception unwrapException finally running false if session null try vfs session view catch IOException io Log log Log ERROR BeanShell class io GUIUtilities error view new String path io toString public static Object eval View view NameSpace namespace String command try return view namespace command catch Throwable Log log Log ERROR BeanShell class handleException view null return null public static Object View view NameSpace namespace String command throws Exception Interpreter interp createInterpreter namespace try if view null EditPane editPane view getEditPane interp set view interp set editPane interp set editPane getBuffer interp set editPane getTextArea return interp eval command catch Exception unwrapException return null public static String cacheBlock String id String code boolean childNamespace throws Exception String name if id null name cachedBlockCounter else name id code name code null global code return name public static Object runCachedBlock String id View view NameSpace namespace throws Exception if namespace null namespace global Object args namespace try if view null namespace setVariable view EditPane editPane view getEditPane namespace setVariable editPane namespace setVariable editPane getBuffer namespace setVariable editPane getTextArea Object retVal internal invokeMethod id args interpForMethods if retVal instanceof Primitive if retVal Primitive VOID return null else return Primitive retVal getValue else return retVal catch Exception unwrapException return null finally try namespace setVariable null namespace setVariable null namespace setVariable null namespace setVariable null catch EvalError public static boolean isScriptRunning return running public static NameSpace getNameSpace return global public static void runScript View view String path boolean ownNamespace boolean rethrowBshErrors runScript view path null ownNamespace public static void runScript View view String path Reader in boolean ownNamespace boolean rethrowBshErrors runScript view path in ownNamespace public static Object eval View view String command boolean rethrowBshErrors return eval view global command public static Object eval View view NameSpace namespace String command boolean rethrowBshErrors return eval view namespace command static void init BshClassManager setClassLoader new JARClassLoader global new NameSpace interpForMethods createInterpreter global internal NameSpace eval null false Log log Log DEBUG BeanShell class Interpreter VERSION private static Interpreter interpForMethods private static NameSpace global private static NameSpace internal private static boolean running private static int cachedBlockCounter private static void unwrapException Exception throws Exception if instanceof TargetError Throwable TargetError getTarget if instanceof Exception throw Exception else if instanceof Error throw Error if instanceof InvocationTargetException Throwable InvocationTargetException getTargetException if instanceof Exception throw Exception else if instanceof Error throw Error throw private static void handleException View view String path Throwable if instanceof IOException VFSManager error view path new String toString else new BeanShellErrorDialog view toString private static Interpreter createInterpreter NameSpace nameSpace return new Interpreter null System out System err false nameSpace public class EditPaneUpdate extends EBMessage NonVetoable public static final Object CREATED public static final Object DESTROYED public static final Object BUFFER_CHANGED public EditPaneUpdate EditPane editPane Object what super editPane if what null throw new NullPointerException this what what public Object getWhat return what public EditPane getEditPane return EditPane getSource public String paramString return super paramString what private Object what class BSHTypedVariableDeclaration extends SimpleNode public boolean isFinal BSHTypedVariableDeclaration int id super id public Object eval CallStack callstack Interpreter interpreter throws EvalError try NameSpace namespace callstack top BSHType typeNode BSHType jjtGetChild Class type typeNode getType namespace int jjtGetNumChildren for int BSHVariableDeclarator dec BSHVariableDeclarator jjtGetChild Object value dec eval typeNode callstack interpreter if value Primitive VOID value null else if value Primitive NULL else if canCastToDeclaredType value type value BSHCastExpression castObject value type else namespace setTypedVariable dec name type value isFinal catch EvalError reThrow this return Primitive VOID boolean canCastToDeclaredType Object value Class toType if value instanceof Primitive return false Class fromType Primitive value getType if toType Byte TYPE toType Short TYPE toType Character TYPE fromType Integer TYPE return true else return false public class UndoManager public UndoManager Buffer buffer this buffer buffer undos new ArrayList public void setLimit int limit this limit limit public void clear undos clear undoPos undoCount public boolean undo JEditTextArea textArea if insideCompoundEdit throw new InternalError if undoPos return false else Edit edit Edit undos get undoPos int caret edit undo if caret textArea setCaretPosition caret return true public boolean redo JEditTextArea textArea if insideCompoundEdit throw new InternalError if undoPos undoCount return false else Edit edit Edit undos get undoPos int caret edit redo if caret textArea setCaretPosition caret return true public void beginCompoundEdit if compoundEditCount compoundEdit new CompoundEdit compoundEditCount public void endCompoundEdit if compoundEditCount Log log Log WARNING this new Exception return else if compoundEditCount switch compoundEdit undos size case break case addEdit Edit compoundEdit undos get break default addEdit compoundEdit compoundEdit null compoundEditCount public boolean insideCompoundEdit return compoundEditCount public void contentInserted int offset int length String text boolean clearDirty Edit toMerge null if compoundEdit null int size compoundEdit undos size if size toMerge Edit compoundEdit undos get size else if undoPos toMerge Edit undos get undoPos if clearDirty toMerge instanceof Insert Insert ins Insert toMerge if ins offset offset ins str text concat ins str ins length length return else if ins offset ins length offset ins str ins str concat text ins length length return Insert ins new Insert offset length text clearDirty if clearDirty if clearDirtyEdit null clearDirtyEdit clearDirty false clearDirtyEdit ins if compoundEdit null compoundEdit undos add ins else addEdit ins public void contentRemoved int offset int length String text boolean clearDirty Edit toMerge null if compoundEdit null int size compoundEdit undos size if size toMerge Edit compoundEdit undos get size else if undoPos toMerge Edit undos get undoPos if clearDirty toMerge instanceof Remove Remove rem Remove toMerge if rem offset offset rem str rem str concat text rem length length return else if rem offset rem length offset rem str text concat rem str rem length length return else if offset length rem offset rem str text concat rem str rem length length rem offset offset return Remove rem new Remove offset length text clearDirty if clearDirty if clearDirtyEdit null clearDirtyEdit clearDirty false clearDirtyEdit rem if compoundEdit null compoundEdit undos add rem else addEdit rem public void bufferSaved if clearDirtyEdit null clearDirtyEdit clearDirty false clearDirtyEdit null private Buffer buffer private ArrayList undos private int limit private int undoPos private int undoCount private int compoundEditCount private CompoundEdit compoundEdit private Edit clearDirtyEdit private void addEdit Edit edit undos add undoPos edit if undos size limit undos remove undoPos undoCount undoPos abstract class Edit abstract int undo abstract int redo boolean clearDirty class Insert extends Edit Insert int offset int length String str boolean clearDirty this offset offset this length length this str str this clearDirty clearDirty int undo buffer remove offset length if clearDirty buffer setDirty false return offset int redo buffer insert offset str return offset length int offset int length String str class Remove extends Edit Remove int offset int length String str boolean clearDirty this offset offset this length length this str str this clearDirty clearDirty int undo buffer insert offset str if clearDirty buffer setDirty false return offset length int redo buffer remove offset length return offset int offset int length String str class CompoundEdit extends Edit public int undo int retVal for int undos size retVal Edit undos get undo return retVal public int redo int retVal for int undos size retVal Edit undos get redo return retVal ArrayList undos new ArrayList public abstract class EditAction public EditAction String name this name name public String getName return name public String getLabel return jEdit getProperty name public String getMouseOverText return null public abstract void invoke View view public static View getView Component comp return GUIUtilities getView comp public boolean isToggle return false public boolean isSelected View view return false public boolean noRepeat return false public boolean noRecord return false public abstract String getCode public String toString return name private String name public static class Wrapper implements ActionListener public Wrapper EditAction action this action action public void actionPerformed ActionEvent evt GUIUtilities getView Component evt getSource getInputHandler invokeAction action private EditAction action public class EditServer extends Thread EditServer String portFile super portFile setDaemon true this portFile portFile try if OperatingSystem isUnix new File portFile createNewFile FileVFS setPermissions portFile socket new ServerSocket InetAddress getByName authKey Math abs new Random nextInt int port socket getLocalPort FileWriter out new FileWriter portFile out write out write String valueOf port out write out write String valueOf authKey out write out close Log log Log DEBUG this socket getLocalPort Log log Log DEBUG this authKey ok true catch IOException io Log log Log NOTICE this io public boolean isOK return ok public void run boolean abort false for if abort return Socket client null try client socket accept client setSoTimeout Log log Log MESSAGE this client DataInputStream in new DataInputStream client getInputStream if handleClient client in abort true catch Exception Log log Log ERROR this abort true finally if client null try client close catch Exception Log log Log ERROR this client null public static void handleClient boolean restore String parent String args String splitConfig null boolean newView jEdit getBooleanProperty if jEdit getFirstView null newView Buffer buffer jEdit openFiles null parent args if restore if jEdit getFirstBuffer null jEdit getFirstBuffer isUntitled jEdit getBufferCount splitConfig jEdit restoreOpenFiles else if jEdit getBooleanProperty jEdit restoreOpenFiles if jEdit getFirstBuffer null jEdit getFirstBuffer isUntitled jEdit getBufferCount buffer jEdit newFile null if splitConfig null jEdit newView null splitConfig else jEdit newView null buffer else View view jEdit getFirstView jEdit openFiles view parent args view setState java awt Frame NORMAL view requestFocus view toFront return void stopServer stop new File portFile delete private String portFile private ServerSocket socket private int authKey private boolean ok private boolean handleClient Socket client DataInputStream in throws Exception int key in readInt if key authKey Log log Log ERROR this client key authKey in close client close return false else client setSoTimeout Log log Log DEBUG this client final String script in readUTF Log log Log DEBUG this script SwingUtilities invokeLater new Runnable public void run BeanShell eval null BeanShell getNameSpace script return true public interface ParserConstants int EOF int NONPRINTABLE int SINGLE_LINE_COMMENT int HASH_BANG_COMMENT int FORMAL_COMMENT int MULTI_LINE_COMMENT int BOOLEAN int BREAK int CLASS int BYTE int CASE int CATCH int CHAR int CONST int CONTINUE int int DO int DOUBLE int ELSE int FALSE int FINAL int FINALLY int FLOAT int FOR int GOTO int IF int IMPORT int INSTANCEOF int INT int INTERFACE int LONG int NEW int NULL int PRIVATE int PROTECTED int PUBLIC int RETURN int SHORT int STATIC int SWITCH int THROW int TRUE int TRY int VOID int WHILE int INTEGER_LITERAL int DECIMAL_LITERAL int HEX_LITERAL int OCTAL_LITERAL int FLOATING_POINT_LITERAL int EXPONENT int CHARACTER_LITERAL int STRING_LITERAL int IDENTIFIER int LETTER int DIGIT int LPAREN int RPAREN int LBRACE int RBRACE int LBRACKET int RBRACKET int SEMICOLON int COMMA int DOT int ASSIGN int GT int GTX int LT int LTX int BANG int TILDE int HOOK int COLON int EQ int LE int LEX int GE int GEX int NE int BOOL_OR int BOOL_ORX int BOOL_AND int BOOL_ANDX int INCR int DECR int PLUS int MINUS int STAR int SLASH int BIT_AND int BIT_ANDX int BIT_OR int BIT_ORX int XOR int MOD int LSHIFT int LSHIFTX int RSIGNEDSHIFT int RSIGNEDSHIFTX int RUNSIGNEDSHIFT int RUNSIGNEDSHIFTX int PLUSASSIGN int MINUSASSIGN int STARASSIGN int SLASHASSIGN int ANDASSIGN int ANDASSIGNX int ORASSIGN int ORASSIGNX int XORASSIGN int MODASSIGN int LSHIFTASSIGN int LSHIFTASSIGNX int RSIGNEDSHIFTASSIGN int RSIGNEDSHIFTASSIGNX int RUNSIGNEDSHIFTASSIGN int RUNSIGNEDSHIFTASSIGNX int DEFAULT String tokenImage final class RETokenEnd extends REToken private String newline RETokenEnd int subIndex String newline super subIndex this newline newline boolean match CharIndexed input REMatch mymatch char ch input charAt mymatch index if ch CharIndexed OUT_OF_BOUNDS return mymatch eflags RE REG_NOTEOL false next input mymatch if newline null char do newline charAt if ch return false ch input charAt mymatch index while newline length return next input mymatch return false void dump StringBuffer os os append public class MacrosChanged extends EBMessage NonVetoable public MacrosChanged EBComponent source super source public class CharIndexedSegment implements CharIndexed Serializable CharIndexedSegment Segment seg boolean reverse this seg seg m_index reverse seg count this reverse reverse public char charAt int index if reverse index index return m_index index seg count m_index index seg array seg offset m_index index CharIndexed OUT_OF_BOUNDS public boolean isValid return m_index m_index seg count public boolean move int index if reverse index index return m_index index seg count private Segment seg private int m_index private boolean reverse public class PluginManagerProgress extends JDialog public PluginManagerProgress JDialog dialog String type Roster roster super JOptionPane getFrameForComponent dialog jEdit getProperty type true this dialog dialog this roster roster this type type JPanel content new JPanel new BorderLayout content setBorder new EmptyBorder setContentPane content globalProgress new JProgressBar globalProgress setStringPainted true globalProgress setString jEdit getProperty type count roster getOperationCount globalProgress setMaximum count content add BorderLayout NORTH globalProgress localProgress new JProgressBar localProgress setStringPainted true content add BorderLayout CENTER localProgress stop new JButton jEdit getProperty stop addActionListener new ActionHandler JPanel panel new JPanel panel setLayout new BoxLayout panel BoxLayout X_AXIS panel add Box createGlue panel add stop panel add Box createGlue content add BorderLayout SOUTH panel addWindowListener new WindowHandler pack Dimension screen getToolkit getScreenSize Dimension size getSize size width Math max size width setSize size setLocationRelativeTo dialog show public void removing String plugin String args plugin showMessage jEdit getProperty args stop setEnabled true public void downloading String plugin String args plugin showMessage jEdit getProperty args stop setEnabled true public void installing String plugin String args plugin showMessage jEdit getProperty args stop setEnabled false public void setMaximum final int total SwingUtilities invokeLater new Runnable public void run localProgress setMaximum total public void setValue final int value SwingUtilities invokeLater new Runnable public void run localProgress setValue value public void done final boolean ok this ok ok try if ok done count SwingUtilities invokeAndWait new Runnable public void run dispose if ok GUIUtilities message dialog type null else else SwingUtilities invokeAndWait new Runnable public void run globalProgress setValue done localProgress setValue catch Exception public boolean isOK return ok private JDialog dialog private Thread thread private String type private JProgressBar globalProgress localProgress private JButton stop private int count private int done private boolean ok private Roster roster private void showMessage final String msg try SwingUtilities invokeAndWait new Runnable public void run localProgress setString msg catch Exception Thread yield class ActionHandler implements ActionListener public void actionPerformed ActionEvent evt if evt getSource stop thread stop dispose class WindowHandler extends WindowAdapter boolean done public void windowOpened WindowEvent evt if done return done true thread new RosterThread thread start public void windowClosing WindowEvent evt thread stop dispose class RosterThread extends Thread RosterThread super public void run roster performOperations PluginManagerProgress this class LHS implements ParserConstants java io Serializable NameSpace nameSpace static final int VARIABLE FIELD PROPERTY INDEX int type String varName String propName Field field Object object int index LHS NameSpace nameSpace String varName type VARIABLE this varName varName this nameSpace nameSpace LHS Field field type FIELD this object null this field field LHS Object object Field field if object null throw new NullPointerException type FIELD this object object this field field LHS Object object String propName if object null throw new NullPointerException type PROPERTY this object object this propName propName LHS Object array int index if array null throw new NullPointerException type INDEX this object array this index index public Object getValue throws EvalError if type VARIABLE return nameSpace getVariable varName else if type FIELD try return field get object catch IllegalAccessException e2 throw new EvalError field else if type PROPERTY try return Reflect getObjectProperty object propName catch ReflectError Interpreter debug getMessage throw new EvalError propName else if type INDEX try return Reflect getIndex object index catch Exception throw new EvalError throw new InterpreterError public Object assign Object val throws EvalError if type VARIABLE nameSpace setVariable varName val else if type FIELD try if val instanceof Primitive val Primitive val getValue field set object val return val catch NullPointerException throw new EvalError field getName catch IllegalAccessException e2 throw new EvalError field getName catch IllegalArgumentException e3 throw new EvalError val null val getClass getName field getName else if type PROPERTY if object instanceof Hashtable Hashtable object put propName val else try Reflect setObjectProperty object propName val catch ReflectError Interpreter debug getMessage throw new EvalError propName else if type INDEX try Reflect setIndex object index val throw e1 catch Exception throw new EvalError getMessage return val public String toString return final class RETokenWordBoundary extends REToken private boolean negated private int where static final int BEGIN static final int END RETokenWordBoundary int subIndex int where boolean negated super subIndex this where where this negated negated boolean match CharIndexed input REMatch mymatch char ch if mymatch eflags RE REG_ANCHORINDEX RE REG_ANCHORINDEX mymatch offset mymatch index mymatch anchor if ch input charAt mymatch index CharIndexed OUT_OF_BOUNDS before Character isLetterOrDigit ch ch if ch input charAt mymatch index CharIndexed OUT_OF_BOUNDS after Character isLetterOrDigit ch ch boolean doNext false if where BEGIN BEGIN doNext after before if where END END doNext before after if negated doNext doNext return doNext next input mymatch false void dump StringBuffer os if where BEGIN END os append negated else if where BEGIN os append else os append public class AddAbbrevDialog extends JDialog public AddAbbrevDialog View view String abbrev super view jEdit getProperty true this view view JPanel content new JPanel new BorderLayout content setBorder new EmptyBorder setContentPane content editor new AbbrevEditor editor setAbbrev abbrev editor setBorder new EmptyBorder content add BorderLayout CENTER editor Box box new Box BoxLayout X_AXIS box add Box createGlue global new JButton jEdit getProperty global addActionListener new ActionHandler box add global box add Box createHorizontalStrut modeSpecific new JButton jEdit getProperty modeSpecific addActionListener new ActionHandler box add modeSpecific box add Box createHorizontalStrut cancel new JButton jEdit getProperty cancel addActionListener new ActionHandler box add cancel box add Box createGlue content add BorderLayout SOUTH box KeyListener listener new KeyHandler addKeyListener listener editor getBeforeCaretTextArea addKeyListener listener editor getAfterCaretTextArea addKeyListener listener setDefaultCloseOperation DISPOSE_ON_CLOSE if abbrev null GUIUtilities requestFocus this editor getAbbrevField else GUIUtilities requestFocus this editor getBeforeCaretTextArea pack setLocationRelativeTo view show private View view private AbbrevEditor editor private JButton global private JButton modeSpecific private JButton cancel class ActionHandler implements ActionListener public void actionPerformed ActionEvent evt Object source evt getSource if source global String editor getAbbrev if null length getToolkit beep return Abbrevs addGlobalAbbrev editor getExpansion Abbrevs expandAbbrev view false else if source modeSpecific String editor getAbbrev if null length getToolkit beep return Abbrevs addModeAbbrev view getBuffer getMode getName editor getExpansion Abbrevs expandAbbrev view false dispose class KeyHandler extends KeyAdapter public void keyPressed KeyEvent evt if evt getKeyCode KeyEvent VK_ESCAPE dispose class BSHFormalParameter extends SimpleNode public static final Class UNTYPED null public String name public Class type BSHFormalParameter int id super id public Object eval NameSpace namespace throws EvalError if jjtGetNumChildren type BSHType jjtGetChild getType namespace else type UNTYPED return Primitive VOID public class AppearanceOptionPane extends AbstractOptionPane public AppearanceOptionPane super protected void addComponent new JLabel jEdit getProperty lfs UIManager getInstalledLookAndFeels String names new String lfs length String lf UIManager getLookAndFeel getClass getName int index for int names length names lfs getName if lf equals lfs getClassName index lookAndFeel new JComboBox names lookAndFeel setSelectedIndex index lookAndFeel addActionListener new ActionListener public void actionPerformed ActionEvent evt updateEnabled addComponent jEdit getProperty lookAndFeel primaryFont new FontSelector jEdit getFontProperty addComponent jEdit getProperty primaryFont secondaryFont new FontSelector jEdit getFontProperty addComponent jEdit getProperty secondaryFont updateEnabled textColors new JCheckBox jEdit getProperty textColors setSelected jEdit getBooleanProperty addComponent textColors decorateFrames new JCheckBox jEdit getProperty decorateFrames setSelected jEdit getBooleanProperty decorateDialogs new JCheckBox jEdit getProperty decorateDialogs setSelected jEdit getBooleanProperty if OperatingSystem hasJava14 addComponent decorateFrames addComponent decorateDialogs protected void String lf lfs lookAndFeel getSelectedIndex getClassName jEdit setProperty lf jEdit setFontProperty primaryFont getFont jEdit setFontProperty secondaryFont getFont jEdit setBooleanProperty textColors isSelected jEdit setBooleanProperty decorateFrames isSelected jEdit setBooleanProperty decorateDialogs isSelected private UIManager LookAndFeelInfo lfs private JComboBox lookAndFeel private FontSelector primaryFont private FontSelector secondaryFont private JCheckBox textColors private JCheckBox decorateFrames private JCheckBox decorateDialogs private void updateEnabled String className lfs lookAndFeel getSelectedIndex getClassName if className equals className equals primaryFont setEnabled true secondaryFont setEnabled true else primaryFont setEnabled false secondaryFont setEnabled false public class RecentFilesMenu extends EnhancedMenu public RecentFilesMenu super public void setPopupMenuVisible boolean if final View view GUIUtilities getView this if getMenuComponentCount removeAll ActionListener actionListener new ActionListener public void actionPerformed ActionEvent evt jEdit openFile view evt getActionCommand view getStatus setMessage null MouseListener mouseListener new MouseAdapter public void mouseEntered MouseEvent evt view getStatus setMessage JMenuItem evt getSource getActionCommand public void mouseExited MouseEvent evt view getStatus setMessage null Vector recentVector BufferHistory getBufferHistory if recentVector size add GUIUtilities loadMenuItem super setPopupMenuVisible return Vector menuItems new Vector boolean sort jEdit getBooleanProperty int recentFileCount Math min recentVector size jEdit getIntegerProperty for int recentVector size recentVector size recentFileCount String path BufferHistory Entry recentVector elementAt path VFS vfs VFSManager getVFSForPath path JMenuItem menuItem new JMenuItem vfs getFileName path menuItem setActionCommand path menuItem addActionListener actionListener menuItem addMouseListener mouseListener menuItem setIcon FileCellRenderer fileIcon if sort menuItems addElement menuItem else add menuItem if sort MiscUtilities quicksort menuItems new MiscUtilities MenuItemCompare for int menuItems size add JMenuItem menuItems elementAt super setPopupMenuVisible public class dir static final String months public static String usage return public static void invoke Interpreter env NameSpace namespace String dir invoke env namespace dir public static void invoke Interpreter env NameSpace namespace String dir File file try file env pathToFile dir catch IOException env println return if file exists file canRead env println file return if file isDirectory env println dir String files file list files bubbleSort files for int files length File new File dir File separator files StringBuffer sb new StringBuffer sb append canRead sb append canWrite sb append sb append Date new Date lastModified GregorianCalendar new GregorianCalendar setTime int day get Calendar DAY_OF_MONTH sb append months get Calendar MONTH day if day sb append sb append int fieldlen StringBuffer len new StringBuffer for int fieldlen len append len insert length len setLength fieldlen int si len toString indexOf if si String pad len toString substring si len setLength si len insert pad sb append len toString sb append getName if isDirectory sb append env println sb toString public static String bubbleSort String in Vector new Vector for int in length addElement in int size boolean swap true while swap swap false for int if String elementAt compareTo String elementAt String tmp String elementAt removeElementAt insertElementAt tmp swap true String out new String copyInto out return out public class Handler extends URLStreamHandler public URLConnection openConnection URL url throws IOException PluginResURLConnection new PluginResURLConnection url connect return public class BrowserOptionPane extends AbstractOptionPane public BrowserOptionPane super public void String dirs jEdit getProperty jEdit getProperty jEdit getProperty jEdit getProperty defaultDirectory new JComboBox dirs String defaultDir jEdit getProperty if equals defaultDir defaultDirectory setSelectedIndex else if equals defaultDir defaultDirectory setSelectedIndex else if equals defaultDir defaultDirectory setSelectedIndex else if equals defaultDir defaultDirectory setSelectedIndex addComponent jEdit getProperty defaultDirectory showToolbar new JCheckBox jEdit getProperty showToolbar setSelected jEdit getBooleanProperty addComponent showToolbar showIcons new JCheckBox jEdit getProperty showIcons setSelected jEdit getBooleanProperty addComponent showIcons showHiddenFiles new JCheckBox jEdit getProperty showHiddenFiles setSelected jEdit getBooleanProperty addComponent showHiddenFiles sortFiles new JCheckBox jEdit getProperty sortFiles setSelected jEdit getBooleanProperty addComponent sortFiles sortIgnoreCase new JCheckBox jEdit getProperty sortIgnoreCase setSelected jEdit getBooleanProperty addComponent sortIgnoreCase sortMixFilesAndDirs new JCheckBox jEdit getProperty sortMixFilesAndDirs setSelected jEdit getBooleanProperty addComponent sortMixFilesAndDirs doubleClickClose new JCheckBox jEdit getProperty doubleClickClose setSelected jEdit getBooleanProperty addComponent doubleClickClose currentBufferFilter new JCheckBox jEdit getProperty currentBufferFilter setSelected jEdit getBooleanProperty addComponent currentBufferFilter splitHorizontally new JCheckBox jEdit getProperty splitHorizontally setSelected jEdit getBooleanProperty addComponent splitHorizontally public void String dirs jEdit setProperty dirs defaultDirectory getSelectedIndex jEdit setBooleanProperty showToolbar isSelected jEdit setBooleanProperty showIcons isSelected jEdit setBooleanProperty showHiddenFiles isSelected jEdit setBooleanProperty sortFiles isSelected jEdit setBooleanProperty sortIgnoreCase isSelected jEdit setBooleanProperty sortMixFilesAndDirs isSelected jEdit setBooleanProperty doubleClickClose isSelected jEdit setBooleanProperty currentBufferFilter isSelected jEdit setBooleanProperty splitHorizontally isSelected private JComboBox defaultDirectory private JCheckBox showToolbar private JCheckBox showIcons private JCheckBox showHiddenFiles private JCheckBox sortFiles private JCheckBox sortIgnoreCase private JCheckBox sortMixFilesAndDirs private JCheckBox doubleClickClose private JCheckBox currentBufferFilter private JCheckBox splitHorizontally public abstract class FoldHandler public String getName return name public abstract int getFoldLevel Buffer buffer int lineIndex Segment seg public static void registerFoldHandler FoldHandler handler if getFoldHandler handler getName null Log log Log ERROR FoldHandler class return foldHandlers add handler public static FoldHandler getFoldHandlers FoldHandler handlers new FoldHandler foldHandlers size return FoldHandler foldHandlers toArray handlers public static FoldHandler getFoldHandler String name FoldHandler handler Iterator foldHandlers iterator while hasNext handler FoldHandler next if name equals handler getName return handler return null public static String getFoldModes FoldHandler handlers getFoldHandlers String foldModes new String handlers length for int foldModes length foldModes handlers getName return foldModes protected FoldHandler String name this name name private String name private static ArrayList foldHandlers static foldHandlers new ArrayList registerFoldHandler new DummyFoldHandler registerFoldHandler new IndentFoldHandler registerFoldHandler new ExplicitFoldHandler public class HistoryModel public HistoryModel String name this name name max jEdit getIntegerProperty data new Vector max public void addItem String text if text null text length return int index data indexOf text if index data removeElementAt index data insertElementAt text while getSize max data removeElementAt data size public String getItem int index return String data elementAt index public int getSize return data size public String getName return name public static HistoryModel getModel String name if models null models new Hashtable HistoryModel model HistoryModel models get name if model null model new HistoryModel name models put name model return model public static void loadHistory File file if models null models new Hashtable try BufferedReader in new BufferedReader new FileReader file HistoryModel currentModel null String line while line in readLine null if line startsWith line endsWith if currentModel null models put currentModel getName currentModel currentModel new HistoryModel line substring line length else if currentModel null throw new IOException else currentModel addItemToEnd MiscUtilities escapesToChars line if currentModel null models put currentModel getName currentModel in close catch FileNotFoundException fnf Log log Log DEBUG HistoryModel class fnf catch IOException io Log log Log ERROR HistoryModel class io public static void saveHistory File file String lineSep System getProperty try BufferedWriter out new BufferedWriter new FileWriter file if models null out close return Enumeration modelEnum models elements while modelEnum hasMoreElements HistoryModel model HistoryModel modelEnum nextElement out write out write model getName out write out write lineSep for int model getSize out write MiscUtilities charsToEscapes model getItem true out write lineSep out close catch IOException io Log log Log ERROR HistoryModel class io private String name private int max private Vector data private static Hashtable models private void addItemToEnd String item data addElement item final class RETokenRepeated extends REToken private REToken token private int min max private boolean stingy RETokenRepeated int subIndex REToken token int min int max super subIndex this token token this min min this max max void makeStingy stingy true boolean isStingy return stingy int getMinimumLength return min token getMinimumLength boolean match CharIndexed input REMatch mymatch int numRepeats REMatch newMatch mymatch REMatch last null REMatch current Vector positions new Vector positions addElement newMatch REMatch doables REMatch doablesLast REMatch recurrent do if stingy numRepeats min REMatch result matchRest input newMatch if result null mymatch assignFrom result return true doables null doablesLast null for current newMatch current null current current next recurrent REMatch current clone if token match input recurrent if doables null doables recurrent doablesLast recurrent else doablesLast next recurrent while doablesLast next null doablesLast doablesLast next if doables null break newMatch doables numRepeats positions addElement newMatch while numRepeats max if numRepeats min return false int posIndex positions size REMatch allResults null REMatch allResultsLast null REMatch results null while posIndex min newMatch REMatch positions elementAt posIndex results matchRest input newMatch if results null if allResults null allResults results allResultsLast results else allResultsLast next results while allResultsLast next null allResultsLast allResultsLast next if allResults null return true return false private REMatch matchRest CharIndexed input final REMatch newMatch REMatch current single REMatch doneIndex null REMatch doneIndexLast null for current newMatch current null current current next single REMatch current clone if next input single if doneIndex null doneIndex single doneIndexLast single else doneIndexLast next single while doneIndexLast next null doneIndexLast doneIndexLast next return doneIndex void dump StringBuffer os os append token dumpAll os os append if max Integer MAX_VALUE min os append min else if min max os append else os append append min if max min os append if max Integer MAX_VALUE os append max os append if stingy os append public class REMatchEnumeration implements Enumeration Serializable private static final int YES private static final int MAYBE private static final int NO private int more private REMatch match private RE expr private CharIndexed input private int eflags private int index REMatchEnumeration RE expr CharIndexed input int index int eflags more MAYBE this expr expr this input input this index index this eflags eflags public boolean hasMoreElements return hasMoreMatches null public boolean hasMoreMatches return hasMoreMatches null public boolean hasMoreMatches StringBuffer buffer if more MAYBE match expr getMatchImpl input index eflags buffer if match null input move match end match end index match end match end match offset index more YES else more NO return more YES public Object nextElement throws NoSuchElementException return nextMatch public REMatch nextMatch throws NoSuchElementException if hasMoreElements more input isValid MAYBE NO return match throw new NoSuchElementException class BSHType extends SimpleNode implements BshClassManager Listener private Class baseType private int arrayDims private Class type BSHType int id super id BshClassManager addCMListener this public void addArrayDimension arrayDims public Class getType NameSpace namespace throws EvalError if type null return type SimpleNode node SimpleNode jjtGetChild if node instanceof BSHPrimitiveType baseType BSHPrimitiveType node getType else baseType BSHAmbiguousName node toClass namespace if arrayDims try Object obj Array newInstance baseType dims type obj getClass catch Exception throw new EvalError this else type baseType return type public Class getBaseType return baseType public int getArrayDims return arrayDims public void classLoaderChanged type null baseType null final class RETokenOneOf extends REToken private Vector options private boolean negative RETokenOneOf int subIndex String optionsStr boolean negative boolean insens super subIndex options new Vector this negative negative for int optionsStr length options addElement new RETokenChar subIndex optionsStr charAt insens RETokenOneOf int subIndex Vector options boolean negative super subIndex this options options this negative negative int getMinimumLength int min Integer MAX_VALUE int for int options size if REToken options elementAt getMinimumLength min min return min boolean match CharIndexed input REMatch mymatch if negative input charAt mymatch index CharIndexed OUT_OF_BOUNDS return false REMatch newMatch null REMatch last null REToken tk boolean isMatch for int options size tk REToken options elementAt REMatch tryMatch REMatch mymatch clone if negative return false if next input tryMatch if last null newMatch tryMatch last tryMatch else last next tryMatch last tryMatch if newMatch null if negative return false else mymatch assignFrom newMatch return true else if negative mymatch index return next input mymatch else return false void dump StringBuffer os os append negative for int options size if negative os append REToken options elementAt dumpAll os os append negative class BSHArrayDimensions extends SimpleNode public Class baseType private int arrayDims public int dimensions BSHArrayDimensions int id super id public void addArrayDimension arrayDims public Object eval Class type CallStack callstack Interpreter interpreter throws EvalError Interpreter debug type baseType type return eval callstack interpreter public Object eval CallStack callstack Interpreter interpreter throws EvalError SimpleNode child SimpleNode jjtGetChild if child instanceof BSHArrayInitializer if baseType null throw new EvalError this Object initValue BSHArrayInitializer child eval baseType arrayDims callstack interpreter Class arrayClass initValue getClass dimensions new int Reflect getArrayDimensions arrayClass if dimensions length arrayDims throw new EvalError arrayDims dimensions length this Object arraySlice initValue for int dimensions length dimensions Array getLength arraySlice if dimensions arraySlice Array get arraySlice return initValue else dimensions new int jjtGetNumChildren for int dimensions length try Object length SimpleNode jjtGetChild eval callstack interpreter dimensions Primitive length intValue catch Exception throw new EvalError this return Primitive VOID class CharIndexedString implements CharIndexed Serializable private String private int anchor private int len CharIndexedString String str int index str len length anchor index public char charAt int index int pos anchor index return pos len pos charAt pos OUT_OF_BOUNDS public boolean isValid return anchor len public boolean move int index return anchor index len public interface DockableWindowContainer void register DockableWindowManager Entry entry void add DockableWindowManager Entry entry void remove DockableWindowManager Entry entry void save DockableWindowManager Entry entry void show DockableWindowManager Entry entry boolean isVisible DockableWindowManager Entry entry public class MultiSelectStatusChanged extends EBMessage NonVetoable public MultiSelectStatusChanged EBComponent source super source public abstract class EditPlugin public String getClassName return getClass getName public void start public void stop public void createMenuItems Vector menuItems public void createOptionPanes OptionsDialog optionsDialog public EditPlugin JAR getJAR return jar public static class Broken extends EditPlugin public String getClassName return clazz Broken String clazz this clazz clazz private String clazz public static class JAR public String getPath return path public JARClassLoader getClassLoader return classLoader public ActionSet getActions return actions public void addPlugin EditPlugin plugin plugin jar JAR this plugin start if plugin instanceof EBPlugin EditBus addToBus EBPlugin plugin plugins addElement plugin public EditPlugin getPlugins EditPlugin array new EditPlugin plugins size plugins copyInto array return array public JAR String path JARClassLoader classLoader this path path this classLoader classLoader plugins new Vector actions new ActionSet void getPlugins Vector vector for int plugins size vector addElement plugins elementAt private String path private JARClassLoader classLoader private Vector plugins private ActionSet actions private EditPlugin JAR jar class BSHLHSPrimarySuffix extends SimpleNode public static final int INDEX NAME PROPERTY public String field public String method BSHLHSPrimarySuffix int id super id public LHS doLHSSuffix Object obj CallStack callstack Interpreter interpreter throws EvalError try switch operation case INDEX return doIndex obj callstack interpreter case NAME return doName obj callstack interpreter case PROPERTY return doProperty obj callstack interpreter default throw new InterpreterError catch ReflectError throw new EvalError this catch InvocationTargetException throw new TargetError getTargetException this true private LHS doName Object obj CallStack callstack Interpreter interpreter throws EvalError ReflectError InvocationTargetException if jjtGetNumChildren return Reflect getLHSObjectField obj field else Object oa BSHArguments jjtGetChild getArguments callstack interpreter try obj Reflect invokeObjectMethod interpreter obj method oa this catch EvalError ee throw new EvalError ee getMessage this return Reflect getLHSObjectField obj field private LHS doIndex Object obj CallStack callstack Interpreter interpreter throws EvalError ReflectError int index BSHPrimarySuffix getIndexAux obj callstack interpreter this return new LHS obj index private LHS doProperty Object obj CallStack callstack Interpreter interpreter throws EvalError ReflectError if obj Primitive VOID throw new EvalError this else if obj instanceof Primitive throw new EvalError this Object value SimpleNode jjtGetChild eval callstack interpreter if value instanceof String throw new EvalError this Interpreter debug return new LHS obj String value public class DockingOptionPane extends AbstractOptionPane public DockingOptionPane super public void Box box new Box BoxLayout X_AXIS ButtonGroup grp new ButtonGroup layout1 new JToggleButton GUIUtilities loadIcon grp add layout1 box add layout1 box add Box createHorizontalStrut layout2 new JToggleButton GUIUtilities loadIcon grp add layout2 box add layout2 if jEdit getBooleanProperty layout2 setSelected true else layout1 setSelected true addComponent jEdit getProperty box addComponent Box createVerticalStrut GridBagConstraints cons new GridBagConstraints cons gridy cons gridwidth cons gridheight GridBagConstraints REMAINDER cons fill GridBagConstraints BOTH cons weightx cons weighty JScrollPane windowScroller createWindowTableScroller gridBag setConstraints windowScroller cons add windowScroller public void jEdit setBooleanProperty layout2 isSelected windowModel save private JToggleButton layout1 private JToggleButton layout2 private JTable windowTable private WindowTableModel windowModel private JScrollPane createWindowTableScroller windowModel createWindowModel windowTable new JTable windowModel windowTable getTableHeader setReorderingAllowed false windowTable setColumnSelectionAllowed false windowTable setRowSelectionAllowed false windowTable setCellSelectionEnabled false DockPositionCellRenderer comboBox new DockPositionCellRenderer windowTable setRowHeight comboBox getPreferredSize height TableColumn column windowTable getColumnModel getColumn column setCellRenderer comboBox column setCellEditor new DefaultCellEditor new DockPositionCellRenderer Dimension windowTable getPreferredSize height Math min height JScrollPane scroller new JScrollPane windowTable scroller setPreferredSize return scroller private WindowTableModel createWindowModel return new WindowTableModel class DockPositionCellRenderer extends JComboBox implements TableCellRenderer DockPositionCellRenderer super new String DockableWindowManager FLOATING DockableWindowManager TOP DockableWindowManager LEFT DockableWindowManager BOTTOM DockableWindowManager RIGHT setRequestFocusEnabled false public Component getTableCellRendererComponent JTable table Object value boolean isSelected boolean hasFocus int row int column setSelectedItem value return this class WindowTableModel extends AbstractTableModel private Vector windows WindowTableModel windows new Vector Object list EditBus getNamedList DockableWindow DOCKABLE_WINDOW_LIST if list null for int list length windows addElement new Entry String list String dockables DockableWindowManager getRegisteredDockableWindows for int dockables length windows addElement new Entry dockables sort public void sort MiscUtilities quicksort windows new WindowCompare fireTableDataChanged public int getColumnCount return public int getRowCount return windows size public Class getColumnClass int col switch col case case return String class default throw new InternalError public Object getValueAt int row int col Entry window Entry windows elementAt row switch col case return window title case return window dockPosition default throw new InternalError public boolean isCellEditable int row int col return col public void setValueAt Object value int row int col if col return Entry window Entry windows elementAt row switch col case window dockPosition String value break default throw new InternalError fireTableRowsUpdated row row public String getColumnName int index switch index case return jEdit getProperty case return jEdit getProperty default throw new InternalError public void save for int windows size Entry windows elementAt save class Entry String name String title String dockPosition Entry String name this name name title jEdit getProperty name if title null title name dockPosition jEdit getProperty name if dockPosition null dockPosition DockableWindowManager FLOATING void save jEdit setProperty name dockPosition class WindowCompare implements MiscUtilities Compare public int compare Object obj1 Object obj2 Entry e1 Entry obj1 Entry e2 Entry obj2 return MiscUtilities compareStrings e1 title e2 title true public class Interpreter implements Runnable ConsoleInterface Serializable public static final String VERSION public static boolean DEBUG TRACE transient static PrintStream debug static staticInit static This systemObject public static boolean strictJava false transient Parser parser NameSpace globalNameSpace transient Reader in transient PrintStream out transient PrintStream err ConsoleInterface console Interpreter parent String sourceFileInfo public boolean noExitOnEOF private boolean public Interpreter Reader in PrintStream out PrintStream err boolean interactive NameSpace namespace Interpreter parent String sourceFileInfo parser new Parser in long t1 System currentTimeMillis this in in this out out this err err this interactive interactive debug err this parent parent this sourceFileInfo sourceFileInfo if namespace null this globalNameSpace new NameSpace else this globalNameSpace namespace if getu instanceof bsh This initRootSystemObject if interactive loadRCFiles long t2 System currentTimeMillis Interpreter debug t2 t1 public Interpreter Reader in PrintStream out PrintStream err boolean interactive NameSpace namespace this in out err interactive namespace null null public Interpreter Reader in PrintStream out PrintStream err boolean interactive this in out err interactive null public Interpreter ConsoleInterface console NameSpace globalNameSpace this console getIn console getOut console getErr true globalNameSpace setConsole console public Interpreter ConsoleInterface console this console null public Interpreter this new StringReader System out System err false null evalOnly true setu new Primitive true public void setConsole ConsoleInterface console this console console setu console private void initRootSystemObject setu new NameSpace getThis this if systemObject null systemObject new NameSpace getThis this setu systemObject This helpText new NameSpace getThis this setu helpText try setu System getProperty catch SecurityException setu setu new Primitive interactive setu new Primitive evalOnly public void setNameSpace NameSpace globalNameSpace this globalNameSpace globalNameSpace public NameSpace getNameSpace return globalNameSpace public static void main String args if args length String filename args String bshArgs if args length bshArgs new String args length System arraycopy args bshArgs args length else bshArgs new String Interpreter interpreter new Interpreter interpreter setu bshArgs try interpreter source filename interpreter globalNameSpace catch FileNotFoundException System out println catch TargetError System out println if inNativeCode printStackTrace DEBUG System err catch EvalError System out println catch IOException System out println else InputStream src if System getProperty startsWith System getProperty startsWith src new FilterInputStream System in public int available throws IOException return else src System in Reader in new CommandLineReader new InputStreamReader src Interpreter interpreter new Interpreter in System out System err true interpreter run public void run if evalOnly throw new RuntimeException if interactive try eval catch EvalError println VERSION boolean eof false CallStack callstack new CallStack callstack push globalNameSpace while eof try System out flush System err flush if interactive print eof Line SimpleNode node SimpleNode get_jjtree rootNode if DEBUG node dump Object ret node eval callstack this if callstack depth throw new InterpreterError callstack if ret instanceof ReturnControl ret ReturnControl ret value if ret Primitive VOID setVariable ret Object show getu if show instanceof Boolean Boolean show booleanValue true println ret catch ParseException error getMessage DEBUG if DEBUG printStackTrace if interactive eof true parser reInitInput in catch InterpreterError error getMessage printStackTrace if interactive eof true catch TargetError if inNativeCode printStackTrace DEBUG err if interactive eof true setVariable getTarget catch EvalError if interactive error toString else error getMessage if DEBUG printStackTrace if interactive eof true catch Exception error printStackTrace if interactive eof true catch TokenMgrError error parser reInitTokenInput in if interactive eof true finally get_jjtree reset if callstack depth callstack clear callstack push globalNameSpace if interactive noExitOnEOF System exit public Object source String filename NameSpace nameSpace throws FileNotFoundException IOException EvalError File file pathToFile filename debug file Reader in new BufferedReader new FileReader file return eval in nameSpace filename public Object source String filename throws FileNotFoundException IOException EvalError return source filename globalNameSpace public Object eval Reader in NameSpace nameSpace String sourceFileInfo throws EvalError Object retVal null debug nameSpace Interpreter localInterpreter new Interpreter in out err false nameSpace this sourceFileInfo CallStack callstack new CallStack callstack push nameSpace boolean eof false while eof SimpleNode node null try eof localInterpreter Line if localInterpreter get_jjtree nodeArity node SimpleNode localInterpreter get_jjtree rootNode node setSourceFile sourceFileInfo if TRACE retVal node eval callstack localInterpreter if callstack depth throw new InterpreterError callstack if retVal instanceof ReturnControl retVal ReturnControl retVal value catch ParseException if DEBUG error getMessage DEBUG setErrorSourceFile sourceFileInfo throw catch InterpreterError printStackTrace throw new EvalError sourceFileInfo getMessage node catch TargetError if getNode null setNode node reThrow sourceFileInfo catch EvalError if DEBUG printStackTrace if getNode null setNode node reThrow sourceFileInfo catch Exception printStackTrace throw new EvalError sourceFileInfo getMessage node catch TokenMgrError throw new EvalError sourceFileInfo getMessage node finally localInterpreter get_jjtree reset if callstack depth callstack clear callstack push nameSpace return Primitive unwrap retVal public Object eval Reader in throws EvalError return eval in globalNameSpace public Object eval String statement throws EvalError debug statement return eval statement globalNameSpace public Object eval String statement NameSpace nameSpace throws EvalError String statement endsWith statement statement return eval new StringReader nameSpace public final void error String if console null else err flush public Reader getIn return in public PrintStream getOut return out public PrintStream getErr return err public final void println String print public final void print String if console null console print else out print out flush public final static void debug String if DEBUG public Object get String name throws EvalError Object ret globalNameSpace get name this return Primitive unwrap ret Object getu String name try return get name catch EvalError throw new InterpreterError public void set String name Object value throws EvalError if value null value Primitive NULL CallStack callstack new CallStack LHS lhs globalNameSpace getNameResolver name toLHS callstack this lhs assign value void setu String name Object value try set name value catch EvalError throw new InterpreterError public void set String name long value throws EvalError set name new Primitive value public void set String name int value throws EvalError set name new Primitive value public void set String name double value throws EvalError set name new Primitive value public void set String name float value throws EvalError set name new Primitive value public void set String name boolean value throws EvalError set name new Primitive value public void unset String name throws EvalError CallStack callstack new CallStack LHS lhs globalNameSpace getNameResolver name toLHS callstack this if lhs type LHS VARIABLE throw new EvalError name lhs assign null public Object getVariable String name Object obj globalNameSpace getVariable name return Primitive unwrap obj public void setVariable String name Object value try globalNameSpace setVariable name value catch EvalError error toString public void setVariable String name int value try globalNameSpace setVariable name new Primitive value catch EvalError error toString public void setVariable String name float value try globalNameSpace setVariable name new Primitive value catch EvalError error toString public void setVariable String name boolean value try globalNameSpace setVariable name new Primitive value catch EvalError error toString public Object getInterface Class interf throws EvalError return globalNameSpace getThis this getInterface interf private JJTParserState get_jjtree return parser jjtree private ASCII_UCodeESC_CharStream get_jj_input_stream return parser jj_input_stream private boolean Line throws ParseException return parser Line void loadRCFiles try String rcfile System getProperty File separator source rcfile globalNameSpace catch Exception debug public File pathToFile String fileName throws IOException File file new File fileName if file isAbsolute String cwd String getu file new File cwd File separator fileName return new File file getCanonicalPath public static void redirectOutputToFile String filename try PrintStream pout new PrintStream new FileOutputStream filename System setOut pout System setErr pout catch IOException System err println filename public void setClassLoader ClassLoader externalCL BshClassManager setClassLoader externalCL static void staticInit try debug System err DEBUG Boolean getBoolean TRACE Boolean getBoolean String outfilename System getProperty if outfilename null redirectOutputToFile outfilename catch SecurityException System err println catch Exception System err println catch Throwable System err println public String getSourceFileInfo if sourceFileInfo null return sourceFileInfo else return public Interpreter getParent return parent public void setOut PrintStream out this out out public void setErr PrintStream out this err err public class BrowserView extends JPanel public BrowserView VFSBrowser browser final boolean splitHorizontally this browser browser this splitHorizontally splitHorizontally parentModel new DefaultListModel parentDirectories new JList parentModel parentDirectories getSelectionModel setSelectionMode TreeSelectionModel SINGLE_TREE_SELECTION parentDirectories setCellRenderer new ParentDirectoryRenderer parentDirectories setVisibleRowCount parentDirectories addMouseListener new MouseHandler rootNode new DefaultMutableTreeNode null true model new DefaultTreeModel rootNode true tree new BrowserJTree model tree setCellRenderer renderer tree setEditable false tree addTreeExpansionListener new TreeHandler tree putClientProperty tree setRootVisible false tree setShowsRootHandles true tree setVisibleRowCount final JScrollPane parentScroller new JScrollPane parentDirectories parentScroller setMinimumSize new Dimension JScrollPane treeScroller new JScrollPane tree treeScroller setMinimumSize new Dimension splitPane new JSplitPane splitHorizontally JSplitPane HORIZONTAL_SPLIT JSplitPane VERTICAL_SPLIT parentScroller treeScroller SwingUtilities invokeLater new Runnable public void run String prop splitHorizontally int loc jEdit getIntegerProperty prop if loc loc parentScroller getPreferredSize height splitPane setDividerLocation loc parentDirectories ensureIndexIsVisible parentDirectories getModel getSize tmpExpanded new Hashtable if browser isMultipleSelectionEnabled tree getSelectionModel setSelectionMode TreeSelectionModel DISCONTIGUOUS_TREE_SELECTION else tree getSelectionModel setSelectionMode TreeSelectionModel SINGLE_TREE_SELECTION setLayout new BorderLayout add BorderLayout CENTER splitPane propertiesChanged public boolean requestDefaultFocus tree requestFocus return true public void removeNotify String prop splitHorizontally jEdit setIntegerProperty prop splitPane getDividerLocation super removeNotify public VFS DirectoryEntry getSelectedFiles Vector selected new Vector tree getSelectionCount TreePath paths tree getSelectionPaths if paths null return new VFS DirectoryEntry for int paths length DefaultMutableTreeNode treeNode DefaultMutableTreeNode paths getLastPathComponent Object obj treeNode getUserObject if obj instanceof VFS DirectoryEntry selected addElement obj VFS DirectoryEntry retVal new VFS DirectoryEntry selected size selected copyInto retVal return retVal public void selectNone tree setSelectionPaths new TreePath public void directoryLoaded DefaultMutableTreeNode node String path Vector directory if node rootNode parentModel removeAllElements String parent path if parent length parent endsWith parent endsWith File separator parent parent substring parent length for parentModel insertElementAt parent String newParent MiscUtilities getParentOfPath parent if newParent length newParent endsWith newParent endsWith File separator newParent newParent substring newParent length if newParent null parent equals newParent break else parent newParent int index parentModel getSize parentDirectories setSelectedIndex index parentDirectories ensureIndexIsVisible parentModel getSize node removeAllChildren Vector toExpand new Vector if directory null for int directory size VFS DirectoryEntry file VFS DirectoryEntry directory elementAt boolean allowsChildren file type VFS DirectoryEntry FILE DefaultMutableTreeNode newNode new DefaultMutableTreeNode file allowsChildren node add newNode if tmpExpanded get file path null toExpand addElement new TreePath newNode getPath model reload node tree expandPath new TreePath node getPath for int toExpand size TreePath treePath TreePath toExpand elementAt tree expandPath treePath timer stop typeSelectBuffer setLength public void updateFileView tree repaint public void loadDirectory String path tmpExpanded clear loadDirectory rootNode path false public void maybeReloadDirectory String path tmpExpanded clear String browserDir browser getDirectory if browserDir startsWith FavoritesVFS PROTOCOL maybeReloadDirectory rootNode path else if browserDir startsWith FileRootsVFS PROTOCOL if MiscUtilities isURL path MiscUtilities getProtocolOfURL path equals maybeReloadDirectory rootNode path else if path startsWith browserDir maybeReloadDirectory rootNode path public Component getDefaultFocusComponent return tree public void propertiesChanged showIcons jEdit getBooleanProperty renderer propertiesChanged tree setRowHeight renderer getTreeCellRendererComponent tree new DefaultMutableTreeNode false false false false getSize height splitPane setBorder null private VFSBrowser browser private JSplitPane splitPane private JList parentDirectories private DefaultListModel parentModel private JTree tree private Hashtable tmpExpanded private DefaultTreeModel model private DefaultMutableTreeNode rootNode private BrowserCommandsMenu popup private boolean showIcons private boolean splitHorizontally private FileCellRenderer renderer new FileCellRenderer private StringBuffer typeSelectBuffer new StringBuffer private Timer timer new Timer new ClearTypeSelect private boolean maybeReloadDirectory DefaultMutableTreeNode node String path if tree isExpanded new TreePath node getPath return false if node rootNode path equals browser getDirectory loadDirectory rootNode path false return true Object userObject node getUserObject if userObject instanceof VFS DirectoryEntry VFS DirectoryEntry file VFS DirectoryEntry userObject if file type VFS DirectoryEntry FILE return false if path equals file path loadDirectory node path false return true if node getChildCount Enumeration children node children while children hasMoreElements DefaultMutableTreeNode child DefaultMutableTreeNode children nextElement if maybeReloadDirectory child path return true return false private void loadDirectory DefaultMutableTreeNode node String path boolean showLoading int rowCount tree getRowCount for int rowCount TreePath treePath tree getPathForRow if tree isExpanded treePath DefaultMutableTreeNode DefaultMutableTreeNode treePath getLastPathComponent VFS DirectoryEntry file VFS DirectoryEntry getUserObject tmpExpanded put file path file path if node rootNode parentModel removeAllElements parentModel addElement new LoadingPlaceholder if showLoading node removeAllChildren node add new DefaultMutableTreeNode new LoadingPlaceholder false model reload node browser loadDirectory node path node rootNode private void showFilePopup VFS DirectoryEntry file Point point popup new BrowserCommandsMenu browser file GUIUtilities showPopupMenu popup tree point point class ClearTypeSelect implements ActionListener public void actionPerformed ActionEvent evt typeSelectBuffer setLength browser filesSelected class ParentDirectoryRenderer extends DefaultListCellRenderer Font plainFont boldFont ParentDirectoryRenderer plainFont UIManager getFont boldFont new Font plainFont getName Font BOLD plainFont getSize public Component getListCellRendererComponent JList list Object value int index boolean isSelected boolean cellHasFocus super getListCellRendererComponent list value index isSelected cellHasFocus ParentDirectoryRenderer this setBorder new EmptyBorder index if value instanceof LoadingPlaceholder ParentDirectoryRenderer this setFont plainFont setIcon showIcons FileCellRenderer loadingIcon null setText jEdit getProperty else ParentDirectoryRenderer this setFont boldFont setIcon showIcons FileCellRenderer openDirIcon null setText MiscUtilities getFileName value toString return this class MouseHandler extends MouseAdapter public void mouseClicked MouseEvent evt if evt getClickCount return int row parentDirectories locationToIndex evt getPoint if row Object obj parentModel getElementAt row if obj instanceof String browser setDirectory String obj requestDefaultFocus class BrowserJTree extends JTree BrowserJTree TreeModel model super model ToolTipManager sharedInstance registerComponent this public final String getToolTipText MouseEvent evt TreePath path getPathForLocation evt getX evt getY if path null Rectangle cellRect getPathBounds path if cellRect null cellRectIsVisible cellRect return path getLastPathComponent toString return null public final Point getToolTipLocation MouseEvent evt TreePath path getPathForLocation evt getX evt getY if path null Rectangle cellRect getPathBounds path if cellRect null cellRectIsVisible cellRect return new Point cellRect showIcons cellRect return null protected void processKeyEvent KeyEvent evt if evt getID KeyEvent KEY_PRESSED switch evt getKeyCode case KeyEvent VK_ENTER browser filesActivated evt isShiftDown false evt consume break case KeyEvent VK_LEFT String directory browser getDirectory browser setDirectory MiscUtilities getParentOfPath directory evt consume break else if evt getID KeyEvent KEY_TYPED if evt isControlDown evt isAltDown evt isMetaDown return switch evt getKeyChar case browser setDirectory System getProperty break case browser rootDirectory break case View view browser getView Buffer buffer view getBuffer browser setDirectory MiscUtilities getParentOfPath buffer getPath break default typeSelectBuffer append evt getKeyChar doTypeSelect typeSelectBuffer toString timer stop timer setInitialDelay timer setRepeats false timer start break return if evt isConsumed super processKeyEvent evt protected void processMouseEvent MouseEvent evt ToolTipManager ttm ToolTipManager sharedInstance switch evt getID case MouseEvent MOUSE_ENTERED toolTipInitialDelay ttm getInitialDelay toolTipReshowDelay ttm getReshowDelay ttm setInitialDelay ttm setReshowDelay super processMouseEvent evt case MouseEvent MOUSE_EXITED ttm setInitialDelay toolTipInitialDelay ttm setReshowDelay toolTipReshowDelay super processMouseEvent evt case MouseEvent MOUSE_CLICKED if evt getModifiers MouseEvent BUTTON2_MASK TreePath path getPathForLocation evt getX evt getY if path null super processMouseEvent evt break if isPathSelected path setSelectionPath path browser filesActivated evt isShiftDown true break else if evt getModifiers MouseEvent BUTTON1_MASK TreePath path getPathForLocation evt getX evt getY if path null super processMouseEvent evt break if isPathSelected path setSelectionPath path if evt getClickCount browser filesSelected super processMouseEvent evt if evt getClickCount browser filesActivated evt isShiftDown true break else if GUIUtilities isPopupTrigger evt super processMouseEvent evt case MouseEvent MOUSE_PRESSED if evt getModifiers MouseEvent BUTTON1_MASK if popup null popup isVisible popup setVisible false if evt getClickCount break else if GUIUtilities isPopupTrigger evt if popup null popup isVisible popup setVisible false break TreePath path getPathForLocation evt getX evt getY if path null showFilePopup null evt getPoint else setSelectionPath path browser filesSelected Object userObject DefaultMutableTreeNode path getLastPathComponent getUserObject if userObject instanceof VFS DirectoryEntry VFS DirectoryEntry file VFS DirectoryEntry userObject showFilePopup file evt getPoint else showFilePopup null evt getPoint break super processMouseEvent evt case MouseEvent MOUSE_RELEASED if evt getClickCount super processMouseEvent evt default super processMouseEvent evt break private int toolTipInitialDelay private int toolTipReshowDelay private boolean cellRectIsVisible Rectangle cellRect Rectangle vr BrowserJTree this getVisibleRect return vr contains cellRect cellRect vr contains cellRect cellRect width cellRect cellRect height private void doTypeSelect String str if getSelectionCount doTypeSelect str getRowCount else int start getMaxSelectionRow boolean retVal doTypeSelect str start getRowCount if retVal doTypeSelect str start private boolean doTypeSelect String str int start int end for int start end DefaultMutableTreeNode treeNode DefaultMutableTreeNode getPathForRow getLastPathComponent Object obj treeNode getUserObject if obj instanceof VFS DirectoryEntry VFS DirectoryEntry file VFS DirectoryEntry obj if file name regionMatches true str str length setSelectionRow scrollRowToVisible return true return false class TreeHandler implements TreeExpansionListener public void treeExpanded TreeExpansionEvent evt TreePath path evt getPath DefaultMutableTreeNode treeNode DefaultMutableTreeNode path getLastPathComponent Object userObject treeNode getUserObject if userObject instanceof VFS DirectoryEntry loadDirectory treeNode VFS DirectoryEntry userObject path true public void treeCollapsed TreeExpansionEvent evt TreePath path evt getPath DefaultMutableTreeNode treeNode DefaultMutableTreeNode path getLastPathComponent if treeNode getUserObject instanceof VFS DirectoryEntry treeNode removeAllChildren treeNode add new DefaultMutableTreeNode new LoadingPlaceholder false model reload treeNode static class LoadingPlaceholder public class PrintOptionPane extends AbstractOptionPane public PrintOptionPane super protected void font new FontSelector jEdit getFontProperty addComponent jEdit getProperty font printHeader new JCheckBox jEdit getProperty printHeader setSelected jEdit getBooleanProperty addComponent printHeader printFooter new JCheckBox jEdit getProperty printFooter setSelected jEdit getBooleanProperty addComponent printFooter printLineNumbers new JCheckBox jEdit getProperty printLineNumbers setSelected jEdit getBooleanProperty addComponent printLineNumbers color new JCheckBox jEdit getProperty color setSelected jEdit getBooleanProperty addComponent color String tabSizes tabSize new JComboBox tabSizes tabSize setEditable true tabSize setSelectedItem jEdit getProperty addComponent jEdit getProperty tabSize protected void jEdit setFontProperty font getFont jEdit setBooleanProperty printHeader isSelected jEdit setBooleanProperty printFooter isSelected jEdit setBooleanProperty printLineNumbers isSelected jEdit setBooleanProperty color isSelected jEdit setProperty String tabSize getSelectedItem private FontSelector font private JCheckBox printHeader private JCheckBox printFooter private JCheckBox printLineNumbers private JCheckBox color private JComboBox tabSize public class WorkThread extends Thread public WorkThread WorkThreadPool pool ThreadGroup group String name super group name setDaemon true setPriority this pool pool public void setAbortable boolean abortable synchronized abortLock this abortable abortable if aborted stop new Abort public boolean isRequestRunning return requestRunning public String getStatus return status public void setStatus String status this status status pool fireProgressChanged this public int getProgressValue return progressValue public void setProgressValue int progressValue this progressValue progressValue pool fireProgressChanged this public int getProgressMaximum return progressMaximum public void setProgressMaximum int progressMaximum this progressMaximum progressMaximum pool fireProgressChanged this public void abortCurrentRequest synchronized abortLock if abortable aborted stop new Abort aborted true public void run Log log Log DEBUG this getName for doRequests private WorkThreadPool pool private Object abortLock new Object private boolean requestRunning private boolean abortable private boolean aborted private String status private int progressValue private int progressMaximum private void doRequests WorkThreadPool Request request for request pool getNextRequest if request null break else requestRunning true pool fireStatusChanged this doRequest request requestRunning false pool fireStatusChanged this synchronized pool waitForAllLock pool waitForAllLock notifyAll synchronized pool lock try pool lock wait catch InterruptedException ie Log log Log ERROR this ie private void doRequest WorkThreadPool Request request try request run run catch Abort Log log Log ERROR WorkThread class catch Throwable Log log Log ERROR WorkThread class Log log Log ERROR WorkThread class finally synchronized abortLock aborted abortable false status null progressValue progressMaximum pool requestDone pool fireStatusChanged this public static class Abort extends Error public Abort super public class PropertiesChanged extends EBMessage NonVetoable public PropertiesChanged EBComponent source super source public abstract class AbstractOptionPane extends JPanel implements OptionPane public AbstractOptionPane String name this name name setLayout gridBag new GridBagLayout public String getName return name public Component getComponent return this public void init if initialized initialized true public void save if initialized protected boolean initialized protected GridBagLayout gridBag protected int protected void protected void public void addComponent String label Component comp GridBagConstraints cons new GridBagConstraints cons gridy cons gridheight cons gridwidth cons weightx cons insets new Insets cons fill GridBagConstraints BOTH JLabel new JLabel label SwingConstants RIGHT setBorder new EmptyBorder gridBag setConstraints cons add cons gridx cons weightx gridBag setConstraints comp cons add comp public void addComponent Component comp GridBagConstraints cons new GridBagConstraints cons gridy cons gridheight cons gridwidth cons REMAINDER cons fill GridBagConstraints NONE cons anchor GridBagConstraints WEST cons weightx cons insets new Insets gridBag setConstraints comp cons add comp public void addSeparator String label Box box new Box BoxLayout X_AXIS Box box2 new Box BoxLayout Y_AXIS box2 add Box createGlue box2 add new JSeparator JSeparator HORIZONTAL box2 add Box createGlue box add box2 JLabel new JLabel jEdit getProperty label setMaximumSize getPreferredSize box add Box box3 new Box BoxLayout Y_AXIS box3 add Box createGlue box3 add new JSeparator JSeparator HORIZONTAL box3 add Box createGlue box add box3 GridBagConstraints cons new GridBagConstraints cons gridy cons gridheight cons gridwidth cons REMAINDER cons fill GridBagConstraints BOTH cons anchor GridBagConstraints WEST cons weightx cons insets new Insets gridBag setConstraints box cons add box private String name abstract class REToken implements Serializable protected REToken next null protected REToken uncle null protected int subIndex protected REToken int subIndex this subIndex subIndex int getMinimumLength return void setUncle REToken anUncle uncle anUncle abstract boolean match CharIndexed input REMatch mymatch protected boolean next CharIndexed input REMatch mymatch if next null if uncle null return true else return uncle match input mymatch else return next match input mymatch boolean chain REToken token next token abstract void dump StringBuffer os void dumpAll StringBuffer os dump os if next null next dumpAll os class ErrorListCellRenderer extends JComponent implements ListCellRenderer ErrorListCellRenderer plainFont UIManager getFont boldFont new Font plainFont getName Font BOLD plainFont getSize plainFM getFontMetrics plainFont boldFM getFontMetrics boldFont setBorder new EmptyBorder public Component getListCellRendererComponent JList list Object value int index boolean isSelected boolean cellHasFocus ErrorListDialog ErrorEntry entry ErrorListDialog ErrorEntry value this path entry path this messages entry messages return this public Dimension getPreferredSize int width boldFM stringWidth path int height boldFM getHeight for int messages length width Math max plainFM stringWidth messages width height plainFM getHeight Insets insets getBorder getBorderInsets this width insets left insets right height insets top insets bottom return new Dimension width height public void paintComponent Graphics Insets insets getBorder getBorderInsets this setFont boldFont drawString path insets left insets top boldFM getAscent int insets top boldFM getHeight setFont plainFont for int messages length drawString messages insets left plainFM getAscent plainFM getHeight private String path private String messages private Font plainFont private Font boldFont private FontMetrics plainFM private FontMetrics boldFM public class BufferIORequest extends WorkRequest public static final int IOBUFSIZE public static final int PROGRESS_INTERVAL public static final String LOAD_DATA public static final String END_OFFSETS public static final String NEW_PATH public static final String ERROR_OCCURRED public static final int LOAD public static final int SAVE public static final int AUTOSAVE public static final int INSERT public static final int GZIP_MAGIC_1 public static final int GZIP_MAGIC_2 public static final int UNICODE_MAGIC_1 public static final int UNICODE_MAGIC_2 public BufferIORequest int type View view Buffer buffer Object session VFS vfs String path this type type this view view this buffer buffer this session session this vfs vfs this path path markersPath vfs getParentOfPath path vfs getFileName path public void run switch type case LOAD load break case SAVE save break case AUTOSAVE autosave break case INSERT insert break public String toString String typeString switch type case LOAD typeString break case SAVE typeString break case AUTOSAVE typeString break default typeString return getClass getName typeString buffer private int type private View view private Buffer buffer private Object session private VFS vfs private String path private String markersPath private void load InputStream in null try try String args vfs getFileName path setStatus jEdit getProperty args setAbortable true setProgressValue path vfs session path view VFS DirectoryEntry entry vfs session path view long length if entry null length entry length else length in vfs session path false view if in null System err println return in new BufferedInputStream in if in markSupported in mark int b1 in read int b2 in read in reset if b1 GZIP_MAGIC_1 b2 GZIP_MAGIC_2 in new GZIPInputStream in buffer setBooleanProperty Buffer GZIPPED true else if b1 UNICODE_MAGIC_1 b2 UNICODE_MAGIC_2 b1 UNICODE_MAGIC_2 b2 UNICODE_MAGIC_1 buffer setProperty Buffer ENCODING else if path toLowerCase endsWith in new GZIPInputStream in read buffer in length buffer setNewFile false catch CharConversionException ch Log log Log ERROR this ch Object pp buffer getProperty Buffer ENCODING ch toString VFSManager error view path pp buffer setBooleanProperty ERROR_OCCURRED true catch IOException io Log log Log ERROR this io Object pp io toString VFSManager error view path pp buffer setBooleanProperty ERROR_OCCURRED true catch OutOfMemoryError oom Log log Log ERROR this oom VFSManager error view path null buffer setBooleanProperty ERROR_OCCURRED true if jEdit getBooleanProperty try String args vfs getFileName path setStatus jEdit getProperty args setAbortable true in vfs session markersPath true view if in null readMarkers buffer in catch IOException io catch WorkThread Abort if in null try in close catch IOException io buffer setBooleanProperty ERROR_OCCURRED true finally try vfs session view catch IOException io Log log Log ERROR this io String pp io toString VFSManager error view path pp buffer setBooleanProperty ERROR_OCCURRED true catch WorkThread Abort buffer setBooleanProperty ERROR_OCCURRED true private void read Buffer buffer InputStream long length throws IOException IntegerArray endOffsets new IntegerArray boolean trackProgress length File file buffer getFile setProgressValue setProgressMaximum int length if length length IOBUFSIZE SegmentBuffer seg new SegmentBuffer int length InputStreamReader in new InputStreamReader buffer getStringProperty Buffer ENCODING char buf new char IOBUFSIZE int len boolean CRLF false boolean CROnly false boolean lastWasCR false int lineCount while len in read buf buf length int lastLine for int len switch buf case if lastWasCR CROnly true CRLF false else lastWasCR true seg append buf lastLine lastLine endOffsets add seg count seg append if trackProgress lineCount PROGRESS_INTERVAL setProgressValue seg count lastLine break case if lastWasCR CROnly false CRLF true lastWasCR false lastLine else CROnly false CRLF false seg append buf lastLine lastLine endOffsets add seg count seg append if trackProgress lineCount PROGRESS_INTERVAL setProgressValue seg count lastLine break default if lastWasCR CROnly true CRLF false lastWasCR false break if trackProgress setProgressValue seg count seg append buf lastLine len lastLine setAbortable false String lineSeparator if CRLF lineSeparator else if CROnly lineSeparator else lineSeparator in close int bufferLength seg count if bufferLength char ch seg array bufferLength seg count buffer setBooleanProperty Buffer TRAILING_EOL false if bufferLength char ch seg array bufferLength if ch buffer setBooleanProperty Buffer TRAILING_EOL true seg count endOffsets setSize endOffsets getSize buffer setProperty LOAD_DATA seg buffer setProperty END_OFFSETS endOffsets buffer setProperty NEW_PATH path buffer setProperty Buffer LINESEP lineSeparator private void readMarkers Buffer buffer InputStream throws IOException buffer removeAllMarkers BufferedReader in new BufferedReader new InputStreamReader String line while line in readLine null if line startsWith continue char shortcut line charAt int start line indexOf int end line indexOf start int position Integer parseInt line substring start end buffer addMarker shortcut position in close private void save OutputStream out null try String args vfs getFileName path setStatus jEdit getProperty args setAbortable true try path vfs session path view buffer readLock if buffer getProperty Buffer BACKED_UP null jEdit getBooleanProperty vfs session path view buffer setBooleanProperty Buffer BACKED_UP true String savePath boolean twoStageSave vfs getCapabilities VFS RENAME_CAP jEdit getBooleanProperty if twoStageSave savePath MiscUtilities constructPath vfs getParentOfPath path vfs getFileName path else savePath path out vfs session savePath view if out null if savePath endsWith buffer setBooleanProperty Buffer GZIPPED true if buffer getBooleanProperty Buffer GZIPPED out new GZIPOutputStream out write buffer out if twoStageSave if vfs session savePath path view throw new IOException path else buffer setBooleanProperty ERROR_OCCURRED true if vfs getCapabilities VFS DELETE_CAP if jEdit getBooleanProperty buffer getMarkers size setStatus jEdit getProperty args setProgressValue out vfs session markersPath view if out null writeMarkers buffer out else vfs session markersPath view catch IOException io Log log Log ERROR this io String pp io toString VFSManager error view path pp buffer setBooleanProperty ERROR_OCCURRED true finally buffer readUnlock catch WorkThread Abort if out null try out close catch IOException io buffer setBooleanProperty ERROR_OCCURRED true finally try vfs session buffer view vfs session view catch IOException io Log log Log ERROR this io String pp io toString VFSManager error view path pp buffer setBooleanProperty ERROR_OCCURRED true catch WorkThread Abort buffer setBooleanProperty ERROR_OCCURRED true private void autosave OutputStream out null try String args vfs getFileName path setStatus jEdit getProperty args setAbortable true try if buffer isDirty return out vfs session path view if out null return write buffer out catch Exception finally catch WorkThread Abort if out null try out close catch IOException io private void write Buffer buffer OutputStream throws IOException BufferedWriter out new BufferedWriter new OutputStreamWriter buffer getStringProperty Buffer ENCODING IOBUFSIZE Segment lineSegment new Segment String newline buffer getStringProperty Buffer LINESEP if newline null newline System getProperty setProgressMaximum buffer getLineCount PROGRESS_INTERVAL setProgressValue int while buffer getLineCount buffer getLineText lineSegment out write lineSegment array lineSegment offset lineSegment count if buffer getLineCount buffer getBooleanProperty Buffer TRAILING_EOL out write newline if PROGRESS_INTERVAL setProgressValue PROGRESS_INTERVAL out close private void writeMarkers Buffer buffer OutputStream out throws IOException Writer new BufferedWriter new OutputStreamWriter out Vector markers buffer getMarkers for int markers size Marker marker Marker markers elementAt write write marker getShortcut write String pos String valueOf marker getPosition write pos write write pos write close private void insert InputStream in null try try String args vfs getFileName path setStatus jEdit getProperty args setAbortable true path vfs session path view VFS DirectoryEntry entry vfs session path view long length if entry null length entry length else length in vfs session path false view if in null return if path endsWith in new GZIPInputStream in read buffer in length catch IOException io Log log Log ERROR this io String pp io toString VFSManager error view path pp buffer setBooleanProperty ERROR_OCCURRED true catch WorkThread Abort if in null try in close catch IOException io buffer setBooleanProperty ERROR_OCCURRED true finally try vfs session view catch IOException io Log log Log ERROR this io String pp io toString VFSManager error view path pp buffer setBooleanProperty ERROR_OCCURRED true catch WorkThread Abort buffer setBooleanProperty ERROR_OCCURRED true public class Macros public static void message Component comp String message GUIUtilities hideSplashScreen JOptionPane showMessageDialog comp message jEdit getProperty JOptionPane INFORMATION_MESSAGE public static void error Component comp String message GUIUtilities hideSplashScreen JOptionPane showMessageDialog comp message jEdit getProperty JOptionPane ERROR_MESSAGE public static String input Component comp String prompt GUIUtilities hideSplashScreen return input comp prompt null public static String input Component comp String prompt String defaultValue GUIUtilities hideSplashScreen return String JOptionPane showInputDialog comp prompt jEdit getProperty JOptionPane QUESTION_MESSAGE null null defaultValue public static int confirm Component comp String prompt int buttons GUIUtilities hideSplashScreen return JOptionPane showConfirmDialog comp prompt jEdit getProperty buttons JOptionPane QUESTION_MESSAGE public static int confirm Component comp String prompt int buttons int type GUIUtilities hideSplashScreen return JOptionPane showConfirmDialog comp prompt jEdit getProperty buttons type public static void browseSystemMacros View view if systemMacroPath null GUIUtilities error view null return VFSBrowser browseDirectory view systemMacroPath public static void browseUserMacros View view if userMacroPath null GUIUtilities error view null return VFSBrowser browseDirectory view userMacroPath public static void loadMacros macroActionSet removeAllActions macroHierarchy removeAllElements macroHash clear if jEdit getJEditHome null systemMacroPath MiscUtilities constructPath jEdit getJEditHome loadMacros macroHierarchy new File systemMacroPath String settings jEdit getSettingsDirectory if settings null userMacroPath MiscUtilities constructPath settings loadMacros macroHierarchy new File userMacroPath EditBus send new MacrosChanged null public static void registerHandler Handler handler if getHandler handler getName null Log log Log ERROR Macros class return Log log Log DEBUG Macros class handler getName macroHandlers add handler public static Handler getHandlers Handler handlers new Handler macroHandlers size return Handler macroHandlers toArray handlers public static Handler getHandler String name Handler handler null for int macroHandlers size handler Handler macroHandlers get if handler getName equals name return handler return null public static Vector getMacroHierarchy return macroHierarchy public static ActionSet getMacroActionSet return macroActionSet public static Macro getMacro String macro return Macro macroHash get macro public static class Macro extends EditAction public Macro Handler handler String name String label String path super name this handler handler this label label this path path public Handler getHandler return handler public String getLabel return label public String getMouseOverText return handler getLabel path public String getPath return path public void invoke View view lastMacro this Buffer buffer view getBuffer try buffer beginCompoundEdit handler runMacro view this finally if buffer insideCompoundEdit buffer endCompoundEdit public String getCode return getName public static String macroNameToLabel String macroName int index macroName lastIndexOf return macroName substring index replace private Handler handler private String path private String label public static void recordTemporaryMacro View view String settings jEdit getSettingsDirectory if settings null GUIUtilities error view new String return if view getMacroRecorder null GUIUtilities error view new String return Buffer buffer jEdit openFile null settings File separator true null if buffer null return buffer remove buffer getLength buffer insert jEdit getProperty recordMacro view buffer true public static void recordMacro View view String settings jEdit getSettingsDirectory if settings null GUIUtilities error view new String return if view getMacroRecorder null GUIUtilities error view new String return String name GUIUtilities input view null if name null return name name replace Buffer buffer jEdit openFile null null MiscUtilities constructPath settings name true null if buffer null return buffer remove buffer getLength buffer insert jEdit getProperty recordMacro view buffer false public static void stopRecording View view InputHandler inputHandler view getInputHandler Recorder recorder view getMacroRecorder if recorder null GUIUtilities error view null else view setMacroRecorder null if recorder temporary view setBuffer recorder buffer recorder dispose public static void runTemporaryMacro View view String settings jEdit getSettingsDirectory if settings null GUIUtilities error view new String return String path MiscUtilities constructPath jEdit getSettingsDirectory Handler handler getHandler Macro temp handler createMacro path path Buffer buffer view getBuffer try buffer beginCompoundEdit temp invoke view finally if buffer insideCompoundEdit buffer endCompoundEdit public static void runLastMacro View view if lastMacro null view getToolkit beep else lastMacro invoke view public static void showRunScriptDialog View view String paths GUIUtilities showVFSFileDialog view null JFileChooser OPEN_DIALOG true if paths null Buffer buffer view getBuffer try buffer beginCompoundEdit file_loop for int paths length String path paths Handler handler for int macroHandlers size handler Handler macroHandlers get if handler accept path Macro macro handler createMacro path path macro invoke view continue file_loop Log log Log WARNING Macros class path getHandler createMacro path path invoke view finally buffer endCompoundEdit private static String systemMacroPath private static String userMacroPath private static ArrayList macroHandlers private static ActionSet macroActionSet private static Vector macroHierarchy private static Hashtable macroHash private static Macro lastMacro static macroHandlers new ArrayList registerHandler new BeanShellHandler macroActionSet new ActionSet jEdit getProperty jEdit addActionSet macroActionSet macroHierarchy new Vector macroHash new Hashtable private static void loadMacros Vector vector String path File directory File macroFiles directory listFiles if macroFiles null macroFiles length return MiscUtilities quicksort macroFiles new MiscUtilities StringICaseCompare for int macroFiles length File file macroFiles String fileName file getName if file isHidden continue else if file isDirectory Vector submenu new Vector submenu addElement fileName replace loadMacros submenu path fileName file if submenu size vector addElement submenu else Handler handler for int macroHandlers size handler Handler macroHandlers get try if handler accept fileName Macro newMacro handler createMacro path fileName file getPath vector addElement newMacro macroActionSet addAction newMacro macroHash put newMacro getName newMacro break catch Exception Log log Log ERROR Macros class macroHandlers remove handler continue private static void recordMacro View view Buffer buffer boolean temporary Handler handler getHandler String path buffer getPath lastMacro handler createMacro path path view setMacroRecorder new Recorder view buffer temporary view getStatus setMessage null public static class Recorder implements EBComponent View view Buffer buffer boolean temporary boolean lastWasInput public Recorder View view Buffer buffer boolean temporary this view view this buffer buffer this temporary temporary EditBus addToBus this public void record String code if lastWasInput lastWasInput false append append append code public void record int repeat String code if repeat record code else record repeat code public void record int repeat char ch if ch record repeat else if ch record repeat else StringBuffer buf new StringBuffer for int repeat buf append ch String charStr MiscUtilities charsToEscapes buf toString if lastWasInput append charStr else append charStr lastWasInput true public void handleMessage EBMessage msg if msg instanceof BufferUpdate BufferUpdate bmsg BufferUpdate msg if bmsg getWhat BufferUpdate CLOSED if bmsg getBuffer buffer stopRecording view private void append String str buffer insert buffer getLength str private void dispose if lastWasInput lastWasInput false append for int buffer getLineCount buffer indentLine true true EditBus removeFromBus this view getStatus setMessage null public static abstract class Handler public String getName return name public String getLabel return label public boolean accept String name return filter isMatch name public abstract Macro createMacro String macroName String path public abstract void runMacro View view Macro macro protected Handler String name this name name label jEdit getProperty name name try filter new RE MiscUtilities globToRE jEdit getProperty name catch Exception throw new InternalError name private String name private String label private RE filter static class BeanShellHandler extends Handler BeanShellHandler super public Macro createMacro String macroName String path macroName macroName substring macroName length return new Macro this macroName Macro macroNameToLabel macroName path public void runMacro View view Macro macro BeanShell runScript view macro getPath null true public interface BufferChangeListener void foldLevelChanged Buffer buffer int startLine int endLine void contentInserted Buffer buffer int startLine int offset int numLines int length void contentRemoved Buffer buffer int startLine int offset int numLines int length void transactionComplete Buffer buffer public class OverviewOptionPane extends AbstractOptionPane public OverviewOptionPane super public void setLayout new BorderLayout JEditorPane ep new JEditorPane try ep setPage getClass getResource catch IOException io Log log Log ERROR this io ep setEditable false JScrollPane scroller new JScrollPane ep scroller setPreferredSize new Dimension add BorderLayout CENTER scroller public void public class FontSelector extends JButton public FontSelector Font font setFont font updateText setRequestFocusEnabled false addActionListener new ActionHandler private void updateText Font font getFont String styleString switch font getStyle case Font PLAIN styleString jEdit getProperty break case Font BOLD styleString jEdit getProperty break case Font ITALIC styleString jEdit getProperty break case Font BOLD Font ITALIC styleString jEdit getProperty break default styleString break setText font getName font getSize styleString class ActionHandler implements ActionListener public void actionPerformed ActionEvent evt Font font new FontSelectorDialog FontSelector this getFont getSelectedFont if font null setFont font updateText class FontSelectorDialog extends EnhancedDialog public FontSelectorDialog Component comp Font font super JOptionPane getFrameForComponent comp jEdit getProperty true JPanel content new JPanel new BorderLayout content setBorder new EmptyBorder setContentPane content JPanel listPanel new JPanel new GridLayout JPanel familyPanel createTextFieldAndListPanel familyField new JTextField familyList new JList getFontList listPanel add familyPanel String sizes JPanel sizePanel createTextFieldAndListPanel sizeField new JTextField sizeList new JList sizes listPanel add sizePanel String styles jEdit getProperty jEdit getProperty jEdit getProperty jEdit getProperty JPanel stylePanel createTextFieldAndListPanel styleField new JTextField styleList new JList styles styleField setEditable false listPanel add stylePanel familyList setSelectedValue font getFamily true familyField setText font getFamily sizeList setSelectedValue String valueOf font getSize true sizeField setText String valueOf font getSize styleList setSelectedIndex font getStyle styleField setText String styleList getSelectedValue ListHandler listHandler new ListHandler familyList addListSelectionListener listHandler sizeList addListSelectionListener listHandler styleList addListSelectionListener listHandler content add BorderLayout NORTH listPanel preview new JLabel jEdit getProperty preview setBorder new TitledBorder jEdit getProperty updatePreview Dimension prefSize preview getPreferredSize prefSize height preview setPreferredSize prefSize content add BorderLayout CENTER preview JPanel buttons new JPanel buttons setLayout new BoxLayout buttons BoxLayout X_AXIS buttons setBorder new EmptyBorder buttons add Box createGlue ok new JButton jEdit getProperty ok addActionListener new ActionHandler getRootPane setDefaultButton ok buttons add ok buttons add Box createHorizontalStrut cancel new JButton jEdit getProperty cancel addActionListener new ActionHandler buttons add cancel buttons add Box createGlue content add BorderLayout SOUTH buttons pack setLocationRelativeTo JOptionPane getFrameForComponent comp show public void ok isOK true dispose public void cancel dispose public Font getSelectedFont if isOK return null int size try size Integer parseInt sizeField getText catch Exception size return new Font familyField getText styleList getSelectedIndex size private boolean isOK private JTextField familyField private JList familyList private JTextField sizeField private JList sizeList private JTextField styleField private JList styleList private JLabel preview private JButton ok private JButton cancel private static final String HIDEFONTS private String getFontList String nameArray GraphicsEnvironment getLocalGraphicsEnvironment getAvailableFontFamilyNames Vector nameVector new Vector nameArray length for int nameArray length for HIDEFONTS length if nameArray indexOf HIDEFONTS break if HIDEFONTS length nameVector addElement nameArray String new String nameVector size nameVector copyInto return private JPanel createTextFieldAndListPanel String label JTextField textField JList list GridBagLayout layout new GridBagLayout JPanel panel new JPanel layout GridBagConstraints cons new GridBagConstraints cons gridx cons gridy cons gridwidth cons gridheight cons fill GridBagConstraints BOTH cons weightx JLabel new JLabel jEdit getProperty label layout setConstraints cons panel add cons gridy Component vs Box createVerticalStrut layout setConstraints vs cons panel add vs cons gridy layout setConstraints textField cons panel add textField cons gridy vs Box createVerticalStrut layout setConstraints vs cons panel add vs cons gridy cons gridheight GridBagConstraints REMAINDER cons weighty JScrollPane scroller new JScrollPane list layout setConstraints scroller cons panel add scroller return panel private void updatePreview String family familyField getText int size try size Integer parseInt sizeField getText catch Exception size int style styleList getSelectedIndex preview setFont new Font family style size class ActionHandler implements ActionListener public void actionPerformed ActionEvent evt if evt getSource ok ok else if evt getSource cancel cancel class ListHandler implements ListSelectionListener public void valueChanged ListSelectionEvent evt Object source evt getSource if source familyList String family String familyList getSelectedValue if family null familyField setText family else if source sizeList String size String sizeList getSelectedValue if size null sizeField setText size else if source styleList String style String styleList getSelectedValue if style null styleField setText style updatePreview public abstract class TextAreaExtension public void paintValidLine Graphics2D gfx int screenLine public void paintInvalidLine Graphics2D gfx int screenLine public String getToolTipText int int return null public interface ParserTreeConstants public int JJTVOID public int JJTMETHODDECLARATION public int JJTIMPORTDECLARATION public int JJTVARIABLEDECLARATOR public int JJTARRAYINITIALIZER public int JJTFORMALPARAMETERS public int JJTFORMALPARAMETER public int JJTTYPE public int JJTRETURNTYPE public int JJTPRIMITIVETYPE public int JJTAMBIGUOUSNAME public int JJTASSIGNMENT public int JJTTERNARYEXPRESSION public int JJTBINARYEXPRESSION public int JJTUNARYEXPRESSION public int JJTCASTEXPRESSION public int JJTPRIMARYEXPRESSION public int JJTMETHODINVOCATION public int JJTPRIMARYSUFFIX public int JJTLHSPRIMARYEXPRESSION public int JJTLHSPRIMARYSUFFIX public int JJTLITERAL public int JJTARGUMENTS public int JJTALLOCATIONEXPRESSION public int JJTARRAYDIMENSIONS public int JJTBLOCK public int JJTSWITCHSTATEMENT public int JJTSWITCHLABEL public int JJTIFSTATEMENT public int JJTWHILESTATEMENT public int JJTFORSTATEMENT public int JJTTYPEDVARIABLEDECLARATION public int JJTSTATEMENTEXPRESSIONLIST public int JJTRETURNSTATEMENT public int JJTTHROWSTATEMENT public int JJTTRYSTATEMENT public String jjtNodeName public class SearchAndReplace public static void setSearchString String search if search equals SearchAndReplace search return SearchAndReplace search search matcher null EditBus send new SearchSettingsChanged null public static String getSearchString return search public static void setReplaceString String replace if replace equals SearchAndReplace replace return SearchAndReplace replace replace matcher null EditBus send new SearchSettingsChanged null public static String getReplaceString return replace public static void setIgnoreCase boolean ignoreCase if ignoreCase SearchAndReplace ignoreCase return SearchAndReplace ignoreCase ignoreCase matcher null EditBus send new SearchSettingsChanged null public static boolean getIgnoreCase return ignoreCase public static void setRegexp boolean regexp if regexp SearchAndReplace regexp return SearchAndReplace regexp regexp if regexp reverse reverse false matcher null EditBus send new SearchSettingsChanged null public static boolean getRegexp return regexp public static void setReverseSearch boolean reverse if reverse SearchAndReplace reverse return SearchAndReplace reverse regexp false reverse matcher null EditBus send new SearchSettingsChanged null public static boolean getReverseSearch return reverse public static void setBeanShellReplace boolean beanshell if beanshell SearchAndReplace beanshell return SearchAndReplace beanshell beanshell matcher null EditBus send new SearchSettingsChanged null public static boolean getBeanShellReplace return beanshell public static void setAutoWrapAround boolean wrap if wrap SearchAndReplace wrap return SearchAndReplace wrap wrap EditBus send new SearchSettingsChanged null public static boolean getAutoWrapAround return wrap public static void setSearchMatcher SearchMatcher matcher SearchAndReplace matcher matcher EditBus send new SearchSettingsChanged null public static SearchMatcher getSearchMatcher throws Exception return getSearchMatcher true public static SearchMatcher getSearchMatcher boolean reverseOK throws Exception reverseOK fileset instanceof CurrentBufferSet if matcher null reverseOK reverse return matcher if search null equals search return null String replace SearchAndReplace replace null SearchAndReplace replace String replaceMethod if beanshell replace length replaceMethod BeanShell cacheBlock replace false else replaceMethod null if regexp matcher new RESearchMatcher search replace ignoreCase beanshell replaceMethod else matcher new BoyerMooreSearchMatcher search replace ignoreCase reverse reverseOK beanshell replaceMethod return matcher public static void setSearchFileSet SearchFileSet fileset SearchAndReplace fileset fileset EditBus send new SearchSettingsChanged null public static SearchFileSet getSearchFileSet return fileset public static boolean hyperSearch View view return hyperSearch view false public static boolean hyperSearch View view boolean selection record view selection false selection view getDockableWindowManager addDockableWindow HyperSearchResults NAME final HyperSearchResults results HyperSearchResults view getDockableWindowManager getDockable HyperSearchResults NAME results searchStarted try SearchMatcher matcher getSearchMatcher false if matcher null view getToolkit beep results searchDone return false Selection if selection view getTextArea getSelection if null results searchDone return false else null VFSManager runInWorkThread new HyperSearchRequest view matcher results return true catch Exception Log log Log ERROR SearchAndReplace class Object args getMessage if args null args toString GUIUtilities error view args return false public static boolean find View view boolean repeat false String path fileset getNextFile view null if path null return false try SearchMatcher matcher getSearchMatcher true if matcher null view getToolkit beep return false record view false true view showWaitCursor loop for while path null Buffer buffer jEdit openTemporary view null path false path fileset getNextFile view path if buffer null continue loop if buffer isLoaded VFSManager waitForRequests int start if view getBuffer buffer repeat JEditTextArea textArea view getTextArea Selection textArea getSelectionAtOffset textArea getCaretPosition if null start textArea getCaretPosition else if reverse start getStart else start getEnd else if reverse start buffer getLength else start if find view buffer start repeat return true if repeat if BeanShell isScriptRunning view getStatus setMessageAndClear jEdit getProperty view getToolkit beep return false boolean restart if BeanShell isScriptRunning restart true else if wrap view getStatus setMessageAndClear jEdit getProperty if jEdit getBooleanProperty view getToolkit beep restart true else Integer args new Integer reverse int result GUIUtilities confirm view args JOptionPane YES_NO_OPTION JOptionPane QUESTION_MESSAGE restart result JOptionPane YES_OPTION if restart path fileset getFirstFile view repeat true else break loop catch Exception Log log Log ERROR SearchAndReplace class Object args getMessage if args null args toString GUIUtilities error view args finally view hideWaitCursor return false public static boolean find View view Buffer buffer int start throws Exception return find view buffer start false public static boolean find View view Buffer buffer int start boolean firstTime throws Exception SearchMatcher matcher getSearchMatcher true if matcher null view getToolkit beep return false Segment text new Segment if reverse buffer getText start text else buffer getText start buffer getLength start text int match matcher nextMatch new CharIndexedSegment text reverse start true firstTime if match null jEdit commitTemporary buffer view setBuffer buffer JEditTextArea textArea view getTextArea if reverse textArea setSelection new Selection Range start match start match textArea moveCaretPosition start match else textArea setSelection new Selection Range start match start match textArea moveCaretPosition start match return true else return false public static boolean replace View view JEditTextArea textArea view getTextArea Buffer buffer view getBuffer if buffer isEditable return false boolean smartCaseReplace replace null TextUtilities getStringCase replace TextUtilities LOWER_CASE Selection selection textArea getSelection if selection length view getToolkit beep return false record view true false try buffer beginCompoundEdit SearchMatcher matcher getSearchMatcher false if matcher null return false int retVal for int selection length Selection selection int start getStart if instanceof Selection Range retVal view buffer matcher getStart getEnd smartCaseReplace textArea removeFromSelection textArea addToSelection new Selection Range start getEnd else if instanceof Selection Rect for int getStartLine getEndLine retVal view buffer matcher getStart buffer getEnd buffer smartCaseReplace textArea addToSelection new Selection Rect start getEnd Selection textArea getSelectionAtOffset textArea getCaretPosition if null textArea moveCaretPosition getEnd if retVal view getToolkit beep return false return true catch Exception Log log Log ERROR SearchAndReplace class Object args getMessage if args null args toString GUIUtilities error view args finally buffer endCompoundEdit return false public static boolean replace View view Buffer buffer int start int end if buffer isEditable return false boolean smartCaseReplace replace null TextUtilities getStringCase replace TextUtilities LOWER_CASE JEditTextArea textArea view getTextArea try buffer beginCompoundEdit SearchMatcher matcher getSearchMatcher false if matcher null return false int retVal retVal view buffer matcher start end smartCaseReplace if retVal return true catch Exception Log log Log ERROR SearchAndReplace class Object args getMessage if args null args toString GUIUtilities error view args finally buffer endCompoundEdit return false public static boolean replaceAll View view int fileCount int occurCount record view true true view showWaitCursor boolean smartCaseReplace replace null TextUtilities getStringCase replace TextUtilities LOWER_CASE try SearchMatcher matcher getSearchMatcher false if matcher null return false String path fileset getFirstFile view loop while path null Buffer buffer jEdit openTemporary view null path false path fileset getNextFile view path if buffer null continue loop if buffer isPerformingIO VFSManager waitForRequests if buffer isEditable continue loop int retVal try buffer beginCompoundEdit retVal view buffer matcher buffer getLength smartCaseReplace finally buffer endCompoundEdit if retVal fileCount occurCount retVal jEdit commitTemporary buffer catch Exception Log log Log ERROR SearchAndReplace class Object args getMessage if args null args toString GUIUtilities error view args finally view hideWaitCursor if BeanShell isScriptRunning Object args new Integer occurCount new Integer fileCount view getStatus setMessageAndClear jEdit getProperty args if occurCount view getToolkit beep return fileCount public static void load search jEdit getProperty replace jEdit getProperty ignoreCase jEdit getBooleanProperty regexp jEdit getBooleanProperty beanshell jEdit getBooleanProperty wrap jEdit getBooleanProperty fileset new CurrentBufferSet matcher null EditBus send new SearchSettingsChanged null public static void save jEdit setProperty search jEdit setProperty replace jEdit setBooleanProperty ignoreCase jEdit setBooleanProperty regexp jEdit setBooleanProperty beanshell jEdit setBooleanProperty wrap private static String search private static String replace private static boolean regexp private static boolean ignoreCase private static boolean reverse private static boolean beanshell private static boolean wrap private static SearchMatcher matcher private static SearchFileSet fileset private static void record View view String action boolean replaceAction boolean recordFileSet Macros Recorder recorder view getMacroRecorder if recorder null recorder record MiscUtilities charsToEscapes search if replaceAction recorder record MiscUtilities charsToEscapes replace recorder record beanshell else recorder record wrap recorder record reverse recorder record ignoreCase recorder record regexp if recordFileSet recorder record fileset getCode recorder record action private static int View view Buffer buffer SearchMatcher matcher int start int end boolean smartCaseReplace throws Exception int occurCount boolean endOfLine buffer getLineEndOffset buffer getLineOfOffset end end Segment text new Segment int offset start loop for int counter counter buffer getText offset end offset text boolean startOfLine buffer getLineStartOffset buffer getLineOfOffset offset offset int occur matcher nextMatch new CharIndexedSegment text false startOfLine endOfLine counter if occur null break loop int occur int occur occur String found new String text array text offset String subst matcher substitute found if smartCaseReplace ignoreCase int strCase TextUtilities getStringCase found if strCase TextUtilities LOWER_CASE subst subst toLowerCase else if strCase TextUtilities UPPER_CASE subst subst toUpperCase else if strCase TextUtilities TITLE_CASE subst TextUtilities toTitleCase subst if subst null buffer remove offset buffer insert offset subst occurCount offset subst length end subst length found length else offset return occurCount class ParserTokenManager implements ParserConstants private final int jjStopStringLiteralDfa_0 int pos long active0 long active1 switch pos case if active0 return if active1 return if active1 return if active0 jjmatchedKind return return case if active0 if jjmatchedPos jjmatchedKind jjmatchedPos return if active0 return return case if active0 if jjmatchedPos jjmatchedKind jjmatchedPos return if active0 return return case if active0 return if active0 if jjmatchedPos jjmatchedKind jjmatchedPos return return case if active0 if jjmatchedPos jjmatchedKind jjmatchedPos return if active0 return return case if active0 jjmatchedKind jjmatchedPos return if active0 return return case if active0 return if active0 jjmatchedKind jjmatchedPos return return case if active0 jjmatchedKind jjmatchedPos return if active0 return return case if active0 jjmatchedKind jjmatchedPos return if active0 return return case if active0 return return default return private final int jjStartNfa_0 int pos long active0 long active1 return jjMoveNfa_0 jjStopStringLiteralDfa_0 pos active0 active1 pos private final int jjStopAtPos int pos int kind jjmatchedKind kind jjmatchedPos pos return pos private final int jjStartNfaWithStates_0 int pos int kind int state jjmatchedKind kind jjmatchedPos pos try curChar input_stream readChar catch java io IOException return pos return jjMoveNfa_0 state pos private final int jjMoveStringLiteralDfa0_0 switch curChar case return jjStartNfaWithStates_0 case return jjStartNfaWithStates_0 case return jjStartNfaWithStates_0 case return jjStartNfaWithStates_0 case return jjStartNfaWithStates_0 case jjmatchedKind return jjMoveStringLiteralDfa1_0 case jjmatchedKind return jjMoveStringLiteralDfa1_0 case jjmatchedKind return jjMoveStringLiteralDfa1_0 case return jjStopAtPos case return jjStopAtPos case jjmatchedKind return jjMoveStringLiteralDfa1_0 case jjmatchedKind return jjMoveStringLiteralDfa1_0 case return jjStopAtPos case jjmatchedKind return jjMoveStringLiteralDfa1_0 case return jjStartNfaWithStates_0 case jjmatchedKind return jjMoveStringLiteralDfa1_0 case return jjStopAtPos case return jjStopAtPos case jjmatchedKind return jjMoveStringLiteralDfa1_0 case jjmatchedKind return jjMoveStringLiteralDfa1_0 case jjmatchedKind return jjMoveStringLiteralDfa1_0 case return jjStopAtPos case return jjMoveStringLiteralDfa1_0 case return jjStopAtPos case return jjStopAtPos case jjmatchedKind return jjMoveStringLiteralDfa1_0 case return jjMoveStringLiteralDfa1_0 case return jjMoveStringLiteralDfa1_0 case return jjMoveStringLiteralDfa1_0 case return jjMoveStringLiteralDfa1_0 case return jjMoveStringLiteralDfa1_0 case return jjMoveStringLiteralDfa1_0 case return jjMoveStringLiteralDfa1_0 case return jjMoveStringLiteralDfa1_0 case return jjMoveStringLiteralDfa1_0 case return jjMoveStringLiteralDfa1_0 case return jjMoveStringLiteralDfa1_0 case return jjMoveStringLiteralDfa1_0 case return jjMoveStringLiteralDfa1_0 case return jjMoveStringLiteralDfa1_0 case return jjMoveStringLiteralDfa1_0 case return jjStopAtPos case jjmatchedKind return jjMoveStringLiteralDfa1_0 case return jjStopAtPos case return jjStopAtPos default return jjMoveNfa_0 private final int jjMoveStringLiteralDfa1_0 long active0 long active1 try curChar input_stream readChar catch java io IOException jjStopStringLiteralDfa_0 active0 active1 return switch curChar case if active1 return jjStopAtPos break case if active1 return jjStopAtPos break case if active1 return jjStopAtPos break case if active1 jjmatchedKind jjmatchedPos return jjMoveStringLiteralDfa2_0 active0 active1 case if active1 return jjStopAtPos else if active1 return jjStopAtPos else if active1 return jjStopAtPos else if active1 return jjStopAtPos else if active1 return jjStopAtPos else if active1 return jjStopAtPos else if active1 return jjStopAtPos else if active1 return jjStopAtPos else if active1 return jjStopAtPos else if active1 return jjStopAtPos else if active1 return jjStopAtPos else if active1 return jjStopAtPos break case if active1 jjmatchedKind jjmatchedPos return jjMoveStringLiteralDfa2_0 active0 active1 case return jjMoveStringLiteralDfa2_0 active0 active1 case return jjMoveStringLiteralDfa2_0 active0 active1 case return jjMoveStringLiteralDfa2_0 active0 active1 case if active0 return jjStartNfaWithStates_0 break case return jjMoveStringLiteralDfa2_0 active0 active1 case return jjMoveStringLiteralDfa2_0 active0 active1 case return jjMoveStringLiteralDfa2_0 active0 active1 case return jjMoveStringLiteralDfa2_0 active0 active1 case return jjMoveStringLiteralDfa2_0 active0 active1 case return jjMoveStringLiteralDfa2_0 active0 active1 case if active0 jjmatchedKind jjmatchedPos return jjMoveStringLiteralDfa2_0 active0 active1 case return jjMoveStringLiteralDfa2_0 active0 active1 case return jjMoveStringLiteralDfa2_0 active0 active1 case return jjMoveStringLiteralDfa2_0 active0 active1 case return jjMoveStringLiteralDfa2_0 active0 active1 case return jjMoveStringLiteralDfa2_0 active0 active1 case if active1 return jjStopAtPos break default break return jjStartNfa_0 active0 active1 private final int jjMoveStringLiteralDfa2_0 long old0 long active0 long old1 long active1 if active0 old0 active1 old1 return jjStartNfa_0 old0 old1 try curChar input_stream readChar catch java io IOException jjStopStringLiteralDfa_0 active0 active1 return switch curChar case if active1 return jjStopAtPos else if active1 return jjStopAtPos break case if active1 jjmatchedKind jjmatchedPos return jjMoveStringLiteralDfa3_0 active0 active1 case return jjMoveStringLiteralDfa3_0 active0 active1 case return jjMoveStringLiteralDfa3_0 active0 active1 case return jjMoveStringLiteralDfa3_0 active0 active1 case return jjMoveStringLiteralDfa3_0 active0 active1 case return jjMoveStringLiteralDfa3_0 active0 active1 case return jjMoveStringLiteralDfa3_0 active0 active1 case return jjMoveStringLiteralDfa3_0 active0 active1 case return jjMoveStringLiteralDfa3_0 active0 active1 case return jjMoveStringLiteralDfa3_0 active0 active1 case if active0 return jjStartNfaWithStates_0 else if active1 jjmatchedKind jjmatchedPos return jjMoveStringLiteralDfa3_0 active0 active1 case return jjMoveStringLiteralDfa3_0 active0 active1 case if active0 jjmatchedKind jjmatchedPos else if active1 jjmatchedKind jjmatchedPos else if active1 jjmatchedKind jjmatchedPos return jjMoveStringLiteralDfa3_0 active0 active1 case return jjMoveStringLiteralDfa3_0 active0 active1 case if active0 return jjStartNfaWithStates_0 break case if active0 return jjStartNfaWithStates_0 break default break return jjStartNfa_0 active0 active1 private final int jjMoveStringLiteralDfa3_0 long old0 long active0 long old1 long active1 if active0 old0 active1 old1 return jjStartNfa_0 old0 old1 try curChar input_stream readChar catch java io IOException jjStopStringLiteralDfa_0 active0 active1 return switch curChar case if active1 return jjStopAtPos break case return jjMoveStringLiteralDfa4_0 active0 active1 case return jjMoveStringLiteralDfa4_0 active0 active1 case return jjMoveStringLiteralDfa4_0 active0 active1 case return jjMoveStringLiteralDfa4_0 active0 active1 case if active0 return jjStartNfaWithStates_0 else if active1 jjmatchedKind jjmatchedPos return jjMoveStringLiteralDfa4_0 active0 active1 case if active0 return jjStartNfaWithStates_0 else if active0 return jjStartNfaWithStates_0 else if active0 return jjStartNfaWithStates_0 else if active0 return jjStartNfaWithStates_0 return jjMoveStringLiteralDfa4_0 active0 active1 case return jjMoveStringLiteralDfa4_0 active0 active1 case if active0 return jjStartNfaWithStates_0 return jjMoveStringLiteralDfa4_0 active0 active1 case if active0 return jjStartNfaWithStates_0 return jjMoveStringLiteralDfa4_0 active0 active1 case if active0 return jjStartNfaWithStates_0 return jjMoveStringLiteralDfa4_0 active0 active1 case if active0 return jjStartNfaWithStates_0 return jjMoveStringLiteralDfa4_0 active0 active1 case return jjMoveStringLiteralDfa4_0 active0 active1 case return jjMoveStringLiteralDfa4_0 active0 active1 case return jjMoveStringLiteralDfa4_0 active0 active1 case return jjMoveStringLiteralDfa4_0 active0 active1 default break return jjStartNfa_0 active0 active1 private final int jjMoveStringLiteralDfa4_0 long old0 long active0 long old1 long active1 if active0 old0 active1 old1 return jjStartNfa_0 old0 old1 try curChar input_stream readChar catch java io IOException jjStopStringLiteralDfa_0 active0 active1 return switch curChar case return jjMoveStringLiteralDfa5_0 active0 active1 case return jjMoveStringLiteralDfa5_0 active0 active1 case return jjMoveStringLiteralDfa5_0 active0 active1 case if active0 return jjStartNfaWithStates_0 else if active0 return jjStartNfaWithStates_0 return jjMoveStringLiteralDfa5_0 active0 active1 case if active0 return jjStartNfaWithStates_0 return jjMoveStringLiteralDfa5_0 active0 active1 case return jjMoveStringLiteralDfa5_0 active0 active1 case if active0 return jjStartNfaWithStates_0 break case if active0 jjmatchedKind jjmatchedPos return jjMoveStringLiteralDfa5_0 active0 active1 case if active1 return jjStopAtPos else if active1 return jjStopAtPos break case return jjMoveStringLiteralDfa5_0 active0 active1 case if active0 return jjStartNfaWithStates_0 break case if active0 return jjStartNfaWithStates_0 else if active0 return jjStartNfaWithStates_0 else if active0 return jjStartNfaWithStates_0 return jjMoveStringLiteralDfa5_0 active0 active1 case return jjMoveStringLiteralDfa5_0 active0 active1 case if active0 return jjStartNfaWithStates_0 return jjMoveStringLiteralDfa5_0 active0 active1 default break return jjStartNfa_0 active0 active1 private final int jjMoveStringLiteralDfa5_0 long old0 long active0 long old1 long active1 if active0 old0 active1 old1 return jjStartNfa_0 old0 old1 try curChar input_stream readChar catch java io IOException jjStopStringLiteralDfa_0 active0 active1 return switch curChar case return jjMoveStringLiteralDfa6_0 active0 active1 case return jjMoveStringLiteralDfa6_0 active0 active1 case if active0 return jjStartNfaWithStates_0 else if active0 return jjStartNfaWithStates_0 return jjMoveStringLiteralDfa6_0 active0 active1 case if active0 return jjStartNfaWithStates_0 break case return jjMoveStringLiteralDfa6_0 active0 active1 case if active0 return jjStartNfaWithStates_0 break case return jjMoveStringLiteralDfa6_0 active0 active1 case return jjMoveStringLiteralDfa6_0 active0 active1 case if active0 return jjStartNfaWithStates_0 return jjMoveStringLiteralDfa6_0 active0 active1 case return jjMoveStringLiteralDfa6_0 active0 active1 case if active0 return jjStartNfaWithStates_0 return jjMoveStringLiteralDfa6_0 active0 active1 default break return jjStartNfa_0 active0 active1 private final int jjMoveStringLiteralDfa6_0 long old0 long active0 long old1 long active1 if active0 old0 active1 old1 return jjStartNfa_0 old0 old1 try curChar input_stream readChar catch java io IOException jjStopStringLiteralDfa_0 active0 active1 return switch curChar case return jjMoveStringLiteralDfa7_0 active0 active1 case return jjMoveStringLiteralDfa7_0 active0 active1 case return jjMoveStringLiteralDfa7_0 active0 active1 case if active0 return jjStartNfaWithStates_0 break case if active0 return jjStartNfaWithStates_0 break case return jjMoveStringLiteralDfa7_0 active0 active1 case if active0 return jjStartNfaWithStates_0 return jjMoveStringLiteralDfa7_0 active0 active1 case return jjMoveStringLiteralDfa7_0 active0 active1 case if active0 return jjStartNfaWithStates_0 break default break return jjStartNfa_0 active0 active1 private final int jjMoveStringLiteralDfa7_0 long old0 long active0 long old1 long active1 if active0 old0 active1 old1 return jjStartNfa_0 old0 old1 try curChar input_stream readChar catch java io IOException jjStopStringLiteralDfa_0 active0 active1 return switch curChar case return jjMoveStringLiteralDfa8_0 active0 active1 case if active0 return jjStartNfaWithStates_0 return jjMoveStringLiteralDfa8_0 active0 active1 case return jjMoveStringLiteralDfa8_0 active0 active1 case return jjMoveStringLiteralDfa8_0 active0 active1 case return jjMoveStringLiteralDfa8_0 active0 active1 case return jjMoveStringLiteralDfa8_0 active0 active1 default break return jjStartNfa_0 active0 active1 private final int jjMoveStringLiteralDfa8_0 long old0 long active0 long old1 long active1 if active0 old0 active1 old1 return jjStartNfa_0 old0 old1 try curChar input_stream readChar catch java io IOException jjStopStringLiteralDfa_0 active0 active1 return switch curChar case return jjMoveStringLiteralDfa9_0 active0 active1 case if active0 return jjStartNfaWithStates_0 break case if active0 return jjStartNfaWithStates_0 break case return jjMoveStringLiteralDfa9_0 active0 active1 case return jjMoveStringLiteralDfa9_0 active0 active1 case return jjMoveStringLiteralDfa9_0 active0 active1 case return jjMoveStringLiteralDfa9_0 active0 active1 case return jjMoveStringLiteralDfa9_0 active0 active1 default break return jjStartNfa_0 active0 active1 private final int jjMoveStringLiteralDfa9_0 long old0 long active0 long old1 long active1 if active0 old0 active1 old1 return jjStartNfa_0 old0 old1 try curChar input_stream readChar catch java io IOException jjStopStringLiteralDfa_0 active0 active1 return switch curChar case return jjMoveStringLiteralDfa10_0 active0 active1 case if active0 return jjStartNfaWithStates_0 return jjMoveStringLiteralDfa10_0 active0 active1 case return jjMoveStringLiteralDfa10_0 active0 active1 case return jjMoveStringLiteralDfa10_0 active0 active1 case if active1 return jjStopAtPos break case return jjMoveStringLiteralDfa10_0 active0 active1 case return jjMoveStringLiteralDfa10_0 active0 active1 default break return jjStartNfa_0 active0 active1 private final int jjMoveStringLiteralDfa10_0 long old0 long active0 long old1 long active1 if active0 old0 active1 old1 return jjStartNfa_0 old0 old1 try curChar input_stream readChar catch java io IOException jjStopStringLiteralDfa_0 active1 return switch curChar case return jjMoveStringLiteralDfa11_0 active1 case return jjMoveStringLiteralDfa11_0 active1 case if active1 return jjStopAtPos return jjMoveStringLiteralDfa11_0 active1 case if active1 return jjStopAtPos break case if active1 jjmatchedKind jjmatchedPos return jjMoveStringLiteralDfa11_0 active1 default break return jjStartNfa_0 active1 private final int jjMoveStringLiteralDfa11_0 long old1 long active1 if active1 old1 return jjStartNfa_0 old1 try curChar input_stream readChar catch java io IOException jjStopStringLiteralDfa_0 active1 return switch curChar case return jjMoveStringLiteralDfa12_0 active1 case if active1 return jjStopAtPos break case return jjMoveStringLiteralDfa12_0 active1 case if active1 jjmatchedKind jjmatchedPos return jjMoveStringLiteralDfa12_0 active1 default break return jjStartNfa_0 active1 private final int jjMoveStringLiteralDfa12_0 long old1 long active1 if active1 old1 return jjStartNfa_0 old1 try curChar input_stream readChar catch java io IOException jjStopStringLiteralDfa_0 active1 return switch curChar case return jjMoveStringLiteralDfa13_0 active1 case return jjMoveStringLiteralDfa13_0 active1 case return jjMoveStringLiteralDfa13_0 active1 default break return jjStartNfa_0 active1 private final int jjMoveStringLiteralDfa13_0 long old1 long active1 if active1 old1 return jjStartNfa_0 old1 try curChar input_stream readChar catch java io IOException jjStopStringLiteralDfa_0 active1 return switch curChar case return jjMoveStringLiteralDfa14_0 active1 case return jjMoveStringLiteralDfa14_0 active1 case return jjMoveStringLiteralDfa14_0 active1 default break return jjStartNfa_0 active1 private final int jjMoveStringLiteralDfa14_0 long old1 long active1 if active1 old1 return jjStartNfa_0 old1 try curChar input_stream readChar catch java io IOException jjStopStringLiteralDfa_0 active1 return switch curChar case return jjMoveStringLiteralDfa15_0 active1 case return jjMoveStringLiteralDfa15_0 active1 default break return jjStartNfa_0 active1 private final int jjMoveStringLiteralDfa15_0 long old1 long active1 if active1 old1 return jjStartNfa_0 old1 try curChar input_stream readChar catch java io IOException jjStopStringLiteralDfa_0 active1 return switch curChar case return jjMoveStringLiteralDfa16_0 active1 case return jjMoveStringLiteralDfa16_0 active1 case return jjMoveStringLiteralDfa16_0 active1 default break return jjStartNfa_0 active1 private final int jjMoveStringLiteralDfa16_0 long old1 long active1 if active1 old1 return jjStartNfa_0 old1 try curChar input_stream readChar catch java io IOException jjStopStringLiteralDfa_0 active1 return switch curChar case return jjMoveStringLiteralDfa17_0 active1 case return jjMoveStringLiteralDfa17_0 active1 case return jjMoveStringLiteralDfa17_0 active1 default break return jjStartNfa_0 active1 private final int jjMoveStringLiteralDfa17_0 long old1 long active1 if active1 old1 return jjStartNfa_0 old1 try curChar input_stream readChar catch java io IOException jjStopStringLiteralDfa_0 active1 return switch curChar case return jjMoveStringLiteralDfa18_0 active1 case return jjMoveStringLiteralDfa18_0 active1 case if active1 return jjStopAtPos break default break return jjStartNfa_0 active1 private final int jjMoveStringLiteralDfa18_0 long old1 long active1 if active1 old1 return jjStartNfa_0 old1 try curChar input_stream readChar catch java io IOException jjStopStringLiteralDfa_0 active1 return switch curChar case return jjMoveStringLiteralDfa19_0 active1 case if active1 return jjStopAtPos break default break return jjStartNfa_0 active1 private final int jjMoveStringLiteralDfa19_0 long old1 long active1 if active1 old1 return jjStartNfa_0 old1 try curChar input_stream readChar catch java io IOException jjStopStringLiteralDfa_0 active1 return switch curChar case return jjMoveStringLiteralDfa20_0 active1 default break return jjStartNfa_0 active1 private final int jjMoveStringLiteralDfa20_0 long old1 long active1 if active1 old1 return jjStartNfa_0 old1 try curChar input_stream readChar catch java io IOException jjStopStringLiteralDfa_0 active1 return switch curChar case if active1 jjmatchedKind jjmatchedPos return jjMoveStringLiteralDfa21_0 active1 default break return jjStartNfa_0 active1 private final int jjMoveStringLiteralDfa21_0 long old1 long active1 if active1 old1 return jjStartNfa_0 old1 try curChar input_stream readChar catch java io IOException jjStopStringLiteralDfa_0 active1 return switch curChar case return jjMoveStringLiteralDfa22_0 active1 default break return jjStartNfa_0 active1 private final int jjMoveStringLiteralDfa22_0 long old1 long active1 if active1 old1 return jjStartNfa_0 old1 try curChar input_stream readChar catch java io IOException jjStopStringLiteralDfa_0 active1 return switch curChar case return jjMoveStringLiteralDfa23_0 active1 default break return jjStartNfa_0 active1 private final int jjMoveStringLiteralDfa23_0 long old1 long active1 if active1 old1 return jjStartNfa_0 old1 try curChar input_stream readChar catch java io IOException jjStopStringLiteralDfa_0 active1 return switch curChar case return jjMoveStringLiteralDfa24_0 active1 default break return jjStartNfa_0 active1 private final int jjMoveStringLiteralDfa24_0 long old1 long active1 if active1 old1 return jjStartNfa_0 old1 try curChar input_stream readChar catch java io IOException jjStopStringLiteralDfa_0 active1 return switch curChar case return jjMoveStringLiteralDfa25_0 active1 default break return jjStartNfa_0 active1 private final int jjMoveStringLiteralDfa25_0 long old1 long active1 if active1 old1 return jjStartNfa_0 old1 try curChar input_stream readChar catch java io IOException jjStopStringLiteralDfa_0 active1 return switch curChar case return jjMoveStringLiteralDfa26_0 active1 default break return jjStartNfa_0 active1 private final int jjMoveStringLiteralDfa26_0 long old1 long active1 if active1 old1 return jjStartNfa_0 old1 try curChar input_stream readChar catch java io IOException jjStopStringLiteralDfa_0 active1 return switch curChar case return jjMoveStringLiteralDfa27_0 active1 default break return jjStartNfa_0 active1 private final int jjMoveStringLiteralDfa27_0 long old1 long active1 if active1 old1 return jjStartNfa_0 old1 try curChar input_stream readChar catch java io IOException jjStopStringLiteralDfa_0 active1 return switch curChar case if active1 return jjStopAtPos break default break return jjStartNfa_0 active1 private final void jjCheckNAdd int state if jjrounds state jjround jjstateSet jjnewStateCnt state jjrounds state jjround private final void jjAddStates int start int end do jjstateSet jjnewStateCnt jjnextStates start while start end private final void jjCheckNAddTwoStates int state1 int state2 jjCheckNAdd state1 jjCheckNAdd state2 private final void jjCheckNAddStates int start int end do jjCheckNAdd jjnextStates start while start end private final void jjCheckNAddStates int start jjCheckNAdd jjnextStates start jjCheckNAdd jjnextStates start static final long jjbitVec0 static final long jjbitVec1 static final long jjbitVec3 static final long jjbitVec4 static final long jjbitVec5 static final long jjbitVec6 static final long jjbitVec7 static final long jjbitVec8 private final int jjMoveNfa_0 int startState int curPos int nextStates int startsAt jjnewStateCnt int jjstateSet startState int kind for if jjround ReInitRounds if curChar long curChar MatchLoop do switch jjstateSet case if if kind kind jjCheckNAdd else if jjCheckNAddStates else if curChar jjAddStates else if curChar if kind kind jjCheckNAdd else if curChar jjCheckNAddStates else if curChar jjAddStates else if curChar jjCheckNAdd else if curChar jjstateSet jjnewStateCnt if if kind kind jjCheckNAddTwoStates else if curChar if kind kind jjCheckNAddStates break case if curChar jjCheckNAddTwoStates else if curChar if kind kind jjCheckNAddStates if curChar jjstateSet jjnewStateCnt break case if break if kind kind jjCheckNAdd break case if curChar jjCheckNAddStates break case if jjCheckNAddStates break case if kind kind break case if curChar kind kind break case if curChar jjstateSet jjnewStateCnt break case if break if kind kind jjCheckNAddTwoStates break case if break if kind kind jjCheckNAddTwoStates break case if curChar jjCheckNAdd break case if break if kind kind jjCheckNAddStates break case if jjCheckNAdd break case if break if kind kind jjCheckNAddTwoStates break case if curChar jjAddStates break case if jjCheckNAdd break case if curChar kind kind break case if jjCheckNAdd break case if jjCheckNAddTwoStates break case if jjCheckNAdd break case if jjstateSet jjnewStateCnt break case if jjCheckNAdd break case if curChar jjCheckNAddStates break case if jjCheckNAddStates break case if jjCheckNAddStates break case if curChar kind kind break case if jjCheckNAddStates break case if jjCheckNAddStates break case if jjstateSet jjnewStateCnt break case if jjCheckNAdd break case if curChar break if kind kind jjCheckNAdd break case if break if kind kind jjCheckNAdd break case if jjCheckNAddStates break case if jjCheckNAddTwoStates break case if curChar break if kind kind jjCheckNAddStates break case if break if kind kind jjCheckNAddStates break case if jjCheckNAdd break case if break if kind kind jjCheckNAddTwoStates break case if jjCheckNAddTwoStates break case if jjCheckNAdd break case if break if kind kind jjCheckNAddTwoStates break case if jjCheckNAddStates break case if jjCheckNAdd break case if jjCheckNAddTwoStates break case if curChar break if kind kind jjCheckNAddStates break case if break if kind kind jjCheckNAddTwoStates break case if break if kind kind jjCheckNAddTwoStates break case if curChar jjAddStates break case if break if kind kind jjCheckNAddStates break case if kind kind break case if curChar kind kind break case if curChar jjstateSet jjnewStateCnt break case if curChar jjCheckNAddTwoStates break case if jjCheckNAddTwoStates break case if curChar jjCheckNAddStates break case if jjCheckNAddTwoStates break case if jjCheckNAddTwoStates break case if curChar kind kind break case if curChar jjstateSet jjnewStateCnt break case if curChar jjCheckNAddTwoStates break case if jjCheckNAddTwoStates break case if curChar jjCheckNAddStates break case if jjCheckNAddTwoStates break case if jjCheckNAddTwoStates break case if curChar kind kind break default break while startsAt else if curChar long curChar MatchLoop do switch jjstateSet case case if break if kind kind jjCheckNAdd break case jjAddStates break case if kind kind break case if jjAddStates break case if kind kind break case if jjCheckNAdd break case if curChar jjAddStates break case if jjCheckNAdd break case if jjCheckNAddStates break case if curChar jjAddStates break case if jjCheckNAddStates break case if jjAddStates break case if jjAddStates break case if jjAddStates break case if jjCheckNAdd break case if break if kind kind jjCheckNAddTwoStates break case if kind kind jjAddStates break case jjCheckNAddTwoStates break case case jjCheckNAddTwoStates break case jjCheckNAddTwoStates break case case jjCheckNAddTwoStates break default break while startsAt else int hiByte int curChar int i1 hiByte long l1 hiByte int i2 curChar long l2 curChar MatchLoop do switch jjstateSet case if jjCanMove_0 hiByte i1 i2 l1 l2 if kind kind jjCheckNAdd if jjCanMove_2 hiByte i1 i2 l1 l2 if kind kind jjCheckNAdd break case if jjCanMove_0 hiByte i1 i2 l1 l2 break if kind kind jjCheckNAdd break case if jjCanMove_1 hiByte i1 i2 l1 l2 jjAddStates break case if jjCanMove_1 hiByte i1 i2 l1 l2 jjstateSet jjnewStateCnt break case if jjCanMove_1 hiByte i1 i2 l1 l2 jjAddStates break case case if jjCanMove_2 hiByte i1 i2 l1 l2 break if kind kind jjCheckNAdd break case if jjCanMove_1 hiByte i1 i2 l1 l2 break if kind kind jjAddStates break case if jjCanMove_1 hiByte i1 i2 l1 l2 jjCheckNAddTwoStates break case case if jjCanMove_1 hiByte i1 i2 l1 l2 jjCheckNAddTwoStates break case if jjCanMove_1 hiByte i1 i2 l1 l2 jjCheckNAddTwoStates break case case if jjCanMove_1 hiByte i1 i2 l1 l2 jjCheckNAddTwoStates break default break while startsAt if kind jjmatchedKind kind jjmatchedPos curPos kind curPos if jjnewStateCnt startsAt jjnewStateCnt startsAt return curPos try curChar input_stream readChar catch java io IOException return curPos static final int jjnextStates private static final boolean jjCanMove_0 int hiByte int i1 int i2 long l1 long l2 switch hiByte case return jjbitVec0 i2 l2 default return false private static final boolean jjCanMove_1 int hiByte int i1 int i2 long l1 long l2 switch hiByte case return jjbitVec0 i2 l2 default if jjbitVec1 i1 l1 return true return false private static final boolean jjCanMove_2 int hiByte int i1 int i2 long l1 long l2 switch hiByte case return jjbitVec4 i2 l2 case return jjbitVec5 i2 l2 case return jjbitVec6 i2 l2 case return jjbitVec7 i2 l2 case return jjbitVec8 i2 l2 default if jjbitVec3 i1 l1 return true return false public static final String jjstrLiteralImages null null null null null null null null null null null null null null null null null null null null null public static final String lexStateNames static final long jjtoToken static final long jjtoSkip static final long jjtoSpecial private ASCII_UCodeESC_CharStream input_stream private final int jjrounds new int private final int jjstateSet new int protected char curChar public ParserTokenManager ASCII_UCodeESC_CharStream stream if ASCII_UCodeESC_CharStream staticFlag throw new Error input_stream stream public ParserTokenManager ASCII_UCodeESC_CharStream stream int lexState this stream SwitchTo lexState public void ReInit ASCII_UCodeESC_CharStream stream jjmatchedPos jjnewStateCnt curLexState defaultLexState input_stream stream ReInitRounds private final void ReInitRounds int jjround for jjrounds public void ReInit ASCII_UCodeESC_CharStream stream int lexState ReInit stream SwitchTo lexState public void SwitchTo int lexState if lexState lexState throw new TokenMgrError lexState TokenMgrError INVALID_LEXICAL_STATE else curLexState lexState private final Token jjFillToken Token Token newToken jjmatchedKind kind jjmatchedKind String im jjstrLiteralImages jjmatchedKind image im null input_stream GetImage im beginLine input_stream getBeginLine beginColumn input_stream getBeginColumn endLine input_stream getEndLine endColumn input_stream getEndColumn return int curLexState int defaultLexState int jjnewStateCnt int jjround int jjmatchedPos int jjmatchedKind public final Token getNextToken int kind Token specialToken null Token matchedToken int curPos EOFLoop for try curChar input_stream BeginToken catch java io IOException jjmatchedKind matchedToken jjFillToken matchedToken specialToken specialToken return matchedToken jjmatchedKind jjmatchedPos curPos jjMoveStringLiteralDfa0_0 if jjmatchedKind if jjmatchedPos curPos input_stream backup curPos jjmatchedPos if jjtoToken jjmatchedKind jjmatchedKind matchedToken jjFillToken matchedToken specialToken specialToken return matchedToken else if jjtoSpecial jjmatchedKind jjmatchedKind matchedToken jjFillToken if specialToken null specialToken matchedToken else matchedToken specialToken specialToken specialToken specialToken next matchedToken continue EOFLoop int error_line input_stream getEndLine int error_column input_stream getEndColumn String error_after null boolean EOFSeen false try input_stream readChar input_stream backup catch java io IOException e1 EOFSeen true error_after curPos input_stream GetImage if curChar curChar error_line error_column else error_column if EOFSeen input_stream backup error_after curPos input_stream GetImage throw new TokenMgrError EOFSeen curLexState error_line error_column error_after curChar TokenMgrError LEXICAL_ERROR class CharIndexedStringBuffer implements CharIndexed Serializable private StringBuffer private int anchor CharIndexedStringBuffer StringBuffer str int index str anchor index public char charAt int index int pos anchor index return pos length pos charAt pos OUT_OF_BOUNDS public boolean isValid return anchor length public boolean move int index return anchor index length public class SyntaxStyle public SyntaxStyle Color fgColor Color bgColor Font font this fgColor fgColor this bgColor bgColor this font font public Color getForegroundColor return fgColor public Color getBackgroundColor return bgColor public Font getFont return font private Color fgColor private Color bgColor private Font font public class Marker public char getShortcut return shortcut public int getPosition return position null pos position getOffset Marker Buffer buffer char shortcut int position this buffer buffer this shortcut shortcut this pos position void setShortcut char shortcut this shortcut shortcut void createPosition position buffer createPosition pos void removePosition if position null pos position getOffset position null void setPosition int pos this pos pos private Buffer buffer private char shortcut private int pos private Position position class IntPair implements Serializable public int first second class CharUnit implements Serializable public char ch public boolean bk public class RE extends REToken private static final String VERSION private static ResourceBundle messages PropertyResourceBundle getBundle Locale getDefault private REToken firstToken lastToken private int numSubs private int minimumLength public static final int REG_ICASE public static final int REG_DOT_NEWLINE public static final int REG_MULTILINE public static final int REG_NOTBOL public static final int REG_NOTEOL public static final int REG_ANCHORINDEX public static final int REG_NO_INTERPOLATE public static final String version return VERSION static final String getLocalizedMessage String key return messages getString key public RE Object pattern throws REException this pattern RESyntax RE_SYNTAX_PERL5 public RE Object pattern int cflags throws REException this pattern cflags RESyntax RE_SYNTAX_PERL5 public RE Object pattern int cflags RESyntax syntax throws REException this pattern cflags syntax private RE REToken first REToken last int subs int subIndex int minLength super subIndex firstToken first lastToken last numSubs subs minimumLength minLength addToken new RETokenEndSub subIndex private RE Object patternObj int cflags RESyntax syntax int myIndex int nextSub throws REException initialize patternObj cflags syntax myIndex nextSub protected RE super protected void initialize Object patternObj int cflags RESyntax syntax int myIndex int nextSub throws REException char pattern if patternObj instanceof String pattern String patternObj toCharArray else if patternObj instanceof char pattern char patternObj else if patternObj instanceof StringBuffer pattern new char StringBuffer patternObj length StringBuffer patternObj getChars pattern length pattern else pattern patternObj toString toCharArray int pLength pattern length Vector branches null firstToken lastToken null boolean insens cflags REG_ICASE int index CharUnit unit new CharUnit IntPair minMax new IntPair REToken currentToken null char ch while index pLength index getCharUnit pattern index unit if unit ch syntax get RESyntax RE_NO_BK_VBAR unit bk syntax get RESyntax RE_NEWLINE_ALT unit ch unit bk syntax get RESyntax RE_LIMITED_OPS addToken currentToken RE theBranch new RE firstToken lastToken numSubs subIndex minimumLength minimumLength if branches null branches new Vector branches addElement theBranch firstToken lastToken currentToken null else if unit ch syntax get RESyntax RE_INTERVALS syntax get RESyntax RE_NO_BK_BRACES unit bk int newIndex getMinMax pattern index minMax syntax if newIndex index if minMax first minMax second throw new REException getLocalizedMessage REException REG_BADRPT newIndex if currentToken null throw new REException getLocalizedMessage REException REG_BADRPT newIndex if currentToken instanceof RETokenRepeated throw new REException getLocalizedMessage REException REG_BADRPT newIndex if currentToken instanceof RETokenWordBoundary currentToken instanceof RETokenWordBoundary throw new REException getLocalizedMessage REException REG_BADRPT newIndex if currentToken getMinimumLength minMax second Integer MAX_VALUE throw new REException getLocalizedMessage REException REG_BADRPT newIndex index newIndex currentToken setRepeated currentToken minMax first minMax second index else addToken currentToken currentToken new RETokenChar subIndex unit ch insens else if unit ch unit bk Vector options new Vector boolean negative false char lastChar if index pLength throw new REException getLocalizedMessage REException REG_EBRACK index if ch pattern index negative true if index pLength throw new REException getLocalizedMessage REException REG_EBRACK index ch pattern index if ch lastChar ch if index pLength throw new REException getLocalizedMessage REException REG_EBRACK index while ch pattern index if ch lastChar if index pLength throw new REException getLocalizedMessage REException REG_EBRACK index if ch pattern index options addElement new RETokenChar subIndex lastChar insens lastChar else options addElement new RETokenRange subIndex lastChar ch insens lastChar index else if ch syntax get RESyntax RE_BACKSLASH_ESCAPE_IN_LISTS if index pLength throw new REException getLocalizedMessage REException REG_EBRACK index int posixID boolean negate false char asciiEsc if indexOf pattern index syntax get RESyntax RE_CHAR_CLASS_ESC_IN_LISTS switch pattern index case negate true case posixID RETokenPOSIX DIGIT break case negate true case posixID RETokenPOSIX SPACE break case negate true case posixID RETokenPOSIX ALNUM break else if indexOf pattern index switch pattern index case asciiEsc break case asciiEsc break case asciiEsc break if lastChar options addElement new RETokenChar subIndex lastChar insens if posixID options addElement new RETokenPOSIX subIndex posixID insens negate else if asciiEsc lastChar asciiEsc else lastChar pattern index index else if ch syntax get RESyntax RE_CHAR_CLASSES index pLength pattern index StringBuffer posixSet new StringBuffer index getPosixSet pattern index posixSet int posixId RETokenPOSIX intValue posixSet toString if posixId options addElement new RETokenPOSIX subIndex posixId insens false else if lastChar options addElement new RETokenChar subIndex lastChar insens lastChar ch if index pLength throw new REException getLocalizedMessage REException REG_EBRACK index if lastChar options addElement new RETokenChar subIndex lastChar insens addToken currentToken options trimToSize currentToken new RETokenOneOf subIndex options negative else if unit ch syntax get RESyntax RE_NO_BK_PARENS unit bk boolean pure false boolean comment false boolean lookAhead false boolean negativelh false if index pLength pattern index switch pattern index case if syntax get RESyntax RE_LOOKAHEAD pure true negativelh true lookAhead true index break case if syntax get RESyntax RE_LOOKAHEAD pure true lookAhead true index break case if syntax get RESyntax RE_PURE_GROUPING pure true index break case if syntax get RESyntax RE_COMMENTS comment true break default throw new REException getLocalizedMessage REException REG_BADRPT index if index pLength throw new REException getLocalizedMessage REException REG_ESUBREG index int endIndex index int nextIndex index int nested while nextIndex getCharUnit pattern endIndex unit nested unit ch syntax get RESyntax RE_NO_BK_PARENS unit bk if endIndex nextIndex pLength throw new REException getLocalizedMessage REException REG_ESUBREG nextIndex else if unit ch syntax get RESyntax RE_NO_BK_PARENS unit bk nested else if unit ch syntax get RESyntax RE_NO_BK_PARENS unit bk nested if comment index nextIndex addToken currentToken if pure numSubs int useIndex pure lookAhead nextSub numSubs currentToken new RE String valueOf pattern index endIndex index toCharArray cflags syntax useIndex nextSub numSubs numSubs RE currentToken getNumSubs if lookAhead currentToken new RETokenLookAhead currentToken negativelh index nextIndex else if syntax get RESyntax RE_UNMATCHED_RIGHT_PAREN_ORD unit ch syntax get RESyntax RE_NO_BK_PARENS unit bk throw new REException getLocalizedMessage REException REG_EPAREN index else if unit ch unit bk addToken currentToken currentToken null addToken new RETokenStart subIndex cflags REG_MULTILINE syntax getLineSeparator null else if unit ch unit bk addToken currentToken currentToken null addToken new RETokenEnd subIndex cflags REG_MULTILINE syntax getLineSeparator null else if unit ch unit bk addToken currentToken currentToken new RETokenAny subIndex syntax get RESyntax RE_DOT_NEWLINE cflags REG_DOT_NEWLINE syntax get RESyntax RE_DOT_NOT_NULL else if unit ch unit bk if currentToken null throw new REException getLocalizedMessage REException REG_BADRPT index if currentToken instanceof RETokenRepeated throw new REException getLocalizedMessage REException REG_BADRPT index if currentToken instanceof RETokenWordBoundary currentToken instanceof RETokenWordBoundary throw new REException getLocalizedMessage REException REG_BADRPT index if currentToken getMinimumLength throw new REException getLocalizedMessage REException REG_BADRPT index currentToken setRepeated currentToken Integer MAX_VALUE index else if unit ch syntax get RESyntax RE_LIMITED_OPS syntax get RESyntax RE_BK_PLUS_QM unit bk if currentToken null throw new REException getLocalizedMessage REException REG_BADRPT index if currentToken instanceof RETokenRepeated throw new REException getLocalizedMessage REException REG_BADRPT index if currentToken instanceof RETokenWordBoundary currentToken instanceof RETokenWordBoundary throw new REException getLocalizedMessage REException REG_BADRPT index if currentToken getMinimumLength throw new REException getLocalizedMessage REException REG_BADRPT index currentToken setRepeated currentToken Integer MAX_VALUE index else if unit ch syntax get RESyntax RE_LIMITED_OPS syntax get RESyntax RE_BK_PLUS_QM unit bk if currentToken null throw new REException getLocalizedMessage REException REG_BADRPT index if currentToken instanceof RETokenRepeated if syntax get RESyntax RE_STINGY_OPS RETokenRepeated currentToken isStingy RETokenRepeated currentToken makeStingy else throw new REException getLocalizedMessage REException REG_BADRPT index else if currentToken instanceof RETokenWordBoundary currentToken instanceof RETokenWordBoundary throw new REException getLocalizedMessage REException REG_BADRPT index else currentToken setRepeated currentToken index else if unit bk Character isDigit unit ch syntax get RESyntax RE_NO_BK_REFS addToken currentToken currentToken new RETokenBackRef subIndex Character digit unit ch insens else if unit bk unit ch syntax get RESyntax RE_STRING_ANCHORS addToken currentToken currentToken new RETokenStart subIndex null else if unit bk unit ch syntax get RESyntax RE_STRING_ANCHORS addToken currentToken currentToken new RETokenWordBoundary subIndex RETokenWordBoundary BEGIN RETokenWordBoundary END false else if unit bk unit ch addToken currentToken currentToken new RETokenWordBoundary subIndex RETokenWordBoundary BEGIN false else if unit bk unit ch addToken currentToken currentToken new RETokenWordBoundary subIndex RETokenWordBoundary END false else if unit bk unit ch syntax get RESyntax RE_STRING_ANCHORS addToken currentToken currentToken new RETokenWordBoundary subIndex RETokenWordBoundary BEGIN RETokenWordBoundary END true else if unit bk unit ch syntax get RESyntax RE_CHAR_CLASS_ESCAPES addToken currentToken currentToken new RETokenPOSIX subIndex RETokenPOSIX DIGIT insens false else if unit bk unit ch syntax get RESyntax RE_CHAR_CLASS_ESCAPES addToken currentToken currentToken new RETokenPOSIX subIndex RETokenPOSIX DIGIT insens true else if unit bk unit ch addToken currentToken currentToken new RETokenChar subIndex false else if unit bk unit ch addToken currentToken currentToken new RETokenChar subIndex false else if unit bk unit ch syntax get RESyntax RE_CHAR_CLASS_ESCAPES addToken currentToken currentToken new RETokenPOSIX subIndex RETokenPOSIX SPACE insens false else if unit bk unit ch syntax get RESyntax RE_CHAR_CLASS_ESCAPES addToken currentToken currentToken new RETokenPOSIX subIndex RETokenPOSIX SPACE insens true else if unit bk unit ch addToken currentToken currentToken new RETokenChar subIndex false else if unit bk unit ch syntax get RESyntax RE_CHAR_CLASS_ESCAPES addToken currentToken currentToken new RETokenPOSIX subIndex RETokenPOSIX ALNUM insens false else if unit bk unit ch syntax get RESyntax RE_CHAR_CLASS_ESCAPES addToken currentToken currentToken new RETokenPOSIX subIndex RETokenPOSIX ALNUM insens true else if unit bk unit ch syntax get RESyntax RE_STRING_ANCHORS addToken currentToken currentToken new RETokenEnd subIndex null addToken currentToken currentToken new RETokenChar subIndex unit ch insens addToken currentToken if branches null branches addElement new RE firstToken lastToken numSubs subIndex minimumLength minimumLength firstToken lastToken null addToken new RETokenOneOf subIndex branches false else addToken new RETokenEndSub subIndex private static int getCharUnit char input int index CharUnit unit throws REException unit ch input index if unit bk unit ch if index input length unit ch input index else throw new REException getLocalizedMessage REException REG_ESCAPE index return index public boolean isMatch Object input return isMatch input public boolean isMatch Object input int index return isMatch input index public boolean isMatch Object input int index int eflags return isMatchImpl makeCharIndexed input index index eflags private boolean isMatchImpl CharIndexed input int index int eflags return input charAt CharIndexed OUT_OF_BOUNDS REMatch new REMatch numSubs index eflags if firstToken match input while null if input charAt index CharIndexed OUT_OF_BOUNDS return true next return false public int getNumSubs return numSubs void setUncle REToken uncle if lastToken null lastToken setUncle uncle boolean chain REToken next super chain next setUncle next return true public int getMinimumLength return minimumLength public REMatch getAllMatches Object input return getAllMatches input public REMatch getAllMatches Object input int index return getAllMatches input index public REMatch getAllMatches Object input int index int eflags return getAllMatchesImpl makeCharIndexed input index index eflags private REMatch getAllMatchesImpl CharIndexed input int index int eflags Vector all new Vector REMatch null while getMatchImpl input index eflags null null all addElement index getEndIndex index input move else input move end if input isValid break REMatch mset new REMatch all size all copyInto mset return mset boolean match CharIndexed input REMatch mymatch if firstToken null return next input mymatch mymatch start subIndex mymatch index return firstToken match input mymatch public REMatch getMatch Object input return getMatch input public REMatch getMatch Object input int index return getMatch input index public REMatch getMatch Object input int index int eflags return getMatch input index eflags null public REMatch getMatch Object input int index int eflags StringBuffer buffer return getMatchImpl makeCharIndexed input index index eflags buffer REMatch getMatchImpl CharIndexed input int anchor int eflags StringBuffer buffer REMatch mymatch new REMatch numSubs anchor eflags do if minimumLength input charAt minimumLength CharIndexed OUT_OF_BOUNDS if match input mymatch REMatch longest mymatch while mymatch mymatch next null if mymatch index longest index longest mymatch longest end longest index longest finish input return longest mymatch clear anchor if buffer null input charAt CharIndexed OUT_OF_BOUNDS buffer append input charAt while input move if minimumLength if match input mymatch mymatch finish input return mymatch return null public REMatchEnumeration getMatchEnumeration Object input return getMatchEnumeration input public REMatchEnumeration getMatchEnumeration Object input int index return getMatchEnumeration input index public REMatchEnumeration getMatchEnumeration Object input int index int eflags return new REMatchEnumeration this makeCharIndexed input index index eflags public String substitute Object input String replace return substitute input replace public String substitute Object input String replace int index return substitute input replace index public String substitute Object input String replace int index int eflags return substituteImpl makeCharIndexed input index replace index eflags private String substituteImpl CharIndexed input String replace int index int eflags StringBuffer buffer new StringBuffer REMatch getMatchImpl input index eflags buffer if null return buffer toString buffer append eflags REG_NO_INTERPOLATE replace substituteInto replace if input move end do buffer append input charAt while input move return buffer toString public String substituteAll Object input String replace return substituteAll input replace public String substituteAll Object input String replace int index return substituteAll input replace index public String substituteAll Object input String replace int index int eflags return substituteAllImpl makeCharIndexed input index replace index eflags private String substituteAllImpl CharIndexed input String replace int index int eflags StringBuffer buffer new StringBuffer REMatch while getMatchImpl input index eflags buffer null buffer append eflags REG_NO_INTERPOLATE replace substituteInto replace index getEndIndex if end char ch input charAt if ch CharIndexed OUT_OF_BOUNDS buffer append ch input move else input move end if input isValid break return buffer toString private void addToken REToken next if next null return minimumLength next getMinimumLength if firstToken null lastToken firstToken next else if lastToken chain next lastToken next private static REToken setRepeated REToken current int min int max int index throws REException if current null throw new REException getLocalizedMessage REException REG_BADRPT index return new RETokenRepeated current subIndex current min max private static int getPosixSet char pattern int index StringBuffer buf int for index pattern length if pattern pattern return buf append pattern private int getMinMax char input int index IntPair minMax RESyntax syntax throws REException boolean mustMatch syntax get RESyntax RE_NO_BK_BRACES int startIndex index if index input length if mustMatch throw new REException getLocalizedMessage REException REG_EBRACE index else return startIndex int min max CharUnit unit new CharUnit StringBuffer buf new StringBuffer do index getCharUnit input index unit if Character isDigit unit ch buf append unit ch while index input length Character isDigit unit ch if buf length if mustMatch throw new REException getLocalizedMessage REException REG_EBRACE index else return startIndex min Integer parseInt buf toString if unit ch syntax get RESyntax RE_NO_BK_BRACES unit bk max min else if index input length if mustMatch throw new REException getLocalizedMessage REException REG_EBRACE index else return startIndex else if unit ch unit bk buf new StringBuffer while index getCharUnit input index unit input length Character isDigit unit ch buf append unit ch if unit ch syntax get RESyntax RE_NO_BK_BRACES unit bk if mustMatch throw new REException getLocalizedMessage REException REG_EBRACE index else return startIndex if buf length max Integer MAX_VALUE else max Integer parseInt buf toString else if mustMatch throw new REException getLocalizedMessage REException REG_EBRACE index else return startIndex minMax first min minMax second max return index public String toString StringBuffer sb new StringBuffer dump sb return sb toString void dump StringBuffer os os append if subIndex os append if firstToken null firstToken dumpAll os os append private static CharIndexed makeCharIndexed Object input int index if input instanceof String return new CharIndexedString String input index else if input instanceof char return new CharIndexedCharArray char input index else if input instanceof StringBuffer return new CharIndexedStringBuffer StringBuffer input index else if input instanceof InputStream return new CharIndexedInputStream InputStream input index else if input instanceof Reader return new CharIndexedReader Reader input index else if input instanceof CharIndexed else return new CharIndexedString input toString index public class EditorExiting extends EBMessage NonVetoable public EditorExiting EBComponent source super source final class RETokenPOSIX extends REToken int type boolean insens boolean negated static final int ALNUM static final int ALPHA static final int BLANK static final int CNTRL static final int DIGIT static final int GRAPH static final int LOWER static final int PRINT static final int PUNCT static final int SPACE static final int UPPER static final int XDIGIT static final String s_nameTable static int intValue String key for int s_nameTable length if s_nameTable equals key return return RETokenPOSIX int subIndex int type boolean insens boolean negated super subIndex this type type this insens insens this negated negated int getMinimumLength return boolean match CharIndexed input REMatch mymatch char ch input charAt mymatch index if ch CharIndexed OUT_OF_BOUNDS return false boolean retval false switch type case ALNUM retval Character isLetterOrDigit ch ch break case ALPHA retval Character isLetter ch break case BLANK retval ch ch break case CNTRL retval Character isISOControl ch break case DIGIT retval Character isDigit ch break case GRAPH retval Character isWhitespace ch Character isISOControl ch break case LOWER retval insens Character isLetter ch Character isLowerCase ch break case PRINT retval Character isWhitespace ch Character isISOControl ch ch break case PUNCT retval indexOf ch break case SPACE retval Character isWhitespace ch break case UPPER retval insens Character isLetter ch Character isUpperCase ch break case XDIGIT retval Character isDigit ch indexOf ch break if negated retval retval if retval mymatch index return next input mymatch else return false void dump StringBuffer os if negated os append os append s_nameTable type public class REFilterInputStream extends FilterInputStream private RE expr private String replace private String buffer private int bufpos private int offset private CharIndexedInputStream stream public REFilterInputStream InputStream stream RE expr String replace super stream this stream new CharIndexedInputStream stream this expr expr this replace replace public int read if buffer null bufpos buffer length return int buffer charAt bufpos if stream isValid return REMatch mymatch new REMatch expr getNumSubs offset if expr match stream mymatch mymatch end mymatch index mymatch finish stream stream move mymatch toString length offset mymatch toString length buffer mymatch substituteInto replace bufpos if buffer length return buffer charAt char ch stream charAt if ch CharIndexed OUT_OF_BOUNDS return stream move offset return ch public boolean markSupported return false public int read byte int off int len int int ok while len read if return ok ok off byte ok return ok public int read byte return read length class PluginListHandler extends HandlerBase PluginListHandler PluginList pluginList String path this pluginList pluginList this path path stateStack new Stack public Object resolveEntity String publicId String systemId if equals systemId return new StringReader return null public void attribute String aname String value boolean isSpecified aname aname null null aname intern value value null null value intern if aname name value else if aname jar value else if aname version value else if aname date value else if aname obsolete equals value else if aname depWhat value else if aname depFrom value else if aname depTo value else if aname depPlugin value else if aname size Integer parseInt value public void doctypeDecl String name String publicId String systemId throws Exception if equals name return Log log Log ERROR this path public void charData char int off int len String tag peekElement String text new String off len if tag description text else if tag pluginSetEntry text else if tag if author null author length author author text else author text else if tag download text else if tag downloadSource text public void startElement String tag tag pushElement tag if tag description null pluginSet new PluginList PluginSet else if tag description null author null branch null plugin new PluginList Plugin else if tag download null branch new PluginList Branch else if tag downloadSize size else if tag downloadSourceSize size public void endElement String tag if tag null return else tag tag intern popElement if tag pluginList addPluginSet pluginSet pluginSet null pluginSetEntry null else if tag pluginSet plugins addElement pluginSetEntry pluginSetEntry null else if tag plugin jar jar plugin name name plugin author author plugin description description pluginList addPlugin plugin jar null name null author null else if tag branch version version branch date date branch download download branch downloadSize downloadSize branch downloadSource downloadSource branch downloadSourceSize downloadSourceSize branch obsolete obsolete plugin branches addElement branch version null download null obsolete false else if tag PluginList Dependency dep new PluginList Dependency depWhat depFrom depTo depPlugin branch deps addElement dep depWhat null depFrom null depTo null depPlugin null public void startDocument try pushElement null catch Exception printStackTrace public void endDocument pluginList finished private String path private PluginList pluginList private PluginList PluginSet pluginSet private String pluginSetEntry private PluginList Plugin plugin private String jar private String author private PluginList Branch branch private boolean obsolete private String version private String date private String download private int downloadSize private String downloadSource private int downloadSourceSize private int size private String depWhat private String depFrom private String depTo private String depPlugin private String name private String description private Stack stateStack private String pushElement String name name name null null name intern stateStack push name return name private String peekElement return String stateStack peek private String popElement return String stateStack pop public class SearchSettingsChanged extends EBMessage NonVetoable public SearchSettingsChanged EBComponent source super source final class ASCII_UCodeESC_CharStream public static final boolean staticFlag false static final int hexval char throws java io IOException switch case return case return case return case return case return case return case return case return case return case return case case return case case return case case return case case return case case return case case return public int bufpos int bufsize int available int tokenBegin private int bufline private int bufcolumn private int column private int line private java io Reader inputStream private boolean prevCharIsCR false private boolean prevCharIsLF false private char nextCharBuf private char buffer private int maxNextCharInd private int nextCharInd private int inBuf private final void ExpandBuff boolean wrapAround char newbuffer new char bufsize int newbufline new int bufsize int newbufcolumn new int bufsize try if wrapAround System arraycopy buffer tokenBegin newbuffer bufsize tokenBegin System arraycopy buffer newbuffer bufsize tokenBegin bufpos buffer newbuffer System arraycopy bufline tokenBegin newbufline bufsize tokenBegin System arraycopy bufline newbufline bufsize tokenBegin bufpos bufline newbufline System arraycopy bufcolumn tokenBegin newbufcolumn bufsize tokenBegin System arraycopy bufcolumn newbufcolumn bufsize tokenBegin bufpos bufcolumn newbufcolumn bufpos bufsize tokenBegin else System arraycopy buffer tokenBegin newbuffer bufsize tokenBegin buffer newbuffer System arraycopy bufline tokenBegin newbufline bufsize tokenBegin bufline newbufline System arraycopy bufcolumn tokenBegin newbufcolumn bufsize tokenBegin bufcolumn newbufcolumn bufpos tokenBegin catch Throwable throw new Error getMessage available bufsize tokenBegin private final void FillBuff throws java io IOException int if maxNextCharInd maxNextCharInd nextCharInd try if inputStream read nextCharBuf maxNextCharInd maxNextCharInd inputStream close throw new java io IOException else maxNextCharInd return catch java io IOException if bufpos bufpos backup else bufline bufpos line bufcolumn bufpos column throw private final char ReadByte throws java io IOException if nextCharInd maxNextCharInd FillBuff return nextCharBuf nextCharInd public final char BeginToken throws java io IOException if inBuf inBuf return buffer tokenBegin bufpos bufsize bufpos bufpos tokenBegin bufpos return readChar private final void AdjustBuffSize if available bufsize if tokenBegin bufpos available tokenBegin else ExpandBuff false else if available tokenBegin available bufsize else if tokenBegin available ExpandBuff true else available tokenBegin private final void UpdateLineColumn char column if prevCharIsLF prevCharIsLF false line column else if prevCharIsCR prevCharIsCR false if prevCharIsLF true else line column switch case prevCharIsCR true break case prevCharIsLF true break case column column column break default break bufline bufpos line bufcolumn bufpos column public final char readChar throws java io IOException if inBuf inBuf return buffer bufpos bufsize bufpos bufpos char if bufpos available AdjustBuffSize if buffer bufpos char char ReadByte UpdateLineColumn int backSlashCnt if bufpos available AdjustBuffSize try if buffer bufpos char char ReadByte UpdateLineColumn if backSlashCnt if bufpos bufpos bufsize break backup backSlashCnt return catch java io IOException if backSlashCnt backup backSlashCnt return UpdateLineColumn backSlashCnt try while char char ReadByte column buffer bufpos char hexval hexval char char ReadByte hexval char char ReadByte hexval char char ReadByte column catch java io IOException throw new Error line column if backSlashCnt return else backup backSlashCnt return else UpdateLineColumn return public final int getColumn return bufcolumn bufpos public final int getLine return bufline bufpos public final int getEndColumn return bufcolumn bufpos public final int getEndLine return bufline bufpos public final int getBeginColumn return bufcolumn tokenBegin public final int getBeginLine return bufline tokenBegin public final void backup int amount inBuf amount if bufpos amount bufpos bufsize public ASCII_UCodeESC_CharStream java io Reader dstream int startline int startcolumn int buffersize inputStream dstream line startline column startcolumn available bufsize buffersize buffer new char buffersize bufline new int buffersize bufcolumn new int buffersize nextCharBuf new char public ASCII_UCodeESC_CharStream java io Reader dstream int startline int startcolumn this dstream startline startcolumn public void ReInit java io Reader dstream int startline int startcolumn int buffersize inputStream dstream line startline column startcolumn if buffer null buffersize buffer length available bufsize buffersize buffer new char buffersize bufline new int buffersize bufcolumn new int buffersize nextCharBuf new char prevCharIsLF prevCharIsCR false tokenBegin inBuf maxNextCharInd nextCharInd bufpos public void ReInit java io Reader dstream int startline int startcolumn ReInit dstream startline startcolumn public ASCII_UCodeESC_CharStream java io InputStream dstream int startline int startcolumn int buffersize this new java io InputStreamReader dstream startline startcolumn public ASCII_UCodeESC_CharStream java io InputStream dstream int startline int startcolumn this dstream startline startcolumn public void ReInit java io InputStream dstream int startline int startcolumn int buffersize ReInit new java io InputStreamReader dstream startline startcolumn public void ReInit java io InputStream dstream int startline int startcolumn ReInit dstream startline startcolumn public final String GetImage if bufpos tokenBegin return new String buffer tokenBegin bufpos tokenBegin else return new String buffer tokenBegin bufsize tokenBegin new String buffer bufpos public final char GetSuffix int len char ret new char len if bufpos len System arraycopy buffer bufpos len ret len else System arraycopy buffer bufsize len bufpos ret len bufpos System arraycopy buffer ret len bufpos bufpos return ret public void Done nextCharBuf null buffer null bufline null bufcolumn null public void adjustBeginLineColumn int newLine int newCol int start tokenBegin int len if bufpos tokenBegin len bufpos tokenBegin inBuf else len bufsize tokenBegin bufpos inBuf int int nextColDiff columnDiff while len bufline start bufsize bufline start bufsize bufline newLine nextColDiff columnDiff bufcolumn bufcolumn bufcolumn newCol columnDiff columnDiff nextColDiff if len bufline newLine bufcolumn newCol columnDiff while len if bufline start bufsize bufline start bufsize bufline newLine else bufline newLine line bufline column bufcolumn final class RETokenAny extends REToken private boolean newline private boolean matchNull RETokenAny int subIndex boolean newline boolean matchNull super subIndex this newline newline this matchNull matchNull int getMinimumLength return boolean match CharIndexed input REMatch mymatch char ch input charAt mymatch index if ch CharIndexed OUT_OF_BOUNDS newline ch matchNull ch return false mymatch index return next input mymatch void dump StringBuffer os os append public class NameSpace implements java io Serializable BshClassManager Listener NameSource public static final NameSpace JAVACODE new NameSpace public String name private NameSpace parent private Hashtable variables private Hashtable methods private This thisReference transient private static boolean superImport transient private Hashtable classCache public NameSpace String name this null name public NameSpace NameSpace parent String name setName name setParent parent BshClassManager addCMListener this public void setName String name this name name public String getName return this name SimpleNode callerInfoNode void setNode SimpleNode node this callerInfoNode node SimpleNode getNode return this callerInfoNode public Object get String name Interpreter interpreter throws EvalError CallStack callstack new CallStack return getNameResolver name toObject callstack interpreter public void setVariable String name Object value throws EvalError if variables null variables new Hashtable if value null variables remove name return boolean recurse Interpreter strictJava Object current getVariableImpl name recurse if current null current instanceof TypedVariable try TypedVariable current setValue value catch EvalError throw new EvalError name getMessage else if Interpreter strictJava throw new EvalError name else variables put name value public String getVariableNames if variables null return new String else return enumerationToStringArray variables keys public String getMethodNames if methods null return new String else return enumerationToStringArray methods keys private String enumerationToStringArray Enumeration Vector new Vector while hasMoreElements addElement nextElement String sa new String size copyInto sa return sa public NameSpace getParent return parent public NameSpace getSuper if parent null return parent else return this public NameSpace getGlobal if parent null return parent getGlobal else return this This getThis Interpreter declaringInterpreter if thisReference null thisReference This getThis this declaringInterpreter return thisReference public void prune setParent null public void setParent NameSpace parent this parent parent if parent null loadDefaultImports public Object getVariable String name return getVariable name true public Object getVariable String name boolean recurse Object val getVariableImpl name recurse return unwrapVariable val protected Object unwrapVariable Object val if val instanceof TypedVariable val TypedVariable val getValue return val null Primitive VOID val protected Object getVariableImpl String name boolean recurse Object val null if variables null val variables get name if recurse val null parent null val parent getVariableImpl name recurse return val public void setTypedVariable String name Class type Object value boolean isFinal throws EvalError if variables null variables new Hashtable if value null if type isPrimitive if type Boolean TYPE value new Primitive Boolean FALSE else if type Byte TYPE value new Primitive byte else if type Short TYPE value new Primitive short else if type Character TYPE value new Primitive char else if type Integer TYPE value new Primitive int else if type Long TYPE value new Primitive else if type Float TYPE value new Primitive else if type Double TYPE value new Primitive else value Primitive NULL if variables containsKey name Object existing getVariableImpl name false if existing instanceof TypedVariable if TypedVariable existing getType type throw new EvalError name TypedVariable existing getType else TypedVariable existing setValue value return variables put name new TypedVariable type value isFinal public void setMethod String name BshMethod method if methods null methods new Hashtable Object methods get name if null methods put name method else if instanceof BshMethod Vector new Vector addElement addElement method methods put name Vector addElement method public BshMethod getMethod String name Class sig BshMethod method null Object null if methods null methods get name if instanceof Vector Vector vm Vector BshMethod ma new BshMethod vm size vm copyInto ma Class candidates new Class ma length for int ma length candidates ma getArgTypes int match Reflect findMostSpecificSignature sig candidates if match method ma match else method BshMethod if method null parent null return parent getMethod name sig return method nameSpaceChanged nameSpaceChanged public String getImportedPackages Vector getImportedPackages true public Vector getImportedPackages boolean recurse if recurse else Vector new Vector if parent null String psa parent getImportedPackages for int psa length addElement psa return private void cacheClass Class if classCache null classCache new Hashtable classCache put name public Class getClass String name throws ClassPathException Class getClassImpl name if null return else if parent null return parent getClass name else return null private Class getClassImpl String name throws ClassPathException boolean unqualifiedName Name isCompound name Class null if classCache null Class classCache get name if null return if unqualifiedName getImportedClassImpl name if null cacheClass return classForName name if null if unqualifiedName cacheClass return Interpreter debug name this return null private Class getImportedClassImpl String name throws ClassPathException String fullname null if fullname null Class clas classForName fullname if clas null if Name isCompound fullname try clas getNameResolver fullname toClass else Interpreter debug if clas null BshClassManager cacheClassInfo fullname clas return clas else return clas return null Class classForName if null return if superImport BshClassManager bcm BshClassManager getClassManager if bcm null String bcm getClassNameByUnqName name if null return classForName return null private Class classForName String name return BshClassManager classForName name public String getAllNames Vector vec new Vector getAllNamesAux vec String names new String vec size vec copyInto names return names protected void getAllNamesAux Vector vec Enumeration varNames variables keys while varNames hasMoreElements vec addElement varNames nextElement Enumeration methodNames methods keys while methodNames hasMoreElements vec addElement methodNames nextElement if parent null parent getAllNamesAux vec Vector nameSourceListeners public void addNameSourceListener NameSource Listener listener if nameSourceListeners null nameSourceListeners new Vector nameSourceListeners addElement listener public static void doSuperImport throws EvalError BshClassManager bcm BshClassManager getClassManager if bcm null bcm doSuperImport superImport true static class TypedVariable implements java io Serializable Class type boolean isFinal TypedVariable Class type Object value boolean isFinal throws EvalError this type type if type null throw new InterpreterError value this isFinal isFinal setValue value void setValue Object val throws EvalError if isFinal value null throw new EvalError val getAssignableForm val type if val instanceof Primitive Primitive val isNumber try val BSHCastExpression castPrimitive Primitive val type catch EvalError throw new InterpreterError this value val Object getValue return value Class getType return type public String toString return type value public static Object checkAssignableFrom Object rhs Class lhsType throws EvalError return getAssignableForm rhs lhsType public static Object getAssignableForm Object rhs Class lhsType throws EvalError Class originalType if lhsType null throw new InterpreterError if rhs null throw new InterpreterError if rhs Primitive VOID throw new EvalError if rhs Primitive NULL if lhsType isPrimitive return rhs else throw new EvalError lhsType getName Class rhsType if rhs instanceof Primitive rhsType originalType Primitive rhs getType if lhsType isPrimitive else if Boolean class isAssignableFrom lhsType Character class isAssignableFrom lhsType Number class isAssignableFrom lhsType rhs Primitive rhs getValue rhsType rhs getClass else assignmentError lhsType originalType else rhsType originalType rhs getClass if lhsType isPrimitive if rhsType Boolean class rhs new Primitive Boolean rhs rhsType Boolean TYPE else if rhsType Character class rhs new Primitive Character rhs rhsType Character TYPE else if Number class isAssignableFrom rhsType rhs new Primitive Number rhs rhsType Primitive rhs getType else assignmentError lhsType originalType if Reflect isAssignableFrom lhsType rhsType return rhs if lhsType Short class if rhsType Byte class return new Short Number rhs shortValue if lhsType Integer class if rhsType Byte class rhsType Short class return new Integer Number rhs intValue if rhsType Character class return new Integer Number rhs intValue if lhsType Long class if rhsType Byte class rhsType Short class rhsType Integer class return new Long Number rhs longValue if rhsType Character class return new Long Number rhs longValue if lhsType Float class if rhsType Byte class rhsType Short class rhsType Integer class rhsType Long class return new Float Number rhs floatValue if rhsType Character class return new Float Number rhs floatValue if lhsType Double class if rhsType Byte class rhsType Short class rhsType Integer class rhsType Long class rhsType Float class return new Double Number rhs doubleValue if rhsType Character class return new Double Number rhs doubleValue if Capabilities canGenerateInterfaces lhsType isInterface rhs instanceof bsh This return bsh This rhs getInterface lhsType assignmentError lhsType originalType return rhs private static void assignmentError Class lhs Class rhs throws EvalError String lhsType Reflect normalizeClassName lhs String rhsType Reflect normalizeClassName rhs throw new EvalError rhsType lhsType public String toString return name null super toString name super toString private synchronized void writeObject java io ObjectOutputStream throws IOException defaultWriteObject public Object invokeMethod String methodName Object args Interpreter interpreter throws EvalError return invokeMethod methodName args interpreter null null public Object invokeMethod String methodName Object args Interpreter interpreter CallStack callstack SimpleNode callerInfo throws EvalError if callstack null callstack new CallStack callstack push this BshMethod meth getMethod methodName Reflect getTypes args if meth null return meth invokeDeclaredMethod args interpreter callstack callerInfo meth getMethod new Class null null if meth null return meth invokeDeclaredMethod new Object methodName args interpreter callstack callerInfo throw new EvalError methodName this public void classLoaderChanged nameSpaceChanged public void nameSpaceChanged classCache null public void loadDefaultImports Name getNameResolver String name return new Name this name public int getInvocationLine SimpleNode node getNode if node null return node getLineNumber else return public String getInvocationText SimpleNode node getNode if node null return node getText else return public static Class identifierToClass Name ClassIdentifier ci return ci getTargetClass public void clear variables null methods null superImport false if parent null loadDefaultImports classCache null public class HistoryTextField extends JTextField public HistoryTextField this null public HistoryTextField String name this name false true public HistoryTextField String name boolean instantPopups this name instantPopups true public HistoryTextField String name boolean instantPopups boolean enterAddsToHistory setBorder new CompoundBorder getBorder new HistoryBorder if name null historyModel HistoryModel getModel name MouseHandler mouseHandler new MouseHandler addMouseListener mouseHandler addMouseMotionListener mouseHandler this instantPopups instantPopups this enterAddsToHistory enterAddsToHistory index public void setInstantPopups boolean instantPopups this instantPopups instantPopups public boolean getInstantPopups return instantPopups public void setEnterAddsToHistory boolean enterAddsToHistory this enterAddsToHistory enterAddsToHistory public boolean setEnterAddsToHistory return enterAddsToHistory public void setSelectAllOnFocus boolean selectAllOnFocus this selectAllOnFocus selectAllOnFocus public boolean setSelectAllOnFocus return selectAllOnFocus public void setModel String name if name null historyModel null else historyModel HistoryModel getModel name index repaint public void addCurrentToHistory if historyModel null historyModel addItem getText index public void setText String text super setText text index public HistoryModel getModel return historyModel public void fireActionPerformed super fireActionPerformed protected void processKeyEvent KeyEvent evt if isEnabled return if evt getID KeyEvent KEY_PRESSED if evt getKeyCode KeyEvent VK_ENTER if enterAddsToHistory addCurrentToHistory if evt getModifiers fireActionPerformed evt consume else if evt getKeyCode KeyEvent VK_UP if evt isShiftDown doBackwardSearch else historyPrevious evt consume else if evt getKeyCode KeyEvent VK_DOWN if evt isShiftDown doForwardSearch else historyNext evt consume else if evt getKeyCode KeyEvent VK_TAB evt isControlDown doBackwardSearch evt consume if evt isConsumed super processKeyEvent evt protected void processMouseEvent MouseEvent evt if isEnabled return switch evt getID case MouseEvent MOUSE_PRESSED Border border getBorder Insets insets border getBorderInsets HistoryTextField this if evt getX getWidth insets right GUIUtilities isPopupTrigger evt if evt isShiftDown showPopupMenu getText substring getSelectionStart getHeight else showPopupMenu getHeight else super processMouseEvent evt break case MouseEvent MOUSE_EXITED setCursor Cursor getDefaultCursor super processMouseEvent evt break default super processMouseEvent evt break private HistoryModel historyModel private JPopupMenu popup private boolean instantPopups private boolean enterAddsToHistory private boolean selectAllOnFocus private String current private int index private void doBackwardSearch if historyModel null return if getSelectionEnd getDocument getLength setCaretPosition getDocument getLength String text getText substring getSelectionStart if text null historyPrevious return for int index historyModel getSize String item historyModel getItem if item startsWith text replaceSelection item substring text length select text length getDocument getLength index return getToolkit beep private void doForwardSearch if historyModel null return if getSelectionEnd getDocument getLength setCaretPosition getDocument getLength String text getText substring getSelectionStart if text null historyNext return for int index String item historyModel getItem if item startsWith text replaceSelection item substring text length select text length getDocument getLength index return getToolkit beep private void historyPrevious if historyModel null return if index historyModel getSize getToolkit beep else if index current getText setText historyModel getItem index else int newIndex index setText historyModel getItem newIndex index newIndex private void historyNext if historyModel null return if index getToolkit beep else if index setText current else int newIndex index setText historyModel getItem newIndex index newIndex private void showPopupMenu String text int int if historyModel null return requestFocus if popup null popup isVisible popup setVisible false return ActionHandler actionListener new ActionHandler popup new JPopupMenu JMenuItem caption new JMenuItem jEdit getProperty caption getModel setEnabled false popup add caption popup addSeparator for int historyModel getSize String item historyModel getItem if item startsWith text JMenuItem menuItem new JMenuItem item menuItem setActionCommand String valueOf menuItem addActionListener actionListener popup add menuItem GUIUtilities showPopupMenu popup this class ActionHandler implements ActionListener public void actionPerformed ActionEvent evt int ind Integer parseInt evt getActionCommand if ind if index setText current else setText historyModel getItem ind index ind if instantPopups addCurrentToHistory fireActionPerformed class MouseHandler extends MouseInputAdapter boolean selectAll public void mousePressed MouseEvent evt selectAll hasFocus selectAllOnFocus public void mouseReleased MouseEvent evt SwingUtilities invokeLater new Runnable public void run if selectAll selectAll public void mouseMoved MouseEvent evt Border border getBorder Insets insets border getBorderInsets HistoryTextField this if evt getX getWidth insets right setCursor Cursor getDefaultCursor else setCursor Cursor getPredefinedCursor Cursor TEXT_CURSOR public void mouseDragged MouseEvent evt selectAll false static class HistoryBorder extends AbstractBorder static final int WIDTH public void paintBorder Component Graphics int int int int translate WIDTH int w2 WIDTH int h2 setColor UIManager getColor isEnabled HistoryTextField getModel null drawLine w2 h2 w2 h2 drawLine w2 h2 w2 h2 drawLine w2 h2 w2 h2 drawLine w2 h2 w2 h2 drawLine w2 h2 w2 h2 translate WIDTH public Insets getBorderInsets Component return new Insets WIDTH public class IntegerArray public IntegerArray array new int public void add int num if len array length int arrayN new int len System arraycopy array arrayN len array arrayN array len num public final int get int index return array index public final int getSize return len public final void setSize int len this len len public final void clear len private int array private int len class JJTParserState private java util Stack nodes private java util Stack marks private boolean node_created JJTParserState nodes new java util Stack marks new java util Stack sp mk boolean nodeCreated return node_created void reset nodes removeAllElements marks removeAllElements sp mk Node rootNode return Node nodes elementAt void pushNode Node nodes push sp Node popNode if sp mk mk Integer marks pop intValue return Node nodes pop Node peekNode return Node nodes peek int nodeArity return sp mk void clearNodeScope Node while sp mk popNode mk Integer marks pop intValue void openNodeScope Node marks push new Integer mk mk sp jjtOpen void closeNodeScope Node int num mk Integer marks pop intValue while num Node popNode jjtSetParent jjtAddChild num jjtClose pushNode node_created true void closeNodeScope Node boolean condition if condition int nodeArity mk Integer marks pop intValue while Node popNode jjtSetParent jjtAddChild jjtClose pushNode node_created true else mk Integer marks pop intValue node_created false public abstract class BshClassManager private static BshClassManager manager private static boolean checkedForManager private static Object NOVALUE new Object private static ClassLoader externalClassLoader protected transient static Hashtable absoluteClassCache new Hashtable protected transient static Hashtable absoluteNonClasses new Hashtable public static BshClassManager getClassManager if checkedForManager manager null try if plainClassForName null plainClassForName null Class bcm plainClassForName manager BshClassManager bcm newInstance catch ClassNotFoundException catch Exception System err println checkedForManager true return manager public static boolean classExists String name return classForName name null public static Class classForName String name if manager null return manager getClassForName name else try return plainClassForName name catch ClassNotFoundException return null public static Class plainClassForName String name throws ClassNotFoundException try Class if externalClassLoader null externalClassLoader loadClass name else if bcm null bcm getPlainClassForName name else Class forName name cacheClassInfo name return catch NoClassDefFoundError throw new ClassNotFoundException toString public static void cacheClassInfo String name Class value if value null absoluteClassCache put name value else absoluteNonClasses put name NOVALUE protected void clearCaches absoluteNonClasses new Hashtable absoluteClassCache new Hashtable public static void addCMListener Listener if manager null manager addListener public static void setClassLoader ClassLoader externalCL externalClassLoader externalCL BshClassManager bcm getClassManager if bcm null bcm classLoaderChanged public static interface Listener public void classLoaderChanged public abstract Class getClassForName String name public abstract Class getPlainClassForName String name throws ClassNotFoundException public abstract ClassLoader getBaseLoader public abstract ClassLoader getLoaderForClass String name public abstract void addClassPath URL path throws IOException public abstract void reset public abstract void setClassPath URL cp public abstract void reloadAllClasses throws ClassPathException public abstract void reloadClasses String classNames throws ClassPathException public abstract void reloadPackage String pack throws ClassPathException public abstract void doSuperImport throws EvalError public abstract String getClassNameByUnqName String name throws ClassPathException public abstract void addListener Listener public abstract void removeListener Listener public abstract void dump PrintWriter pw protected abstract void classLoaderChanged public interface OptionPane String getName Component getComponent void init void save final class RETokenChar extends REToken private char ch private boolean insens RETokenChar int subIndex char boolean ins super subIndex ch new char ch insens ins Character toLowerCase int getMinimumLength return ch length boolean match CharIndexed input REMatch mymatch int ch length char for int input charAt mymatch index if insens Character toLowerCase ch return false mymatch index return next input mymatch boolean chain REToken next if next instanceof RETokenChar RETokenChar cnext RETokenChar next int newsize ch length cnext ch length char chTemp new char newsize System arraycopy ch chTemp ch length System arraycopy cnext ch chTemp ch length cnext ch length ch chTemp return false else return super chain next void dump StringBuffer os os append ch public class ErrorListDialog extends EnhancedDialog public static class ErrorEntry String path String messages public ErrorEntry String path String messageProp Object args this path path String message jEdit getProperty messageProp args if message null message messageProp Vector tokenizedMessage new Vector int lastIndex for int message length if message charAt tokenizedMessage addElement message substring lastIndex lastIndex if lastIndex message length tokenizedMessage addElement message substring lastIndex messages new String tokenizedMessage size tokenizedMessage copyInto messages public ErrorListDialog Frame frame String title String caption Vector messages boolean showPluginMgrButton super frame title true JPanel content new JPanel new BorderLayout content setBorder new EmptyBorder setContentPane content Box iconBox new Box BoxLayout Y_AXIS iconBox add new JLabel UIManager getIcon iconBox add Box createGlue content add BorderLayout WEST iconBox JPanel centerPanel new JPanel new BorderLayout JLabel label new JLabel caption label setBorder new EmptyBorder centerPanel add BorderLayout NORTH label JList errors new JList messages errors setCellRenderer new ErrorListCellRenderer errors setVisibleRowCount Math min messages size JScrollPane scrollPane new JScrollPane errors JScrollPane VERTICAL_SCROLLBAR_ALWAYS JScrollPane HORIZONTAL_SCROLLBAR_ALWAYS Dimension size scrollPane getPreferredSize size width Math min size width scrollPane setPreferredSize size centerPanel add BorderLayout CENTER scrollPane content add BorderLayout CENTER centerPanel Box buttons new Box BoxLayout X_AXIS buttons add Box createGlue ok new JButton jEdit getProperty ok addActionListener new ActionHandler if showPluginMgrButton pluginMgr new JButton jEdit getProperty pluginMgr addActionListener new ActionHandler buttons add pluginMgr buttons add Box createHorizontalStrut buttons add ok buttons add Box createGlue content add BorderLayout SOUTH buttons getRootPane setDefaultButton ok pack setLocationRelativeTo frame show public void ok dispose public void cancel dispose private JButton ok pluginMgr class ActionHandler implements ActionListener public void actionPerformed ActionEvent evt if evt getSource ok dispose else if evt getSource pluginMgr new org gjt sp jedit pluginmgr PluginManager JOptionPane getFrameForComponent ErrorListDialog this public class REFilterReader extends FilterReader private RE expr private String replace private String buffer private int bufpos private int offset private CharIndexedReader stream public REFilterReader Reader stream RE expr String replace super stream this stream new CharIndexedReader stream this expr expr this replace replace public int read if buffer null bufpos buffer length return int buffer charAt bufpos if stream isValid return REMatch mymatch new REMatch expr getNumSubs offset if expr match stream mymatch mymatch end mymatch index mymatch finish stream stream move mymatch toString length offset mymatch toString length buffer mymatch substituteInto replace bufpos if buffer length return buffer charAt char ch stream charAt if ch CharIndexed OUT_OF_BOUNDS return stream move offset return ch public boolean markSupported return false public int read char int off int len int int ok while len read if return ok ok off char ok return ok public int read char return read length public class EnhancedMenuItem extends JMenuItem public EnhancedMenuItem String label EditAction action super label this action action if action null setEnabled true addActionListener new EditAction Wrapper action shortcutProp1 action getName shortcutProp2 action getName addMouseListener new MouseHandler else setEnabled false public Dimension getPreferredSize Dimension super getPreferredSize String shortcut getShortcut if shortcut null width getFontMetrics acceleratorFont stringWidth shortcut return public void paint Graphics super paint String shortcut getShortcut if shortcut null setFont acceleratorFont setColor getModel isArmed acceleratorSelectionForeground acceleratorForeground FontMetrics fm getFontMetrics Insets insets getInsets drawString shortcut getWidth fm stringWidth shortcut insets right insets left getFont getSize insets top private String shortcutProp1 private String shortcutProp2 private EditAction action private static Font acceleratorFont private static Color acceleratorForeground private static Color acceleratorSelectionForeground private String getShortcut if action null return null else String shortcut1 jEdit getProperty shortcutProp1 String shortcut2 jEdit getProperty shortcutProp2 if shortcut1 null shortcut1 length if shortcut2 null shortcut2 length return null else return shortcut2 else if shortcut2 null shortcut2 length return shortcut1 else return shortcut1 shortcut2 static acceleratorFont UIManager getFont acceleratorFont new Font acceleratorFont getStyle acceleratorFont getSize acceleratorForeground UIManager getColor acceleratorSelectionForeground UIManager getColor class MouseHandler extends MouseAdapter public void mouseReleased MouseEvent evt GUIUtilities getView Component evt getSource getStatus setMessage null public void mouseEntered MouseEvent evt String msg action getMouseOverText if msg null GUIUtilities getView Component evt getSource getStatus setMessage msg public void mouseExited MouseEvent evt GUIUtilities getView Component evt getSource getStatus setMessage null public interface BrowserListener extends EventListener void filesSelected VFSBrowser browser VFS DirectoryEntry files void filesActivated VFSBrowser browser VFS DirectoryEntry files public class Primitive implements ParserConstants java io Serializable private Object value private static class Special implements java io Serializable private Special public static final Special NULL_VALUE new Special public static final Special VOID_TYPE new Special public static final Primitive NULL new Primitive Special NULL_VALUE public static final Primitive VOID new Primitive Special VOID_TYPE private Primitive Object value if value null throw new InterpreterError this value value public Primitive Number number this Object number public Primitive Boolean value this Object value public Primitive Byte value this Object value public Primitive Short value this Object value public Primitive Character value this Object value public Primitive Integer value this Object value public Primitive Long value this Object value public Primitive Float value this Object value public Primitive Double value this Object value public Primitive boolean value this new Boolean value public Primitive byte value this new Byte value public Primitive short value this new Short value public Primitive char value this new Character value public Primitive int value this new Integer value public Primitive long value this new Long value public Primitive float value this new Float value public Primitive double value this new Double value public Object getValue if value Special NULL_VALUE return null else if value Special VOID_TYPE throw new InterpreterError else return value public String toString if value Special NULL_VALUE return else if value Special VOID_TYPE return else return value toString public Class getType return getType value private Class getType Object if instanceof Boolean return Boolean TYPE else if instanceof Byte return Byte TYPE else if instanceof Short return Short TYPE else if instanceof Character return Character TYPE else if instanceof Integer return Integer TYPE else if instanceof Long return Long TYPE else if instanceof Float return Float TYPE else if instanceof Double return Double TYPE return null public static Object binaryOperation Object obj1 Object obj2 int kind throws EvalError if obj1 NULL obj2 NULL throw new EvalError if obj1 VOID obj2 VOID throw new EvalError Class lhsOrgType obj1 getClass Class rhsOrgType obj2 getClass if obj1 instanceof Primitive obj1 Primitive obj1 getValue if obj2 instanceof Primitive obj2 Primitive obj2 getValue Object operands promotePrimitives obj1 obj2 Object lhs operands Object rhs operands if lhs getClass rhs getClass throw new EvalError lhs getClass rhs getClass Object result try result binaryOperationImpl lhs rhs kind catch ArithmeticException throw new TargetError if lhsOrgType Primitive class rhsOrgType Primitive class return new Primitive result else return result static Object binaryOperationImpl Object lhs Object rhs int kind throws EvalError if lhs instanceof Boolean return booleanBinaryOperation Boolean lhs Boolean rhs kind else if lhs instanceof Integer return intBinaryOperation Integer lhs Integer rhs kind else if lhs instanceof Long return longBinaryOperation Long lhs Long rhs kind else if lhs instanceof Float return floatBinaryOperation Float lhs Float rhs kind else if lhs instanceof Double return doubleBinaryOperation Double lhs Double rhs kind else throw new EvalError static Boolean booleanBinaryOperation Boolean B1 Boolean B2 int kind throws EvalError boolean lhs B1 booleanValue boolean rhs B2 booleanValue switch kind case EQ return new Boolean lhs rhs case NE return new Boolean lhs rhs case BOOL_OR case BOOL_ORX return new Boolean lhs rhs case BOOL_AND case BOOL_ANDX return new Boolean lhs rhs default throw new InterpreterError static Object longBinaryOperation Long L1 Long L2 int kind long lhs L1 longValue long rhs L2 longValue switch kind case LT case LTX return new Boolean lhs rhs case GT case GTX return new Boolean lhs rhs case EQ return new Boolean lhs rhs case LE case LEX return new Boolean lhs rhs case GE case GEX return new Boolean lhs rhs case NE return new Boolean lhs rhs case PLUS return new Long lhs rhs case MINUS return new Long lhs rhs case STAR return new Long lhs rhs case SLASH return new Long lhs rhs case MOD return new Long lhs rhs case LSHIFT case LSHIFTX return new Long lhs rhs case RSIGNEDSHIFT case RSIGNEDSHIFTX return new Long lhs rhs case RUNSIGNEDSHIFT case RUNSIGNEDSHIFTX return new Long lhs rhs case BIT_AND case BIT_ANDX return new Long lhs rhs case BIT_OR case BIT_ORX return new Long lhs rhs case XOR return new Long lhs rhs default throw new InterpreterError static Object intBinaryOperation Integer I1 Integer I2 int kind int lhs I1 intValue int rhs I2 intValue switch kind case LT case LTX return new Boolean lhs rhs case GT case GTX return new Boolean lhs rhs case EQ return new Boolean lhs rhs case LE case LEX return new Boolean lhs rhs case GE case GEX return new Boolean lhs rhs case NE return new Boolean lhs rhs case PLUS return new Integer lhs rhs case MINUS return new Integer lhs rhs case STAR return new Integer lhs rhs case SLASH return new Integer lhs rhs case MOD return new Integer lhs rhs case LSHIFT case LSHIFTX return new Integer lhs rhs case RSIGNEDSHIFT case RSIGNEDSHIFTX return new Integer lhs rhs case RUNSIGNEDSHIFT case RUNSIGNEDSHIFTX return new Integer lhs rhs case BIT_AND case BIT_ANDX return new Integer lhs rhs case BIT_OR case BIT_ORX return new Integer lhs rhs case XOR return new Integer lhs rhs default throw new InterpreterError static Object doubleBinaryOperation Double D1 Double D2 int kind throws EvalError double lhs D1 doubleValue double rhs D2 doubleValue switch kind case LT case LTX return new Boolean lhs rhs case GT case GTX return new Boolean lhs rhs case EQ return new Boolean lhs rhs case LE case LEX return new Boolean lhs rhs case GE case GEX return new Boolean lhs rhs case NE return new Boolean lhs rhs case PLUS return new Double lhs rhs case MINUS return new Double lhs rhs case STAR return new Double lhs rhs case SLASH return new Double lhs rhs case MOD return new Double lhs rhs case LSHIFT case LSHIFTX case RSIGNEDSHIFT case RSIGNEDSHIFTX case RUNSIGNEDSHIFT case RUNSIGNEDSHIFTX throw new EvalError default throw new InterpreterError static Object floatBinaryOperation Float F1 Float F2 int kind throws EvalError float lhs F1 floatValue float rhs F2 floatValue switch kind case LT case LTX return new Boolean lhs rhs case GT case GTX return new Boolean lhs rhs case EQ return new Boolean lhs rhs case LE case LEX return new Boolean lhs rhs case GE case GEX return new Boolean lhs rhs case NE return new Boolean lhs rhs case PLUS return new Float lhs rhs case MINUS return new Float lhs rhs case STAR return new Float lhs rhs case SLASH return new Float lhs rhs case MOD return new Float lhs rhs case LSHIFT case LSHIFTX case RSIGNEDSHIFT case RSIGNEDSHIFTX case RUNSIGNEDSHIFT case RUNSIGNEDSHIFTX throw new EvalError default throw new InterpreterError static Object promoteToInteger Object primitive if primitive instanceof Character return new Integer Character primitive charValue else if primitive instanceof Byte primitive instanceof Short return new Integer Number primitive intValue return primitive static Object promotePrimitives Object lhs Object rhs lhs promoteToInteger lhs rhs promoteToInteger rhs if lhs instanceof Number rhs instanceof Number Number lnum Number lhs Number rnum Number rhs boolean if lnum instanceof Double rnum instanceof Double if rhs new Double rnum doubleValue else lhs new Double lnum doubleValue else if lnum instanceof Float rnum instanceof Float if rhs new Float rnum floatValue else lhs new Float lnum floatValue else if lnum instanceof Long rnum instanceof Long if rhs new Long rnum longValue else lhs new Long lnum longValue return new Object lhs rhs public static Primitive unaryOperation Primitive val int kind throws EvalError if val NULL throw new EvalError if val VOID throw new EvalError Class operandType val getType Object operand promoteToInteger val getValue if operand instanceof Boolean return new Primitive booleanUnaryOperation Boolean operand kind else if operand instanceof Integer int result intUnaryOperation Integer operand kind if kind INCR kind DECR if operandType Byte TYPE return new Primitive byte result if operandType Short TYPE return new Primitive short result if operandType Character TYPE return new Primitive char result return new Primitive result else if operand instanceof Long return new Primitive longUnaryOperation Long operand kind else if operand instanceof Float return new Primitive floatUnaryOperation Float operand kind else if operand instanceof Double return new Primitive doubleUnaryOperation Double operand kind else throw new InterpreterError static boolean booleanUnaryOperation Boolean int kind throws EvalError boolean operand booleanValue switch kind case BANG return operand default throw new EvalError static int intUnaryOperation Integer int kind int operand intValue switch kind case PLUS return operand case MINUS return operand case TILDE return operand case INCR return operand case DECR return operand default throw new InterpreterError static long longUnaryOperation Long int kind long operand longValue switch kind case PLUS return operand case MINUS return operand case TILDE return operand case INCR return operand case DECR return operand default throw new InterpreterError static float floatUnaryOperation Float int kind float operand floatValue switch kind case PLUS return operand case MINUS return operand default throw new InterpreterError static double doubleUnaryOperation Double int kind double operand doubleValue switch kind case PLUS return operand case MINUS return operand default throw new InterpreterError public int intValue throws EvalError if value instanceof Number return Number value intValue else throw new EvalError public boolean booleanValue throws EvalError if value instanceof Boolean return Boolean value booleanValue else throw new EvalError public boolean isNumber return value instanceof Boolean this NULL this VOID public Number numberValue throws EvalError Object value this value if value instanceof Character value new Integer Character value charValue if value instanceof Number return Number value else throw new EvalError public boolean equals Object obj if obj instanceof Primitive return Primitive obj value equals this value else return obj equals this value public static Object unwrap Object obj if obj null return null if obj Primitive VOID return null if obj instanceof Primitive return Primitive obj getValue else return obj class Reflect public static Object invokeObjectMethod Interpreter interpreter Object object String methodName Object args SimpleNode callerInfo throws ReflectError InvocationTargetException EvalError if object instanceof This showThisMethod methodName return This object invokeMethod methodName args interpreter null callerInfo else return invokeMethod object getClass object methodName args false private static boolean showThisMethod String name return name equals name equals public static Object invokeStaticMethod Class clas String methodName Object args throws ReflectError InvocationTargetException EvalError Interpreter debug return invokeMethod clas null methodName args true public static Object getIndex Object array int index throws ReflectError TargetError Interpreter debug array index try Object val Array get array index return wrapPrimitive val array getClass getComponentType catch ArrayIndexOutOfBoundsException e1 throw new TargetError e1 catch Exception throw new ReflectError public static void setIndex Object array int index Object val throws ReflectError TargetError try val unwrapPrimitive val Array set array index val catch ArrayStoreException e2 throw new TargetError e2 catch IllegalArgumentException e1 throw new TargetError new ArrayStoreException e1 toString catch Exception throw new ReflectError public static Object getStaticField Class clas String fieldName throws ReflectError return getFieldValue clas null fieldName public static Object getObjectField Object object String fieldName throws ReflectError if object instanceof This return This object namespace getVariable fieldName else try return getFieldValue object getClass object fieldName catch ReflectError if hasObjectPropertyGetter object getClass fieldName return getObjectProperty object fieldName else throw static LHS getLHSStaticField Class clas String fieldName throws ReflectError Field getField clas fieldName return new LHS static LHS getLHSObjectField Object object String fieldName throws ReflectError if object instanceof This return new LHS This object namespace fieldName try Field getField object getClass fieldName return new LHS object catch ReflectError if hasObjectPropertySetter object getClass fieldName return new LHS object fieldName else throw private static Object getFieldValue Class clas Object object String fieldName throws ReflectError try Field getField clas fieldName if null throw new ReflectError fieldName Object value get object Class returnType getType return wrapPrimitive value returnType catch NullPointerException throw new ReflectError fieldName catch IllegalAccessException throw new ReflectError fieldName private static Field getField Class clas String fieldName throws ReflectError try if Capabilities haveAccessibility return findAccessibleField clas fieldName else return clas getField fieldName catch NoSuchFieldException throw new ReflectError fieldName private static Field findAccessibleField Class clas String fieldName throws NoSuchFieldException while clas null try Field field clas getDeclaredField fieldName if ReflectManager RMSetAccessible field return field catch NoSuchFieldException clas clas getSuperclass throw new NoSuchFieldException fieldName private static Object invokeMethod Class clas Object object String name Object args boolean onlyStatic throws ReflectError InvocationTargetException EvalError if object Primitive NULL throw new TargetError name new NullPointerException if object Primitive VOID throw new EvalError name if args null args new Object for int args length if args Primitive VOID throw new ReflectError name Class returnType null Object returnValue null Class types getTypes args unwrapPrimitives args try Method null try findAccessibleMethod clas name types onlyStatic catch SecurityException if null Interpreter debug StringUtil methodString name types clas getName if null if types length throw new ReflectError onlyStatic StringUtil methodString name types clas getName Method methods clas getMethods if onlyStatic methods retainStaticMethods methods findMostSpecificMethod name types methods methods clas getMethods if null findExtendedMethod name args methods if null try findAccessibleMethod clas getName getParameterTypes onlyStatic catch SecurityException if null throw new ReflectError onlyStatic StringUtil methodString name types clas getName returnValue invoke object args if returnValue null returnValue Primitive NULL returnType getReturnType catch IllegalAccessException throw new ReflectError StringUtil methodString name types clas getName return wrapPrimitive returnValue returnType private static Method retainStaticMethods Method methods Vector new Vector for int methods length if Modifier isStatic methods getModifiers addElement methods Method ma new Method size copyInto ma return ma static Method findAccessibleMethod Class clas String name Class types boolean onlyStatic Method meth null Vector classQ new Vector classQ addElement clas Method found null while classQ size Class Class classQ firstElement classQ removeElementAt if Modifier isPublic getModifiers Capabilities haveAccessibility ReflectManager RMSetAccessible try meth getDeclaredMethod name types if Modifier isPublic meth getModifiers Capabilities haveAccessibility ReflectManager RMSetAccessible meth break catch NoSuchMethodException if isInterface Class superclass getSuperclass if superclass null classQ addElement Object superclass Class intfs getInterfaces for int intfs length classQ addElement Object intfs if found null onlyStatic Modifier isStatic found getModifiers return found return null private static Object wrapPrimitive Object value Class returnType throws ReflectError if value null return Primitive NULL if returnType Void TYPE return Primitive VOID else if returnType isPrimitive if value instanceof Number return new Primitive Number value if value instanceof Boolean return new Primitive Boolean value if value instanceof Character return new Primitive Character value throw new ReflectError else return value public static Class getTypes Object args if args null return new Class Class types new Class args length for int args length if args null throw new InterpreterError if args instanceof Primitive types Primitive args getType else types args getClass return types private static void unwrapPrimitives Object args for int args length args unwrapPrimitive args private static Object unwrapPrimitive Object arg if arg instanceof Primitive return Primitive arg getValue else return arg static Object constructObject String clas Object args throws ReflectError InvocationTargetException Class BshClassManager classForName clas if null throw new ReflectError clas return constructObject args static Object constructObject Class clas Object args throws ReflectError InvocationTargetException for int args length if args Primitive VOID throw new ReflectError clas if clas isInterface throw new ReflectError clas Object obj null Class types getTypes args unwrapPrimitives args Constructor con null Constructor constructors clas getDeclaredConstructors Interpreter debug clas con findMostSpecificConstructor types constructors if con null if types length throw new ReflectError clas else con findExtendedConstructor args constructors if con null throw new ReflectError clas try obj con newInstance args catch InstantiationException throw new ReflectError catch IllegalAccessException throw new ReflectError catch IllegalArgumentException throw new ReflectError if obj null throw new ReflectError return obj static Method findMostSpecificMethod String name Class idealMatch Method methods Vector sigs new Vector Vector meths new Vector for int methods length if methods getName equals name meths addElement methods sigs addElement methods getParameterTypes Class candidates new Class sigs size sigs copyInto candidates Interpreter debug name int match findMostSpecificSignature idealMatch candidates if match return null else return Method meths elementAt match static Method findExtendedMethod String name Object args Method methods Method bestMatch null Object tempArgs new Object args length for int methods length Method currentMethod methods if name equals currentMethod getName Class parameters currentMethod getParameterTypes if parameters length args length continue try for int parameters length tempArgs NameSpace getAssignableForm args parameters System arraycopy tempArgs args args length return currentMethod catch EvalError return null static Constructor findMostSpecificConstructor Class idealMatch Constructor constructors Class candidates new Class constructors length for int candidates length candidates constructors getParameterTypes int match findMostSpecificSignature idealMatch candidates if match return null else return constructors match static Constructor findExtendedConstructor Object args Constructor constructors Constructor bestMatch null Object tempArgs new Object args length for int constructors length Constructor currentConstructor constructors Class parameters currentConstructor getParameterTypes if parameters length args length continue try for int parameters length tempArgs NameSpace getAssignableForm args parameters System arraycopy tempArgs args args length return currentConstructor catch EvalError return null static int findMostSpecificSignature Class idealMatch Class candidates Class bestMatch null int bestMatchIndex for int candidates length Class targetMatch candidates if isAssignable idealMatch targetMatch bestMatch null isAssignable targetMatch bestMatch bestMatch targetMatch bestMatchIndex if bestMatch null return bestMatchIndex else Interpreter debug return static boolean isAssignable Class from Class to if from null from new Class if to null to new Class if from length to length return false for int from length if to null continue if from null if to isPrimitive continue else return false if isAssignableFrom to from return false return true static boolean isAssignableFrom Class lhs Class rhs if lhs isPrimitive rhs isPrimitive if lhs rhs return true if rhs Byte TYPE lhs Short TYPE lhs Integer TYPE lhs Long TYPE lhs Float TYPE lhs Double TYPE return true if rhs Short TYPE lhs Integer TYPE lhs Long TYPE lhs Float TYPE lhs Double TYPE return true if rhs Character TYPE lhs Integer TYPE lhs Long TYPE lhs Float TYPE lhs Double TYPE return true if rhs Integer TYPE lhs Long TYPE lhs Float TYPE lhs Double TYPE return true if rhs Long TYPE lhs Float TYPE lhs Double TYPE return true if rhs Float TYPE lhs Double TYPE return true else if lhs isAssignableFrom rhs return true return false private static String accessorName String getorset String propName return getorset String valueOf Character toUpperCase propName charAt propName substring public static boolean hasObjectPropertyGetter Class clas String propName String getterName accessorName propName try clas getMethod getterName new Class return true catch NoSuchMethodException return false public static boolean hasObjectPropertySetter Class clas String propName String setterName accessorName propName Class sig new Class clas Method methods clas getMethods for int methods length if methods getName equals setterName return true return false public static Object getObjectProperty Object obj String propName throws ReflectError String accessorName accessorName propName Object args new Object Interpreter debug try try return invokeObjectMethod null obj accessorName args null catch EvalError throw new ReflectError catch InvocationTargetException throw new ReflectError public static void setObjectProperty Object obj String propName Object value throws ReflectError EvalError String accessorName accessorName propName Object args new Object value Interpreter debug try invokeObjectMethod null obj accessorName args null catch InvocationTargetException throw new EvalError public static String normalizeClassName Class type if type isArray return type getName StringBuffer className new StringBuffer try className append getArrayBaseType type getName for int getArrayDimensions type className append catch Exception return className toString public static int getArrayDimensions Class arrayClass if arrayClass isArray return return arrayClass getName lastIndexOf public static Class getArrayBaseType Class arrayClass throws ReflectError if arrayClass isArray throw new ReflectError return arrayClass getComponentType public class ContentManager public ContentManager text new char public final int getLength return length public String getText int start int len if start gapStart return new String text start gapEnd gapStart len else if start len gapStart return new String text start len else return new String text start gapStart start concat new String text gapEnd start len gapStart public void getText int start int len Segment seg if start gapStart seg array text seg offset start gapEnd gapStart seg count len else if start len gapStart seg array text seg offset start seg count len else seg array new char len System arraycopy text start seg array gapStart start System arraycopy text gapEnd seg array gapStart start len start gapStart seg offset seg count len public void insert int start String str int len str length if gapStart start gapEnd gapStart len ensureCapacity length len close start start len str getChars len text start gapStart len length len public void insert int start Segment seg if gapStart start gapEnd gapStart seg count ensureCapacity length seg count close start start seg count System arraycopy seg array seg offset text start seg count gapStart seg count length seg count public void char text int length this text text this gapStart this gapEnd this length length public void remove int start int len close start start gapEnd len length len private char text private int gapStart private int gapEnd private int length private void close int newStart int newEnd if gapStart newStart System arraycopy text gapEnd text newEnd length gapStart else if gapStart gapEnd gapStart length System arraycopy text gapEnd text gapStart length gapStart if newStart newEnd newStart length System arraycopy text newStart text newEnd length newStart gapStart newStart gapEnd newEnd private void ensureCapacity int capacity if capacity text length char textN new char capacity System arraycopy text textN length gapEnd gapStart text textN public class WorkThreadPool public WorkThreadPool String name int count listenerList new EventListenerList if count threadGroup new ThreadGroup name threads new WorkThread count for int threads length threads new WorkThread this threadGroup name else Log log Log WARNING this public void start synchronized lock started true if awtRequestCount requestCount queueAWTRunner if threads null for int threads length threads start public void addWorkRequest Runnable run boolean inAWT if threads null run run return synchronized lock if started inAWT requestCount awtRequestCount if SwingUtilities isEventDispatchThread run run else SwingUtilities invokeLater run return Request request new Request run if inAWT if firstAWTRequest null lastAWTRequest null firstAWTRequest lastAWTRequest request else lastAWTRequest next request lastAWTRequest request awtRequestCount if started requestCount queueAWTRunner else if firstRequest null lastRequest null firstRequest lastRequest request else lastRequest next request lastRequest request requestCount lock notify public void waitForRequests if threads null return synchronized waitForAllLock while requestCount try waitForAllLock wait catch InterruptedException ie Log log Log ERROR this ie if SwingUtilities isEventDispatchThread doAWTRequests else try SwingUtilities invokeAndWait new RunRequestsInAWTThread catch Exception Log log Log ERROR this public int getRequestCount return requestCount public int getThreadCount if threads null return else return threads length public WorkThread getThread int index return threads index public void addProgressListener WorkThreadProgressListener listener listenerList add WorkThreadProgressListener class listener public void removeProgressListener WorkThreadProgressListener listener listenerList remove WorkThreadProgressListener class listener Object lock new String Object waitForAllLock new String void fireStatusChanged WorkThread thread final Object listeners listenerList getListenerList if listeners length int index for int threads length if threads thread index break for int listeners length if listeners WorkThreadProgressListener class WorkThreadProgressListener listeners statusUpdate WorkThreadPool this index void fireProgressChanged WorkThread thread final Object listeners listenerList getListenerList if listeners length int index for int threads length if threads thread index break for int listeners length if listeners WorkThreadProgressListener class WorkThreadProgressListener listeners progressUpdate WorkThreadPool this index void requestDone synchronized lock requestCount if requestCount firstAWTRequest null queueAWTRunner Request getNextRequest synchronized lock Request request firstRequest if request null return null firstRequest firstRequest next if firstRequest null lastRequest null if request alreadyRun throw new InternalError request run request alreadyRun true return request private boolean started private ThreadGroup threadGroup private WorkThread threads private Request firstRequest private Request lastRequest private int requestCount private boolean awtRunnerQueued private Request firstAWTRequest private Request lastAWTRequest private int awtRequestCount private EventListenerList listenerList private void doAWTRequests while firstAWTRequest null doAWTRequest getNextAWTRequest private void doAWTRequest Request request try request run run catch Throwable Log log Log ERROR WorkThread class Log log Log ERROR WorkThread class awtRequestCount private void queueAWTRunner if awtRunnerQueued awtRunnerQueued true SwingUtilities invokeLater new RunRequestsInAWTThread private Request getNextAWTRequest Request request firstAWTRequest firstAWTRequest firstAWTRequest next if firstAWTRequest null lastAWTRequest null if request alreadyRun throw new InternalError request run request alreadyRun true return request static int ID static class Request int id ID Runnable run boolean alreadyRun Request next Request Runnable run this run run public String toString return id run class RunRequestsInAWTThread implements Runnable public void run synchronized lock awtRunnerQueued false if requestCount doAWTRequests public interface DockableWindow String DOCKABLE_WINDOW_LIST String getName Component getComponent class BSHMethodDeclaration extends SimpleNode String name BSHFormalParameters params BSHBlock block BSHMethodDeclaration int id super id public Object eval NameSpace namespace throws EvalError if block null if jjtGetNumChildren returnType BSHReturnType jjtGetChild getReturnType namespace params BSHFormalParameters jjtGetChild block BSHBlock jjtGetChild else params BSHFormalParameters jjtGetChild block BSHBlock jjtGetChild params eval namespace if Interpreter strictJava for int params argTypes length if params argTypes null throw new EvalError params argNames name this if returnType null throw new EvalError name this namespace setMethod name new BshMethod this namespace return Primitive VOID public String toString return name public abstract class EnhancedDialog extends JDialog public EnhancedDialog Frame parent String title boolean modal super parent title modal Container getLayeredPane addContainerListener new ContainerHandler getContentPane addContainerListener new ContainerHandler keyHandler new KeyHandler addKeyListener keyHandler addWindowListener new WindowHandler setDefaultCloseOperation DO_NOTHING_ON_CLOSE public abstract void ok public abstract void cancel protected KeyHandler keyHandler class ContainerHandler extends ContainerAdapter public void componentAdded ContainerEvent evt componentAdded evt getChild public void componentRemoved ContainerEvent evt componentRemoved evt getChild private void componentAdded Component comp comp addKeyListener keyHandler if comp instanceof Container Container cont Container comp cont addContainerListener this Component comps cont getComponents for int comps length componentAdded comps private void componentRemoved Component comp comp removeKeyListener keyHandler if comp instanceof Container Container cont Container comp cont removeContainerListener this Component comps cont getComponents for int comps length componentRemoved comps class KeyHandler extends KeyAdapter public void keyPressed KeyEvent evt if evt isConsumed return if evt getKeyCode KeyEvent VK_ENTER Component comp getFocusOwner while comp null if comp instanceof JComboBox JComboBox combo JComboBox comp if combo isEditable Object selected combo getEditor getItem if selected null combo setSelectedItem selected break comp comp getParent ok evt consume else if evt getKeyCode KeyEvent VK_ESCAPE cancel evt consume class WindowHandler extends WindowAdapter public void windowClosing WindowEvent evt cancel public class HandlerBase implements XmlHandler public void startDocument throws java lang Exception public void endDocument throws java lang Exception public Object resolveEntity String publicId String systemId throws java lang Exception return null public void startExternalEntity String systemId throws java lang Exception public void endExternalEntity String systemId throws java lang Exception public void doctypeDecl String name String publicId String systemId throws java lang Exception public void attribute String aname String value boolean isSpecified throws java lang Exception public void startElement String elname throws java lang Exception public void endElement String elname throws java lang Exception public void charData char ch int start int length throws java lang Exception public void ignorableWhitespace char ch int start int length throws java lang Exception public void processingInstruction String target String data throws java lang Exception public void error String message String systemId int line int column throws XmlException java lang Exception throw new XmlException message systemId line column public class ViewUpdate extends EBMessage NonVetoable public static final Object CREATED public static final Object CLOSED public ViewUpdate View view Object what super view if what null throw new NullPointerException this what what public Object getWhat return what public View getView return View getSource public String paramString return super paramString what private Object what public class TipOfTheDay extends EnhancedDialog public TipOfTheDay View view super view jEdit getProperty false JPanel content new JPanel new BorderLayout content setBorder new EmptyBorder setContentPane content JLabel label new JLabel jEdit getProperty label setFont new Font Font PLAIN label setForeground UIManager getColor content add BorderLayout NORTH label tipText new JEditorPane tipText setEditable false tipText setContentType nextTip JScrollPane scroller new JScrollPane tipText scroller setPreferredSize new Dimension content add BorderLayout CENTER scroller ActionHandler actionHandler new ActionHandler Box buttons new Box BoxLayout X_AXIS showNextTime new JCheckBox jEdit getProperty jEdit getBooleanProperty showNextTime addActionListener actionHandler buttons add showNextTime buttons add Box createHorizontalStrut buttons add Box createGlue nextTip new JButton jEdit getProperty nextTip addActionListener actionHandler buttons add nextTip buttons add Box createHorizontalStrut close new JButton jEdit getProperty close addActionListener actionHandler buttons add close content getRootPane setDefaultButton close Dimension dim nextTip getPreferredSize dim width Math max dim width close getPreferredSize width nextTip setPreferredSize dim close setPreferredSize dim content add BorderLayout SOUTH buttons setDefaultCloseOperation DISPOSE_ON_CLOSE pack setLocationRelativeTo view show public void ok dispose public void cancel dispose private JCheckBox showNextTime private JButton nextTip close private JEditorPane tipText private int currentTip private void nextTip File tips new File MiscUtilities constructPath jEdit getJEditHome listFiles if tips null tips length tipText setText jEdit getProperty return int count tips length int tipToShow currentTip while tipToShow currentTip tips tipToShow getName endsWith tipToShow Math abs new Random nextInt count try tipText setPage tips tipToShow toURL catch Exception Log log Log ERROR this class ActionHandler implements ActionListener public void actionPerformed ActionEvent evt Object source evt getSource if source showNextTime jEdit setBooleanProperty showNextTime isSelected else if source nextTip nextTip else if source close dispose public class OperatingSystem public static final boolean isDOSDerived return isWindows isOS2 public static final boolean isWindows return os WINDOWS_9x os WINDOWS_NT public static final boolean isWindows9x return os WINDOWS_9x public static final boolean isWindowsNT return os WINDOWS_NT public static final boolean isOS2 return os OS2 public static final boolean isUnix return os UNIX os MAC_OS_X public static final boolean isMacOS return os MAC_OS_X public static final boolean hasJava14 return java14 private static final int UNIX private static final int WINDOWS_9x private static final int WINDOWS_NT private static final int OS2 private static final int MAC_OS_X private static final int UNKNOWN private static int os private static boolean java14 static String osName System getProperty if osName indexOf osName indexOf os WINDOWS_9x else if osName indexOf os WINDOWS_NT else if osName indexOf os OS2 else if File separatorChar new File isDirectory if osName indexOf os MAC_OS_X else os UNIX else os UNKNOWN Log log Log WARNING OperatingSystem class osName if System getProperty compareTo java14 true class BSHUnaryExpression extends SimpleNode implements ParserConstants public int kind public boolean postfix false BSHUnaryExpression int id super id public Object eval CallStack callstack Interpreter interpreter throws EvalError SimpleNode node SimpleNode jjtGetChild if node instanceof BSHLHSPrimaryExpression return lhsUnaryOperation BSHLHSPrimaryExpression node toLHS callstack interpreter else return unaryOperation node eval callstack interpreter kind private Object lhsUnaryOperation LHS lhs throws EvalError Interpreter debug Object prevalue postvalue prevalue lhs getValue postvalue unaryOperation prevalue kind Object retVal if postfix retVal prevalue else retVal postvalue lhs assign postvalue return retVal private Object unaryOperation Object op int kind throws EvalError if op instanceof Boolean op instanceof Character op instanceof Number return primitiveWrapperUnaryOperation op kind if op instanceof Primitive throw new EvalError tokenImage kind this return Primitive unaryOperation Primitive op kind private Object primitiveWrapperUnaryOperation Object val int kind throws EvalError Class operandType val getClass Object operand Primitive promoteToInteger val if operand instanceof Boolean return new Boolean Primitive booleanUnaryOperation Boolean operand kind else if operand instanceof Integer int result Primitive intUnaryOperation Integer operand kind if kind INCR kind DECR if operandType Byte TYPE return new Byte byte result if operandType Short TYPE return new Short short result if operandType Character TYPE return new Character char result return new Integer result else if operand instanceof Long return new Long Primitive longUnaryOperation Long operand kind else if operand instanceof Float return new Float Primitive floatUnaryOperation Float operand kind else if operand instanceof Double return new Double Primitive doubleUnaryOperation Double operand kind else throw new InterpreterError class BSHReturnStatement extends SimpleNode implements ParserConstants public int kind BSHReturnStatement int id super id public Object eval CallStack callstack Interpreter interpreter throws EvalError Object value if jjtGetNumChildren value SimpleNode jjtGetChild eval callstack interpreter else value Primitive VOID return new ReturnControl kind value class BSHArguments extends SimpleNode BSHArguments int id super id public Object getArguments CallStack callstack Interpreter interpreter throws EvalError Object args new Object jjtGetNumChildren for int args length args SimpleNode jjtGetChild eval callstack interpreter return args class PluginList Vector plugins Hashtable pluginHash Vector pluginSets PluginList throws Exception plugins new Vector pluginHash new Hashtable pluginSets new Vector String path jEdit getProperty PluginListHandler handler new PluginListHandler this path XmlParser parser new XmlParser parser setHandler handler parser parse null null new BufferedReader new InputStreamReader new GZIPInputStream new URL path openStream void addPlugin Plugin plugin plugin checkIfInstalled plugins addElement plugin pluginHash put plugin name plugin void addPluginSet PluginSet set pluginSets addElement set void finished for int plugins size Plugin plugin Plugin plugins elementAt for int plugin branches size Branch branch Branch plugin branches elementAt for int branch deps size Dependency dep Dependency branch deps elementAt if dep what equals dep plugin Plugin pluginHash get dep pluginName void dump for int plugins size System err println Plugin plugins elementAt System err println static class PluginSet String name String description Vector plugins new Vector void install Roster roster String installDirectory boolean downloadSource for int plugins size Plugin plugin Plugin plugins elementAt if plugin canBeInstalled plugin install roster installDirectory downloadSource public String toString return plugins toString static class Plugin String jar String name String description String author Vector branches new Vector String installed String installedVersion void checkIfInstalled EditPlugin JAR jars jEdit getPluginJARs for int jars length String path jars getPath if new File path exists continue if MiscUtilities getFileName path equals jar installed path EditPlugin plugins jars getPlugins if plugins length installedVersion jEdit getProperty plugins getClassName break String notLoaded jEdit getNotLoadedPluginJARs for int notLoaded length String path notLoaded if MiscUtilities getFileName path equals jar installed path break Branch getCompatibleBranch for int branches size Branch branch Branch branches elementAt if branch canSatisfyDependencies return branch return null boolean canBeInstalled Branch branch getCompatibleBranch return branch null branch obsolete branch canSatisfyDependencies void install Roster roster String installDirectory boolean downloadSource if installed null roster addOperation new Roster Remove installed Branch branch getCompatibleBranch if branch obsolete return branch satisfyDependencies roster installDirectory downloadSource if installed null installDirectory MiscUtilities getParentOfPath installed roster addOperation new Roster Install downloadSource branch downloadSource branch download installDirectory public String toString return name static class Branch String version String date int downloadSize String download int downloadSourceSize String downloadSource boolean obsolete Vector deps new Vector boolean canSatisfyDependencies for int deps size Dependency dep Dependency deps elementAt if dep canSatisfy return false return true void satisfyDependencies Roster roster String installDirectory boolean downloadSource for int deps size Dependency dep Dependency deps elementAt dep satisfy roster installDirectory downloadSource public String toString return version download obsolete deps static class Dependency String what String from String to String pluginName Plugin plugin Dependency String what String from String to String pluginName this what what this from from this to to this pluginName pluginName boolean isSatisfied if what equals for int plugin branches size Branch branch Branch plugin branches elementAt if plugin installedVersion null from null MiscUtilities compareStrings plugin installedVersion from false to null MiscUtilities compareStrings plugin installedVersion to false return true return false else if what equals String javaVersion System getProperty substring if from null MiscUtilities compareStrings javaVersion from false to null MiscUtilities compareStrings javaVersion to false return true else return false else if what equals String build jEdit getBuild if from null MiscUtilities compareStrings build from false to null MiscUtilities compareStrings build to false return true else return false else Log log Log ERROR this what return false boolean canSatisfy if isSatisfied return true else if what equals return plugin canBeInstalled else return false void satisfy Roster roster String installDirectory boolean downloadSource if what equals for int plugin branches size Branch branch Branch plugin branches elementAt if plugin installedVersion null MiscUtilities compareStrings plugin installedVersion branch version false from null MiscUtilities compareStrings branch version from false to null MiscUtilities compareStrings branch version to false plugin install roster installDirectory downloadSource return public String toString return what from to plugin public class AbbrevEditor extends JPanel public AbbrevEditor GridBagLayout layout new GridBagLayout setLayout layout GridBagConstraints cons new GridBagConstraints cons anchor cons WEST cons fill cons BOTH cons weightx cons gridx cons gridy JLabel label new JLabel jEdit getProperty SwingConstants RIGHT label setBorder new EmptyBorder layout setConstraints label cons add label cons gridx cons weightx abbrev new JTextField layout setConstraints abbrev cons add abbrev cons gridx cons weightx cons gridwidth cons gridy label new JLabel jEdit getProperty label setBorder new EmptyBorder layout setConstraints label cons add label cons gridy cons weighty beforeCaret new JTextArea JScrollPane scroller new JScrollPane beforeCaret layout setConstraints scroller cons add scroller cons gridy cons weighty label new JLabel jEdit getProperty label setBorder new EmptyBorder layout setConstraints label cons add label cons gridy cons weighty afterCaret new JTextArea scroller new JScrollPane afterCaret layout setConstraints scroller cons add scroller public String getAbbrev return abbrev getText public void setAbbrev String abbrev this abbrev setText abbrev public String getExpansion StringBuffer buf new StringBuffer String beforeCaretText beforeCaret getText String afterCaretText afterCaret getText for int beforeCaretText length char ch beforeCaretText charAt switch ch case buf append break case buf append break case buf append break default buf append ch break if afterCaretText length buf append for int afterCaretText length char ch afterCaretText charAt switch ch case buf append break case buf append break case buf append break default buf append ch break return buf toString public void setExpansion String expansion if expansion null beforeCaret setText null afterCaret setText null return String beforeCaretText null String afterCaretText null StringBuffer buf new StringBuffer for int expansion length char ch expansion charAt if ch expansion length ch expansion charAt switch ch case buf append break case buf append break case beforeCaretText buf toString buf setLength break default buf append ch break else buf append ch if beforeCaretText null beforeCaretText buf toString else afterCaretText buf toString beforeCaret setText beforeCaretText afterCaret setText afterCaretText public JTextField getAbbrevField return abbrev public JTextArea getBeforeCaretTextArea return beforeCaret public JTextArea getAfterCaretTextArea return afterCaret private JTextField abbrev private JTextArea beforeCaret afterCaret public class EnhancedButton extends JButton public EnhancedButton Icon icon String toolTip EditAction action super icon this action action if action null setEnabled true addActionListener new EditAction Wrapper action addMouseListener new MouseHandler else setEnabled false setToolTipText toolTip Insets zeroInsets new Insets setMargin zeroInsets setRequestFocusEnabled false public boolean isFocusTraversable return false private EditAction action class MouseHandler extends MouseAdapter public void mouseEntered MouseEvent evt String msg action getMouseOverText if msg null GUIUtilities getView Component evt getSource getStatus setMessage msg public void mouseExited MouseEvent evt GUIUtilities getView Component evt getSource getStatus setMessage null public class ToolBarOptionPane extends AbstractOptionPane public ToolBarOptionPane super protected void setLayout new BorderLayout JPanel panel new JPanel new GridLayout showToolbar new JCheckBox jEdit getProperty showToolbar setSelected jEdit getBooleanProperty panel add showToolbar panel add new JLabel jEdit getProperty add BorderLayout NORTH panel String toolbar jEdit getProperty StringTokenizer st new StringTokenizer toolbar listModel new DefaultListModel while st hasMoreTokens String actionName String st nextToken if actionName equals listModel addElement new ToolBarOptionPane Button null null else EditAction action jEdit getAction actionName if action null continue String label action getLabel if label null continue Icon icon String iconName if actionName equals iconName null icon null else iconName jEdit getProperty actionName if iconName null continue icon GUIUtilities loadIcon iconName listModel addElement new Button actionName iconName icon label list new JList listModel list setSelectionMode ListSelectionModel SINGLE_SELECTION list addListSelectionListener new ListHandler list setCellRenderer new ButtonCellRenderer add BorderLayout CENTER new JScrollPane list JPanel buttons new JPanel buttons setBorder new EmptyBorder buttons setLayout new BoxLayout buttons BoxLayout X_AXIS buttons add Box createGlue ActionHandler actionHandler new ActionHandler add new JButton jEdit getProperty add addActionListener actionHandler buttons add add buttons add Box createHorizontalStrut remove new JButton jEdit getProperty remove addActionListener actionHandler buttons add remove buttons add Box createHorizontalStrut moveUp new JButton jEdit getProperty moveUp addActionListener actionHandler buttons add moveUp buttons add Box createHorizontalStrut moveDown new JButton jEdit getProperty moveDown addActionListener actionHandler buttons add moveDown buttons add Box createGlue updateButtons add BorderLayout SOUTH buttons iconList new DefaultComboBoxModel st new StringTokenizer jEdit getProperty while st hasMoreElements String icon st nextToken iconList addElement new IconListEntry GUIUtilities loadIcon icon icon static class ButtonCompare implements MiscUtilities Compare public int compare Object obj1 Object obj2 return MiscUtilities compareStrings Button obj1 label Button obj2 label true protected void jEdit setBooleanProperty showToolbar isSelected StringBuffer buf new StringBuffer for int listModel getSize if buf append Button button Button listModel elementAt buf append button actionName jEdit setProperty button actionName button iconName jEdit setProperty buf toString private JCheckBox showToolbar private DefaultListModel listModel private JList list private JButton add private JButton remove private JButton moveUp moveDown private DefaultComboBoxModel iconList private void updateButtons int index list getSelectedIndex remove setEnabled index listModel getSize moveUp setEnabled index moveDown setEnabled index index listModel getSize static class Button String actionName String iconName Icon icon String label Button String actionName String iconName Icon icon String label this actionName actionName this iconName iconName this icon icon this label GUIUtilities prettifyMenuLabel label public String toString return label static class IconListEntry Icon icon String name IconListEntry Icon icon String name this icon icon this name name static class ButtonCellRenderer extends DefaultListCellRenderer public Component getListCellRendererComponent JList list Object value int index boolean isSelected boolean cellHasFocus super getListCellRendererComponent list value index isSelected cellHasFocus Button button Button value setIcon button icon return this static class IconCellRenderer extends DefaultListCellRenderer public Component getListCellRendererComponent JList list Object value int index boolean isSelected boolean cellHasFocus super getListCellRendererComponent list value index isSelected cellHasFocus IconListEntry icon IconListEntry value setText icon name setIcon icon icon return this class ActionHandler implements ActionListener public void actionPerformed ActionEvent evt Object source evt getSource if source add ToolBarEditDialog dialog new ToolBarEditDialog ToolBarOptionPane this iconList null Button selection dialog getSelection if selection null return int index list getSelectedIndex if index index listModel getSize else index listModel insertElementAt selection index list setSelectedIndex index list ensureIndexIsVisible index else if source remove int index list getSelectedIndex listModel removeElementAt index updateButtons else if source moveUp int index list getSelectedIndex Object selected list getSelectedValue listModel removeElementAt index listModel insertElementAt selected index list setSelectedIndex index list ensureIndexIsVisible index else if source moveDown int index list getSelectedIndex Object selected list getSelectedValue listModel removeElementAt index listModel insertElementAt selected index list setSelectedIndex index list ensureIndexIsVisible index class ListHandler implements ListSelectionListener public void valueChanged ListSelectionEvent evt updateButtons class ToolBarEditDialog extends EnhancedDialog public ToolBarEditDialog Component comp DefaultComboBoxModel iconListModel ToolBarOptionPane Button current super JOptionPane getFrameForComponent comp jEdit getProperty true JPanel content new JPanel new BorderLayout content setBorder new EmptyBorder setContentPane content ActionHandler actionHandler new ActionHandler ButtonGroup grp new ButtonGroup JPanel typePanel new JPanel new GridLayout typePanel setBorder new EmptyBorder typePanel add new JLabel jEdit getProperty separator new JRadioButton jEdit getProperty separator addActionListener actionHandler grp add separator typePanel add separator action new JRadioButton jEdit getProperty action addActionListener actionHandler grp add action action setSelected true typePanel add action content add BorderLayout NORTH typePanel JPanel actionPanel new JPanel new BorderLayout ActionSet actionsList jEdit getActionSets Vector vec new Vector actionsList length for int actionsList length ActionSet actionSet actionsList if actionSet getActionCount vec addElement actionSet combo new JComboBox vec combo addActionListener actionHandler actionPanel add BorderLayout NORTH combo list new JList list setVisibleRowCount actionPanel add BorderLayout CENTER new JScrollPane list JPanel iconPanel new JPanel new BorderLayout JPanel labelPanel new JPanel new GridLayout labelPanel setBorder new EmptyBorder JPanel compPanel new JPanel new GridLayout grp new ButtonGroup labelPanel add builtin new JRadioButton jEdit getProperty builtin addActionListener actionHandler builtin setSelected true grp add builtin labelPanel add file new JRadioButton jEdit getProperty grp add file file addActionListener actionHandler iconPanel add BorderLayout WEST labelPanel builtinCombo new JComboBox iconListModel builtinCombo setRenderer new ToolBarOptionPane IconCellRenderer compPanel add builtinCombo fileButton new JButton jEdit getProperty fileButton setMargin new Insets fileButton setIcon GUIUtilities loadIcon fileButton setHorizontalAlignment SwingConstants LEFT fileButton addActionListener actionHandler compPanel add fileButton iconPanel add BorderLayout CENTER compPanel actionPanel add BorderLayout SOUTH iconPanel content add BorderLayout CENTER actionPanel JPanel southPanel new JPanel southPanel setLayout new BoxLayout southPanel BoxLayout X_AXIS southPanel setBorder new EmptyBorder southPanel add Box createGlue ok new JButton jEdit getProperty ok addActionListener actionHandler getRootPane setDefaultButton ok southPanel add ok southPanel add Box createHorizontalStrut cancel new JButton jEdit getProperty cancel addActionListener actionHandler southPanel add cancel southPanel add Box createGlue content add BorderLayout SOUTH southPanel updateEnabled updateList pack setLocationRelativeTo JOptionPane getFrameForComponent comp show public void ok isOK true dispose public void cancel dispose public ToolBarOptionPane Button getSelection if isOK return null if separator isSelected return new ToolBarOptionPane Button null null else Icon icon String iconName if builtin isSelected ToolBarOptionPane IconListEntry selectedIcon ToolBarOptionPane IconListEntry builtinCombo getSelectedItem icon selectedIcon icon iconName selectedIcon name else icon fileButton getIcon iconName fileIcon if iconName null iconName String label String actionName if action isSelected ToolBarOptionPane Button button ToolBarOptionPane Button list getSelectedValue label button label actionName button actionName else throw new InternalError return new ToolBarOptionPane Button actionName iconName icon label private boolean isOK private JRadioButton separator action private JComboBox combo private JList list private JRadioButton builtin private JComboBox builtinCombo private JRadioButton file private JButton fileButton private String fileIcon private JButton ok cancel private void updateEnabled combo setEnabled action isSelected list setEnabled action isSelected boolean iconControlsEnabled separator isSelected builtin setEnabled iconControlsEnabled file setEnabled iconControlsEnabled builtinCombo setEnabled iconControlsEnabled builtin isSelected fileButton setEnabled iconControlsEnabled file isSelected private void updateList ActionSet actionSet ActionSet combo getSelectedItem EditAction actions actionSet getActions Vector listModel new Vector actions length for int actions length EditAction action actions String label action getLabel if label null continue listModel addElement new ToolBarOptionPane Button action getName null null label MiscUtilities quicksort listModel new ToolBarOptionPane ButtonCompare list setListData listModel class ActionHandler implements ActionListener public void actionPerformed ActionEvent evt Object source evt getSource if source instanceof JRadioButton updateEnabled if source ok ok else if source cancel cancel else if source combo updateList else if source fileButton String directory if fileIcon null directory null else directory MiscUtilities getParentOfPath fileIcon String paths GUIUtilities showVFSFileDialog null directory VFSBrowser OPEN_DIALOG false if paths null return fileIcon paths try fileButton setIcon new ImageIcon new URL fileIcon catch MalformedURLException mf Log log Log ERROR this mf fileButton setText MiscUtilities getFileName fileIcon class ReflectError extends Exception public ReflectError super public ReflectError String super class ActionListHandler extends HandlerBase ActionListHandler String path ActionSet actionSet this path path this actionSet actionSet stateStack new Stack public Object resolveEntity String publicId String systemId if equals systemId return new StringReader return null public void attribute String aname String value boolean isSpecified aname aname null null aname intern value value null null value intern if aname actionName value else if aname noRepeat value else if aname noRecord value public void doctypeDecl String name String publicId String systemId throws Exception if equals name return Log log Log ERROR this path public void charData char int off int len String tag peekElement String text new String off len if tag code text else if tag isSelected text public void startElement String tag tag pushElement tag if tag code null isSelected null public void endElement String name if name null return String tag peekElement if name equals tag if tag actionSet addAction new BeanShellAction actionName code isSelected noRepeat noRecord noRepeat noRecord false popElement else throw new InternalError public void startDocument try pushElement null catch Exception printStackTrace private String path private ActionSet actionSet private String actionName private String code private String isSelected private boolean noRepeat private boolean noRecord private Stack stateStack private String pushElement String name name name null null name intern stateStack push name return name private String peekElement return String stateStack peek private String popElement return String stateStack pop public class MarkersMenu extends EnhancedMenu public MarkersMenu super public void setPopupMenuVisible boolean if final View view GUIUtilities getView this if getMenuComponentCount for int getMenuComponentCount Component comp getMenuComponent if comp instanceof JSeparator break else remove comp Buffer buffer view getBuffer Vector markers buffer getMarkers if markers size JMenuItem mi new JMenuItem jEdit getProperty mi setEnabled false add mi super setPopupMenuVisible return JMenu current this for int markers size final Marker marker Marker markers elementAt int lineNo buffer getLineOfOffset marker getPosition if current getItemCount markers size JMenu newCurrent new JMenu jEdit getProperty current add newCurrent current newCurrent JMenuItem mi new MarkersMenuItem buffer lineNo marker getShortcut mi addActionListener new ActionListener public void actionPerformed ActionEvent evt view getTextArea setCaretPosition marker getPosition current add mi super setPopupMenuVisible static class MarkersMenuItem extends JMenuItem MarkersMenuItem Buffer buffer int lineNo char shortcut String text buffer getLineText lineNo trim if text length text jEdit getProperty setText lineNo text shortcutProp MarkersMenuItem this shortcut shortcut public Dimension getPreferredSize Dimension super getPreferredSize String shortcut getShortcut if shortcut null width getFontMetrics acceleratorFont stringWidth shortcut return public void paint Graphics super paint String shortcut getShortcut if shortcut null setFont acceleratorFont setColor getModel isArmed acceleratorSelectionForeground acceleratorForeground FontMetrics fm getFontMetrics Insets insets getInsets drawString shortcut getWidth fm stringWidth shortcut insets right insets left getFont getSize insets top private String shortcutProp private char shortcut private static Font acceleratorFont private static Color acceleratorForeground private static Color acceleratorSelectionForeground private String getShortcut if shortcut return null else String shortcutPrefix jEdit getProperty shortcutProp if shortcutPrefix null return null else return shortcutPrefix shortcut static acceleratorFont UIManager getFont acceleratorFont new Font acceleratorFont getStyle acceleratorFont getSize acceleratorForeground UIManager getColor acceleratorSelectionForeground UIManager getColor public class VFSFileChooserDialog extends EnhancedDialog implements WorkThreadProgressListener public VFSFileChooserDialog View view String path int mode boolean multipleSelection super view jEdit getProperty true JPanel content new JPanel new BorderLayout content setBorder new EmptyBorder setContentPane content String name if path null path endsWith File separator path endsWith name null else VFS vfs VFSManager getVFSForPath path name vfs getFileName path path vfs getParentOfPath path browser new VFSBrowser view path mode multipleSelection true browser addBrowserListener new BrowserHandler content add BorderLayout CENTER browser JPanel bottomPanel new JPanel new BorderLayout JPanel panel new JPanel panel setLayout new BoxLayout panel BoxLayout X_AXIS panel setBorder new EmptyBorder JLabel label new JLabel jEdit getProperty panel add label panel add Box createHorizontalStrut filenameField new JTextField filenameField setText name filenameField addKeyListener new KeyHandler filenameField selectAll label setDisplayedMnemonic jEdit getProperty charAt label setLabelFor filenameField Dimension dim filenameField getPreferredSize dim width Integer MAX_VALUE filenameField setMaximumSize dim Box box new Box BoxLayout Y_AXIS box add Box createGlue box add filenameField box add Box createGlue panel add box panel add Box createHorizontalStrut if mode VFSBrowser BROWSER mode VFSBrowser OPEN_DIALOG GUIUtilities requestFocus this browser getBrowserView getDefaultFocusComponent else GUIUtilities requestFocus this filenameField ok new JButton jEdit getProperty mode VFSBrowser OPEN_DIALOG ok addActionListener new ActionHandler getRootPane setDefaultButton ok panel add ok panel add Box createHorizontalStrut cancel new JButton jEdit getProperty cancel addActionListener new ActionHandler panel add cancel bottomPanel add BorderLayout NORTH panel status new JLabel status setBorder new EmptyBorder bottomPanel add BorderLayout SOUTH status content add BorderLayout SOUTH bottomPanel VFSManager getIOThreadPool addProgressListener this pack GUIUtilities loadGeometry this show public void dispose GUIUtilities saveGeometry this VFSManager getIOThreadPool removeProgressListener this super dispose public void ok VFS DirectoryEntry files browser getSelectedFiles String directory browser getDirectory if files length filename filenameField getText if filename length getToolkit beep return else for int files length VFS DirectoryEntry file files if file type VFS DirectoryEntry FILESYSTEM file type VFS DirectoryEntry DIRECTORY browser setDirectory file path return else if browser getMode VFSBrowser SAVE_DIALOG filename file path if browser getMode VFSBrowser SAVE_DIALOG if MiscUtilities isURL directory MiscUtilities isURL filename filename MiscUtilities constructPath directory MiscUtilities canonPath filename if doFileExistsWarning filename return isOK true dispose public void cancel dispose public String getSelectedFiles if isOK return null if filename null String path browser getDirectory return new String MiscUtilities constructPath path filename else Vector vector new Vector VFS DirectoryEntry selectedFiles browser getSelectedFiles for int selectedFiles length VFS DirectoryEntry file selectedFiles if file type VFS DirectoryEntry FILE vector addElement file path String retVal new String vector size vector copyInto retVal return retVal public void statusUpdate final WorkThreadPool threadPool int threadIndex SwingUtilities invokeLater new Runnable public void run int requestCount threadPool getRequestCount if requestCount status setText jEdit getProperty else if requestCount status setText jEdit getProperty else Object args new Integer requestCount status setText jEdit getProperty args public void progressUpdate WorkThreadPool threadPool int threadIndex private VFSBrowser browser private JTextField filenameField private JLabel status private String filename private JButton ok private JButton cancel private boolean isOK private boolean doFileExistsWarning String filename if new File filename exists String args MiscUtilities getFileName filename int result GUIUtilities confirm browser args JOptionPane YES_NO_OPTION JOptionPane WARNING_MESSAGE if result JOptionPane YES_OPTION return true return false class ActionHandler implements ActionListener public void actionPerformed ActionEvent evt if evt getSource ok if browser getDirectory equals browser getDirectoryField getText browser setDirectory browser getDirectoryField getText return ok else if evt getSource cancel cancel class BrowserHandler implements BrowserListener public void filesSelected VFSBrowser browser VFS DirectoryEntry files if files length return else if files length VFS DirectoryEntry file files if file type VFS DirectoryEntry FILE String path file path String directory browser getDirectory VFS vfs VFSManager getVFSForPath directory String parent vfs getParentOfPath path if parent endsWith parent endsWith File separator parent parent substring parent length if parent equals directory path file name filenameField setText path else filenameField setText null public void filesActivated VFSBrowser browser VFS DirectoryEntry files for int files length VFS DirectoryEntry file files if file type VFS DirectoryEntry FILESYSTEM file type VFS DirectoryEntry DIRECTORY return ok class KeyHandler extends KeyAdapter public void keyPressed KeyEvent evt browser getBrowserView selectNone class BSHStatementExpressionList extends SimpleNode BSHStatementExpressionList int id super id public Object eval CallStack callstack Interpreter interpreter throws EvalError int jjtGetNumChildren for int SimpleNode node SimpleNode jjtGetChild node eval callstack interpreter return Primitive VOID public class LogViewer extends JPanel public LogViewer super new BorderLayout Box captionBox Box createHorizontalBox String settingsDirectory jEdit getSettingsDirectory if settingsDirectory null String args MiscUtilities constructPath settingsDirectory JLabel label new JLabel jEdit getProperty args captionBox add label captionBox add Box createHorizontalGlue tailIsOn jEdit getBooleanProperty false tail new JCheckBox jEdit getProperty tailIsOn tail addActionListener new ActionHandler captionBox add tail textArea new JTextArea textArea setDocument Log getLogDocument textArea getDocument addDocumentListener new DocumentHandler add BorderLayout NORTH captionBox add BorderLayout CENTER new JScrollPane textArea private JTextArea textArea private JCheckBox tail private boolean tailIsOn class ActionHandler implements ActionListener public void actionPerformed ActionEvent tailIsOn tailIsOn jEdit setBooleanProperty tailIsOn if tailIsOn textArea setCaretPosition textArea getDocument getLength class DocumentHandler implements DocumentListener public void insertUpdate DocumentEvent if tailIsOn textArea setCaretPosition textArea getDocument getLength public void changedUpdate DocumentEvent public void removeUpdate DocumentEvent public class FileVFS extends VFS public static final String PERMISSIONS_PROPERTY public FileVFS super public int getCapabilities return READ_CAP WRITE_CAP BROWSE_CAP DELETE_CAP RENAME_CAP MKDIR_CAP public String getParentOfPath String path if OperatingSystem isDOSDerived if path length path charAt return FileRootsVFS PROTOCOL else if path length path endsWith return FileRootsVFS PROTOCOL else if path startsWith path indexOf return path return super getParentOfPath path public String constructPath String parent String path if parent endsWith File separator path parent path else path parent File separator path try return new File path getCanonicalPath catch IOException io return path public char getFileSeparator return File separatorChar public boolean load View view Buffer buffer String path File file new File MiscUtilities canonPath path if file exists buffer setNewFile true return true else buffer setReadOnly file canWrite if file isDirectory VFSManager error view file getPath null buffer setNewFile false return false if file canRead VFSManager error view file getPath null buffer setNewFile false return false return super load view buffer path public boolean save View view Buffer buffer String path File file new File path if file isDirectory VFSManager error view file getPath null return false if file exists file canWrite file exists new File file getParent canWrite VFSManager error view file getPath null return false if OperatingSystem isUnix int permissions getPermissions buffer getPath Log log Log DEBUG this buffer getPath Integer toString permissions buffer setIntegerProperty PERMISSIONS_PROPERTY permissions return super save view buffer path public boolean insert View view Buffer buffer String path File file new File path if file exists return false if file isDirectory VFSManager error view file getPath null return false if file canRead VFSManager error view file getPath null return false return super insert view buffer path public String Object session String path Component comp throws IOException return MiscUtilities canonPath path public VFS DirectoryEntry Object session String path Component comp if OperatingSystem isWindows if path length path charAt path path concat File separator File directory new File path File list directory listFiles if list null VFSManager error comp path null return null Vector list2 new Vector for int list length File file list int type if file isDirectory type VFS DirectoryEntry DIRECTORY else type VFS DirectoryEntry FILE list2 add new VFS DirectoryEntry file getName file getPath file getPath type file length file isHidden VFS DirectoryEntry retVal new VFS DirectoryEntry list2 size list2 copyInto retVal return retVal public DirectoryEntry Object session String path Component comp if path endsWith path endsWith File separator path path substring path length File file new File path if file exists return null int type if file isDirectory type VFS DirectoryEntry DIRECTORY else type VFS DirectoryEntry FILE return new VFS DirectoryEntry file getName path path type file length file isHidden public boolean Object session String path Component comp boolean retVal new File path delete if retVal VFSManager sendVFSUpdate this path true return retVal public boolean Object session String from String to Component comp File new File to if from equalsIgnoreCase to delete boolean retVal new File from renameTo VFSManager sendVFSUpdate this from true VFSManager sendVFSUpdate this to true return retVal public boolean Object session String directory Component comp boolean retVal new File directory mkdirs VFSManager sendVFSUpdate this directory true return retVal public void Object session String path Component comp throws IOException int backups jEdit getIntegerProperty if backups return String backupPrefix jEdit getProperty String backupSuffix jEdit getProperty String backupDirectory MiscUtilities canonPath jEdit getProperty File file new File path if backupDirectory null backupDirectory length backupDirectory file getParent else backupDirectory MiscUtilities constructPath System getProperty backupDirectory backupDirectory MiscUtilities concatPath backupDirectory file getParent File dir new File backupDirectory if dir exists dir mkdirs MiscUtilities saveBackup file backups backupPrefix backupSuffix backupDirectory public InputStream Object session String path boolean ignoreErrors Component comp throws IOException try return new FileInputStream path catch IOException io if ignoreErrors return null else throw io public OutputStream Object session String path Component comp throws IOException OutputStream retVal new FileOutputStream path return retVal public void Object session Buffer buffer Component comp int permissions buffer getIntegerProperty PERMISSIONS_PROPERTY setPermissions buffer getPath permissions public static int getPermissions String path int permissions if OperatingSystem isUnix String cmdarray path try Process process Runtime getRuntime exec cmdarray BufferedReader reader new BufferedReader new InputStreamReader process getInputStream String output reader readLine if output null String output substring if length if charAt permissions if charAt permissions if charAt permissions else if charAt permissions else if charAt permissions if charAt permissions if charAt permissions if charAt permissions else if charAt permissions else if charAt permissions if charAt permissions if charAt permissions if charAt permissions else if charAt permissions else if charAt permissions catch Throwable return permissions public static void setPermissions String path int permissions if permissions if OperatingSystem isUnix String cmdarray Integer toString permissions path try Process process Runtime getRuntime exec cmdarray process getInputStream close process getOutputStream close process getErrorStream close int exitCode process waitFor if exitCode Log log Log NOTICE FileVFS class exitCode catch Throwable public class LoadSaveOptionPane extends AbstractOptionPane public LoadSaveOptionPane super public void autosave new JTextField jEdit getProperty addComponent jEdit getProperty autosave backups new JTextField jEdit getProperty addComponent jEdit getProperty backups backupDirectory new JTextField jEdit getProperty addComponent jEdit getProperty backupDirectory backupPrefix new JTextField jEdit getProperty addComponent jEdit getProperty backupPrefix backupSuffix new JTextField jEdit getProperty addComponent jEdit getProperty backupSuffix String lineSeps jEdit getProperty jEdit getProperty jEdit getProperty lineSeparator new JComboBox lineSeps String lineSep jEdit getProperty System getProperty if equals lineSep lineSeparator setSelectedIndex else if equals lineSep lineSeparator setSelectedIndex else if equals lineSep lineSeparator setSelectedIndex addComponent jEdit getProperty lineSeparator DefaultComboBoxModel encodings new DefaultComboBoxModel StringTokenizer st new StringTokenizer jEdit getProperty while st hasMoreTokens encodings addElement st nextToken encoding new JComboBox encodings encoding setEditable true encoding setSelectedItem jEdit getProperty System getProperty addComponent jEdit getProperty encoding ioThreadCount new JTextField jEdit getProperty addComponent jEdit getProperty ioThreadCount restore new JCheckBox jEdit getProperty restore setSelected jEdit getBooleanProperty restore addActionListener new ActionListener public void actionPerformed ActionEvent evt restoreCLI setEnabled restore isSelected addComponent restore restoreCLI new JCheckBox jEdit getProperty restoreCLI setSelected jEdit getBooleanProperty restoreCLI setEnabled restore isSelected addComponent restoreCLI newView new JCheckBox jEdit getProperty newView setSelected jEdit getBooleanProperty addComponent newView persistentMarkers new JCheckBox jEdit getProperty persistentMarkers setSelected jEdit getBooleanProperty addComponent persistentMarkers twoStageSave new JCheckBox jEdit getProperty twoStageSave setSelected jEdit getBooleanProperty addComponent twoStageSave backupEverySave new JCheckBox jEdit getProperty backupEverySave setSelected jEdit getBooleanProperty addComponent backupEverySave public void jEdit setProperty autosave getText jEdit setProperty backups getText jEdit setProperty backupDirectory getText jEdit setProperty backupPrefix getText jEdit setProperty backupSuffix getText String lineSep null switch lineSeparator getSelectedIndex case lineSep break case lineSep break case lineSep break jEdit setProperty lineSep jEdit setProperty String encoding getSelectedItem jEdit setProperty ioThreadCount getText jEdit setBooleanProperty restore isSelected jEdit setBooleanProperty restoreCLI isSelected jEdit setBooleanProperty newView isSelected jEdit setBooleanProperty persistentMarkers isSelected jEdit setBooleanProperty twoStageSave isSelected jEdit setBooleanProperty backupEverySave isSelected private JTextField autosave private JTextField backups private JTextField backupDirectory private JTextField backupPrefix private JTextField backupSuffix private JComboBox lineSeparator private JComboBox encoding private JTextField ioThreadCount private JCheckBox restore private JCheckBox restoreCLI private JCheckBox newView private JCheckBox persistentMarkers private JCheckBox twoStageSave private JCheckBox backupEverySave class SimpleNode implements Node protected Node parent protected Node children protected int id Token firstToken lastToken String sourceFile public SimpleNode int id public void jjtOpen public void jjtClose public void jjtSetParent Node parent public Node jjtGetParent return parent public void jjtAddChild Node int if children null children new Node else if children length Node new Node System arraycopy children children length children children public Node jjtGetChild int return children public SimpleNode getChild int return SimpleNode jjtGetChild public int jjtGetNumChildren return children null children length public String toString return ParserTreeConstants jjtNodeName id public String toString String prefix return prefix toString public void dump String prefix System out println toString prefix if children null for int children length SimpleNode SimpleNode children if null dump prefix public void prune jjtSetParent null public Object eval NameSpace namespace throws EvalError throw new EvalError getClass getName public Object eval CallStack callstack Interpreter interpreter throws EvalError return eval callstack top public void setSourceFile String sourceFile this sourceFile sourceFile public String getSourceFile if sourceFile null if parent null return SimpleNode parent getSourceFile else return else return sourceFile public int getLineNumber return firstToken beginLine public String getText StringBuffer text new StringBuffer Token firstToken while null text append image if image equals text append if lastToken image equals image equals break next return text toString public class EditorStarted extends EBMessage NonVetoable public EditorStarted EBComponent source super source class BSHVariableDeclarator extends SimpleNode public String name BSHVariableDeclarator int id super id public Object eval BSHType typeNode CallStack callstack Interpreter interpreter throws EvalError Object value Primitive VOID if jjtGetNumChildren SimpleNode initializer SimpleNode jjtGetChild if typeNode null initializer instanceof BSHArrayInitializer value BSHArrayInitializer initializer eval typeNode getBaseType typeNode getArrayDims callstack interpreter else value initializer eval callstack interpreter return value public interface WorkThreadProgressListener extends EventListener void statusUpdate WorkThreadPool threadPool int threadIndex void progressUpdate WorkThreadPool threadPool int threadIndex public class ParserRuleSet public ParserRuleSet String name Mode mode this name name this mode mode ruleMapFirst new ParserRule RULE_BUCKET_COUNT ruleMapLast new ParserRule RULE_BUCKET_COUNT public Mode getMode return mode public Hashtable getProperties return props public void setProperties Hashtable props this props props public void addRule ParserRule int key Character toUpperCase searchChars RULE_BUCKET_COUNT ParserRule last ruleMapLast key if last null ruleMapFirst key ruleMapLast key else last next ruleMapLast key public ParserRule getRules char ch int key Character toUpperCase ch RULE_BUCKET_COUNT return ruleMapFirst key public int getTerminateChar return terminateChar public void setTerminateChar int atChar terminateChar atChar atChar public boolean getIgnoreCase return ignoreCase public void setIgnoreCase boolean ignoreCase public KeywordMap getKeywords return keywords public void setKeywords KeywordMap km keywords km public boolean getHighlightDigits return highlightDigits public void setHighlightDigits boolean highlightDigits this highlightDigits highlightDigits public ParserRule getEscapeRule return escapeRule public Segment getEscapePattern if escapePattern null escapeRule null escapePattern new Segment escapeRule searchChars escapeRule sequenceLengths return escapePattern public void setEscape String esc if esc null escapeRule null else escapeRule ParserRuleFactory createEscapeRule esc escapePattern null public byte getDefault return defaultToken public void setDefault byte def defaultToken def public String toString return getClass getName mode getName name private static final int RULE_BUCKET_COUNT private String name private Mode mode private Hashtable props private KeywordMap keywords private ParserRule ruleMapFirst private ParserRule ruleMapLast private ParserRule escapeRule private Segment escapePattern private int terminateChar private boolean ignoreCase true private boolean highlightDigits private byte defaultToken public class IOProgressMonitor extends JFrame public IOProgressMonitor super jEdit getProperty JPanel content new JPanel new BorderLayout content setBorder new EmptyBorder setContentPane content caption new JLabel updateCaption content add BorderLayout NORTH caption Box threadBox new Box BoxLayout Y_AXIS threads new ThreadProgress VFSManager getIOThreadPool getThreadCount for int threads length threadBox add Box createVerticalStrut threads new ThreadProgress threadBox add threads content add BorderLayout CENTER threadBox workThreadHandler new WorkThreadHandler VFSManager getIOThreadPool addProgressListener workThreadHandler setDefaultCloseOperation DISPOSE_ON_CLOSE pack GUIUtilities loadGeometry this show public void dispose GUIUtilities saveGeometry this VFSManager getIOThreadPool removeProgressListener workThreadHandler super dispose private JLabel caption private ThreadProgress threads private WorkThreadHandler workThreadHandler private void updateCaption String args String valueOf VFSManager getIOThreadPool getRequestCount caption setText jEdit getProperty args class WorkThreadHandler implements WorkThreadProgressListener public void statusUpdate final WorkThreadPool pool final int index SwingUtilities invokeLater new Runnable public void run updateCaption threads index update public void progressUpdate final WorkThreadPool pool final int index SwingUtilities invokeLater new Runnable public void run updateCaption threads index update class ThreadProgress extends JPanel public ThreadProgress int index super new BorderLayout this index index JPanel box new JPanel box setBorder new EmptyBorder box setLayout new BoxLayout box BoxLayout Y_AXIS box add Box createGlue box add progress new JProgressBar progress setStringPainted true box add Box createGlue ThreadProgress this add BorderLayout CENTER box abort new JButton jEdit getProperty abort addActionListener new ActionHandler ThreadProgress this add BorderLayout EAST abort update public void update WorkThread thread VFSManager getIOThreadPool getThread index if thread isRequestRunning abort setEnabled true progress setString thread getStatus progress setMaximum thread getProgressMaximum progress setValue thread getProgressValue else abort setEnabled false progress setString jEdit getProperty progress setValue private int index private JProgressBar progress private JButton abort class ActionHandler implements ActionListener public void actionPerformed ActionEvent evt if evt getSource abort int result GUIUtilities confirm IOProgressMonitor this null JOptionPane YES_NO_OPTION JOptionPane QUESTION_MESSAGE if result JOptionPane YES_OPTION VFSManager getIOThreadPool getThread index abortCurrentRequest class PluginListDownloadProgress extends JDialog PluginListDownloadProgress PluginManager window super JOptionPane getFrameForComponent window jEdit getProperty true this window window JPanel content new JPanel new BorderLayout content setBorder new EmptyBorder setContentPane content JLabel caption new JLabel jEdit getProperty caption setBorder new EmptyBorder content add BorderLayout NORTH caption Box box new Box BoxLayout X_AXIS box add Box createGlue JButton stop new JButton jEdit getProperty stop addActionListener new ActionHandler stop setMaximumSize stop getPreferredSize box add stop box add Box createGlue content add BorderLayout CENTER box addWindowListener new WindowHandler setDefaultCloseOperation DO_NOTHING_ON_CLOSE pack setLocationRelativeTo window setResizable false show PluginList getPluginList return list private PluginManager window private PluginList list private DownloadThread thread class DownloadThread extends Thread public void run try list new PluginList dispose catch XmlException xe dispose int line xe getLine String path jEdit getProperty String message xe getMessage Log log Log ERROR this path line message String pp path String valueOf line message GUIUtilities error window pp catch Exception dispose Log log Log ERROR this String pp toString GUIUtilities error window pp class ActionHandler implements ActionListener public void actionPerformed ActionEvent evt thread stop dispose class WindowHandler extends WindowAdapter boolean done public void windowOpened WindowEvent evt if done return done true thread new DownloadThread thread start public void windowClosing WindowEvent evt thread stop public class LineElement implements Element public LineElement Buffer buffer int line this buffer buffer this line line public Document getDocument return null public Element getParentElement return null public String getName return null public AttributeSet getAttributes return null public int getStartOffset return buffer getLineStartOffset line public int getEndOffset return buffer getLineEndOffset line public int getElementIndex int offset return public int getElementCount return public Element getElement int line return null public boolean isLeaf return true private Buffer buffer private int line public class BufferUpdate extends EBMessage NonVetoable public static final Object CREATED public static final Object LOAD_STARTED public static final Object LOADED public static final Object CLOSED public static final Object DIRTY_CHANGED public static final Object MARKERS_CHANGED public static final Object MODE_CHANGED public static final Object ENCODING_CHANGED public static final Object FOLD_HANDLER_CHANGED public static final Object SAVING public static final Object SAVED public BufferUpdate Buffer buffer View view Object what super buffer this view view if what null throw new NullPointerException this what what public Object getWhat return what public Buffer getBuffer return Buffer getSource public View getView return view public String paramString return super paramString what view private Object what private View view public interface SearchFileSet String getFirstFile View view String getNextFile View view String path String getFiles View view int getFileCount String getCode public interface NameSource public String getAllNames public void addNameSourceListener NameSource Listener listener public static interface Listener public void nameSourceChanged NameSource src class TokenMgrError extends Error static final int LEXICAL_ERROR static final int STATIC_LEXER_ERROR static final int INVALID_LEXICAL_STATE static final int LOOP_DETECTED int errorCode protected static final String addEscapes String str StringBuffer retval new StringBuffer char ch for int str length switch str charAt case continue case retval append continue case retval append continue case retval append continue case retval append continue case retval append continue case retval append continue case retval append continue case retval append continue default if ch str charAt ch String Integer toString ch retval append substring length length else retval append ch continue return retval toString private static final String LexicalError boolean EOFSeen int lexState int errorLine int errorColumn String errorAfter char curChar return errorLine errorColumn EOFSeen addEscapes String valueOf curChar int curChar addEscapes errorAfter public String getMessage return super getMessage public TokenMgrError public TokenMgrError String message int reason super message errorCode reason public TokenMgrError boolean EOFSeen int lexState int errorLine int errorColumn String errorAfter char curChar int reason this LexicalError EOFSeen lexState errorLine errorColumn errorAfter curChar reason private Vector stack new Vector public void clear stack removeAllElements public void push NameSpace ns stack insertElementAt ns public NameSpace top return get public NameSpace get int depth if depth depth return NameSpace JAVACODE else return NameSpace stack elementAt depth public void set int depth NameSpace ns stack setElementAt ns depth public NameSpace pop if depth throw new InterpreterError NameSpace top top stack removeElementAt return top public NameSpace swap NameSpace newTop NameSpace oldTop NameSpace stack elementAt stack setElementAt newTop return oldTop public int depth return stack size public NameSpace toArray NameSpace nsa new NameSpace depth stack copyInto nsa return nsa public String toString StringBuffer sb new StringBuffer sb append NameSpace nsa toArray for int nsa length sb append nsa return sb toString public class HyperSearchResults extends JPanel implements EBComponent public static final String NAME public HyperSearchResults View view super new BorderLayout this view view caption new JLabel updateCaption add BorderLayout NORTH caption resultTreeRoot new DefaultMutableTreeNode resultTreeModel new DefaultTreeModel resultTreeRoot resultTree new JTree resultTreeModel resultTree setCellRenderer new ResultCellRenderer resultTree setVisibleRowCount resultTree setRootVisible false resultTree setShowsRootHandles true resultTree putClientProperty resultTree setEditable false resultTree addTreeSelectionListener new TreeSelectionHandler resultTree addKeyListener new KeyHandler resultTree addMouseListener new MouseHandler JScrollPane scrollPane new JScrollPane resultTree Dimension dim scrollPane getPreferredSize dim width scrollPane setPreferredSize dim add BorderLayout CENTER scrollPane public boolean requestDefaultFocus resultTree grabFocus return true public void addNotify super addNotify EditBus addToBus this public void removeNotify super removeNotify EditBus removeFromBus this public void handleMessage EBMessage msg if msg instanceof BufferUpdate BufferUpdate bmsg BufferUpdate msg Buffer buffer bmsg getBuffer if bmsg getWhat BufferUpdate LOADED for int resultTreeRoot getChildCount DefaultMutableTreeNode bufferNode DefaultMutableTreeNode resultTreeRoot getChildAt for int bufferNode getChildCount HyperSearchResult result HyperSearchResult DefaultMutableTreeNode bufferNode getChildAt getUserObject if buffer getPath equals result path result bufferOpened buffer else if bmsg getWhat BufferUpdate CLOSED for int resultTreeRoot getChildCount DefaultMutableTreeNode bufferNode DefaultMutableTreeNode resultTreeRoot getChildAt for int bufferNode getChildCount HyperSearchResult result HyperSearchResult DefaultMutableTreeNode bufferNode getChildAt getUserObject if buffer getPath equals result path result bufferClosed public DefaultTreeModel getTreeModel return resultTreeModel public void searchStarted caption setText jEdit getProperty resultTreeRoot removeAllChildren resultTreeModel reload resultTreeRoot public void searchDone int resultCount int bufferCount updateCaption resultCount bufferCount SwingUtilities invokeLater new Runnable public void run for int resultTreeRoot getChildCount resultTree expandPath new TreePath DefaultMutableTreeNode resultTreeRoot getChildAt getPath private View view private JLabel caption private JTree resultTree private DefaultMutableTreeNode resultTreeRoot private DefaultTreeModel resultTreeModel private void goToSelectedNode TreePath path resultTree getSelectionPath if path null return Object value DefaultMutableTreeNode path getLastPathComponent getUserObject if value instanceof String Buffer buffer jEdit openFile view String value if buffer null return view setBuffer buffer SwingUtilities invokeLater new Runnable public void run resultTree requestFocus else final HyperSearchResult result HyperSearchResult value final Buffer buffer result getBuffer if buffer null return VFSManager runInAWTThread new Runnable public void run int start result startPos getOffset int end result endPos getOffset Selection new Selection Range start end view setBuffer buffer JEditTextArea textArea view getTextArea if textArea isMultipleSelectionEnabled textArea addToSelection else textArea setSelection textArea moveCaretPosition end private void updateCaption int resultCount int bufferCount Object pp new Integer resultCount new Integer bufferCount caption setText jEdit getProperty pp class KeyHandler extends KeyAdapter public void keyPressed KeyEvent evt if evt getKeyCode KeyEvent VK_ENTER goToSelectedNode class MouseHandler extends MouseAdapter public void mouseClicked MouseEvent evt TreePath path1 resultTree getPathForLocation evt getX evt getY if path1 null return resultTree setSelectionPath path1 goToSelectedNode view toFront view requestFocus view getTextArea requestFocus class TreeSelectionHandler implements TreeSelectionListener public void valueChanged TreeSelectionEvent evt goToSelectedNode class ResultCellRenderer extends DefaultTreeCellRenderer Font plainFont boldFont ResultCellRenderer plainFont UIManager getFont boldFont new Font plainFont getName Font BOLD plainFont getSize public Component getTreeCellRendererComponent JTree tree Object value boolean sel boolean expanded boolean leaf int row boolean hasFocus Component comp super getTreeCellRendererComponent tree value sel expanded leaf row hasFocus setIcon null DefaultMutableTreeNode node DefaultMutableTreeNode value if node getUserObject instanceof String ResultCellRenderer this setFont boldFont int count node getChildCount if count setText jEdit getProperty new Object node getUserObject else setText jEdit getProperty new Object node getUserObject new Integer count else ResultCellRenderer this setFont plainFont return this class BSHCastExpression extends SimpleNode public BSHCastExpression int id super id public Object eval CallStack callstack Interpreter interpreter throws EvalError NameSpace namespace callstack top Class toType BSHType jjtGetChild getType namespace SimpleNode expression SimpleNode jjtGetChild Object fromValue expression eval callstack interpreter Class fromType fromValue getClass try return castObject fromValue toType catch EvalError reThrow this public static Object castObject Object fromValue Class toType throws EvalError Class fromType fromValue getClass Object result null if toType isPrimitive if fromValue instanceof Primitive result castPrimitive Primitive fromValue toType else castError fromValue getClass toType else if fromValue instanceof Primitive result castPrimitive Primitive fromValue toType else if Capabilities canGenerateInterfaces fromValue instanceof bsh This toType isInterface result bsh This fromValue getInterface toType else if toType isInstance fromValue result fromValue else castError fromType toType if result null throw new InternalError return result public static void castError Class from Class to throws EvalError castError Reflect normalizeClassName from Reflect normalizeClassName to public static void castError String from String to throws EvalError Exception cce new ClassCastException from to throw new TargetError cce public static Primitive castPrimitive Primitive primValue Class toType throws EvalError if primValue Primitive VOID castError Reflect normalizeClassName toType Object value primValue getValue Class fromType primValue getType if toType isPrimitive if primValue Primitive NULL castError toType else return primValue if fromType Boolean TYPE if toType Boolean TYPE castError fromType toType else return primValue if value instanceof Character value new Integer Character value charValue if value instanceof Number Number number Number value if toType Byte TYPE value new Primitive number byteValue else if toType Short TYPE value new Primitive number shortValue else if toType Character TYPE value new Primitive char number intValue else if toType Integer TYPE value new Primitive number intValue else if toType Long TYPE value new Primitive number longValue else if toType Float TYPE value new Primitive number floatValue else if toType Double TYPE value new Primitive number doubleValue else castError fromType toType return Primitive value throw new EvalError 