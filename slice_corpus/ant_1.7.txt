public final class RmicAdapterFactory public static final String ERROR_UNKNOWN_COMPILER public static final String ERROR_NOT_RMIC_ADAPTER public static final String DEFAULT_COMPILER private RmicAdapterFactory public static RmicAdapter getRmic String rmicType Task task throws BuildException String compiler rmicType toLowerCase Locale ENGLISH if DEFAULT_COMPILER equals compiler compiler length compiler KaffeRmic isAvailable KaffeRmic COMPILER_NAME SunRmic COMPILER_NAME if SunRmic COMPILER_NAME equals compiler return new SunRmic else if KaffeRmic COMPILER_NAME equals compiler return new KaffeRmic else if WLRmic COMPILER_NAME equals compiler return new WLRmic else if ForkingSunRmic COMPILER_NAME equals compiler return new ForkingSunRmic else if XNewRmic COMPILER_NAME equals compiler return new XNewRmic return resolveClassName rmicType private static RmicAdapter resolveClassName String className throws BuildException return RmicAdapter ClasspathUtils newInstance className RmicAdapterFactory class getClassLoader RmicAdapter class class FStatP4OutputHandler extends P4HandlerAdapter private P4Fstat parent private ArrayList existing new ArrayList private ArrayList nonExisting new ArrayList private static Perl5Util util new Perl5Util public FStatP4OutputHandler P4Fstat parent this parent parent public void process String line throws BuildException if util match line String util group existing add else if util match line String util group nonExisting add Project MSG_VERBOSE public ArrayList getExisting return existing public ArrayList getNonExisting return nonExisting public class OutErrSummaryJUnitResultFormatter extends SummaryJUnitResultFormatter public OutErrSummaryJUnitResultFormatter super setWithOutAndErr true public abstract class P4HandlerAdapter implements P4Handler String p4input private PumpStreamHandler myHandler null public void setOutput String p4Input this p4input p4Input public abstract void process String line public void start throws BuildException if p4input null p4input length myHandler new PumpStreamHandler new P4OutputStream this new P4OutputStream this new ByteArrayInputStream p4input getBytes else myHandler new PumpStreamHandler new P4OutputStream this new P4OutputStream this myHandler setProcessInputStream os myHandler setProcessErrorStream es myHandler setProcessOutputStream is myHandler start public void stop myHandler stop public void setProcessInputStream OutputStream os throws IOException this os os public void setProcessErrorStream InputStream is throws IOException this es is public void setProcessOutputStream InputStream is throws IOException this is is public class WaitFor extends ConditionBase private long maxWaitMillis private long maxWaitMultiplier private long checkEveryMillis private long checkEveryMultiplier private String timeoutProperty public WaitFor super public void setMaxWait long time maxWaitMillis time public void setMaxWaitUnit Unit unit maxWaitMultiplier unit getMultiplier public void setCheckEvery long time checkEveryMillis time public void setCheckEveryUnit Unit unit checkEveryMultiplier unit getMultiplier public void setTimeoutProperty String timeoutProperty public void execute throws BuildException if countConditions throw new BuildException getTaskName if countConditions throw new BuildException getTaskName Condition Condition getConditions nextElement long savedMaxWaitMillis maxWaitMillis long savedCheckEveryMillis checkEveryMillis try maxWaitMillis maxWaitMultiplier checkEveryMillis checkEveryMultiplier long start System currentTimeMillis long end start maxWaitMillis while System currentTimeMillis end if eval processSuccess return try Thread sleep checkEveryMillis catch InterruptedException processTimeout finally maxWaitMillis savedMaxWaitMillis checkEveryMillis savedCheckEveryMillis protected void processSuccess log getTaskName Project MSG_VERBOSE protected void processTimeout log getTaskName Project MSG_VERBOSE if timeoutProperty null getProject setNewProperty timeoutProperty public static class Unit extends EnumeratedAttribute public static final String MILLISECOND public static final String SECOND public static final String MINUTE public static final String HOUR public static final String DAY public static final String WEEK private static final String UNITS MILLISECOND SECOND MINUTE HOUR DAY WEEK private Map timeTable new HashMap public Unit timeTable put MILLISECOND new Long timeTable put SECOND new Long timeTable put MINUTE new Long timeTable put HOUR new Long timeTable put DAY new Long timeTable put WEEK new Long public long getMultiplier String key getValue toLowerCase Long Long timeTable get key return longValue public String getValues return UNITS public abstract class ConstantCPInfo extends ConstantPoolEntry private Object value protected ConstantCPInfo int tagValue int entries super tagValue entries public Object getValue return value public void setValue Object newValue value newValue public class AsiExtraField implements ZipExtraField UnixStat Cloneable private static final ZipShort HEADER_ID new ZipShort private int mode private int uid private int gid private String link private boolean dirFlag false private CRC32 crc new CRC32 public AsiExtraField public ZipShort getHeaderId return HEADER_ID public ZipShort getLocalFileDataLength getLinkedFile getBytes length public ZipShort getCentralDirectoryLength return getLocalFileDataLength public byte getLocalFileDataData byte data new byte getLocalFileDataLength getValue System arraycopy ZipShort getBytes getMode data byte linkArray getLinkedFile getBytes System arraycopy ZipLong getBytes linkArray length data System arraycopy ZipShort getBytes getUserId data System arraycopy ZipShort getBytes getGroupId data System arraycopy linkArray data linkArray length crc reset crc update data long checksum crc getValue byte result new byte data length System arraycopy ZipLong getBytes checksum result System arraycopy data result data length return result public byte getCentralDirectoryData return getLocalFileDataData public void setUserId int uid this uid uid public int getUserId return uid public void setGroupId int gid this gid gid public int getGroupId return gid public void setLinkedFile String name link name mode getMode mode public String getLinkedFile return link public boolean isLink return getLinkedFile length public void setMode int mode this mode getMode mode public int getMode return mode public void setDirectory boolean dirFlag this dirFlag dirFlag mode getMode mode public boolean isDirectory return dirFlag isLink public void parseFromLocalFileData byte data int offset int length throws ZipException long givenChecksum ZipLong getValue data offset byte tmp new byte length System arraycopy data offset tmp length crc reset crc update tmp long realChecksum crc getValue if givenChecksum realChecksum throw new ZipException Long toHexString givenChecksum Long toHexString realChecksum int newMode ZipShort getValue tmp byte linkArray new byte int ZipLong getValue tmp uid ZipShort getValue tmp gid ZipShort getValue tmp if linkArray length link else System arraycopy tmp linkArray linkArray length link new String linkArray setDirectory newMode DIR_FLAG setMode newMode protected int getMode int mode int type FILE_FLAG if isLink type LINK_FLAG else if isDirectory type DIR_FLAG return type mode PERM_MASK public class Date implements ResourceSelector private static final String MILLIS_OR_DATETIME private static final FileUtils FILE_UTILS FileUtils getFileUtils private Long millis null private String dateTime null private String pattern null private TimeComparison when TimeComparison EQUAL private long granularity FILE_UTILS getFileTimestampGranularity public synchronized void setMillis long millis new Long public synchronized long getMillis return millis null millis longValue public synchronized void setDateTime String dateTime millis null public synchronized String getDatetime return dateTime public synchronized void setGranularity long granularity public synchronized long getGranularity return granularity public synchronized void setPattern String pattern public synchronized String getPattern return pattern public synchronized void setWhen TimeComparison when public synchronized TimeComparison getWhen return when public synchronized boolean isSelected Resource if dateTime null millis null throw new BuildException MILLIS_OR_DATETIME if millis null DateFormat df pattern null DateFormat getDateTimeInstance DateFormat SHORT DateFormat SHORT Locale US new SimpleDateFormat pattern try long df parse dateTime getTime if throw new BuildException dateTime setMillis catch ParseException pe throw new BuildException dateTime pattern null pattern return when evaluate getLastModified millis longValue granularity public class FacadeTaskHelper private Vector args new Vector private String userChoice private String magicValue private String defaultValue public FacadeTaskHelper String defaultValue this defaultValue null public FacadeTaskHelper String defaultValue String magicValue this defaultValue defaultValue this magicValue magicValue public void setMagicValue String magicValue this magicValue magicValue public void setImplementation String userChoice this userChoice userChoice public String getImplementation return userChoice null userChoice magicValue null magicValue defaultValue public String getExplicitChoice return userChoice public void addImplementationArgument ImplementationSpecificArgument arg args addElement arg public String getArgs Vector tmp new Vector args size for Enumeration args elements hasMoreElements ImplementationSpecificArgument arg ImplementationSpecificArgument nextElement String curr arg getParts getImplementation for int curr length tmp addElement curr String res new String tmp size tmp copyInto res return res public boolean hasBeenSet return userChoice null magicValue null public class DepthSelector extends BaseExtendSelector public int min public int max public static final String MIN_KEY public static final String MAX_KEY public DepthSelector public String toString StringBuffer buf new StringBuffer buf append min buf append buf append max buf append return buf toString public void setMin int min this min min public void setMax int max this max max public void setParameters Parameter parameters super setParameters parameters if parameters null for int parameters length String paramname parameters getName if MIN_KEY equalsIgnoreCase paramname try setMin Integer parseInt parameters getValue catch NumberFormatException nfe1 setError parameters getValue else if MAX_KEY equalsIgnoreCase paramname try setMax Integer parseInt parameters getValue catch NumberFormatException nfe1 setError parameters getValue else setError paramname public void verifySettings if min max setError if max min max setError public boolean isSelected File basedir String filename File file validate int depth String absBase basedir getAbsolutePath String absFile file getAbsolutePath StringTokenizer tokBase new StringTokenizer absBase File separator StringTokenizer tokFile new StringTokenizer absFile File separator while tokFile hasMoreTokens String filetoken tokFile nextToken if tokBase hasMoreTokens String basetoken tokBase nextToken if basetoken equals filetoken throw new BuildException filename absBase else depth if max depth max return false if tokBase hasMoreTokens throw new BuildException filename absBase if min depth min return false return true public class JSharp extends DotnetCompile String baseAddress boolean pureJava true boolean secureScoping false public JSharp setExecutable public void setBaseAddress String baseAddress this baseAddress baseAddress public void setPureJava boolean pureJava this pureJava pureJava public void setSecureScoping boolean secureScoping this secureScoping secureScoping public String getReferenceDelimiter return public String getFileExtension return protected void addCompilerSpecificOptions NetCommand command if pureJava command addArgument if secureScoping command addArgument protected void createResourceParameter NetCommand command DotnetResource resource resource getParameters getProject command true protected void validate throws BuildException super validate if getDestFile null throw new BuildException public class LogStreamHandler extends PumpStreamHandler public LogStreamHandler Task task int outlevel int errlevel this ProjectComponent task outlevel errlevel public LogStreamHandler ProjectComponent pc int outlevel int errlevel super new LogOutputStream pc outlevel new LogOutputStream pc errlevel public void stop super stop try getErr close getOut close catch IOException throw new BuildException public interface InputHandler void handleInput InputRequest request throws org apache tools ant BuildException public final class JarMarker implements ZipExtraField private static final ZipShort ID new ZipShort private static final ZipShort NULL new ZipShort private static final byte NO_BYTES new byte private static final JarMarker DEFAULT new JarMarker public JarMarker public static JarMarker getInstance return DEFAULT public ZipShort getHeaderId return ID public ZipShort getLocalFileDataLength return NULL public ZipShort getCentralDirectoryLength return NULL public byte getLocalFileDataData return NO_BYTES public byte getCentralDirectoryData return NO_BYTES public void parseFromLocalFileData byte data int offset int length throws ZipException if length throw new ZipException public class CCMkbl extends ClearCase private String mComment null private String mCfile null private String mBaselineRootName null private boolean mNwarn false private boolean mIdentical true private boolean mFull false private boolean mNlabel false public void execute throws BuildException Commandline commandLine new Commandline Project aProj getProject int result if getViewPath null setViewPath aProj getBaseDir getPath commandLine setExecutable getClearToolCommand commandLine createArgument setValue COMMAND_MKBL checkOptions commandLine if getFailOnErr getProject log getBaselineRootName Project MSG_VERBOSE result run commandLine if Execute isFailure result getFailOnErr String msg commandLine toString throw new BuildException msg getLocation private void checkOptions Commandline cmd if getComment null getCommentCommand cmd else if getCommentFile null getCommentFileCommand cmd else cmd createArgument setValue FLAG_NOCOMMENT if getIdentical cmd createArgument setValue FLAG_IDENTICAL if getFull cmd createArgument setValue FLAG_FULL else cmd createArgument setValue FLAG_INCREMENTAL if getNlabel cmd createArgument setValue FLAG_NLABEL cmd createArgument setValue getBaselineRootName public void setComment String comment mComment comment public String getComment return mComment public void setCommentFile String cfile mCfile cfile public String getCommentFile return mCfile public void setBaselineRootName String baselineRootName mBaselineRootName baselineRootName public String getBaselineRootName return mBaselineRootName public void setNoWarn boolean nwarn mNwarn nwarn public boolean getNoWarn return mNwarn public void setIdentical boolean identical mIdentical identical public boolean getIdentical return mIdentical public void setFull boolean full mFull full public boolean getFull return mFull public void setNlabel boolean nlabel mNlabel nlabel public boolean getNlabel return mNlabel private void getCommentCommand Commandline cmd if getComment null cmd createArgument setValue FLAG_COMMENT cmd createArgument setValue getComment private void getCommentFileCommand Commandline cmd if getCommentFile null cmd createArgument setValue FLAG_COMMENTFILE cmd createArgument setValue getCommentFile public static final String FLAG_COMMENT public static final String FLAG_COMMENTFILE public static final String FLAG_NOCOMMENT public static final String FLAG_IDENTICAL public static final String FLAG_INCREMENTAL public static final String FLAG_FULL public static final String FLAG_NLABEL public class Restrict extends ResourceSelectorContainer implements ResourceCollection private BaseResourceCollectionWrapper new BaseResourceCollectionWrapper protected Collection getCollection ArrayList result new ArrayList outer for Iterator ri getResourceCollection iterator ri hasNext Resource Resource ri next for Iterator getSelectors hasNext if ResourceSelector next isSelected continue outer result add return result public synchronized void add ResourceCollection if isReference throw noChildrenAllowed if null return add public synchronized void setCache boolean setCache public synchronized boolean isCache return isCache public synchronized void add ResourceSelector if null return super add FailFast invalidate this public final synchronized Iterator iterator if isReference return Restrict getCheckedRef iterator dieOnCircularReference return iterator public synchronized int size if isReference return Restrict getCheckedRef size dieOnCircularReference return size public synchronized boolean isFilesystemOnly if isReference return Restrict getCheckedRef isFilesystemOnly dieOnCircularReference return isFilesystemOnly public synchronized String toString if isReference return getCheckedRef toString dieOnCircularReference return toString public class DemuxInputStream extends InputStream private Project project public DemuxInputStream Project project this project project public int read throws IOException byte buffer new byte if project demuxInput buffer return return buffer public int read byte buffer int offset int length throws IOException return project demuxInput buffer offset length public class IPlanetEjbc private static final int MIN_NUM_ARGS private static final int MAX_NUM_ARGS private static final int NUM_CLASSES_WITH_IIOP private static final int NUM_CLASSES_WITHOUT_IIOP private static final String ENTITY_BEAN private static final String STATELESS_SESSION private static final String STATEFUL_SESSION private File stdDescriptor private File iasDescriptor private File destDirectory private String classpath private String classpathElements private boolean retainSource false private boolean debugOutput false private File iasHomeDir private SAXParser parser private EjbcHandler handler new EjbcHandler private Hashtable ejbFiles new Hashtable private String displayName public IPlanetEjbc File stdDescriptor File iasDescriptor File destDirectory String classpath SAXParser parser this stdDescriptor stdDescriptor this iasDescriptor iasDescriptor this destDirectory destDirectory this classpath classpath this parser parser List elements new ArrayList if classpath null StringTokenizer st new StringTokenizer classpath File pathSeparator while st hasMoreTokens elements add st nextToken classpathElements String elements toArray new String elements size public void setRetainSource boolean retainSource this retainSource retainSource public void setDebugOutput boolean debugOutput this debugOutput debugOutput public void registerDTD String publicID String location handler registerDTD publicID location public void setIasHomeDir File iasHomeDir this iasHomeDir iasHomeDir public Hashtable getEjbFiles return ejbFiles public String getDisplayName return displayName public String getCmpDescriptors List returnList new ArrayList EjbInfo ejbs handler getEjbs for int ejbs length List descriptors List ejbs getCmpDescriptors returnList addAll descriptors return String returnList toArray new String returnList size public static void main String args File stdDescriptor File iasDescriptor File destDirectory null String classpath null SAXParser parser null boolean debug false boolean retainSource false IPlanetEjbc ejbc if args length MIN_NUM_ARGS args length MAX_NUM_ARGS usage return stdDescriptor new File args args length iasDescriptor new File args args length for int args length if args equals classpath args else if args equals destDirectory new File args else if args equals debug true else if args equals retainSource true else usage return if classpath null Properties props System getProperties classpath props getProperty if destDirectory null Properties props System getProperties destDirectory new File props getProperty SAXParserFactory parserFactory SAXParserFactory newInstance parserFactory setValidating true try parser parserFactory newSAXParser catch Exception System out println System out println printStackTrace return ejbc new IPlanetEjbc stdDescriptor iasDescriptor destDirectory classpath parser ejbc setDebugOutput debug ejbc setRetainSource retainSource try ejbc execute catch IOException System out println getMessage return catch SAXException System out println getMessage return catch IPlanetEjbc EjbcException System out println getMessage return private static void usage System out println System out println System out println System out println System out println System out println System out println System out println System out println System out println System out println System out println System out println System out println System out println System out println System out println System out println public void execute throws EjbcException IOException SAXException for int ejbs length log log ejbs toString for int ejbs length EjbInfo ejb ejbs if ejb mustBeRecompiled destDirectory log ejb getName String arguments buildArgumentList ejb callEjbc arguments else log ejb getName private void callEjbc String arguments StringBuffer args new StringBuffer for int arguments length args append arguments append String command if iasHomeDir null command else command iasHomeDir toString File separator File separator command log command args try Process Runtime getRuntime exec command args RedirectOutput output new RedirectOutput getInputStream RedirectOutput error new RedirectOutput getErrorStream output start error start waitFor destroy catch IOException log printStackTrace catch InterruptedException protected void checkConfiguration throws EjbcException String msg if stdDescriptor null msg if iasDescriptor null msg if classpath null msg if parser null msg if destDirectory null msg else if destDirectory exists msg else if destDirectory isDirectory msg if msg length throw new EjbcException msg private EjbInfo getEjbs throws IOException SAXException EjbInfo ejbs null parser parse stdDescriptor handler parser parse iasDescriptor handler ejbs handler getEjbs return ejbs private String buildArgumentList EjbInfo ejb List arguments new ArrayList if debugOutput arguments add if ejb getBeantype equals STATELESS_SESSION arguments add else if ejb getBeantype equals STATEFUL_SESSION arguments add if ejb getIiop arguments add if ejb getCmp arguments add if retainSource arguments add if ejb getHasession arguments add arguments add arguments add classpath arguments add arguments add destDirectory toString arguments add ejb getHome getQualifiedClassName arguments add ejb getRemote getQualifiedClassName arguments add ejb getImplementation getQualifiedClassName return String arguments toArray new String arguments size private void log String msg if debugOutput System out println msg public class EjbcException extends Exception public EjbcException String msg super msg private class EjbcHandler extends HandlerBase private static final String PUBLICID_EJB11 private static final String PUBLICID_IPLANET_EJB_60 private static final String DEFAULT_IAS60_EJB11_DTD_LOCATION private static final String DEFAULT_IAS60_DTD_LOCATION private Map resourceDtds new HashMap private Map fileDtds new HashMap public EjbcHandler registerDTD PUBLICID_EJB11 DEFAULT_IAS60_EJB11_DTD_LOCATION registerDTD PUBLICID_IPLANET_EJB_60 DEFAULT_IAS60_DTD_LOCATION public EjbInfo getEjbs return EjbInfo ejbs values toArray new EjbInfo ejbs size public String getDisplayName return displayName public void registerDTD String publicID String location log location if publicID null location null return if ClassLoader getSystemResource location null log location resourceDtds put publicID location else File dtdFile new File location if dtdFile exists dtdFile isFile log location fileDtds put publicID location public InputSource resolveEntity String publicId String systemId throws SAXException InputStream inputStream null try String location String resourceDtds get publicId if location null inputStream ClassLoader getSystemResource location openStream else location String fileDtds get publicId if location null inputStream new FileInputStream location catch IOException return super resolveEntity publicId systemId if inputStream null return super resolveEntity publicId systemId else return new InputSource inputStream public void startElement String name AttributeList atts throws SAXException currentLoc name currentText if currentLoc equals iasDescriptor false else if currentLoc equals iasDescriptor true if name equals name equals ejbType name public void characters char ch int start int len throws SAXException currentText new String ch substring start start len public void endElement String name throws SAXException if iasDescriptor iasCharacters currentText else stdCharacters currentText int locLength currentLoc length currentLoc currentLoc substring locLength nameLength private void stdCharacters String value if currentLoc equals displayName value return String base ejbType if currentLoc equals base currentEjb EjbInfo ejbs get value if currentEjb null currentEjb new EjbInfo value ejbs put value currentEjb else if currentLoc equals base currentEjb setHome value else if currentLoc equals base currentEjb setRemote value else if currentLoc equals base currentEjb setImplementation value else if currentLoc equals base currentEjb setPrimaryKey value else if currentLoc equals base currentEjb setBeantype value else if currentLoc equals base currentEjb setCmp value private void iasCharacters String value String base ejbType if currentLoc equals base currentEjb EjbInfo ejbs get value if currentEjb null currentEjb new EjbInfo value ejbs put value currentEjb else if currentLoc equals base currentEjb setIiop value else if currentLoc equals base currentEjb setHasession value else if currentLoc equals base currentEjb addCmpDescriptor value private class EjbInfo public EjbInfo String name this name name public String getName if name null if implementation null return else return implementation getClassName return name public void setHome String home setHome new Classname home public void setHome Classname home this home home public Classname getHome return home public void setRemote String remote setRemote new Classname remote public void setRemote Classname remote this remote remote public Classname getRemote return remote public void setImplementation String implementation setImplementation new Classname implementation public void setImplementation Classname implementation this implementation implementation public Classname getImplementation return implementation public void setPrimaryKey String primaryKey setPrimaryKey new Classname primaryKey public void setPrimaryKey Classname primaryKey this primaryKey primaryKey public Classname getPrimaryKey return primaryKey public void setBeantype String beantype this beantype beantype toLowerCase public String getBeantype return beantype public void setCmp boolean cmp this cmp cmp public void setCmp String cmp setCmp cmp equals public boolean getCmp return cmp public void setIiop boolean iiop this iiop iiop public void setIiop String iiop setIiop iiop equals public boolean getIiop return iiop public void setHasession boolean hasession this hasession hasession public void setHasession String hasession setHasession hasession equals public boolean getHasession return hasession public void addCmpDescriptor String descriptor cmpDescriptors add descriptor public List getCmpDescriptors return cmpDescriptors private void checkConfiguration File buildDir throws EjbcException if home null throw new EjbcException name if remote null throw new EjbcException name if implementation null throw new EjbcException name if beantype equals ENTITY_BEAN beantype equals STATELESS_SESSION beantype equals STATEFUL_SESSION throw new EjbcException beantype name if cmp beantype equals ENTITY_BEAN System out println name if hasession beantype equals STATEFUL_SESSION System out println name if remote getClassFile buildDir exists throw new EjbcException remote getQualifiedClassName if home getClassFile buildDir exists throw new EjbcException home getQualifiedClassName if implementation getClassFile buildDir exists throw new EjbcException implementation getQualifiedClassName public boolean mustBeRecompiled File destDir long sourceModified sourceClassesModified destDir long destModified destClassesModified destDir return destModified sourceModified private long sourceClassesModified File buildDir remoteFile remote getClassFile buildDir modified remoteFile lastModified if modified System out println remote getQualifiedClassName return latestModified modified homeFile home getClassFile buildDir modified homeFile lastModified if modified System out println home getQualifiedClassName return latestModified Math max latestModified modified if primaryKey null pkFile primaryKey getClassFile buildDir modified pkFile lastModified if modified System out println primaryKey getQualifiedClassName return latestModified Math max latestModified modified else pkFile null implFile implementation getClassFile buildDir modified implFile lastModified if modified System out println implementation getQualifiedClassName return String pathToFile remote getQualifiedClassName pathToFile pathToFile replace File separatorChar ejbFiles put pathToFile remoteFile pathToFile home getQualifiedClassName pathToFile pathToFile replace File separatorChar ejbFiles put pathToFile homeFile pathToFile implementation getQualifiedClassName pathToFile pathToFile replace File separatorChar ejbFiles put pathToFile implFile if pkFile null pathToFile primaryKey getQualifiedClassName pathToFile pathToFile replace File separatorChar ejbFiles put pathToFile pkFile return latestModified private long destClassesModified File destDir for int classnames length String pathToClass classnames replace File separatorChar File classFile new File destDir pathToClass ejbFiles put pathToClass classFile allClassesFound allClassesFound classFile exists if allClassesFound long fileMod classFile lastModified destClassesModified Math min destClassesModified fileMod return allClassesFound destClassesModified private String classesToGenerate String classnames iiop new String NUM_CLASSES_WITH_IIOP new String NUM_CLASSES_WITHOUT_IIOP final String remotePkg remote getPackageName final String remoteClass remote getClassName final String homePkg home getPackageName final String homeClass home getClassName final String implPkg implementation getPackageName final String implFullClass implementation getQualifiedWithUnderscores int index classnames index implPkg implFullClass classnames index implPkg implFullClass classnames index implPkg implFullClass classnames index remotePkg remoteClass classnames index homePkg homeClass classnames index remotePkg remoteClass classnames index homePkg homeClass classnames index remotePkg remoteClass classnames index homePkg homeClass if iiop return classnames classnames index remotePkg remoteClass classnames index homePkg homeClass classnames index remotePkg remoteClass classnames index homePkg homeClass classnames index remotePkg remoteClass classnames index homePkg homeClass return classnames public String toString String name home remote implementation primaryKey beantype cmp iiop hasession Iterator cmpDescriptors iterator while hasNext next return private static class Classname public Classname String qualifiedName if qualifiedName null return this qualifiedName qualifiedName int index qualifiedName lastIndexOf if index className qualifiedName else className qualifiedName substring index public String getQualifiedClassName return qualifiedName public String getPackageName public String getClassName return className public String getQualifiedWithUnderscores return qualifiedName replace public File getClassFile File directory String pathToFile qualifiedName replace File separatorChar return new File directory pathToFile public String toString return getQualifiedClassName private static class RedirectOutput extends Thread public RedirectOutput InputStream stream this stream stream public void run BufferedReader reader new BufferedReader new InputStreamReader stream String text try while text reader readLine null System out println text catch IOException printStackTrace finally try reader close catch IOException public interface ZipExtraField ZipShort getHeaderId ZipShort getLocalFileDataLength ZipShort getCentralDirectoryLength byte getLocalFileDataData byte getCentralDirectoryData void parseFromLocalFileData byte data int offset int length throws ZipException public class FileSystem extends ResourceComparator private static final FileUtils FILE_UTILS FileUtils getFileUtils protected int resourceCompare Resource foo Resource bar File foofile FileResource foo getFile File barfile FileResource bar getFile return foofile equals barfile FILE_UTILS isLeadingPath foofile barfile FILE_UTILS normalize foofile getAbsolutePath compareTo FILE_UTILS normalize barfile getAbsolutePath public class TypeFound extends ProjectComponent implements Condition private String name private String uri public void setName String name this name name public void setURI String uri this uri uri protected boolean doesTypeExist String typename ComponentHelper helper ComponentHelper getComponentHelper getProject String componentName ProjectHelper genComponentName uri typename AntTypeDefinition def helper getDefinition componentName if def null return false boolean found def getExposedClass getProject null if found String text helper diagnoseCreationFailure componentName log text Project MSG_VERBOSE return found public boolean eval throws BuildException if name null throw new BuildException return doesTypeExist name public interface P4OutputHandler void process String line throws BuildException public class Message extends ProjectComponent private File messageSource null private StringBuffer buffer new StringBuffer private String mimeType private boolean specified false private String charset null public Message public Message String text addText text public Message File file messageSource file public void addText String text buffer append text public void setSrc File src this messageSource src public void setMimeType String mimeType this mimeType mimeType specified true public String getMimeType return mimeType public void print PrintStream ps throws IOException PrintWriter out charset null new PrintWriter new OutputStreamWriter ps charset new PrintWriter ps if messageSource null FileReader freader new FileReader messageSource try BufferedReader in new BufferedReader freader String line null while line in readLine null out println getProject replaceProperties line finally freader close else out println getProject replaceProperties buffer substring out flush public boolean isMimeTypeSpecified return specified public void setCharset String charset this charset charset public String getCharset return charset public class MSVSSCP extends MSVSS protected Commandline buildCmdLine Commandline commandLine new Commandline if getVsspath null String msg throw new BuildException msg getLocation commandLine setExecutable getSSCommand commandLine createArgument setValue COMMAND_CP commandLine createArgument setValue getVsspath commandLine createArgument setValue getAutoresponse commandLine createArgument setValue getLogin return commandLine public void setAutoresponse String response super setInternalAutoResponse response public class IsSet extends ProjectComponent implements Condition private String property public void setProperty String property public boolean eval throws BuildException if property null throw new BuildException return getProject getProperty property null public class Rpm extends Task private static final String PATH1 private static final String PATH2 private static final String PATH3 private static final int PATH_LEN PATH1 length private String specFile private File topDir private String command private String rpmBuildCommand null private boolean cleanBuildDir false private boolean removeSpec false private boolean removeSource false private File output private File error private boolean failOnError false private boolean quiet false public void execute throws BuildException Commandline toExecute new Commandline toExecute setExecutable rpmBuildCommand null guessRpmBuildCommand rpmBuildCommand if topDir null toExecute createArgument setValue toExecute createArgument setValue topDir toExecute createArgument setLine command if cleanBuildDir toExecute createArgument setValue if removeSpec toExecute createArgument setValue if removeSource toExecute createArgument setValue toExecute createArgument setValue specFile ExecuteStreamHandler streamhandler null OutputStream outputstream null OutputStream errorstream null if error null output null if quiet streamhandler new LogStreamHandler this Project MSG_INFO Project MSG_WARN else streamhandler new LogStreamHandler this Project MSG_DEBUG Project MSG_DEBUG else if output null try BufferedOutputStream bos new BufferedOutputStream new FileOutputStream output outputstream new PrintStream bos catch IOException throw new BuildException getLocation else if quiet outputstream new LogOutputStream this Project MSG_INFO else outputstream new LogOutputStream this Project MSG_DEBUG if error null try BufferedOutputStream bos new BufferedOutputStream new FileOutputStream error errorstream new PrintStream bos catch IOException throw new BuildException getLocation else if quiet errorstream new LogOutputStream this Project MSG_WARN else errorstream new LogOutputStream this Project MSG_DEBUG streamhandler new PumpStreamHandler outputstream errorstream Execute exe getExecute toExecute streamhandler try log specFile int returncode exe execute if Execute isFailure returncode String msg toExecute getExecutable returncode if failOnError throw new BuildException msg else log msg Project MSG_ERR catch IOException throw new BuildException getLocation finally FileUtils close outputstream FileUtils close errorstream public void setTopDir File td this topDir td public void setCommand String this command public void setSpecFile String sf if sf null sf trim equals throw new BuildException getLocation this specFile sf public void setCleanBuildDir boolean cbd cleanBuildDir cbd public void setRemoveSpec boolean rs removeSpec rs public void setRemoveSource boolean rs removeSource rs public void setOutput File output this output output public void setError File error this error error public void setRpmBuildCommand String this rpmBuildCommand public void setFailOnError boolean value failOnError value public void setQuiet boolean value quiet value protected String guessRpmBuildCommand Vector env Execute getProcEnvironment String path null for Enumeration env elements hasMoreElements String var String nextElement if var startsWith PATH1 var startsWith PATH2 var startsWith PATH3 path var substring PATH_LEN break if path null Path new Path getProject path String pElements list for int pElements length File new File pElements Os isFamily if canRead return getAbsolutePath return protected Execute getExecute Commandline toExecute ExecuteStreamHandler streamhandler Execute exe new Execute streamhandler null exe setAntRun getProject if topDir null topDir getProject getBaseDir exe setWorkingDirectory topDir exe setCommandline toExecute getCommandline return exe public abstract class BaseExtendSelector extends BaseSelector implements ExtendFileSelector protected Parameter parameters null public BaseExtendSelector public void setParameters Parameter parameters this parameters parameters protected Parameter getParameters return parameters public abstract boolean isSelected File basedir String filename File file throws BuildException public class XMLJUnitResultFormatter implements JUnitResultFormatter XMLConstants private static final String UNKNOWN private static DocumentBuilder getDocumentBuilder try return DocumentBuilderFactory newInstance newDocumentBuilder catch Exception exc throw new ExceptionInInitializerError exc private Document doc private Element rootElement private Hashtable testElements new Hashtable private Hashtable failedTests new Hashtable private Hashtable testStarts new Hashtable private OutputStream out public XMLJUnitResultFormatter public void setOutput OutputStream out this out out public void setSystemOutput String out formatOutput SYSTEM_OUT out public void setSystemError String out formatOutput SYSTEM_ERR out public void startTestSuite JUnitTest suite doc getDocumentBuilder newDocument rootElement doc createElement TESTSUITE String suite getName rootElement setAttribute ATTR_NAME null UNKNOWN final String timestamp DateUtils format new Date DateUtils ISO8601_DATETIME_PATTERN rootElement setAttribute TIMESTAMP timestamp rootElement setAttribute HOSTNAME getHostname Element propsElement doc createElement PROPERTIES rootElement appendChild propsElement Properties props suite getProperties if props null Enumeration props propertyNames while hasMoreElements String name String nextElement Element propElement doc createElement PROPERTY propElement setAttribute ATTR_NAME name propElement setAttribute ATTR_VALUE props getProperty name propsElement appendChild propElement private String getHostname try return InetAddress getLocalHost getHostName catch UnknownHostException return public void endTestSuite JUnitTest suite throws BuildException rootElement setAttribute ATTR_TESTS suite runCount rootElement setAttribute ATTR_FAILURES suite failureCount rootElement setAttribute ATTR_ERRORS suite errorCount rootElement setAttribute ATTR_TIME suite getRunTime if out null Writer wri null try wri new BufferedWriter new OutputStreamWriter out wri write new DOMElementWriter write rootElement wri wri flush catch IOException exc throw new BuildException exc finally if out System out out System err FileUtils close wri public void startTest Test testStarts put new Long System currentTimeMillis public void endTest Test test if testStarts containsKey test startTest test Element currentTest null if failedTests containsKey test currentTest doc createElement TESTCASE String JUnitVersionHelper getTestCaseName test currentTest setAttribute ATTR_NAME null UNKNOWN currentTest setAttribute ATTR_CLASSNAME JUnitVersionHelper getTestCaseClassName test rootElement appendChild currentTest testElements put test currentTest else currentTest Element testElements get test Long Long testStarts get test currentTest setAttribute ATTR_TIME System currentTimeMillis longValue public void addFailure Test test Throwable formatError FAILURE test public void addFailure Test test AssertionFailedError addFailure test Throwable public void addError Test test Throwable formatError ERROR test private void formatError String type Test test Throwable if test null endTest test failedTests put test test Element nested doc createElement type Element currentTest null if test null currentTest Element testElements get test else currentTest rootElement currentTest appendChild nested String message getMessage if message null message length nested setAttribute ATTR_MESSAGE getMessage nested setAttribute ATTR_TYPE getClass getName String strace JUnitTestRunner getFilteredTrace Text trace doc createTextNode strace nested appendChild trace private void formatOutput String type String output Element nested doc createElement type rootElement appendChild nested nested appendChild doc createCDATASection output public class SetProxy extends Task protected String proxyHost null protected int proxyPort private String socksProxyHost null private int socksProxyPort private String nonProxyHosts null private String proxyUser null private String proxyPassword null public void setProxyHost String hostname proxyHost hostname public void setProxyPort int port proxyPort port public void setSocksProxyHost String host this socksProxyHost host public void setSocksProxyPort int port this socksProxyPort port public void setNonProxyHosts String nonProxyHosts this nonProxyHosts nonProxyHosts public void setProxyUser String proxyUser this proxyUser proxyUser public void setProxyPassword String proxyPassword this proxyPassword proxyPassword public void applyWebProxySettings boolean settingsChanged false boolean enablingProxy false Properties sysprops System getProperties if proxyHost null settingsChanged true if proxyHost length traceSettingInfo enablingProxy true sysprops put ProxySetup HTTP_PROXY_HOST proxyHost String portString Integer toString proxyPort sysprops put ProxySetup HTTP_PROXY_PORT portString sysprops put ProxySetup HTTPS_PROXY_HOST proxyHost sysprops put ProxySetup HTTPS_PROXY_PORT portString sysprops put ProxySetup FTP_PROXY_HOST proxyHost sysprops put ProxySetup FTP_PROXY_PORT portString if nonProxyHosts null sysprops put ProxySetup HTTP_NON_PROXY_HOSTS nonProxyHosts sysprops put ProxySetup HTTPS_NON_PROXY_HOSTS nonProxyHosts sysprops put ProxySetup FTP_NON_PROXY_HOSTS nonProxyHosts if proxyUser null sysprops put ProxySetup HTTP_PROXY_USERNAME proxyUser sysprops put ProxySetup HTTP_PROXY_PASSWORD proxyPassword else log Project MSG_VERBOSE sysprops remove ProxySetup HTTP_PROXY_HOST sysprops remove ProxySetup HTTP_PROXY_PORT sysprops remove ProxySetup HTTP_PROXY_USERNAME sysprops remove ProxySetup HTTP_PROXY_PASSWORD sysprops remove ProxySetup HTTPS_PROXY_HOST sysprops remove ProxySetup HTTPS_PROXY_PORT sysprops remove ProxySetup FTP_PROXY_HOST sysprops remove ProxySetup FTP_PROXY_PORT if socksProxyHost null settingsChanged true if socksProxyHost length enablingProxy true sysprops put ProxySetup SOCKS_PROXY_HOST socksProxyHost sysprops put ProxySetup SOCKS_PROXY_PORT Integer toString socksProxyPort if proxyUser null sysprops put ProxySetup SOCKS_PROXY_USERNAME proxyUser sysprops put ProxySetup SOCKS_PROXY_PASSWORD proxyPassword else log Project MSG_VERBOSE sysprops remove ProxySetup SOCKS_PROXY_HOST sysprops remove ProxySetup SOCKS_PROXY_PORT sysprops remove ProxySetup SOCKS_PROXY_USERNAME sysprops remove ProxySetup SOCKS_PROXY_PASSWORD if proxyUser null if enablingProxy Authenticator setDefault new ProxyAuth proxyUser proxyPassword else if settingsChanged Authenticator setDefault new ProxyAuth private void traceSettingInfo log proxyHost null proxyHost proxyPort Project MSG_VERBOSE public void execute throws BuildException applyWebProxySettings private static final class ProxyAuth extends Authenticator private PasswordAuthentication auth private ProxyAuth String user String pass auth new PasswordAuthentication user pass toCharArray protected PasswordAuthentication getPasswordAuthentication return auth public class KeepAliveInputStream extends FilterInputStream public KeepAliveInputStream InputStream in super in public void close throws IOException public class CallTarget extends Task private Ant callee private boolean inheritAll true private boolean inheritRefs false private boolean targetSet false public void setInheritAll boolean inherit inheritAll inherit public void setInheritRefs boolean inheritRefs this inheritRefs inheritRefs public void init callee new Ant this callee init public void execute throws BuildException if callee null init if targetSet throw new BuildException getLocation callee setAntfile getProject getProperty callee setInheritAll inheritAll callee setInheritRefs inheritRefs callee execute public Property createParam if callee null init return callee createProperty public void addReference Ant Reference if callee null init callee addReference public void addPropertyset PropertySet ps if callee null init callee addPropertyset ps public void setTarget String target if callee null init callee setTarget target targetSet true public void addConfiguredTarget Ant TargetElement if callee null init callee addConfiguredTarget targetSet true public void handleOutput String output if callee null callee handleOutput output else super handleOutput output public int handleInput byte buffer int offset int length throws IOException if callee null return callee handleInput buffer offset length return super handleInput buffer offset length public void handleFlush String output if callee null callee handleFlush output else super handleFlush output public void handleErrorOutput String output if callee null callee handleErrorOutput output else super handleErrorOutput output public void handleErrorFlush String output if callee null callee handleErrorFlush output else super handleErrorFlush output public abstract class DefBase extends AntlibDefinition private ClassLoader createdLoader private ClasspathUtils Delegate cpDelegate protected boolean hasCpDelegate return cpDelegate null public void setReverseLoader boolean reverseLoader getDelegate setReverseLoader reverseLoader log Project MSG_WARN public Path getClasspath return getDelegate getClasspath public boolean isReverseLoader return getDelegate isReverseLoader public String getLoaderId return getDelegate getClassLoadId public String getClasspathId return getDelegate getClassLoadId public void setClasspath Path classpath getDelegate setClasspath classpath public Path createClasspath return getDelegate createClasspath public void setClasspathRef Reference getDelegate setClasspathref public void setLoaderRef Reference getDelegate setLoaderRef protected ClassLoader createLoader if getAntlibClassLoader null cpDelegate null return getAntlibClassLoader if createdLoader null createdLoader getDelegate getClassLoader AntClassLoader createdLoader addSystemPackageRoot return createdLoader public void init throws BuildException super init private ClasspathUtils Delegate getDelegate if cpDelegate null cpDelegate ClasspathUtils getDelegate this return cpDelegate public class ZipOutputStream extends FilterOutputStream public static final int DEFLATED java util zip ZipEntry DEFLATED public static final int DEFAULT_COMPRESSION Deflater DEFAULT_COMPRESSION public static final int STORED java util zip ZipEntry STORED private ZipEntry entry private String comment private int level DEFAULT_COMPRESSION private boolean hasCompressionLevelChanged false private int method java util zip ZipEntry DEFLATED private Vector entries new Vector private CRC32 crc new CRC32 private long written private long dataStart private long localDataStart private long cdOffset private long cdLength private static final byte ZERO private static final byte LZERO private Hashtable offsets new Hashtable private String encoding null protected Deflater def new Deflater level true protected byte buf new byte private RandomAccessFile raf null public ZipOutputStream OutputStream out super out public ZipOutputStream File file throws IOException super null try raf new RandomAccessFile file raf setLength catch IOException if raf null try raf close catch IOException inner raf null out new FileOutputStream file public boolean isSeekable return raf null public void setEncoding String encoding this encoding encoding public String getEncoding return encoding public void finish throws IOException closeEntry cdOffset written for int entriesSize entries size entriesSize writeCentralFileHeader ZipEntry entries elementAt cdLength written cdOffset writeCentralDirectoryEnd offsets clear entries removeAllElements public void closeEntry throws IOException if entry null return long realCrc crc getValue crc reset if entry getMethod DEFLATED def finish while def finished deflate entry setSize adjustToLong def getTotalIn entry setCompressedSize adjustToLong def getTotalOut entry setCrc realCrc def reset written entry getCompressedSize else if raf null if entry getCrc realCrc throw new ZipException entry getName Long toHexString entry getCrc Long toHexString realCrc if entry getSize written dataStart throw new ZipException entry getName entry getSize written dataStart long size written dataStart entry setSize size entry setCompressedSize size entry setCrc realCrc if raf null long save raf getFilePointer raf seek localDataStart writeOut ZipLong getBytes entry getCrc writeOut ZipLong getBytes entry getCompressedSize writeOut ZipLong getBytes entry getSize raf seek save writeDataDescriptor entry entry null public void putNextEntry ZipEntry ze throws IOException closeEntry entry ze entries addElement entry entry setMethod method entry setTime System currentTimeMillis if entry getMethod STORED raf null if entry getSize throw new ZipException if entry getCrc throw new ZipException entry setCompressedSize entry getSize if entry getMethod DEFLATED hasCompressionLevelChanged def setLevel level hasCompressionLevelChanged false writeLocalFileHeader entry public void setComment String comment this comment comment public void setLevel int level if level Deflater DEFAULT_COMPRESSION level Deflater BEST_COMPRESSION throw new IllegalArgumentException level hasCompressionLevelChanged this level level this level level public void setMethod int method this method method public void write byte int offset int length throws IOException if entry getMethod DEFLATED if length if def finished def setInput offset length while def needsInput deflate else writeOut offset length written length crc update offset length public void write int throws IOException byte buff new byte buff byte write buff public void close throws IOException finish if raf null raf close if out null out close public void flush throws IOException if out null out flush protected static final byte LFH_SIG ZipLong getBytes protected static final byte DD_SIG ZipLong getBytes protected static final byte CFH_SIG ZipLong getBytes protected static final byte EOCD_SIG ZipLong getBytes protected final void deflate throws IOException int len def deflate buf buf length if len writeOut buf len protected void writeLocalFileHeader ZipEntry ze throws IOException offsets put ze ZipLong getBytes written writeOut LFH_SIG written final int zipMethod ze getMethod if zipMethod DEFLATED raf null writeOut ZipShort getBytes writeOut ZipShort getBytes else writeOut ZipShort getBytes writeOut ZERO written writeOut ZipShort getBytes zipMethod written writeOut toDosTime ze getTime written localDataStart written if zipMethod DEFLATED raf null writeOut LZERO writeOut LZERO writeOut LZERO else writeOut ZipLong getBytes ze getCrc writeOut ZipLong getBytes ze getSize writeOut ZipLong getBytes ze getSize written byte name getBytes ze getName writeOut ZipShort getBytes name length written byte extra ze getLocalFileDataExtra writeOut ZipShort getBytes extra length written writeOut name written name length writeOut extra written extra length dataStart written protected void writeDataDescriptor ZipEntry ze throws IOException if ze getMethod DEFLATED raf null return writeOut DD_SIG writeOut ZipLong getBytes entry getCrc writeOut ZipLong getBytes entry getCompressedSize writeOut ZipLong getBytes entry getSize written protected void writeCentralFileHeader ZipEntry ze throws IOException writeOut CFH_SIG written writeOut ZipShort getBytes ze getPlatform written if ze getMethod DEFLATED raf null writeOut ZipShort getBytes writeOut ZipShort getBytes else writeOut ZipShort getBytes writeOut ZERO written writeOut ZipShort getBytes ze getMethod written writeOut toDosTime ze getTime written writeOut ZipLong getBytes ze getCrc writeOut ZipLong getBytes ze getCompressedSize writeOut ZipLong getBytes ze getSize written byte name getBytes ze getName writeOut ZipShort getBytes name length written byte extra ze getCentralDirectoryExtra writeOut ZipShort getBytes extra length written String comm ze getComment if comm null comm byte commentB getBytes comm writeOut ZipShort getBytes commentB length written writeOut ZERO written writeOut ZipShort getBytes ze getInternalAttributes written writeOut ZipLong getBytes ze getExternalAttributes written writeOut byte offsets get ze written writeOut name written name length writeOut extra written extra length writeOut commentB written commentB length protected void writeCentralDirectoryEnd throws IOException writeOut EOCD_SIG writeOut ZERO writeOut ZERO byte num ZipShort getBytes entries size writeOut num writeOut num writeOut ZipLong getBytes cdLength writeOut ZipLong getBytes cdOffset byte data getBytes comment writeOut ZipShort getBytes data length writeOut data private static final byte DOS_TIME_MIN ZipLong getBytes protected static ZipLong toDosTime Date time return new ZipLong toDosTime time getTime protected static byte toDosTime long Date time new Date int year time getYear if year return DOS_TIME_MIN int month time getMonth long value year month time getDate time getHours time getMinutes time getSeconds return ZipLong getBytes value protected byte getBytes String name throws ZipException if encoding null return name getBytes else try return name getBytes encoding catch UnsupportedEncodingException uee throw new ZipException uee getMessage protected final void writeOut byte data throws IOException writeOut data data length protected final void writeOut byte data int offset int length throws IOException if raf null raf write data offset length else out write data offset length protected static long adjustToLong int if return long Integer MAX_VALUE else return public class P4Label extends P4Base protected String name protected String desc protected String lock public void setName String name this name name public void setDesc String desc this desc desc public void setLock String lock this lock lock public void execute throws BuildException log Project MSG_INFO if P4View null P4View length else P4View StringUtils replace P4View P4View StringUtils replace P4View if desc null desc length log Project MSG_WARN desc if lock null lock equalsIgnoreCase log Project MSG_WARN if name null name length SimpleDateFormat formatter new SimpleDateFormat Date now new Date name formatter format now log name Project MSG_WARN String newLabel name desc P4View P4Handler handler new P4HandlerAdapter public void process String line log line Project MSG_VERBOSE handler setOutput newLabel execP4Command handler execP4Command name new P4HandlerAdapter public void process String line log line Project MSG_VERBOSE log name desc P4View Project MSG_INFO if lock null lock equalsIgnoreCase log Project MSG_INFO final StringBuffer labelSpec new StringBuffer handler new P4HandlerAdapter public void process String line log line Project MSG_VERBOSE if util match line line lock labelSpec append line execP4Command name handler log labelSpec toString Project MSG_DEBUG log Project MSG_VERBOSE handler new P4HandlerAdapter public void process String line log line Project MSG_VERBOSE handler setOutput labelSpec toString execP4Command handler public interface XSLTLiaison void setStylesheet File stylesheet throws Exception void addParam String name String expression throws Exception void transform File infile File outfile throws Exception public class BCFileSet extends FileSet public BCFileSet public BCFileSet FileSet fs super fs public Iterator iterator if isReference return FileSet getRef getProject iterator FileResourceIterator result new FileResourceIterator getDir result addFiles getDirectoryScanner getIncludedFiles result addFiles getDirectoryScanner getIncludedDirectories return result public int size if isReference return FileSet getRef getProject size return getDirectoryScanner getIncludedFilesCount getDirectoryScanner getIncludedDirsCount public class ExtraAttribute private String name private String value public void setName final String name this name name public void setValue final String value this value value String getName return name String getValue return value public void validate throws BuildException if null name final String message throw new BuildException message else if null value final String message name throw new BuildException message public abstract class MSVSS extends Task implements MSVSSConstants private String ssDir null private String vssLogin null private String vssPath null private String serverPath null private String version null private String date null private String label null private String autoResponse null private String localPath null private String comment null private String fromLabel null private String toLabel null private String outputFileName null private String user null private String fromDate null private String toDate null private String style null private boolean quiet false private boolean recursive false private boolean writable false private boolean failOnError true private boolean getLocalCopy true private int numDays Integer MIN_VALUE private DateFormat dateFormat DateFormat getDateInstance DateFormat SHORT private CurrentModUpdated timestamp null private WritableFiles writableFiles null abstract Commandline buildCmdLine public final void setSsdir String dir this ssDir FileUtils translatePath dir public final void setLogin final String vssLogin this vssLogin vssLogin public final void setVsspath final String vssPath String projectPath projectPath vssPath substring else projectPath vssPath if projectPath startsWith PROJECT_PREFIX this vssPath projectPath else this vssPath PROJECT_PREFIX projectPath public final void setServerpath final String serverPath this serverPath serverPath public final void setFailOnError final boolean failOnError this failOnError failOnError public void execute throws BuildException int result Commandline commandLine buildCmdLine result run commandLine if Execute isFailure result getFailOnError String msg formatCommandLine commandLine result throw new BuildException msg getLocation protected void setInternalComment final String comment this comment comment protected void setInternalAutoResponse final String autoResponse this autoResponse autoResponse protected void setInternalDate final String date this date date protected void setInternalDateFormat final DateFormat dateFormat this dateFormat dateFormat protected void setInternalFailOnError final boolean failOnError this failOnError failOnError protected void setInternalFromDate final String fromDate this fromDate fromDate protected void setInternalFromLabel final String fromLabel this fromLabel fromLabel protected void setInternalLabel final String label this label label protected void setInternalLocalPath final String localPath this localPath localPath protected void setInternalNumDays final int numDays this numDays numDays protected void setInternalOutputFilename final String outputFileName this outputFileName outputFileName protected void setInternalQuiet final boolean quiet this quiet quiet protected void setInternalRecursive final boolean recursive this recursive recursive protected void setInternalStyle final String style this style style protected void setInternalToDate final String toDate this toDate toDate protected void setInternalToLabel final String toLabel this toLabel toLabel protected void setInternalUser final String user this user user protected void setInternalVersion final String version this version version protected void setInternalWritable final boolean writable this writable writable protected void setInternalFileTimeStamp final CurrentModUpdated timestamp this timestamp timestamp protected void setInternalWritableFiles final WritableFiles writableFiles this writableFiles writableFiles protected void setInternalGetLocalCopy final boolean getLocalCopy this getLocalCopy getLocalCopy protected String getSSCommand if ssDir null return SS_EXE return ssDir endsWith File separator ssDir SS_EXE ssDir File separator SS_EXE protected String getVsspath return vssPath protected String getQuiet return quiet FLAG_QUIET protected String getRecursive return recursive FLAG_RECURSION protected String getWritable return writable FLAG_WRITABLE protected String getLabel String shortLabel if label null label length shortLabel FLAG_LABEL getShortLabel return shortLabel private String getShortLabel String shortLabel if label null label length shortLabel this label substring log shortLabel Project MSG_WARN else shortLabel label return shortLabel protected String getStyle return style null style protected String getVersionDateLabel String versionDateLabel if version null versionDateLabel FLAG_VERSION version else if date null versionDateLabel FLAG_VERSION_DATE date else String shortLabel getShortLabel if shortLabel null shortLabel equals versionDateLabel FLAG_VERSION_LABEL shortLabel return versionDateLabel protected String getVersion return version null FLAG_VERSION version protected String getLocalpath if localPath null File dir getProject resolveFile localPath if dir exists boolean done dir mkdirs if done String msg localPath throw new BuildException msg getLocation getProject log dir getAbsolutePath lclPath FLAG_OVERRIDE_WORKING_DIR localPath return lclPath protected String getComment return comment null FLAG_COMMENT comment FLAG_COMMENT protected String getAutoresponse if autoResponse null return FLAG_AUTORESPONSE_DEF else if autoResponse equalsIgnoreCase return FLAG_AUTORESPONSE_YES else if autoResponse equalsIgnoreCase return FLAG_AUTORESPONSE_NO else return FLAG_AUTORESPONSE_DEF protected String getLogin return vssLogin null FLAG_LOGIN vssLogin protected String getOutput return outputFileName null FLAG_OUTPUT outputFileName protected String getUser return user null FLAG_USER user protected String getVersionLabel if fromLabel null toLabel null return if fromLabel null toLabel null if fromLabel length fromLabel fromLabel substring log fromLabel Project MSG_WARN if toLabel length toLabel toLabel substring log toLabel Project MSG_WARN return FLAG_VERSION_LABEL toLabel VALUE_FROMLABEL fromLabel else if fromLabel null if fromLabel length fromLabel fromLabel substring log fromLabel Project MSG_WARN return FLAG_VERSION VALUE_FROMLABEL fromLabel else if toLabel length toLabel toLabel substring log toLabel Project MSG_WARN return FLAG_VERSION_LABEL toLabel protected String getVersionDate throws BuildException if fromDate null toDate null numDays Integer MIN_VALUE return if fromDate null toDate null return FLAG_VERSION_DATE toDate VALUE_FROMDATE fromDate else if toDate null numDays Integer MIN_VALUE try return FLAG_VERSION_DATE toDate VALUE_FROMDATE calcDate toDate numDays catch ParseException ex String msg toDate throw new BuildException msg getLocation else if fromDate null numDays Integer MIN_VALUE try return FLAG_VERSION_DATE calcDate fromDate numDays VALUE_FROMDATE fromDate catch ParseException ex String msg fromDate throw new BuildException msg getLocation else return fromDate null FLAG_VERSION VALUE_FROMDATE fromDate FLAG_VERSION_DATE toDate protected String getGetLocalCopy return getLocalCopy FLAG_NO_GET private boolean getFailOnError return getWritableFiles equals WRITABLE_SKIP false failOnError public String getFileTimeStamp if timestamp null return else if timestamp getValue equals TIME_MODIFIED return FLAG_FILETIME_MODIFIED else if timestamp getValue equals TIME_UPDATED return FLAG_FILETIME_UPDATED else return FLAG_FILETIME_DEF public String getWritableFiles if writableFiles null return else if writableFiles getValue equals WRITABLE_REPLACE return FLAG_REPLACE_WRITABLE else if writableFiles getValue equals WRITABLE_SKIP failOnError false return FLAG_SKIP_WRITABLE else return private int run Commandline cmd try Execute exe new Execute new LogStreamHandler this Project MSG_INFO Project MSG_WARN if serverPath null String env exe getEnvironment if env null env new String String newEnv new String env length System arraycopy env newEnv env length newEnv env length serverPath exe setEnvironment newEnv exe setAntRun getProject exe setWorkingDirectory getProject getBaseDir exe setCommandline cmd getCommandline exe setVMLauncher false return exe execute catch IOException throw new BuildException getLocation private String calcDate String startDate int daysToAdd throws ParseException Calendar calendar new GregorianCalendar Date currentDate dateFormat parse startDate calendar setTime currentDate calendar add Calendar DATE daysToAdd return dateFormat format calendar getTime private String formatCommandLine Commandline cmd StringBuffer sBuff new StringBuffer cmd toString int indexUser sBuff substring indexOf FLAG_LOGIN if indexUser int indexPass sBuff substring indexOf indexUser int indexAfterPass sBuff substring indexOf indexPass for int indexPass indexAfterPass sBuff setCharAt return sBuff toString public static class CurrentModUpdated extends EnumeratedAttribute public String getValues return new String TIME_CURRENT TIME_MODIFIED TIME_UPDATED public static class WritableFiles extends EnumeratedAttribute public String getValues return new String WRITABLE_REPLACE WRITABLE_SKIP WRITABLE_FAIL public class Jdk14RegexpRegexp extends Jdk14RegexpMatcher implements Regexp public Jdk14RegexpRegexp super protected int getSubsOptions int options int subsOptions REPLACE_FIRST if RegexpUtil hasFlag options REPLACE_ALL subsOptions REPLACE_ALL return subsOptions public String substitute String input String argument int options throws BuildException StringBuffer subst new StringBuffer for int argument length char argument charAt if subst append subst append else if if argument length argument charAt int value Character digit if value subst append append value else subst append else subst append else subst append argument subst toString int sOptions getSubsOptions options Pattern getCompiledPattern options StringBuffer sb new StringBuffer Matcher matcher input if RegexpUtil hasFlag sOptions REPLACE_ALL sb append replaceAll argument else boolean res find if res appendReplacement sb argument appendTail sb else sb append input return sb toString public class AntVersion implements Condition private String atLeast null private String exactly null public boolean eval throws BuildException validate DeweyDecimal actual getVersion if null atLeast return actual isGreaterThanOrEqual new DeweyDecimal atLeast if null exactly return actual isEqual new DeweyDecimal exactly return false private void validate throws BuildException if atLeast null exactly null throw new BuildException if null atLeast null exactly throw new BuildException try if atLeast null new DeweyDecimal atLeast else new DeweyDecimal exactly catch NumberFormatException throw new BuildException private DeweyDecimal getVersion Project new Project init char versionString getProperty toCharArray StringBuffer sb new StringBuffer boolean foundFirstDigit false for int versionString length if Character isDigit versionString sb append versionString foundFirstDigit true if versionString foundFirstDigit sb append versionString if Character isLetter versionString foundFirstDigit break return new DeweyDecimal sb toString public String getAtLeast return atLeast public void setAtLeast String atLeast this atLeast atLeast public String getExactly return exactly public void setExactly String exactly this exactly exactly public class LazyFileOutputStream extends OutputStream private FileOutputStream fos private File file private boolean append private boolean alwaysCreate private boolean opened false private boolean closed false public LazyFileOutputStream String name this name false public LazyFileOutputStream String name boolean append this new File name append public LazyFileOutputStream File this false public LazyFileOutputStream File file boolean append this file append false public LazyFileOutputStream File file boolean append boolean alwaysCreate this file file this append append this alwaysCreate alwaysCreate public void open throws IOException ensureOpened public synchronized void close throws IOException if alwaysCreate closed ensureOpened if opened fos close closed true public void write byte throws IOException write length public synchronized void write byte int offset int len throws IOException ensureOpened fos write offset len public synchronized void write int throws IOException ensureOpened fos write private synchronized void ensureOpened throws IOException if closed throw new IOException file if opened fos new FileOutputStream file getAbsolutePath append opened true public class LoaderUtils private static final FileUtils FILE_UTILS FileUtils getFileUtils public static void setContextClassLoader ClassLoader loader Thread currentThread Thread currentThread currentThread setContextClassLoader loader public static ClassLoader getContextClassLoader Thread currentThread Thread currentThread return currentThread getContextClassLoader public static boolean isContextLoaderAvailable return true private static File normalizeSource File source if source null try source FILE_UTILS normalize source getAbsolutePath catch BuildException return source public static File getClassSource Class return normalizeSource Locator getClassSource public static File getResourceSource ClassLoader String resource if null LoaderUtils class getClassLoader return normalizeSource Locator getResourceSource resource public static String classNameToResource String className return className replace public static boolean classExists ClassLoader loader String className return loader getResource classNameToResource className null public class AntClassLoader2 extends AntClassLoader public AntClassLoader2 public class ForkingSunRmic extends DefaultRmicAdapter public static final String COMPILER_NAME public boolean execute throws BuildException Rmic owner getRmic Commandline cmd setupRmicCommand Project project owner getProject cmd setExecutable JavaEnvUtils getJdkExecutable getExecutableName String args cmd getCommandline try Execute exe new Execute new LogStreamHandler owner Project MSG_INFO Project MSG_WARN exe setAntRun project exe setWorkingDirectory project getBaseDir exe setCommandline args exe execute return exe isFailure catch IOException exception throw new BuildException getExecutableName exception protected String getExecutableName return SunRmic RMIC_EXECUTABLE public final class StringUtils private StringUtils public static final String LINE_SEP System getProperty public static Vector lineSplit String data return split data public static Vector split String data int ch Vector elems new Vector int pos int while pos data indexOf ch String elem data substring pos elems addElement elem pos elems addElement data substring return elems public static String replace String data String from String to StringBuffer buf new StringBuffer data length int pos int while pos data indexOf from buf append data substring pos append to pos from length buf append data substring return buf toString public static String getStackTrace Throwable StringWriter sw new StringWriter PrintWriter pw new PrintWriter sw true printStackTrace pw pw flush pw close return sw toString public static boolean endsWith StringBuffer buffer String suffix if suffix length buffer length return false int endIndex suffix length int bufferIndex buffer length while endIndex if buffer charAt bufferIndex suffix charAt endIndex return false bufferIndex endIndex return true public static String resolveBackSlash String input StringBuffer new StringBuffer boolean backSlashSeen false for int input length char input charAt if backSlashSeen if backSlashSeen true else append else switch case append char break case append char break case append char break case append char break case append char break case append break default append backSlashSeen false return toString public static long parseHumanSizes String humanSize throws Exception final long KILOBYTE final long MEGABYTE KILOBYTE final long GIGABYTE MEGABYTE final long TERABYTE GIGABYTE final long PETABYTE TERABYTE if Character isDigit humanSize charAt humanSize length char humanSize charAt humanSize length long value Long valueOf humanSize substring humanSize length longValue switch case return value KILOBYTE case return value MEGABYTE case return value GIGABYTE case return value TERABYTE case return value PETABYTE default return value else return Long parseLong humanSize public final class Parameter private String name null private String type null private String value null public void setName final String name this name name public void setType final String type this type type public void setValue final String value this value value public String getName return name public String getType return type public String getValue return value public class Jdk14RegexpMatcher implements RegexpMatcher private String pattern public Jdk14RegexpMatcher public void setPattern String pattern this pattern pattern public String getPattern return pattern protected Pattern getCompiledPattern int options throws BuildException int cOptions getCompilerOptions options try Pattern Pattern compile this pattern cOptions return catch PatternSyntaxException throw new BuildException public boolean matches String argument throws BuildException return matches argument MATCH_DEFAULT public boolean matches String input int options throws BuildException try Pattern getCompiledPattern options return matcher input find catch Exception throw new BuildException public Vector getGroups String argument throws BuildException return getGroups argument MATCH_DEFAULT public Vector getGroups String input int options throws BuildException Pattern getCompiledPattern options Matcher matcher matcher input if matcher find return null Vector new Vector int cnt matcher groupCount for int cnt String match matcher group if match null match addElement match return protected int getCompilerOptions int options int cOptions Pattern UNIX_LINES if RegexpUtil hasFlag options MATCH_CASE_INSENSITIVE cOptions Pattern CASE_INSENSITIVE if RegexpUtil hasFlag options MATCH_MULTILINE cOptions Pattern MULTILINE if RegexpUtil hasFlag options MATCH_SINGLELINE cOptions Pattern DOTALL return cOptions public class DirectoryScanner implements FileScanner SelectorScanner ResourceFactory private static final boolean ON_VMS Os isFamily protected static final String DEFAULTEXCLUDES private static final FileUtils FILE_UTILS FileUtils getFileUtils private static final boolean CS_SCAN_ONLY new boolean true private static final boolean CS_THEN_NON_CS new boolean true false private static Vector defaultExcludes new Vector static resetDefaultExcludes protected File basedir protected String includes protected String excludes protected FileSelector selectors null protected Vector filesIncluded protected Vector filesNotIncluded protected Vector filesExcluded protected Vector dirsIncluded protected Vector dirsNotIncluded protected Vector dirsExcluded protected Vector filesDeselected protected Vector dirsDeselected protected boolean haveSlowResults false protected boolean isCaseSensitive true private boolean followSymlinks true protected boolean everythingIncluded true private Map fileListMap new HashMap private Set scannedDirs new HashSet private Set includeNonPatterns new HashSet private Set excludeNonPatterns new HashSet private String includePatterns private String excludePatterns private boolean areNonPatternSetsReady false private boolean scanning false private Object scanLock new Object private boolean slowScanning false private Object slowScanLock new Object private IllegalStateException illegal null public DirectoryScanner protected static boolean matchPatternStart String pattern String str return SelectorUtils matchPatternStart pattern str protected static boolean matchPatternStart String pattern String str boolean isCaseSensitive return SelectorUtils matchPatternStart pattern str isCaseSensitive protected static boolean matchPath String pattern String str return SelectorUtils matchPath pattern str protected static boolean matchPath String pattern String str boolean isCaseSensitive return SelectorUtils matchPath pattern str isCaseSensitive public static boolean match String pattern String str return SelectorUtils match pattern str protected static boolean match String pattern String str boolean isCaseSensitive return SelectorUtils match pattern str isCaseSensitive public static String getDefaultExcludes return String defaultExcludes toArray new String defaultExcludes size public static boolean addDefaultExclude String if defaultExcludes indexOf defaultExcludes add return true return false public static boolean removeDefaultExclude String return defaultExcludes remove public static void resetDefaultExcludes defaultExcludes new Vector for int DEFAULTEXCLUDES length defaultExcludes add DEFAULTEXCLUDES public void setBasedir String basedir setBasedir basedir null File null new File basedir replace File separatorChar replace File separatorChar public synchronized void setBasedir File basedir this basedir basedir public synchronized File getBasedir return basedir public synchronized boolean isCaseSensitive return isCaseSensitive public synchronized void setCaseSensitive boolean isCaseSensitive this isCaseSensitive isCaseSensitive public synchronized boolean isFollowSymlinks return followSymlinks public synchronized void setFollowSymlinks boolean followSymlinks this followSymlinks followSymlinks public synchronized void setIncludes String includes if includes null this includes null else this includes new String includes length for int includes length this includes normalizePattern includes public synchronized void setExcludes String excludes if excludes null this excludes null else this excludes new String excludes length for int excludes length this excludes normalizePattern excludes public synchronized void addExcludes String excludes if excludes null excludes length if this excludes null this excludes length String tmp new String excludes length this excludes length System arraycopy this excludes tmp this excludes length for int excludes length tmp this excludes length normalizePattern excludes this excludes tmp else setExcludes excludes private static String normalizePattern String String pattern replace File separatorChar replace File separatorChar if pattern endsWith File separator pattern return pattern public synchronized void setSelectors FileSelector selectors this selectors selectors public synchronized boolean isEverythingIncluded return everythingIncluded public void scan throws IllegalStateException synchronized scanLock if scanning while scanning try scanLock wait catch InterruptedException continue if illegal null throw illegal return scanning true try synchronized this illegal null clearResults boolean nullIncludes includes null includes nullIncludes new String includes boolean nullExcludes excludes null excludes nullExcludes new String excludes if basedir null if nullIncludes return else if basedir exists illegal new IllegalStateException basedir if basedir isDirectory illegal new IllegalStateException basedir if illegal null throw illegal if isIncluded if isExcluded if isSelected basedir dirsIncluded addElement else dirsDeselected addElement else dirsExcluded addElement else dirsNotIncluded addElement checkIncludePatterns clearCaches includes nullIncludes null includes excludes nullExcludes null excludes finally synchronized scanLock scanning false scanLock notifyAll private void checkIncludePatterns Map newroots new HashMap for int includes length if FileUtils isAbsolutePath includes if basedir null SelectorUtils matchPatternStart includes basedir getAbsolutePath isCaseSensitive continue else if basedir null continue newroots put SelectorUtils rtrimWildcardTokens includes includes if newroots containsKey basedir null scandir basedir true else Iterator it newroots entrySet iterator File canonBase null if basedir null try canonBase basedir getCanonicalFile catch IOException ex throw new BuildException ex while it hasNext Map Entry entry Map Entry it next String currentelement String entry getKey if basedir null FileUtils isAbsolutePath currentelement continue String originalpattern String entry getValue File myfile new File basedir currentelement if myfile exists try String path basedir null myfile getCanonicalPath FILE_UTILS removeLeadingPath canonBase myfile getCanonicalFile if path equals currentelement ON_VMS myfile findFile basedir currentelement true if myfile null basedir null currentelement FILE_UTILS removeLeadingPath basedir myfile catch IOException ex throw new BuildException ex if myfile null myfile exists isCaseSensitive File findFile basedir currentelement false if null exists currentelement basedir null getAbsolutePath FILE_UTILS removeLeadingPath basedir myfile if myfile null myfile exists if followSymlinks isSymlink basedir currentelement continue if myfile isDirectory if isIncluded currentelement currentelement length accountForIncludedDir currentelement myfile true else if currentelement length if currentelement charAt currentelement length File separatorChar currentelement currentelement File separatorChar scandir myfile currentelement true else boolean included isCaseSensitive originalpattern equals currentelement originalpattern equalsIgnoreCase currentelement if included accountForIncludedFile currentelement myfile protected synchronized void clearResults filesIncluded new Vector filesNotIncluded new Vector filesExcluded new Vector filesDeselected new Vector dirsIncluded new Vector dirsNotIncluded new Vector dirsExcluded new Vector dirsDeselected new Vector everythingIncluded basedir null scannedDirs clear protected void slowScan synchronized slowScanLock if haveSlowResults return if slowScanning while slowScanning try slowScanLock wait catch InterruptedException return slowScanning true try synchronized this boolean nullIncludes includes null includes nullIncludes new String includes boolean nullExcludes excludes null excludes nullExcludes new String excludes String excl new String dirsExcluded size dirsExcluded copyInto excl String notIncl new String dirsNotIncluded size dirsNotIncluded copyInto notIncl processSlowScan excl processSlowScan notIncl clearCaches includes nullIncludes null includes excludes nullExcludes null excludes finally synchronized slowScanLock haveSlowResults true slowScanning false slowScanLock notifyAll private void processSlowScan String arr for int arr length if couldHoldIncluded arr scandir new File basedir arr arr File separator false protected void scandir File dir String vpath boolean fast if dir null throw new BuildException else if dir exists throw new BuildException dir else if dir isDirectory throw new BuildException dir if fast hasBeenScanned vpath return String newfiles dir list if newfiles null throw new BuildException dir getAbsolutePath if followSymlinks Vector noLinks new Vector for int newfiles length try if FILE_UTILS isSymbolicLink dir newfiles String name vpath newfiles File file new File dir newfiles file isDirectory dirsExcluded filesExcluded addElement name else noLinks addElement newfiles catch IOException ioe String msg System err println msg noLinks addElement newfiles newfiles String noLinks toArray new String noLinks size for int newfiles length String name vpath newfiles File file new File dir newfiles if file isDirectory if isIncluded name accountForIncludedDir name file fast else everythingIncluded false dirsNotIncluded addElement name if fast couldHoldIncluded name scandir file name File separator fast if fast scandir file name File separator fast else if file isFile if isIncluded name accountForIncludedFile name file else everythingIncluded false filesNotIncluded addElement name private void accountForIncludedFile String name File file processIncluded name file filesIncluded filesExcluded filesDeselected private void accountForIncludedDir String name File file boolean fast processIncluded name file dirsIncluded dirsExcluded dirsDeselected if fast couldHoldIncluded name contentsExcluded name scandir file name File separator fast private void processIncluded String name File file Vector inc Vector exc Vector des if inc contains name exc contains name des contains name return boolean included false if isExcluded name exc add name else if isSelected name file included true inc add name else des add name everythingIncluded included protected boolean isIncluded String name ensureNonPatternSetsReady if isCaseSensitive includeNonPatterns contains name includeNonPatterns contains name toUpperCase return true for int includePatterns length if matchPath includePatterns name isCaseSensitive return true return false protected boolean couldHoldIncluded String name for int includes length if matchPatternStart includes name isCaseSensitive isMorePowerfulThanExcludes name includes isDeeper includes name return true return false private boolean isDeeper String pattern String name Vector SelectorUtils tokenizePath pattern Vector SelectorUtils tokenizePath name return contains size size private boolean isMorePowerfulThanExcludes String name String includepattern String soughtexclude name File separator for int counter counter excludes length counter if excludes counter equals soughtexclude return false return true private boolean contentsExcluded String name name name endsWith File separator name name File separator for int excludes length String excludes if endsWith SelectorUtils matchPath substring length name isCaseSensitive return true return false protected boolean isExcluded String name ensureNonPatternSetsReady if isCaseSensitive excludeNonPatterns contains name excludeNonPatterns contains name toUpperCase return true for int excludePatterns length if matchPath excludePatterns name isCaseSensitive return true return false protected boolean isSelected String name File file if selectors null for int selectors length if selectors isSelected basedir name file return false return true public synchronized String getIncludedFiles if filesIncluded null throw new IllegalStateException String files new String filesIncluded size filesIncluded copyInto files Arrays sort files return files public synchronized int getIncludedFilesCount if filesIncluded null throw new IllegalStateException return filesIncluded size public synchronized String getNotIncludedFiles slowScan String files new String filesNotIncluded size filesNotIncluded copyInto files return files public synchronized String getExcludedFiles slowScan String files new String filesExcluded size filesExcluded copyInto files return files public synchronized String getDeselectedFiles slowScan String files new String filesDeselected size filesDeselected copyInto files return files public synchronized String getIncludedDirectories if dirsIncluded null throw new IllegalStateException String directories new String dirsIncluded size dirsIncluded copyInto directories Arrays sort directories return directories public synchronized int getIncludedDirsCount if dirsIncluded null throw new IllegalStateException return dirsIncluded size public synchronized String getNotIncludedDirectories slowScan String directories new String dirsNotIncluded size dirsNotIncluded copyInto directories return directories public synchronized String getExcludedDirectories slowScan String directories new String dirsExcluded size dirsExcluded copyInto directories return directories public synchronized String getDeselectedDirectories slowScan String directories new String dirsDeselected size dirsDeselected copyInto directories return directories public synchronized void addDefaultExcludes int excludesLength excludes null excludes length String newExcludes newExcludes new String excludesLength defaultExcludes size if excludesLength System arraycopy excludes newExcludes excludesLength String defaultExcludesTemp getDefaultExcludes for int defaultExcludesTemp length newExcludes excludesLength defaultExcludesTemp replace File separatorChar replace File separatorChar excludes newExcludes public synchronized Resource getResource String name return new FileResource basedir name private String list File file String files String fileListMap get file if files null files file list if files null fileListMap put file files return files private File findFile File base String path boolean cs if FileUtils isAbsolutePath path if base null String FILE_UTILS dissect path base new File path else File FILE_UTILS normalize path String FILE_UTILS removeLeadingPath base if equals getAbsolutePath return null path return findFile base SelectorUtils tokenizePath path cs private File findFile File base Vector pathElements boolean cs if pathElements size return base String current String pathElements remove if base null return findFile new File current pathElements cs if base isDirectory return null String files list base if files null throw new BuildException base getAbsolutePath boolean matchCase cs CS_SCAN_ONLY CS_THEN_NON_CS for int matchCase length for int files length if matchCase files equals current files equalsIgnoreCase current return findFile new File base files pathElements cs return null private boolean isSymlink File base String path return isSymlink base SelectorUtils tokenizePath path private boolean isSymlink File base Vector pathElements if pathElements size String current String pathElements remove try return FILE_UTILS isSymbolicLink base current isSymlink new File base current pathElements catch IOException ioe String msg System err println msg return false private boolean hasBeenScanned String vpath return scannedDirs add vpath return scannedDirs private synchronized void clearCaches fileListMap clear includeNonPatterns clear excludeNonPatterns clear includePatterns null excludePatterns null areNonPatternSetsReady false private synchronized void ensureNonPatternSetsReady if areNonPatternSetsReady includePatterns fillNonPatternSet includeNonPatterns includes excludePatterns fillNonPatternSet excludeNonPatterns excludes areNonPatternSetsReady true private String fillNonPatternSet Set set String patterns ArrayList al new ArrayList patterns length for int patterns length if SelectorUtils hasWildcards patterns set add isCaseSensitive patterns patterns toUpperCase else al add patterns return set size patterns String al toArray new String al size public class LogOutputStream extends LineOrientedOutputStream private ProjectComponent pc private int level Project MSG_INFO public LogOutputStream Task task int level this ProjectComponent task level public LogOutputStream ProjectComponent pc int level this pc pc this level level protected void processBuffer try super processBuffer catch IOException throw new RuntimeException protected void processLine String line processLine line level protected void processLine String line int level pc log line level public int getMessageLevel return level public interface JspMangler String mapJspToJavaName File jspFile String mapPath String path public class Ildasm extends Task private static final FileUtils FILE_UTILS FileUtils getFileUtils private File sourceFile private File destFile private boolean progressBar false private String encoding private boolean bytes false private boolean linenumbers false private boolean rawExceptionHandling false private boolean showSource false private boolean quoteallnames false private boolean header false private boolean assembler true private boolean metadata false private String visibility private String item private String executable private File resourceDir public void setResourceDir File resourceDir this resourceDir resourceDir public void setExecutable String executable this executable executable public void setEncoding EncodingTypes encoding this encoding encoding getValue public void setAssembler boolean assembler this assembler assembler public void setBytes boolean bytes this bytes bytes public void setDestFile File destFile this destFile destFile public void setHeader boolean header this header header public void setItem String item this item item public void setLinenumbers boolean linenumbers this linenumbers linenumbers public void setMetadata boolean metadata this metadata metadata public void setProgressBar boolean progressBar this progressBar progressBar public void setQuoteallnames boolean quoteallnames this quoteallnames quoteallnames public void setRawExceptionHandling boolean rawExceptionHandling this rawExceptionHandling rawExceptionHandling public void setShowSource boolean showSource this showSource showSource public void setSourceFile File sourceFile this sourceFile sourceFile public void setSrcFile File sourceFile setSourceFile sourceFile public void setVisibility String visibility this visibility visibility private void validate if sourceFile null sourceFile exists sourceFile isFile throw new BuildException if destFile null destFile isDirectory throw new BuildException if resourceDir null resourceDir exists resourceDir isDirectory throw new BuildException private boolean isDisassemblyNeeded if destFile exists log Project MSG_VERBOSE return true long sourceTime sourceFile lastModified long destTime destFile lastModified if sourceTime destTime FILE_UTILS getFileTimestampGranularity log Project MSG_VERBOSE return true else log Project MSG_VERBOSE return false public void execute throws BuildException log Project MSG_WARN validate if isDisassemblyNeeded return NetCommand command new NetCommand this executable command setFailOnError true command addArgument command addArgument destFile toString if progressBar command addArgument if linenumbers command addArgument if showSource command addArgument if quoteallnames command addArgument if header command addArgument if assembler command addArgument if metadata command addArgument command addArgument item if rawExceptionHandling command addArgument command addArgument EncodingTypes getEncodingOption encoding if bytes command addArgument command addArgument visibility command addArgument sourceFile getAbsolutePath File execDir resourceDir if execDir null execDir destFile getParentFile command setDirectory execDir try command runCommand catch BuildException if destFile exists log destFile delete throw public static class EncodingTypes extends EnumeratedAttribute public static final String UNICODE public static final String UTF8 public static final String ASCII public String getValues return new String ASCII UTF8 UNICODE public static String getEncodingOption String enumValue if UNICODE equals enumValue return if UTF8 equals enumValue return return null public static class VisibilityOptions extends EnumeratedAttribute public String getValues return new String public class Apt extends Javac private boolean compile true private String factory private Path factoryPath private Vector options new Vector private File preprocessDir public static final String EXECUTABLE_NAME public static final String ERROR_IGNORING_COMPILER_OPTION public static final String ERROR_WRONG_JAVA_VERSION public static final String WARNING_IGNORING_FORK public static final class Option private String name private String value public Option public String getName return name public void setName String name this name name public String getValue return value public void setValue String value this value value public Apt super super setCompiler AptExternalCompilerAdapter class getName setFork true public String getAptExecutable return JavaEnvUtils getJdkExecutable EXECUTABLE_NAME public void setCompiler String compiler log ERROR_IGNORING_COMPILER_OPTION Project MSG_WARN public void setFork boolean fork if fork log WARNING_IGNORING_FORK Project MSG_WARN public String getCompiler return super getCompiler public boolean isCompile return compile public void setCompile boolean compile this compile compile public String getFactory return factory public void setFactory String factory this factory factory public void setFactoryPathRef Reference ref createFactoryPath setRefid ref public Path createFactoryPath if factoryPath null factoryPath new Path getProject return factoryPath createPath public Path getFactoryPath return factoryPath public Option createOption Option opt new Option options add opt return opt public Vector getOptions return options public File getPreprocessDir return preprocessDir public void setPreprocessDir File preprocessDir this preprocessDir preprocessDir public void execute throws BuildException super execute public class MacroInstance extends Task implements DynamicAttribute TaskContainer private MacroDef macroDef private Map map new HashMap private Map nsElements null private Map presentElements private Hashtable localAttributes private String text null private String implicitTag null private List unknownElements new ArrayList public void setMacroDef MacroDef macroDef this macroDef macroDef public MacroDef getMacroDef return macroDef public void setDynamicAttribute String name String value map put name value public Object createDynamicElement String name throws BuildException throw new BuildException private Map getNsElements if nsElements null nsElements new HashMap for Iterator macroDef getElements entrySet iterator hasNext Map Entry entry Map Entry next nsElements put String entry getKey entry getValue MacroDef TemplateElement te MacroDef TemplateElement entry getValue if te isImplicit implicitTag te getName return nsElements public void addTask Task nestedTask unknownElements add nestedTask private void processTasks if implicitTag null return for Iterator unknownElements iterator hasNext UnknownElement ue UnknownElement next String name ProjectHelper extractNameFromComponentName ue getTag toLowerCase Locale US if getNsElements get name null throw new BuildException name if presentElements get name null throw new BuildException name presentElements put name ue public static class Element implements TaskContainer private List unknownElements new ArrayList public void addTask Task nestedTask unknownElements add nestedTask public List getUnknownElements return unknownElements private static final int STATE_NORMAL private static final int STATE_EXPECT_BRACKET private static final int STATE_EXPECT_NAME private String macroSubs String Map macroMapping if null return null StringBuffer ret new StringBuffer StringBuffer macroName null int state STATE_NORMAL for int length char ch charAt switch state case STATE_NORMAL if ch state STATE_EXPECT_BRACKET else ret append ch break case STATE_EXPECT_BRACKET if ch state STATE_EXPECT_NAME macroName new StringBuffer else if ch state STATE_NORMAL ret append else state STATE_NORMAL ret append ret append ch break case STATE_EXPECT_NAME if ch state STATE_NORMAL String name macroName toString toLowerCase Locale US String value String macroMapping get name if value null ret append ret append name ret append else ret append value macroName null else macroName append ch break default break switch state case STATE_NORMAL break case STATE_EXPECT_BRACKET ret append break case STATE_EXPECT_NAME ret append ret append macroName toString break default break return ret toString public void addText String text this text text private UnknownElement copy UnknownElement ue UnknownElement ret new UnknownElement ue getTag ret setNamespace ue getNamespace ret setProject getProject ret setQName ue getQName ret setTaskType ue getTaskType ret setTaskName ue getTaskName ret setLocation macroDef getBackTrace ue getLocation getLocation if getOwningTarget null Target new Target setProject getProject ret setOwningTarget else ret setOwningTarget getOwningTarget RuntimeConfigurable rc new RuntimeConfigurable ret ue getTaskName rc setPolyType ue getWrapper getPolyType Map ue getWrapper getAttributeMap for Iterator entrySet iterator hasNext Map Entry entry Map Entry next rc setAttribute String entry getKey macroSubs String entry getValue localAttributes rc addText macroSubs ue getWrapper getText toString localAttributes Enumeration ue getWrapper getChildren while hasMoreElements RuntimeConfigurable RuntimeConfigurable nextElement UnknownElement unknownElement UnknownElement getProxy String tag unknownElement getTaskType if tag null tag tag toLowerCase Locale US MacroDef TemplateElement templateElement MacroDef TemplateElement getNsElements get tag if templateElement null UnknownElement child copy unknownElement rc addChild child getWrapper ret addChild child else if templateElement isImplicit if unknownElements size templateElement isOptional throw new BuildException templateElement getName for Iterator unknownElements iterator hasNext UnknownElement child copy UnknownElement next rc addChild child getWrapper ret addChild child else UnknownElement presentElement UnknownElement presentElements get tag if presentElement null if templateElement isOptional throw new BuildException templateElement getName continue String presentText presentElement getWrapper getText toString if equals presentText rc addText macroSubs presentText localAttributes List list presentElement getChildren if list null for Iterator list iterator hasNext UnknownElement child copy UnknownElement next rc addChild child getWrapper ret addChild child return ret public void execute presentElements new HashMap getNsElements processTasks localAttributes new Hashtable Set copyKeys new HashSet map keySet for Iterator macroDef getAttributes iterator hasNext MacroDef Attribute attribute MacroDef Attribute next String value String map get attribute getName if value null equals attribute getName value getDescription if value null value attribute getDefault value macroSubs value localAttributes if value null throw new BuildException attribute getName localAttributes put attribute getName value copyKeys remove attribute getName if copyKeys contains copyKeys remove if macroDef getText null if text null if macroDef getText getOptional throw new BuildException text if macroDef getText getTrim text text trim localAttributes put macroDef getText getName text else if text null text trim equals throw new BuildException getTaskName if copyKeys size throw new BuildException copyKeys size copyKeys UnknownElement copy macroDef getNestedTask init try perform catch BuildException ex if macroDef getBackTrace throw ProjectHelper addLocationToBuildException ex getLocation else ex setLocation getLocation throw ex finally presentElements null localAttributes null public class DemuxOutputStream extends OutputStream private static class BufferInfo private ByteArrayOutputStream buffer private boolean crSeen false private static final int MAX_SIZE private static final int INTIAL_SIZE private static final int CR private static final int LF private WeakHashMap buffers new WeakHashMap private Project project private boolean isErrorStream public DemuxOutputStream Project project boolean isErrorStream this project project this isErrorStream isErrorStream private BufferInfo getBufferInfo Thread current Thread currentThread BufferInfo bufferInfo BufferInfo buffers get current if bufferInfo null bufferInfo new BufferInfo bufferInfo buffer new ByteArrayOutputStream INTIAL_SIZE bufferInfo crSeen false buffers put current bufferInfo return bufferInfo private void resetBufferInfo Thread current Thread currentThread BufferInfo bufferInfo BufferInfo buffers get current try bufferInfo buffer close catch IOException bufferInfo buffer new ByteArrayOutputStream bufferInfo crSeen false private void removeBuffer Thread current Thread currentThread buffers remove current public void write int cc throws IOException final byte byte cc BufferInfo bufferInfo getBufferInfo if bufferInfo buffer write cc processBuffer bufferInfo buffer else if bufferInfo crSeen processBuffer bufferInfo buffer bufferInfo buffer write cc bufferInfo crSeen if bufferInfo crSeen bufferInfo buffer size MAX_SIZE processBuffer bufferInfo buffer protected void processBuffer ByteArrayOutputStream buffer String output buffer toString project demuxOutput output isErrorStream resetBufferInfo protected void processFlush ByteArrayOutputStream buffer String output buffer toString project demuxFlush output isErrorStream resetBufferInfo public void close throws IOException flush removeBuffer public void flush throws IOException BufferInfo bufferInfo getBufferInfo if bufferInfo buffer size processFlush bufferInfo buffer public void write byte int off int len throws IOException int offset off int blockStartOffset offset int remaining len BufferInfo bufferInfo getBufferInfo while remaining while remaining offset LF offset CR offset remaining int blockLength offset blockStartOffset if blockLength bufferInfo buffer write blockStartOffset blockLength while remaining offset LF offset CR write offset offset remaining blockStartOffset offset public class ZipScanner extends ArchiveScanner protected void fillMapsFromArchive Resource src String encoding Map fileEntries Map matchFileEntries Map dirEntries Map matchDirEntries ZipEntry entry null ZipFile zf null File srcFile null if src instanceof FileResource srcFile FileResource src getFile else throw new BuildException try try zf new ZipFile srcFile encoding catch ZipException ex throw new BuildException srcFile ex catch IOException ex throw new BuildException srcFile ex Enumeration zf getEntries while hasMoreElements entry ZipEntry nextElement Resource new ZipResource srcFile encoding entry String name entry getName if entry isDirectory name trimSeparator name dirEntries put name if match name matchDirEntries put name else fileEntries put name if match name matchFileEntries put name finally if zf null try zf close catch IOException ex public class ExecTask extends Task private static final FileUtils FILE_UTILS FileUtils getFileUtils private String os private String osFamily private File dir protected boolean failOnError false protected boolean newEnvironment false private Long timeout null private Environment env new Environment protected Commandline cmdl new Commandline private String resultProperty private boolean failIfExecFails true private String executable private boolean resolveExecutable false private boolean searchPath false private boolean spawn false private boolean incompatibleWithSpawn false private String inputString private File input private File output private File error protected Redirector redirector new Redirector this protected RedirectorElement redirectorElement private boolean vmLauncher true public ExecTask public ExecTask Task owner bindToOwner owner public void setSpawn boolean spawn this spawn spawn public void setTimeout Long value timeout value incompatibleWithSpawn true public void setTimeout Integer value setTimeout Long value null null new Long value intValue public void setExecutable String value this executable value cmdl setExecutable value public void setDir File this dir public void setOs String os this os os public void setCommand Commandline cmdl log Project MSG_WARN this cmdl cmdl public void setOutput File out this output out incompatibleWithSpawn true public void setInput File input if inputString null throw new BuildException this input input incompatibleWithSpawn true public void setInputString String inputString if input null throw new BuildException this inputString inputString incompatibleWithSpawn true public void setLogError boolean logError redirector setLogError logError incompatibleWithSpawn logError public void setError File error this error error incompatibleWithSpawn true public void setOutputproperty String outputProp redirector setOutputProperty outputProp incompatibleWithSpawn true public void setErrorProperty String errorProperty redirector setErrorProperty errorProperty incompatibleWithSpawn true public void setFailonerror boolean fail failOnError fail incompatibleWithSpawn fail public void setNewenvironment boolean newenv newEnvironment newenv public void setResolveExecutable boolean resolveExecutable this resolveExecutable resolveExecutable public void setSearchPath boolean searchPath this searchPath searchPath public boolean getResolveExecutable return resolveExecutable public void addEnv Environment Variable var env addVariable var public Commandline Argument createArg return cmdl createArgument public void setResultProperty String resultProperty this resultProperty resultProperty incompatibleWithSpawn true protected void maybeSetResultPropertyValue int result if resultProperty null String res Integer toString result getProject setNewProperty resultProperty res public void setFailIfExecutionFails boolean flag failIfExecFails flag incompatibleWithSpawn true public void setAppend boolean append redirector setAppend append incompatibleWithSpawn true public void addConfiguredRedirector RedirectorElement redirectorElement if this redirectorElement null throw new BuildException this redirectorElement redirectorElement incompatibleWithSpawn true public void setOsFamily String osFamily this osFamily osFamily toLowerCase Locale US protected String resolveExecutable String exec boolean mustSearchPath if resolveExecutable return exec File executableFile getProject resolveFile exec if executableFile exists return executableFile getAbsolutePath if dir null executableFile FILE_UTILS resolveFile dir exec if executableFile exists return executableFile getAbsolutePath if mustSearchPath Path null String environment env getVariables if environment null for int environment length if isPath environment new Path getProject environment substring break if null Vector envVars Execute getProcEnvironment Enumeration envVars elements while hasMoreElements String line String nextElement if isPath line new Path getProject line substring break if null String dirs list for int dirs length executableFile FILE_UTILS resolveFile new File dirs exec if executableFile exists return executableFile getAbsolutePath return exec public void execute throws BuildException if isValidOs return cmdl setExecutable resolveExecutable executable searchPath checkConfiguration try runExec prepareExec finally dir savedDir protected void checkConfiguration throws BuildException if cmdl getExecutable null throw new BuildException getLocation if dir null dir exists throw new BuildException dir if dir null dir isDirectory throw new BuildException dir if spawn incompatibleWithSpawn getProject log Project MSG_ERR getProject log Project MSG_ERR getProject log Project MSG_ERR throw new BuildException setupRedirector protected void setupRedirector redirector setInput input redirector setInputString inputString redirector setOutput output redirector setError error protected boolean isValidOs if osFamily null Os isOs osFamily null null null return false String myos System getProperty log myos Project MSG_VERBOSE if os null os indexOf myos log myos os Project MSG_VERBOSE return false return true public void setVMLauncher boolean vmLauncher this vmLauncher vmLauncher protected Execute prepareExec throws BuildException if dir null dir getProject getBaseDir if redirectorElement null redirectorElement configure redirector Execute exe new Execute createHandler createWatchdog exe setAntRun getProject exe setWorkingDirectory dir exe setVMLauncher vmLauncher exe setSpawn spawn String environment env getVariables if environment null for int environment length log environment Project MSG_VERBOSE exe setNewenvironment newEnvironment exe setEnvironment environment return exe protected final void runExecute Execute exe throws IOException if spawn returnCode exe execute if exe killedProcess String msg if failOnError throw new BuildException msg else log msg Project MSG_WARN maybeSetResultPropertyValue returnCode redirector complete if Execute isFailure returnCode if failOnError throw new BuildException getTaskType returnCode getLocation else log returnCode Project MSG_ERR else exe spawn protected void runExec Execute exe throws BuildException log cmdl describeCommand Project MSG_VERBOSE exe setCommandline cmdl getCommandline try runExecute exe catch IOException if failIfExecFails throw new BuildException toString getLocation else log toString Project MSG_ERR finally logFlush protected ExecuteStreamHandler createHandler throws BuildException return redirector createHandler protected ExecuteWatchdog createWatchdog throws BuildException return timeout null null new ExecuteWatchdog timeout longValue protected void logFlush private boolean isPath String line return line startsWith line startsWith public abstract class DataType extends ProjectComponent implements Cloneable protected Reference ref protected boolean checked true public boolean isReference return ref null public void setRefid final Reference ref this ref ref checked false protected String getDataTypeName return ComponentHelper getElementName getProject this true protected void dieOnCircularReference dieOnCircularReference getProject protected void dieOnCircularReference Project if checked isReference return dieOnCircularReference new IdentityStack this protected void dieOnCircularReference final Stack stack final Project project throws BuildException if checked isReference return Object ref getReferencedObject project if instanceof DataType IdentityStack id IdentityStack getInstance stack if id contains throw circularReference else id push DataType dieOnCircularReference id project id pop checked true public static void invokeCircularReferenceCheck DataType dt Stack stk Project dt dieOnCircularReference stk protected Object getCheckedRef return getCheckedRef getProject protected Object getCheckedRef Project return getCheckedRef getClass getDataTypeName protected Object getCheckedRef final Class requiredClass final String dataTypeName return getCheckedRef requiredClass dataTypeName getProject protected Object getCheckedRef final Class requiredClass final String dataTypeName final Project project if project null throw new BuildException dieOnCircularReference project Object ref getReferencedObject project if requiredClass isAssignableFrom getClass log getClass requiredClass Project MSG_VERBOSE String msg ref getRefId dataTypeName throw new BuildException msg return protected BuildException tooManyAttributes return new BuildException protected BuildException noChildrenAllowed return new BuildException protected BuildException circularReference return new BuildException protected boolean isChecked return checked protected void setChecked final boolean checked this checked checked public Reference getRefid return ref protected void checkAttributesAllowed if isReference throw tooManyAttributes protected void checkChildrenAllowed if isReference throw noChildrenAllowed public String toString String getDescription return null getDataTypeName getDataTypeName public Object clone throws CloneNotSupportedException DataType dt DataType super clone dt setDescription getDescription if getRefid null dt setRefid getRefid dt setChecked isChecked return dt public abstract class ArchiveFileSet extends FileSet private static final int BASE_OCTAL public static final int DEFAULT_DIR_MODE UnixStat DIR_FLAG UnixStat DEFAULT_DIR_PERM public static final int DEFAULT_FILE_MODE UnixStat FILE_FLAG UnixStat DEFAULT_FILE_PERM private Resource src null private String prefix private String fullpath private boolean hasDir false private int fileMode DEFAULT_FILE_MODE private int dirMode DEFAULT_DIR_MODE private boolean fileModeHasBeenSet false private boolean dirModeHasBeenSet false public ArchiveFileSet super protected ArchiveFileSet FileSet fileset super fileset protected ArchiveFileSet ArchiveFileSet fileset super fileset src fileset src prefix fileset prefix fullpath fileset fullpath hasDir fileset hasDir fileMode fileset fileMode dirMode fileset dirMode fileModeHasBeenSet fileset fileModeHasBeenSet dirModeHasBeenSet fileset dirModeHasBeenSet public void setDir File dir throws BuildException checkAttributesAllowed if src null throw new BuildException else super setDir dir hasDir true public void addConfigured ResourceCollection checkChildrenAllowed if size throw new BuildException setSrcResource Resource iterator next public void setSrc File srcFile setSrcResource new FileResource srcFile public void setSrcResource Resource src checkArchiveAttributesAllowed if hasDir throw new BuildException this src src public File getSrc Project if isReference return ArchiveFileSet getRef getSrc return getSrc public File getSrc if src instanceof FileResource return FileResource src getFile return null public void setPrefix String prefix checkArchiveAttributesAllowed if prefix equals fullpath equals throw new BuildException this prefix prefix public String getPrefix Project if isReference return ArchiveFileSet getRef getPrefix return prefix public void setFullpath String fullpath checkArchiveAttributesAllowed if prefix equals fullpath equals throw new BuildException this fullpath fullpath public String getFullpath Project if isReference return ArchiveFileSet getRef getFullpath return fullpath protected abstract ArchiveScanner newArchiveScanner public DirectoryScanner getDirectoryScanner Project if isReference return getRef getDirectoryScanner if src null return super getDirectoryScanner if src isExists throw new BuildException if src isDirectory throw new BuildException ArchiveScanner as newArchiveScanner as setSrc src super setDir getBaseDir setupDirectoryScanner as as init return as public Iterator iterator if isReference return ResourceCollection getRef getProject iterator if src null return super iterator ArchiveScanner as ArchiveScanner getDirectoryScanner getProject return as getResourceFiles public int size if isReference return ResourceCollection getRef getProject size if src null return super size ArchiveScanner as ArchiveScanner getDirectoryScanner getProject return as getIncludedFilesCount public boolean isFilesystemOnly return src null public void setFileMode String octalString checkArchiveAttributesAllowed integerSetFileMode Integer parseInt octalString BASE_OCTAL public void integerSetFileMode int mode fileModeHasBeenSet true this fileMode UnixStat FILE_FLAG mode public int getFileMode Project if isReference return ArchiveFileSet getRef getFileMode return fileMode public boolean hasFileModeBeenSet if isReference return ArchiveFileSet getRef getProject hasFileModeBeenSet return fileModeHasBeenSet public void setDirMode String octalString checkArchiveAttributesAllowed integerSetDirMode Integer parseInt octalString BASE_OCTAL public void integerSetDirMode int mode dirModeHasBeenSet true this dirMode UnixStat DIR_FLAG mode public int getDirMode Project if isReference return ArchiveFileSet getRef getDirMode return dirMode public boolean hasDirModeBeenSet if isReference return ArchiveFileSet getRef getProject hasDirModeBeenSet return dirModeHasBeenSet protected void configureFileSet ArchiveFileSet zfs zfs setPrefix prefix zfs setFullpath fullpath zfs fileModeHasBeenSet fileModeHasBeenSet zfs fileMode fileMode zfs dirModeHasBeenSet dirModeHasBeenSet zfs dirMode dirMode public Object clone if isReference return ArchiveFileSet getRef getProject clone else return super clone public String toString if hasDir getProject null return super toString else if src null return src getName else return null public String getPrefix return prefix public String getFullpath return fullpath public int getFileMode return fileMode public int getDirMode return dirMode private void checkArchiveAttributesAllowed if getProject null isReference getRefid getReferencedObject getProject instanceof ArchiveFileSet checkAttributesAllowed public class XNewRmic extends ForkingSunRmic public static final String COMPILER_NAME public XNewRmic protected Commandline setupRmicCommand String options new String Commandline commandline super setupRmicCommand options return commandline public final class Enumerations private Enumerations public static Enumeration fromArray Object array return new ArrayEnumeration array public static Enumeration fromCompound Enumeration enums return new CompoundEnumeration enums class ArrayEnumeration implements Enumeration private Object array private int pos public ArrayEnumeration Object array this array array this pos public boolean hasMoreElements return pos array length public Object nextElement throws NoSuchElementException if hasMoreElements Object array pos pos return throw new NoSuchElementException class CompoundEnumeration implements Enumeration private Enumeration enumArray private int index public CompoundEnumeration Enumeration enumarray this enumArray enumarray public boolean hasMoreElements while index enumArray length if enumArray index null enumArray index hasMoreElements return true index return false public Object nextElement throws NoSuchElementException if hasMoreElements return enumArray index nextElement throw new NoSuchElementException public class Nice extends Task private Integer newPriority private String currentPriority public void execute throws BuildException Thread self Thread currentThread int priority self getPriority if currentPriority null String current Integer toString priority getProject setNewProperty currentPriority current if newPriority null priority newPriority intValue try self setPriority newPriority intValue catch SecurityException log Project MSG_WARN catch IllegalArgumentException iae throw new BuildException iae public void setCurrentPriority String currentPriority this currentPriority currentPriority public void setNewPriority int newPriority if newPriority Thread MIN_PRIORITY newPriority Thread MAX_PRIORITY throw new BuildException this newPriority new Integer newPriority public class Script extends Task private ScriptRunnerHelper helper new ScriptRunnerHelper public void setProject Project project super setProject project helper setProjectComponent this public void execute throws BuildException helper getScriptRunner executeScript public void setManager String manager helper setManager manager public void setLanguage String language helper setLanguage language public void setSrc String fileName helper setSrc new File fileName public void addText String text helper addText text public void setClasspath Path classpath helper setClasspath classpath public Path createClasspath return helper createClasspath public void setClasspathRef Reference helper setClasspathRef public void setSetBeans boolean setBeans helper setSetBeans setBeans public class JUnitVersionHelper private static Method testCaseName null static try testCaseName TestCase class getMethod new Class catch NoSuchMethodException try testCaseName TestCase class getMethod new Class catch NoSuchMethodException e2 public static String getTestCaseName Test if null getClass getName equals String name toString if name endsWith int paren name lastIndexOf return name substring paren else return name if instanceof TestCase testCaseName null try return String testCaseName invoke new Object catch Throwable else try Method getNameMethod null try getNameMethod getClass getMethod new Class catch NoSuchMethodException getNameMethod getClass getMethod new Class if getNameMethod null getNameMethod getReturnType String class return String getNameMethod invoke new Object catch Throwable return static String getTestCaseClassName Test test String className test getClass getName if test instanceof JUnitTaskMirrorImpl VmExitErrorTest className JUnitTaskMirrorImpl VmExitErrorTest test getClassName else if className equals String name test toString int paren name lastIndexOf if paren name endsWith className name substring paren name length return className public class AntClassLoader extends ClassLoader implements SubBuildListener private static final FileUtils FILE_UTILS FileUtils getFileUtils private class ResourceEnumeration implements Enumeration private String resourceName private int pathElementsIndex private URL nextResource ResourceEnumeration String name this resourceName name this pathElementsIndex findNextResource public boolean hasMoreElements return this nextResource null public Object nextElement URL ret this nextResource findNextResource return ret private void findNextResource URL url null while pathElementsIndex pathComponents size url null try File pathComponent File pathComponents elementAt pathElementsIndex url getResourceURL pathComponent this resourceName pathElementsIndex catch BuildException this nextResource url private static final int BUFFER_SIZE private static final int NUMBER_OF_STRINGS private Vector pathComponents new Vector private Project project private boolean parentFirst true private Vector systemPackages new Vector private Vector loaderPackages new Vector private boolean ignoreBase false private ClassLoader parent null private Hashtable zipFiles new Hashtable private ClassLoader savedContextLoader null private boolean isContextLoaderSaved false public AntClassLoader ClassLoader parent Project project Path classpath setParent parent setClassPath classpath setProject project public AntClassLoader setParent null public AntClassLoader Project project Path classpath setParent null setProject project setClassPath classpath public AntClassLoader ClassLoader parent Project project Path classpath boolean parentFirst this project classpath if parent null setParent parent setParentFirst parentFirst addJavaLibraries public AntClassLoader Project project Path classpath boolean parentFirst this null project classpath parentFirst public AntClassLoader ClassLoader parent boolean parentFirst setParent parent project null this parentFirst parentFirst public void setProject Project project this project project if project null project addBuildListener this public void setClassPath Path classpath pathComponents removeAllElements if classpath null Path actualClasspath classpath concatSystemClasspath String pathElements actualClasspath list for int pathElements length try addPathElement pathElements catch BuildException public void setParent ClassLoader parent if parent null this parent AntClassLoader class getClassLoader else this parent parent public void setParentFirst boolean parentFirst this parentFirst parentFirst protected void log String message int priority if project null project log message priority public void setThreadContextLoader if isContextLoaderSaved throw new BuildException if LoaderUtils isContextLoaderAvailable savedContextLoader LoaderUtils getContextClassLoader ClassLoader loader this if project null equals project getProperty loader this getClass getClassLoader LoaderUtils setContextClassLoader loader isContextLoaderSaved true public void resetThreadContextLoader if LoaderUtils isContextLoaderAvailable isContextLoaderSaved LoaderUtils setContextClassLoader savedContextLoader savedContextLoader null isContextLoaderSaved false public void addPathElement String pathElement throws BuildException File pathComponent project null project resolveFile pathElement new File pathElement try addPathFile pathComponent catch IOException throw new BuildException protected void addPathFile File pathComponent throws IOException pathComponents addElement pathComponent if pathComponent isDirectory return String absPathPlusTimeAndLength pathComponent getAbsolutePath pathComponent lastModified pathComponent length String classpath String pathMap get absPathPlusTimeAndLength if classpath null ZipFile jarFile null InputStream manifestStream null try jarFile new ZipFile pathComponent manifestStream jarFile getInputStream new ZipEntry if manifestStream null return Reader manifestReader new InputStreamReader manifestStream org apache tools ant taskdefs Manifest manifest new org apache tools ant taskdefs Manifest manifestReader classpath manifest getMainSection getAttributeValue catch org apache tools ant taskdefs ManifestException finally if manifestStream null manifestStream close if jarFile null jarFile close if classpath null classpath pathMap put absPathPlusTimeAndLength classpath if equals classpath URL baseURL FILE_UTILS getFileURL pathComponent StringTokenizer st new StringTokenizer classpath while st hasMoreTokens String classpathElement st nextToken URL libraryURL new URL baseURL classpathElement if libraryURL getProtocol equals log classpathElement Project MSG_VERBOSE continue String decodedPath Locator decodeUri libraryURL getFile File libraryFile new File decodedPath if libraryFile exists isInPath libraryFile addPathFile libraryFile public String getClasspath StringBuffer sb new StringBuffer boolean firstPass true Enumeration componentEnum pathComponents elements while componentEnum hasMoreElements if firstPass sb append System getProperty else firstPass false sb append File componentEnum nextElement getAbsolutePath return sb toString public synchronized void setIsolated boolean isolated ignoreBase isolated public static void initializeClass Class theClass final Constructor cons theClass getDeclaredConstructors if cons null if cons length cons null final String strs new String NUMBER_OF_STRINGS try cons newInstance Object strs catch Exception public Class forceLoadClass String classname throws ClassNotFoundException log classname Project MSG_DEBUG Class theClass findLoadedClass classname if theClass null theClass findClass classname return theClass public Class forceLoadSystemClass String classname throws ClassNotFoundException log classname Project MSG_DEBUG Class theClass findLoadedClass classname if theClass null theClass findBaseClass classname return theClass public InputStream getResourceAsStream String name InputStream resourceStream null if isParentFirst name resourceStream loadBaseResource name if resourceStream null log name Project MSG_DEBUG else resourceStream loadResource name if resourceStream null log name Project MSG_DEBUG else resourceStream loadResource name if resourceStream null log name Project MSG_DEBUG else resourceStream loadBaseResource name if resourceStream null log name Project MSG_DEBUG if resourceStream null log name Project MSG_DEBUG return resourceStream private InputStream loadResource String name InputStream stream null Enumeration pathComponents elements while hasMoreElements stream null File pathComponent File nextElement stream getResourceStream pathComponent name return stream private InputStream loadBaseResource String name if parent null return getSystemResourceAsStream name else return parent getResourceAsStream name private InputStream getResourceStream File file String resourceName try if file exists return null if file isDirectory File resource new File file resourceName if resource exists return new FileInputStream resource else ZipFile zipFile ZipFile zipFiles get file if zipFile null zipFile new ZipFile file zipFiles put file zipFile ZipEntry entry zipFile getEntry resourceName if entry null return zipFile getInputStream entry catch Exception log getClass getName getMessage resourceName file Project MSG_VERBOSE return null private boolean isParentFirst String resourceName boolean useParentFirst parentFirst for Enumeration systemPackages elements hasMoreElements useParentFirst true break for Enumeration loaderPackages elements hasMoreElements useParentFirst false break return useParentFirst private ClassLoader getRootLoader ClassLoader ret getClass getClassLoader while ret null ret getParent null ret ret getParent return ret public URL getResource String name URL url null if isParentFirst name url parent null super getResource name parent getResource name if url null log name Project MSG_DEBUG else Enumeration pathComponents elements while hasMoreElements url null File pathComponent File nextElement url getResourceURL pathComponent name if url null log name Project MSG_DEBUG if url null isParentFirst name if ignoreBase url getRootLoader null null getRootLoader getResource name else url parent null super getResource name parent getResource name if url null log name Project MSG_DEBUG if url null log name Project MSG_DEBUG return url if parent null parent getParent base parent getResources name else base new CollectionUtils EmptyEnumeration if isParentFirst name return CollectionUtils append base mine else if ignoreBase return getRootLoader null mine CollectionUtils append mine getRootLoader getResources name else return CollectionUtils append mine base protected URL getResourceURL File file String resourceName try if file exists return null if file isDirectory File resource new File file resourceName if resource exists try return FILE_UTILS getFileURL resource catch MalformedURLException ex return null else ZipFile zipFile ZipFile zipFiles get file if zipFile null zipFile new ZipFile file zipFiles put file zipFile ZipEntry entry zipFile getEntry resourceName if entry null try return new URL FILE_UTILS getFileURL file entry catch MalformedURLException ex return null catch Exception printStackTrace return null protected synchronized Class loadClass String classname boolean resolve throws ClassNotFoundException Class theClass findLoadedClass classname if theClass null return theClass if isParentFirst classname try theClass findBaseClass classname log classname Project MSG_DEBUG catch ClassNotFoundException cnfe theClass findClass classname log classname Project MSG_DEBUG else try theClass findClass classname log classname Project MSG_DEBUG catch ClassNotFoundException cnfe if ignoreBase throw cnfe theClass findBaseClass classname log classname Project MSG_DEBUG if resolve resolveClass theClass return theClass private String getClassFilename String classname return classname replace protected Class defineClassFromData File container byte classData String classname throws IOException definePackage container classname return defineClass classname classData classData length Project class getProtectionDomain protected void definePackage File container String className throws IOException int classIndex className lastIndexOf if classIndex return return Manifest manifest getJarManifest container if manifest null null null else private Manifest getJarManifest File container throws IOException if container isDirectory return null JarFile jarFile null try jarFile new JarFile container return jarFile getManifest finally if jarFile null jarFile close Manifest manifest String specificationTitle null String specificationVendor null String specificationVersion null String implementationTitle null String implementationVendor null String implementationVersion null String sealedString null URL sealBase null Attributes sectionAttributes manifest getAttributes sectionName if sectionAttributes null specificationTitle sectionAttributes getValue Name SPECIFICATION_TITLE specificationVendor sectionAttributes getValue Name SPECIFICATION_VENDOR specificationVersion sectionAttributes getValue Name SPECIFICATION_VERSION implementationTitle sectionAttributes getValue Name IMPLEMENTATION_TITLE implementationVendor sectionAttributes getValue Name IMPLEMENTATION_VENDOR implementationVersion sectionAttributes getValue Name IMPLEMENTATION_VERSION sealedString sectionAttributes getValue Name SEALED Attributes mainAttributes manifest getMainAttributes if mainAttributes null if specificationTitle null specificationTitle mainAttributes getValue Name SPECIFICATION_TITLE if specificationVendor null specificationVendor mainAttributes getValue Name SPECIFICATION_VENDOR if specificationVersion null specificationVersion mainAttributes getValue Name SPECIFICATION_VERSION if implementationTitle null implementationTitle mainAttributes getValue Name IMPLEMENTATION_TITLE if implementationVendor null implementationVendor mainAttributes getValue Name IMPLEMENTATION_VENDOR if implementationVersion null implementationVersion mainAttributes getValue Name IMPLEMENTATION_VERSION if sealedString null sealedString mainAttributes getValue Name SEALED if sealedString null sealedString equalsIgnoreCase try sealBase new URL FileUtils getFileUtils toURI container getAbsolutePath catch MalformedURLException specificationVendor implementationTitle implementationVersion implementationVendor sealBase private Class getClassFromStream InputStream stream String classname File container throws IOException SecurityException ByteArrayOutputStream baos new ByteArrayOutputStream int bytesRead byte buffer new byte BUFFER_SIZE while bytesRead stream read buffer BUFFER_SIZE baos write buffer bytesRead byte classData baos toByteArray return defineClassFromData container classData classname public Class findClass String name throws ClassNotFoundException log name Project MSG_DEBUG return findClassInComponents name protected boolean isInPath File component for Enumeration pathComponents elements hasMoreElements File pathComponent File nextElement if pathComponent equals component return true return false private Class findClassInComponents String name throws ClassNotFoundException InputStream stream null String classFilename getClassFilename name try Enumeration pathComponents elements while hasMoreElements File pathComponent File nextElement try stream getResourceStream pathComponent classFilename if stream null log pathComponent classFilename Project MSG_DEBUG return getClassFromStream stream name pathComponent catch SecurityException se throw se catch IOException ioe log pathComponent ioe getMessage Project MSG_VERBOSE throw new ClassNotFoundException name finally try if stream null stream close catch IOException private Class findBaseClass String name throws ClassNotFoundException if parent null return findSystemClass name else return parent loadClass name public synchronized void cleanup for Enumeration zipFiles elements hasMoreElements ZipFile zipFile ZipFile nextElement try zipFile close catch IOException ioe zipFiles new Hashtable if project null project removeBuildListener this project null public void buildStarted BuildEvent event public void buildFinished BuildEvent event cleanup public void subBuildFinished BuildEvent event if event getProject project cleanup public void subBuildStarted BuildEvent event public void targetStarted BuildEvent event public void targetFinished BuildEvent event public void taskStarted BuildEvent event public void taskFinished BuildEvent event public void messageLogged BuildEvent event public void addJavaLibraries while hasMoreElements public String toString return getClasspath public class DifferentSelector extends MappingSelector private static final FileUtils FILE_UTILS FileUtils getFileUtils private boolean ignoreFileTimes true private boolean ignoreContents false public void setIgnoreFileTimes boolean ignoreFileTimes this ignoreFileTimes ignoreFileTimes public void setIgnoreContents boolean ignoreContents this ignoreContents ignoreContents protected boolean selectionTest File srcfile File destfile if srcfile exists destfile exists return true if srcfile length destfile length return true if ignoreFileTimes boolean sameDate sameDate destfile lastModified srcfile lastModified granularity destfile lastModified srcfile lastModified granularity if sameDate return true if ignoreContents try return FILE_UTILS contentEquals srcfile destfile catch IOException throw new BuildException srcfile destfile else return false public final class DOMUtil private DOMUtil public interface NodeFilter boolean accept Node node public static NodeList listChildNodes Node parent NodeFilter filter boolean recurse NodeListImpl matches new NodeListImpl NodeList children parent getChildNodes if children null final int len children getLength for int len Node child children item if filter accept child matches addElement child if recurse NodeList recmatches listChildNodes child filter recurse final int reclength recmatches getLength for int reclength matches addElement recmatches item return matches public static class NodeListImpl extends Vector implements NodeList public int getLength return size public Node item int try return Node elementAt catch ArrayIndexOutOfBoundsException public static String getNodeAttribute Node node String name if node instanceof Element Element element Element node return element getAttribute name return null public static Element getChildByTagName Node parent String tagname if parent null return null NodeList childList parent getChildNodes final int len childList getLength for int len Node child childList item if child null child getNodeType Node ELEMENT_NODE child getNodeName equals tagname return Element child return null Node copy null final Document doc parent getOwnerDocument switch child getNodeType case Node CDATA_SECTION_NODE copy doc createCDATASection CDATASection child getData break case Node COMMENT_NODE copy doc createComment Comment child getData break case Node DOCUMENT_FRAGMENT_NODE copy doc createDocumentFragment break case Node ELEMENT_NODE final Element elem doc createElement Element child getTagName copy elem final NamedNodeMap attributes child getAttributes if attributes null final int size attributes getLength for int size final Attr attr Attr attributes item elem setAttribute attr getName attr getValue break case Node ENTITY_REFERENCE_NODE copy doc createEntityReference child getNodeName break case Node PROCESSING_INSTRUCTION_NODE final ProcessingInstruction pi ProcessingInstruction child copy doc createProcessingInstruction pi getTarget pi getData break case Node TEXT_NODE copy doc createTextNode Text child getData break default throw new IllegalStateException child getNodeType try final NodeList children child getChildNodes if children null final int size children getLength for int size final Node newChild children item if newChild null catch DOMException ignored parent appendChild copy return copy public class DigestAlgorithm implements Algorithm private String algorithm private String provider null private MessageDigest messageDigest null private int readBufferSize public void setAlgorithm String algorithm this algorithm algorithm public void setProvider String provider this provider provider public void initMessageDigest if messageDigest null return if provider null equals provider equals provider try messageDigest MessageDigest getInstance algorithm provider catch NoSuchAlgorithmException noalgo throw new BuildException noalgo catch NoSuchProviderException noprovider throw new BuildException noprovider else try messageDigest MessageDigest getInstance algorithm catch NoSuchAlgorithmException noalgo throw new BuildException noalgo public boolean isValid return equalsIgnoreCase algorithm equalsIgnoreCase algorithm public String getValue File file initMessageDigest String checksum null try if file canRead return null FileInputStream fis null byte buf new byte readBufferSize try messageDigest reset fis new FileInputStream file DigestInputStream dis new DigestInputStream fis messageDigest while dis read buf readBufferSize dis close fis close fis null byte fileDigest messageDigest digest StringBuffer checksumSb new StringBuffer for int fileDigest length String hexStr Integer toHexString fileDigest if hexStr length checksumSb append checksumSb append hexStr checksum checksumSb toString catch Exception return null catch Exception return null return checksum public String toString StringBuffer buf new StringBuffer buf append buf append append algorithm buf append append provider buf append return buf toString public class Attrib extends ExecuteOn private static final String ATTR_READONLY private static final String ATTR_ARCHIVE private static final String ATTR_SYSTEM private static final String ATTR_HIDDEN private static final String SET private static final String UNSET private boolean haveAttr false public Attrib super setExecutable super setParallel false public void setFile File src FileSet fs new FileSet fs setFile src addFileset fs public void setReadonly boolean value addArg value ATTR_READONLY public void setArchive boolean value addArg value ATTR_ARCHIVE public void setSystem boolean value addArg value ATTR_SYSTEM public void setHidden boolean value addArg value ATTR_HIDDEN protected void checkConfiguration if haveAttr throw new BuildException getLocation super checkConfiguration public void setExecutable String throw new BuildException getTaskType getLocation public void setCommand String throw new BuildException getTaskType getLocation public void setAddsourcefile boolean throw new BuildException getTaskType getLocation public void setSkipEmptyFilesets boolean skip throw new BuildException getTaskType getLocation public void setParallel boolean parallel throw new BuildException getTaskType getLocation public void setMaxParallel int max throw new BuildException getTaskType getLocation protected boolean isValidOs return Os isFamily super isValidOs private static String getSignString boolean attr return attr SET UNSET private void addArg boolean sign String attribute createArg setValue getSignString sign attribute haveAttr true private boolean haveAttr return haveAttr public class ChangeLogWriter private static final SimpleDateFormat OUTPUT_DATE new SimpleDateFormat private static final SimpleDateFormat OUTPUT_TIME new SimpleDateFormat private static final DOMElementWriter DOM_WRITER new DOMElementWriter static TimeZone utc TimeZone getTimeZone OUTPUT_DATE setTimeZone utc OUTPUT_TIME setTimeZone utc public void printChangeLog final PrintWriter output final CVSEntry entries try output println Document doc DOMUtils newDocument Element root doc createElement DOM_WRITER openElement root output output println for int entries length final CVSEntry entry entries printEntry doc output entry DOM_WRITER closeElement root output true output flush output close catch IOException throw new org apache tools ant BuildException private void printEntry Document doc final PrintWriter output final CVSEntry entry throws IOException Element ent doc createElement DOMUtils appendTextElement ent OUTPUT_DATE format entry getDate DOMUtils appendTextElement ent OUTPUT_TIME format entry getDate DOMUtils appendCDATAElement ent entry getAuthor final Enumeration enumeration entry getFiles elements while enumeration hasMoreElements final RCSFile file RCSFile enumeration nextElement Element DOMUtils createChildElement ent DOMUtils appendCDATAElement file getName DOMUtils appendTextElement file getRevision final String previousRevision file getPreviousRevision if previousRevision null DOMUtils appendTextElement previousRevision DOMUtils appendCDATAElement ent entry getComment DOM_WRITER write ent output public class JarLibDisplayTask extends Task private File libraryFile private final Vector libraryFileSets new Vector public void setFile final File file this libraryFile file public void addFileset final FileSet fileSet libraryFileSets addElement fileSet public void execute throws BuildException validate final LibraryDisplayer displayer new LibraryDisplayer if libraryFileSets isEmpty final Iterator iterator libraryFileSets iterator while iterator hasNext final FileSet fileSet FileSet iterator next final DirectoryScanner scanner fileSet getDirectoryScanner getProject final File basedir scanner getBasedir final String files scanner getIncludedFiles for int files length final File file new File basedir files displayer displayLibrary file else displayer displayLibrary libraryFile private void validate throws BuildException if null libraryFile libraryFileSets isEmpty final String message throw new BuildException message if null libraryFile libraryFile exists final String message libraryFile throw new BuildException message if null libraryFile libraryFile isFile final String message libraryFile throw new BuildException message public class SSHExec extends SSHBase private String command null private long maxwait private Thread thread null private static final String TIMEOUT_MESSAGE public SSHExec super public void setCommand String command this command command public void setTimeout long timeout maxwait timeout public void setOutput File output outputFile output public void setAppend boolean append this append append public void setOutputproperty String property outputProperty property public void execute throws BuildException if getHost null throw new BuildException if getUserInfo getName null throw new BuildException if getUserInfo getKeyfile null getUserInfo getPassword null throw new BuildException if command null throw new BuildException ByteArrayOutputStream out new ByteArrayOutputStream TeeOutputStream tee new TeeOutputStream out new KeepAliveOutputStream System out Session session null try session openSession session setTimeout int maxwait final ChannelExec channel ChannelExec session openChannel channel setCommand command channel setOutputStream tee channel setExtOutputStream tee channel connect thread new Thread public void run while channel isEOF if thread null return try sleep catch Exception thread start thread join maxwait if thread isAlive thread null if getFailonerror throw new BuildException TIMEOUT_MESSAGE else log TIMEOUT_MESSAGE Project MSG_ERR else if outputProperty null getProject setProperty outputProperty out toString if outputFile null writeToFile out toString append outputFile int ec channel getExitStatus if ec String msg ec if getFailonerror throw new BuildException msg else log msg Project MSG_ERR catch BuildException throw catch JSchException if getMessage indexOf if getFailonerror throw new BuildException TIMEOUT_MESSAGE else log TIMEOUT_MESSAGE Project MSG_ERR else if getFailonerror throw new BuildException else log getMessage Project MSG_ERR catch Exception if getFailonerror throw new BuildException else log getMessage Project MSG_ERR finally if session null session isConnected session disconnect private void writeToFile String from boolean append File to throws IOException FileWriter out null try out new FileWriter to getAbsolutePath append StringReader in new StringReader from char buffer new char int bytesRead while true bytesRead in read buffer if bytesRead break out write buffer bytesRead out flush finally if out null out close public class TaskOutputStream extends OutputStream private Task task private StringBuffer line private int msgOutputLevel TaskOutputStream Task task int msgOutputLevel System err println System err println System err println this task task this msgOutputLevel msgOutputLevel line new StringBuffer public void write int throws IOException char cc char if cc cc if line length processLine else line append cc private void processLine String line toString task log msgOutputLevel line new StringBuffer public class Size implements ResourceSelector private long size private Comparison when Comparison EQUAL public void setSize long size public long getSize return size public void setWhen Comparison when public Comparison getWhen return when public boolean isSelected Resource long diff getSize size return when evaluate diff int diff Math abs diff public class MajoritySelector extends BaseSelectorContainer private boolean allowtie true public MajoritySelector public String toString StringBuffer buf new StringBuffer if hasSelectors buf append buf append super toString buf append return buf toString public void setAllowtie boolean tiebreaker allowtie tiebreaker public boolean isSelected File basedir String filename File file validate int yesvotes int novotes Enumeration selectorElements boolean result while hasMoreElements result FileSelector nextElement isSelected basedir filename file if result yesvotes yesvotes else novotes novotes if yesvotes novotes return true else if novotes yesvotes return false return allowtie public class IsFailure implements Condition private int code public void setCode int code public int getCode return code public boolean eval return Execute isFailure code abstract class XalanExecutor private static final String PACKAGE protected AggregateTransformer caller private void setCaller AggregateTransformer caller this caller caller protected final OutputStream getOutputStream throws IOException if AggregateTransformer FRAMES equals caller format return new ByteArrayOutputStream else return new BufferedOutputStream new FileOutputStream new File caller toDir abstract void execute throws Exception static XalanExecutor newInstance AggregateTransformer caller throws BuildException XalanExecutor executor null try Class clazz Class forName PACKAGE executor XalanExecutor clazz newInstance catch Exception xsltcApacheMissing caller task log xsltcApacheMissing toString throw new BuildException String classNameImpl executor getImplementation String version executor getProcVersion classNameImpl caller task log version Project MSG_VERBOSE executor setCaller caller return executor protected abstract String getImplementation protected abstract String getProcVersion String classNameImpl throws BuildException protected final String getXSLTCVersion String procVersionClassName throws ClassNotFoundException Class procVersion Class forName procVersionClassName Package pkg procVersion getPackage return pkg getName pkg getImplementationTitle pkg getImplementationVersion protected final String getXalanVersion String procVersionClassName throws ClassNotFoundException Class procVersion Class forName procVersionClassName String pkg procVersion getPackage getName try Field procVersion getField return pkg get null toString catch Exception return pkg public class SizeSelector extends BaseExtendSelector public static final String SIZE_KEY public static final String UNITS_KEY public static final String WHEN_KEY private long size private long multiplier private long sizelimit private Comparison when Comparison EQUAL public SizeSelector public String toString StringBuffer buf new StringBuffer buf append sizelimit buf append append when getValue buf append return buf toString public void setValue long size this size size if multiplier size sizelimit size multiplier public void setUnits ByteUnits units int units getIndex multiplier if multiplier else if multiplier else if multiplier else if multiplier else if multiplier else if multiplier else if multiplier else if multiplier if multiplier size sizelimit size multiplier public void setWhen SizeComparisons when this when when public void setParameters Parameter parameters super setParameters parameters if parameters null for int parameters length String paramname parameters getName if SIZE_KEY equalsIgnoreCase paramname try setValue new Long parameters getValue longValue catch NumberFormatException nfe setError parameters getValue else if UNITS_KEY equalsIgnoreCase paramname ByteUnits units new ByteUnits units setValue parameters getValue setUnits units else if WHEN_KEY equalsIgnoreCase paramname SizeComparisons scmp new SizeComparisons scmp setValue parameters getValue setWhen scmp else setError paramname public void verifySettings if size setError else if multiplier setError else if sizelimit setError public boolean isSelected File basedir String filename File file validate if file isDirectory return true long diff file length sizelimit return when evaluate diff int diff Math abs diff public static class ByteUnits extends EnumeratedAttribute public String getValues return new String public static class SizeComparisons extends Comparison public class Cab extends MatchingTask private File cabFile private File baseDir private Vector filesets new Vector private boolean doCompress true private boolean doVerbose false private String cmdOptions protected String archiveType private static final FileUtils FILE_UTILS FileUtils getFileUtils public void setCabfile File cabFile this cabFile cabFile public void setBasedir File baseDir this baseDir baseDir public void setCompress boolean compress doCompress compress public void setVerbose boolean verbose doVerbose verbose public void setOptions String options cmdOptions options public void addFileset FileSet set if filesets size throw new BuildException filesets addElement set protected void checkConfiguration throws BuildException if baseDir null filesets size throw new BuildException getLocation if baseDir null baseDir exists throw new BuildException getLocation if baseDir null filesets size throw new BuildException if cabFile null throw new BuildException getLocation protected ExecTask createExec throws BuildException ExecTask exec new ExecTask this return exec protected boolean isUpToDate Vector files boolean upToDate true for int files size upToDate String file files elementAt toString if FILE_UTILS resolveFile baseDir file lastModified cabFile lastModified upToDate false return upToDate protected File createListFile Vector files throws IOException File listFile FILE_UTILS createTempFile null listFile deleteOnExit PrintWriter writer new PrintWriter new FileOutputStream listFile int size files size for int size writer println files elementAt toString writer close return listFile protected void appendFiles Vector files DirectoryScanner ds String dsfiles ds getIncludedFiles for int dsfiles length files addElement dsfiles protected Vector getFileList throws BuildException Vector files new Vector if baseDir null appendFiles files super getDirectoryScanner baseDir else FileSet fs FileSet filesets elementAt baseDir fs getDir appendFiles files fs getDirectoryScanner getProject return files public void execute throws BuildException checkConfiguration Vector files getFileList if isUpToDate files return log archiveType cabFile getAbsolutePath if Os isFamily log Project MSG_VERBOSE StringBuffer sb new StringBuffer Enumeration fileEnum files elements while fileEnum hasMoreElements sb append fileEnum nextElement append sb append append cabFile getAbsolutePath append try Process Execute launch getProject new String null baseDir null baseDir getProject getBaseDir true OutputStream out getOutputStream LogOutputStream outLog new LogOutputStream this Project MSG_VERBOSE LogOutputStream errLog new LogOutputStream this Project MSG_ERR StreamPumper outPump new StreamPumper getInputStream outLog StreamPumper errPump new StreamPumper getErrorStream errLog new Thread outPump start new Thread errPump start out write sb toString getBytes out flush out close try result waitFor outPump waitFor outLog close errPump waitFor errLog close catch InterruptedException ie log ie if Execute isFailure result log result catch IOException ex String msg cabFile ex getMessage throw new BuildException msg getLocation else try File listFile createListFile files ExecTask exec createExec File outFile null exec setFailonerror true exec setDir baseDir if doVerbose outFile FILE_UTILS createTempFile null outFile deleteOnExit exec setOutput outFile exec setExecutable exec createArg setValue exec createArg setValue if doCompress exec createArg setValue exec createArg setValue if cmdOptions null exec createArg setLine cmdOptions exec createArg setValue exec createArg setFile cabFile exec createArg setValue listFile getAbsolutePath exec execute if outFile null outFile delete listFile delete catch IOException ioe String msg cabFile ioe getMessage throw new BuildException msg getLocation public interface TimeoutObserver void timeoutOccured Watchdog public class DOMElementWriter private static final String NS private boolean xmlDeclaration true private XmlNamespacePolicy namespacePolicy XmlNamespacePolicy IGNORE private HashMap nsPrefixMap new HashMap private int nextPrefix private HashMap nsURIByElement new HashMap public static class XmlNamespacePolicy private boolean qualifyElements private boolean qualifyAttributes public static final XmlNamespacePolicy IGNORE new XmlNamespacePolicy false false public static final XmlNamespacePolicy ONLY_QUALIFY_ELEMENTS new XmlNamespacePolicy true false public static final XmlNamespacePolicy QUALIFY_ALL new XmlNamespacePolicy true true public XmlNamespacePolicy boolean qualifyElements boolean qualifyAttributes this qualifyElements qualifyElements this qualifyAttributes qualifyAttributes public DOMElementWriter public DOMElementWriter boolean xmlDeclaration this xmlDeclaration XmlNamespacePolicy IGNORE public DOMElementWriter boolean xmlDeclaration XmlNamespacePolicy namespacePolicy this xmlDeclaration xmlDeclaration this namespacePolicy namespacePolicy private static String lSep System getProperty protected String knownEntities public void write Element root OutputStream out throws IOException Writer wri new OutputStreamWriter out writeXMLDeclaration wri write root wri wri flush public void writeXMLDeclaration Writer wri throws IOException if xmlDeclaration wri write public void write Element element Writer out int indent String indentWith throws IOException NodeList children element getChildNodes boolean hasChildren children getLength boolean hasChildElements false openElement element out indent indentWith hasChildren if hasChildren for int children getLength Node child children item switch child getNodeType case Node ELEMENT_NODE hasChildElements true if out write lSep write Element child out indent indentWith break case Node TEXT_NODE out write encode child getNodeValue break case Node COMMENT_NODE out write out write encode child getNodeValue out write break case Node CDATA_SECTION_NODE out write out write encodedata Text child getData out write break case Node ENTITY_REFERENCE_NODE out write out write child getNodeName out write break case Node PROCESSING_INSTRUCTION_NODE out write out write child getNodeName String data child getNodeValue if data null data length out write out write data out write break default closeElement element out indent indentWith hasChildElements public void openElement Element element Writer out int indent String indentWith throws IOException openElement element out indent indentWith true public void openElement Element element Writer out int indent String indentWith boolean hasChildren throws IOException for int indent out write indentWith out write if namespacePolicy qualifyElements String uri getNamespaceURI element String prefix String nsPrefixMap get uri if prefix null if nsPrefixMap isEmpty prefix else prefix NS nextPrefix nsPrefixMap put uri prefix addNSDefinition element uri if equals prefix out write prefix out write out write element getTagName NamedNodeMap attrs element getAttributes for int attrs getLength Attr attr Attr attrs item out write if namespacePolicy qualifyAttributes String uri getNamespaceURI attr String prefix String nsPrefixMap get uri if prefix null prefix NS nextPrefix nsPrefixMap put uri prefix addNSDefinition element uri out write prefix out write out write attr getName out write out write encode attr getValue out write ArrayList al ArrayList nsURIByElement get element if al null Iterator iter al iterator while iter hasNext String uri String iter next String prefix String nsPrefixMap get uri out write if equals prefix out write out write prefix out write out write uri out write if hasChildren out write else removeNSDefinitions element out write out write lSep out flush public void closeElement Element element Writer out int indent String indentWith boolean hasChildren throws IOException if hasChildren for int indent out write indentWith out write if namespacePolicy qualifyElements String uri getNamespaceURI element String prefix String nsPrefixMap get uri if prefix null equals prefix out write prefix out write removeNSDefinitions element out write element getTagName out write out write lSep out flush public String encode String value StringBuffer sb new StringBuffer int len value length for int len char value charAt switch case sb append break case sb append break case sb append break case sb append break case int nextSemi value indexOf if nextSemi isReference value substring nextSemi sb append else sb append break default if isLegalCharacter sb append break return sb substring public String encodedata final String value StringBuffer sb new StringBuffer int len value length for int len char value charAt if isLegalCharacter sb append String result sb substring int cdEnd result indexOf while cdEnd sb setLength cdEnd sb append append result substring cdEnd result sb substring cdEnd result indexOf return result public boolean isReference String ent if ent charAt ent endsWith return false if ent charAt if ent charAt try Integer parseInt ent substring ent length return true catch NumberFormatException nfe return false else try Integer parseInt ent substring ent length return true catch NumberFormatException nfe return false String name ent substring ent length for int knownEntities length if name equals knownEntities return true return false public boolean isLegalCharacter char if return true else if return false else if return true else if return false else if return true return false private void removeNSDefinitions Element element ArrayList al ArrayList nsURIByElement get element if al null Iterator iter al iterator while iter hasNext nsPrefixMap remove iter next nsURIByElement remove element private void addNSDefinition Element element String uri ArrayList al ArrayList nsURIByElement get element if al null al new ArrayList nsURIByElement put element al al add uri private static String getNamespaceURI Node String uri getNamespaceURI if uri null uri return uri public abstract class CompressedResource extends Resource private Resource resource public CompressedResource public CompressedResource ResourceCollection other addConfigured other public void addConfigured ResourceCollection checkChildrenAllowed if resource null throw new BuildException if size throw new BuildException resource Resource iterator next public String getName return getResource getName public void setName String name throws BuildException throw new BuildException public boolean isExists return getResource isExists public void setExists boolean exists throw new BuildException public long getLastModified return getResource getLastModified public void setLastModified long lastmodified throws BuildException throw new BuildException public boolean isDirectory return getResource isDirectory public void setDirectory boolean directory throws BuildException throw new BuildException public long getSize if isExists InputStream in null try in getInputStream byte buf new byte int size int readNow while readNow in read buf buf length size readNow return size catch IOException ex throw new BuildException getName ex finally FileUtils close in else return public void setSize long size throws BuildException throw new BuildException public int compareTo Object other if other this return if other instanceof CompressedResource return getResource compareTo CompressedResource other getResource return getResource compareTo other public int hashCode return getResource hashCode public InputStream getInputStream throws IOException InputStream in getResource getInputStream if in null in wrapStream in return in public OutputStream getOutputStream throws IOException OutputStream out getResource getOutputStream if out null out wrapStream out return out public boolean isFilesystemOnly return false public String toString return getCompressionName getResource toString public void setRefid Reference if resource null throw noChildrenAllowed super setRefid protected abstract InputStream wrapStream InputStream in throws IOException protected abstract OutputStream wrapStream OutputStream out throws IOException protected abstract String getCompressionName private Resource getResource if isReference return Resource getCheckedRef else if resource null throw new BuildException return resource public class ClassFile private static final int CLASS_MAGIC private ConstantPool constantPool private String className public void read InputStream stream throws IOException ClassFormatError DataInputStream classStream new DataInputStream stream if classStream readInt CLASS_MAGIC throw new ClassFormatError constantPool new ConstantPool constantPool read classStream constantPool resolve int thisClassIndex classStream readUnsignedShort ClassCPInfo classInfo ClassCPInfo constantPool getEntry thisClassIndex className classInfo getClassName public Vector getClassRefs Vector classRefs new Vector for int constantPool size ConstantPoolEntry entry constantPool getEntry if entry null entry getTag ConstantPoolEntry CONSTANT_CLASS ClassCPInfo classEntry ClassCPInfo entry if classEntry getClassName equals className classRefs addElement ClassFileUtils convertSlashName classEntry getClassName return classRefs public String getFullClassName return ClassFileUtils convertSlashName className public class ZipEntry extends java util zip ZipEntry implements Cloneable private static final int PLATFORM_UNIX private static final int PLATFORM_FAT private int internalAttributes private int platform PLATFORM_FAT private long externalAttributes private String name null public ZipEntry String name super name public ZipEntry java util zip ZipEntry entry throws ZipException super entry byte extra entry getExtra if extra null setExtraFields ExtraFieldUtils parse extra else setExtra public ZipEntry ZipEntry entry throws ZipException this java util zip ZipEntry entry setInternalAttributes entry getInternalAttributes setExternalAttributes entry getExternalAttributes setExtraFields entry getExtraFields protected ZipEntry super public Object clone ZipEntry ZipEntry super clone extraFields extraFields null Vector extraFields clone null setInternalAttributes getInternalAttributes setExternalAttributes getExternalAttributes setExtraFields getExtraFields return public int getInternalAttributes return internalAttributes public void setInternalAttributes int value internalAttributes value public long getExternalAttributes return externalAttributes public void setExternalAttributes long value externalAttributes value public void setUnixMode int mode setExternalAttributes mode mode isDirectory platform PLATFORM_UNIX public int getUnixMode return int getExternalAttributes public int getPlatform return platform protected void setPlatform int platform this platform platform public void setExtraFields ZipExtraField fields extraFields new Vector for int fields length extraFields addElement fields setExtra public ZipExtraField getExtraFields if extraFields null return new ZipExtraField ZipExtraField result new ZipExtraField extraFields size extraFields copyInto result return result public void addExtraField ZipExtraField ze if extraFields null extraFields new Vector ZipShort type ze getHeaderId boolean done false for int fieldsSize extraFields size done fieldsSize if ZipExtraField extraFields elementAt getHeaderId equals type extraFields setElementAt ze done true if done extraFields addElement ze setExtra public void removeExtraField ZipShort type if extraFields null extraFields new Vector boolean done false for int fieldsSize extraFields size done fieldsSize if ZipExtraField extraFields elementAt getHeaderId equals type extraFields removeElementAt done true if done throw new java util NoSuchElementException setExtra public void setExtra byte extra throws RuntimeException try setExtraFields ExtraFieldUtils parse extra catch Exception throw new RuntimeException getMessage protected void setExtra super setExtra ExtraFieldUtils mergeLocalFileDataData getExtraFields public byte getLocalFileDataExtra byte extra getExtra return extra null extra new byte public byte getCentralDirectoryExtra return ExtraFieldUtils mergeCentralDirectoryData getExtraFields public void setComprSize long size setCompressedSize size public String getName return name null super getName name public boolean isDirectory return getName endsWith protected void setName String name this name name public int hashCode return getName hashCode public boolean equals Object return this public final class AntFilterReader extends DataType implements Cloneable private String className private final Vector parameters new Vector private Path classpath public void setClassName final String className this className className public String getClassName return className public void addParam final Parameter param parameters addElement param public void setClasspath Path classpath if isReference throw tooManyAttributes if this classpath null this classpath classpath else this classpath append classpath public Path createClasspath if isReference throw noChildrenAllowed if this classpath null this classpath new Path getProject return this classpath createPath public Path getClasspath return classpath public void setClasspathRef Reference if isReference throw tooManyAttributes createClasspath setRefid public Parameter getParams Parameter params new Parameter parameters size parameters copyInto params return params public void setRefid Reference throws BuildException if parameters isEmpty className null classpath null throw tooManyAttributes Object getReferencedObject getProject if instanceof AntFilterReader AntFilterReader afr AntFilterReader setClassName afr getClassName setClasspath afr getClasspath Parameter afr getParams if null for int length addParam else String msg getRefId throw new BuildException msg super setRefid public interface DynamicAttribute void setDynamicAttribute String name String value throws BuildException public class ExtendSelector extends BaseSelector private String classname null private FileSelector dynselector null private Vector paramVec new Vector private Path classpath null public ExtendSelector public void setClassname String classname this classname classname public void selectorCreate if classname null classname length try Class null if classpath null Class forName classname else AntClassLoader al getProject createClassLoader classpath Class forName classname true al dynselector FileSelector newInstance final Project getProject if null setProjectReference dynselector catch ClassNotFoundException cnfexcept setError classname catch InstantiationException iexcept setError classname catch IllegalAccessException iaexcept setError classname else setError public void addParam Parameter paramVec addElement public final void setClasspath Path classpath if isReference throw tooManyAttributes if this classpath null this classpath classpath else this classpath append classpath public final Path createClasspath if isReference throw noChildrenAllowed if this classpath null this classpath new Path getProject return this classpath createPath public final Path getClasspath return classpath public void setClasspathref Reference if isReference throw tooManyAttributes createClasspath setRefid public void verifySettings if dynselector null selectorCreate if classname null classname length setError else if dynselector null setError else if dynselector instanceof ExtendFileSelector paramVec size setError public boolean isSelected File basedir String filename File file throws BuildException validate if paramVec size dynselector instanceof ExtendFileSelector Parameter paramArray new Parameter paramVec size paramVec copyInto paramArray ExtendFileSelector dynselector setParameters paramArray return dynselector isSelected basedir filename file public class CCMCheck extends Continuus private File file null private String comment null private String task null protected Vector filesets new Vector public CCMCheck super public File getFile return file public void setFile File log Project MSG_VERBOSE this file public String getComment return comment public void setComment String this comment public String getTask return task public void setTask String this task public void addFileset FileSet set filesets addElement set public void execute throws BuildException if file null filesets size throw new BuildException if file null file exists file isDirectory throw new BuildException if file null filesets size throw new BuildException if getFile null doit return int sizeofFileSet filesets size for int sizeofFileSet FileSet fs FileSet filesets elementAt DirectoryScanner ds fs getDirectoryScanner getProject String srcFiles ds getIncludedFiles for int srcFiles length File src new File fs getDir getProject srcFiles setFile src doit private void doit Commandline commandLine new Commandline commandLine setExecutable getCcmCommand commandLine createArgument setValue getCcmAction checkOptions commandLine int result run commandLine if Execute isFailure result String msg commandLine toString throw new BuildException msg getLocation private void checkOptions Commandline cmd if getComment null cmd createArgument setValue FLAG_COMMENT cmd createArgument setValue getComment if getTask null cmd createArgument setValue FLAG_TASK cmd createArgument setValue getTask if getFile null cmd createArgument setValue file getAbsolutePath public static final String FLAG_COMMENT public static final String FLAG_TASK public class JikesOutputParser implements ExecuteStreamHandler protected Task task protected int errors protected int warnings protected boolean error false protected boolean emacsMode protected BufferedReader br public void setProcessInputStream OutputStream os public void setProcessErrorStream InputStream is public void setProcessOutputStream InputStream is throws IOException br new BufferedReader new InputStreamReader is public void start throws IOException parseOutput br public void stop protected JikesOutputParser Task task boolean emacsMode super System err println System err println System err println this task task this emacsMode emacsMode protected void parseOutput BufferedReader reader throws IOException if emacsMode parseEmacsOutput reader else parseStandardOutput reader private void parseStandardOutput BufferedReader reader throws IOException String line String lower while line reader readLine null lower line toLowerCase if line trim equals continue if lower indexOf setError true else if lower indexOf setError false else if emacsMode setError true log line private void parseEmacsOutput BufferedReader reader throws IOException parseStandardOutput reader private void setError boolean err error err if error errorFlag true private void log String line if emacsMode task log error Project MSG_ERR Project MSG_WARN task log line error Project MSG_ERR Project MSG_WARN protected boolean getErrorFlag return errorFlag public class LoadProperties extends Task private Resource src null private final Vector filterChains new Vector private String encoding null public final void setSrcFile final File srcFile addConfigured new FileResource srcFile public void setResource String resource assertSrcIsJavaResource JavaResource src setName resource public final void setEncoding final String encoding this encoding encoding public void setClasspath Path classpath assertSrcIsJavaResource JavaResource src setClasspath classpath public Path createClasspath assertSrcIsJavaResource return JavaResource src createClasspath public void setClasspathRef Reference assertSrcIsJavaResource JavaResource src setClasspathRef public Path getClasspath assertSrcIsJavaResource return JavaResource src getClasspath public final void execute throws BuildException if src null throw new BuildException if src isExists if src instanceof JavaResource log src Project MSG_WARN return throw new BuildException src BufferedInputStream bis null Reader instream null ByteArrayInputStream tis null try bis new BufferedInputStream src getInputStream if encoding null instream new InputStreamReader bis else instream new InputStreamReader bis encoding ChainReaderHelper crh new ChainReaderHelper crh setPrimaryReader instream crh setFilterChains filterChains crh setProject getProject instream crh getAssembledReader String text crh readFully instream if text null if text endsWith text text if encoding null tis new ByteArrayInputStream text getBytes else tis new ByteArrayInputStream text getBytes encoding final Properties props new Properties props load tis Property propertyTask new Property propertyTask bindToOwner this propertyTask addProperties props catch final IOException ioe final String message ioe toString throw new BuildException message ioe getLocation finally FileUtils close bis FileUtils close tis public final void addFilterChain FilterChain filter filterChains addElement filter public void addConfigured ResourceCollection if src null throw new BuildException if size throw new BuildException src Resource iterator next private void assertSrcIsJavaResource if src null src new JavaResource src setProject getProject else if src instanceof JavaResource throw new BuildException public class Not extends ConditionBase implements Condition public boolean eval throws BuildException if countConditions throw new BuildException if countConditions throw new BuildException return Condition getConditions nextElement eval public class ReplaceRegExp extends Task private File file private String flags private boolean byline private RegularExpression regex private Substitution subs private static final FileUtils FILE_UTILS FileUtils getFileUtils private String encoding null public ReplaceRegExp super this file null this filesets new Vector this flags this byline false this regex null this subs null public void setFile File file this file file public void setMatch String match if regex null throw new BuildException regex new RegularExpression regex setPattern match public void setReplace String replace if subs null throw new BuildException subs new Substitution subs setExpression replace public void setFlags String flags this flags flags public void setByLine String byline Boolean res Boolean valueOf byline if res null res Boolean FALSE this byline res booleanValue public void setByLine boolean byline this byline byline public void setEncoding String encoding this encoding encoding public void addFileset FileSet set filesets addElement set public RegularExpression createRegexp if regex null throw new BuildException regex new RegularExpression return regex public Substitution createSubstitution if subs null throw new BuildException subs new Substitution return subs protected String doReplace RegularExpression Substitution String input int options String res input Regexp regexp getRegexp getProject if regexp matches input options log Project MSG_DEBUG res regexp substitute input getExpression getProject options return res protected void doReplace File int options throws IOException File temp FILE_UTILS createTempFile null temp deleteOnExit Reader null Writer null try if encoding null new FileReader new FileWriter temp else new InputStreamReader new FileInputStream encoding new OutputStreamWriter new FileOutputStream temp encoding BufferedReader br new BufferedReader BufferedWriter bw new BufferedWriter PrintWriter pw new PrintWriter bw boolean changes false log regex getPattern getProject subs getExpression getProject getPath byline flags length flags Project MSG_VERBOSE if byline StringBuffer linebuf new StringBuffer String line null String res null int boolean hasCR false do br read if if hasCR line linebuf toString res doReplace regex subs line options if res equals line changes true pw print res pw print linebuf new StringBuffer else hasCR true else if line linebuf toString res doReplace regex subs line options if res equals line changes true pw print res if hasCR pw print hasCR false pw print linebuf new StringBuffer if hasCR line linebuf toString res doReplace regex subs line options if res equals line changes true pw print res if hasCR pw print hasCR false linebuf new StringBuffer if linebuf append char while pw flush else String buf FileUtils readFully br if buf null buf String res doReplace regex subs buf options if res equals buf changes true pw print res pw flush close null close null if changes log Project MSG_VERBOSE try FILE_UTILS rename temp temp null catch IOException throw new BuildException temp getLocation else log Project MSG_DEBUG finally FileUtils close FileUtils close if temp null temp delete public void execute throws BuildException if regex null throw new BuildException if subs null throw new BuildException if file null filesets size throw new BuildException int options if flags indexOf options Regexp REPLACE_ALL if flags indexOf options Regexp MATCH_CASE_INSENSITIVE if flags indexOf options Regexp MATCH_MULTILINE if flags indexOf options Regexp MATCH_SINGLELINE if file null file exists try doReplace file options catch IOException log file getAbsolutePath toString Project MSG_ERR else if file null log file getAbsolutePath Project MSG_ERR int sz filesets size for int sz FileSet fs FileSet filesets elementAt DirectoryScanner ds fs getDirectoryScanner getProject String files ds getIncludedFiles for int files length File new File fs getDir getProject files if exists try doReplace options catch Exception log getAbsolutePath toString Project MSG_ERR else log getAbsolutePath Project MSG_ERR public class BuildNumber extends Task private static final String DEFAULT_PROPERTY_NAME private static final String DEFAULT_FILENAME DEFAULT_PROPERTY_NAME private static final FileUtils FILE_UTILS FileUtils getFileUtils private File myFile public void setFile final File file myFile file public void execute throws BuildException validate final Properties properties loadProperties final int buildNumber getBuildNumber properties properties put DEFAULT_PROPERTY_NAME String valueOf buildNumber FileOutputStream output null try output new FileOutputStream myFile final String header properties store output header catch final IOException ioe final String message myFile throw new BuildException message ioe finally if null output try output close catch final IOException ioe log ioe Project MSG_ERR myFile savedFile getProject setNewProperty DEFAULT_PROPERTY_NAME String valueOf buildNumber private int getBuildNumber final Properties properties throws BuildException final String buildNumber properties getProperty DEFAULT_PROPERTY_NAME trim try return Integer parseInt buildNumber catch final NumberFormatException nfe final String message myFile buildNumber throw new BuildException message nfe private Properties loadProperties throws BuildException FileInputStream input null try final Properties properties new Properties input new FileInputStream myFile properties load input return properties catch final IOException ioe throw new BuildException ioe finally if null input try input close catch final IOException ioe log ioe Project MSG_ERR private void validate throws BuildException if null myFile myFile FILE_UTILS resolveFile getProject getBaseDir DEFAULT_FILENAME if myFile exists try FILE_UTILS createNewFile myFile catch final IOException ioe final String message myFile throw new BuildException message ioe if myFile canRead final String message myFile throw new BuildException message if myFile canWrite final String message myFile throw new BuildException message public interface BuildLogger extends BuildListener void setMessageOutputLevel int level void setOutputPrintStream PrintStream output void setEmacsMode boolean emacsMode void setErrorPrintStream PrintStream err public class Reverse extends ResourceComparator private static final String ONE_NESTED private ResourceComparator nested public Reverse public Reverse ResourceComparator add public void add ResourceComparator if nested null throw new BuildException ONE_NESTED nested protected int resourceCompare Resource foo Resource bar return nested null foo compareTo bar nested compare foo bar public abstract class ArchiveResource extends Resource private static final int NULL_ARCHIVE Resource getMagicNumber getBytes private Resource archive private boolean haveEntry false private boolean modeSet false private int mode public ArchiveResource public ArchiveResource File this false public ArchiveResource File boolean withEntry setArchive haveEntry withEntry public ArchiveResource Resource boolean withEntry addConfigured haveEntry withEntry public void setArchive File checkAttributesAllowed archive new FileResource public void setMode int mode checkAttributesAllowed this mode mode modeSet true public void addConfigured ResourceCollection checkChildrenAllowed if archive null throw new BuildException if size throw new BuildException archive Resource iterator next public Resource getArchive return isReference ArchiveResource getCheckedRef getArchive archive public long getLastModified if isReference return Resource getCheckedRef getLastModified checkEntry return super getLastModified public long getSize if isReference return Resource getCheckedRef getSize checkEntry return super getSize public boolean isDirectory if isReference return Resource getCheckedRef isDirectory checkEntry return super isDirectory public boolean isExists if isReference return Resource getCheckedRef isExists checkEntry return super isExists public int getMode if isReference return ArchiveResource getCheckedRef getMode checkEntry return mode public void setRefid Reference if archive null modeSet throw tooManyAttributes super setRefid public int compareTo Object another return this equals another super compareTo another public boolean equals Object another if this another return true if isReference return getCheckedRef equals another if another getClass equals getClass return false ArchiveResource ArchiveResource another return getArchive equals getArchive getName equals getName public int hashCode return super hashCode public String toString return isReference getCheckedRef toString getArchive toString getName private synchronized void checkEntry throws BuildException if haveEntry return String name getName if name null throw new BuildException Resource getArchive if null throw new BuildException if isExists throw new BuildException toString if isDirectory throw new BuildException fetchEntry haveEntry true protected abstract void fetchEntry public class First extends BaseResourceCollectionWrapper private static final String BAD_COUNT private int count public synchronized void setCount int count public synchronized int getCount return count protected Collection getCollection int ct getCount if ct throw new BuildException BAD_COUNT Iterator iter getResourceCollection iterator ArrayList al new ArrayList ct for int ct iter hasNext al add iter next return al public abstract class Mailer protected String host null protected int port protected String user null protected String password null protected boolean SSL false protected Message message protected EmailAddress from protected Vector replyToList null protected Vector toList null protected Vector ccList null protected Vector bccList null protected Vector files null protected String subject null protected Task task protected boolean includeFileNames false protected Vector headers null public void setHost String host this host host public void setPort int port this port port public void setUser String user this user user public void setPassword String password this password password public void setSSL boolean ssl this SSL ssl public void setMessage Message this message public void setFrom EmailAddress from this from from public void setReplyToList Vector list this replyToList list public void setToList Vector list this toList list public void setCcList Vector list this ccList list public void setBccList Vector list this bccList list public void setFiles Vector files this files files public void setSubject String subject this subject subject public void setTask Task task this task task public void setIncludeFileNames boolean this includeFileNames public void setHeaders Vector this headers public abstract void send throws BuildException protected final String getDate return DateUtils getDateForHeader public class XMLResultAggregator extends Task implements XMLConstants protected Vector filesets new Vector protected String toFile protected File toDir protected Vector transformers new Vector public static final String DEFAULT_DIR public static final String DEFAULT_FILENAME protected int generatedId static final String WARNING_IS_POSSIBLY_CORRUPTED static final String WARNING_INVALID_ROOT_ELEMENT static final String WARNING_EMPTY_FILE public AggregateTransformer createReport AggregateTransformer transformer new AggregateTransformer this transformers addElement transformer return transformer public void setTofile String value toFile value public void setTodir File value toDir value public void addFileSet FileSet fs filesets addElement fs public void execute throws BuildException Element rootElement createDocument File destFile getDestinationFile try writeDOMTree rootElement getOwnerDocument destFile catch IOException throw new BuildException destFile Enumeration transformers elements while hasMoreElements AggregateTransformer transformer AggregateTransformer nextElement transformer setXmlDocument rootElement getOwnerDocument transformer transform public File getDestinationFile if toFile null toFile DEFAULT_FILENAME if toDir null toDir getProject resolveFile DEFAULT_DIR return new File toDir toFile protected File getFiles Vector new Vector final int size filesets size for int size FileSet fs FileSet filesets elementAt DirectoryScanner ds fs getDirectoryScanner getProject ds scan String ds getIncludedFiles for int length String pathname if pathname endsWith File file new File ds getBasedir pathname file getProject resolveFile file getPath addElement file File files new File size copyInto files return files protected void writeDOMTree Document doc File file throws IOException OutputStream out null PrintWriter wri null try out new BufferedOutputStream new FileOutputStream file wri new PrintWriter new OutputStreamWriter out wri write new DOMElementWriter write doc getDocumentElement wri wri flush if wri checkError throw new IOException finally FileUtils close wri FileUtils close out protected Element createDocument DocumentBuilder builder getDocumentBuilder Document doc builder newDocument Element rootElement doc createElement TESTSUITES doc appendChild rootElement generatedId File files getFiles for int files length File file files try log file Project MSG_VERBOSE if file length Document testsuiteDoc builder parse FileUtils getFileUtils toURI files getAbsolutePath Element elem testsuiteDoc getDocumentElement if TESTSUITE equals elem getNodeName addTestSuite rootElement elem generatedId else log file WARNING_INVALID_ROOT_ELEMENT Project MSG_WARN else log file WARNING_EMPTY_FILE Project MSG_WARN catch SAXException log file WARNING_IS_POSSIBLY_CORRUPTED Project MSG_WARN log StringUtils getStackTrace Project MSG_DEBUG catch IOException log file getMessage Project MSG_ERR return rootElement protected void addTestSuite Element root Element testsuite String fullclassname testsuite getAttribute ATTR_NAME int pos fullclassname lastIndexOf String pkgName pos fullclassname substring pos String classname pos fullclassname fullclassname substring pos copy setAttribute ATTR_NAME classname copy setAttribute ATTR_PACKAGE pkgName copy setAttribute ATTR_ID Integer toString generatedId private static DocumentBuilder getDocumentBuilder try return DocumentBuilderFactory newInstance newDocumentBuilder catch Exception exc throw new ExceptionInInitializerError exc public interface RegexpMatcher int MATCH_DEFAULT int MATCH_CASE_INSENSITIVE int MATCH_MULTILINE int MATCH_SINGLELINE void setPattern String pattern throws BuildException String getPattern throws BuildException boolean matches String argument throws BuildException Vector getGroups String argument throws BuildException boolean matches String input int options throws BuildException Vector getGroups String input int options throws BuildException public class OrSelector extends BaseSelectorContainer public OrSelector public String toString StringBuffer buf new StringBuffer if hasSelectors buf append buf append super toString buf append return buf toString public boolean isSelected File basedir String filename File file validate Enumeration selectorElements boolean result while hasMoreElements result FileSelector nextElement isSelected basedir filename file if result return true return false public class Service extends ProjectComponent private List providerList new ArrayList private String type public void setProvider String className Provider provider new Provider provider setClassName className providerList add provider public void addConfiguredProvider Provider provider provider check providerList add provider public String getType return type public void setType String type this type type public InputStream getAsStream throws IOException ByteArrayOutputStream arrayOut Writer writer Iterator providerIterator Provider provider arrayOut new ByteArrayOutputStream writer new OutputStreamWriter arrayOut providerIterator providerList iterator while providerIterator hasNext provider Provider providerIterator next writer write provider getClassName writer write writer close return new ByteArrayInputStream arrayOut toByteArray public void check if type null throw new BuildException getLocation if type length throw new BuildException getLocation if providerList size throw new BuildException getLocation public abstract class Pack extends Task protected File zipFile protected File source private Resource src public void setZipfile File zipFile this zipFile zipFile public void setDestfile File zipFile setZipfile zipFile public void setSrc File src setSrcResource new FileResource src public void setSrcResource Resource src if src isDirectory throw new BuildException if src instanceof FileResource source FileResource src getFile else if supportsNonFileResources throw new BuildException this src src public void addConfigured ResourceCollection if size throw new BuildException setSrcResource Resource iterator next private void validate throws BuildException if zipFile null throw new BuildException getLocation if zipFile isDirectory throw new BuildException getLocation if getSrcResource null throw new BuildException getLocation public void execute throws BuildException validate Resource getSrcResource if isExists log toString else if zipFile lastModified getLastModified log zipFile getAbsolutePath pack else log zipFile getAbsolutePath private void zipFile InputStream in OutputStream zOut throws IOException byte buffer new byte int count do zOut write buffer count count in read buffer buffer length while count protected void zipFile File file OutputStream zOut throws IOException zipResource new FileResource file zOut protected void zipResource Resource resource OutputStream zOut throws IOException InputStream rIn resource getInputStream try zipFile rIn zOut finally rIn close protected abstract void pack public Resource getSrcResource return src protected boolean supportsNonFileResources return false public class DescriptorHandler extends org xml sax HandlerBase private static final int DEFAULT_HASH_TABLE_SIZE private static final int STATE_LOOKING_EJBJAR private static final int STATE_IN_EJBJAR private static final int STATE_IN_BEANS private static final int STATE_IN_SESSION private static final int STATE_IN_ENTITY private static final int STATE_IN_MESSAGE private Task owningTask private String publicId null private static final String EJB_REF private static final String EJB_LOCAL_REF private static final String HOME_INTERFACE private static final String REMOTE_INTERFACE private static final String LOCAL_HOME_INTERFACE private static final String LOCAL_INTERFACE private static final String BEAN_CLASS private static final String PK_CLASS private static final String EJB_NAME private static final String EJB_JAR private static final String ENTERPRISE_BEANS private static final String ENTITY_BEAN private static final String SESSION_BEAN private static final String MESSAGE_BEAN private int parseState STATE_LOOKING_EJBJAR protected String currentElement null protected String currentText null protected Hashtable ejbFiles null protected String ejbName null private Hashtable fileDTDs new Hashtable private Hashtable resourceDTDs new Hashtable private boolean inEJBRef false private Hashtable urlDTDs new Hashtable private File srcDir public DescriptorHandler Task task File srcDir this owningTask task this srcDir srcDir public void registerDTD String publicId String location if location null return File fileDTD new File location if fileDTD exists fileDTD owningTask getProject resolveFile location if fileDTD exists if publicId null fileDTDs put publicId fileDTD owningTask log publicId fileDTD Project MSG_VERBOSE return if getClass getResource location null if publicId null resourceDTDs put publicId location owningTask log publicId location Project MSG_VERBOSE try if publicId null URL urldtd new URL location urlDTDs put publicId urldtd catch java net MalformedURLException public InputSource resolveEntity String publicId String systemId throws SAXException this publicId publicId File dtdFile File fileDTDs get publicId if dtdFile null try owningTask log publicId dtdFile Project MSG_VERBOSE return new InputSource new FileInputStream dtdFile catch FileNotFoundException ex String dtdResourceName String resourceDTDs get publicId if dtdResourceName null InputStream is this getClass getResourceAsStream dtdResourceName if is null owningTask log publicId dtdResourceName Project MSG_VERBOSE return new InputSource is URL dtdUrl URL urlDTDs get publicId if dtdUrl null try InputStream is dtdUrl openStream owningTask log publicId dtdUrl Project MSG_VERBOSE return new InputSource is catch IOException ioe owningTask log publicId systemId Project MSG_INFO return null public Hashtable getFiles return ejbFiles null new Hashtable ejbFiles public String getPublicId return publicId public String getEjbName return ejbName public void startDocument throws SAXException this ejbFiles new Hashtable DEFAULT_HASH_TABLE_SIZE this currentElement null inEJBRef false public void startElement String name AttributeList attrs throws SAXException this currentElement name currentText if name equals EJB_REF name equals EJB_LOCAL_REF inEJBRef true else if parseState STATE_LOOKING_EJBJAR name equals EJB_JAR parseState STATE_IN_EJBJAR else if parseState STATE_IN_EJBJAR name equals ENTERPRISE_BEANS parseState STATE_IN_BEANS else if parseState STATE_IN_BEANS name equals SESSION_BEAN parseState STATE_IN_SESSION else if parseState STATE_IN_BEANS name equals ENTITY_BEAN parseState STATE_IN_ENTITY else if parseState STATE_IN_BEANS name equals MESSAGE_BEAN parseState STATE_IN_MESSAGE public void endElement String name throws SAXException processElement currentText this currentElement if name equals EJB_REF name equals EJB_LOCAL_REF inEJBRef false else if parseState STATE_IN_ENTITY name equals ENTITY_BEAN parseState STATE_IN_BEANS else if parseState STATE_IN_SESSION name equals SESSION_BEAN parseState STATE_IN_BEANS else if parseState STATE_IN_MESSAGE name equals MESSAGE_BEAN parseState STATE_IN_BEANS else if parseState STATE_IN_BEANS name equals ENTERPRISE_BEANS parseState STATE_IN_EJBJAR else if parseState STATE_IN_EJBJAR name equals EJB_JAR parseState STATE_LOOKING_EJBJAR public void characters char ch int start int length throws SAXException currentText new String ch start length protected void processElement if inEJBRef parseState STATE_IN_ENTITY parseState STATE_IN_SESSION parseState STATE_IN_MESSAGE return if currentElement equals HOME_INTERFACE currentElement equals REMOTE_INTERFACE currentElement equals LOCAL_INTERFACE currentElement equals LOCAL_HOME_INTERFACE currentElement equals BEAN_CLASS currentElement equals PK_CLASS File classFile null String className currentText trim if className startsWith className startsWith className className replace File separatorChar className classFile new File srcDir className ejbFiles put className classFile if currentElement equals EJB_NAME if ejbName null ejbName currentText trim public class jlink private String outfile null private Vector mergefiles new Vector private Vector addfiles new Vector private boolean compression false byte buffer new byte public void setOutfile String outfile if outfile null return this outfile outfile public void addMergeFile String fileToMerge if fileToMerge null return mergefiles addElement fileToMerge public void addAddFile String fileToAdd if fileToAdd null return addfiles addElement fileToAdd public void addMergeFiles String filesToMerge if filesToMerge null return for int filesToMerge length addMergeFile filesToMerge public void addAddFiles String filesToAdd if filesToAdd null return for int filesToAdd length addAddFile filesToAdd public void setCompression boolean compress this compression compress public void link throws Exception ZipOutputStream output new ZipOutputStream new FileOutputStream outfile if compression output setMethod ZipOutputStream DEFLATED output setLevel Deflater DEFAULT_COMPRESSION else output setMethod ZipOutputStream STORED Enumeration merges mergefiles elements while merges hasMoreElements String path String merges nextElement File new File path if getName endsWith getName endsWith mergeZipJarContents output else addAddFile path Enumeration adds addfiles elements while adds hasMoreElements String name String adds nextElement File new File name if isDirectory addDirContents output getName compression else addFile output compression if output null try output close catch IOException ioe public static void main String args if args length System out println System exit jlink linker new jlink linker setOutfile args for int args length linker addMergeFile args try linker link catch Exception ex System err print ex getMessage private void mergeZipJarContents ZipOutputStream output File throws IOException if exists return ZipFile zipf new ZipFile Enumeration entries zipf entries while entries hasMoreElements ZipEntry inputEntry ZipEntry entries nextElement String inputEntryName inputEntry getName int index inputEntryName indexOf if index try output putNextEntry processEntry zipf inputEntry catch ZipException ex String mess ex getMessage if mess indexOf continue else throw ex InputStream in zipf getInputStream inputEntry int len buffer length int count while count in read buffer len output write buffer count in close output closeEntry zipf close private void addDirContents ZipOutputStream output File dir String prefix boolean compress throws IOException String contents dir list for int contents length String name contents File file new File dir name if file isDirectory addDirContents output file prefix name compress else addFile output file prefix compress private String getEntryName File file String prefix String name file getName if name endsWith InputStream input null try input new FileInputStream file String className ClassNameReader getClassName input if className null return className replace catch IOException ioe finally if input null try input close catch IOException System out println file getPath prefix prefix name return prefix name private void addFile ZipOutputStream output File file String prefix boolean compress throws IOException if file exists return ZipEntry entry new ZipEntry getEntryName file prefix entry setTime file lastModified entry setSize file length if compress entry setCrc calcChecksum file FileInputStream input new FileInputStream file addToOutputStream output input entry private void addToOutputStream ZipOutputStream output InputStream input ZipEntry ze throws IOException try output putNextEntry ze catch ZipException zipEx input close return int numBytes while numBytes input read buffer output write buffer numBytes output closeEntry input close private ZipEntry processEntry ZipFile zip ZipEntry inputEntry String name inputEntry getName if inputEntry isDirectory name endsWith try InputStream input zip getInputStream zip getEntry name String className ClassNameReader getClassName input input close if className null name className replace catch IOException ioe ZipEntry outputEntry new ZipEntry name outputEntry setTime inputEntry getTime outputEntry setExtra inputEntry getExtra outputEntry setComment inputEntry getComment outputEntry setTime inputEntry getTime if compression outputEntry setMethod ZipEntry DEFLATED else outputEntry setMethod ZipEntry STORED outputEntry setCrc inputEntry getCrc outputEntry setSize inputEntry getSize return outputEntry private long calcChecksum File throws IOException BufferedInputStream in new BufferedInputStream new FileInputStream return calcChecksum in private long calcChecksum InputStream in throws IOException CRC32 crc new CRC32 int len buffer length int count int haveRead while count in read buffer len haveRead count crc update buffer count in close return crc getValue public class SimpleP4OutputHandler extends P4HandlerAdapter P4Base parent public SimpleP4OutputHandler P4Base parent this parent parent public void process String line throws BuildException if parent util match line return if parent util match line parent util match line if parent util match line parent util match line parent setInError true else else if parent util match line parent log line parent getInError Project MSG_ERR Project MSG_INFO if parent getInError parent setErrorMessage parent getErrorMessage line StringUtils LINE_SEP public class Mapper extends DataType implements Cloneable protected MapperType type null protected String classname null protected Path classpath null protected String from null protected String to null private ContainerMapper container null public Mapper Project setProject public void setType MapperType type if isReference throw tooManyAttributes this type type public void addConfigured FileNameMapper fileNameMapper add fileNameMapper public void add FileNameMapper fileNameMapper if isReference throw noChildrenAllowed if container null if type null classname null container new CompositeMapper else FileNameMapper getImplementation if instanceof ContainerMapper container ContainerMapper else throw new BuildException String valueOf container add fileNameMapper public void addConfiguredMapper Mapper mapper add mapper getImplementation public void setClassname String classname if isReference throw tooManyAttributes this classname classname public void setClasspath Path classpath if isReference throw tooManyAttributes if this classpath null this classpath classpath else this classpath append classpath public Path createClasspath if isReference throw noChildrenAllowed if this classpath null this classpath new Path getProject return this classpath createPath public void setClasspathRef Reference ref if isReference throw tooManyAttributes createClasspath setRefid ref public void setFrom String from if isReference throw tooManyAttributes this from from public void setTo String to if isReference throw tooManyAttributes this to to public void setRefid Reference throws BuildException if type null from null to null throw tooManyAttributes super setRefid public FileNameMapper getImplementation throws BuildException if isReference return getRef getImplementation if type null classname null container null throw new BuildException if container null return container if type null classname null throw new BuildException try FileNameMapper FileNameMapper getImplementationClass newInstance final Project getProject if null setProjectReference setFrom from setTo to return catch BuildException be throw be catch Throwable throw new BuildException protected Class getImplementationClass throws ClassNotFoundException String cName this classname if type null cName type getImplementation ClassLoader loader classpath null getClass getClassLoader getProject createClassLoader classpath return Class forName cName true loader protected Mapper getRef return Mapper getCheckedRef public static class MapperType extends EnumeratedAttribute private Properties implementations public MapperType implementations new Properties implementations put implementations put implementations put implementations put implementations put public String getValues return new String public String getImplementation return implementations getProperty getValue public abstract class Task extends ProjectComponent protected Target target protected String taskName protected String taskType protected RuntimeConfigurable wrapper private boolean invalid public Task public void setOwningTarget Target target this target target public Target getOwningTarget return target public void setTaskName String name this taskName name public String getTaskName return taskName public void setTaskType String type this taskType type public void init throws BuildException public void execute throws BuildException public RuntimeConfigurable getRuntimeConfigurableWrapper if wrapper null wrapper new RuntimeConfigurable this getTaskName return wrapper public void setRuntimeConfigurableWrapper RuntimeConfigurable wrapper this wrapper wrapper public void maybeConfigure throws BuildException if invalid if wrapper null wrapper maybeConfigure getProject else getReplacement public void reconfigure if wrapper null wrapper reconfigure getProject protected void handleOutput String output log output Project MSG_INFO protected void handleFlush String output handleOutput output protected int handleInput byte buffer int offset int length throws IOException return getProject defaultInput buffer offset length protected void handleErrorOutput String output log output Project MSG_WARN protected void handleErrorFlush String output handleErrorOutput output public void log String msg log msg Project MSG_INFO public void log String msg int msgLevel if getProject null getProject log this msg msgLevel else super log msg msgLevel public void log Throwable int msgLevel if null log getMessage msgLevel public void log String msg Throwable int msgLevel if getProject null getProject log this msg msgLevel else super log msg msgLevel public final void perform if invalid getProject fireTaskStarted this Throwable reason null try maybeConfigure DispatchUtils execute this catch BuildException ex if ex getLocation Location UNKNOWN_LOCATION ex setLocation getLocation reason ex throw ex catch Exception ex reason ex BuildException be new BuildException ex be setLocation getLocation throw be catch Error ex reason ex throw ex finally getProject fireTaskFinished this reason else UnknownElement ue getReplacement Task task ue getTask task perform final void markInvalid invalid true protected final boolean isInvalid return invalid private UnknownElement replacement private UnknownElement getReplacement if replacement null replacement new UnknownElement taskType replacement setProject getProject replacement setTaskType taskType replacement setTaskName taskName replacement setLocation location replacement setOwningTarget target replacement setRuntimeConfigurableWrapper wrapper wrapper setProxy replacement replaceChildren wrapper replacement target replaceChild this replacement replacement maybeConfigure return replacement private void replaceChildren RuntimeConfigurable wrapper UnknownElement parentElement Enumeration wrapper getChildren while hasMoreElements RuntimeConfigurable childWrapper RuntimeConfigurable nextElement UnknownElement childElement new UnknownElement childWrapper getElementTag parentElement addChild childElement childElement setProject getProject childElement setRuntimeConfigurableWrapper childWrapper childWrapper setProxy childElement replaceChildren childWrapper childElement public String getTaskType return taskType protected RuntimeConfigurable getWrapper return wrapper public final void bindToOwner Task owner setProject owner getProject setOwningTarget owner getOwningTarget setTaskName owner getTaskName setDescription owner getDescription setLocation owner getLocation setTaskType owner getTaskType public class Files extends AbstractSelectorContainer implements Cloneable ResourceCollection private static final Iterator EMPTY_ITERATOR Collections EMPTY_SET iterator private PatternSet defaultPatterns new PatternSet private Vector additionalPatterns new Vector private Vector selectors new Vector private boolean useDefaultExcludes true private boolean caseSensitive true private boolean followSymlinks true private DirectoryScanner ds null public Files super protected Files Files this defaultPatterns defaultPatterns this additionalPatterns additionalPatterns this selectors selectors this useDefaultExcludes useDefaultExcludes this caseSensitive caseSensitive this followSymlinks followSymlinks this ds ds setProject getProject public void setRefid Reference throws BuildException if hasPatterns defaultPatterns throw tooManyAttributes if additionalPatterns isEmpty throw noChildrenAllowed if selectors isEmpty throw noChildrenAllowed super setRefid public synchronized PatternSet createPatternSet if isReference throw noChildrenAllowed PatternSet patterns new PatternSet additionalPatterns addElement patterns ds null return patterns public synchronized PatternSet NameEntry createInclude if isReference throw noChildrenAllowed ds null return defaultPatterns createInclude public synchronized PatternSet NameEntry createIncludesFile if isReference throw noChildrenAllowed ds null return defaultPatterns createIncludesFile public synchronized PatternSet NameEntry createExclude if isReference throw noChildrenAllowed ds null return defaultPatterns createExclude public synchronized PatternSet NameEntry createExcludesFile if isReference throw noChildrenAllowed ds null return defaultPatterns createExcludesFile public synchronized void setIncludes String includes checkAttributesAllowed defaultPatterns setIncludes includes ds null public synchronized void appendIncludes String includes checkAttributesAllowed if includes null for int includes length defaultPatterns createInclude setName includes ds null public synchronized void setExcludes String excludes checkAttributesAllowed defaultPatterns setExcludes excludes ds null public synchronized void appendExcludes String excludes checkAttributesAllowed if excludes null for int excludes length defaultPatterns createExclude setName excludes ds null public synchronized void setIncludesfile File incl throws BuildException checkAttributesAllowed defaultPatterns setIncludesfile incl ds null public synchronized void setExcludesfile File excl throws BuildException checkAttributesAllowed defaultPatterns setExcludesfile excl ds null public synchronized void setDefaultexcludes boolean useDefaultExcludes checkAttributesAllowed this useDefaultExcludes useDefaultExcludes ds null public synchronized boolean getDefaultexcludes return isReference getRef getDefaultexcludes useDefaultExcludes public synchronized void setCaseSensitive boolean caseSensitive checkAttributesAllowed this caseSensitive caseSensitive ds null public synchronized boolean isCaseSensitive return isReference getRef isCaseSensitive caseSensitive public synchronized void setFollowSymlinks boolean followSymlinks checkAttributesAllowed this followSymlinks followSymlinks ds null public synchronized boolean isFollowSymlinks return isReference getRef isFollowSymlinks followSymlinks public synchronized Iterator iterator if isReference return getRef iterator ensureDirectoryScannerSetup ds scan int fct ds getIncludedFilesCount int dct ds getIncludedDirsCount if fct dct return EMPTY_ITERATOR FileResourceIterator result new FileResourceIterator if fct result addFiles ds getIncludedFiles if dct result addFiles ds getIncludedDirectories return result public synchronized int size if isReference return getRef size ensureDirectoryScannerSetup ds scan return ds getIncludedFilesCount ds getIncludedDirsCount public synchronized boolean hasPatterns if isReference return getRef hasPatterns if hasPatterns defaultPatterns return true for Iterator additionalPatterns iterator hasNext if hasPatterns PatternSet next return true return false public synchronized void appendSelector FileSelector selector if isReference throw noChildrenAllowed super appendSelector selector ds null public String toString if isReference return getRef toString Iterator iterator if hasNext return StringBuffer sb new StringBuffer while hasNext if sb length sb append File pathSeparatorChar sb append next return sb toString public synchronized Object clone if isReference return getRef clone try Files Files super clone defaultPatterns PatternSet defaultPatterns clone additionalPatterns new Vector additionalPatterns size for Iterator iter additionalPatterns iterator iter hasNext PatternSet ps PatternSet iter next additionalPatterns add ps clone selectors new Vector selectors return catch CloneNotSupportedException throw new BuildException public String mergeIncludes Project return mergePatterns getIncludePatterns public String mergeExcludes Project return mergePatterns getExcludePatterns public synchronized PatternSet mergePatterns Project if isReference return getRef mergePatterns PatternSet ps new PatternSet ps append defaultPatterns final int count additionalPatterns size for int count Object additionalPatterns elementAt ps append PatternSet return ps public boolean isFilesystemOnly return true protected Files getRef return Files getCheckedRef private synchronized void ensureDirectoryScannerSetup if ds null ds new DirectoryScanner PatternSet ps mergePatterns getProject ds setIncludes ps getIncludePatterns getProject ds setExcludes ps getExcludePatterns getProject ds setSelectors getSelectors getProject if useDefaultExcludes ds addDefaultExcludes ds setCaseSensitive caseSensitive ds setFollowSymlinks followSymlinks private boolean hasPatterns PatternSet ps return ps getIncludePatterns getProject length ps getExcludePatterns getProject length public class HashvalueAlgorithm implements Algorithm public boolean isValid return true public String getValue File file try if file canRead return null java io FileInputStream fis new java io FileInputStream file byte content new byte fis available fis read content fis close String new String content int hash hashCode return Integer toString hash catch Exception return null public String toString return public class SourceFileScanner implements ResourceFactory protected Task task private static final FileUtils FILE_UTILS FileUtils getFileUtils public SourceFileScanner Task task this task task public String restrict String files File srcDir File destDir FileNameMapper mapper return restrict files srcDir destDir mapper FILE_UTILS getFileTimestampGranularity public String restrict String files File srcDir File destDir FileNameMapper mapper long granularity this destDir destDir Vector new Vector for int files length File src FILE_UTILS resolveFile srcDir files addElement new Resource files src exists src lastModified src isDirectory Resource sourceresources new Resource size copyInto sourceresources Resource outofdate ResourceUtils selectOutOfDateSources task sourceresources mapper this granularity String result new String outofdate length for int counter counter outofdate length counter result counter outofdate counter getName return result public File restrictAsFiles String files File srcDir File destDir FileNameMapper mapper return restrictAsFiles files srcDir destDir mapper FILE_UTILS getFileTimestampGranularity public File restrictAsFiles String files File srcDir File destDir FileNameMapper mapper long granularity String res restrict files srcDir destDir mapper granularity File result new File res length for int res length result new File srcDir res return result public Resource getResource String name return new FileResource destDir name public class Translate extends MatchingTask private static final int BUNDLE_SPECIFIED_LANGUAGE_COUNTRY_VARIANT private static final int BUNDLE_SPECIFIED_LANGUAGE_COUNTRY private static final int BUNDLE_SPECIFIED_LANGUAGE private static final int BUNDLE_NOMATCH private static final int BUNDLE_DEFAULT_LANGUAGE_COUNTRY_VARIANT private static final int BUNDLE_DEFAULT_LANGUAGE_COUNTRY private static final int BUNDLE_DEFAULT_LANGUAGE private static final int BUNDLE_MAX_ALTERNATIVES BUNDLE_DEFAULT_LANGUAGE private String bundle private String bundleLanguage private String bundleCountry private String bundleVariant private File toDir private String srcEncoding private String destEncoding private String bundleEncoding private String startToken private String endToken private boolean forceOverwrite private Vector filesets new Vector private Hashtable resourceMap new Hashtable private static final FileUtils FILE_UTILS FileUtils getFileUtils private long bundleLastModified new long BUNDLE_MAX_ALTERNATIVES private long srcLastModified private long destLastModified private boolean loaded false public void setBundle String bundle this bundle bundle public void setBundleLanguage String bundleLanguage this bundleLanguage bundleLanguage public void setBundleCountry String bundleCountry this bundleCountry bundleCountry public void setBundleVariant String bundleVariant this bundleVariant bundleVariant public void setToDir File toDir this toDir toDir public void setStartToken String startToken this startToken startToken public void setEndToken String endToken this endToken endToken public void setSrcEncoding String srcEncoding this srcEncoding srcEncoding public void setDestEncoding String destEncoding this destEncoding destEncoding public void setBundleEncoding String bundleEncoding this bundleEncoding bundleEncoding public void setForceOverwrite boolean forceOverwrite this forceOverwrite forceOverwrite public void addFileset FileSet set filesets addElement set public void execute throws BuildException if bundle null throw new BuildException getLocation if startToken null throw new BuildException getLocation if endToken null throw new BuildException getLocation if bundleLanguage null Locale Locale getDefault bundleLanguage getLanguage if bundleCountry null bundleCountry Locale getDefault getCountry if bundleVariant null Locale new Locale bundleLanguage bundleCountry bundleVariant getVariant if toDir null throw new BuildException getLocation if toDir exists toDir mkdirs else if toDir isFile throw new BuildException toDir if srcEncoding null srcEncoding System getProperty if destEncoding null destEncoding srcEncoding if bundleEncoding null bundleEncoding srcEncoding loadResourceMaps translate private void loadResourceMaps throws BuildException Locale locale new Locale bundleLanguage bundleCountry bundleVariant String language locale getLanguage length locale getLanguage String country locale getCountry length locale getCountry String variant locale getVariant length locale getVariant String bundleFile bundle language country variant processBundle bundleFile BUNDLE_SPECIFIED_LANGUAGE_COUNTRY_VARIANT false bundleFile bundle language country processBundle bundleFile BUNDLE_SPECIFIED_LANGUAGE_COUNTRY false bundleFile bundle language processBundle bundleFile BUNDLE_SPECIFIED_LANGUAGE false bundleFile bundle processBundle bundleFile BUNDLE_NOMATCH false locale Locale getDefault language locale getLanguage length locale getLanguage country locale getCountry length locale getCountry variant locale getVariant length locale getVariant bundleEncoding System getProperty bundleFile bundle language country variant processBundle bundleFile BUNDLE_DEFAULT_LANGUAGE_COUNTRY_VARIANT false bundleFile bundle language country processBundle bundleFile BUNDLE_DEFAULT_LANGUAGE_COUNTRY false bundleFile bundle language processBundle bundleFile BUNDLE_DEFAULT_LANGUAGE true private void processBundle final String bundleFile final int final boolean checkLoaded throws BuildException final File propsFile getProject resolveFile bundleFile FileInputStream ins null try ins new FileInputStream propsFile loaded true bundleLastModified propsFile lastModified log propsFile Project MSG_DEBUG loadResourceMap ins catch IOException ioe log propsFile Project MSG_DEBUG if loaded checkLoaded throw new BuildException ioe getMessage getLocation private void loadResourceMap FileInputStream ins throws BuildException try BufferedReader in null InputStreamReader isr new InputStreamReader ins bundleEncoding in new BufferedReader isr String line null while line in readLine null if line trim length line charAt line charAt int sepIndex line indexOf if sepIndex sepIndex line indexOf if sepIndex for int line length if Character isSpaceChar line charAt sepIndex break if sepIndex String key line substring sepIndex trim String value line substring sepIndex trim while value endsWith value value substring value length if line in readLine null value value line trim else break if key length if resourceMap get key null resourceMap put key value if in null in close catch IOException ioe throw new BuildException ioe getMessage getLocation private void translate throws BuildException int filesProcessed for int filesets size FileSet fs FileSet filesets elementAt DirectoryScanner ds fs getDirectoryScanner getProject String srcFiles ds getIncludedFiles for int srcFiles length try File dest FILE_UTILS resolveFile toDir srcFiles try File destDir new File dest getParent if destDir exists destDir mkdirs catch Exception log getMessage Project MSG_DEBUG destLastModified dest lastModified File src FILE_UTILS resolveFile ds getBasedir srcFiles srcLastModified src lastModified boolean needsWork forceOverwrite destLastModified srcLastModified if needsWork for int icounter icounter BUNDLE_MAX_ALTERNATIVES icounter needsWork destLastModified bundleLastModified icounter if needsWork break if needsWork log srcFiles Project MSG_DEBUG FileOutputStream fos new FileOutputStream dest BufferedWriter out new BufferedWriter new OutputStreamWriter fos destEncoding FileInputStream fis new FileInputStream src BufferedReader in new BufferedReader new InputStreamReader fis srcEncoding String line LineTokenizer lineTokenizer new LineTokenizer lineTokenizer setIncludeDelims true line lineTokenizer getToken in while line null int startIndex line indexOf startToken while startIndex startIndex startToken length line length String replace null int endIndex line indexOf endToken startIndex startToken length if endIndex startIndex else String token line substring startIndex startToken length endIndex boolean validToken true for int token length validToken char token charAt if Character isSpaceChar validToken false if validToken startIndex else if resourceMap containsKey token replace String resourceMap get token else log token Project MSG_VERBOSE replace startToken token endToken line line substring startIndex replace line substring endIndex endToken length startIndex replace length startIndex line indexOf startToken startIndex out write line line lineTokenizer getToken in if in null in close if out null out close filesProcessed else log srcFiles Project MSG_VERBOSE catch IOException ioe throw new BuildException ioe getMessage getLocation log filesProcessed Project MSG_DEBUG public class WeakishReference12 extends WeakishReference HardReference public WeakishReference12 Object reference super reference public class FilenameSelector extends BaseExtendSelector private String pattern null private boolean casesensitive true private boolean negated false public static final String NAME_KEY public static final String CASE_KEY public static final String NEGATE_KEY public FilenameSelector public String toString StringBuffer buf new StringBuffer buf append pattern buf append if negated buf append else buf append buf append if casesensitive buf append else buf append buf append return buf toString public void setName String pattern pattern pattern replace File separatorChar replace File separatorChar if pattern endsWith File separator pattern this pattern pattern public void setCasesensitive boolean casesensitive this casesensitive casesensitive public void setNegate boolean negated this negated negated public void setParameters Parameter parameters super setParameters parameters if parameters null for int parameters length String paramname parameters getName if NAME_KEY equalsIgnoreCase paramname setName parameters getValue else if CASE_KEY equalsIgnoreCase paramname setCasesensitive Project toBoolean parameters getValue else if NEGATE_KEY equalsIgnoreCase paramname setNegate Project toBoolean parameters getValue else setError paramname public void verifySettings if pattern null setError public boolean isSelected File basedir String filename File file validate return SelectorUtils matchPath pattern filename casesensitive negated public class FormatterElement private String classname private String extension private OutputStream out System out private File outFile private boolean useFile true private String ifProperty private String unlessProperty public static final String XML_FORMATTER_CLASS_NAME public static final String BRIEF_FORMATTER_CLASS_NAME public static final String PLAIN_FORMATTER_CLASS_NAME public void setType TypeAttribute type if equals type getValue setClassname XML_FORMATTER_CLASS_NAME else if equals type getValue setClassname BRIEF_FORMATTER_CLASS_NAME setClassname PLAIN_FORMATTER_CLASS_NAME public void setClassname String classname this classname classname if XML_FORMATTER_CLASS_NAME equals classname setExtension else if PLAIN_FORMATTER_CLASS_NAME equals classname setExtension else if BRIEF_FORMATTER_CLASS_NAME equals classname setExtension public String getClassname return classname public void setExtension String ext this extension ext public String getExtension return extension void setOutfile File out this outFile out public void setOutput OutputStream out this out out public void setUseFile boolean useFile this useFile useFile boolean getUseFile return useFile public void setIf String ifProperty this ifProperty ifProperty public void setUnless String unlessProperty this unlessProperty unlessProperty public boolean shouldUse Task if ifProperty null getProject getProperty ifProperty null return false else if unlessProperty null getProject getProperty unlessProperty null return false return true JUnitTaskMirror JUnitResultFormatterMirror createFormatter throws BuildException return createFormatter null JUnitTaskMirror JUnitResultFormatterMirror createFormatter ClassLoader loader throws BuildException if classname null throw new BuildException Class null try if loader null Class forName classname else Class forName classname true loader catch ClassNotFoundException throw new BuildException loader classname catch NoClassDefFoundError throw new BuildException loader classname Object null try newInstance catch InstantiationException throw new BuildException catch IllegalAccessException throw new BuildException if instanceof JUnitTaskMirror JUnitResultFormatterMirror throw new BuildException classname JUnitTaskMirror JUnitResultFormatterMirror JUnitTaskMirror JUnitResultFormatterMirror if useFile outFile null try out new BufferedOutputStream new FileOutputStream outFile catch java io IOException throw new BuildException outFile setOutput out return public static class TypeAttribute extends EnumeratedAttribute public String getValues return new String public class RegexpMatcherFactory public RegexpMatcherFactory public RegexpMatcher newRegexpMatcher throws BuildException return newRegexpMatcher null public RegexpMatcher newRegexpMatcher Project throws BuildException String systemDefault null if null systemDefault System getProperty MagicNames REGEXP_IMPL else systemDefault getProperty MagicNames REGEXP_IMPL if systemDefault null return createInstance systemDefault Throwable cause null try testAvailability return createInstance catch BuildException be cause orCause cause be JavaEnvUtils getJavaVersionNumber try testAvailability return createInstance catch BuildException be cause orCause cause be true try testAvailability return createInstance catch BuildException be cause orCause cause be true throw new BuildException cause null cause cause static Throwable orCause Throwable deflt BuildException be boolean ignoreCnfe if deflt null return deflt Throwable be getException return ignoreCnfe instanceof ClassNotFoundException null protected RegexpMatcher createInstance String className throws BuildException return RegexpMatcher ClasspathUtils newInstance className RegexpMatcherFactory class getClassLoader RegexpMatcher class protected void testAvailability String className throws BuildException try Class forName className catch Throwable throw new BuildException public class Mkdir extends Task private static final int MKDIR_RETRY_SLEEP_MILLIS private File dir public void execute throws BuildException if dir null throw new BuildException getLocation if dir isFile throw new BuildException dir getAbsolutePath if dir exists boolean result mkdirs dir if result String msg dir getAbsolutePath throw new BuildException msg getLocation log dir getAbsolutePath else log dir getAbsolutePath Project MSG_VERBOSE public void setDir File dir this dir dir private boolean mkdirs File if mkdirs try Thread sleep MKDIR_RETRY_SLEEP_MILLIS return mkdirs catch InterruptedException ex return mkdirs return true public interface BuildListener extends EventListener void buildStarted BuildEvent event void buildFinished BuildEvent event void targetStarted BuildEvent event void targetFinished BuildEvent event void taskStarted BuildEvent event void taskFinished BuildEvent event void messageLogged BuildEvent event class ConstantPool static final byte UTF8 UNUSED INTEGER FLOAT LONG DOUBLE CLASS STRING FIELDREF METHODREF INTERFACEMETHODREF NAMEANDTYPE byte types Object values ConstantPool DataInput data throws IOException super int count data readUnsignedShort types new byte count values new Object count for int count byte type data readByte types type switch type case UTF8 values data readUTF break case UNUSED break case INTEGER values new Integer data readInt break case FLOAT values new Float data readFloat break case LONG values new Long data readLong break case DOUBLE values new Double data readDouble break case CLASS case STRING values new Integer data readUnsignedShort break case FIELDREF case METHODREF case INTERFACEMETHODREF case NAMEANDTYPE values new Integer data readInt break default public class ClassNameReader extends Object public static String getClassName InputStream input throws IOException DataInputStream data new DataInputStream input int cookie data readInt if cookie return null ConstantPool constants new ConstantPool data Object values constants values int classIndex data readUnsignedShort Integer stringIndex Integer values classIndex String className String values stringIndex intValue return className public interface MSVSSConstants String SS_EXE String PROJECT_PREFIX String COMMAND_CP String COMMAND_ADD String COMMAND_GET String COMMAND_CHECKOUT String COMMAND_CHECKIN String COMMAND_LABEL String COMMAND_HISTORY String COMMAND_CREATE String STYLE_BRIEF String STYLE_CODEDIFF String STYLE_NOFILE String STYLE_DEFAULT String TIME_CURRENT String TIME_MODIFIED String TIME_UPDATED String WRITABLE_REPLACE String WRITABLE_SKIP String WRITABLE_FAIL String FLAG_LOGIN String FLAG_OVERRIDE_WORKING_DIR String FLAG_AUTORESPONSE_DEF String FLAG_AUTORESPONSE_YES String FLAG_AUTORESPONSE_NO String FLAG_RECURSION String FLAG_VERSION String FLAG_VERSION_DATE String FLAG_VERSION_LABEL String FLAG_WRITABLE String VALUE_NO String VALUE_YES String FLAG_QUIET String FLAG_COMMENT String FLAG_LABEL String VALUE_FROMDATE String VALUE_FROMLABEL String FLAG_OUTPUT String FLAG_USER String FLAG_NO_FILE String FLAG_BRIEF String FLAG_CODEDIFF String FLAG_FILETIME_DEF String FLAG_FILETIME_MODIFIED String FLAG_FILETIME_UPDATED String FLAG_REPLACE_WRITABLE String FLAG_SKIP_WRITABLE String FLAG_NO_GET public class CCMklbtype extends ClearCase private String mTypeName null private String mVOB null private String mComment null private String mCfile null private boolean mReplace false private boolean mGlobal false private boolean mOrdinary true private boolean mPbranch false private boolean mShared false public void execute throws BuildException Commandline commandLine new Commandline int result if getTypeName null throw new BuildException commandLine setExecutable getClearToolCommand commandLine createArgument setValue COMMAND_MKLBTYPE checkOptions commandLine if getFailOnErr getProject log getTypeSpecifier Project MSG_VERBOSE result run commandLine if Execute isFailure result getFailOnErr String msg commandLine toString throw new BuildException msg getLocation private void checkOptions Commandline cmd if getReplace cmd createArgument setValue FLAG_REPLACE if getOrdinary cmd createArgument setValue FLAG_ORDINARY else if getGlobal cmd createArgument setValue FLAG_GLOBAL if getPbranch cmd createArgument setValue FLAG_PBRANCH if getShared cmd createArgument setValue FLAG_SHARED if getComment null getCommentCommand cmd else if getCommentFile null getCommentFileCommand cmd else cmd createArgument setValue FLAG_NOCOMMENT cmd createArgument setValue getTypeSpecifier public void setTypeName String tn mTypeName tn public String getTypeName return mTypeName public void setVOB String vob mVOB vob public String getVOB return mVOB public void setReplace boolean repl mReplace repl public boolean getReplace return mReplace public void setGlobal boolean glob mGlobal glob public boolean getGlobal return mGlobal public void setOrdinary boolean ordinary mOrdinary ordinary public boolean getOrdinary return mOrdinary public void setPbranch boolean pbranch mPbranch pbranch public boolean getPbranch return mPbranch public void setShared boolean shared mShared shared public boolean getShared return mShared public void setComment String comment mComment comment public String getComment return mComment public void setCommentFile String cfile mCfile cfile public String getCommentFile return mCfile private void getCommentCommand Commandline cmd if getComment null cmd createArgument setValue FLAG_COMMENT cmd createArgument setValue getComment private void getCommentFileCommand Commandline cmd if getCommentFile null cmd createArgument setValue FLAG_COMMENTFILE cmd createArgument setValue getCommentFile private String getTypeSpecifier String typenm null typenm getTypeName if getVOB null typenm getVOB return typenm public static final String FLAG_REPLACE public static final String FLAG_GLOBAL public static final String FLAG_ORDINARY public static final String FLAG_PBRANCH public static final String FLAG_SHARED public static final String FLAG_COMMENT public static final String FLAG_COMMENTFILE public static final String FLAG_NOCOMMENT public class PvcsProject private String name public PvcsProject super public void setName String name PvcsProject this name name public String getName return name public final class StripJavaComments extends BaseFilterReader implements ChainableReader private int readAheadCh private boolean inString false private boolean quoted false public StripJavaComments super public StripJavaComments final Reader in super in public int read throws IOException int ch if readAheadCh ch readAheadCh readAheadCh else ch in read if ch quoted inString inString quoted false else if ch quoted quoted else quoted false if inString if ch ch in read if ch while ch ch ch ch in read else if ch while ch ch in read if ch ch in read while ch ch ch in read if ch ch read break else readAheadCh ch ch return ch public Reader chain final Reader rdr StripJavaComments newFilter new StripJavaComments rdr return newFilter public class Taskdef extends Typedef public Taskdef setAdapterClass TaskAdapter class setAdaptToClass Task class public class LineTokenizer extends ProjectComponent implements Tokenizer private String lineEnd private int pushed private boolean includeDelims false public void setIncludeDelims boolean includeDelims this includeDelims includeDelims public String getToken Reader in throws IOException int ch if pushed ch pushed pushed else ch in read if ch return null lineEnd StringBuffer line new StringBuffer int state while ch if state if ch state else if ch lineEnd break else line append char ch else state if ch lineEnd else pushed ch lineEnd break ch in read if ch state lineEnd if includeDelims line append lineEnd return line toString public String getPostToken if includeDelims return return lineEnd public final class ReplaceTokens extends BaseParamFilterReader implements ChainableReader private static final char DEFAULT_BEGIN_TOKEN private static final char DEFAULT_END_TOKEN private String queuedData null private String replaceData null private int replaceIndex private int queueIndex private Hashtable hash new Hashtable private char beginToken DEFAULT_BEGIN_TOKEN private char endToken DEFAULT_END_TOKEN public ReplaceTokens super public ReplaceTokens final Reader in super in private int getNextChar throws IOException if queueIndex final int ch queuedData charAt queueIndex if queueIndex queuedData length queueIndex return ch return in read public int read throws IOException if getInitialized initialize setInitialized true if replaceIndex final int ch replaceData charAt replaceIndex if replaceIndex replaceData length replaceIndex return ch int ch getNextChar if ch beginToken final StringBuffer key new StringBuffer do ch getNextChar if ch key append char ch else break while ch endToken if ch if queuedData null queueIndex queuedData key toString else queuedData key toString queuedData substring queueIndex queueIndex return beginToken else key setLength key length final String replaceWith String hash get key toString if replaceWith null if replaceWith length replaceData replaceWith replaceIndex return read else String newData key toString endToken if queuedData null queueIndex queuedData newData else queuedData newData queuedData substring queueIndex queueIndex return beginToken return ch public void setBeginToken final char beginToken this beginToken beginToken private char getBeginToken return beginToken public void setEndToken final char endToken this endToken endToken private char getEndToken return endToken public void addConfiguredToken final Token token hash put token getKey token getValue private Properties getPropertiesFromFile String fileName FileInputStream in null Properties props new Properties try in new FileInputStream fileName props load in catch IOException ioe ioe printStackTrace finally FileUtils close in return props private void setTokens final Hashtable hash this hash hash private Hashtable getTokens return hash public Reader chain final Reader rdr ReplaceTokens newFilter new ReplaceTokens rdr newFilter setBeginToken getBeginToken newFilter setEndToken getEndToken newFilter setTokens getTokens newFilter setInitialized true return newFilter private void initialize Parameter params getParameters if params null for int params length if params null final String type params getType if equals type final String name params getName String value params getValue if equals name if value length throw new BuildException beginToken params getValue charAt else if equals name if value length throw new BuildException endToken params getValue charAt else if equals type final String name params getName final String value params getValue hash put name value else if equals type Properties props getPropertiesFromFile params getValue for Enumeration props keys hasMoreElements String key String nextElement String value props getProperty key hash put key value public static class Token private String key private String value public final void setKey String key this key key public final void setValue String value this value value public final String getKey return key public final String getValue return value public class PathTokenizer private StringTokenizer tokenizer private String lookahead null private boolean onNetWare Os isFamily private boolean dosStyleFilesystem public PathTokenizer String path if onNetWare tokenizer new StringTokenizer path true else tokenizer new StringTokenizer path false dosStyleFilesystem File pathSeparatorChar public boolean hasMoreTokens if lookahead null return true return tokenizer hasMoreTokens public String nextToken throws NoSuchElementException String token null if lookahead null token lookahead lookahead null else token tokenizer nextToken trim if onNetWare if token length Character isLetter token charAt dosStyleFilesystem tokenizer hasMoreTokens String nextToken tokenizer nextToken trim if nextToken startsWith nextToken startsWith token nextToken else lookahead nextToken else if token equals File pathSeparator token equals token tokenizer nextToken trim if tokenizer hasMoreTokens String nextToken tokenizer nextToken trim if nextToken equals File pathSeparator if nextToken equals if token startsWith token startsWith token startsWith token startsWith String oneMore tokenizer nextToken trim if oneMore equals File pathSeparator token oneMore else token lookahead oneMore else lookahead nextToken return token public abstract class BaseParamFilterReader extends BaseFilterReader implements Parameterizable private Parameter parameters public BaseParamFilterReader super public BaseParamFilterReader final Reader in super in public final void setParameters final Parameter parameters this parameters parameters setInitialized false protected final Parameter getParameters return parameters public abstract class MappingSelector extends BaseSelector private static final FileUtils FILE_UTILS FileUtils getFileUtils protected File targetdir null protected Mapper mapperElement null protected FileNameMapper map null protected int granularity public MappingSelector granularity int FILE_UTILS getFileTimestampGranularity public void setTargetdir File targetdir this targetdir targetdir public Mapper createMapper throws BuildException if mapperElement null throw new BuildException mapperElement new Mapper getProject return mapperElement public void verifySettings if targetdir null setError if mapperElement null map new IdentityMapper else map mapperElement getImplementation if map null setError public boolean isSelected File basedir String filename File file validate String destfiles map mapFileName filename if destfiles null return false if destfiles length destfiles null throw new BuildException targetdir getName filename String destname destfiles File destfile new File targetdir destname boolean selected selectionTest file destfile return selected protected abstract boolean selectionTest File srcfile File destfile public void setGranularity int granularity this granularity granularity public class ConcatFileInputStream extends InputStream private static final int EOF private int currentIndex private boolean eof false private File file private InputStream currentStream private ProjectComponent managingPc public ConcatFileInputStream File file throws IOException this file file public void close throws IOException closeCurrent eof true public int read throws IOException int result readCurrent if result EOF eof openFile currentIndex result readCurrent return result public void setManagingTask Task task setManagingComponent task public void setManagingComponent ProjectComponent pc this managingPc pc public void log String message int loglevel if managingPc null managingPc log message loglevel else if loglevel Project MSG_WARN System out println message else System err println message private int readCurrent throws IOException return eof currentStream null EOF currentStream read private void openFile int index throws IOException closeCurrent if file null index file length log file index Project MSG_VERBOSE try currentStream new BufferedInputStream new FileInputStream file index catch IOException eyeOhEx log file index Project MSG_ERR throw eyeOhEx else eof true private void closeCurrent FileUtils close currentStream currentStream null public class And extends ResourceSelectorContainer implements ResourceSelector public And public And ResourceSelector super public boolean isSelected Resource for Iterator getSelectors hasNext if ResourceSelector next isSelected return false return true public class JJTree extends Task private static final String OUTPUT_FILE private static final String BUILD_NODE_FILES private static final String MULTI private static final String NODE_DEFAULT_VOID private static final String NODE_FACTORY private static final String NODE_SCOPE_HOOK private static final String NODE_USES_PARSER private static final String STATIC private static final String VISITOR private static final String NODE_PACKAGE private static final String VISITOR_EXCEPTION private static final String NODE_PREFIX private final Hashtable optionalAttrs new Hashtable private String outputFile null private static final String DEFAULT_SUFFIX private File outputDirectory null private File targetFile null private File javaccHome null private CommandlineJava cmdl new CommandlineJava public void setBuildnodefiles boolean buildNodeFiles optionalAttrs put BUILD_NODE_FILES buildNodeFiles Boolean TRUE Boolean FALSE public void setMulti boolean multi optionalAttrs put MULTI multi Boolean TRUE Boolean FALSE public void setNodedefaultvoid boolean nodeDefaultVoid optionalAttrs put NODE_DEFAULT_VOID nodeDefaultVoid Boolean TRUE Boolean FALSE public void setNodefactory boolean nodeFactory optionalAttrs put NODE_FACTORY nodeFactory Boolean TRUE Boolean FALSE public void setNodescopehook boolean nodeScopeHook optionalAttrs put NODE_SCOPE_HOOK nodeScopeHook Boolean TRUE Boolean FALSE public void setNodeusesparser boolean nodeUsesParser optionalAttrs put NODE_USES_PARSER nodeUsesParser Boolean TRUE Boolean FALSE public void setStatic boolean staticParser optionalAttrs put STATIC staticParser Boolean TRUE Boolean FALSE public void setVisitor boolean visitor optionalAttrs put VISITOR visitor Boolean TRUE Boolean FALSE optionalAttrs put NODE_PACKAGE nodePackage public void setVisitorException String visitorException optionalAttrs put VISITOR_EXCEPTION visitorException public void setNodeprefix String nodePrefix optionalAttrs put NODE_PREFIX nodePrefix public void setOutputdirectory File outputDirectory this outputDirectory outputDirectory public void setOutputfile String outputFile this outputFile outputFile public void setTarget File targetFile this targetFile targetFile public void setJavacchome File javaccHome this javaccHome javaccHome public JJTree cmdl setVm JavaEnvUtils getJreExecutable public void execute throws BuildException Enumeration iter optionalAttrs keys while iter hasMoreElements String name String iter nextElement Object value optionalAttrs get name cmdl createArgument setValue name value toString if targetFile null targetFile isFile throw new BuildException targetFile File javaFile null if outputDirectory null cmdl createArgument setValue getDefaultOutputDirectory javaFile new File createOutputFileName targetFile outputFile null else if outputDirectory isDirectory throw new BuildException outputDirectory cmdl createArgument setValue outputDirectory getAbsolutePath replace javaFile new File createOutputFileName targetFile outputFile outputDirectory getPath if javaFile exists targetFile lastModified javaFile lastModified log targetFile Project MSG_VERBOSE return if outputFile null cmdl createArgument setValue OUTPUT_FILE outputFile replace cmdl createArgument setValue targetFile getAbsolutePath final Path classpath cmdl createClasspath getProject final File javaccJar JavaCC getArchiveFile javaccHome classpath createPathElement setPath javaccJar getAbsolutePath classpath addJavaRuntime cmdl setClassname JavaCC getMainClass classpath JavaCC TASKDEF_TYPE_JJTREE final Commandline Argument arg cmdl createVmArgument arg setValue arg setValue javaccHome getAbsolutePath final Execute process new Execute new LogStreamHandler this Project MSG_INFO Project MSG_INFO null log cmdl describeCommand Project MSG_VERBOSE process setCommandline cmdl getCommandline try if process execute throw new BuildException catch IOException throw new BuildException private String createOutputFileName File destFile String optionalOutputFile String outputDir optionalOutputFile validateOutputFile optionalOutputFile outputDir String jjtreeFile destFile getAbsolutePath replace if optionalOutputFile null optionalOutputFile equals int filePos jjtreeFile lastIndexOf if filePos jjtreeFile jjtreeFile substring filePos int suffixPos jjtreeFile lastIndexOf if suffixPos optionalOutputFile jjtreeFile DEFAULT_SUFFIX else String currentSuffix jjtreeFile substring suffixPos if currentSuffix equals DEFAULT_SUFFIX optionalOutputFile jjtreeFile DEFAULT_SUFFIX else optionalOutputFile jjtreeFile substring suffixPos DEFAULT_SUFFIX if outputDir null outputDir equals outputDir getDefaultOutputDirectory return outputDir optionalOutputFile replace private String validateOutputFile String destFile String outputDir throws BuildException if destFile null return null if outputDir null destFile startsWith destFile startsWith String relativeOutputFile makeOutputFileRelative destFile setOutputfile relativeOutputFile return relativeOutputFile String root getRoot new File destFile getAbsolutePath if root length destFile startsWith root substring root length throw new BuildException destFile return destFile private String makeOutputFileRelative String destFile StringBuffer relativePath new StringBuffer String defaultOutputDirectory getDefaultOutputDirectory int nextPos defaultOutputDirectory indexOf int startPos nextPos while startPos startPos defaultOutputDirectory length relativePath append nextPos defaultOutputDirectory indexOf startPos if nextPos startPos nextPos else startPos nextPos relativePath append destFile return relativePath toString private String getDefaultOutputDirectory return getProject getBaseDir getAbsolutePath replace private File getRoot File file File root file getAbsoluteFile while root getParent null root root getParentFile return root public class DotnetBaseMatchingTask extends MatchingTask protected File outputFile protected Vector filesets new Vector protected File srcDir protected static final boolean isWindows Os isFamily public File getSrcDir return this srcDir public void setSrcDir File srcDirName this srcDir srcDirName public void setDestFile File file outputFile file public void addSrc FileSet src filesets add src public File getDestFile return outputFile protected int buildFileList NetCommand command Hashtable filesToBuild long outputTimestamp int filesOutOfDate boolean scanImplicitFileset getSrcDir null filesets size if scanImplicitFileset if getSrcDir null setSrcDir getProject resolveFile log getSrcDir Project MSG_VERBOSE DirectoryScanner scanner getDirectoryScanner getSrcDir filesOutOfDate command scanOneFileset scanner filesToBuild outputTimestamp for int filesets size FileSet fs FileSet filesets elementAt filesOutOfDate command scanOneFileset fs getDirectoryScanner getProject filesToBuild outputTimestamp return filesOutOfDate protected void addFilesToCommand Hashtable filesToBuild NetCommand command int count filesToBuild size log count count Project MSG_VERBOSE Enumeration files filesToBuild elements while files hasMoreElements File file File files nextElement command addArgument file toString protected long getOutputFileTimestamp long outputTimestamp if getDestFile null getDestFile exists outputTimestamp getDestFile lastModified else outputTimestamp return outputTimestamp protected void addFilesAndExecute NetCommand command boolean ignoreTimestamps long outputTimestamp getOutputFileTimestamp Hashtable filesToBuild new Hashtable int filesOutOfDate buildFileList command filesToBuild outputTimestamp if filesOutOfDate addFilesToCommand filesToBuild command command runCommand else log Project MSG_VERBOSE public final class ExpandProperties extends BaseFilterReader implements ChainableReader private String queuedData null public ExpandProperties super public ExpandProperties final Reader in super in public int read throws IOException int ch if queuedData null queuedData length queuedData null if queuedData null ch queuedData charAt queuedData queuedData substring if queuedData length queuedData null else queuedData readFully if queuedData null ch else Project project getProject queuedData project replaceProperties queuedData return read return ch public Reader chain final Reader rdr ExpandProperties newFilter new ExpandProperties rdr newFilter setProject getProject return newFilter public class PropertiesfileCache implements Cache private File cachefile null private Properties cache new Properties private boolean cacheLoaded false private boolean cacheDirty true public PropertiesfileCache public PropertiesfileCache File cachefile this cachefile cachefile public void setCachefile File file cachefile file public File getCachefile return cachefile public boolean isValid return cachefile null public void load if cachefile null cachefile isFile cachefile canRead try BufferedInputStream bis new BufferedInputStream new FileInputStream cachefile cache load bis bis close catch Exception printStackTrace cacheLoaded true cacheDirty false public void save if cacheDirty return if cachefile null cache propertyNames hasMoreElements try BufferedOutputStream bos new BufferedOutputStream new FileOutputStream cachefile cache store bos null bos flush bos close catch Exception printStackTrace cacheDirty false public void delete cache new Properties cachefile delete cacheLoaded true cacheDirty false public Object get Object key if cacheLoaded load try return cache getProperty String valueOf key catch ClassCastException return null public void put Object key Object value cache put String valueOf key String valueOf value cacheDirty true public Iterator iterator Vector new java util Vector Enumeration en cache propertyNames while en hasMoreElements add en nextElement return iterator public String toString StringBuffer buf new StringBuffer buf append buf append append cachefile buf append append cache size buf append return buf toString class RCSFile private String name private String revision private String previousRevision RCSFile final String name final String rev this name rev null RCSFile final String name final String revision final String previousRevision this name name this revision revision if revision equals previousRevision this previousRevision previousRevision String getName return name String getRevision return revision String getPreviousRevision return previousRevision public class ZipResource extends ArchiveResource private String encoding public ZipResource public ZipResource File String enc ZipEntry super true setEncoding enc setEntry public void setZipfile File setArchive public File getZipfile FileResource FileResource getArchive return getFile public void addConfigured ResourceCollection super addConfigured if isFilesystemOnly throw new BuildException public void setEncoding String enc checkAttributesAllowed encoding enc public String getEncoding return isReference ZipResource getCheckedRef getEncoding encoding public void setRefid Reference if encoding null throw tooManyAttributes super setRefid public InputStream getInputStream throws IOException if isReference return Resource getCheckedRef getInputStream final ZipFile new ZipFile getZipfile getEncoding ZipEntry ze getEntry getName if ze null close throw new BuildException getName getArchive return new FilterInputStream getInputStream ze public void close throws IOException FileUtils close in close protected void finalize throws Throwable try close finally super finalize public OutputStream getOutputStream throws IOException if isReference return Resource getCheckedRef getOutputStream throw new UnsupportedOperationException protected void fetchEntry ZipFile null try new ZipFile getZipfile getEncoding setEntry getEntry getName catch IOException log getMessage Project MSG_DEBUG throw new BuildException finally if null try close catch IOException private void setEntry ZipEntry if null setExists false return setName getName setExists true setLastModified getTime setDirectory isDirectory setSize getSize setMode getUnixMode public interface ExecuteStreamHandler void setProcessInputStream OutputStream os throws IOException void setProcessErrorStream InputStream is throws IOException void setProcessOutputStream InputStream is throws IOException void start throws IOException void stop public class NetCommand private static final FileUtils FILE_UTILS FileUtils getFileUtils protected Task owner protected Execute executable protected Commandline commandLine protected String title protected String program protected boolean traceCommandLine false protected boolean failOnError private File directory private boolean useResponseFile false private File temporaryCommandFile private int automaticResponseFileThreshold public NetCommand Task owner String title String program this owner owner this title title this program program commandLine new Commandline commandLine setExecutable program public void setTraceCommandLine boolean traceCommandLine public void setFailOnError boolean failOnError public boolean getFailFailOnError return failOnError public void setDirectory File directory this directory directory protected void logVerbose String msg owner getProject log msg Project MSG_VERBOSE protected void logError String msg owner getProject log msg Project MSG_ERR public void addArgument String argument if argument null argument length commandLine createArgument setValue argument public void addArguments String arguments if arguments null arguments length for int arguments length addArgument arguments public void addArgument String argument1 String argument2 if argument2 null argument2 length commandLine createArgument setValue argument1 argument2 public boolean isUseResponseFile return useResponseFile public void setUseResponseFile boolean useResponseFile this useResponseFile useResponseFile public int getAutomaticResponseFileThreshold return automaticResponseFileThreshold public void setAutomaticResponseFileThreshold int automaticResponseFileThreshold this automaticResponseFileThreshold automaticResponseFileThreshold protected void prepareExecutor if owner null throw new RuntimeException if owner getProject null throw new RuntimeException File dir owner getProject getBaseDir if directory null dir directory ExecuteStreamHandler handler new LogStreamHandler owner Project MSG_INFO Project MSG_WARN executable new Execute handler null executable setAntRun owner getProject executable setWorkingDirectory dir public void runCommand throws BuildException prepareExecutor int err try if traceCommandLine owner log executable getWorkingDirectory owner log commandLine describeCommand else logVerbose executable getWorkingDirectory logVerbose commandLine describeCommand setExecutableCommandLine err executable execute if Execute isFailure err if failOnError throw new BuildException title err owner getLocation else owner log title err Project MSG_ERR catch IOException throw new BuildException title owner getLocation finally if temporaryCommandFile null temporaryCommandFile delete private void setExecutableCommandLine String commands commandLine getCommandline if automaticResponseFileThreshold commands length automaticResponseFileThreshold useResponseFile true if useResponseFile commands length executable setCommandline commands else FileOutputStream fos null temporaryCommandFile FILE_UTILS createTempFile null owner log temporaryCommandFile Project MSG_VERBOSE try fos new FileOutputStream temporaryCommandFile PrintWriter out new PrintWriter new BufferedOutputStream fos for int commands length out println commands out flush out close catch IOException ex throw new BuildException temporaryCommandFile ex String newCommandLine new String newCommandLine commands newCommandLine temporaryCommandFile getAbsolutePath logVerbose Commandline describeCommand newCommandLine executable setCommandline newCommandLine public int scanOneFileset DirectoryScanner scanner Hashtable filesToBuild long outputTimestamp int filesOutOfDate String dependencies scanner getIncludedFiles File base scanner getBasedir for int dependencies length File targetFile new File base dependencies if filesToBuild get targetFile null filesToBuild put targetFile targetFile if targetFile lastModified outputTimestamp filesOutOfDate owner log targetFile toString Project MSG_VERBOSE else owner log targetFile toString Project MSG_VERBOSE return filesOutOfDate public class TimestampedLogger extends DefaultLogger private static final String SPACER protected String getBuildFailedMessage return super getBuildFailedMessage SPACER getTimestamp protected String getBuildSuccessfulMessage return super getBuildSuccessfulMessage SPACER getTimestamp protected String getTimestamp Date date new Date System currentTimeMillis DateFormat formatter DateFormat getDateTimeInstance DateFormat SHORT DateFormat SHORT String finishTime formatter format date return finishTime public class ErrorInQuitException extends IOException public ErrorInQuitException IOException super getMessage public class UpToDate extends Task implements Condition private String property private String value private File sourceFile private File targetFile private Vector sourceFileSets new Vector private Union sourceResources new Union protected Mapper mapperElement null public void setProperty final String property this property property public void setValue final String value this value value private String getValue return value null value public void setTargetFile final File file this targetFile file public void setSrcfile final File file this sourceFile file public void addSrcfiles final FileSet fs sourceFileSets addElement fs public Union createSrcResources return sourceResources public Mapper createMapper throws BuildException if mapperElement null throw new BuildException getLocation mapperElement new Mapper getProject return mapperElement public void add FileNameMapper fileNameMapper createMapper add fileNameMapper public boolean eval if sourceFileSets size sourceResources size sourceFile null throw new BuildException if sourceFileSets size sourceResources size sourceFile null throw new BuildException if targetFile null mapperElement null throw new BuildException if targetFile null targetFile exists log targetFile getAbsolutePath Project MSG_VERBOSE return false if sourceFile null sourceFile exists throw new BuildException sourceFile getAbsolutePath boolean upToDate true if sourceFile null if mapperElement null upToDate upToDate targetFile lastModified sourceFile lastModified else SourceFileScanner sfs new SourceFileScanner this upToDate upToDate sfs restrict new String sourceFile getAbsolutePath null null mapperElement getImplementation length Enumeration sourceFileSets elements while upToDate hasMoreElements FileSet fs FileSet nextElement DirectoryScanner ds fs getDirectoryScanner getProject upToDate upToDate scanDir fs getDir getProject ds getIncludedFiles if upToDate Resource sourceResources listResources upToDate upToDate ResourceUtils selectOutOfDateSources this getMapper getProject length return upToDate public void execute throws BuildException if property null throw new BuildException getLocation boolean upToDate eval if upToDate getProject setNewProperty property getValue if mapperElement null log targetFile getAbsolutePath Project MSG_VERBOSE else log Project MSG_VERBOSE protected boolean scanDir File srcDir String files SourceFileScanner sfs new SourceFileScanner this FileNameMapper mapper getMapper File dir srcDir if mapperElement null dir null return sfs restrict files srcDir dir mapper length private FileNameMapper getMapper FileNameMapper mapper null if mapperElement null MergingMapper mm new MergingMapper mm setTo targetFile getAbsolutePath mapper mm else mapper mapperElement getImplementation return mapper public class Exists extends ResourceComparator protected int resourceCompare Resource foo Resource bar boolean foo isExists if bar isExists return return public class ProxySetup private Project owner public static final String USE_SYSTEM_PROXIES public static final String HTTP_PROXY_HOST public static final String HTTP_PROXY_PORT public static final String HTTPS_PROXY_HOST public static final String HTTPS_PROXY_PORT public static final String FTP_PROXY_HOST public static final String FTP_PROXY_PORT public static final String HTTP_NON_PROXY_HOSTS public static final String HTTPS_NON_PROXY_HOSTS public static final String FTP_NON_PROXY_HOSTS public static final String HTTP_PROXY_USERNAME public static final String HTTP_PROXY_PASSWORD public static final String SOCKS_PROXY_HOST public static final String SOCKS_PROXY_PORT public static final String SOCKS_PROXY_USERNAME public static final String SOCKS_PROXY_PASSWORD public ProxySetup Project owner this owner owner public static String getSystemProxySetting try return System getProperty USE_SYSTEM_PROXIES catch SecurityException return null public void enableProxies if getSystemProxySetting null String proxies owner getProperty USE_SYSTEM_PROXIES if proxies null Project toBoolean proxies proxies String message USE_SYSTEM_PROXIES proxies try owner log message Project MSG_DEBUG System setProperty USE_SYSTEM_PROXIES proxies catch SecurityException owner log message public class ManifestTask extends Task private Manifest nestedManifest new Manifest private File manifestFile private Mode mode private String encoding public static class Mode extends EnumeratedAttribute public String getValues return new String public ManifestTask mode new Mode mode setValue public void addConfiguredSection Manifest Section section throws ManifestException nestedManifest addConfiguredSection section public void addConfiguredAttribute Manifest Attribute attribute throws ManifestException nestedManifest addConfiguredAttribute attribute public void setFile File manifestFile public void setEncoding String encoding this encoding encoding public void setMode Mode mode public void execute throws BuildException if manifestFile null throw new BuildException Manifest toWrite Manifest getDefaultManifest Manifest current null BuildException error null if manifestFile exists FileInputStream fis null InputStreamReader isr null try fis new FileInputStream manifestFile if encoding null isr new InputStreamReader fis else isr new InputStreamReader fis encoding current new Manifest isr catch ManifestException error new BuildException manifestFile getLocation catch IOException error new BuildException manifestFile getLocation finally FileUtils close isr for Enumeration nestedManifest getWarnings hasMoreElements log String nextElement Project MSG_WARN try if mode getValue equals manifestFile exists if current null toWrite merge current else if error null throw error toWrite merge nestedManifest catch ManifestException throw new BuildException getLocation if toWrite equals current log Project MSG_VERBOSE return PrintWriter null try FileOutputStream fos new FileOutputStream manifestFile OutputStreamWriter osw new OutputStreamWriter fos Manifest JAR_ENCODING new PrintWriter osw toWrite write catch IOException throw new BuildException manifestFile getLocation finally if null close public abstract class Continuus extends Task private String ccmDir private String ccmAction public String getCcmAction return ccmAction public void setCcmAction String this ccmAction public final void setCcmDir String dir ccmDir FileUtils translatePath dir protected final String getCcmCommand String toReturn ccmDir if toReturn equals toReturn endsWith toReturn toReturn CCM_EXE return toReturn protected int run Commandline cmd ExecuteStreamHandler handler try Execute exe new Execute handler exe setAntRun getProject exe setWorkingDirectory getProject getBaseDir exe setCommandline cmd getCommandline return exe execute catch java io IOException throw new BuildException getLocation protected int run Commandline cmd return run cmd new LogStreamHandler this Project MSG_VERBOSE Project MSG_WARN private static final String CCM_EXE public static final String COMMAND_CREATE_TASK public static final String COMMAND_CHECKOUT public static final String COMMAND_CHECKIN public static final String COMMAND_RECONFIGURE public static final String COMMAND_DEFAULT_TASK public interface Retryable int RETRY_FOREVER void execute throws IOException public class RenameExtensions extends MatchingTask private String fromExtension private String toExtension private boolean replace false private File srcDir private Mapper MapperType globType public RenameExtensions super globType new Mapper MapperType globType setValue public void setFromExtension String from fromExtension from public void setToExtension String to toExtension to public void setReplace boolean replace this replace replace public void setSrcDir File srcDir this srcDir srcDir public void execute throws BuildException if fromExtension null toExtension null srcDir null throw new BuildException log Project MSG_WARN log Project MSG_INFO log srcDir replace Project MSG_INFO log srcDir Project MSG_INFO log Project MSG_INFO log fromExtension Project MSG_INFO log toExtension Project MSG_INFO log Project MSG_INFO log Project MSG_INFO Move move new Move move bindToOwner this move setOwningTarget getOwningTarget move setTaskName getTaskName move setLocation getLocation move setTodir srcDir move setOverwrite replace fileset setDir srcDir move addFileset fileset Mapper me move createMapper me setType globType me setFrom fromExtension me setTo toExtension move execute public class BuildEvent extends EventObject private Project project private Target target private Task task private String message private int priority Project MSG_VERBOSE private Throwable exception public BuildEvent Project project super project this project project this target null this task null public BuildEvent Target target super target this project target getProject this target target this task null public BuildEvent Task task super task this project task getProject this target task getOwningTarget this task task public void setMessage String message int priority this message message this priority priority public void setException Throwable exception this exception exception public Project getProject return project public Target getTarget return target public Task getTask return task public String getMessage return message public int getPriority return priority public Throwable getException return exception public class CompositeMapper extends ContainerMapper public String mapFileName String sourceFileName HashSet results new HashSet FileNameMapper mapper null for Iterator mIter getMappers iterator mIter hasNext mapper FileNameMapper mIter next if mapper null String mapped mapper mapFileName sourceFileName if mapped null results addAll Arrays asList mapped return results size null String results toArray new String results size public class FileResource extends Resource implements Touchable private static final FileUtils FILE_UTILS FileUtils getFileUtils private static final int NULL_FILE Resource getMagicNumber getBytes private File file private File baseDir public FileResource public FileResource File String name setFile FILE_UTILS resolveFile name setBaseDir public FileResource File setFile public FileResource Project String this resolveFile setProject public void setFile File checkAttributesAllowed file public File getFile return isReference FileResource getCheckedRef getFile file public void setBaseDir File checkAttributesAllowed baseDir public File getBaseDir return isReference FileResource getCheckedRef getBaseDir baseDir public void setRefid Reference if file null baseDir null throw tooManyAttributes super setRefid public String getName if isReference return Resource getCheckedRef getName File getBaseDir return null getNotNullFile getName FILE_UTILS removeLeadingPath getNotNullFile public boolean isExists return isReference Resource getCheckedRef isExists getNotNullFile exists public long getLastModified return isReference Resource getCheckedRef getLastModified getNotNullFile lastModified public boolean isDirectory return isReference Resource getCheckedRef isDirectory getNotNullFile isDirectory public long getSize return isReference Resource getCheckedRef getSize getNotNullFile length public InputStream getInputStream throws IOException return isReference Resource getCheckedRef getInputStream new FileInputStream getNotNullFile public OutputStream getOutputStream throws IOException if isReference return Resource getCheckedRef getOutputStream File getNotNullFile if exists if isFile delete else File getParentFile if null exists mkdirs return new FileOutputStream public int compareTo Object another if isReference return Comparable getCheckedRef compareTo another if this equals another return if another getClass equals getClass FileResource otherfr FileResource another File getFile if null return File of otherfr getFile if of null return return compareTo of return super compareTo another public boolean equals Object another if this another return true if isReference return getCheckedRef equals another if another getClass equals getClass return false FileResource otherfr FileResource another return getFile null otherfr getFile null getFile equals otherfr getFile public int hashCode if isReference return getCheckedRef hashCode return MAGIC getFile null NULL_FILE getFile hashCode public String toString if isReference return getCheckedRef toString if file null return String absolutePath file getAbsolutePath return FILE_UTILS normalize absolutePath getAbsolutePath public boolean isFilesystemOnly return isReference FileResource getCheckedRef isFilesystemOnly public void touch long modTime if isReference FileResource getCheckedRef touch modTime return getNotNullFile setLastModified modTime protected File getNotNullFile if getFile null throw new BuildException return getFile public abstract class ScriptRunnerBase private boolean keepEngine false private String language private String script private Project project private ClassLoader scriptLoader private Map beans new HashMap public void addBeans Map dictionary for Iterator dictionary keySet iterator hasNext String key String next try Object val dictionary get key addBean key val catch BuildException ex public void addBean String key Object bean boolean isValid key length Character isJavaIdentifierStart key charAt for int isValid key length isValid Character isJavaIdentifierPart key charAt if isValid beans put key bean protected Map getBeans return beans public abstract void executeScript String execName public abstract Object evaluateScript String execName public abstract boolean supportsLanguage public abstract String getManagerName public void setLanguage String language this language language public String getLanguage return language public void setScriptClassLoader ClassLoader classLoader this scriptLoader classLoader protected ClassLoader getScriptClassLoader return scriptLoader public void setKeepEngine boolean keepEngine this keepEngine keepEngine public boolean getKeepEngine return keepEngine public void setSrc File file if file exists throw new BuildException file getPath BufferedReader in null try in new BufferedReader new FileReader file script FileUtils readFully in catch IOException ex throw new BuildException ex finally FileUtils close in public void addText String text this script text public String getScript return script public void clearScript this script public void setProject Project project this project project public Project getProject return project public void bindToComponent ProjectComponent component project component getProject addBeans project getProperties addBeans project getUserProperties addBeans project getTargets addBeans project getReferences addBean project addBean component public void bindToComponentMinimum ProjectComponent component project component getProject addBean project addBean component protected void checkLanguage if language null throw new BuildException protected ClassLoader replaceContextLoader ClassLoader origContextClassLoader Thread currentThread getContextClassLoader if getScriptClassLoader null setScriptClassLoader getClass getClassLoader Thread currentThread setContextClassLoader getScriptClassLoader return origContextClassLoader protected void restoreContextLoader ClassLoader origLoader Thread currentThread setContextClassLoader origLoader class RedirectingStreamHandler extends PumpStreamHandler RedirectingStreamHandler final ChangeLogParser parser super new RedirectingOutputStream parser new ByteArrayOutputStream String getErrors try final ByteArrayOutputStream error ByteArrayOutputStream getErr return error toString catch final Exception return null public void stop super stop try getErr close getOut close catch final IOException throw new BuildException public class Launcher public static final String ANTHOME_PROPERTY public static final String ANTLIBDIR_PROPERTY public static final String ANT_PRIVATEDIR public static final String ANT_PRIVATELIB public static final String USER_LIBDIR ANT_PRIVATEDIR File separatorChar ANT_PRIVATELIB public static final String MAIN_CLASS public static final String USER_HOMEDIR private static final String JAVA_CLASS_PATH protected static final int EXIT_CODE_ERROR public static void main String args int exitCode try Launcher launcher new Launcher exitCode launcher run args catch LaunchException exitCode EXIT_CODE_ERROR System err println getMessage catch Throwable exitCode EXIT_CODE_ERROR printStackTrace System err if exitCode System exit exitCode private void addPath String path boolean getJars List libPathURLs throws MalformedURLException StringTokenizer tokenizer new StringTokenizer path File pathSeparator while tokenizer hasMoreElements String elementName tokenizer nextToken File element new File elementName if elementName indexOf element exists continue if getJars element isDirectory URL dirURLs Locator getLocationURLs element for int dirURLs length libPathURLs add dirURLs libPathURLs add Locator fileToURL element private int run String args throws LaunchException MalformedURLException String antHomeProperty System getProperty ANTHOME_PROPERTY File antHome null File sourceJar Locator getClassSource getClass File jarDir sourceJar getParentFile String mainClassname MAIN_CLASS if antHomeProperty null antHome new File antHomeProperty if antHome null antHome exists antHome jarDir getParentFile System setProperty ANTHOME_PROPERTY antHome getAbsolutePath if antHome exists throw new LaunchException List libPaths new ArrayList String cpString null List argList new ArrayList String newArgs boolean noUserLib false boolean noClassPath false for int args length if args equals if args length throw new LaunchException libPaths add args else if args equals if args length throw new LaunchException if cpString null throw new LaunchException cpString args else if args equals args equals noUserLib true else if args equals args equals noClassPath true else if args equals if args length throw new LaunchException mainClassname args else argList add args if argList size args length newArgs args else newArgs String argList toArray new String argList size URL libURLs getLibPathURLs noClassPath null cpString libPaths URL systemURLs getSystemURLs jarDir URL userURLs noUserLib new URL getUserURLs URL jars getJarArray libURLs userURLs systemURLs Locator getToolsJar StringBuffer baseClassPath new StringBuffer System getProperty JAVA_CLASS_PATH if baseClassPath charAt baseClassPath length File pathSeparatorChar baseClassPath setLength baseClassPath length for int jars length baseClassPath append File pathSeparatorChar baseClassPath append Locator fromURI jars toString System setProperty JAVA_CLASS_PATH baseClassPath toString URLClassLoader loader new URLClassLoader jars Thread currentThread setContextClassLoader loader Class mainClass null int exitCode try mainClass loader loadClass mainClassname AntMain main AntMain mainClass newInstance main startAnt newArgs null null catch InstantiationException ex System err println mainClassname File mainJar Locator getClassSource mainClass System err println mainJar exitCode EXIT_CODE_ERROR catch Throwable printStackTrace System err exitCode EXIT_CODE_ERROR return exitCode private URL getLibPathURLs String cpString List libPaths throws MalformedURLException List libPathURLs new ArrayList if cpString null addPath cpString false libPathURLs for Iterator libPaths iterator hasNext String libPath String next addPath libPath true libPathURLs return URL libPathURLs toArray new URL libPathURLs size private URL getSystemURLs File antLauncherDir throws MalformedURLException File antLibDir null String antLibDirProperty System getProperty ANTLIBDIR_PROPERTY if antLibDirProperty null antLibDir new File antLibDirProperty if antLibDir null antLibDir exists antLibDir antLauncherDir System setProperty ANTLIBDIR_PROPERTY antLibDir getAbsolutePath return Locator getLocationURLs antLibDir private URL getUserURLs throws MalformedURLException File userLibDir new File System getProperty USER_HOMEDIR USER_LIBDIR return Locator getLocationURLs userLibDir private URL getJarArray URL libJars URL userJars URL systemJars File toolsJar throws MalformedURLException int numJars libJars length userJars length systemJars length if toolsJar null numJars URL jars new URL numJars System arraycopy libJars jars libJars length System arraycopy userJars jars libJars length userJars length System arraycopy systemJars jars userJars length libJars length systemJars length if toolsJar null jars jars length Locator fileToURL toolsJar return jars public class IsTrue extends ProjectComponent implements Condition private Boolean value null public void setValue boolean value this value value Boolean TRUE Boolean FALSE public boolean eval throws BuildException if value null throw new BuildException return value booleanValue public class Zip extends MatchingTask protected File zipFile private ZipScanner zs private File baseDir protected Hashtable entries new Hashtable private Vector groupfilesets new Vector private Vector filesetsFromGroupfilesets new Vector protected String duplicate private boolean doCompress true private boolean doUpdate false private boolean savedDoUpdate false private boolean doFilesonly false protected String archiveType private static final long EMPTY_CRC new CRC32 getValue protected String emptyBehavior private Vector resources new Vector protected Hashtable addedDirs new Hashtable private Vector addedFiles new Vector protected boolean doubleFilePass false protected boolean skipWriting false private static final FileUtils FILE_UTILS FileUtils getFileUtils private boolean addingNewFiles false private String encoding private boolean keepCompression false private boolean roundUp true private String comment private int level ZipOutputStream DEFAULT_COMPRESSION public void setZipfile File zipFile setDestFile zipFile public void setFile File file setDestFile file public void setDestFile File destFile this zipFile destFile public File getDestFile return zipFile public void setBasedir File baseDir this baseDir baseDir public void setCompress boolean doCompress public boolean isCompress return doCompress public void setFilesonly boolean doFilesonly public void setUpdate boolean doUpdate savedDoUpdate public boolean isInUpdateMode return doUpdate public void addFileset FileSet set add set public void addZipfileset ZipFileSet set add set public void add ResourceCollection resources add public void addZipGroupFileset FileSet set groupfilesets addElement set public void setDuplicate Duplicate df duplicate df getValue public static class WhenEmpty extends EnumeratedAttribute public String getValues return new String public void setWhenempty WhenEmpty we emptyBehavior we getValue public void setEncoding String encoding this encoding encoding public String getEncoding return encoding public void setKeepCompression boolean keep keepCompression keep public void setComment String comment this comment comment public String getComment return comment public void setLevel int level this level level public int getLevel return level public void setRoundUp boolean roundUp public void execute throws BuildException if doubleFilePass skipWriting true executeMain skipWriting false executeMain else executeMain public void executeMain throws BuildException if baseDir null resources size groupfilesets size equals archiveType throw new BuildException if zipFile null throw new BuildException archiveType if zipFile exists zipFile isFile throw new BuildException zipFile if zipFile exists zipFile canWrite throw new BuildException zipFile File renamedFile null addingNewFiles true if doUpdate zipFile exists doUpdate false log archiveType Project MSG_DEBUG for int groupfilesets size log Project MSG_VERBOSE FileSet fs FileSet groupfilesets elementAt FileScanner scanner fs getDirectoryScanner getProject String files scanner getIncludedFiles File basedir scanner getBasedir for int files length log files Project MSG_VERBOSE ZipFileSet zf new ZipFileSet zf setProject getProject zf setSrc new File basedir files add zf filesetsFromGroupfilesets addElement zf Vector vfss new Vector if baseDir null FileSet fs FileSet getImplicitFileSet clone fs setDir baseDir vfss addElement fs for int resources size ResourceCollection rc ResourceCollection resources elementAt vfss addElement rc ResourceCollection fss new ResourceCollection vfss size vfss copyInto fss boolean success false try ArchiveState state getResourcesToAdd fss zipFile false if state isOutOfDate return if zipFile exists state isWithoutAnyResources createEmptyZip zipFile return Resource addThem state getResourcesToAdd if doUpdate renamedFile FILE_UTILS createTempFile zipFile getParentFile renamedFile deleteOnExit try FILE_UTILS rename zipFile renamedFile catch SecurityException throw new BuildException zipFile getAbsolutePath catch IOException throw new BuildException zipFile getAbsolutePath String action doUpdate log action archiveType zipFile getAbsolutePath ZipOutputStream zOut null try if skipWriting zOut new ZipOutputStream zipFile zOut setEncoding encoding zOut setMethod doCompress ZipOutputStream DEFLATED ZipOutputStream STORED zOut setLevel level initZipOutputStream zOut for int fss length if addThem length addResources fss addThem zOut if doUpdate addingNewFiles false ZipFileSet oldFiles new ZipFileSet oldFiles setProject getProject oldFiles setSrc renamedFile oldFiles setDefaultexcludes false for int addedFiles size PatternSet NameEntry ne oldFiles createExclude ne setName String addedFiles elementAt DirectoryScanner ds oldFiles getDirectoryScanner getProject ZipScanner ds setEncoding encoding String ds getIncludedFiles Resource new Resource length for int length ds getResource if doFilesonly String ds getIncludedDirectories Resource dr new Resource length for int length dr ds getResource Resource tmp new Resource tmp length dr length System arraycopy dr dr length System arraycopy tmp dr length tmp length addResources oldFiles zOut if zOut null zOut setComment comment finalizeZipOutputStream zOut if doUpdate if renamedFile delete log renamedFile getName Project MSG_WARN success true finally try if zOut null zOut close catch IOException ex if success throw ex catch IOException ioe String msg archiveType ioe getMessage if doUpdate renamedFile null zipFile delete msg if doUpdate renamedFile null try FILE_UTILS rename renamedFile zipFile catch IOException msg renamedFile getName throw new BuildException msg ioe getLocation finally cleanUp protected final boolean isAddingNewFiles return addingNewFiles protected final void addResources FileSet fileset Resource resources ZipOutputStream zOut throws IOException String prefix String fullpath int dirMode ArchiveFileSet DEFAULT_DIR_MODE int fileMode ArchiveFileSet DEFAULT_FILE_MODE ArchiveFileSet zfs null if fileset instanceof ArchiveFileSet zfs ArchiveFileSet fileset prefix zfs getPrefix getProject fullpath zfs getFullpath getProject dirMode zfs getDirMode getProject fileMode zfs getFileMode getProject if prefix length fullpath length throw new BuildException if resources length fullpath length throw new BuildException if prefix length if prefix endsWith prefix endsWith prefix addParentDirs null prefix zOut dirMode ZipFile zf null try boolean dealingWithFiles false File base null if zfs null zfs getSrc getProject null dealingWithFiles true base fileset getDir getProject else if zfs instanceof ZipFileSet zf new ZipFile zfs getSrc getProject encoding for int resources length String name null if fullpath length name fullpath else name resources getName name name replace File separatorChar if equals name continue if resources isDirectory name endsWith name name if doFilesonly dealingWithFiles resources isDirectory zfs hasDirModeBeenSet int nextToLastSlash name lastIndexOf name length if nextToLastSlash addParentDirs base name substring nextToLastSlash zOut prefix dirMode if zf null ZipEntry ze zf getEntry resources getName addParentDirs base name zOut prefix ze getUnixMode else ArchiveResource tr ArchiveResource resources addParentDirs base name zOut prefix tr getMode else addParentDirs base name zOut prefix dirMode if resources isDirectory dealingWithFiles File FILE_UTILS resolveFile base resources getName zipFile zOut prefix name fileMode else if resources isDirectory if zf null ZipEntry ze zf getEntry resources getName if ze null boolean oldCompress doCompress if keepCompression doCompress ze getMethod ZipEntry DEFLATED try zipFile zf getInputStream ze zOut prefix name ze getTime zfs getSrc getProject zfs hasFileModeBeenSet fileMode ze getUnixMode finally doCompress oldCompress else ArchiveResource tr ArchiveResource resources InputStream is null try is tr getInputStream zipFile is zOut prefix name resources getLastModified zfs getSrc getProject zfs hasFileModeBeenSet fileMode tr getMode finally FileUtils close is finally if zf null zf close protected final void addResources ResourceCollection rc Resource resources ZipOutputStream zOut throws IOException if rc instanceof FileSet addResources FileSet rc resources zOut return for int resources length String name resources getName replace File separatorChar if equals name continue if resources isDirectory doFilesonly continue File base null if resources instanceof FileResource base FileResource resources getBaseDir if resources isDirectory if name endsWith name name addParentDirs base name zOut ArchiveFileSet DEFAULT_DIR_MODE if resources isDirectory if resources instanceof FileResource File FileResource resources getFile zipFile zOut name ArchiveFileSet DEFAULT_FILE_MODE else InputStream is null try is resources getInputStream zipFile is zOut name resources getLastModified null ArchiveFileSet DEFAULT_FILE_MODE finally FileUtils close is protected void initZipOutputStream ZipOutputStream zOut throws IOException BuildException protected void finalizeZipOutputStream ZipOutputStream zOut throws IOException BuildException protected boolean createEmptyZip File zipFile throws BuildException log archiveType zipFile Project MSG_INFO OutputStream os null try os new FileOutputStream zipFile byte empty new byte empty empty os write empty catch IOException ioe throw new BuildException ioe getMessage ioe getLocation finally if os null try os close catch IOException return true private synchronized ZipScanner getZipScanner if zs null zs new ZipScanner zs setEncoding encoding zs setSrc zipFile return zs protected ArchiveState getResourcesToAdd ResourceCollection rcs File zipFile boolean needsUpdate throws BuildException ArrayList filesets new ArrayList ArrayList rest new ArrayList for int rcs length if rcs instanceof FileSet filesets add rcs else rest add rcs ResourceCollection rc ResourceCollection rest toArray new ResourceCollection rest size ArchiveState as getNonFileSetResourcesToAdd rc zipFile needsUpdate FileSet fs FileSet filesets toArray new FileSet filesets size ArchiveState as2 getResourcesToAdd fs zipFile as isOutOfDate if as isOutOfDate as2 isOutOfDate as getNonFileSetResourcesToAdd rc zipFile true Resource toAdd new Resource rcs length int fsIndex int restIndex for int rcs length if rcs instanceof FileSet toAdd as2 getResourcesToAdd fsIndex else toAdd as getResourcesToAdd restIndex return new ArchiveState as2 isOutOfDate toAdd protected ArchiveState getResourcesToAdd FileSet filesets File zipFile boolean needsUpdate throws BuildException Resource initialResources grabResources filesets if isEmpty initialResources if needsUpdate doUpdate return new ArchiveState true initialResources if emptyBehavior equals if doUpdate log archiveType zipFile Project MSG_VERBOSE else log archiveType zipFile Project MSG_WARN else if emptyBehavior equals throw new BuildException archiveType zipFile getLocation else if zipFile exists needsUpdate true return new ArchiveState needsUpdate initialResources if zipFile exists return new ArchiveState true initialResources if needsUpdate doUpdate return new ArchiveState true initialResources Resource newerResources new Resource filesets length for int filesets length if fileset instanceof ZipFileSet ZipFileSet fileset getSrc getProject null File base filesets getDir getProject for int initialResources length File resourceAsFile FILE_UTILS resolveFile base initialResources getName if resourceAsFile equals zipFile throw new BuildException getLocation for int filesets length if initialResources length newerResources new Resource continue FileNameMapper myMapper new IdentityMapper if filesets instanceof ZipFileSet ZipFileSet zfs ZipFileSet filesets if zfs getFullpath getProject null zfs getFullpath getProject equals MergingMapper fm new MergingMapper fm setTo zfs getFullpath getProject myMapper fm else if zfs getPrefix getProject null zfs getPrefix getProject equals GlobPatternMapper gm new GlobPatternMapper gm setFrom String prefix zfs getPrefix getProject if prefix endsWith prefix endsWith prefix gm setTo prefix myMapper gm Resource resources initialResources if doFilesonly resources selectFileResources resources newerResources ResourceUtils selectOutOfDateSources this resources myMapper getZipScanner needsUpdate needsUpdate newerResources length if needsUpdate doUpdate break if needsUpdate doUpdate return new ArchiveState true initialResources return new ArchiveState needsUpdate newerResources protected ArchiveState getNonFileSetResourcesToAdd ResourceCollection rcs File zipFile boolean needsUpdate throws BuildException Resource initialResources grabNonFileSetResources rcs if isEmpty initialResources return new ArchiveState needsUpdate initialResources if zipFile exists return new ArchiveState true initialResources if needsUpdate doUpdate return new ArchiveState true initialResources Resource newerResources new Resource rcs length for int rcs length if initialResources length newerResources new Resource continue for int initialResources length if initialResources instanceof FileResource zipFile equals FileResource initialResources getFile throw new BuildException getLocation Resource rs initialResources if doFilesonly rs selectFileResources rs newerResources ResourceUtils selectOutOfDateSources this rs new IdentityMapper getZipScanner needsUpdate needsUpdate newerResources length if needsUpdate doUpdate break if needsUpdate doUpdate return new ArchiveState true initialResources return new ArchiveState needsUpdate newerResources protected Resource grabResources FileSet filesets Resource result new Resource filesets length for int filesets length boolean skipEmptyNames true if filesets instanceof ZipFileSet ZipFileSet zfs ZipFileSet filesets skipEmptyNames zfs getPrefix getProject equals zfs getFullpath getProject equals DirectoryScanner rs filesets getDirectoryScanner getProject if rs instanceof ZipScanner ZipScanner rs setEncoding encoding Vector resources new Vector if doFilesonly String directories rs getIncludedDirectories for int directories length if equals directories skipEmptyNames resources addElement rs getResource directories String files rs getIncludedFiles for int files length if equals files skipEmptyNames resources addElement rs getResource files result new Resource resources size resources copyInto result return result protected Resource grabNonFileSetResources ResourceCollection rcs Resource result new Resource rcs length for int rcs length Iterator iter rcs iterator ArrayList rs new ArrayList int lastDir while iter hasNext Resource Resource iter next if isExists if isDirectory rs add lastDir else rs add result Resource rs toArray new Resource rs size return result protected void zipDir File dir ZipOutputStream zOut String vPath int mode throws IOException zipDir dir zOut vPath mode null protected void zipDir File dir ZipOutputStream zOut String vPath int mode ZipExtraField extra throws IOException if doFilesonly log vPath Project MSG_VERBOSE return if addedDirs get vPath null return log vPath Project MSG_VERBOSE addedDirs put vPath vPath if skipWriting ZipEntry ze new ZipEntry vPath if dir null dir exists ze setTime dir lastModified roundUp else ze setTime System currentTimeMillis roundUp ze setSize ze setMethod ZipEntry STORED ze setCrc EMPTY_CRC ze setUnixMode mode if extra null ze setExtraFields extra zOut putNextEntry ze protected void zipFile InputStream in ZipOutputStream zOut String vPath long lastModified File fromArchive int mode throws IOException if entries contains vPath if duplicate equals log vPath Project MSG_INFO return else if duplicate equals throw new BuildException vPath else log vPath Project MSG_VERBOSE else log vPath Project MSG_VERBOSE entries put vPath vPath if skipWriting ZipEntry ze new ZipEntry vPath ze setTime lastModified ze setMethod doCompress ZipEntry DEFLATED ZipEntry STORED if zOut isSeekable doCompress long size CRC32 cal new CRC32 if in markSupported ByteArrayOutputStream bos new ByteArrayOutputStream byte buffer new byte int count do size count cal update buffer count bos write buffer count count in read buffer buffer length while count in new ByteArrayInputStream bos toByteArray else in mark Integer MAX_VALUE byte buffer new byte int count do size count cal update buffer count count in read buffer buffer length while count in reset ze setSize size ze setCrc cal getValue ze setUnixMode mode zOut putNextEntry ze byte buffer new byte int count do if count zOut write buffer count count in read buffer buffer length while count addedFiles addElement vPath protected void zipFile File file ZipOutputStream zOut String vPath int mode throws IOException if file equals zipFile throw new BuildException getLocation FileInputStream fIn new FileInputStream file try zipFile fIn zOut vPath file lastModified roundUp null mode finally fIn close protected final void addParentDirs File baseDir String entry ZipOutputStream zOut String prefix int dirMode throws IOException if doFilesonly Stack directories new Stack int slashPos entry length while slashPos entry lastIndexOf slashPos String dir entry substring slashPos if addedDirs get prefix dir null break directories push dir while directories isEmpty String dir String directories pop File null if baseDir null new File baseDir dir else new File dir zipDir zOut prefix dir dirMode protected void cleanUp addedDirs clear addedFiles removeAllElements entries clear addingNewFiles false doUpdate savedDoUpdate Enumeration filesetsFromGroupfilesets elements while hasMoreElements ZipFileSet zf ZipFileSet nextElement resources removeElement zf filesetsFromGroupfilesets removeAllElements public void reset resources removeAllElements zipFile null baseDir null groupfilesets removeAllElements duplicate archiveType doCompress true emptyBehavior doUpdate false doFilesonly false encoding null protected static final boolean isEmpty Resource for int length if length return false return true protected Resource selectFileResources Resource orig if orig length return orig Vector new Vector orig length for int orig length if orig isDirectory addElement orig else log orig getName Project MSG_VERBOSE if size orig length Resource new Resource size copyInto return return orig public static class Duplicate extends EnumeratedAttribute public String getValues return new String public static class ArchiveState private boolean outOfDate private Resource resourcesToAdd ArchiveState boolean state Resource outOfDate state resourcesToAdd public boolean isOutOfDate return outOfDate public Resource getResourcesToAdd return resourcesToAdd public boolean isWithoutAnyResources if resourcesToAdd null return true for int counter counter resourcesToAdd length counter if resourcesToAdd counter null if resourcesToAdd counter length return false return true public abstract class AbstractAccessTask extends org apache tools ant taskdefs ExecuteOn public AbstractAccessTask super setParallel true super setSkipEmptyFilesets true public void setFile File src FileSet fs new FileSet fs setFile src addFileset fs public void setCommand Commandline cmdl throw new BuildException getTaskType getLocation public void setSkipEmptyFilesets boolean skip throw new BuildException getTaskType getLocation public void setAddsourcefile boolean throw new BuildException getTaskType getLocation protected boolean isValidOs return Os isFamily super isValidOs public class ExtensionSet extends DataType private final ArrayList extensions new ArrayList private final ArrayList extensionsFilesets new ArrayList public void addExtension final ExtensionAdapter extensionAdapter extensions add extensionAdapter public void addLibfileset final LibFileSet fileSet extensionsFilesets add fileSet public void addFileset final FileSet fileSet extensionsFilesets add fileSet public Extension toExtensions final Project proj throws BuildException final ArrayList extensionsList ExtensionUtil toExtensions extensions ExtensionUtil extractExtensions proj extensionsList extensionsFilesets return Extension extensionsList toArray new Extension extensionsList size public void setRefid final Reference reference throws BuildException if extensions isEmpty extensionsFilesets isEmpty throw tooManyAttributes final Object object reference getReferencedObject getProject if object instanceof ExtensionSet final ExtensionSet other ExtensionSet object extensions addAll other extensions extensionsFilesets addAll other extensionsFilesets else final String message reference getRefId throw new BuildException message super setRefid reference public String toString return Arrays asList toExtensions getProject public class Or extends ResourceSelectorContainer implements ResourceSelector public Or public Or ResourceSelector super public boolean isSelected Resource for Iterator getSelectors hasNext if ResourceSelector next isSelected return true return false public interface BZip2Constants int baseBlockSize int MAX_ALPHA_SIZE int MAX_CODE_LEN int RUNA int RUNB int N_GROUPS int G_SIZE int N_ITERS int MAX_SELECTORS G_SIZE int NUM_OVERSHOOT_BYTES int rNums public class GlobPatternMapper implements FileNameMapper protected String fromPrefix null protected String fromPostfix null protected int prefixLength protected int postfixLength protected String toPrefix null protected String toPostfix null private boolean handleDirSep false private boolean caseSensitive true public void setHandleDirSep boolean handleDirSep this handleDirSep handleDirSep public void setCaseSensitive boolean caseSensitive this caseSensitive caseSensitive public void setFrom String from int index from lastIndexOf if index fromPrefix from fromPostfix else fromPrefix from substring index fromPostfix from substring index prefixLength fromPrefix length postfixLength fromPostfix length public void setTo String to int index to lastIndexOf if index toPrefix to toPostfix else toPrefix to substring index toPostfix to substring index public String mapFileName String sourceFileName if fromPrefix null modifyName sourceFileName startsWith modifyName fromPrefix modifyName sourceFileName endsWith modifyName fromPostfix return null return new String toPrefix extractVariablePart sourceFileName toPostfix protected String extractVariablePart String name return name substring prefixLength name length postfixLength private String modifyName String name if caseSensitive name name toLowerCase if handleDirSep if name indexOf name name replace return name public class War extends Jar private File deploymentDescriptor private boolean needxmlfile true private File addedWebXmlFile private static final FileUtils FILE_UTILS FileUtils getFileUtils private static final String XML_DESCRIPTOR_PATH private static final String XML_DESCRIPTOR_PATH_LC XML_DESCRIPTOR_PATH toLowerCase Locale ENGLISH public War super archiveType emptyBehavior public void setWarfile File warFile setDestFile warFile public void setWebxml File descr deploymentDescriptor descr if deploymentDescriptor exists throw new BuildException deploymentDescriptor ZipFileSet fs new ZipFileSet fs setFile deploymentDescriptor fs setFullpath XML_DESCRIPTOR_PATH super addFileset fs public void setNeedxmlfile boolean needxmlfile this needxmlfile needxmlfile public void addLib ZipFileSet fs fs setPrefix super addFileset fs public void addClasses ZipFileSet fs fs setPrefix super addFileset fs public void addWebinf ZipFileSet fs fs setPrefix super addFileset fs protected void initZipOutputStream ZipOutputStream zOut throws IOException BuildException super initZipOutputStream zOut protected void zipFile File file ZipOutputStream zOut String vPath int mode throws IOException String vPathLowerCase vPath toLowerCase Locale ENGLISH boolean addFile true if XML_DESCRIPTOR_PATH_LC equals vPathLowerCase if addedWebXmlFile null addFile false if FILE_UTILS fileNameEquals addedWebXmlFile file log archiveType XML_DESCRIPTOR_PATH file addedWebXmlFile Project MSG_WARN else addedWebXmlFile file addFile true deploymentDescriptor file if addFile super zipFile file zOut vPath mode protected void cleanUp if addedWebXmlFile null deploymentDescriptor null needxmlfile isInUpdateMode throw new BuildException addedWebXmlFile null super cleanUp public class MSVSSADD extends MSVSS private String localPath null protected Commandline buildCmdLine Commandline commandLine new Commandline if getLocalpath null String msg throw new BuildException msg getLocation commandLine setExecutable getSSCommand commandLine createArgument setValue COMMAND_ADD commandLine createArgument setValue getLocalpath commandLine createArgument setValue getAutoresponse commandLine createArgument setValue getRecursive commandLine createArgument setValue getWritable commandLine createArgument setValue getLogin commandLine createArgument setValue getComment return commandLine protected String getLocalpath return localPath public void setRecursive boolean recursive super setInternalRecursive recursive public final void setWritable boolean writable super setInternalWritable writable public void setAutoresponse String response super setInternalAutoResponse response public void setComment String comment super setInternalComment comment public void setLocalpath Path localPath this localPath localPath toString public class Permissions private List grantedPermissions new LinkedList private List revokedPermissions new LinkedList private java security Permissions granted null private SecurityManager origSm null private boolean active false private boolean delegateToOldSM public Permissions this false public Permissions boolean delegateToOldSM this delegateToOldSM delegateToOldSM public void addConfiguredGrant Permissions Permission perm grantedPermissions add perm public void addConfiguredRevoke Permissions Permission perm revokedPermissions add perm public synchronized void setSecurityManager throws BuildException origSm System getSecurityManager init System setSecurityManager new MySM active true private void init throws BuildException granted new java security Permissions for Iterator revokedPermissions listIterator hasNext Permissions Permission Permissions Permission next if getClassName null throw new BuildException for Iterator grantedPermissions listIterator hasNext Permissions Permission Permissions Permission next if getClassName null throw new BuildException else java security Permission perm new UnresolvedPermission getClassName getName getActions null granted add perm granted add new java net SocketPermission granted add new java util PropertyPermission granted add new java util PropertyPermission granted add new java util PropertyPermission granted add new java util PropertyPermission granted add new java util PropertyPermission granted add new java util PropertyPermission granted add new java util PropertyPermission granted add new java util PropertyPermission granted add new java util PropertyPermission granted add new java util PropertyPermission granted add new java util PropertyPermission granted add new java util PropertyPermission granted add new java util PropertyPermission granted add new java util PropertyPermission granted add new java util PropertyPermission granted add new java util PropertyPermission granted add new java util PropertyPermission granted add new java util PropertyPermission granted add new java util PropertyPermission granted add new java util PropertyPermission public synchronized void restoreSecurityManager active false System setSecurityManager origSm private class MySM extends SecurityManager public void checkExit int status java security Permission perm new java lang RuntimePermission null try checkPermission perm catch SecurityException throw new ExitException getMessage status public void checkPermission java security Permission perm if active if delegateToOldSM perm getName equals boolean permOK false if granted implies perm permOK true checkRevoked perm if permOK origSm null origSm checkPermission perm else if granted implies perm throw new SecurityException perm checkRevoked perm private void checkRevoked java security Permission perm for Iterator revokedPermissions listIterator hasNext if Permissions Permission next matches perm throw new SecurityException perm public static class Permission private String className private String name private String actionString private Set actions public void setClass String aClass className aClass trim public String getClassName return className public void setName String aName name aName trim public String getName return name public void setActions String actions actionString actions if actions length this actions parseActions actions public String getActions return actionString boolean matches java security Permission perm if className equals perm getClass getName return false if name null if name endsWith if perm getName startsWith name substring name length return false else if name equals perm getName return false if actions null Set as parseActions perm getActions int size as size as removeAll actions if as size size return false return true private Set parseActions String actions Set result new HashSet StringTokenizer tk new StringTokenizer actions while tk hasMoreTokens String item tk nextToken trim if item equals result add item return result public String toString return className name actions public class HasFreeSpace implements Condition private String partition private String needed public boolean eval throws BuildException validate try if JavaEnvUtils isAtLeastJavaVersion File fs new File partition ReflectWrapper new ReflectWrapper fs long free Long invoke longValue return free StringUtils parseHumanSizes needed else throw new BuildException catch Exception throw new BuildException private void validate throws BuildException if null partition throw new BuildException if null needed throw new BuildException public String getPartition return partition public void setPartition String partition this partition partition public String getNeeded return needed public void setNeeded String needed this needed needed class UUMailer extends PlainMailer protected void attach File file PrintStream out throws IOException if file exists file canRead throw new BuildException file getName FileInputStream finstr new FileInputStream file try BufferedInputStream in new BufferedInputStream finstr UUEncoder encoder new UUEncoder file getName encoder encode in out finally finstr close public interface ResourceSelector boolean isSelected Resource public class ResourceUtils private static final class Outdated implements ResourceSelector private Resource control private long granularity private Outdated Resource control long granularity this control control this granularity granularity public boolean isSelected Resource return SelectorUtils isOutOfDate control granularity private static final FileUtils FILE_UTILS FileUtils getFileUtils private static final ResourceSelector NOT_EXISTS new Not new Exists public static Resource selectOutOfDateSources ProjectComponent logTo Resource source FileNameMapper mapper ResourceFactory targets return selectOutOfDateSources logTo source mapper targets FILE_UTILS getFileTimestampGranularity public static Resource selectOutOfDateSources ProjectComponent logTo Resource source FileNameMapper mapper ResourceFactory targets long granularity Union new Union addAll Arrays asList source ResourceCollection rc selectOutOfDateSources logTo mapper targets granularity return rc size new Resource Union rc listResources public static ResourceCollection selectOutOfDateSources ProjectComponent logTo ResourceCollection source FileNameMapper mapper ResourceFactory targets long granularity if source size logTo log Project MSG_VERBOSE return Resources NONE source Union getInstance source logFuture logTo source granularity Union result new Union for Iterator iter source iterator iter hasNext Resource sr Resource iter next String srName sr getName srName srName null srName srName replace File separatorChar String targetnames null try targetnames mapper mapFileName srName catch Exception logTo log sr Project MSG_VERBOSE if targetnames null targetnames length logTo log sr Project MSG_VERBOSE continue Union targetColl new Union for int targetnames length targetColl add targets getResource targetnames replace File separatorChar Restrict new Restrict add new And new ResourceSelector Type FILE new Or new ResourceSelector NOT_EXISTS new Outdated sr granularity add targetColl if size result add sr Resource Resource iterator next logTo log sr getName getName isExists Project MSG_VERBOSE continue logTo log sr getName targetColl toString targetColl size Project MSG_VERBOSE return result public static void copyResource Resource source Resource dest throws IOException copyResource source dest null public static void copyResource Resource source Resource dest Project project throws IOException copyResource source dest null null false false null null project public static void copyResource Resource source Resource dest FilterSetCollection filters Vector filterChains boolean overwrite boolean preserveLastModified String inputEncoding String outputEncoding Project project throws IOException if overwrite long slm source getLastModified if dest isExists slm dest getLastModified slm return final boolean filterSetsAvailable filters null filters hasFilters final boolean filterChainsAvailable filterChains null filterChains size if filterSetsAvailable BufferedReader in null BufferedWriter out null try InputStreamReader isr null if inputEncoding null isr new InputStreamReader source getInputStream else isr new InputStreamReader source getInputStream inputEncoding in new BufferedReader isr OutputStreamWriter osw null if outputEncoding null osw new OutputStreamWriter dest getOutputStream else osw new OutputStreamWriter dest getOutputStream outputEncoding out new BufferedWriter osw if filterChainsAvailable ChainReaderHelper crh new ChainReaderHelper crh setBufferSize FileUtils BUF_SIZE crh setPrimaryReader in crh setFilterChains filterChains crh setProject project Reader rdr crh getAssembledReader in new BufferedReader rdr LineTokenizer lineTokenizer new LineTokenizer lineTokenizer setIncludeDelims true String newline null String line lineTokenizer getToken in while line null if line length out newLine else newline filters replaceTokens line out write newline line lineTokenizer getToken in finally FileUtils close out FileUtils close in else if filterChainsAvailable inputEncoding null inputEncoding equals outputEncoding inputEncoding null outputEncoding null BufferedReader in null BufferedWriter out null try InputStreamReader isr null if inputEncoding null isr new InputStreamReader source getInputStream else isr new InputStreamReader source getInputStream inputEncoding in new BufferedReader isr OutputStreamWriter osw null if outputEncoding null osw new OutputStreamWriter dest getOutputStream else osw new OutputStreamWriter dest getOutputStream outputEncoding out new BufferedWriter osw if filterChainsAvailable ChainReaderHelper crh new ChainReaderHelper crh setBufferSize FileUtils BUF_SIZE crh setPrimaryReader in crh setFilterChains filterChains crh setProject project Reader rdr crh getAssembledReader in new BufferedReader rdr char buffer new char FileUtils BUF_SIZE while true int nRead in read buffer buffer length if nRead break out write buffer nRead finally FileUtils close out FileUtils close in else InputStream in null OutputStream out null try in source getInputStream out dest getOutputStream byte buffer new byte FileUtils BUF_SIZE int count do out write buffer count count in read buffer buffer length while count finally FileUtils close out FileUtils close in if preserveLastModified dest instanceof Touchable setLastModified Touchable dest source getLastModified public static void setLastModified Touchable long time touch time System currentTimeMillis time public static boolean contentEquals Resource r1 Resource r2 boolean text throws IOException if r1 isExists r2 isExists return false if r1 isExists return true if r1 isDirectory r2 isDirectory return false if r1 equals r2 return true if text r1 getSize r2 getSize return false return compareContent r1 r2 text public static int compareContent Resource r1 Resource r2 boolean text throws IOException if r1 equals r2 return boolean e1 r1 isExists boolean e2 r2 isExists if e1 e2 return if e1 e2 return e1 boolean d1 r1 isDirectory boolean d2 r2 isDirectory if d1 d2 return if d1 d2 return d1 return text textCompare r1 r2 binaryCompare r1 r2 private static int binaryCompare Resource r1 Resource r2 throws IOException InputStream in1 null InputStream in2 null try in1 new BufferedInputStream r1 getInputStream in2 new BufferedInputStream r2 getInputStream for int b1 in1 read b1 b1 in1 read int b2 in2 read if b1 b2 return b1 b2 return in2 read finally FileUtils close in1 FileUtils close in2 private static int textCompare Resource r1 Resource r2 throws IOException BufferedReader in1 null BufferedReader in2 null try in1 new BufferedReader new InputStreamReader r1 getInputStream in2 new BufferedReader new InputStreamReader r2 getInputStream String expected in1 readLine while expected null String actual in2 readLine if expected equals actual return expected compareTo actual expected in1 readLine return in2 readLine null finally FileUtils close in1 FileUtils close in2 private static void logFuture ProjectComponent logTo ResourceCollection rc long granularity long now System currentTimeMillis granularity Date sel new Date sel setMillis now sel setWhen TimeComparison AFTER Restrict future new Restrict future add sel future add rc for Iterator iter future iterator iter hasNext logTo log Resource iter next getName Project MSG_WARN public class AntTypeDefinition private String name private Class clazz private Class adapterClass private Class adaptToClass private String className private ClassLoader classLoader public void setName String name this name name public String getName return name public void setClass Class clazz this clazz clazz if clazz null return this classLoader classLoader null clazz getClassLoader classLoader this className className null clazz getName className public void setClassName String className this className className public String getClassName return className public void setAdapterClass Class adapterClass this adapterClass adapterClass public void setAdaptToClass Class adaptToClass this adaptToClass adaptToClass public void setClassLoader ClassLoader classLoader this classLoader classLoader public ClassLoader getClassLoader return classLoader public Class getExposedClass Project project if adaptToClass null Class getTypeClass project if null adaptToClass isAssignableFrom return return adapterClass null getTypeClass project adapterClass public Class getTypeClass Project project try return innerGetTypeClass catch NoClassDefFoundError ncdfe project log ncdfe getMessage name Project MSG_DEBUG catch ClassNotFoundException cnfe project log className name Project MSG_DEBUG return null public Class innerGetTypeClass throws ClassNotFoundException if clazz null return clazz if classLoader null clazz Class forName className else clazz classLoader loadClass className return clazz public Object create Project project return icreate project private Object icreate Project project Class getTypeClass project if null return null Object createAndSet project if null adapterClass null return if adaptToClass null if adaptToClass isAssignableFrom getClass return TypeAdapter adapterObject TypeAdapter createAndSet project adapterClass if adapterObject null return null adapterObject setProxy return adapterObject public void checkClass Project project if clazz null clazz getTypeClass project if clazz null throw new BuildException getName if adapterClass null adaptToClass null adaptToClass isAssignableFrom clazz TypeAdapter adapter TypeAdapter createAndSet project adapterClass if adapter null throw new BuildException adapter checkProxyClass clazz private Object createAndSet Project project Class try Object innerCreateAndSet project return catch InvocationTargetException ex Throwable ex getTargetException throw new BuildException name catch NoClassDefFoundError ncdfe String msg name ncdfe getMessage throw new BuildException msg ncdfe catch NoSuchMethodException nsme throw new BuildException name catch InstantiationException nsme throw new BuildException name catch IllegalAccessException throw new BuildException name catch Throwable throw new BuildException name public Object innerCreateAndSet Class newclass Project project throws NoSuchMethodException InstantiationException IllegalAccessException InvocationTargetException Constructor ctor null boolean noArg false try ctor newclass getConstructor new Class noArg true catch NoSuchMethodException nse ctor newclass getConstructor new Class Project class noArg false Object ctor newInstance noArg new Object new Object project project setProjectReference return public boolean sameDefinition AntTypeDefinition other Project project return other null other getClass getClass other getTypeClass project equals getTypeClass project other getExposedClass project equals getExposedClass project other adapterClass adapterClass other adaptToClass adaptToClass public boolean similarDefinition AntTypeDefinition other Project project if other null getClass other getClass getClassName equals other getClassName extractClassname adapterClass equals extractClassname other adapterClass extractClassname adaptToClass equals extractClassname other adaptToClass return false ClassLoader oldLoader other getClassLoader ClassLoader newLoader getClassLoader return oldLoader newLoader oldLoader instanceof AntClassLoader newLoader instanceof AntClassLoader AntClassLoader oldLoader getClasspath equals AntClassLoader newLoader getClasspath private String extractClassname Class return null getClass getName public class AntlibDefinition extends Task private String uri private ClassLoader antlibClassLoader public void setURI String uri throws BuildException if uri equals ProjectHelper ANT_CORE_URI uri if uri startsWith throw new BuildException uri this uri uri public String getURI return uri public void setAntlibClassLoader ClassLoader classLoader this antlibClassLoader classLoader public ClassLoader getAntlibClassLoader return antlibClassLoader public class WebLogicHotDeploymentTool extends AbstractHotDeploymentTool implements HotDeploymentTool private static final String WEBLOGIC_DEPLOY_CLASS_NAME private static final String VALID_ACTIONS ACTION_DELETE ACTION_DEPLOY ACTION_LIST ACTION_UNDEPLOY ACTION_UPDATE private boolean debug private String application private String component public void deploy Java java new Java getTask java setFork true java setFailonerror true java setClasspath getClasspath java setClassname WEBLOGIC_DEPLOY_CLASS_NAME java createArg setLine getArguments java execute public void validateAttributes throws BuildException super validateAttributes String action getTask getAction if getPassword null throw new BuildException if action equals ACTION_DEPLOY action equals ACTION_UPDATE application null throw new BuildException action if action equals ACTION_DEPLOY action equals ACTION_UPDATE getTask getSource null throw new BuildException action if action equals ACTION_DELETE action equals ACTION_UNDEPLOY application null throw new BuildException action public String getArguments throws BuildException String action getTask getAction String args null if action equals ACTION_DEPLOY action equals ACTION_UPDATE args buildDeployArgs else if action equals ACTION_DELETE action equals ACTION_UNDEPLOY args buildUndeployArgs else if action equals ACTION_LIST args buildListArgs return args protected boolean isActionValid boolean valid false String action getTask getAction for int VALID_ACTIONS length if action equals VALID_ACTIONS valid true break return valid protected StringBuffer buildArgsPrefix ServerDeploy task getTask return new StringBuffer append getServer null getServer append append debug append getUserName null getUserName append append task getAction append append getPassword append protected String buildDeployArgs String args buildArgsPrefix append application append append getTask getSource toString if component null args component args return args protected String buildUndeployArgs return buildArgsPrefix append application append toString protected String buildListArgs return buildArgsPrefix toString public void setDebug boolean debug this debug debug public void setApplication String application this application application public void setComponent String component this component component public class MSVSSLABEL extends MSVSS Commandline buildCmdLine Commandline commandLine new Commandline if getVsspath null throw new BuildException getLocation String label getLabel if label equals String msg throw new BuildException msg getLocation commandLine setExecutable getSSCommand commandLine createArgument setValue COMMAND_LABEL commandLine createArgument setValue getVsspath commandLine createArgument setValue getComment commandLine createArgument setValue getAutoresponse commandLine createArgument setValue label commandLine createArgument setValue getVersion commandLine createArgument setValue getLogin return commandLine public void setLabel String label super setInternalLabel label public void setVersion String version super setInternalVersion version public void setComment String comment super setInternalComment comment public void setAutoresponse String response super setInternalAutoResponse response public interface ExtendFileSelector extends FileSelector Parameterizable public class JavaxScriptRunner extends ScriptRunnerBase private ReflectWrapper engine public String getManagerName return public boolean supportsLanguage if engine null return true checkLanguage ClassLoader origLoader replaceContextLoader try return createEngine null catch Exception ex return false finally restoreContextLoader origLoader public void executeScript String execName throws BuildException evaluateScript execName public Object evaluateScript String execName throws BuildException checkLanguage ClassLoader origLoader replaceContextLoader try ReflectWrapper engine createEngine if engine null throw new BuildException getLanguage for Iterator getBeans keySet iterator hasNext String key String next Object value getBeans get key engine invoke String class key Object class value return engine invoke String class getScript catch Exception be Throwable be Throwable te Throwable ReflectUtil invoke be if te null if te instanceof BuildException throw BuildException te else te throw new BuildException finally restoreContextLoader origLoader private ReflectWrapper createEngine throws Exception if engine null return engine ReflectWrapper manager new ReflectWrapper getClass getClassLoader Object manager invoke String class getLanguage if null return null ReflectWrapper ret new ReflectWrapper if getKeepEngine this engine ret return ret public class P4Change extends P4Base protected String emptyChangeList null protected String description public void execute throws BuildException if emptyChangeList null emptyChangeList getEmptyChangeList final Project myProj getProject P4Handler handler new P4HandlerAdapter public void process String line if util match line int changenumber Integer parseInt line log changenumber Project MSG_INFO myProj setProperty changenumber else if util match line throw new BuildException handler setOutput emptyChangeList execP4Command handler public String getEmptyChangeList throws BuildException final StringBuffer stringbuf new StringBuffer execP4Command new P4HandlerAdapter public void process String line if util match line if util match line log Project MSG_VERBOSE throw new BuildException else if util match line description backslash description line util substitute description line return stringbuf append line stringbuf append return stringbuf toString public static final String backslash String value final StringBuffer buf new StringBuffer value length final int len value length for int len char value charAt if buf append buf append return buf toString public void setDescription String desc this description desc public class Scp extends SSHBase private static final String FROM_ATTRS private static final String TO_ATTRS private String fromUri private String toUri private List fileSets null private boolean isFromRemote isToRemote private boolean isSftp false public void setFile String aFromUri setFromUri aFromUri this isFromRemote isRemoteUri this fromUri public void setTodir String aToUri setToUri aToUri this isToRemote isRemoteUri this toUri public void setLocalFile String aFromUri setFromUri aFromUri this isFromRemote false public void setRemoteFile String aFromUri setFromUri aFromUri this isFromRemote true public void setLocalTodir String aToUri setToUri aToUri this isToRemote false public void setRemoteTodir String aToUri setToUri aToUri this isToRemote true public void setLocalTofile String aToUri setToUri aToUri this isToRemote false public void setRemoteTofile String aToUri setToUri aToUri this isToRemote true public void setSftp boolean yesOrNo isSftp yesOrNo public void addFileset FileSet set if fileSets null fileSets new LinkedList fileSets add set public void init throws BuildException super init this toUri null this fromUri null this fileSets null public void execute throws BuildException if toUri null throw exactlyOne TO_ATTRS if fromUri null fileSets null throw exactlyOne FROM_ATTRS try if isFromRemote isToRemote download fromUri toUri else if isFromRemote isToRemote if fileSets null upload fileSets toUri else upload fromUri toUri else if isFromRemote isToRemote throw new BuildException else throw new BuildException catch Exception if getFailonerror throw new BuildException else log getMessage Project MSG_ERR private void download String fromSshUri String toPath throws JSchException IOException String file parseUri fromSshUri Session session null try session openSession ScpFromMessage message null if isSftp message new ScpFromMessage getVerbose session file getProject resolveFile toPath fromSshUri endsWith else message new ScpFromMessageBySftp getVerbose session file getProject resolveFile toPath fromSshUri endsWith log file message setLogListener this message execute finally if session null session disconnect private void upload List fileSet String toSshUri throws IOException JSchException String file parseUri toSshUri Session session null try List list new ArrayList fileSet size for Iterator fileSet iterator hasNext FileSet set FileSet next Directory createDirectory set if null list add if list isEmpty session openSession ScpToMessage message null if isSftp message new ScpToMessage getVerbose session list file else message new ScpToMessageBySftp getVerbose session list file message setLogListener this message execute finally if session null session disconnect private void upload String fromPath String toSshUri throws IOException JSchException String file parseUri toSshUri Session session null try session openSession ScpToMessage message null if isSftp message new ScpToMessage getVerbose session getProject resolveFile fromPath file else message new ScpToMessageBySftp getVerbose session getProject resolveFile fromPath file message setLogListener this message execute finally if session null session disconnect private String parseUri String uri int indexOfAt uri lastIndexOf int indexOfColon uri indexOf if indexOfColon indexOfColon indexOfAt setUsername uri substring indexOfColon setPassword uri substring indexOfColon indexOfAt else setUsername uri substring indexOfAt if getUserInfo getPassword null getUserInfo getPassphrase null throw new BuildException getUserInfo getName int indexOfPath uri indexOf indexOfAt if indexOfPath throw new BuildException uri setHost uri substring indexOfAt indexOfPath String remotePath uri substring indexOfPath if remotePath equals remotePath return remotePath private boolean isRemoteUri String uri boolean isRemote true int indexOfAt uri indexOf if indexOfAt isRemote false return isRemote private Directory createDirectory FileSet set DirectoryScanner scanner set getDirectoryScanner getProject Directory root new Directory scanner getBasedir String files scanner getIncludedFiles if files length for int files length String path Directory getPath files Directory current root File currentParent scanner getBasedir for int path length File file new File currentParent path if file isDirectory current addDirectory new Directory file current current getChild file currentParent current getDirectory else if file isFile current addFile file else root null return root private void setFromUri String fromUri if this fromUri null throw exactlyOne FROM_ATTRS this fromUri fromUri private void setToUri String toUri if this toUri null throw exactlyOne TO_ATTRS this toUri toUri private BuildException exactlyOne String attrs return exactlyOne attrs null private BuildException exactlyOne String attrs String alt StringBuffer buf new StringBuffer append append attrs for int attrs length buf append append attrs buf append if alt null buf append append alt return new BuildException buf append toString public class SunJavah implements JavahAdapter public static final String IMPLEMENTATION_NAME public boolean compile Javah javah throws BuildException Commandline cmd setupJavahCommand javah ExecuteJava ej new ExecuteJava Class null try try Class forName catch ClassNotFoundException cnfe Class forName catch ClassNotFoundException ex throw new BuildException ex javah getLocation cmd setExecutable getName ej setJavaCommand cmd File Locator getClassSource if null ej setClasspath new Path javah getProject getPath return ej fork javah private Commandline setupJavahCommand Javah javah Commandline cmd new Commandline if javah getDestdir null cmd createArgument setValue cmd createArgument setFile javah getDestdir if javah getOutputfile null cmd createArgument setValue cmd createArgument setFile javah getOutputfile if javah getClasspath null cmd createArgument setValue cmd createArgument setPath javah getClasspath if javah getVerbose cmd createArgument setValue if javah getOld cmd createArgument setValue if javah getForce cmd createArgument setValue if javah getStubs javah getOld throw new BuildException javah getLocation if javah getStubs cmd createArgument setValue Path bcp new Path javah getProject if javah getBootclasspath null bcp append javah getBootclasspath bcp bcp concatSystemBootClasspath if bcp size cmd createArgument setValue cmd createArgument setPath bcp cmd addArguments javah getCurrentArgs javah logAndAddFiles cmd return cmd public class CommandlineJava implements Cloneable private Commandline vmCommand new Commandline private Commandline javaCommand new Commandline private SysProperties sysProperties new SysProperties private Path classpath null private Path bootclasspath null private String vmVersion private String maxMemory null private Assertions assertions null private boolean executeJar false private boolean cloneVm false public static class SysProperties extends Environment implements Cloneable Properties sys null private Vector propertySets new Vector public String getVariables throws BuildException List definitions new LinkedList ListIterator list definitions listIterator addDefinitionsToList list if definitions size return null else return String definitions toArray new String definitions size public void addDefinitionsToList ListIterator listIt String props super getVariables if props null for int props length listIt add props Properties propertySetProperties mergePropertySets for Enumeration propertySetProperties keys hasMoreElements String key String nextElement String value propertySetProperties getProperty key listIt add key value public int size Properties mergePropertySets return variables size size public void setSystem throws BuildException try sys System getProperties Properties new Properties for Enumeration sys propertyNames hasMoreElements String name String nextElement put name sys getProperty name putAll mergePropertySets for Enumeration variables elements hasMoreElements Environment Variable Environment Variable nextElement validate put getKey getValue System setProperties catch SecurityException throw new BuildException public void restoreSystem throws BuildException if sys null throw new BuildException try System setProperties sys sys null catch SecurityException throw new BuildException public Object clone throws CloneNotSupportedException try SysProperties SysProperties super clone variables Vector variables clone propertySets Vector propertySets clone return catch CloneNotSupportedException return null public void addSyspropertyset PropertySet ps propertySets addElement ps public void addSysproperties SysProperties ps variables addAll ps variables propertySets addAll ps propertySets private Properties mergePropertySets Properties new Properties for Enumeration propertySets elements hasMoreElements PropertySet ps PropertySet nextElement putAll ps getProperties return public CommandlineJava setVm JavaEnvUtils getJreExecutable setVmversion JavaEnvUtils getJavaVersion public Commandline Argument createArgument return javaCommand createArgument public Commandline Argument createVmArgument return vmCommand createArgument public void addSysproperty Environment Variable sysp sysProperties addVariable sysp public void addSyspropertyset PropertySet sysp sysProperties addSyspropertyset sysp public void addSysproperties SysProperties sysp sysProperties addSysproperties sysp public void setVm String vm vmCommand setExecutable vm public void setVmversion String value vmVersion value public void setCloneVm boolean cloneVm this cloneVm cloneVm public Assertions getAssertions return assertions public void setAssertions Assertions assertions this assertions assertions public void setJar String jarpathname javaCommand setExecutable jarpathname executeJar true public String getJar if executeJar return javaCommand getExecutable return null public void setClassname String classname javaCommand setExecutable classname executeJar false public String getClassname if executeJar return javaCommand getExecutable return null public Path createClasspath Project if classpath null classpath new Path return classpath public Path createBootclasspath Project if bootclasspath null bootclasspath new Path return bootclasspath public String getVmversion return vmVersion public String getCommandline List commands new LinkedList final ListIterator listIterator commands listIterator addCommandsToList listIterator return String commands toArray new String commands size private void addCommandsToList final ListIterator listIterator getActualVMCommand addCommandToList listIterator sysProperties addDefinitionsToList listIterator if isCloneVm SysProperties clonedSysProperties new SysProperties PropertySet ps new PropertySet PropertySet BuiltinPropertySetName sys new PropertySet BuiltinPropertySetName sys setValue ps appendBuiltin sys clonedSysProperties addSyspropertyset ps clonedSysProperties addDefinitionsToList listIterator Path bcp calculateBootclasspath true if bcp size listIterator add bcp toString if haveClasspath listIterator add listIterator add classpath concatSystemClasspath toString if getAssertions null getAssertions applyAssertions listIterator if executeJar listIterator add javaCommand addCommandToList listIterator public void setMaxmemory String max this maxMemory max public String toString return Commandline toString getCommandline public String describeCommand return Commandline describeCommand getCommandline public String describeJavaCommand return Commandline describeCommand getJavaCommand protected Commandline getActualVMCommand Commandline actualVMCommand Commandline vmCommand clone if maxMemory null if vmVersion startsWith actualVMCommand createArgument setValue maxMemory else actualVMCommand createArgument setValue maxMemory return actualVMCommand public int size int size getActualVMCommand size javaCommand size sysProperties size if isCloneVm size System getProperties size if haveClasspath size if calculateBootclasspath true size size if executeJar size if getAssertions null size getAssertions size return size public Commandline getJavaCommand return javaCommand public Commandline getVmCommand return getActualVMCommand public Path getClasspath return classpath public Path getBootclasspath return bootclasspath public void setSystemProperties throws BuildException sysProperties setSystem public void restoreSystemProperties throws BuildException sysProperties restoreSystem public SysProperties getSystemProperties return sysProperties public Object clone throws CloneNotSupportedException try CommandlineJava CommandlineJava super clone vmCommand Commandline vmCommand clone javaCommand Commandline javaCommand clone sysProperties SysProperties sysProperties clone if classpath null classpath Path classpath clone if bootclasspath null bootclasspath Path bootclasspath clone if assertions null assertions Assertions assertions clone return catch CloneNotSupportedException throw new BuildException public void clearJavaArgs javaCommand clearArgs protected boolean haveClasspath Path fullClasspath classpath null classpath concatSystemClasspath null return fullClasspath null fullClasspath toString trim length protected boolean haveBootclasspath boolean log return calculateBootclasspath log size private Path calculateBootclasspath boolean log if vmVersion startsWith if bootclasspath null log bootclasspath log else if bootclasspath null return bootclasspath concatSystemBootClasspath isCloneVm else if isCloneVm return Path systemBootClasspath return new Path null private boolean isCloneVm return cloneVm equals System getProperty public final class ClassConstants extends BaseFilterReader implements ChainableReader private String queuedData null private static final String JAVA_CLASS_HELPER public ClassConstants super public ClassConstants final Reader in super in public int read throws IOException int ch if queuedData null queuedData length queuedData null if queuedData null ch queuedData charAt queuedData queuedData substring if queuedData length queuedData null else final String clazz readFully if clazz null ch else final byte bytes clazz getBytes try final Class javaClassHelper Class forName JAVA_CLASS_HELPER if javaClassHelper null final Class params byte class final Method getConstants javaClassHelper getMethod params final Object args bytes final StringBuffer sb StringBuffer getConstants invoke null args if sb length queuedData sb toString return read catch NoClassDefFoundError ex throw ex catch RuntimeException ex throw ex catch InvocationTargetException ex Throwable ex getTargetException if instanceof NoClassDefFoundError throw NoClassDefFoundError if instanceof RuntimeException throw RuntimeException throw new BuildException catch Exception ex throw new BuildException ex return ch public Reader chain final Reader rdr ClassConstants newFilter new ClassConstants rdr return newFilter public class CCLock extends ClearCase private boolean mReplace false private boolean mObsolete false private String mComment null private String mNusers null private String mPname null private String mObjselect null public void execute throws BuildException Commandline commandLine new Commandline Project aProj getProject int result if getViewPath null setViewPath aProj getBaseDir getPath commandLine setExecutable getClearToolCommand commandLine createArgument setValue COMMAND_LOCK checkOptions commandLine if getFailOnErr getProject log getOpType Project MSG_VERBOSE result run commandLine if Execute isFailure result getFailOnErr String msg commandLine toString throw new BuildException msg getLocation private void checkOptions Commandline cmd if getReplace cmd createArgument setValue FLAG_REPLACE if getObsolete cmd createArgument setValue FLAG_OBSOLETE else getNusersCommand cmd getCommentCommand cmd if getObjselect null getPname null throw new BuildException getPnameCommand cmd if getObjselect null cmd createArgument setValue getObjselect public void setReplace boolean replace mReplace replace public boolean getReplace return mReplace public void setObsolete boolean obsolete mObsolete obsolete public boolean getObsolete return mObsolete public void setNusers String nusers mNusers nusers public String getNusers return mNusers public void setComment String comment mComment comment public String getComment return mComment public void setPname String pname mPname pname public String getPname return mPname public void setObjSel String objsel mObjselect objsel public void setObjselect String objselect mObjselect objselect public String getObjselect return mObjselect private void getNusersCommand Commandline cmd if getNusers null return else cmd createArgument setValue FLAG_NUSERS cmd createArgument setValue getNusers private void getCommentCommand Commandline cmd if getComment null return else cmd createArgument setValue FLAG_COMMENT cmd createArgument setValue getComment private void getPnameCommand Commandline cmd if getPname null return else cmd createArgument setValue FLAG_PNAME cmd createArgument setValue getPname private String getOpType if getPname null return getPname else return getObjselect public static final String FLAG_REPLACE public static final String FLAG_NUSERS public static final String FLAG_OBSOLETE public static final String FLAG_COMMENT public static final String FLAG_PNAME public class Cvs extends AbstractCvsTask public Cvs public class Reference private String refid private Project project public Reference public Reference String id setRefId id public Reference Project String id setRefId id setProject public void setRefId String id refid id public String getRefId return refid public void setProject Project this project public Project getProject return project public Object getReferencedObject Project fallback throws BuildException if refid null throw new BuildException Object project null fallback getReference refid project getReference refid if null throw new BuildException refid return public Object getReferencedObject throws BuildException if project null throw new BuildException refid return getReferencedObject project public final class LineContains extends BaseParamFilterReader implements ChainableReader private static final String CONTAINS_KEY private static final String NEGATE_KEY private Vector contains new Vector private String line null private boolean negate false public LineContains super public LineContains final Reader in super in public int read throws IOException if getInitialized initialize setInitialized true int ch if line null ch line charAt if line length line null else line line substring else final int containsSize contains size for line readLine line null line readLine boolean matches true for int matches containsSize String containsStr String contains elementAt matches line indexOf containsStr if matches isNegated break if line null return read return ch public void addConfiguredContains final Contains contains this contains addElement contains getValue public void setNegate boolean negate public boolean isNegated return negate private void setContains final Vector contains this contains contains private Vector getContains return contains public Reader chain final Reader rdr LineContains newFilter new LineContains rdr newFilter setContains getContains newFilter setNegate isNegated return newFilter private void initialize Parameter params getParameters if params null for int params length if CONTAINS_KEY equals params getType contains addElement params getValue else if NEGATE_KEY equals params getType setNegate Project toBoolean params getValue public static class Contains private String value public final void setValue String contains value contains public final String getValue return value public class Constants static final String HALT_ON_ERROR static final String HALT_ON_FAILURE static final String FILTERTRACE static final String CRASHFILE static final String BEFORE_FIRST_TEST static final String PROPSFILE static final String SHOWOUTPUT static final String OUTPUT_TO_FORMATTERS static final String FORMATTER static final String LOGTESTLISTENEREVENTS static final String TESTSFILE static final String TERMINATED_SUCCESSFULLY public class Available extends Task implements Condition private static final FileUtils FILE_UTILS FileUtils getFileUtils private String property private String classname private String filename private File file private Path filepath private String resource private FileDir type private Path classpath private AntClassLoader loader private String value private boolean isTask false private boolean ignoreSystemclasses false private boolean searchParents false public void setSearchParents boolean searchParents this searchParents searchParents public void setClasspath Path classpath createClasspath append classpath public Path createClasspath if this classpath null this classpath new Path getProject return this classpath createPath public void setClasspathRef Reference createClasspath setRefid public void setFilepath Path filepath createFilepath append filepath public Path createFilepath if this filepath null this filepath new Path getProject return this filepath createPath public void setProperty String property this property property public void setValue String value this value value public void setClassname String classname if equals classname this classname classname public void setFile File file this file file this filename FILE_UTILS removeLeadingPath getProject getBaseDir file public void setResource String resource this resource resource public void setType String type log Project MSG_WARN this type new FileDir this type setValue type public void setType FileDir type this type type public void setIgnoresystemclasses boolean ignore this ignoreSystemclasses ignore public void execute throws BuildException if property null throw new BuildException getLocation isTask true try if eval String oldvalue getProject getProperty property if null oldvalue oldvalue equals value log StringUtils LINE_SEP Project MSG_WARN getProject setProperty property value finally isTask false public boolean eval throws BuildException try if classname null file null resource null throw new BuildException getLocation if type null if file null throw new BuildException getLocation if classpath null classpath setProject getProject this loader getProject createClassLoader classpath String appendix if isTask appendix property else setTaskName if classname null checkClass classname log classname appendix Project MSG_VERBOSE return false if file null checkFile StringBuffer buf new StringBuffer if type null buf append type append buf append filename append appendix log buf toString Project MSG_VERBOSE return false if resource null checkResource resource log resource appendix Project MSG_VERBOSE return false finally if loader null loader cleanup loader null if isTask setTaskName null return true private boolean checkFile if filepath null return checkFile file filename else String paths filepath list for int paths length log paths Project MSG_DEBUG File path new File paths if path exists filename equals paths if type null log path Project MSG_VERBOSE return true else if type isDir path isDirectory log path Project MSG_VERBOSE return true else if type isFile path isFile log path Project MSG_VERBOSE return true return false File parent path getParentFile if parent null parent exists filename equals parent getAbsolutePath if type null log parent Project MSG_VERBOSE return true else if type isDir log parent Project MSG_VERBOSE return true return false if path exists path isDirectory if checkFile new File path filename filename path return true while searchParents parent null parent exists if checkFile new File parent filename filename parent return true parent parent getParentFile return false private boolean checkFile File String text if type null if type isDir if isDirectory log text Project MSG_VERBOSE return isDirectory else if type isFile if isFile log text Project MSG_VERBOSE return isFile if exists log text Project MSG_VERBOSE return exists private boolean checkResource String resource if loader null return loader getResourceAsStream resource null else ClassLoader cL this getClass getClassLoader if cL null return cL getResourceAsStream resource null else return ClassLoader getSystemResourceAsStream resource null private boolean checkClass String classname try if ignoreSystemclasses loader getProject createClassLoader classpath loader setParentFirst false loader addJavaLibraries if loader null try loader findClass classname catch SecurityException se return true else return false else if loader null loader loadClass classname else ClassLoader this getClass getClassLoader if null Class forName classname true else Class forName classname return true catch ClassNotFoundException log classname Project MSG_DEBUG return false catch NoClassDefFoundError log getMessage classname Project MSG_DEBUG return false public static class FileDir extends EnumeratedAttribute private static final String VALUES public String getValues return VALUES public boolean isDir return equalsIgnoreCase getValue public boolean isFile return equalsIgnoreCase getValue public class TypeSelector extends BaseExtendSelector private String type null public static final String TYPE_KEY public TypeSelector public String toString StringBuffer buf new StringBuffer buf append type buf append return buf toString public void setType FileType fileTypes this type fileTypes getValue public void setParameters Parameter parameters super setParameters parameters if parameters null for int parameters length String paramname parameters getName if TYPE_KEY equalsIgnoreCase paramname FileType new FileType setValue parameters getValue setType else setError paramname public void verifySettings if type null setError public boolean isSelected File basedir String filename File file validate if file isDirectory return type equals FileType DIR else return type equals FileType FILE public static class FileType extends EnumeratedAttribute public static final String FILE public static final String DIR public String getValues return new String FILE DIR public class Sleep extends Task private boolean failOnError true private int seconds private int hours private int minutes private int milliseconds public Sleep public void setSeconds int seconds this seconds seconds public void setHours int hours this hours hours public void setMinutes int minutes this minutes minutes public void setMilliseconds int milliseconds this milliseconds milliseconds public void doSleep long millis try Thread sleep millis catch InterruptedException ie public void setFailOnError boolean failOnError this failOnError failOnError private long getSleepTime return long hours minutes seconds milliseconds public void validate throws BuildException if getSleepTime throw new BuildException public void execute throws BuildException try validate long sleepTime getSleepTime log sleepTime Project MSG_VERBOSE doSleep sleepTime catch Exception if failOnError throw new BuildException else String text toString log text Project MSG_ERR public abstract class ResourceComparator extends DataType implements Comparator public final int compare Object foo Object bar dieOnCircularReference ResourceComparator isReference ResourceComparator getCheckedRef this return resourceCompare Resource foo Resource bar public boolean equals Object if isReference return getCheckedRef equals if null return false return this getClass equals getClass public synchronized int hashCode if isReference return getCheckedRef hashCode return getClass hashCode protected abstract int resourceCompare Resource foo Resource bar public class Type extends ResourceComparator protected int resourceCompare Resource foo Resource bar boolean foo isDirectory if bar isDirectory return return public final class TabsToSpaces extends BaseParamFilterReader implements ChainableReader private static final int DEFAULT_TAB_LENGTH private static final String TAB_LENGTH_KEY private int tabLength DEFAULT_TAB_LENGTH private int spacesRemaining public TabsToSpaces super public TabsToSpaces final Reader in super in public int read throws IOException if getInitialized initialize setInitialized true int ch if spacesRemaining spacesRemaining ch else ch in read if ch spacesRemaining tabLength ch return ch public void setTablength final int tabLength this tabLength tabLength private int getTablength return tabLength public Reader chain final Reader rdr TabsToSpaces newFilter new TabsToSpaces rdr newFilter setTablength getTablength newFilter setInitialized true return newFilter private void initialize Parameter params getParameters if params null for int params length if params null if TAB_LENGTH_KEY equals params getName tabLength new Integer params getValue intValue break public class Jikes extends DefaultCompilerAdapter public boolean execute throws BuildException attributes log Project MSG_VERBOSE Commandline cmd new Commandline Path sourcepath null if compileSourcepath null sourcepath compileSourcepath else sourcepath src if sourcepath size cmd createArgument setValue cmd createArgument setPath sourcepath Path classpath new Path project if bootclasspath null bootclasspath size includeJavaRuntime true else classpath append getCompileClasspath String jikesPath System getProperty if jikesPath null classpath append new Path project jikesPath if extdirs null extdirs size cmd createArgument setValue cmd createArgument setPath extdirs String exec getJavac getExecutable cmd setExecutable exec null exec if deprecation cmd createArgument setValue if destDir null cmd createArgument setValue cmd createArgument setFile destDir cmd createArgument setValue cmd createArgument setPath classpath if encoding null cmd createArgument setValue cmd createArgument setValue encoding if debug String debugLevel attributes getDebugLevel if debugLevel null cmd createArgument setValue debugLevel else cmd createArgument setValue else cmd createArgument setValue if optimize cmd createArgument setValue if verbose cmd createArgument setValue if depend cmd createArgument setValue if target null cmd createArgument setValue cmd createArgument setValue target String emacsProperty project getProperty if emacsProperty null Project toBoolean emacsProperty cmd createArgument setValue String warningsProperty project getProperty if warningsProperty null attributes log Project MSG_WARN attributes log Project MSG_WARN if Project toBoolean warningsProperty cmd createArgument setValue if attributes getNowarn cmd createArgument setValue String pedanticProperty project getProperty if pedanticProperty null Project toBoolean pedanticProperty cmd createArgument setValue String fullDependProperty project getProperty if fullDependProperty null Project toBoolean fullDependProperty cmd createArgument setValue if attributes getSource null cmd createArgument setValue String source attributes getSource if source equals source equals attributes log source cmd createArgument setValue else cmd createArgument setValue source addCurrentCompilerArgs cmd int firstFileName cmd size Path boot getBootClassPath if boot size cmd createArgument setValue cmd createArgument setPath boot logAndAddFilesToCompile cmd return executeExternalCompile cmd getCommandline firstFileName public interface ResourceCollection Iterator iterator int size boolean isFilesystemOnly public class IdentityStack extends Stack public static IdentityStack getInstance Stack if instanceof IdentityStack return IdentityStack IdentityStack result new IdentityStack if null result addAll return result public IdentityStack public IdentityStack Object super push public synchronized boolean contains Object return indexOf public synchronized int indexOf Object int pos for int pos size if get return return public synchronized int lastIndexOf Object int pos for int pos if get return return public class UnknownElement extends Task private String elementName private String namespace private String qname private Object realThing private boolean presetDefed false public UnknownElement String elementName this elementName elementName public List getChildren return children public String getTag return elementName public String getNamespace return namespace public void setNamespace String namespace if namespace equals ProjectHelper ANT_CURRENT_URI ComponentHelper helper ComponentHelper getComponentHelper getProject namespace helper getCurrentAntlibUri this namespace namespace null namespace public String getQName return qname public void setQName String qname this qname qname public RuntimeConfigurable getWrapper return super getWrapper public void maybeConfigure throws BuildException if realThing null return configure makeObject this getWrapper public void configure Object realObject realThing realObject getWrapper setProxy realThing Task task null if realThing instanceof Task task Task realThing task setRuntimeConfigurableWrapper getWrapper if getWrapper getId null this getOwningTarget replaceChild this Task realThing if task null task maybeConfigure else getWrapper maybeConfigure getProject handleChildren realThing getWrapper protected void handleOutput String output if realThing instanceof Task Task realThing handleOutput output else super handleOutput output protected int handleInput byte buffer int offset int length throws IOException if realThing instanceof Task return Task realThing handleInput buffer offset length else return super handleInput buffer offset length protected void handleFlush String output if realThing instanceof Task Task realThing handleFlush output else super handleFlush output protected void handleErrorOutput String output if realThing instanceof Task Task realThing handleErrorOutput output else super handleErrorOutput output protected void handleErrorFlush String output if realThing instanceof Task Task realThing handleErrorOutput output else super handleErrorOutput output public void execute if realThing null throw new BuildException elementName getLocation if realThing instanceof Task Task realThing execute realThing null getWrapper setProxy null public void addChild UnknownElement child if children null children new ArrayList children add child protected void handleChildren Object parent RuntimeConfigurable parentWrapper throws BuildException if parent instanceof TypeAdapter parent TypeAdapter parent getProxy String parentUri getNamespace Class parentClass parent getClass IntrospectionHelper ih IntrospectionHelper getHelper getProject parentClass if children null Iterator it children iterator for int it hasNext RuntimeConfigurable childWrapper parentWrapper getChild UnknownElement child UnknownElement it next try if handleChild parentUri ih parent child childWrapper if parent instanceof TaskContainer ih throwNotSupported getProject parent child getTag else TaskContainer container TaskContainer parent container addTask child catch UnsupportedElementException ex throw new BuildException parentWrapper getElementTag ex getElement ex protected String getComponentName return ProjectHelper genComponentName getNamespace getTag public void applyPreSet UnknownElement if presetDefed return getWrapper applyPreSet getWrapper if children null List newChildren new ArrayList newChildren addAll children if children null newChildren addAll children children newChildren presetDefed true protected Object makeObject UnknownElement ue RuntimeConfigurable ComponentHelper helper ComponentHelper getComponentHelper getProject String name ue getComponentName Object helper createComponent ue ue getNamespace name if null throw getNotFoundException name if instanceof PreSetDef PreSetDefinition PreSetDef PreSetDefinition def PreSetDef PreSetDefinition def createObject ue getProject if null throw getNotFoundException name def getPreSets getComponentName ue applyPreSet def getPreSets if instanceof Task Task task Task task setTaskType ue getTaskType task setTaskName ue getTaskName task init if instanceof UnknownElement UnknownElement makeObject UnknownElement if instanceof Task Task setOwningTarget getOwningTarget if instanceof ProjectComponent ProjectComponent setLocation getLocation return protected Task makeTask UnknownElement ue RuntimeConfigurable Task task getProject createTask ue getTag if task null task setLocation getLocation task setOwningTarget getOwningTarget task init return task protected BuildException getNotFoundException String what String name ComponentHelper helper ComponentHelper getComponentHelper getProject String msg helper diagnoseCreationFailure name what return new BuildException msg getLocation public String getTaskName return realThing null realThing instanceof Task super getTaskName Task realThing getTaskName public Task getTask if realThing instanceof Task return Task realThing return null public Object getRealThing return realThing public void setRealThing Object realThing this realThing realThing private boolean handleChild String parentUri IntrospectionHelper ih Object parent UnknownElement child RuntimeConfigurable childWrapper String childName ProjectHelper genComponentName child getNamespace child getTag if ih supportsNestedElement parentUri childName IntrospectionHelper Creator creator ih getElementCreator getProject parentUri parent childName child creator setPolyType childWrapper getPolyType Object realChild creator create if realChild instanceof PreSetDef PreSetDefinition PreSetDef PreSetDefinition def PreSetDef PreSetDefinition realChild realChild creator getRealObject child applyPreSet def getPreSets childWrapper setCreator creator childWrapper setProxy realChild if realChild instanceof Task Task childTask Task realChild childTask setRuntimeConfigurableWrapper childWrapper childTask setTaskName childName childTask setTaskType childName if realChild instanceof ProjectComponent ProjectComponent realChild setLocation child getLocation childWrapper maybeConfigure getProject child handleChildren realChild childWrapper creator store return true return false public boolean similar Object obj if obj null return false if getClass getName equals obj getClass getName return false UnknownElement other UnknownElement obj if equalsString elementName other elementName return false if namespace equals other namespace return false if qname equals other qname return false if getWrapper getAttributeMap equals other getWrapper getAttributeMap return false if getWrapper getText toString equals other getWrapper getText toString return false if children null children size return other children null other children size if other children null return false if children size other children size return false for int children size UnknownElement child UnknownElement children get if child similar other children get return false return true private static boolean equalsString String String return null null equals public UnknownElement copy Project newProject UnknownElement ret new UnknownElement getTag ret setNamespace getNamespace ret setProject newProject ret setQName getQName ret setTaskType getTaskType ret setTaskName getTaskName ret setLocation getLocation if getOwningTarget null Target new Target setProject getProject ret setOwningTarget else ret setOwningTarget getOwningTarget RuntimeConfigurable copyRC new RuntimeConfigurable ret getTaskName copyRC setPolyType getWrapper getPolyType Map getWrapper getAttributeMap for Iterator entrySet iterator hasNext Map Entry entry Map Entry next copyRC setAttribute String entry getKey String entry getValue copyRC addText getWrapper getText toString for Enumeration getWrapper getChildren hasMoreElements RuntimeConfigurable RuntimeConfigurable nextElement UnknownElement ueChild UnknownElement getProxy UnknownElement copyChild ueChild copy newProject copyRC addChild copyChild getWrapper ret addChild copyChild return ret public class Checksum extends MatchingTask implements Condition private static class FileUnion extends Restrict private Union FileUnion new Union super add super add Type FILE public void add ResourceCollection rc add rc private File file null private File todir private String algorithm private String provider null private String fileext private String property private Map allDigests new HashMap private Map relativeFilePaths new HashMap private String totalproperty private boolean forceOverwrite private String verifyProperty private FileUnion resources null private Hashtable includeFileMap new Hashtable private MessageDigest messageDigest private boolean isCondition private int readBufferSize private MessageFormat format FormatElement getDefault getFormat public void setFile File file this file file public void setTodir File todir this todir todir public void setAlgorithm String algorithm this algorithm algorithm public void setProvider String provider this provider provider public void setFileext String fileext this fileext fileext public void setProperty String property this property property public void setTotalproperty String totalproperty this totalproperty totalproperty public void setVerifyproperty String verifyProperty this verifyProperty verifyProperty public void setForceOverwrite boolean forceOverwrite this forceOverwrite forceOverwrite public void setReadBufferSize int size this readBufferSize size public void setFormat FormatElement format getFormat public void setPattern String format new MessageFormat public void addFileset FileSet set add set public void add ResourceCollection rc if rc null return resources resources null new FileUnion resources resources add rc public void execute throws BuildException isCondition false boolean value validateAndExecute if verifyProperty null getProject setNewProperty verifyProperty value Boolean TRUE toString Boolean FALSE toString public boolean eval throws BuildException isCondition true return validateAndExecute private boolean validateAndExecute throws BuildException String savedFileExt fileext if file null resources null resources size throw new BuildException if resources null resources isFilesystemOnly throw new BuildException if file null file exists file isDirectory throw new BuildException if file null totalproperty null throw new BuildException if property null fileext null throw new BuildException if property null if forceOverwrite throw new BuildException int ct if resources null ct resources size if file null ct if ct throw new BuildException if verifyProperty null isCondition true if verifyProperty null forceOverwrite throw new BuildException if isCondition forceOverwrite throw new BuildException messageDigest null if provider null try messageDigest MessageDigest getInstance algorithm provider catch NoSuchAlgorithmException noalgo throw new BuildException noalgo getLocation catch NoSuchProviderException noprovider throw new BuildException noprovider getLocation else try messageDigest MessageDigest getInstance algorithm catch NoSuchAlgorithmException noalgo throw new BuildException noalgo getLocation if messageDigest null throw new BuildException getLocation if fileext null fileext algorithm else if fileext trim length throw new BuildException try if resources null for Iterator resources iterator hasNext FileResource fr FileResource next File src fr getFile if totalproperty null todir null relativeFilePaths put src fr getName replace File separatorChar addToIncludeFileMap src if file null if totalproperty null todir null relativeFilePaths put file file getName replace File separatorChar addToIncludeFileMap file return generateChecksums finally fileext savedFileExt includeFileMap clear private void addToIncludeFileMap File file throws BuildException if file exists if property null File checksumFile getChecksumFile file if forceOverwrite isCondition file lastModified checksumFile lastModified includeFileMap put file checksumFile else log file checksumFile Project MSG_VERBOSE if totalproperty null String checksum readChecksum checksumFile byte digest decodeHex checksum toCharArray allDigests put file digest else includeFileMap put file property else String message file getAbsolutePath log message throw new BuildException message getLocation private File getChecksumFile File file File directory if todir null String path String relativeFilePaths get file if path null throw new BuildException file directory new File todir path getParentFile directory mkdirs else directory file getParentFile File checksumFile new File directory file getName fileext return checksumFile private boolean generateChecksums throws BuildException boolean checksumMatches true FileInputStream fis null FileOutputStream fos null byte buf new byte readBufferSize try for Enumeration includeFileMap keys hasMoreElements messageDigest reset File src File nextElement if isCondition log algorithm src Project MSG_VERBOSE fis new FileInputStream src DigestInputStream dis new DigestInputStream fis messageDigest while dis read buf readBufferSize dis close fis close fis null byte fileDigest messageDigest digest if totalproperty null allDigests put src fileDigest String checksum createDigestString fileDigest Object destination includeFileMap get src if destination instanceof java lang String String prop String destination if isCondition checksumMatches checksumMatches checksum equals property else getProject setNewProperty prop checksum else if destination instanceof java io File if isCondition File existingFile File destination if existingFile exists try String suppliedChecksum readChecksum existingFile checksumMatches checksumMatches checksum equals suppliedChecksum catch BuildException be checksumMatches false else checksumMatches false else File dest File destination fos new FileOutputStream dest fos write format format new Object checksum src getName getBytes fos write StringUtils LINE_SEP getBytes fos close fos null if totalproperty null Set keys allDigests keySet Object keyArray keys toArray Arrays sort keyArray messageDigest reset for int keyArray length File src File keyArray byte digest byte allDigests get src messageDigest update digest String fileName String relativeFilePaths get src messageDigest update fileName getBytes String totalChecksum createDigestString messageDigest digest getProject setNewProperty totalproperty totalChecksum catch Exception throw new BuildException getLocation finally FileUtils close fis FileUtils close fos return checksumMatches private String createDigestString byte fileDigest StringBuffer checksumSb new StringBuffer for int fileDigest length String hexStr Integer toHexString fileDigest if hexStr length checksumSb append checksumSb append hexStr return checksumSb toString public static byte decodeHex char data throws BuildException int data length if throw new BuildException byte out new byte for int int Character digit data Character digit data out byte return out private String readChecksum File BufferedReader diskChecksumReader null try diskChecksumReader new BufferedReader new FileReader Object result format parse diskChecksumReader readLine if result null result length result null throw new BuildException return String result catch IOException throw new BuildException catch ParseException throw new BuildException finally FileUtils close diskChecksumReader public static class FormatElement extends EnumeratedAttribute private static HashMap formatMap new HashMap private static final String CHECKSUM private static final String MD5SUM private static final String SVF static formatMap put CHECKSUM new MessageFormat formatMap put MD5SUM new MessageFormat formatMap put SVF new MessageFormat public FormatElement super public static FormatElement getDefault FormatElement new FormatElement setValue CHECKSUM return public MessageFormat getFormat return MessageFormat formatMap get getValue public String getValues return new String CHECKSUM MD5SUM SVF public class WebsphereDeploymentTool extends GenericDeploymentTool public static final String PUBLICID_EJB11 public static final String PUBLICID_EJB20 protected static final String SCHEMA_DIR protected static final String WAS_EXT protected static final String WAS_BND protected static final String WAS_CMP_MAP protected static final String WAS_CMP_SCHEMA private static final FileUtils FILE_UTILS FileUtils getFileUtils private String jarSuffix private String ejb11DTD private boolean keepGeneric false private boolean alwaysRebuild true private boolean ejbdeploy true private boolean newCMP false private Path wasClasspath null private String dbVendor private String dbName private String dbSchema private boolean codegen private boolean quiet true private boolean novalidate private boolean nowarn private boolean noinform private boolean trace private String rmicOptions private boolean use35MappingRules private String tempdir private File websphereHome public Path createWASClasspath if wasClasspath null wasClasspath new Path getTask getProject return wasClasspath createPath public void setWASClasspath Path wasClasspath this wasClasspath wasClasspath public void setDbvendor String dbvendor this dbVendor dbvendor public void setDbname String dbName this dbName dbName public void setDbschema String dbSchema this dbSchema dbSchema public void setCodegen boolean codegen this codegen codegen public void setQuiet boolean quiet this quiet quiet public void setNovalidate boolean novalidate this novalidate novalidate public void setNowarn boolean nowarn this nowarn nowarn public void setNoinform boolean noinform this noinform noinform public void setTrace boolean trace this trace trace public void setRmicoptions String options this rmicOptions options public void setUse35 boolean attr use35MappingRules attr public void setRebuild boolean rebuild this alwaysRebuild rebuild public void setSuffix String inString this jarSuffix inString public void setKeepgeneric boolean inValue this keepGeneric inValue public void setEjbdeploy boolean ejbdeploy this ejbdeploy ejbdeploy public void setEJBdtd String inString this ejb11DTD inString public void setOldCMP boolean oldCMP this newCMP oldCMP public void setNewCMP boolean newCMP this newCMP newCMP public void setTempdir String tempdir this tempdir tempdir protected DescriptorHandler getDescriptorHandler File srcDir DescriptorHandler handler new DescriptorHandler getTask srcDir handler registerDTD PUBLICID_EJB11 ejb11DTD for Iterator getConfig dtdLocations iterator hasNext EjbJar DTDLocation dtdLocation EjbJar DTDLocation next handler registerDTD dtdLocation getPublicId dtdLocation getLocation return handler protected DescriptorHandler getWebsphereDescriptorHandler final File srcDir DescriptorHandler handler new DescriptorHandler getTask srcDir protected void processElement for Iterator getConfig dtdLocations iterator hasNext EjbJar DTDLocation dtdLocation EjbJar DTDLocation next handler registerDTD dtdLocation getPublicId dtdLocation getLocation return handler protected void addVendorFiles Hashtable ejbFiles String baseName String ddPrefix usingBaseJarName baseName String dbPrefix dbVendor null dbVendor File websphereEXT new File getConfig descriptorDir ddPrefix WAS_EXT if websphereEXT exists ejbFiles put META_DIR WAS_EXT websphereEXT else log websphereEXT getPath Project MSG_VERBOSE File websphereBND new File getConfig descriptorDir ddPrefix WAS_BND if websphereBND exists ejbFiles put META_DIR WAS_BND websphereBND else log websphereBND getPath Project MSG_VERBOSE if newCMP log Project MSG_VERBOSE log Project MSG_VERBOSE else try File websphereMAP new File getConfig descriptorDir ddPrefix dbPrefix WAS_CMP_MAP if websphereMAP exists ejbFiles put META_DIR WAS_CMP_MAP websphereMAP else log websphereMAP getPath Project MSG_VERBOSE File websphereSchema new File getConfig descriptorDir ddPrefix dbPrefix WAS_CMP_SCHEMA if websphereSchema exists ejbFiles put META_DIR SCHEMA_DIR WAS_CMP_SCHEMA websphereSchema else log websphereSchema getPath Project MSG_VERBOSE catch Exception String msg toString throw new BuildException msg File getVendorOutputJarFile String baseName return new File getDestDir baseName jarSuffix protected String getOptions StringBuffer options new StringBuffer if dbVendor null options append append dbVendor if dbName null options append append dbName append if dbSchema null options append append dbSchema append if codegen options append if quiet options append if novalidate options append if nowarn options append if noinform options append if trace options append if use35MappingRules options append if rmicOptions null options append append rmicOptions append return options toString private void buildWebsphereJar File sourceJar File destJar try if ejbdeploy Java javaTask new Java getTask javaTask createJvmarg setValue javaTask createJvmarg setValue Environment Variable var new Environment Variable var setKey File libdir new File websphereHome var setValue libdir getAbsolutePath javaTask addSysproperty var javaTask setDir websphereHome javaTask setTaskName javaTask setClassname javaTask createArg setValue sourceJar getPath javaTask createArg setValue tempdir javaTask createArg setValue destJar getPath javaTask createArg setLine getOptions if getCombinedClasspath null getCombinedClasspath toString length javaTask createArg setValue javaTask createArg setValue getCombinedClasspath toString Path classpath wasClasspath if classpath null classpath getCombinedClasspath if classpath null javaTask setClasspath classpath javaTask setFork true else javaTask setFork true log sourceJar toString Project MSG_VERBOSE javaTask execute catch Exception String msg toString throw new BuildException msg protected void writeJar String baseName File jarFile Hashtable files String publicId throws BuildException if ejbdeploy File genericJarFile super getVendorOutputJarFile baseName super writeJar baseName genericJarFile files publicId if alwaysRebuild isRebuildRequired genericJarFile jarFile buildWebsphereJar genericJarFile jarFile if keepGeneric log genericJarFile toString Project MSG_VERBOSE genericJarFile delete else super writeJar baseName jarFile files publicId public void validateConfigured throws BuildException super validateConfigured if ejbdeploy String home getTask getProject getProperty if home null throw new BuildException websphereHome getTask getProject resolveFile home protected boolean isRebuildRequired File genericJarFile File websphereJarFile boolean rebuild false JarFile genericJar null JarFile wasJar null File newwasJarFile null JarOutputStream newJarStream null try log websphereJarFile getName Project MSG_VERBOSE if genericJarFile exists genericJarFile isFile websphereJarFile exists websphereJarFile isFile genericJar new JarFile genericJarFile wasJar new JarFile websphereJarFile Hashtable genericEntries new Hashtable Hashtable wasEntries new Hashtable Hashtable replaceEntries new Hashtable for Enumeration genericJar entries hasMoreElements JarEntry je JarEntry nextElement genericEntries put je getName replace je for Enumeration wasJar entries hasMoreElements JarEntry je JarEntry nextElement wasEntries put je getName je ClassLoader genericLoader getClassLoaderFromJar genericJarFile for Enumeration genericEntries keys hasMoreElements String filepath String nextElement if wasEntries containsKey filepath JarEntry genericEntry JarEntry genericEntries get filepath JarEntry wasEntry JarEntry wasEntries get filepath if genericEntry getCrc wasEntry getCrc genericEntry getSize wasEntry getSize if genericEntry getName endsWith String classname genericEntry getName replace File separatorChar classname classname substring classname lastIndexOf Class genclass genericLoader loadClass classname if genclass isInterface log genclass getName Project MSG_VERBOSE rebuild true break else replaceEntries put filepath genericEntry else if genericEntry getName equals log genericEntry getName Project MSG_VERBOSE rebuild true break else log filepath Project MSG_VERBOSE rebuild true break if rebuild log Project MSG_VERBOSE newwasJarFile new File websphereJarFile getAbsolutePath if newwasJarFile exists newwasJarFile delete newJarStream new JarOutputStream new FileOutputStream newwasJarFile newJarStream setLevel for Enumeration wasEntries elements hasMoreElements byte buffer new byte DEFAULT_BUFFER_SIZE int bytesRead InputStream is JarEntry je JarEntry nextElement if je getCompressedSize je getCompressedSize je getSize newJarStream setLevel else newJarStream setLevel JAR_COMPRESS_LEVEL if replaceEntries containsKey je getName log je getName Project MSG_VERBOSE je JarEntry replaceEntries get je getName is genericJar getInputStream je else is wasJar getInputStream je newJarStream putNextEntry new JarEntry je getName while bytesRead is read buffer newJarStream write buffer bytesRead is close else log Project MSG_VERBOSE else rebuild true catch ClassNotFoundException cnfe String cnfmsg cnfe getMessage throw new BuildException cnfmsg cnfe catch IOException ioe String msg ioe getMessage throw new BuildException msg ioe finally if genericJar null try genericJar close catch IOException closeException if wasJar null try wasJar close catch IOException closeException if newJarStream null try newJarStream close catch IOException closeException try FILE_UTILS rename newwasJarFile websphereJarFile catch IOException renameException log renameException getMessage Project MSG_WARN rebuild true return rebuild protected ClassLoader getClassLoaderFromJar File classjar throws IOException Path lookupPath new Path getTask getProject lookupPath setLocation classjar Path classpath getCombinedClasspath if classpath null lookupPath append classpath return getTask getProject createClassLoader lookupPath public class Basename extends Task private File file private String property private String suffix public void setFile File file this file file public void setProperty String property this property property public void setSuffix String suffix this suffix suffix public void execute throws BuildException if property null throw new BuildException getLocation if file null throw new BuildException getLocation String value file getName if suffix null value endsWith suffix int pos value length suffix length if pos suffix charAt value charAt pos pos value value substring pos getProject setNewProperty property value public class Kaffeh implements JavahAdapter public static final String IMPLEMENTATION_NAME public boolean compile Javah javah throws BuildException Commandline cmd setupKaffehCommand javah try Execute runCommand javah cmd getCommandline return true catch BuildException if getMessage indexOf throw return false private Commandline setupKaffehCommand Javah javah Commandline cmd new Commandline cmd setExecutable JavaEnvUtils getJdkExecutable if javah getDestdir null cmd createArgument setValue cmd createArgument setFile javah getDestdir if javah getOutputfile null cmd createArgument setValue cmd createArgument setFile javah getOutputfile Path cp new Path javah getProject if javah getBootclasspath null cp append javah getBootclasspath cp cp concatSystemBootClasspath if javah getClasspath null cp append javah getClasspath if cp size cmd createArgument setValue cmd createArgument setPath cp if javah getOld cmd createArgument setValue cmd addArguments javah getCurrentArgs javah logAndAddFiles cmd return cmd public class ChainedMapper extends ContainerMapper public String mapFileName String sourceFileName List inputs new ArrayList List results new ArrayList results add sourceFileName FileNameMapper mapper null for Iterator mIter getMappers iterator mIter hasNext mapper FileNameMapper mIter next if mapper null inputs clear inputs addAll results results clear for Iterator it inputs iterator it hasNext String mapped mapper mapFileName String it next if mapped null results addAll Arrays asList mapped return results size null String results toArray new String results size public class CCMCheckout extends CCMCheck public CCMCheckout super setCcmAction COMMAND_CHECKOUT public abstract class BaseResourceCollectionWrapper extends DataType implements ResourceCollection Cloneable private static final String ONE_NESTED_MESSAGE private ResourceCollection rc private Collection coll null private boolean cache true public synchronized void setCache boolean cache public synchronized boolean isCache return cache public synchronized void add ResourceCollection throws BuildException if isReference throw noChildrenAllowed if null return if rc null throw oneNested rc setChecked false public final synchronized Iterator iterator if isReference return BaseResourceCollectionWrapper getCheckedRef iterator dieOnCircularReference return new FailFast this cacheCollection iterator public synchronized int size if isReference return BaseResourceCollectionWrapper getCheckedRef size dieOnCircularReference return cacheCollection size public synchronized boolean isFilesystemOnly if isReference return BaseResourceCollectionContainer getCheckedRef isFilesystemOnly dieOnCircularReference if rc null rc isFilesystemOnly return true for Iterator cacheCollection iterator hasNext if next instanceof FileResource return false return true protected synchronized void dieOnCircularReference Stack stk Project throws BuildException if isChecked return if isReference super dieOnCircularReference stk else if rc instanceof DataType stk push rc invokeCircularReferenceCheck DataType rc stk stk pop setChecked true protected final synchronized ResourceCollection getResourceCollection dieOnCircularReference if rc null throw oneNested return rc protected abstract Collection getCollection public synchronized String toString if isReference return getCheckedRef toString if cacheCollection size return StringBuffer sb new StringBuffer for Iterator coll iterator hasNext if sb length sb append File pathSeparatorChar sb append next return sb toString private synchronized Collection cacheCollection if coll null isCache coll getCollection return coll private BuildException oneNested return new BuildException super toString ONE_NESTED_MESSAGE public class BUnzip2 extends Unpack private static final String DEFAULT_EXTENSION protected String getDefaultExtension return DEFAULT_EXTENSION protected void extract if source lastModified dest lastModified log source getAbsolutePath dest getAbsolutePath FileOutputStream out null CBZip2InputStream zIn null InputStream fis null BufferedInputStream bis null try out new FileOutputStream dest fis srcResource getInputStream bis new BufferedInputStream fis int bis read if throw new BuildException getLocation bis read if throw new BuildException getLocation zIn new CBZip2InputStream bis byte buffer new byte int count do out write buffer count count zIn read buffer buffer length while count catch IOException ioe String msg ioe getMessage throw new BuildException msg ioe getLocation finally FileUtils close bis FileUtils close fis FileUtils close out FileUtils close zIn protected boolean supportsNonFileResources return getClass equals BUnzip2 class public class Base64Converter private static final char ALPHABET public static final char alphabet ALPHABET public String encode String return encode getBytes public String encode byte octetString int bits24 int bits6 char out new char octetString length int outIndex int while octetString length bits24 octetString bits24 octetString bits24 octetString bits6 bits24 out outIndex ALPHABET bits6 bits6 bits24 out outIndex ALPHABET bits6 bits6 bits24 out outIndex ALPHABET bits6 bits6 bits24 out outIndex ALPHABET bits6 if octetString length bits24 octetString bits24 octetString bits6 bits24 out outIndex ALPHABET bits6 bits6 bits24 out outIndex ALPHABET bits6 bits6 bits24 out outIndex ALPHABET bits6 out outIndex else if octetString length bits24 octetString bits6 bits24 out outIndex ALPHABET bits6 bits6 bits24 out outIndex ALPHABET bits6 out outIndex out outIndex return new String out public abstract class AbstractSshMessage private Session session private boolean verbose private LogListener listener new LogListener public void log String message public AbstractSshMessage Session session this false session public AbstractSshMessage boolean verbose Session session this verbose verbose this session session protected Channel openExecChannel String command throws JSchException ChannelExec channel ChannelExec session openChannel channel setCommand command return channel protected ChannelSftp openSftpChannel throws JSchException ChannelSftp channel ChannelSftp session openChannel return channel protected void sendAck OutputStream out throws IOException byte buf new byte buf out write buf out flush protected void waitForAck InputStream in throws IOException BuildException int in read if throw new BuildException else if StringBuffer sb new StringBuffer int in read while sb append char in read if throw new BuildException sb toString else if throw new BuildException sb toString else throw new BuildException sb toString public abstract void execute throws IOException JSchException public void setLogListener LogListener aListener listener aListener protected void log String message listener log message protected void logStats long timeStarted long timeEnded long totalLength double duration timeEnded timeStarted NumberFormat format NumberFormat getNumberInstance format setMaximumFractionDigits format setMinimumFractionDigits listener log format format duration format format totalLength duration protected final boolean getVerbose return verbose protected final int trackProgress long filesize long totalLength int percentTransmitted int percent int Math round Math floor totalLength double filesize if percent percentTransmitted if filesize if percent if percent System out println else System out print else if percent System out println else if percent System out println else System out print return percent private ProgressMonitor monitor null protected SftpProgressMonitor getProgressMonitor if monitor null monitor new ProgressMonitor return monitor private class ProgressMonitor implements SftpProgressMonitor private long initFileSize private long totalLength private int percentTransmitted public void init int op String src String dest long max initFileSize max totalLength percentTransmitted public boolean count long len totalLength len percentTransmitted trackProgress initFileSize totalLength percentTransmitted return true public void end public long getTotalLength return totalLength public class Majority extends ResourceSelectorContainer implements ResourceSelector private boolean tie true public Majority public Majority ResourceSelector super public synchronized void setAllowtie boolean tie public synchronized boolean isSelected Resource int passed int failed int count selectorCount boolean even count int threshold count for Iterator getSelectors hasNext if ResourceSelector next isSelected passed if passed threshold even tie passed threshold return true else failed if failed threshold even tie failed threshold return false return false public class FixCRLF extends MatchingTask implements ChainableReader public static final String ERROR_FILE_AND_SRCDIR private static final FileUtils FILE_UTILS FileUtils getFileUtils private boolean preserveLastModified false private File srcDir private File destDir null private File file private FixCrLfFilter filter new FixCrLfFilter private Vector fcv null private String encoding null private String outputEncoding null public final Reader chain final Reader rdr return filter chain rdr public void setSrcdir File srcDir this srcDir srcDir public void setDestdir File destDir this destDir destDir public void setJavafiles boolean javafiles filter setJavafiles javafiles public void setFile File file this file file public void setEol CrLf attr filter setEol FixCrLfFilter CrLf newInstance attr getValue public void setCr AddAsisRemove attr log Project MSG_WARN log Project MSG_WARN String option attr getValue CrLf new CrLf if option equals setValue else if option equals setValue else setValue setEol public void setTab AddAsisRemove attr filter setTab FixCrLfFilter AddAsisRemove newInstance attr getValue public void setTablength int tlength throws BuildException try filter setTablength tlength catch IOException throw new BuildException public void setEof AddAsisRemove attr filter setEof FixCrLfFilter AddAsisRemove newInstance attr getValue public void setEncoding String encoding this encoding encoding public void setOutputEncoding String outputEncoding this outputEncoding outputEncoding public void setFixlast boolean fixlast filter setFixlast fixlast public void setPreserveLastModified boolean preserve preserveLastModified preserve public void execute throws BuildException validate String enc encoding null encoding log filter getEol getValue filter getTab getValue filter getEof getValue filter getTablength enc outputEncoding null enc outputEncoding Project MSG_VERBOSE DirectoryScanner ds super getDirectoryScanner srcDir String files ds getIncludedFiles for int files length processFile files private void validate throws BuildException if file null if srcDir null throw new BuildException ERROR_FILE_AND_SRCDIR fileset setFile file srcDir file getParentFile if srcDir null throw new BuildException if srcDir exists throw new BuildException if srcDir isDirectory throw new BuildException if destDir null if destDir exists throw new BuildException if destDir isDirectory throw new BuildException private void processFile String file throws BuildException File srcFile new File srcDir file long lastModified srcFile lastModified File destD destDir null srcDir destDir if fcv null FilterChain fc new FilterChain fc add filter fcv new Vector fcv add fc File tmpFile FILE_UTILS createTempFile null tmpFile deleteOnExit try FILE_UTILS copyFile srcFile tmpFile null fcv false false encoding outputEncoding null encoding outputEncoding getProject File destFile new File destD file boolean destIsWrong true if destFile exists log Project MSG_DEBUG destIsWrong FILE_UTILS contentEquals destFile tmpFile log destFile destIsWrong Project MSG_DEBUG if destIsWrong FILE_UTILS rename tmpFile destFile if preserveLastModified log Project MSG_DEBUG FILE_UTILS setFileLastModified destFile lastModified tmpFile null catch IOException throw new BuildException protected class OneLiner implements Enumeration private static final int UNDEF private static final int NOTJAVA private static final int LOOKING private static final int INBUFLEN private static final int LINEBUFLEN private static final char CTRLZ private int state filter getJavafiles LOOKING NOTJAVA private StringBuffer eolStr new StringBuffer LINEBUFLEN private StringBuffer eofStr new StringBuffer private BufferedReader reader private StringBuffer line new StringBuffer private boolean reachedEof false private File srcFile public OneLiner File srcFile throws BuildException this srcFile srcFile try reader new BufferedReader encoding null new FileReader srcFile new InputStreamReader new FileInputStream srcFile encoding INBUFLEN nextLine catch IOException throw new BuildException srcFile getMessage getLocation protected void nextLine throws BuildException int ch int eolcount eolStr new StringBuffer line new StringBuffer try ch reader read while ch ch ch line append char ch ch reader read if ch line length reachedEof true return switch char ch case eolcount eolStr append reader mark ch reader read switch ch case ch reader read if char ch eolcount eolStr append else reader reset break case eolcount eolStr append break case break default reader reset break break case eolcount eolStr append break default if eolcount int line length while line charAt CTRLZ if line length eofStr append line toString substring if line setLength reachedEof true else line setLength catch IOException throw new BuildException srcFile getMessage getLocation public String getEofStr return eofStr substring public int getState return state public void setState int state this state state public boolean hasMoreElements return reachedEof public Object nextElement throws NoSuchElementException if hasMoreElements throw new NoSuchElementException BufferLine tmpLine new BufferLine line toString eolStr substring nextLine return tmpLine public void close throws IOException if reader null reader close class BufferLine private int next private int column private int lookahead UNDEF private String line private String eolStr public BufferLine String line String eolStr throws BuildException next column this line line this eolStr eolStr public int getNext return next public void setNext int next this next next public int getLookahead return lookahead public void setLookahead int lookahead this lookahead lookahead public char getChar int return line charAt public char getNextChar return getChar next public char getNextCharInc return getChar next public int getColumn return column public void setColumn int col column col public int incColumn return column public int length return line length public int getEolLength return eolStr length public String getLineString return line public String getEol return eolStr public String substring int begin return line substring begin public String substring int begin int end return line substring begin end public void setState int state OneLiner this setState state public int getState return OneLiner this getState public static class AddAsisRemove extends EnumeratedAttribute public String getValues return new String public static class CrLf extends EnumeratedAttribute public String getValues return new String public interface HotDeploymentTool String ACTION_DELETE String ACTION_DEPLOY String ACTION_LIST String ACTION_UNDEPLOY String ACTION_UPDATE void validateAttributes throws BuildException void deploy throws BuildException void setTask ServerDeploy task public class Intersect extends BaseResourceCollectionContainer protected Collection getCollection List rcs getResourceCollections int size rcs size if size throw new BuildException size size ArrayList al new ArrayList Iterator rc rcs iterator al addAll collect rc next while rc hasNext al retainAll collect rc next return al private ArrayList collect Object ArrayList result new ArrayList for Iterator ResourceCollection iterator hasNext result add next return result public class Javac extends MatchingTask private static final String FAIL_MSG private static final String JAVAC16 private static final String JAVAC15 private static final String JAVAC14 private static final String JAVAC13 private static final String JAVAC12 private static final String JAVAC11 private static final String MODERN private static final String CLASSIC private static final String EXTJAVAC private Path src private File destDir private Path compileClasspath private Path compileSourcepath private String encoding private boolean debug false private boolean optimize false private boolean deprecation false private boolean depend false private boolean verbose false private String targetAttribute private Path bootclasspath private Path extdirs private boolean includeAntRuntime true private boolean includeJavaRuntime false private boolean fork false private String forkedExecutable null private boolean nowarn false private String memoryInitialSize private String memoryMaximumSize private FacadeTaskHelper facade null protected boolean failOnError true protected boolean listFiles false protected File compileList new File private String source private String debugLevel private File tmpDir public Javac facade new FacadeTaskHelper assumedJavaVersion private String assumedJavaVersion if JavaEnvUtils isJavaVersion JavaEnvUtils JAVA_1_2 return JAVAC12 else if JavaEnvUtils isJavaVersion JavaEnvUtils JAVA_1_3 return JAVAC13 else if JavaEnvUtils isJavaVersion JavaEnvUtils JAVA_1_4 return JAVAC14 else if JavaEnvUtils isJavaVersion JavaEnvUtils JAVA_1_5 return JAVAC15 else if JavaEnvUtils isJavaVersion JavaEnvUtils JAVA_1_6 return JAVAC16 else return CLASSIC public String getDebugLevel return debugLevel public void setDebugLevel String this debugLevel public String getSource return source null source getProject getProperty MagicNames BUILD_JAVAC_SOURCE public void setSource String this source public Path createSrc if src null src new Path getProject return src createPath protected Path recreateSrc src null return createSrc public void setSrcdir Path srcDir if src null src srcDir else src append srcDir public Path getSrcdir return src public void setDestdir File destDir this destDir destDir public File getDestdir return destDir public void setSourcepath Path sourcepath if compileSourcepath null compileSourcepath sourcepath else compileSourcepath append sourcepath public Path getSourcepath return compileSourcepath public Path createSourcepath if compileSourcepath null compileSourcepath new Path getProject return compileSourcepath createPath public void setSourcepathRef Reference createSourcepath setRefid public void setClasspath Path classpath if compileClasspath null compileClasspath classpath else compileClasspath append classpath public Path getClasspath return compileClasspath public Path createClasspath if compileClasspath null compileClasspath new Path getProject return compileClasspath createPath public void setClasspathRef Reference createClasspath setRefid public void setBootclasspath Path bootclasspath if this bootclasspath null this bootclasspath bootclasspath else this bootclasspath append bootclasspath public Path getBootclasspath return bootclasspath public Path createBootclasspath if bootclasspath null bootclasspath new Path getProject return bootclasspath createPath public void setBootClasspathRef Reference createBootclasspath setRefid public void setExtdirs Path extdirs if this extdirs null this extdirs extdirs else this extdirs append extdirs public Path getExtdirs return extdirs public Path createExtdirs if extdirs null extdirs new Path getProject return extdirs createPath public void setListfiles boolean list listFiles list public boolean getListfiles return listFiles public void setFailonerror boolean fail failOnError fail public void setProceed boolean proceed failOnError proceed public boolean getFailonerror return failOnError public void setDeprecation boolean deprecation this deprecation deprecation public boolean getDeprecation return deprecation public void setMemoryInitialSize String memoryInitialSize this memoryInitialSize memoryInitialSize public String getMemoryInitialSize return memoryInitialSize public void setMemoryMaximumSize String memoryMaximumSize this memoryMaximumSize memoryMaximumSize public String getMemoryMaximumSize return memoryMaximumSize public void setEncoding String encoding this encoding encoding public String getEncoding return encoding public void setDebug boolean debug this debug debug public boolean getDebug return debug public void setOptimize boolean optimize this optimize optimize public boolean getOptimize return optimize public void setDepend boolean depend this depend depend public boolean getDepend return depend public void setVerbose boolean verbose this verbose verbose public boolean getVerbose return verbose public void setTarget String target this targetAttribute target public String getTarget return targetAttribute null targetAttribute getProject getProperty MagicNames BUILD_JAVAC_TARGET public void setIncludeantruntime boolean include includeAntRuntime include public boolean getIncludeantruntime return includeAntRuntime public void setIncludejavaruntime boolean include includeJavaRuntime include public boolean getIncludejavaruntime return includeJavaRuntime public void setFork boolean fork public void setExecutable String forkExec forkedExecutable forkExec public String getExecutable return forkedExecutable public boolean isForkedJavac return fork equals getCompiler public String getJavacExecutable if forkedExecutable null isForkedJavac forkedExecutable getSystemJavac else if forkedExecutable null isForkedJavac forkedExecutable null return forkedExecutable public void setNowarn boolean flag this nowarn flag public boolean getNowarn return nowarn public ImplementationSpecificArgument createCompilerArg ImplementationSpecificArgument arg new ImplementationSpecificArgument facade addImplementationArgument arg return arg public String getCurrentCompilerArgs String chosen facade getExplicitChoice try String appliedCompiler getCompiler facade setImplementation appliedCompiler String result facade getArgs String altCompilerName getAltCompilerName facade getImplementation if result length altCompilerName null facade setImplementation altCompilerName result facade getArgs return result finally facade setImplementation chosen private String getAltCompilerName String anImplementation if JAVAC16 equalsIgnoreCase anImplementation JAVAC15 equalsIgnoreCase anImplementation JAVAC14 equalsIgnoreCase anImplementation JAVAC13 equalsIgnoreCase anImplementation return MODERN if JAVAC12 equalsIgnoreCase anImplementation JAVAC11 equalsIgnoreCase anImplementation return CLASSIC if MODERN equalsIgnoreCase anImplementation String nextSelected assumedJavaVersion if JAVAC16 equalsIgnoreCase nextSelected JAVAC15 equalsIgnoreCase nextSelected JAVAC14 equalsIgnoreCase nextSelected JAVAC13 equalsIgnoreCase nextSelected return nextSelected if CLASSIC equals anImplementation return assumedJavaVersion if EXTJAVAC equalsIgnoreCase anImplementation return assumedJavaVersion return null public void setTempdir File tmpDir this tmpDir tmpDir public File getTempdir return tmpDir public void execute throws BuildException checkParameters resetFileLists String list src list for int list length File srcDir getProject resolveFile list if srcDir exists throw new BuildException srcDir getPath getLocation DirectoryScanner ds this getDirectoryScanner srcDir String files ds getIncludedFiles scanDir srcDir destDir null destDir srcDir files compile protected void resetFileLists compileList new File protected void scanDir File srcDir File destDir String files GlobPatternMapper new GlobPatternMapper setFrom setTo SourceFileScanner sfs new SourceFileScanner this File newFiles sfs restrictAsFiles files srcDir destDir if newFiles length File newCompileList new File compileList length newFiles length System arraycopy compileList newCompileList compileList length System arraycopy newFiles newCompileList compileList length newFiles length compileList newCompileList public File getFileList return compileList protected boolean isJdkCompiler String compilerImpl return MODERN equals compilerImpl CLASSIC equals compilerImpl JAVAC16 equals compilerImpl JAVAC15 equals compilerImpl JAVAC14 equals compilerImpl JAVAC13 equals compilerImpl JAVAC12 equals compilerImpl JAVAC11 equals compilerImpl protected String getSystemJavac return JavaEnvUtils getJdkExecutable public void setCompiler String compiler facade setImplementation compiler public String getCompiler String compilerImpl getCompilerVersion if fork if isJdkCompiler compilerImpl compilerImpl else log Project MSG_WARN return compilerImpl public String getCompilerVersion facade setMagicValue getProject getProperty return facade getImplementation protected void checkParameters throws BuildException if src null throw new BuildException getLocation if src size throw new BuildException getLocation if destDir null destDir isDirectory throw new BuildException destDir getLocation protected void compile String compilerImpl getCompiler if compileList length log compileList length compileList length destDir null destDir if listFiles for int compileList length String filename compileList getAbsolutePath log filename CompilerAdapter adapter CompilerAdapterFactory getCompiler compilerImpl this adapter setJavac this if adapter execute if failOnError throw new BuildException FAIL_MSG getLocation else log FAIL_MSG Project MSG_ERR public class ImplementationSpecificArgument extends org apache tools ant util facade ImplementationSpecificArgument public void setCompiler String impl super setImplementation impl public interface Touchable void touch long modTime public class LocationResolver implements ExtensionResolver private String location public void setLocation final String location this location location public File resolve final Extension extension final Project project throws BuildException if null location final String message throw new BuildException message return project resolveFile location public String toString return location public class SOSGet extends SOS public final void setFile String filename super setInternalFilename filename public void setRecursive boolean recursive super setInternalRecursive recursive public void setVersion String version super setInternalVersion version public void setLabel String label super setInternalLabel label protected Commandline buildCmdLine commandLine new Commandline if getFilename null commandLine createArgument setValue SOSCmd FLAG_COMMAND commandLine createArgument setValue SOSCmd COMMAND_GET_FILE commandLine createArgument setValue SOSCmd FLAG_FILE commandLine createArgument setValue getFilename if getVersion null commandLine createArgument setValue SOSCmd FLAG_VERSION commandLine createArgument setValue getVersion else commandLine createArgument setValue SOSCmd FLAG_COMMAND commandLine createArgument setValue SOSCmd COMMAND_GET_PROJECT commandLine createArgument setValue getRecursive if getLabel null commandLine createArgument setValue SOSCmd FLAG_LABEL commandLine createArgument setValue getLabel getRequiredAttributes getOptionalAttributes return commandLine public abstract class ArchiveScanner extends DirectoryScanner protected File srcFile private Resource src private Resource lastScannedResource private TreeMap fileEntries new TreeMap private TreeMap dirEntries new TreeMap private TreeMap matchFileEntries new TreeMap private TreeMap matchDirEntries new TreeMap private String encoding public void scan if src null return super scan public void setSrc File srcFile setSrc new FileResource srcFile public void setSrc Resource src this src src if src instanceof FileResource srcFile FileResource src getFile public void setEncoding String encoding this encoding encoding public String getIncludedFiles if src null return super getIncludedFiles scanme Set matchFileEntries keySet return String toArray new String size public int getIncludedFilesCount if src null return super getIncludedFilesCount scanme return matchFileEntries size public String getIncludedDirectories if src null return super getIncludedDirectories scanme Set matchDirEntries keySet return String toArray new String size public int getIncludedDirsCount if src null return super getIncludedDirsCount scanme return matchDirEntries size if src null return new FileResourceIterator getBasedir getIncludedFiles scanme return matchFileEntries values iterator if src null return new FileResourceIterator getBasedir getIncludedDirectories scanme return matchDirEntries values iterator public void init if includes null includes new String includes if excludes null excludes new String public boolean match String path String vpath path replace File separatorChar replace File separatorChar return isIncluded vpath isExcluded vpath public Resource getResource String name if src null return super getResource name if name equals return new Resource true Long MAX_VALUE true scanme if fileEntries containsKey name return Resource fileEntries get name name trimSeparator name if dirEntries containsKey name return Resource dirEntries get name return new Resource name protected abstract void fillMapsFromArchive Resource archive String encoding Map fileEntries Map matchFileEntries Map dirEntries Map matchDirEntries private void scanme Resource thisresource new Resource src getName src isExists src getLastModified if lastScannedResource null lastScannedResource getName equals thisresource getName lastScannedResource getLastModified thisresource getLastModified return init fileEntries clear dirEntries clear matchFileEntries clear matchDirEntries clear fillMapsFromArchive src encoding fileEntries matchFileEntries dirEntries matchDirEntries lastScannedResource thisresource protected static final String trimSeparator String return endsWith substring length public class Utf8CPInfo extends ConstantPoolEntry private String value public Utf8CPInfo super CONSTANT_UTF8 public void read DataInputStream cpStream throws IOException value cpStream readUTF public String toString return value public String getValue return value public class JavaResource extends Resource private Path classpath private Reference loader public JavaResource public JavaResource String name Path path setName name classpath path public void setClasspath Path classpath checkAttributesAllowed if this classpath null this classpath classpath else this classpath append classpath public Path createClasspath checkChildrenAllowed if this classpath null this classpath new Path getProject return this classpath createPath public void setClasspathRef Reference checkAttributesAllowed createClasspath setRefid public Path getClasspath return isReference JavaResource getCheckedRef getClasspath classpath public void setLoaderRef Reference checkAttributesAllowed loader public void setRefid Reference if loader null classpath null throw tooManyAttributes super setRefid public boolean isExists InputStream is null try return isReference Resource getCheckedRef isExists is getInputStream null catch IOException ex return false finally FileUtils close is public InputStream getInputStream throws IOException if isReference return Resource getCheckedRef getInputStream ClassLoader cl null if loader null cl ClassLoader loader getReferencedObject if cl null if getClasspath null cl getProject createClassLoader classpath else cl JavaResource class getClassLoader if loader null cl null getProject addReference loader getRefId cl return cl null ClassLoader getSystemResourceAsStream getName cl getResourceAsStream getName public int compareTo Object another if isReference return Comparable getCheckedRef compareTo another if another getClass equals getClass JavaResource otherjr JavaResource another if getName equals otherjr getName return getName compareTo otherjr getName if loader otherjr loader if loader null return if otherjr loader null return return loader getRefId compareTo otherjr loader getRefId Path getClasspath Path op otherjr getClasspath if op if null return if op null return return toString compareTo op toString return return super compareTo another public class IPlanetDeploymentTool extends GenericDeploymentTool private File iashome private String jarSuffix private boolean keepgenerated false private boolean debug false private String descriptorName private String iasDescriptorName private String displayName private static final String IAS_DD public void setIashome File iashome this iashome iashome public void setKeepgenerated boolean keepgenerated this keepgenerated keepgenerated public void setDebug boolean debug this debug debug public void setSuffix String jarSuffix this jarSuffix jarSuffix public void setGenericJarSuffix String inString log Project MSG_WARN public void processDescriptor String descriptorName SAXParser saxParser this descriptorName descriptorName this iasDescriptorName null log descriptorName getIasDescriptorName Project MSG_VERBOSE super processDescriptor descriptorName saxParser protected void checkConfiguration String descriptorFileName SAXParser saxParser throws BuildException int startOfName descriptorFileName lastIndexOf File separatorChar String stdXml descriptorFileName substring startOfName if stdXml equals EJB_DD getConfig baseJarName null String msg throw new BuildException msg getLocation File iasDescriptor new File getConfig descriptorDir getIasDescriptorName if iasDescriptor exists iasDescriptor isFile String msg iasDescriptor throw new BuildException msg getLocation if iashome null iashome isDirectory String msg iashome throw new BuildException msg getLocation protected Hashtable parseEjbFiles String descriptorFileName SAXParser saxParser throws IOException SAXException Hashtable files IPlanetEjbc ejbc new IPlanetEjbc new File getConfig descriptorDir descriptorFileName new File getConfig descriptorDir getIasDescriptorName getConfig srcDir getCombinedClasspath toString saxParser ejbc setRetainSource keepgenerated ejbc setDebugOutput debug if iashome null ejbc setIasHomeDir iashome try ejbc execute catch IPlanetEjbc EjbcException throw new BuildException getLocation displayName ejbc getDisplayName files ejbc getEjbFiles String cmpDescriptors ejbc getCmpDescriptors if cmpDescriptors length File baseDir getConfig descriptorDir int endOfPath descriptorFileName lastIndexOf File separator String relativePath descriptorFileName substring endOfPath for int cmpDescriptors length int endOfCmp cmpDescriptors lastIndexOf String cmpDescriptor cmpDescriptors substring endOfCmp File cmpFile new File baseDir relativePath cmpDescriptor if cmpFile exists throw new BuildException cmpFile getLocation files put cmpDescriptors cmpFile return files protected void addVendorFiles Hashtable ejbFiles String ddPrefix ejbFiles put META_DIR IAS_DD new File getConfig descriptorDir getIasDescriptorName File getVendorOutputJarFile String baseName File jarFile new File getDestDir baseName jarSuffix log jarFile toString Project MSG_VERBOSE return jarFile protected String getPublicId return null private String getIasDescriptorName if iasDescriptorName null return iasDescriptorName int startOfFileName descriptorName lastIndexOf File separatorChar if startOfFileName path descriptorName substring startOfFileName if descriptorName substring startOfFileName equals EJB_DD basename remainder EJB_DD else int endOfBaseName descriptorName indexOf getConfig baseNameTerminator startOfFileName if endOfBaseName endOfBaseName descriptorName lastIndexOf if endOfBaseName endOfBaseName descriptorName length basename descriptorName substring startOfFileName endOfBaseName remainder descriptorName substring endOfBaseName iasDescriptorName path basename remainder return iasDescriptorName public interface SelectorContainer boolean hasSelectors int selectorCount FileSelector getSelectors Project Enumeration selectorElements void appendSelector FileSelector selector void addSelector SelectSelector selector void addAnd AndSelector selector void addOr OrSelector selector void addNot NotSelector selector void addNone NoneSelector selector void addMajority MajoritySelector selector void addDate DateSelector selector void addSize SizeSelector selector void addFilename FilenameSelector selector void addCustom ExtendSelector selector void addContains ContainsSelector selector void addPresent PresentSelector selector void addDepth DepthSelector selector void addDepend DependSelector selector void addContainsRegexp ContainsRegexpSelector selector void addType TypeSelector selector void addDifferent DifferentSelector selector void addModified ModifiedSelector selector void add FileSelector selector public class MimeMailer extends Mailer private static final String SSL_FACTORY private static final String DEFAULT_CHARSET System getProperty class StringDataSource implements javax activation DataSource private String data null private String type null private String charset null private ByteArrayOutputStream out public InputStream getInputStream throws IOException if data null out null throw new IOException if out null String encodedOut out toString charset data data null data concat encodedOut encodedOut out null return new ByteArrayInputStream data getBytes charset public OutputStream getOutputStream throws IOException out out null new ByteArrayOutputStream out return out public void setContentType String type this type type toLowerCase public String getContentType if type null type indexOf type startsWith return type return new StringBuffer type null type append append charset toString public String getName return public void setCharset String charset this charset charset public String getCharset return charset public void send try Properties props new Properties props put host props put String valueOf port Session sesh Authenticator auth if SSL try Provider Provider Class forName newInstance Security addProvider catch Exception throw new BuildException props put SSL_FACTORY props put if user null password null sesh Session getDefaultInstance props null else props put auth new SimpleAuthenticator user password sesh Session getInstance props auth MimeMessage msg new MimeMessage sesh MimeMultipart attachments new MimeMultipart if from getName null msg setFrom new InternetAddress from getAddress else msg setFrom new InternetAddress from getAddress from getName msg setReplyTo internetAddresses replyToList msg setRecipients Message RecipientType TO internetAddresses toList msg setRecipients Message RecipientType CC internetAddresses ccList msg setRecipients Message RecipientType BCC internetAddresses bccList String charset parseCharSetFromMimeType message getMimeType if charset null message setCharset charset else charset message getCharset if charset null charset DEFAULT_CHARSET message setCharset charset StringDataSource sds new StringDataSource sds setContentType message getMimeType sds setCharset charset if subject null msg setSubject subject charset msg addHeader getDate for Iterator iter headers iterator iter hasNext Header Header iter next msg addHeader getName getValue PrintStream out new PrintStream sds getOutputStream message print out out close MimeBodyPart textbody new MimeBodyPart textbody setDataHandler new DataHandler sds attachments addBodyPart textbody Enumeration files elements while hasMoreElements File file File nextElement MimeBodyPart body body new MimeBodyPart if file exists file canRead throw new BuildException file getAbsolutePath FileDataSource fileData new FileDataSource file DataHandler fileDataHandler new DataHandler fileData body setDataHandler fileDataHandler body setFileName file getName attachments addBodyPart body msg setContent attachments Transport send msg catch MessagingException throw new BuildException catch IOException throw new BuildException private static InternetAddress internetAddresses Vector list throws AddressException UnsupportedEncodingException InternetAddress addrs new InternetAddress list size for int list size EmailAddress addr EmailAddress list elementAt String name addr getName addrs name null new InternetAddress addr getAddress new InternetAddress addr getAddress name return addrs private String parseCharSetFromMimeType String type int pos if type null pos type indexOf return null StringTokenizer token new StringTokenizer type substring pos return token nextToken static class SimpleAuthenticator extends Authenticator private String user null private String password null public SimpleAuthenticator String user String password this user user this password password public PasswordAuthentication getPasswordAuthentication return new PasswordAuthentication user password public class Directory private File directory private ArrayList childDirectories private ArrayList files private Directory parent public Directory File directory this directory null public Directory File directory Directory parent this parent parent this childDirectories new ArrayList this files new ArrayList this directory directory public void addDirectory Directory directory if childDirectories contains directory childDirectories add directory public void addFile File file files add file public Iterator directoryIterator return childDirectories iterator public Iterator filesIterator return files iterator public Directory getParent return parent public boolean isRoot return parent null public File getDirectory return directory public Directory getChild File dir for int childDirectories size Directory current Directory childDirectories get if current getDirectory equals dir return current return null public boolean equals Object obj if obj this return true if obj instanceof Directory return false Directory Directory obj return this directory equals directory public int hashCode return directory hashCode public String getPath return getPath directory getAbsolutePath public static String getPath String thePath StringTokenizer tokenizer new StringTokenizer thePath File separator String path new String tokenizer countTokens int while tokenizer hasMoreTokens path tokenizer nextToken return path public int fileSize return files size public class FilterSetCollection private Vector filterSets new Vector public FilterSetCollection public FilterSetCollection FilterSet filterSet addFilterSet filterSet public void addFilterSet FilterSet filterSet filterSets addElement filterSet public String replaceTokens String line String replacedLine line for Enumeration filterSets elements hasMoreElements FilterSet filterSet FilterSet nextElement replacedLine filterSet replaceTokens replacedLine return replacedLine public boolean hasFilters for Enumeration filterSets elements hasMoreElements FilterSet filterSet FilterSet nextElement if filterSet hasFilters return true return false public class DirectoryIterator implements ClassFileIterator private Stack enumStack private Enumeration currentEnum public DirectoryIterator File rootDirectory boolean changeInto throws IOException super enumStack new Stack Vector filesInRoot getDirectoryEntries rootDirectory currentEnum filesInRoot elements private Vector getDirectoryEntries File directory Vector files new Vector String filesInDir directory list if filesInDir null int length filesInDir length for int length files addElement new File directory filesInDir return files public ClassFile getNextClassFile ClassFile nextElement null try while nextElement null if currentEnum hasMoreElements File element File currentEnum nextElement if element isDirectory enumStack push currentEnum Vector files getDirectoryEntries element currentEnum files elements else FileInputStream inFileStream new FileInputStream element if element getName endsWith ClassFile javaClass new ClassFile javaClass read inFileStream nextElement javaClass else if enumStack empty break else currentEnum Enumeration enumStack pop catch IOException nextElement null return nextElement public class IsSigned extends DataType implements Condition private static final String SIG_START private static final String SIG_END private static final int SHORT_SIG_LIMIT private String name private File file public void setFile File file this file file public void setName String name this name name public static boolean isSigned File zipFile String name throws IOException ZipFile jarFile null try jarFile new ZipFile zipFile if null name Enumeration entries jarFile getEntries while entries hasMoreElements String eName ZipEntry entries nextElement getName if eName startsWith SIG_START eName endsWith SIG_END return true return false boolean shortSig jarFile getEntry SIG_START name toUpperCase SIG_END null boolean longSig false if name length SHORT_SIG_LIMIT longSig jarFile getEntry SIG_START name substring SHORT_SIG_LIMIT toUpperCase SIG_END null return shortSig longSig finally ZipFile closeQuietly jarFile public boolean eval if file null throw new BuildException if file null file exists log file getAbsolutePath Project MSG_VERBOSE return false boolean false try isSigned file name catch IOException log file getAbsolutePath Project MSG_WARN if log file getAbsolutePath Project MSG_VERBOSE return public class CvsVersion extends AbstractCvsTask static final long VERSION_1_11_2 static final long MULTIPLY private String clientVersion private String serverVersion private String clientVersionProperty private String serverVersionProperty public String getClientVersion return clientVersion public String getServerVersion return serverVersion public void setClientVersionProperty String clientVersionProperty this clientVersionProperty clientVersionProperty public void setServerVersionProperty String serverVersionProperty this serverVersionProperty serverVersionProperty public boolean supportsCvsLogWithSOption if serverVersion null return false StringTokenizer tokenizer new StringTokenizer serverVersion long counter MULTIPLY MULTIPLY long version while tokenizer hasMoreTokens String tokenizer nextToken int for length if Character isDigit charAt break String s2 substring version version counter Long parseLong s2 if counter break counter counter MULTIPLY return version VERSION_1_11_2 public void execute ByteArrayOutputStream bos new ByteArrayOutputStream this setOutputStream bos ByteArrayOutputStream berr new ByteArrayOutputStream this setErrorStream berr setCommand super execute String output bos toString StringTokenizer st new StringTokenizer output boolean client false boolean server false boolean cvs false while st hasMoreTokens String currentToken st nextToken if currentToken equals client true else if currentToken equals server true else if currentToken equals cvs true if client cvs if st hasMoreTokens clientVersion st nextToken client false cvs false else if server cvs if st hasMoreTokens serverVersion st nextToken server false cvs false if clientVersionProperty null getProject setNewProperty clientVersionProperty clientVersion if serverVersionProperty null getProject setNewProperty serverVersionProperty serverVersion public class ConstantPool private Vector entries private Hashtable utf8Indexes public ConstantPool entries new Vector entries addElement null utf8Indexes new Hashtable public void read DataInputStream classStream throws IOException int numEntries classStream readUnsignedShort for int numEntries ConstantPoolEntry nextEntry ConstantPoolEntry readEntry classStream nextEntry getNumEntries addEntry nextEntry public int size return entries size public int addEntry ConstantPoolEntry entry int index entries size entries addElement entry int numSlots entry getNumEntries for int numSlots entries addElement null if entry instanceof Utf8CPInfo Utf8CPInfo utf8Info Utf8CPInfo entry utf8Indexes put utf8Info getValue new Integer index return index public void resolve for Enumeration entries elements hasMoreElements ConstantPoolEntry poolInfo ConstantPoolEntry nextElement if poolInfo null poolInfo isResolved poolInfo resolve this public ConstantPoolEntry getEntry int index return ConstantPoolEntry entries elementAt index public int getUTF8Entry String value int index Integer indexInteger Integer utf8Indexes get value if indexInteger null index indexInteger intValue return index public int getClassEntry String className int index for int entries size index Object element entries elementAt if element instanceof ClassCPInfo ClassCPInfo classinfo ClassCPInfo element if classinfo getClassName equals className index return index public int getConstantEntry Object constantValue int index for int entries size index Object element entries elementAt if element instanceof ConstantCPInfo ConstantCPInfo constantEntry ConstantCPInfo element if constantEntry getValue equals constantValue index return index public int getMethodRefEntry String methodClassName String methodName String methodType int index for int entries size index Object element entries elementAt if element instanceof MethodRefCPInfo MethodRefCPInfo methodRefEntry MethodRefCPInfo element if methodRefEntry getMethodClassName equals methodClassName methodRefEntry getMethodName equals methodName methodRefEntry getMethodType equals methodType index return index public int getInterfaceMethodRefEntry String interfaceMethodClassName String interfaceMethodName String interfaceMethodType int index for int entries size index Object element entries elementAt if element instanceof InterfaceMethodRefCPInfo InterfaceMethodRefCPInfo interfaceMethodRefEntry InterfaceMethodRefCPInfo element if interfaceMethodRefEntry getInterfaceMethodClassName equals interfaceMethodClassName interfaceMethodRefEntry getInterfaceMethodName equals interfaceMethodName interfaceMethodRefEntry getInterfaceMethodType equals interfaceMethodType index return index public int getFieldRefEntry String fieldClassName String fieldName String fieldType int index for int entries size index Object element entries elementAt if element instanceof FieldRefCPInfo FieldRefCPInfo fieldRefEntry FieldRefCPInfo element if fieldRefEntry getFieldClassName equals fieldClassName fieldRefEntry getFieldName equals fieldName fieldRefEntry getFieldType equals fieldType index return index public int getNameAndTypeEntry String name String type int index for int entries size index Object element entries elementAt if element instanceof NameAndTypeCPInfo NameAndTypeCPInfo nameAndTypeEntry NameAndTypeCPInfo element if nameAndTypeEntry getName equals name nameAndTypeEntry getType equals type index return index public String toString StringBuffer sb new StringBuffer int size entries size for int size sb append getEntry return sb toString public class CCCheckout extends ClearCase private boolean mReserved true private String mOut null private boolean mNdata false private String mBranch null private boolean mVersion false private boolean mNwarn false private String mComment null private String mCfile null private boolean mNotco true public void execute throws BuildException Commandline commandLine new Commandline Project aProj getProject int result if getViewPath null setViewPath aProj getBaseDir getPath commandLine setExecutable getClearToolCommand commandLine createArgument setValue COMMAND_CHECKOUT checkOptions commandLine if getNotco lsCheckout getProject log getViewPathBasename Project MSG_VERBOSE return if getFailOnErr getProject log getViewPathBasename Project MSG_VERBOSE result run commandLine if Execute isFailure result getFailOnErr String msg commandLine toString throw new BuildException msg getLocation private boolean lsCheckout Commandline cmdl new Commandline String result cmdl setExecutable getClearToolCommand cmdl createArgument setValue COMMAND_LSCO cmdl createArgument setValue cmdl createArgument setValue cmdl createArgument setValue cmdl createArgument setValue getViewPath result runS cmdl return result null result length true false private void checkOptions Commandline cmd if getReserved cmd createArgument setValue FLAG_RESERVED else cmd createArgument setValue FLAG_UNRESERVED if getOut null getOutCommand cmd else if getNoData cmd createArgument setValue FLAG_NODATA if getBranch null getBranchCommand cmd else if getVersion cmd createArgument setValue FLAG_VERSION if getNoWarn cmd createArgument setValue FLAG_NOWARN if getComment null getCommentCommand cmd else if getCommentFile null getCommentFileCommand cmd else cmd createArgument setValue FLAG_NOCOMMENT cmd createArgument setValue getViewPath public void setReserved boolean reserved mReserved reserved public boolean getReserved return mReserved public void setNotco boolean notco mNotco notco public boolean getNotco return mNotco public void setOut String outf mOut outf public String getOut return mOut public void setNoData boolean ndata mNdata ndata public boolean getNoData return mNdata public void setBranch String branch mBranch branch public String getBranch return mBranch public void setVersion boolean version mVersion version public boolean getVersion return mVersion public void setNoWarn boolean nwarn mNwarn nwarn public boolean getNoWarn return mNwarn public void setComment String comment mComment comment public String getComment return mComment public void setCommentFile String cfile mCfile cfile public String getCommentFile return mCfile private void getOutCommand Commandline cmd if getOut null cmd createArgument setValue FLAG_OUT cmd createArgument setValue getOut private void getBranchCommand Commandline cmd if getBranch null cmd createArgument setValue FLAG_BRANCH cmd createArgument setValue getBranch private void getCommentCommand Commandline cmd if getComment null cmd createArgument setValue FLAG_COMMENT cmd createArgument setValue getComment private void getCommentFileCommand Commandline cmd if getCommentFile null cmd createArgument setValue FLAG_COMMENTFILE cmd createArgument setValue getCommentFile public static final String FLAG_RESERVED public static final String FLAG_UNRESERVED public static final String FLAG_OUT public static final String FLAG_NODATA public static final String FLAG_BRANCH public static final String FLAG_VERSION public static final String FLAG_NOWARN public static final String FLAG_COMMENT public static final String FLAG_COMMENTFILE public static final String FLAG_NOCOMMENT public class XSLTProcess extends MatchingTask implements XSLTLogger private File destDir null private File baseDir null private String xslFile null private Resource xslResource null private String targetExtension private String fileNameParameter null private String fileDirParameter null private Vector params new Vector private File inFile null private File outFile null private String processor private Path classpath null private XSLTLiaison liaison private boolean stylesheetLoaded false private boolean force false private Vector outputProperties new Vector private XMLCatalog xmlCatalog new XMLCatalog private static final String TRAX_LIAISON_CLASS private static final FileUtils FILE_UTILS FileUtils getFileUtils private boolean performDirectoryScan true private Factory factory null private boolean reuseLoadedStylesheet true private AntClassLoader loader null private Mapper mapperElement null private Union resources new Union private boolean useImplicitFileset true public static final String PROCESSOR_TRAX public XSLTProcess public void setScanIncludedDirectories boolean performDirectoryScan public void setReloadStylesheet boolean reuseLoadedStylesheet public void addMapper Mapper mapper if mapperElement null throw new BuildException getLocation mapperElement mapper public void add ResourceCollection rc resources add rc public void addConfiguredStyle Resources rc if rc size throw new BuildException setXslResource Resource rc iterator next public void setXslResource Resource xslResource this xslResource xslResource public void add FileNameMapper fileNameMapper throws BuildException Mapper mapper new Mapper getProject mapper add fileNameMapper addMapper mapper public void execute throws BuildException if equals getTaskType log Project MSG_WARN File savedBaseDir baseDir DirectoryScanner scanner String list String dirs if xslResource null xslFile null throw new BuildException getLocation if xslResource null xslFile null throw new BuildException getLocation if inFile null inFile exists throw new BuildException inFile toString getLocation try if baseDir null baseDir getProject resolveFile liaison getLiaison if liaison instanceof XSLTLoggerAware XSLTLoggerAware liaison setLogger this log liaison getClass toString Project MSG_VERBOSE if xslFile null File stylesheet getProject resolveFile xslFile if stylesheet exists stylesheet FILE_UTILS resolveFile baseDir xslFile if stylesheet exists log log FileResource fr new FileResource fr setProject getProject fr setFile stylesheet xslResource fr if inFile null outFile null process inFile outFile xslResource return checkDest if useImplicitFileset scanner getDirectoryScanner baseDir log destDir Project MSG_INFO list scanner getIncludedFiles for int list length process baseDir list destDir xslResource if performDirectoryScan dirs scanner getIncludedDirectories for int dirs length list new File baseDir dirs list for int list length process baseDir dirs File separator list destDir xslResource if resources size throw new BuildException processResources xslResource finally if loader null loader resetThreadContextLoader loader cleanup loader null liaison null stylesheetLoaded false baseDir savedBaseDir public void setForce boolean force this force force public void setBasedir File dir baseDir dir public void setDestdir File dir destDir dir public void setExtension String name targetExtension name public void setStyle String xslFile this xslFile xslFile public void setClasspath Path classpath createClasspath append classpath public Path createClasspath if classpath null classpath new Path getProject return classpath createPath public void setClasspathRef Reference createClasspath setRefid public void setProcessor String processor this processor processor public void setUseImplicitFileset boolean useimplicitfileset useImplicitFileset useimplicitfileset public void addConfiguredXMLCatalog XMLCatalog xmlCatalog this xmlCatalog addConfiguredXMLCatalog xmlCatalog public void setFileNameParameter String fileNameParameter this fileNameParameter fileNameParameter public void setFileDirParameter String fileDirParameter this fileDirParameter fileDirParameter private void resolveProcessor String proc throws Exception String classname if proc equals PROCESSOR_TRAX classname TRAX_LIAISON_CLASS else classname proc Class clazz loadClass classname liaison XSLTLiaison clazz newInstance private Class loadClass String classname throws Exception if classpath null return Class forName classname else loader getProject createClassLoader classpath loader setThreadContextLoader Class Class forName classname true loader return public void setOut File outFile this outFile outFile public void setIn File inFile this inFile inFile private void checkDest if destDir null String msg throw new BuildException msg private void processResources Resource stylesheet Iterator iter resources iterator while iter hasNext Resource Resource iter next if isExists continue File base baseDir String name getName if instanceof FileResource FileResource FileResource base getBaseDir if base null name getFile getAbsolutePath process base name destDir stylesheet private void process File baseDir String xmlFile File destDir Resource stylesheet throws BuildException File outF null File inF null try long styleSheetLastModified stylesheet getLastModified inF new File baseDir xmlFile if inF isDirectory log inF Project MSG_VERBOSE return FileNameMapper mapper null if mapperElement null mapper mapperElement getImplementation else mapper new StyleMapper String outFileName mapper mapFileName xmlFile if outFileName null outFileName length log inFile Project MSG_VERBOSE return else if outFileName null outFileName length log inFile Project MSG_VERBOSE return outF new File destDir outFileName if force inF lastModified outF lastModified styleSheetLastModified outF lastModified ensureDirectoryFor outF log inF outF configureLiaison stylesheet setLiaisonDynamicFileParameters liaison inF liaison transform inF outF catch Exception ex log inFile Project MSG_INFO if outF null outF delete throw new BuildException ex private void process File inFile File outFile Resource stylesheet throws BuildException try long styleSheetLastModified stylesheet getLastModified log inFile inFile lastModified Project MSG_DEBUG log outFile outFile lastModified Project MSG_DEBUG log xslFile styleSheetLastModified Project MSG_DEBUG if force inFile lastModified outFile lastModified styleSheetLastModified outFile lastModified ensureDirectoryFor outFile log inFile outFile Project MSG_INFO configureLiaison stylesheet setLiaisonDynamicFileParameters liaison inFile liaison transform inFile outFile else log inFile outFile stylesheet Project MSG_DEBUG catch Exception ex log inFile Project MSG_INFO if outFile null outFile delete throw new BuildException ex private void ensureDirectoryFor File targetFile throws BuildException File directory targetFile getParentFile if directory exists if directory mkdirs throw new BuildException directory getAbsolutePath public Factory getFactory return factory public XMLCatalog getXMLCatalog xmlCatalog setProject getProject return xmlCatalog public Enumeration getOutputProperties return outputProperties elements protected XSLTLiaison getLiaison if liaison null if processor null try resolveProcessor processor catch Exception throw new BuildException else try resolveProcessor PROCESSOR_TRAX catch Throwable e1 e1 printStackTrace throw new BuildException e1 return liaison public Param createParam Param new Param params addElement return public static class Param private String name null private String expression null private String ifProperty private String unlessProperty private Project project public void setProject Project project this project project public void setName String name this name name public void setExpression String expression this expression expression public String getName throws BuildException if name null throw new BuildException return name public String getExpression throws BuildException if expression null throw new BuildException return expression public void setIf String ifProperty this ifProperty ifProperty public void setUnless String unlessProperty this unlessProperty unlessProperty public boolean shouldUse if ifProperty null project getProperty ifProperty null return false else if unlessProperty null project getProperty unlessProperty null return false return true public OutputProperty createOutputProperty OutputProperty new OutputProperty outputProperties addElement return public static class OutputProperty private String name private String value public String getName return name public void setName String name this name name public String getValue return value public void setValue String value this value value public void init throws BuildException super init xmlCatalog setProject getProject protected void configureLiaison File stylesheet throws BuildException FileResource fr new FileResource fr setProject getProject fr setFile stylesheet configureLiaison fr protected void configureLiaison Resource stylesheet throws BuildException if stylesheetLoaded reuseLoadedStylesheet return stylesheetLoaded true try log stylesheet Project MSG_INFO if liaison instanceof XSLTLiaison2 XSLTLiaison2 liaison configure this if liaison instanceof XSLTLiaison3 XSLTLiaison3 liaison setStylesheet stylesheet else if stylesheet instanceof FileResource liaison setStylesheet FileResource stylesheet getFile else throw new BuildException liaison getClass toString getLocation for Enumeration params elements hasMoreElements Param Param nextElement if shouldUse liaison addParam getName getExpression catch Exception ex log stylesheet Project MSG_INFO throw new BuildException ex private void setLiaisonDynamicFileParameters XSLTLiaison liaison File inFile throws Exception if fileNameParameter null liaison addParam fileNameParameter inFile getName if fileDirParameter null String fileName FileUtils getRelativePath baseDir inFile File file new File fileName liaison addParam fileDirParameter file getParent null file getParent replace public Factory createFactory throws BuildException if factory null throw new BuildException factory new Factory return factory public static class Factory private String name private Vector attributes new Vector public String getName return name public void setName String name this name name public void addAttribute Attribute attr attributes addElement attr public Enumeration getAttributes return attributes elements public static class Attribute implements DynamicConfigurator private String name private Object value public String getName return name public Object getValue return value public Object createDynamicElement String name throws BuildException return null public void setDynamicAttribute String name String value throws BuildException if equalsIgnoreCase name this name value else if equalsIgnoreCase name if equalsIgnoreCase value this value Boolean TRUE else if equalsIgnoreCase value this value Boolean FALSE else try this value new Integer value catch NumberFormatException this value value else throw new BuildException name private class StyleMapper implements FileNameMapper public void setFrom String from public void setTo String to public String mapFileName String xmlFile int dotPos xmlFile lastIndexOf if dotPos xmlFile xmlFile substring dotPos return new String xmlFile targetExtension public interface TypeAdapter void setProject Project Project getProject void setProxy Object Object getProxy void checkProxyClass Class proxyClass public class SQLExec extends JDBCTask public static class DelimiterType extends EnumeratedAttribute public static final String NORMAL ROW public String getValues return new String NORMAL ROW private int goodSql private int totalSql private Connection conn null private Union resources new Union private Statement statement null private File srcFile null private String sqlCommand private Vector transactions new Vector private String delimiter private String delimiterType DelimiterType NORMAL private boolean print false private boolean showheaders true private boolean showtrailers true private File output null private String onError private String encoding null private boolean append false private boolean keepformat false private boolean escapeProcessing true private boolean expandProperties false public void setSrc File srcFile this srcFile srcFile public void setExpandProperties boolean expandProperties this expandProperties expandProperties public boolean getExpandProperties return expandProperties public void addText String sql this sqlCommand sql public void addFileset FileSet set add set public void add ResourceCollection rc resources add rc public Transaction createTransaction Transaction new Transaction transactions addElement return public void setEncoding String encoding this encoding encoding public void setDelimiter String delimiter this delimiter delimiter public void setDelimiterType DelimiterType delimiterType this delimiterType delimiterType getValue public void setPrint boolean print this print print public void setShowheaders boolean showheaders this showheaders showheaders public void setShowtrailers boolean showtrailers this showtrailers showtrailers public void setOutput File output this output output public void setAppend boolean append this append append public void setOnerror OnError action this onError action getValue public void setKeepformat boolean keepformat this keepformat keepformat public void setEscapeProcessing boolean enable escapeProcessing enable public void execute throws BuildException Vector savedTransaction Vector transactions clone String savedSqlCommand sqlCommand sqlCommand sqlCommand trim try if srcFile null sqlCommand length resources size if transactions size throw new BuildException getLocation if srcFile null srcFile exists throw new BuildException getLocation Iterator iter resources iterator while iter hasNext Resource Resource iter next Transaction createTransaction setSrcResource Transaction createTransaction setSrc srcFile addText sqlCommand conn getConnection if isValidRdbms conn return try statement conn createStatement statement setEscapeProcessing escapeProcessing PrintStream out System out try if output null log output Project MSG_VERBOSE out new PrintStream new BufferedOutputStream new FileOutputStream output getAbsolutePath append for Enumeration transactions elements hasMoreElements Transaction nextElement runTransaction out if isAutocommit log Project MSG_VERBOSE conn commit finally if out null out System out out close catch IOException closeQuietly throw new BuildException getLocation catch SQLException closeQuietly throw new BuildException getLocation finally try if statement null statement close if conn null conn close catch SQLException ex log goodSql totalSql finally transactions savedTransaction sqlCommand savedSqlCommand protected void runStatements Reader reader PrintStream out throws SQLException IOException StringBuffer sql new StringBuffer String line BufferedReader in new BufferedReader reader while line in readLine null if keepformat line line trim line getProject replaceProperties line if keepformat continue if line startsWith continue StringTokenizer st new StringTokenizer line if st hasMoreTokens String token st nextToken if equalsIgnoreCase token continue if keepformat sql append sql append line else sql append sql append line if keepformat if line indexOf sql append if delimiterType equals DelimiterType NORMAL StringUtils endsWith sql delimiter delimiterType equals DelimiterType ROW line equals delimiter execSQL sql substring sql length delimiter length out sql replace sql length if sql length execSQL sql toString out protected void execSQL String sql PrintStream out throws SQLException if equals sql trim return ResultSet resultSet null try totalSql log sql Project MSG_VERBOSE boolean ret int updateCount updateCountTotal ret statement execute sql updateCount statement getUpdateCount resultSet statement getResultSet do if ret if updateCount updateCountTotal updateCount else if print printResults resultSet out ret statement getMoreResults if ret updateCount statement getUpdateCount resultSet statement getResultSet while ret log updateCountTotal Project MSG_VERBOSE if print showtrailers out println updateCountTotal SQLWarning warning conn getWarnings while warning null log warning Project MSG_VERBOSE warning warning getNextWarning conn clearWarnings goodSql catch SQLException log sql Project MSG_ERR if onError equals throw log toString Project MSG_ERR finally if resultSet null resultSet close protected void printResults PrintStream out throws SQLException ResultSet rs statement getResultSet try printResults rs out finally if rs null rs close protected void printResults ResultSet rs PrintStream out throws SQLException if rs null log Project MSG_VERBOSE ResultSetMetaData md rs getMetaData int columnCount md getColumnCount StringBuffer line new StringBuffer if showheaders for int col col columnCount col line append md getColumnName col line append line append md getColumnName columnCount out println line line new StringBuffer while rs next boolean first true for int col col columnCount col String columnValue rs getString col if columnValue null columnValue columnValue trim if first first false else line append line append columnValue out println line line new StringBuffer out println private void closeQuietly if isAutocommit conn null onError equals try conn rollback catch SQLException ex public static class OnError extends EnumeratedAttribute public String getValues return new String public class Transaction private Resource tSrcResource null private String tSqlCommand public void setSrc File src if src null setSrcResource new FileResource src public void setSrcResource Resource src if tSrcResource null throw new BuildException tSrcResource src public void addText String sql if sql null if getExpandProperties sql getProject replaceProperties sql this tSqlCommand sql public void addConfigured ResourceCollection if size throw new BuildException setSrcResource Resource iterator next private void runTransaction PrintStream out throws IOException SQLException if tSqlCommand length log Project MSG_INFO runStatements new StringReader tSqlCommand out if tSrcResource null log tSrcResource toString Project MSG_INFO InputStream is null Reader reader null try is tSrcResource getInputStream reader encoding null new InputStreamReader is new InputStreamReader is encoding runStatements reader out finally FileUtils close is FileUtils close reader public class CCCheckin extends ClearCase private String mComment null private String mCfile null private boolean mNwarn false private boolean mPtime false private boolean mKeep false private boolean mIdentical true public void execute throws BuildException Commandline commandLine new Commandline Project aProj getProject int result if getViewPath null setViewPath aProj getBaseDir getPath commandLine setExecutable getClearToolCommand commandLine createArgument setValue COMMAND_CHECKIN checkOptions commandLine if getFailOnErr getProject log getViewPathBasename Project MSG_VERBOSE result run commandLine if Execute isFailure result getFailOnErr String msg commandLine toString throw new BuildException msg getLocation private void checkOptions Commandline cmd if getComment null getCommentCommand cmd else if getCommentFile null getCommentFileCommand cmd else cmd createArgument setValue FLAG_NOCOMMENT if getNoWarn cmd createArgument setValue FLAG_NOWARN if getPreserveTime cmd createArgument setValue FLAG_PRESERVETIME if getKeepCopy cmd createArgument setValue FLAG_KEEPCOPY if getIdentical cmd createArgument setValue FLAG_IDENTICAL cmd createArgument setValue getViewPath public void setComment String comment mComment comment public String getComment return mComment public void setCommentFile String cfile mCfile cfile public String getCommentFile return mCfile public void setNoWarn boolean nwarn mNwarn nwarn public boolean getNoWarn return mNwarn public void setPreserveTime boolean ptime mPtime ptime public boolean getPreserveTime return mPtime public void setKeepCopy boolean keep mKeep keep public boolean getKeepCopy return mKeep public void setIdentical boolean identical mIdentical identical public boolean getIdentical return mIdentical private void getCommentCommand Commandline cmd if getComment null cmd createArgument setValue FLAG_COMMENT cmd createArgument setValue getComment private void getCommentFileCommand Commandline cmd if getCommentFile null cmd createArgument setValue FLAG_COMMENTFILE cmd createArgument setValue getCommentFile public static final String FLAG_COMMENT public static final String FLAG_COMMENTFILE public static final String FLAG_NOCOMMENT public static final String FLAG_NOWARN public static final String FLAG_PRESERVETIME public static final String FLAG_KEEPCOPY public static final String FLAG_IDENTICAL public class FileUtils private static final FileUtils PRIMARY_INSTANCE new FileUtils private static Random rand new Random System currentTimeMillis Runtime getRuntime freeMemory private static boolean onNetWare Os isFamily private static boolean onDos Os isFamily private static boolean onWin9x Os isFamily private static boolean onWindows Os isFamily static final int BUF_SIZE public static final long FAT_FILE_TIMESTAMP_GRANULARITY public static final long UNIX_FILE_TIMESTAMP_GRANULARITY public static final long NTFS_FILE_TIMESTAMP_GRANULARITY private Object cacheFromUriLock new Object private String cacheFromUriRequest null private String cacheFromUriResponse null public static FileUtils newFileUtils return new FileUtils public static FileUtils getFileUtils return PRIMARY_INSTANCE protected FileUtils public URL getFileURL File file throws MalformedURLException return new URL toURI file getAbsolutePath public void copyFile String sourceFile String destFile throws IOException copyFile new File sourceFile new File destFile null false false public void copyFile String sourceFile String destFile FilterSetCollection filters throws IOException copyFile new File sourceFile new File destFile filters false false public void copyFile String sourceFile String destFile FilterSetCollection filters boolean overwrite throws IOException copyFile new File sourceFile new File destFile filters overwrite false public void copyFile String sourceFile String destFile FilterSetCollection filters boolean overwrite boolean preserveLastModified throws IOException copyFile new File sourceFile new File destFile filters overwrite preserveLastModified public void copyFile String sourceFile String destFile FilterSetCollection filters boolean overwrite boolean preserveLastModified String encoding throws IOException copyFile new File sourceFile new File destFile filters overwrite preserveLastModified encoding public void copyFile String sourceFile String destFile FilterSetCollection filters Vector filterChains boolean overwrite boolean preserveLastModified String encoding Project project throws IOException copyFile new File sourceFile new File destFile filters filterChains overwrite preserveLastModified encoding project public void copyFile String sourceFile String destFile FilterSetCollection filters Vector filterChains boolean overwrite boolean preserveLastModified String inputEncoding String outputEncoding Project project throws IOException copyFile new File sourceFile new File destFile filters filterChains overwrite preserveLastModified inputEncoding outputEncoding project public void copyFile File sourceFile File destFile throws IOException copyFile sourceFile destFile null false false public void copyFile File sourceFile File destFile FilterSetCollection filters throws IOException copyFile sourceFile destFile filters false false public void copyFile File sourceFile File destFile FilterSetCollection filters boolean overwrite throws IOException copyFile sourceFile destFile filters overwrite false public void copyFile File sourceFile File destFile FilterSetCollection filters boolean overwrite boolean preserveLastModified throws IOException copyFile sourceFile destFile filters overwrite preserveLastModified null public void copyFile File sourceFile File destFile FilterSetCollection filters boolean overwrite boolean preserveLastModified String encoding throws IOException copyFile sourceFile destFile filters null overwrite preserveLastModified encoding null public void copyFile File sourceFile File destFile FilterSetCollection filters Vector filterChains boolean overwrite boolean preserveLastModified String encoding Project project throws IOException copyFile sourceFile destFile filters filterChains overwrite preserveLastModified encoding encoding project public void copyFile File sourceFile File destFile FilterSetCollection filters Vector filterChains boolean overwrite boolean preserveLastModified String inputEncoding String outputEncoding Project project throws IOException ResourceUtils copyResource new FileResource sourceFile new FileResource destFile filters filterChains overwrite preserveLastModified inputEncoding outputEncoding project public void setFileLastModified File file long time ResourceUtils setLastModified new FileResource file time public File resolveFile File file String filename if isAbsolutePath filename char sep File separatorChar filename filename replace sep replace sep if isContextRelativePath filename file null String udir System getProperty if filename charAt sep udir charAt sep filename dissect udir filename substring filename new File file filename getAbsolutePath return normalize filename public static boolean isContextRelativePath String filename if onDos onNetWare filename length return false char sep File separatorChar filename filename replace sep replace sep char filename charAt int len filename length return sep len filename charAt sep Character isLetter len filename indexOf len filename charAt sep public static boolean isAbsolutePath String filename int len filename length if len return false char sep File separatorChar filename filename replace sep replace sep char filename charAt if onDos onNetWare return sep if sep if onDos len filename charAt sep return false int nextsep filename indexOf sep return nextsep nextsep len int colon filename indexOf return Character isLetter colon filename length filename charAt sep onNetWare colon public static String translatePath String toProcess if toProcess null toProcess length return StringBuffer path new StringBuffer toProcess length PathTokenizer tokenizer new PathTokenizer toProcess while tokenizer hasMoreTokens String pathComponent tokenizer nextToken pathComponent pathComponent replace File separatorChar pathComponent pathComponent replace File separatorChar if path length path append File pathSeparatorChar path append pathComponent return path toString public File normalize final String path Stack new Stack String dissect dissect path push dissect StringTokenizer tok new StringTokenizer dissect File separator while tok hasMoreTokens String thisToken tok nextToken if equals thisToken continue else if equals thisToken if size return new File path pop push thisToken StringBuffer sb new StringBuffer for int size if sb append File separatorChar sb append elementAt return new File sb toString public String dissect String path char sep File separatorChar path path replace sep replace sep if isAbsolutePath path throw new BuildException path String root null int colon path indexOf if colon onDos onNetWare int next colon root path substring next char ca path toCharArray root sep next ca next sep next next StringBuffer sbPath new StringBuffer for int next ca length if ca sep ca sep sbPath append ca path sbPath toString else if path length path charAt sep int nextsep path indexOf sep nextsep path indexOf sep nextsep root nextsep path substring nextsep path path path substring root length else root File separator path path substring return new String root path public String toVMSPath File String osPath String path normalize getAbsolutePath getPath String name getName boolean isAbsolute path charAt File separatorChar boolean isDirectory isDirectory name regionMatches true name length String device null StringBuffer directory null String file null int index if isAbsolute index path indexOf File separatorChar if index return path substring else device path substring index if isDirectory directory new StringBuffer path substring index replace File separatorChar else int dirEnd path lastIndexOf File separatorChar path length if dirEnd dirEnd index file path substring index else directory new StringBuffer path substring index dirEnd replace File separatorChar index dirEnd if path length index file path substring index if isAbsolute directory null directory insert osPath device null device directory null directory file null file return osPath public File createTempFile String prefix String suffix File parentDir return createTempFile prefix suffix parentDir false public File createTempFile String prefix String suffix File parentDir boolean deleteOnExit File result null String parent parentDir null System getProperty parentDir getPath DecimalFormat fmt new DecimalFormat synchronized rand do result new File parent prefix fmt format Math abs rand nextInt suffix while result exists if deleteOnExit result deleteOnExit return result public boolean contentEquals File f1 File f2 throws IOException return contentEquals f1 f2 false public boolean contentEquals File f1 File f2 boolean textfile throws IOException return ResourceUtils contentEquals new FileResource f1 new FileResource f2 textfile public File getParentFile File return null null getParentFile public static final String readFully Reader rdr throws IOException return readFully rdr BUF_SIZE public static final String readFully Reader rdr int bufferSize throws IOException if bufferSize throw new IllegalArgumentException final char buffer new char bufferSize int bufferLength StringBuffer textBuffer null while bufferLength bufferLength rdr read buffer if bufferLength textBuffer textBuffer null new StringBuffer textBuffer textBuffer append new String buffer bufferLength return textBuffer null null textBuffer toString public boolean createNewFile File throws IOException return createNewFile public boolean createNewFile File boolean mkdirs throws IOException File parent getParentFile if mkdirs parent exists parent mkdirs return createNewFile public boolean isSymbolicLink File parent String name throws IOException if parent null File new File name parent getParentFile name getName File toTest new File parent getCanonicalPath name return toTest getAbsolutePath equals toTest getCanonicalPath public String removeLeadingPath File leading File path String normalize leading getAbsolutePath getAbsolutePath String normalize path getAbsolutePath getAbsolutePath if equals return if endsWith File separator File separator return startsWith substring length public boolean isLeadingPath File leading File path String normalize leading getAbsolutePath getAbsolutePath String normalize path getAbsolutePath getAbsolutePath if equals return true if endsWith File separator File separator return startsWith public String toURI String path Class uriClazz null try uriClazz Class forName catch ClassNotFoundException if uriClazz null try File new File path getAbsoluteFile java lang reflect Method toURIMethod File class getMethod new Class Object uriObj toURIMethod invoke new Object java lang reflect Method toASCIIStringMethod uriClazz getMethod new Class return String toASCIIStringMethod invoke uriObj new Object catch Exception printStackTrace boolean isDir new File path isDirectory StringBuffer sb new StringBuffer path resolveFile null path getPath if path startsWith File separator sb append path path replace try sb append Locator encodeURI path catch UnsupportedEncodingException exc throw new BuildException exc if isDir path endsWith sb append return sb toString public String fromURI String uri synchronized cacheFromUriLock if uri equals cacheFromUriRequest return cacheFromUriResponse String path Locator fromURI uri String ret isAbsolutePath path normalize path getAbsolutePath path cacheFromUriRequest uri cacheFromUriResponse ret return ret public boolean fileNameEquals File f1 File f2 return normalize f1 getAbsolutePath equals normalize f2 getAbsolutePath public void rename File from File to throws IOException if to exists to delete throw new IOException to from File parent to getParentFile if parent null parent exists parent mkdirs throw new IOException parent from if from renameTo to copyFile from to if from delete throw new IOException from public long getFileTimestampGranularity if onWin9x return FAT_FILE_TIMESTAMP_GRANULARITY else if onWindows return NTFS_FILE_TIMESTAMP_GRANULARITY else if onDos return FAT_FILE_TIMESTAMP_GRANULARITY return UNIX_FILE_TIMESTAMP_GRANULARITY public boolean isUpToDate File source File dest long granularity if dest exists return false long sourceTime source lastModified long destTime dest lastModified return isUpToDate sourceTime destTime granularity public boolean isUpToDate File source File dest return isUpToDate source dest getFileTimestampGranularity public boolean isUpToDate long sourceTime long destTime long granularity if destTime return false return destTime sourceTime granularity public boolean isUpToDate long sourceTime long destTime return isUpToDate sourceTime destTime getFileTimestampGranularity public static void close Writer device if device null try device close catch IOException ioex public static void close Reader device if device null try device close catch IOException ioex public static void close OutputStream device if device null try device close catch IOException ioex public static void close InputStream device if device null try device close catch IOException ioex public static void delete File file if file null file delete public static String getRelativePath File fromFile File toFile throws Exception String fromPath fromFile getCanonicalPath String toPath toFile getCanonicalPath String fromPathStack getPathStack fromPath String toPathStack getPathStack toPath if toPathStack length fromPathStack length if fromPathStack equals toPathStack return getPath Arrays asList toPathStack else return getPath Arrays asList toPathStack int minLength Math min fromPathStack length toPathStack length int same for same minLength same if fromPathStack same equals toPathStack same break List relativePathStack new ArrayList for int same fromPathStack length relativePathStack add for int same toPathStack length relativePathStack add toPathStack return getPath relativePathStack public static String getPathStack String path String normalizedPath path replace File separatorChar Object tokens StringUtils split normalizedPath toArray String rv new String tokens length System arraycopy tokens rv tokens length return rv public static String getPath List pathStack return getPath pathStack public static String getPath final List pathStack final char separatorChar final StringBuffer buffer new StringBuffer final Iterator iter pathStack iterator if iter hasNext buffer append iter next while iter hasNext buffer append separatorChar buffer append iter next return buffer toString public String getDefaultEncoding InputStreamReader is new InputStreamReader new InputStream public int read return try return is getEncoding finally close is public class PropertyHelper private Project project private PropertyHelper next private Hashtable properties new Hashtable private Hashtable userProperties new Hashtable private Hashtable inheritedProperties new Hashtable protected PropertyHelper public void setProject Project this project public void setNext PropertyHelper next this next next public PropertyHelper getNext return next public static synchronized PropertyHelper getPropertyHelper Project project PropertyHelper helper PropertyHelper project getReference MagicNames REFID_PROPERTY_HELPER if helper null return helper helper new PropertyHelper helper setProject project project addReference MagicNames REFID_PROPERTY_HELPER helper return helper public boolean setPropertyHook String ns String name Object value boolean inherited boolean user boolean isNew if getNext null boolean subst getNext setPropertyHook ns name value inherited user isNew if subst return true return false public Object getPropertyHook String ns String name boolean user if getNext null Object getNext getPropertyHook ns name user if null return if name startsWith name name substring length Object project getReference name return null null toString return null public void parsePropertyString String value Vector fragments Vector propertyRefs throws BuildException parsePropertyStringDefault value fragments propertyRefs public String replaceProperties String ns String value Hashtable keys throws BuildException if value null value indexOf return value Vector fragments new Vector Vector propertyRefs new Vector parsePropertyString value fragments propertyRefs StringBuffer sb new StringBuffer Enumeration fragments elements Enumeration propertyRefs elements while hasMoreElements String fragment String nextElement if fragment null String propertyName String nextElement Object replacement null if keys null replacement keys get propertyName if replacement null replacement getProperty ns propertyName if replacement null project log propertyName Project MSG_VERBOSE fragment replacement null replacement toString propertyName sb append fragment return sb toString public synchronized boolean setProperty String ns String name Object value boolean verbose if null userProperties get name if verbose project log name Project MSG_VERBOSE return false boolean done setPropertyHook ns name value false false false if done return true if null properties get name verbose project log name Project MSG_VERBOSE if verbose project log name value Project MSG_DEBUG properties put name value return true public synchronized void setNewProperty String ns String name Object value if null properties get name project log name Project MSG_VERBOSE return boolean done setPropertyHook ns name value false false true if done return project log name value Project MSG_DEBUG if name null value null properties put name value public synchronized void setUserProperty String ns String name Object value project log name value Project MSG_DEBUG userProperties put name value boolean done setPropertyHook ns name value false true false if done return properties put name value public synchronized void setInheritedProperty String ns String name Object value inheritedProperties put name value project log name value Project MSG_DEBUG userProperties put name value boolean done setPropertyHook ns name value true false false if done return properties put name value public synchronized Object getProperty String ns String name if name null return null Object getPropertyHook ns name false if null return return properties get name public synchronized Object getUserProperty String ns String name if name null return null Object getPropertyHook ns name true if null return return userProperties get name public Hashtable getProperties return new Hashtable properties public Hashtable getUserProperties return new Hashtable userProperties protected Hashtable getInternalProperties return properties protected Hashtable getInternalUserProperties return userProperties protected Hashtable getInternalInheritedProperties return inheritedProperties public void copyInheritedProperties Project other Enumeration inheritedProperties keys while hasMoreElements String arg nextElement toString if other getUserProperty arg null continue Object value inheritedProperties get arg other setInheritedProperty arg value toString public void copyUserProperties Project other Enumeration userProperties keys while hasMoreElements Object arg nextElement if inheritedProperties containsKey arg continue Object value userProperties get arg other setUserProperty arg toString value toString static void parsePropertyStringDefault String value Vector fragments Vector propertyRefs throws BuildException int prev int pos while pos value indexOf prev if pos fragments addElement value substring prev pos if pos value length fragments addElement prev pos else if value charAt pos if value charAt pos fragments addElement prev pos else fragments addElement value substring pos pos prev pos else int endName value indexOf pos if endName throw new BuildException value String propertyName value substring pos endName fragments addElement null propertyRefs addElement propertyName prev endName if prev value length fragments addElement value substring prev public class ImportTypelib extends Task private static final FileUtils FILE_UTILS FileUtils getFileUtils private File srcFile private File destFile private String namespace private boolean useSysArray false private boolean unsafe false private String extraOptions null public void setDestFile File destFile this destFile destFile public void setNamespace String namespace this namespace namespace public void setSrcFile File srcFile this srcFile srcFile public void setUnsafe boolean unsafe this unsafe unsafe public void setUseSysArray boolean useSysArray this useSysArray useSysArray public void setExtraOptions String extraOptions this extraOptions extraOptions protected void validate throws BuildException if destFile null throw new BuildException if destFile isDirectory throw new BuildException if srcFile null srcFile exists throw new BuildException if srcFile isDirectory throw new BuildException if namespace null throw new BuildException private boolean isExecuteNeeded if destFile exists log Project MSG_VERBOSE return true long sourceTime srcFile lastModified long destTime destFile lastModified if sourceTime destTime FILE_UTILS getFileTimestampGranularity log Project MSG_VERBOSE return true else log Project MSG_VERBOSE return false public void execute throws BuildException log Project MSG_WARN validate log srcFile destFile namespace Project MSG_VERBOSE if isExecuteNeeded return NetCommand command new NetCommand this command setFailOnError true command addArgument srcFile toString command addArgument command addArgument destFile command addArgument namespace if useSysArray command addArgument if unsafe command addArgument command addArgument extraOptions command runCommand public class URLResolver implements ExtensionResolver private File destfile private File destdir private URL url public void setUrl final URL url this url url public void setDestfile final File destfile this destfile destfile public void setDestdir final File destdir this destdir destdir public File resolve final Extension extension final Project project throws BuildException validate final File file getDest final Get get new Get get setProject project get setDest file get setSrc url get execute return file private File getDest File result if null destfile result destfile else final String file url getFile String filename if null file file length filename else int index file lastIndexOf if index index filename file substring index result new File destdir filename return result private void validate if null url final String message throw new BuildException message if null destdir null destfile final String message throw new BuildException message else if null destdir null destfile final String message throw new BuildException message public String toString return url public final class KaffeNative2Ascii extends DefaultNative2Ascii private static final String N2A_CLASSNAMES new String public static final String IMPLEMENTATION_NAME protected void setup Commandline cmd Native2Ascii args throws BuildException if args getReverse throw new BuildException super setup cmd args protected boolean run Commandline cmd ProjectComponent log throws BuildException ExecuteJava ej new ExecuteJava Class getN2aClass if null throw new BuildException cmd setExecutable getName ej setJavaCommand cmd ej execute log getProject return true private static Class getN2aClass for int N2A_CLASSNAMES length try return Class forName N2A_CLASSNAMES catch ClassNotFoundException cnfe return null public class Substitution extends DataType public static final String DATA_TYPE_NAME private String expression public Substitution this expression null public void setExpression String expression this expression expression public String getExpression Project if isReference return getRef getExpression return expression public Substitution getRef Project return Substitution getCheckedRef public class CvsUser private String userID private String displayName public void setDisplayname final String displayName this displayName displayName public void setUserid final String userID this userID userID public String getUserID return userID public String getDisplayname return displayName public void validate throws BuildException if null userID final String message throw new BuildException message if null displayName final String message userID throw new BuildException message public class ExtraFieldUtils private static Hashtable implementations static implementations new Hashtable register AsiExtraField class register JarMarker class public static void register Class try ZipExtraField ze ZipExtraField newInstance implementations put ze getHeaderId catch ClassCastException cc throw new RuntimeException catch InstantiationException ie throw new RuntimeException catch IllegalAccessException ie throw new RuntimeException public static ZipExtraField createExtraField ZipShort headerId throws InstantiationException IllegalAccessException Class Class implementations get headerId if null return ZipExtraField newInstance UnrecognizedExtraField new UnrecognizedExtraField setHeaderId headerId return public static ZipExtraField parse byte data throws ZipException Vector new Vector int start while start data length ZipShort headerId new ZipShort data start int length new ZipShort data start getValue if start length data length throw new ZipException start try ZipExtraField ze createExtraField headerId ze parseFromLocalFileData data start length addElement ze catch InstantiationException ie throw new ZipException ie getMessage catch IllegalAccessException iae throw new ZipException iae getMessage start length throw new ZipException start ZipExtraField result new ZipExtraField size copyInto result return result public static byte mergeLocalFileDataData ZipExtraField data int sum data length for int data length sum data getLocalFileDataLength getValue byte result new byte sum int start for int data length System arraycopy data getHeaderId getBytes result start System arraycopy data getLocalFileDataLength getBytes result start byte local data getLocalFileDataData System arraycopy local result start local length start local length return result public static byte mergeCentralDirectoryData ZipExtraField data int sum data length for int data length sum data getCentralDirectoryLength getValue byte result new byte sum int start for int data length System arraycopy data getHeaderId getBytes result start System arraycopy data getCentralDirectoryLength getBytes result start byte local data getCentralDirectoryData System arraycopy local result start local length start local length return result public final class TailFilter extends BaseParamFilterReader implements ChainableReader private static final String LINES_KEY private static final String SKIP_KEY private static final int DEFAULT_NUM_LINES private long lines DEFAULT_NUM_LINES private long skip private boolean completedReadAhead false private LineTokenizer lineTokenizer null private String line null private int linePos private LinkedList lineList new LinkedList public TailFilter super public TailFilter final Reader in super in lineTokenizer new LineTokenizer lineTokenizer setIncludeDelims true public int read throws IOException if getInitialized initialize setInitialized true while line null line length line lineTokenizer getToken in line tailFilter line if line null return linePos int ch line charAt linePos linePos if linePos line length line null return ch public void setLines final long lines this lines lines private long getLines return lines public void setSkip final long skip this skip skip private long getSkip return skip public Reader chain final Reader rdr TailFilter newFilter new TailFilter rdr newFilter setLines getLines newFilter setSkip getSkip newFilter setInitialized true return newFilter private void initialize Parameter params getParameters if params null for int params length if LINES_KEY equals params getName setLines new Long params getValue longValue continue if SKIP_KEY equals params getName skip new Long params getValue longValue continue private String tailFilter String line if completedReadAhead if line null lineList add line if lines if lineList size skip return String lineList removeFirst else long linesToKeep lines skip skip if linesToKeep lineList size lineList removeFirst return completedReadAhead true if skip for int skip lineList removeLast if lines while lineList size lines lineList removeFirst if lineList size return String lineList removeFirst return null public class Xalan2Executor extends XalanExecutor private static final String APAC private static final String SPAC private TransformerFactory tfactory TransformerFactory newInstance protected String getImplementation throws BuildException return tfactory getClass getName protected String getProcVersion String classNameImpl throws BuildException try if classNameImpl equals APAC classNameImpl equals APAC return getXalanVersion APAC if classNameImpl equals APAC return getXSLTCVersion APAC if classNameImpl equals SPAC return getXSLTCVersion SPAC throw new BuildException classNameImpl catch ClassNotFoundException throw new BuildException void execute throws Exception String systemId caller getStylesheetSystemId Source xslSrc new StreamSource systemId Transformer tformer tfactory newTransformer xslSrc Source xmlSrc new DOMSource caller document OutputStream os getOutputStream try tformer setParameter caller toDir getAbsolutePath Result result new StreamResult os tformer transform xmlSrc result finally os close public class Length extends Task implements Condition private static final String ALL private static final String EACH private static final String STRING private static final String LENGTH_REQUIRED private String property private String string private Boolean trim private String mode ALL private Comparison when Comparison EQUAL private Long length private Resources resources public synchronized void setProperty String property this property property public synchronized void setFile File file add new FileResource file public synchronized void add FileSet fs add ResourceCollection fs public synchronized void add ResourceCollection if null return resources resources null new Resources resources resources add public synchronized void setLength long ell length new Long ell public synchronized void setWhen When setWhen Comparison public synchronized void setWhen Comparison when public synchronized void setMode FileMode this mode getValue public synchronized void setString String string this string string this mode STRING public synchronized void setTrim boolean trim this trim trim Boolean TRUE Boolean FALSE public boolean getTrim return trim null trim booleanValue public void execute validate PrintStream ps new PrintStream property null OutputStream new PropertyOutputStream getProject property OutputStream new LogOutputStream this Project MSG_INFO if STRING equals mode ps print getLength string getTrim ps close else if EACH equals mode handleResources new EachHandler ps else if ALL equals mode handleResources new AllHandler ps public boolean eval validate if length null throw new BuildException LENGTH_REQUIRED Long ell null if STRING equals mode ell new Long getLength string getTrim else ConditionHandler new ConditionHandler handleResources ell new Long getLength return when evaluate ell compareTo length private void validate if string null if resources null throw new BuildException if STRING equals mode throw new BuildException else if resources null if EACH equals mode ALL equals mode throw new BuildException mode else if trim null throw new BuildException else throw new BuildException private void handleResources Handler for Iterator resources iterator hasNext Resource Resource next if isExists log Project MSG_ERR else if isDirectory log Project MSG_ERR else handle complete private static long getLength String boolean return trim length public static class FileMode extends EnumeratedAttribute static final String MODES new String EACH ALL public String getValues return MODES public static class When extends Comparison private abstract class Handler private PrintStream ps Handler PrintStream ps this ps ps protected PrintStream getPs return ps protected abstract void handle Resource void complete ps close private class EachHandler extends Handler EachHandler PrintStream ps super ps protected void handle Resource getPs print toString getPs print long size getSize if size Resource UNKNOWN_SIZE getPs println else getPs println size private class AllHandler extends Handler private long accum AllHandler PrintStream ps super ps protected long getAccum return accum protected synchronized void handle Resource long size getSize if size Resource UNKNOWN_SIZE log toString Project MSG_WARN else accum size void complete getPs print accum super complete private class ConditionHandler extends AllHandler ConditionHandler super null void complete long getLength return getAccum public class SelectSelector extends BaseSelectorContainer private String ifProperty private String unlessProperty public SelectSelector public String toString StringBuffer buf new StringBuffer if hasSelectors buf append if ifProperty null buf append buf append ifProperty if unlessProperty null buf append buf append unlessProperty buf append buf append super toString buf append return buf toString private SelectSelector getRef Object getCheckedRef this getClass return SelectSelector public boolean hasSelectors if isReference return getRef hasSelectors return super hasSelectors public int selectorCount if isReference return getRef selectorCount return super selectorCount public FileSelector getSelectors Project if isReference return getRef getSelectors return super getSelectors public Enumeration selectorElements if isReference return getRef selectorElements return super selectorElements public void appendSelector FileSelector selector if isReference throw noChildrenAllowed super appendSelector selector public void verifySettings int cnt selectorCount if cnt cnt setError public boolean passesConditions if ifProperty null getProject getProperty ifProperty null return false else if unlessProperty null getProject getProperty unlessProperty null return false return true public void setIf String ifProperty this ifProperty ifProperty public void setUnless String unlessProperty this unlessProperty unlessProperty public boolean isSelected File basedir String filename File file validate if passesConditions return false Enumeration selectorElements if hasMoreElements return true FileSelector FileSelector nextElement return isSelected basedir filename file public final class AnsiColorLogger extends DefaultLogger private static final int ATTR_DIM private static final int FG_RED private static final int FG_GREEN private static final int FG_BLUE private static final int FG_MAGENTA private static final int FG_CYAN private static final String PREFIX private static final String SUFFIX private static final char SEPARATOR private static final String END_COLOR PREFIX SUFFIX private String errColor PREFIX ATTR_DIM SEPARATOR FG_RED SUFFIX private String warnColor PREFIX ATTR_DIM SEPARATOR FG_MAGENTA SUFFIX private String infoColor PREFIX ATTR_DIM SEPARATOR FG_CYAN SUFFIX private String verboseColor PREFIX ATTR_DIM SEPARATOR FG_GREEN SUFFIX private String debugColor PREFIX ATTR_DIM SEPARATOR FG_BLUE SUFFIX private boolean colorsSet false private void setColors String userColorFile System getProperty String systemColorFile InputStream in null try Properties prop new Properties if userColorFile null in new FileInputStream userColorFile else in getClass getResourceAsStream systemColorFile if in null prop load in String errC prop getProperty String warn prop getProperty String info prop getProperty String verbose prop getProperty String debug prop getProperty if errC null errColor PREFIX errC SUFFIX if warn null warnColor PREFIX warn SUFFIX if info null infoColor PREFIX info SUFFIX if verbose null verboseColor PREFIX verbose SUFFIX if debug null debugColor PREFIX debug SUFFIX catch IOException ioe finally if in null try in close catch IOException protected void printMessage final String message final PrintStream stream final int priority if message null stream null if colorsSet setColors colorsSet true final StringBuffer msg new StringBuffer message switch priority case Project MSG_ERR msg insert errColor msg append END_COLOR break case Project MSG_WARN msg insert warnColor msg append END_COLOR break case Project MSG_INFO msg insert infoColor msg append END_COLOR break case Project MSG_VERBOSE msg insert verboseColor msg append END_COLOR break case Project MSG_DEBUG default msg insert debugColor msg append END_COLOR break final String strmessage msg toString stream println strmessage public class Quantifier extends EnumeratedAttribute private static final String VALUES new String public static final Quantifier ALL new Quantifier public static final Quantifier ANY new Quantifier public static final Quantifier ONE new Quantifier public static final Quantifier MAJORITY new Quantifier public static final Quantifier NONE new Quantifier private abstract static class Predicate abstract boolean eval int int private static final Predicate ALL_PRED new Predicate boolean eval int int return private static final Predicate ANY_PRED new Predicate boolean eval int int return private static final Predicate ONE_PRED new Predicate boolean eval int int return private static final Predicate MAJORITY_PRED new Predicate boolean eval int int return private static final Predicate NONE_PRED new Predicate boolean eval int int return private static final Predicate PREDS new Predicate VALUES length static PREDS ALL_PRED PREDS ALL_PRED PREDS ALL_PRED PREDS ANY_PRED PREDS ANY_PRED PREDS ONE_PRED PREDS MAJORITY_PRED PREDS MAJORITY_PRED PREDS NONE_PRED public Quantifier public Quantifier String value setValue value public String getValues return VALUES public boolean evaluate boolean int for int length if return evaluate length public boolean evaluate int int int index getIndex if index throw new BuildException return PREDS index eval public abstract class ClearCase extends Task private String mClearToolDir private String mviewPath null private String mobjSelect null private static int pcnt private boolean mFailonerr true public final void setClearToolDir String dir mClearToolDir FileUtils translatePath dir protected final String getClearToolCommand String toReturn mClearToolDir if toReturn equals toReturn endsWith toReturn toReturn CLEARTOOL_EXE return toReturn public final void setViewPath String viewPath mviewPath viewPath public String getViewPath return mviewPath public String getViewPathBasename return new File mviewPath getName public final void setObjSelect String objSelect mobjSelect objSelect public String getObjSelect return mobjSelect protected int run Commandline cmd try Project aProj getProject Execute exe new Execute new LogStreamHandler this Project MSG_INFO Project MSG_WARN exe setAntRun aProj exe setWorkingDirectory aProj getBaseDir exe setCommandline cmd getCommandline return exe execute catch java io IOException throw new BuildException getLocation protected String runS Commandline cmdline String outV pcnt ExecTask exe new ExecTask this Commandline Argument arg exe createArg exe setExecutable cmdline getExecutable arg setLine Commandline toString cmdline getArguments exe setOutputproperty outV exe execute return getProject getProperty outV public void setFailOnErr boolean failonerr mFailonerr failonerr public boolean getFailOnErr return mFailonerr private static final String CLEARTOOL_EXE public static final String COMMAND_UPDATE public static final String COMMAND_CHECKOUT public static final String COMMAND_CHECKIN public static final String COMMAND_UNCHECKOUT public static final String COMMAND_LOCK public static final String COMMAND_UNLOCK public static final String COMMAND_MKBL public static final String COMMAND_MKLABEL public static final String COMMAND_MKLBTYPE public static final String COMMAND_RMTYPE public static final String COMMAND_LSCO public static final String COMMAND_MKELEM public static final String COMMAND_MKATTR public static final String COMMAND_MKDIR public class CCUnlock extends ClearCase private String mComment null private String mPname null public void execute throws BuildException Commandline commandLine new Commandline Project aProj getProject int result if getViewPath null setViewPath aProj getBaseDir getPath commandLine setExecutable getClearToolCommand commandLine createArgument setValue COMMAND_UNLOCK checkOptions commandLine if getFailOnErr getProject log getOpType Project MSG_VERBOSE result run commandLine if Execute isFailure result getFailOnErr String msg commandLine toString throw new BuildException msg getLocation private void checkOptions Commandline cmd getCommentCommand cmd if getObjSelect null getPname null throw new BuildException getPnameCommand cmd if getObjSelect null cmd createArgument setValue getObjSelect public void setComment String comment mComment comment public String getComment return mComment public void setPname String pname mPname pname public String getPname return mPname public void setObjselect String objselect setObjSelect objselect public void setObjSel String objsel setObjSelect objsel public String getObjselect return getObjSelect private void getCommentCommand Commandline cmd if getComment null return else cmd createArgument setValue FLAG_COMMENT cmd createArgument setValue getComment private void getPnameCommand Commandline cmd if getPname null return else cmd createArgument setValue FLAG_PNAME cmd createArgument setValue getPname private String getOpType if getPname null return getPname else return getObjSelect public static final String FLAG_COMMENT public static final String FLAG_PNAME public class ResourceCount extends Task implements Condition private static final String ONE_NESTED_MESSAGE private static final String COUNT_REQUIRED private ResourceCollection rc private Comparison when Comparison EQUAL private Integer count private String property public void add ResourceCollection if rc null throw new BuildException ONE_NESTED_MESSAGE rc public void setRefid Reference Object getReferencedObject if instanceof ResourceCollection throw new BuildException getRefId add ResourceCollection public void execute if rc null throw new BuildException ONE_NESTED_MESSAGE if property null log rc size else getProject setNewProperty property Integer toString rc size public boolean eval if rc null throw new BuildException ONE_NESTED_MESSAGE if count null throw new BuildException COUNT_REQUIRED return when evaluate new Integer rc size compareTo count public void setCount int count new Integer public void setWhen Comparison when public void setProperty String property public class Concat extends Task private static final int BUFFER_SIZE private static final FileUtils FILE_UTILS FileUtils getFileUtils private static final ResourceSelector EXISTS new Exists private static final ResourceSelector NOT_EXISTS new Not EXISTS private File destinationFile private boolean append private String encoding private String outputEncoding private boolean binary private StringBuffer textBuffer private Resources rc private Vector filterChains private boolean forceOverwrite true private TextElement footer private TextElement header private boolean fixLastLine false private String eolString private Writer outputWriter null public Concat reset public void reset append false forceOverwrite true destinationFile null encoding null outputEncoding null fixLastLine false filterChains null footer null header null binary false outputWriter null textBuffer null eolString System getProperty rc null public void setDestfile File destinationFile this destinationFile destinationFile public void setAppend boolean append this append append public void setEncoding String encoding this encoding encoding if outputEncoding null outputEncoding encoding public void setOutputEncoding String outputEncoding this outputEncoding outputEncoding public void setForce boolean force this forceOverwrite force public Path createPath Path path new Path getProject add path return path public void addFileset FileSet set add set public void addFilelist FileList list add list public void add ResourceCollection rc rc null new Resources rc rc add public void addFilterChain FilterChain filterChain if filterChains null filterChains new Vector filterChains addElement filterChain public void addText String text if textBuffer null textBuffer new StringBuffer text length textBuffer append text public void addHeader TextElement headerToAdd this header headerToAdd public void addFooter TextElement footerToAdd this footer footerToAdd public void setFixLastLine boolean fixLastLine this fixLastLine fixLastLine public void setEol FixCRLF CrLf crlf String crlf getValue if equals equals eolString else if equals equals eolString else if equals equals eolString public void setWriter Writer outputWriter this outputWriter outputWriter public void setBinary boolean binary this binary binary private ResourceCollection validate sanitizeText if binary if destinationFile null throw new BuildException if textBuffer null throw new BuildException if encoding null outputEncoding null throw new BuildException if filterChains null throw new BuildException if fixLastLine throw new BuildException if header null footer null throw new BuildException if destinationFile null outputWriter null throw new BuildException if rc null textBuffer null throw new BuildException if rc null if textBuffer null throw new BuildException Restrict noexistRc new Restrict noexistRc add NOT_EXISTS noexistRc add rc for Iterator noexistRc iterator hasNext log next Project MSG_ERR if destinationFile null for Iterator rc iterator hasNext Object next if instanceof FileResource File FileResource getFile if FILE_UTILS fileNameEquals destinationFile throw new BuildException Restrict existRc new Restrict existRc add EXISTS existRc add rc boolean outofdate destinationFile null forceOverwrite if outofdate for Iterator existRc iterator outofdate hasNext Resource Resource next outofdate getLastModified getLastModified destinationFile lastModified if outofdate log destinationFile Project MSG_VERBOSE return existRc else StringResource new StringResource setProject getProject setValue textBuffer toString return public void execute ResourceCollection validate if null return if size header null footer null log Project MSG_INFO return if binary binaryCat else cat private void binaryCat ResourceCollection log size destinationFile FileOutputStream out null InputStream in null try try out new FileOutputStream destinationFile catch Exception throw new BuildException destinationFile in new ConcatResourceInputStream ConcatResourceInputStream in setManagingComponent this Thread new Thread new StreamPumper in out start try join catch InterruptedException try join catch InterruptedException ee finally FileUtils close in if out null try out close catch Exception ex throw new BuildException destinationFile ex private void cat ResourceCollection OutputStream os null char buffer new char BUFFER_SIZE try PrintWriter writer null if outputWriter null writer new PrintWriter outputWriter else if destinationFile null os new LogOutputStream this Project MSG_WARN else File parent destinationFile getParentFile if parent exists parent mkdirs os new FileOutputStream destinationFile getAbsolutePath append if outputEncoding null writer new PrintWriter new BufferedWriter new OutputStreamWriter os else writer new PrintWriter new BufferedWriter new OutputStreamWriter os outputEncoding if header null if header getFiltering concatenate buffer writer new StringReader header getValue else writer print header getValue if size concatenate buffer writer new MultiReader if footer null if footer getFiltering concatenate buffer writer new StringReader footer getValue else writer print footer getValue writer flush if os null os flush catch IOException ioex throw new BuildException ioex getMessage ioex finally FileUtils close os private void concatenate char buffer Writer writer Reader in throws IOException if filterChains null ChainReaderHelper helper new ChainReaderHelper helper setBufferSize BUFFER_SIZE helper setPrimaryReader in helper setFilterChains filterChains helper setProject getProject in new BufferedReader helper getAssembledReader while true int nRead in read buffer buffer length if nRead break writer write buffer nRead writer flush private void sanitizeText if textBuffer null if textBuffer substring trim length textBuffer null public static class TextElement extends ProjectComponent private String value private boolean trimLeading false private boolean trim false private boolean filtering true private String encoding null public void setFiltering boolean filtering this filtering filtering private boolean getFiltering return filtering public void setEncoding String encoding this encoding encoding public void setFile File file throws BuildException if file exists throw new BuildException file BufferedReader reader null try if this encoding null reader new BufferedReader new FileReader file else reader new BufferedReader new InputStreamReader new FileInputStream file this encoding value FileUtils readFully reader catch IOException ex throw new BuildException ex finally FileUtils close reader public void addText String value this value getProject replaceProperties value public void setTrimLeading boolean strip this trimLeading strip public void setTrim boolean trim this trim trim public String getValue if value null value if value trim length value if trimLeading char current value toCharArray StringBuffer new StringBuffer current length boolean startOfLine true int pos while pos current length char ch current pos if startOfLine if ch ch continue startOfLine false append ch if ch ch startOfLine true value toString if trim value value trim return value private class MultiReader extends Reader private Reader reader null private int lastPos private char lastChars new char eolString length private boolean needAddSeparator false private Iterator private MultiReader ResourceCollection iterator private Reader getReader throws IOException if reader null hasNext Resource Resource next log toLongString Project MSG_VERBOSE InputStream is getInputStream reader new BufferedReader encoding null new InputStreamReader is new InputStreamReader is encoding Arrays fill lastChars char return reader private void nextReader throws IOException close reader null public int read throws IOException if needAddSeparator int ret eolString charAt lastPos if lastPos eolString length lastPos needAddSeparator false return ret while getReader null int ch getReader read if ch nextReader if fixLastLine isMissingEndOfLine needAddSeparator true lastPos else addLastChar char ch return ch return public int read char cbuf int off int len throws IOException int amountRead while getReader null needAddSeparator if needAddSeparator cbuf off eolString charAt lastPos if lastPos eolString length lastPos needAddSeparator false len off amountRead if len return amountRead continue int nRead getReader read cbuf off len if nRead nRead nextReader if fixLastLine isMissingEndOfLine needAddSeparator true lastPos else if fixLastLine for int nRead nRead lastChars length if break addLastChar cbuf off len nRead off nRead amountRead nRead if len return amountRead if amountRead return else return amountRead public void close throws IOException if reader null reader close private void addLastChar char ch for int lastChars length lastChars lastChars lastChars lastChars length ch private boolean isMissingEndOfLine for int lastChars length if lastChars eolString charAt return true return false public class ScriptRunnerCreator private static final String AUTO private static final String OATAU private static final String UTIL_OPT OATAU private static final String BSF private static final String BSF_PACK private static final String BSF_MANAGER BSF_PACK private static final String BSF_RUNNER UTIL_OPT private static final String JAVAX private static final String JAVAX_MANAGER private static final String JAVAX_RUNNER UTIL_OPT private Project project private String manager private String language private ClassLoader scriptLoader null public ScriptRunnerCreator Project project this project project public ScriptRunnerBase createRunner String manager String language ClassLoader classLoader this manager manager this language language this scriptLoader classLoader if language null throw new BuildException if manager equals AUTO manager equals JAVAX manager equals BSF throw new BuildException manager ScriptRunnerBase ret null ret createRunner BSF BSF_MANAGER BSF_RUNNER if ret null ret createRunner JAVAX JAVAX_MANAGER JAVAX_RUNNER if ret null return ret if JAVAX equals manager throw new BuildException JAVAX_MANAGER else if BSF equals manager throw new BuildException BSF_MANAGER else throw new BuildException BSF_MANAGER JAVAX_MANAGER private ScriptRunnerBase createRunner String checkManager String managerClass String runnerClass ScriptRunnerBase runner null if manager equals AUTO manager equals checkManager return null if scriptLoader getResource LoaderUtils classNameToResource managerClass null return null try runner ScriptRunnerBase Class forName runnerClass true scriptLoader newInstance runner setProject project catch Exception ex ReflectUtil throwBuildException ex runner setLanguage language runner setScriptClassLoader scriptLoader return runner public class Content extends ResourceComparator private boolean binary true public void setBinary boolean binary public boolean isBinary return binary protected int resourceCompare Resource foo Resource bar try return ResourceUtils compareContent foo bar binary catch IOException throw new BuildException public class SSHUserInfo implements UserInfo UIKeyboardInteractive private String name private String password null private String keyfile private String passphrase null private boolean trustAllCertificates public SSHUserInfo super this trustAllCertificates false public SSHUserInfo String password boolean trustAllCertificates super this password password this trustAllCertificates trustAllCertificates public String getName return name public String getPassphrase String message return passphrase public String getPassword return password public boolean prompt String str return false public boolean retry return false public void setName String name this name name public void setPassphrase String passphrase this passphrase passphrase public void setPassword String password this password password public void setTrust boolean trust this trustAllCertificates trust public boolean getTrust return this trustAllCertificates public String getPassphrase return passphrase public String getKeyfile return keyfile public void setKeyfile String keyfile this keyfile keyfile public boolean promptPassphrase String message return true public boolean promptPassword String passwordPrompt return true public boolean promptYesNo String message return trustAllCertificates public void showMessage String message public String promptKeyboardInteractive String destination String name String instruction String prompt boolean echo if prompt length echo this password null return null String response new String response this password return response public final class JavaEnvUtils private JavaEnvUtils private static final boolean IS_DOS Os isFamily private static final boolean IS_NETWARE Os isName private static final boolean IS_AIX Os isName private static final String JAVA_HOME System getProperty private static final FileUtils FILE_UTILS FileUtils getFileUtils private static String javaVersion private static int javaVersionNumber public static final String JAVA_1_0 public static final String JAVA_1_1 public static final String JAVA_1_2 public static final String JAVA_1_3 public static final String JAVA_1_4 public static final String JAVA_1_5 public static final String JAVA_1_6 private static boolean kaffeDetected private static Vector jrePackages static try javaVersion JAVA_1_0 javaVersionNumber Class forName javaVersion JAVA_1_1 javaVersionNumber Class forName javaVersion JAVA_1_2 javaVersionNumber Class forName javaVersion JAVA_1_3 javaVersionNumber Class forName javaVersion JAVA_1_4 javaVersionNumber Class forName javaVersion JAVA_1_5 javaVersionNumber Class forName javaVersion JAVA_1_6 javaVersionNumber catch Throwable kaffeDetected false try Class forName kaffeDetected true catch Throwable public static String getJavaVersion return javaVersion public static int getJavaVersionNumber return javaVersionNumber public static boolean isJavaVersion String version return javaVersion equals version public static boolean isAtLeastJavaVersion String version return javaVersion compareTo version public static boolean isKaffe return kaffeDetected public static String getJreExecutable String command if IS_NETWARE return command File jExecutable null if IS_AIX jExecutable findInDir JAVA_HOME command if jExecutable null jExecutable findInDir JAVA_HOME command if jExecutable null return jExecutable getAbsolutePath else return addExtension command public static String getJdkExecutable String command if IS_NETWARE return command File jExecutable null if IS_AIX jExecutable findInDir JAVA_HOME command if jExecutable null jExecutable findInDir JAVA_HOME command if jExecutable null return jExecutable getAbsolutePath else return getJreExecutable command private static String addExtension String command return command IS_DOS private static File findInDir String dirName String commandName File dir FILE_UTILS normalize dirName File executable null if dir exists executable new File dir addExtension commandName if executable exists executable null return executable private static void buildJrePackages jrePackages new Vector switch javaVersionNumber case case jrePackages addElement case if javaVersionNumber jrePackages addElement jrePackages addElement jrePackages addElement jrePackages addElement jrePackages addElement jrePackages addElement jrePackages addElement case jrePackages addElement jrePackages addElement jrePackages addElement jrePackages addElement jrePackages addElement jrePackages addElement jrePackages addElement jrePackages addElement jrePackages addElement case jrePackages addElement jrePackages addElement case default jrePackages addElement jrePackages addElement jrePackages addElement break public static Vector getJrePackageTestCases Vector tests new Vector tests addElement switch javaVersionNumber case case tests addElement case tests addElement if javaVersionNumber tests addElement tests addElement tests addElement tests addElement tests addElement tests addElement tests addElement case tests addElement tests addElement tests addElement tests addElement tests addElement tests addElement tests addElement tests addElement case tests addElement tests addElement tests addElement case default tests addElement tests addElement tests addElement break return tests public static Vector getJrePackages if jrePackages null buildJrePackages return jrePackages public static File createVmsJavaOptionFile String cmd throws IOException File script FILE_UTILS createTempFile null PrintWriter out null try out new PrintWriter new BufferedWriter new FileWriter script for int cmd length out println cmd finally FileUtils close out return script public static String getJavaHome return JAVA_HOME public class XmlConstants public static final String PROPERTY_SCHEMA_LOCATION public static final String PROPERTY_NO_NAMESPACE_SCHEMA_LOCATION public static final String FEATURE_XSD_FULL_VALIDATION public static final String FEATURE_JAXP12_SCHEMA_LANGUAGE public static final String FEATURE_JAXP12_SCHEMA_SOURCE public static final String URI_XSD public static final String FEATURE_EXTERNAL_ENTITIES public static final String FEATURE_DISALLOW_DTD public abstract class Unpack extends Task protected File source protected File dest protected Resource srcResource public void setSrc String src log setSrc getProject resolveFile src public void setDest String dest log setDest getProject resolveFile dest public void setSrc File src setSrcResource new FileResource src public void setSrcResource Resource src if src isExists throw new BuildException if src isDirectory throw new BuildException if src instanceof FileResource source FileResource src getFile else if supportsNonFileResources throw new BuildException srcResource src public void addConfigured ResourceCollection if size throw new BuildException setSrcResource Resource iterator next public void setDest File dest this dest dest private void validate throws BuildException if srcResource null throw new BuildException getLocation if dest null dest new File source getParent if dest isDirectory String defaultExtension getDefaultExtension createDestFile defaultExtension private void createDestFile String defaultExtension String sourceName source getName int len sourceName length if defaultExtension null len defaultExtension length defaultExtension equalsIgnoreCase sourceName substring len defaultExtension length dest new File dest sourceName substring len defaultExtension length else dest new File dest sourceName public void execute throws BuildException try validate extract finally dest savedDest protected abstract String getDefaultExtension protected abstract void extract protected boolean supportsNonFileResources return false public interface ExtensionResolver File resolve Extension extension Project project throws BuildException public class TarUtils public static long parseOctal byte header int offset int length long result boolean stillPadding true int end offset length for int offset end if header break if header byte header if stillPadding continue if header byte break stillPadding false result result header return result public static StringBuffer parseName byte header int offset int length StringBuffer result new StringBuffer length int end offset length for int offset end if header break result append char header return result public static int getNameBytes StringBuffer name byte buf int offset int length int for length name length buf offset byte name charAt for length buf offset return offset length public static int getOctalBytes long value byte buf int offset int length int idx length buf offset idx idx buf offset idx byte idx if value buf offset idx byte idx else for long val value idx val idx buf offset idx byte byte byte val val val for idx idx buf offset idx byte return offset length public static int getLongOctalBytes long value byte buf int offset int length byte temp new byte length getOctalBytes value temp length System arraycopy temp buf offset length return offset length public static int getCheckSumOctalBytes long value byte buf int offset int length getOctalBytes value buf offset length buf offset length byte buf offset length return offset length public static long computeCheckSum byte buf long sum for int buf length sum buf return sum public interface UnixStat int PERM_MASK int LINK_FLAG int FILE_FLAG int DIR_FLAG int DEFAULT_LINK_PERM int DEFAULT_DIR_PERM int DEFAULT_FILE_PERM public class Type implements ResourceSelector private static final String FILE_ATTR private static final String DIR_ATTR public static final Type FILE new Type new FileDir FILE_ATTR public static final Type DIR new Type new FileDir DIR_ATTR public static class FileDir extends EnumeratedAttribute private static final String VALUES new String FILE_ATTR DIR_ATTR public FileDir public FileDir String value setValue value public String getValues return VALUES private FileDir type null public Type public Type FileDir fd setType fd public void setType FileDir fd type fd public boolean isSelected Resource if type null throw new BuildException int type getIndex return isDirectory public class FileList extends DataType implements ResourceCollection private Vector filenames new Vector private File dir public FileList super protected FileList FileList filelist this dir filelist dir this filenames filelist filenames setProject filelist getProject public void setRefid Reference throws BuildException if dir null filenames size throw tooManyAttributes super setRefid public void setDir File dir throws BuildException checkAttributesAllowed this dir dir public File getDir Project if isReference return getRef getDir return dir public void setFiles String filenames checkAttributesAllowed if filenames null filenames length StringTokenizer tok new StringTokenizer filenames false while tok hasMoreTokens this filenames addElement tok nextToken public String getFiles Project if isReference return getRef getFiles if dir null throw new BuildException if filenames size throw new BuildException String result new String filenames size filenames copyInto result return result protected FileList getRef Project return FileList getCheckedRef public static class FileName private String name public void setName String name this name name public String getName return name public void addConfiguredFile FileName name if name getName null throw new BuildException filenames addElement name getName public Iterator iterator if isReference return FileList getRef getProject iterator return new FileResourceIterator dir String filenames toArray new String filenames size public int size if isReference return FileList getRef getProject size return filenames size public boolean isFilesystemOnly return true public class TraXLiaison implements XSLTLiaison3 ErrorListener XSLTLoggerAware private static final FileUtils FILE_UTILS FileUtils getFileUtils private Project project private String factoryName null private TransformerFactory tfactory null private Resource stylesheet private XSLTLogger logger private EntityResolver entityResolver private Transformer transformer private Templates templates private long templatesModTime private URIResolver uriResolver private Vector outputProperties new Vector private Hashtable params new Hashtable private Vector attributes new Vector public TraXLiaison throws Exception public void setStylesheet File stylesheet throws Exception FileResource fr new FileResource fr setProject project fr setFile stylesheet setStylesheet fr public void setStylesheet Resource stylesheet throws Exception if this stylesheet null transformer null if this stylesheet equals stylesheet stylesheet getLastModified templatesModTime templates null this stylesheet stylesheet public void transform File infile File outfile throws Exception if transformer null createTransformer InputStream fis null OutputStream fos null try fis new BufferedInputStream new FileInputStream infile fos new BufferedOutputStream new FileOutputStream outfile StreamResult res new StreamResult fos res setSystemId JAXPUtils getSystemId outfile Source src getSource fis infile setTransformationParameters transformer transform src res finally try if fis null fis close catch IOException ignored try if fos null fos close catch IOException ignored private Source getSource InputStream is File infile throws ParserConfigurationException SAXException Source src null if entityResolver null if getFactory getFeature SAXSource FEATURE SAXParserFactory spFactory SAXParserFactory newInstance spFactory setNamespaceAware true XMLReader reader spFactory newSAXParser getXMLReader reader setEntityResolver entityResolver src new SAXSource reader new InputSource is else throw new IllegalStateException else src new StreamSource is src setSystemId JAXPUtils getSystemId infile return src private Source getSource InputStream is Resource resource throws ParserConfigurationException SAXException Source src null if entityResolver null if getFactory getFeature SAXSource FEATURE SAXParserFactory spFactory SAXParserFactory newInstance spFactory setNamespaceAware true XMLReader reader spFactory newSAXParser getXMLReader reader setEntityResolver entityResolver src new SAXSource reader new InputSource is else throw new IllegalStateException else src new StreamSource is src setSystemId resourceToURI resource return src private String resourceToURI Resource resource if resource instanceof FileResource File FileResource resource getFile return FILE_UTILS toURI getAbsolutePath if resource instanceof URLResource URL URLResource resource getURL return String valueOf else return resource getName private void readTemplates throws IOException TransformerConfigurationException ParserConfigurationException SAXException InputStream xslStream null try xslStream new BufferedInputStream stylesheet getInputStream templatesModTime stylesheet getLastModified Source src getSource xslStream stylesheet templates getFactory newTemplates src finally if xslStream null xslStream close private void createTransformer throws Exception if templates null readTemplates transformer templates newTransformer transformer setErrorListener this if uriResolver null transformer setURIResolver uriResolver for int outputProperties size final String pair String outputProperties elementAt transformer setOutputProperty pair pair private void setTransformationParameters for final Enumeration enumeration params keys enumeration hasMoreElements final String name String enumeration nextElement final String value String params get name transformer setParameter name value private TransformerFactory getFactory throws BuildException if tfactory null return tfactory if factoryName null tfactory TransformerFactory newInstance else try Class clazz Class forName factoryName tfactory TransformerFactory clazz newInstance catch Exception throw new BuildException tfactory setErrorListener this for int attributes size final Object pair Object attributes elementAt tfactory setAttribute String pair pair if uriResolver null tfactory setURIResolver uriResolver return tfactory public void setFactory String name factoryName name public void setAttribute String name Object value final Object pair new Object name value attributes addElement pair public void setOutputProperty String name String value final String pair new String name value outputProperties addElement pair public void setEntityResolver EntityResolver aResolver entityResolver aResolver public void setURIResolver URIResolver aResolver uriResolver aResolver public void addParam String name String value params put name value public void setLogger XSLTLogger logger public void error TransformerException logError public void fatalError TransformerException logError throw new BuildException public void warning TransformerException logError private void logError TransformerException String type if logger null return StringBuffer msg new StringBuffer SourceLocator locator getLocator if locator null String systemid locator getSystemId if systemid null String url systemid if url startsWith url FileUtils getFileUtils fromURI url msg append url else msg append int line locator getLineNumber if line msg append msg append line int column locator getColumnNumber if column msg append msg append column msg append msg append type msg append msg append getMessage if getCause null msg append msg append getCause logger log msg toString protected String getSystemId File file return JAXPUtils getSystemId file public void configure XSLTProcess xsltTask project xsltTask getProject XSLTProcess Factory factory xsltTask getFactory if factory null setFactory factory getName for Enumeration attrs factory getAttributes attrs hasMoreElements XSLTProcess Factory Attribute attr XSLTProcess Factory Attribute attrs nextElement setAttribute attr getName attr getValue XMLCatalog xmlCatalog xsltTask getXMLCatalog if xmlCatalog null setEntityResolver xmlCatalog setURIResolver xmlCatalog for Enumeration props xsltTask getOutputProperties props hasMoreElements XSLTProcess OutputProperty prop XSLTProcess OutputProperty props nextElement setOutputProperty prop getName prop getValue public class ExitException extends SecurityException private int status public ExitException int status super status this status status public ExitException String msg int status super msg this status status public int getStatus return status public class MimeMail extends EmailTask public void execute throws BuildException log getTaskName super execute public final class Locator public static final String URI_ENCODING private static boolean gNeedEscaping new boolean private static char gAfterEscaping1 new char private static char gAfterEscaping2 new char private static char gHexChs static for int gNeedEscaping true gAfterEscaping1 gHexChs gAfterEscaping2 gHexChs gNeedEscaping true gAfterEscaping1 gAfterEscaping2 char escChs int len escChs length char ch for int len ch escChs gNeedEscaping ch true gAfterEscaping1 ch gHexChs ch gAfterEscaping2 ch gHexChs ch private Locator public static File getClassSource Class String classResource getName replace return getResourceSource getClassLoader classResource public static File getResourceSource ClassLoader String resource if null Locator class getClassLoader URL url null if null url ClassLoader getSystemResource resource else url getResource resource if url null String url toString if startsWith int pling indexOf String jarName substring pling return new File fromURI jarName else if startsWith int tail indexOf resource String dirName substring tail return new File fromURI dirName return null public static String fromURI String uri Class uriClazz null try uriClazz Class forName catch ClassNotFoundException cnfe if uriClazz null uri startsWith try java lang reflect Method createMethod uriClazz getMethod new Class String class Object uriObj createMethod invoke null new Object uri java lang reflect Constructor fileConst File class getConstructor new Class uriClazz File File fileConst newInstance new Object uriObj return getAbsolutePath catch java lang reflect InvocationTargetException Throwable e2 getTargetException if e2 instanceof IllegalArgumentException throw IllegalArgumentException e2 else e2 printStackTrace catch Exception printStackTrace URL url null try url new URL uri catch MalformedURLException emYouEarlEx if url null equals url getProtocol throw new IllegalArgumentException StringBuffer buf new StringBuffer url getHost if buf length buf insert File separatorChar insert File separatorChar String file url getFile int queryPos file indexOf buf append queryPos file file substring queryPos uri buf toString replace File separatorChar if File pathSeparatorChar uri startsWith uri length Character isLetter uri charAt uri lastIndexOf uri uri substring String path null try path decodeUri uri String cwd System getProperty int posi cwd indexOf if posi path startsWith File separator path cwd substring posi path catch UnsupportedEncodingException exc throw new IllegalStateException exc getMessage return path public static String decodeUri String uri throws UnsupportedEncodingException if uri indexOf return uri ByteArrayOutputStream sb new ByteArrayOutputStream uri length CharacterIterator iter new StringCharacterIterator uri for char iter first CharacterIterator DONE iter next if char c1 iter next if c1 CharacterIterator DONE int i1 Character digit c1 char c2 iter next if c2 CharacterIterator DONE int i2 Character digit c2 sb write char i1 i2 else sb write return sb toString URI_ENCODING public static String encodeURI String path throws UnsupportedEncodingException int int len path length int ch StringBuffer sb null for len ch path charAt if ch break if gNeedEscaping ch if sb null sb new StringBuffer path substring sb append sb append gAfterEscaping1 ch sb append gAfterEscaping2 ch else if sb null sb append char ch if len if sb null sb new StringBuffer path substring byte bytes null byte bytes path substring getBytes URI_ENCODING len bytes length for len bytes if ch sb append sb append gHexChs ch sb append gHexChs ch else if gNeedEscaping sb append sb append gAfterEscaping1 sb append gAfterEscaping2 else sb append char return sb null path sb toString public static URL fileToURL File file throws MalformedURLException try return new URL encodeURI file toURL toString catch UnsupportedEncodingException ex throw new MalformedURLException ex toString public static File getToolsJar boolean toolsJarAvailable false try Class forName toolsJarAvailable true catch Exception try Class forName toolsJarAvailable true catch Exception e2 if toolsJarAvailable return null String javaHome System getProperty File toolsJar new File javaHome if toolsJar exists return toolsJar if javaHome toLowerCase Locale US endsWith File separator javaHome javaHome substring javaHome length toolsJar new File javaHome if toolsJar exists System out println toolsJar getPath return null return toolsJar public static URL getLocationURLs File location throws MalformedURLException return getLocationURLs location new String public static URL getLocationURLs File location final String extensions throws MalformedURLException URL urls new URL if location exists return urls if location isDirectory urls new URL String path location getPath for int extensions length if path toLowerCase endsWith extensions urls fileToURL location break return urls File matches location listFiles new FilenameFilter public boolean accept File dir String name for int extensions length if name toLowerCase endsWith extensions return true return false urls new URL matches length for int matches length urls fileToURL matches return urls public class IntegerCPInfo extends ConstantCPInfo public IntegerCPInfo super CONSTANT_INTEGER public void read DataInputStream cpStream throws IOException setValue new Integer cpStream readInt public String toString return getValue public class P4Labelsync extends P4Base protected String name public boolean isAdd return add public void setAdd boolean add this add add public boolean isDelete return delete public void setDelete boolean delete this delete delete public void setName String name this name name public boolean isSimulationmode return simulationmode public void setSimulationmode boolean simulationmode this simulationmode simulationmode public void execute throws BuildException log Project MSG_INFO if P4View null P4View length P4View StringUtils replace P4View P4View StringUtils replace P4View if P4View null P4View if name null name length throw new BuildException if this isSimulationmode P4CmdOpts P4CmdOpts if this isDelete P4CmdOpts P4CmdOpts if this isAdd P4CmdOpts P4CmdOpts execP4Command name P4CmdOpts P4View new SimpleP4OutputHandler this public class VisualBasicCompile extends DotnetCompile private boolean removeIntChecks false private boolean optionExplicit false private boolean optionStrict false private String optionCompare private String rootNamespace public VisualBasicCompile clear public void clear super clear rootNamespace null optionCompare null optionExplicit false optionStrict false removeIntChecks false setExecutable protected String getWin32ResParameter if getWin32Res null return getWin32Res toString else return null public void setRemoveIntChecks boolean flag removeIntChecks flag public boolean getRemoveIntChecks return removeIntChecks public String getRemoveIntChecksParameter return removeIntChecks public void setOptionExplicit boolean flag optionExplicit flag public boolean getOptionExplicit return optionExplicit public String getOptionExplicitParameter return optionExplicit public void setOptionStrict boolean flag optionStrict flag public boolean getOptionStrict return optionStrict public String getOptionStrictParameter return optionStrict public void setRootNamespace String rootNamespace this rootNamespace rootNamespace public String getRootNamespace return this rootNamespace protected String getRootNamespaceParameter if rootNamespace null rootNamespace length return rootNamespace else return null public String getImports protected String getImportsParameter else return null public void setOptionCompare String optionCompare if equalsIgnoreCase optionCompare this optionCompare else this optionCompare public String getOptionCompare return this optionCompare protected String getOptionCompareParameter if optionCompare null equalsIgnoreCase optionCompare return else return protected void addCompilerSpecificOptions NetCommand command command addArgument getRemoveIntChecksParameter command addArgument getImportsParameter command addArgument getOptionExplicitParameter command addArgument getOptionStrictParameter command addArgument getRootNamespaceParameter command addArgument getOptionCompareParameter public String getReferenceDelimiter return public String getFileExtension return protected void createResourceParameter NetCommand command DotnetResource resource resource getParameters getProject command false protected void validate throws BuildException super validate if getDestFile null throw new BuildException public class JarLibAvailableTask extends Task private File libraryFile private final Vector extensionFileSets new Vector private String propertyName private ExtensionAdapter requiredExtension public void setProperty final String property this propertyName property public void setFile final File file this libraryFile file public void addConfiguredExtension final ExtensionAdapter extension if null requiredExtension final String message throw new BuildException message requiredExtension extension public void addConfiguredExtensionSet final ExtensionSet extensionSet extensionFileSets addElement extensionSet public void execute throws BuildException validate final Extension test requiredExtension toExtension if extensionFileSets isEmpty final Iterator iterator extensionFileSets iterator while iterator hasNext final ExtensionSet extensionSet ExtensionSet iterator next final Extension extensions extensionSet toExtensions getProject for int extensions length final Extension extension extensions if extension isCompatibleWith test getProject setNewProperty propertyName else final Manifest manifest ExtensionUtil getManifest libraryFile final Extension extensions Extension getAvailable manifest for int extensions length final Extension extension extensions if extension isCompatibleWith test getProject setNewProperty propertyName private void validate throws BuildException if null requiredExtension final String message throw new BuildException message if null libraryFile extensionFileSets isEmpty final String message throw new BuildException message if null libraryFile libraryFile exists final String message libraryFile throw new BuildException message if null libraryFile libraryFile isFile final String message libraryFile throw new BuildException message public interface DynamicElement Object createDynamicElement String name throws BuildException public class Header private String name private String value public void setName String name this name name public String getName return name public void setValue String value this value value public String getValue return value public class Tstamp extends Task private Vector customFormats new Vector private String prefix public void setPrefix String prefix this prefix prefix if this prefix endsWith this prefix public void execute throws BuildException try Date new Date Enumeration customFormats elements while hasMoreElements CustomFormat cts CustomFormat nextElement cts execute getProject getLocation SimpleDateFormat dstamp new SimpleDateFormat setProperty dstamp format SimpleDateFormat tstamp new SimpleDateFormat setProperty tstamp format SimpleDateFormat today new SimpleDateFormat Locale US setProperty today format catch Exception throw new BuildException public CustomFormat createFormat CustomFormat cts new CustomFormat customFormats addElement cts return cts private void setProperty String name String value getProject setNewProperty prefix name value public class CustomFormat private TimeZone timeZone private String propertyName private String pattern private String language private String country private String variant private int offset private int field Calendar DATE public CustomFormat public void setProperty String propertyName this propertyName propertyName public void setPattern String pattern this pattern pattern public void setLocale String locale StringTokenizer st new StringTokenizer locale try language st nextToken if st hasMoreElements country st nextToken if st hasMoreElements variant st nextToken if st hasMoreElements throw new BuildException getLocation else country catch NoSuchElementException throw new BuildException getLocation public void setTimezone String id timeZone TimeZone getTimeZone id public void setOffset int offset this offset offset public void setUnit String unit log Unit new Unit setValue unit field getCalendarField public void setUnit Unit unit field unit getCalendarField public void execute Project project Date date Location location if propertyName null throw new BuildException location if pattern null throw new BuildException location SimpleDateFormat sdf if language null sdf new SimpleDateFormat pattern else if variant null sdf new SimpleDateFormat pattern new Locale language country else sdf new SimpleDateFormat pattern new Locale language country variant if offset Calendar calendar Calendar getInstance calendar setTime date calendar add field offset date calendar getTime if timeZone null sdf setTimeZone timeZone Tstamp this setProperty propertyName sdf format date public static class Unit extends EnumeratedAttribute private static final String MILLISECOND private static final String SECOND private static final String MINUTE private static final String HOUR private static final String DAY private static final String WEEK private static final String MONTH private static final String YEAR private static final String UNITS MILLISECOND SECOND MINUTE HOUR DAY WEEK MONTH YEAR private Map calendarFields new HashMap public Unit calendarFields put MILLISECOND new Integer Calendar MILLISECOND calendarFields put SECOND new Integer Calendar SECOND calendarFields put MINUTE new Integer Calendar MINUTE calendarFields put HOUR new Integer Calendar HOUR_OF_DAY calendarFields put DAY new Integer Calendar DATE calendarFields put WEEK new Integer Calendar WEEK_OF_YEAR calendarFields put MONTH new Integer Calendar MONTH calendarFields put YEAR new Integer Calendar YEAR public int getCalendarField String key getValue toLowerCase Integer Integer calendarFields get key return intValue public String getValues return UNITS public class SoundTask extends Task private BuildAlert success null private BuildAlert fail null public BuildAlert createSuccess success new BuildAlert return success public BuildAlert createFail fail new BuildAlert return fail public SoundTask public void init public void execute AntSoundPlayer soundPlayer new AntSoundPlayer if success null log Project MSG_WARN else soundPlayer addBuildSuccessfulSound success getSource success getLoops success getDuration if fail null log Project MSG_WARN else soundPlayer addBuildFailedSound fail getSource fail getLoops fail getDuration getProject addBuildListener soundPlayer public class BuildAlert private File source null private int loops private Long duration null public void setDuration Long duration this duration duration public void setSource File source this source source public void setLoops int loops this loops loops public File getSource File nofile null if source exists if source isDirectory String entries source list Vector files new Vector for int entries length File new File source entries if isFile files addElement if files size throw new BuildException source int numfiles files size Random rn new Random int rn nextInt numfiles this source File files elementAt else log source Project MSG_WARN this source nofile return this source public int getLoops return this loops public Long getDuration return this duration public class JJDoc extends Task private static final String OUTPUT_FILE private static final String TEXT private static final String ONE_TABLE private final Hashtable optionalAttrs new Hashtable private String outputFile null private boolean plainText false private static final String DEFAULT_SUFFIX_HTML private static final String DEFAULT_SUFFIX_TEXT private File targetFile null private File javaccHome null private CommandlineJava cmdl new CommandlineJava public void setText boolean plainText optionalAttrs put TEXT plainText Boolean TRUE Boolean FALSE this plainText plainText public void setOnetable boolean oneTable optionalAttrs put ONE_TABLE oneTable Boolean TRUE Boolean FALSE public void setOutputfile String outputFile this outputFile outputFile public void setTarget File target this targetFile target public void setJavacchome File javaccHome this javaccHome javaccHome public JJDoc cmdl setVm JavaEnvUtils getJreExecutable public void execute throws BuildException Enumeration iter optionalAttrs keys while iter hasMoreElements String name String iter nextElement Object value optionalAttrs get name cmdl createArgument setValue name value toString if targetFile null targetFile isFile throw new BuildException targetFile if outputFile null cmdl createArgument setValue OUTPUT_FILE outputFile replace File javaFile new File createOutputFileName targetFile outputFile plainText if javaFile exists targetFile lastModified javaFile lastModified log targetFile Project MSG_VERBOSE return cmdl createArgument setValue targetFile getAbsolutePath final Path classpath cmdl createClasspath getProject final File javaccJar JavaCC getArchiveFile javaccHome classpath createPathElement setPath javaccJar getAbsolutePath classpath addJavaRuntime cmdl setClassname JavaCC getMainClass classpath JavaCC TASKDEF_TYPE_JJDOC final Commandline Argument arg cmdl createVmArgument arg setValue arg setValue javaccHome getAbsolutePath final Execute process new Execute new LogStreamHandler this Project MSG_INFO Project MSG_INFO null log cmdl describeCommand Project MSG_VERBOSE process setCommandline cmdl getCommandline try if process execute throw new BuildException catch IOException throw new BuildException private String createOutputFileName File destFile String optionalOutputFile boolean plain String suffix DEFAULT_SUFFIX_HTML String javaccFile destFile getAbsolutePath replace if plain suffix DEFAULT_SUFFIX_TEXT if optionalOutputFile null optionalOutputFile equals int filePos javaccFile lastIndexOf if filePos javaccFile javaccFile substring filePos int suffixPos javaccFile lastIndexOf if suffixPos optionalOutputFile javaccFile suffix else String currentSuffix javaccFile substring suffixPos if currentSuffix equals suffix optionalOutputFile javaccFile suffix else optionalOutputFile javaccFile substring suffixPos suffix else optionalOutputFile optionalOutputFile replace return getProject getBaseDir optionalOutputFile replace public interface Cache boolean isValid void delete void load void save Object get Object key void put Object key Object value Iterator iterator public class TarFileSet extends ArchiveFileSet private boolean userNameSet private boolean groupNameSet private boolean userIdSet private boolean groupIdSet private String userName private String groupName private int uid private int gid public TarFileSet super protected TarFileSet FileSet fileset super fileset protected TarFileSet TarFileSet fileset super fileset public void setUserName String userName checkTarFileSetAttributesAllowed userNameSet true this userName userName public String getUserName if isReference return TarFileSet getCheckedRef getUserName return userName public boolean hasUserNameBeenSet return userNameSet public void setUid int uid checkTarFileSetAttributesAllowed userIdSet true this uid uid public int getUid if isReference return TarFileSet getCheckedRef getUid return uid public boolean hasUserIdBeenSet return userIdSet public void setGroup String groupName checkTarFileSetAttributesAllowed groupNameSet true this groupName groupName public String getGroup if isReference return TarFileSet getCheckedRef getGroup return groupName public boolean hasGroupBeenSet return groupNameSet public void setGid int gid checkTarFileSetAttributesAllowed groupIdSet true this gid gid public int getGid if isReference return TarFileSet getCheckedRef getGid return gid public boolean hasGroupIdBeenSet return groupIdSet protected ArchiveScanner newArchiveScanner TarScanner zs new TarScanner return zs public void setRefid Reference throws BuildException if userNameSet userIdSet groupNameSet groupIdSet throw tooManyAttributes super setRefid protected AbstractFileSet getRef Project dieOnCircularReference Object getRefid getReferencedObject if instanceof TarFileSet return AbstractFileSet else if instanceof FileSet TarFileSet zfs new TarFileSet FileSet configureFileSet zfs return zfs else String msg getRefid getRefId throw new BuildException msg protected void configureFileSet ArchiveFileSet zfs super configureFileSet zfs if zfs instanceof TarFileSet TarFileSet tfs TarFileSet zfs tfs setUserName userName tfs setGroup groupName tfs setUid uid tfs setGid gid public Object clone if isReference return TarFileSet getRef getProject clone else return super clone private void checkTarFileSetAttributesAllowed if getProject null isReference getRefid getReferencedObject getProject instanceof TarFileSet checkAttributesAllowed public class JonasDeploymentTool extends GenericDeploymentTool protected static final String EJB_JAR_1_1_PUBLIC_ID protected static final String EJB_JAR_2_0_PUBLIC_ID protected static final String JONAS_EJB_JAR_2_4_PUBLIC_ID protected static final String JONAS_EJB_JAR_2_5_PUBLIC_ID protected static final String RMI_ORB protected static final String JEREMIE_ORB protected static final String DAVID_ORB protected static final String EJB_JAR_1_1_DTD protected static final String EJB_JAR_2_0_DTD protected static final String JONAS_EJB_JAR_2_4_DTD protected static final String JONAS_EJB_JAR_2_5_DTD protected static final String JONAS_DD protected static final String GENIC_CLASS protected static final String OLD_GENIC_CLASS_1 protected static final String OLD_GENIC_CLASS_2 private String descriptorName private String jonasDescriptorName private File outputdir private boolean keepgenerated false private boolean nocompil false private boolean novalidation false private String javac private String javacopts private String rmicopts private boolean secpropag false private boolean verbose false private String additionalargs private File jonasroot private boolean keepgeneric false private String suffix private String orb private boolean nogenic false public void setKeepgenerated boolean aBoolean keepgenerated aBoolean public void setAdditionalargs String aString additionalargs aString public void setNocompil boolean aBoolean nocompil aBoolean public void setNovalidation boolean aBoolean novalidation aBoolean public void setJavac String aString javac aString public void setJavacopts String aString javacopts aString public void setRmicopts String aString rmicopts aString public void setSecpropag boolean aBoolean secpropag aBoolean public void setVerbose boolean aBoolean verbose aBoolean public void setJonasroot File aFile jonasroot aFile public void setKeepgeneric boolean aBoolean keepgeneric aBoolean public void setJarsuffix String aString suffix aString public void setOrb String aString orb aString public void setNogenic boolean aBoolean nogenic aBoolean public void processDescriptor String aDescriptorName SAXParser saxParser descriptorName aDescriptorName log descriptorName Project MSG_VERBOSE super processDescriptor descriptorName saxParser if outputdir null log outputdir Project MSG_VERBOSE deleteAllFiles outputdir protected void writeJar String baseName File jarfile Hashtable ejbFiles String publicId throws BuildException File genericJarFile super getVendorOutputJarFile baseName super writeJar baseName genericJarFile ejbFiles publicId addGenICGeneratedFiles genericJarFile ejbFiles super writeJar baseName getVendorOutputJarFile baseName ejbFiles publicId if keepgeneric log genericJarFile toString Project MSG_VERBOSE genericJarFile delete protected void addVendorFiles Hashtable ejbFiles String ddPrefix jonasDescriptorName getJonasDescriptorName File jonasDD new File getConfig descriptorDir jonasDescriptorName if jonasDD exists ejbFiles put META_DIR JONAS_DD jonasDD else log jonasDD getPath Project MSG_WARN protected File getVendorOutputJarFile String baseName return new File getDestDir baseName suffix private String getJonasDescriptorName int startOfFileName descriptorName lastIndexOf File separatorChar if startOfFileName path descriptorName substring startOfFileName fileName descriptorName substring startOfFileName else path fileName descriptorName if fileName startsWith EJB_DD return path JONAS_DD int endOfBaseName descriptorName indexOf getConfig baseNameTerminator startOfFileName if endOfBaseName endOfBaseName descriptorName lastIndexOf if endOfBaseName endOfBaseName descriptorName length jonasConvention true baseName descriptorName substring startOfFileName endOfBaseName remainder descriptorName substring endOfBaseName if jonasConvention jonasDN path baseName else jonasDN path baseName remainder log descriptorName Project MSG_VERBOSE log jonasDN Project MSG_VERBOSE return jonasDN protected String getJarBaseName String descriptorFileName String baseName null if getConfig namingScheme getValue equals EjbJar NamingScheme DESCRIPTOR if descriptorFileName indexOf getConfig baseNameTerminator String aCanonicalDescriptor descriptorFileName replace int lastSeparatorIndex aCanonicalDescriptor lastIndexOf int endOfBaseName if lastSeparatorIndex endOfBaseName descriptorFileName indexOf lastSeparatorIndex else endOfBaseName descriptorFileName indexOf if endOfBaseName baseName descriptorFileName substring endOfBaseName if baseName null baseName super getJarBaseName descriptorFileName log baseName Project MSG_VERBOSE return baseName protected void registerKnownDTDs DescriptorHandler handler handler registerDTD EJB_JAR_1_1_PUBLIC_ID jonasroot File separator File separator EJB_JAR_1_1_DTD handler registerDTD EJB_JAR_2_0_PUBLIC_ID jonasroot File separator File separator EJB_JAR_2_0_DTD handler registerDTD JONAS_EJB_JAR_2_4_PUBLIC_ID jonasroot File separator File separator JONAS_EJB_JAR_2_4_DTD handler registerDTD JONAS_EJB_JAR_2_5_PUBLIC_ID jonasroot File separator File separator JONAS_EJB_JAR_2_5_DTD private void addGenICGeneratedFiles File genericJarFile Hashtable ejbFiles if nogenic return genicTask new Java getTask genicTask setTaskName genicTask setFork true genicTask createJvmarg setValue jonasroot String jonasConfigDir jonasroot File separator File javaPolicyFile new File jonasConfigDir if javaPolicyFile exists genicTask createJvmarg setValue javaPolicyFile toString try outputdir createTempDir catch IOException aIOException String msg aIOException getMessage throw new BuildException msg aIOException log outputdir Project MSG_VERBOSE genicTask createArg setValue genicTask createArg setFile outputdir String key File Enumeration keys ejbFiles keys while keys hasMoreElements key String keys nextElement new File outputdir File separator key getParentFile mkdirs log Project MSG_VERBOSE Path classpath getCombinedClasspath if classpath null classpath new Path getTask getProject classpath append new Path classpath getProject jonasConfigDir classpath append new Path classpath getProject outputdir toString if orb null String orbJar jonasroot File separator File separator orb classpath append new Path classpath getProject orbJar log classpath toString Project MSG_VERBOSE genicTask setClasspath classpath genicClass getGenicClassName classpath if genicClass null log Project MSG_ERR throw new BuildException else log genicClass Project MSG_VERBOSE genicTask setClassname genicClass if keepgenerated genicTask createArg setValue if nocompil genicTask createArg setValue if novalidation genicTask createArg setValue if javac null genicTask createArg setValue genicTask createArg setLine javac if javacopts null javacopts equals genicTask createArg setValue genicTask createArg setLine javacopts if rmicopts null rmicopts equals genicTask createArg setValue genicTask createArg setLine rmicopts if secpropag genicTask createArg setValue if verbose genicTask createArg setValue if additionalargs null genicTask createArg setValue additionalargs genicTask createArg setValue genicTask createArg setValue genericJarFile getPath log genicClass getConfig descriptorDir File separator descriptorName Project MSG_VERBOSE if genicTask executeJava log outputdir Project MSG_VERBOSE deleteAllFiles outputdir if keepgeneric log genericJarFile toString Project MSG_VERBOSE genericJarFile delete throw new BuildException addAllFiles outputdir ejbFiles String getGenicClassName Path classpath log classpath toString Project MSG_VERBOSE AntClassLoader cl classpath getProject createClassLoader classpath try cl loadClass JonasDeploymentTool GENIC_CLASS log JonasDeploymentTool GENIC_CLASS Project MSG_VERBOSE return JonasDeploymentTool GENIC_CLASS catch ClassNotFoundException cnf1 log JonasDeploymentTool GENIC_CLASS Project MSG_VERBOSE try cl loadClass JonasDeploymentTool OLD_GENIC_CLASS_1 log JonasDeploymentTool OLD_GENIC_CLASS_1 Project MSG_VERBOSE return JonasDeploymentTool OLD_GENIC_CLASS_1 catch ClassNotFoundException cnf2 log JonasDeploymentTool OLD_GENIC_CLASS_1 Project MSG_VERBOSE try cl loadClass JonasDeploymentTool OLD_GENIC_CLASS_2 log JonasDeploymentTool OLD_GENIC_CLASS_2 Project MSG_VERBOSE return JonasDeploymentTool OLD_GENIC_CLASS_2 catch ClassNotFoundException cnf3 log JonasDeploymentTool OLD_GENIC_CLASS_2 Project MSG_VERBOSE return null protected void checkConfiguration String descriptorFileName SAXParser saxParser throws BuildException if jonasroot null throw new BuildException else if jonasroot isDirectory throw new BuildException jonasroot if orb null orb equals RMI_ORB orb equals JEREMIE_ORB orb equals DAVID_ORB throw new BuildException orb RMI_ORB JEREMIE_ORB DAVID_ORB if additionalargs null additionalargs equals throw new BuildException if javac null javac equals throw new BuildException private File createTempDir throws IOException File tmpDir File createTempFile null null tmpDir delete if tmpDir mkdir throw new IOException tmpDir return tmpDir private void deleteAllFiles File aFile if aFile isDirectory File someFiles aFile listFiles for int someFiles length deleteAllFiles someFiles aFile delete private void addAllFiles File file String rootDir Hashtable hashtable if file exists throw new IllegalArgumentException String newRootDir if file isDirectory File files file listFiles for int files length if rootDir length newRootDir rootDir File separator files getName else newRootDir files getName addAllFiles files newRootDir hashtable else hashtable put rootDir file public interface TarConstants int NAMELEN int MODELEN int UIDLEN int GIDLEN int CHKSUMLEN int SIZELEN long MAXSIZE int MAGICLEN int MODTIMELEN int UNAMELEN int GNAMELEN int DEVLEN byte LF_OLDNORM byte LF_NORMAL byte byte LF_LINK byte byte LF_SYMLINK byte byte LF_CHR byte byte LF_BLK byte byte LF_DIR byte byte LF_FIFO byte byte LF_CONTIG byte String TMAGIC String GNU_TMAGIC String GNU_LONGLINK byte LF_GNUTYPE_LONGNAME byte public class Sj extends DefaultCompilerAdapter public boolean execute throws BuildException attributes log Project MSG_VERBOSE Commandline cmd setupJavacCommand String exec getJavac getExecutable cmd setExecutable exec null exec int firstFileName cmd size compileList length return executeExternalCompile cmd getCommandline firstFileName protected String getNoDebugArgument return null public class P4Delete extends P4Base public String change null public void setChange String change this change change public void execute throws BuildException if change null P4CmdOpts change if P4View null throw new BuildException execP4Command P4CmdOpts P4View new SimpleP4OutputHandler this public class EchoProperties extends Task private static final String PROPERTIES private static final String PROPERTY private static final String ATTR_NAME private static final String ATTR_VALUE private File inFile null private File destfile null private boolean failonerror true private Vector propertySets new Vector private String format private String prefix private String regex public void setSrcfile File file inFile file public void setDestfile File destfile this destfile destfile public void setFailOnError boolean failonerror this failonerror failonerror public void setPrefix String prefix if prefix null prefix length this prefix prefix PropertySet ps new PropertySet ps setProject getProject ps appendPrefix prefix addPropertyset ps public void setRegex String regex if regex null regex length this regex regex PropertySet ps new PropertySet ps setProject getProject ps appendRegex regex addPropertyset ps public void addPropertyset PropertySet ps propertySets addElement ps public void setFormat FormatAttribute ea format ea getValue public static class FormatAttribute extends EnumeratedAttribute private String formats new String public String getValues return formats public void execute throws BuildException if prefix null regex null throw new BuildException getLocation Hashtable allProps new Hashtable if inFile null propertySets size allProps putAll getProject getProperties else if inFile null if inFile exists inFile isDirectory String message if failonerror throw new BuildException message getLocation else log message Project MSG_ERR return if inFile exists inFile canRead String message if failonerror throw new BuildException message getLocation else log message Project MSG_ERR return FileInputStream in null try in new FileInputStream inFile Properties props new Properties props load in allProps putAll props catch FileNotFoundException fnfe String message inFile getAbsolutePath if failonerror throw new BuildException message fnfe getLocation else log message Project MSG_WARN return catch IOException ioe String message inFile getAbsolutePath if failonerror throw new BuildException message ioe getLocation else log message Project MSG_WARN return finally FileUtils close in Enumeration propertySets elements while hasMoreElements PropertySet ps PropertySet nextElement allProps putAll ps getProperties OutputStream os null try if destfile null os new ByteArrayOutputStream saveProperties allProps os log os toString Project MSG_INFO else if destfile exists destfile isDirectory String message if failonerror throw new BuildException message getLocation else log message Project MSG_ERR return if destfile exists destfile canWrite String message if failonerror throw new BuildException message getLocation else log message Project MSG_ERR return os new FileOutputStream this destfile saveProperties allProps os catch IOException ioe if failonerror throw new BuildException ioe getLocation else log ioe getMessage Project MSG_INFO finally if os null try os close catch IOException ex protected void saveProperties Hashtable allProps OutputStream os throws IOException BuildException final List keyList new ArrayList allProps keySet Collections sort keyList Properties props new Properties public Enumeration keys return CollectionUtils asEnumeration keyList iterator public Set entrySet Set result super entrySet if JavaEnvUtils isKaffe TreeSet new TreeSet new Comparator public int compare Object o1 Object o2 String key1 String Map Entry o1 getKey String key2 String Map Entry o2 getKey return key1 compareTo key2 addAll result result return result for int keyList size String name keyList get toString String value allProps get name toString props setProperty name value if equals format jdkSaveProperties props os else if equals format xmlSaveProperties props os private static class Tuple implements Comparable private String key private String value private Tuple String key String value this key key this value value public int compareTo Object Tuple that Tuple return key compareTo that key private List sortProperties Properties props List sorted new ArrayList props size Enumeration props propertyNames while hasMoreElements String name String nextElement sorted add new Tuple name props getProperty name Collections sort sorted return sorted protected void xmlSaveProperties Properties props OutputStream os throws IOException Document doc getDocumentBuilder newDocument Element rootElement doc createElement PROPERTIES List sorted sortProperties props Iterator iten sorted iterator while iten hasNext Tuple tuple Tuple iten next Element propElement doc createElement PROPERTY propElement setAttribute ATTR_NAME tuple key propElement setAttribute ATTR_VALUE tuple value rootElement appendChild propElement Writer wri null try wri new OutputStreamWriter os wri write new DOMElementWriter write rootElement wri wri flush catch IOException ioe throw new BuildException ioe finally FileUtils close wri protected void jdkSaveProperties Properties props OutputStream os String header throws IOException try props store os header catch IOException ioe throw new BuildException ioe getLocation finally if os null try os close catch IOException ioex log private static DocumentBuilder getDocumentBuilder try return DocumentBuilderFactory newInstance newDocumentBuilder catch Exception throw new ExceptionInInitializerError public class Http extends ProjectComponent implements Condition private static final int ERROR_BEGINS private String spec null public void setUrl String url spec url private int errorsBeginAt ERROR_BEGINS public void setErrorsBeginAt int errorsBeginAt this errorsBeginAt errorsBeginAt public boolean eval throws BuildException if spec null throw new BuildException log spec Project MSG_VERBOSE try URL url new URL spec try URLConnection conn url openConnection if conn instanceof HttpURLConnection HttpURLConnection http HttpURLConnection conn int code http getResponseCode log spec code Project MSG_VERBOSE if code code errorsBeginAt return true return false catch java io IOException return false catch MalformedURLException throw new BuildException spec return true public class Rename extends Task private static final FileUtils FILE_UTILS FileUtils getFileUtils private File src private File dest private boolean replace true public void setSrc File src this src src public void setDest File dest this dest dest public void setReplace String replace this replace Project toBoolean replace public void execute throws BuildException log if dest null throw new BuildException getLocation if src null throw new BuildException getLocation if replace dest exists throw new BuildException dest try FILE_UTILS rename src dest catch IOException throw new BuildException src dest getLocation public interface ClassFileIterator ClassFile getNextClassFile public class Jikes protected JikesOutputParser jop protected String command protected Project project protected Jikes JikesOutputParser jop String command Project project super System err println System err println System err println this jop jop this command command this project project protected void compile String args String commandArray null File tmpFile null try String myos System getProperty if myos toLowerCase indexOf args length PrintWriter out null try String tempFileName new Random System currentTimeMillis nextLong tmpFile new File tempFileName out new PrintWriter new FileWriter tmpFile for int args length out println args out flush commandArray new String command tmpFile getAbsolutePath catch IOException throw new BuildException finally FileUtils close out else commandArray new String args length commandArray command System arraycopy args commandArray args length try Execute exe new Execute jop exe setAntRun project exe setWorkingDirectory project getBaseDir exe setCommandline commandArray exe execute catch IOException throw new BuildException finally if tmpFile null tmpFile delete public abstract class ConstantPoolEntry public static final int CONSTANT_UTF8 public static final int CONSTANT_INTEGER public static final int CONSTANT_FLOAT public static final int CONSTANT_LONG public static final int CONSTANT_DOUBLE public static final int CONSTANT_CLASS public static final int CONSTANT_STRING public static final int CONSTANT_FIELDREF public static final int CONSTANT_METHODREF public static final int CONSTANT_INTERFACEMETHODREF public static final int CONSTANT_NAMEANDTYPE private int tag private int numEntries private boolean resolved public ConstantPoolEntry int tagValue int entries tag tagValue numEntries entries resolved false public static ConstantPoolEntry readEntry DataInputStream cpStream throws IOException ConstantPoolEntry cpInfo null int cpTag cpStream readUnsignedByte switch cpTag case CONSTANT_UTF8 cpInfo new Utf8CPInfo break case CONSTANT_INTEGER cpInfo new IntegerCPInfo break case CONSTANT_FLOAT cpInfo new FloatCPInfo break case CONSTANT_LONG cpInfo new LongCPInfo break case CONSTANT_DOUBLE cpInfo new DoubleCPInfo break case CONSTANT_CLASS cpInfo new ClassCPInfo break case CONSTANT_STRING cpInfo new StringCPInfo break case CONSTANT_FIELDREF cpInfo new FieldRefCPInfo break case CONSTANT_METHODREF cpInfo new MethodRefCPInfo break case CONSTANT_INTERFACEMETHODREF cpInfo new InterfaceMethodRefCPInfo break case CONSTANT_NAMEANDTYPE cpInfo new NameAndTypeCPInfo break default throw new ClassFormatError cpTag cpInfo read cpStream return cpInfo public boolean isResolved return resolved public void resolve ConstantPool constantPool resolved true public abstract void read DataInputStream cpStream throws IOException public int getTag return tag public final int getNumEntries return numEntries public class P4OutputStream extends OutputStream private P4Handler handler private ByteArrayOutputStream buffer new ByteArrayOutputStream private boolean skip false public P4OutputStream P4Handler handler this handler handler public void write int cc throws IOException final byte byte cc if if skip processBuffer else buffer write cc skip protected void processBuffer handler process buffer toString buffer reset public void close throws IOException if buffer size processBuffer super close public class Matches extends ProjectComponent implements Condition private String string private boolean caseSensitive true private boolean multiLine false private boolean singleLine false private RegularExpression regularExpression public void setString String string this string string public void setPattern String pattern if regularExpression null throw new BuildException regularExpression new RegularExpression regularExpression setPattern pattern public void addRegexp RegularExpression regularExpression if this regularExpression null throw new BuildException this regularExpression regularExpression public void setCasesensitive boolean caseSensitive public void setMultiline boolean multiLine public void setSingleLine boolean singleLine public boolean eval throws BuildException if string null throw new BuildException if regularExpression null throw new BuildException int options RegexpMatcher MATCH_DEFAULT if caseSensitive options options RegexpMatcher MATCH_CASE_INSENSITIVE if multiLine options options RegexpMatcher MATCH_MULTILINE if singleLine options options RegexpMatcher MATCH_SINGLELINE Regexp regexp regularExpression getRegexp getProject return regexp matches string options public class Exec extends Task private String os private String out private File dir private String command protected PrintWriter fos null private boolean failOnError false public Exec System err println System err println System err println public void execute throws BuildException run command protected int run String command throws BuildException String myos System getProperty log myos Project MSG_VERBOSE if os null os indexOf myos log os Project MSG_VERBOSE return if dir null dir getProject getBaseDir if myos toLowerCase indexOf if dir equals getProject resolveFile if myos toLowerCase indexOf command dir command else String ant getProject getProperty MagicNames ANT_HOME if ant null throw new BuildException MagicNames ANT_HOME getLocation String antRun getProject resolveFile ant toString command antRun dir command else String ant getProject getProperty MagicNames ANT_HOME if ant null throw new BuildException MagicNames ANT_HOME getLocation String antRun getProject resolveFile ant toString command antRun dir command try log command Project MSG_VERBOSE Process proc Runtime getRuntime exec command if out null fos new PrintWriter new FileWriter out log out Project MSG_VERBOSE StreamPumper inputPumper new StreamPumper proc getInputStream Project MSG_INFO StreamPumper errorPumper new StreamPumper proc getErrorStream Project MSG_WARN inputPumper start errorPumper start proc waitFor inputPumper join errorPumper join proc destroy logFlush err proc exitValue if err if failOnError throw new BuildException err getLocation else log err Project MSG_ERR catch IOException ioe throw new BuildException command ioe getLocation catch InterruptedException ex return err public void setDir String this dir getProject resolveFile public void setOs String os this os os public void setCommand String command this command command public void setOutput String out this out out public void setFailonerror boolean fail failOnError fail protected void outputLog String line int messageLevel if fos null log line messageLevel else fos println line protected void logFlush if fos null fos close class StreamPumper extends Thread private BufferedReader din private int messageLevel private boolean endOfStream false private static final int SLEEP_TIME public StreamPumper InputStream is int messageLevel this din new BufferedReader new InputStreamReader is this messageLevel messageLevel public void pumpStream throws IOException if endOfStream String line din readLine if line null outputLog line messageLevel else endOfStream true public void run try try while endOfStream pumpStream sleep SLEEP_TIME catch InterruptedException ie din close catch IOException ioe public interface JspCompilerAdapter void setJspc JspC attributes boolean execute throws BuildException JspMangler createMangler boolean implementsOwnDependencyChecking public final class TaskLogger private Task task public TaskLogger final Task task this task task public void info final String message task log message Project MSG_INFO public void error final String message task log message Project MSG_ERR public void warning final String message task log message Project MSG_WARN public void verbose final String message task log message Project MSG_VERBOSE public void debug final String message task log message Project MSG_DEBUG public class BriefJUnitResultFormatter implements JUnitResultFormatter private OutputStream out private PrintWriter output private StringWriter results private PrintWriter resultWriter private NumberFormat numberFormat NumberFormat getInstance private String systemOutput null private String systemError null public BriefJUnitResultFormatter results new StringWriter resultWriter new PrintWriter results public void setOutput OutputStream out this out out output new PrintWriter out public void setSystemOutput String out systemOutput out public void setSystemError String err systemError err public void startTestSuite JUnitTest suite if output null StringBuffer sb new StringBuffer sb append suite getName sb append StringUtils LINE_SEP output write sb toString output flush public void endTestSuite JUnitTest suite StringBuffer sb new StringBuffer sb append suite runCount sb append sb append suite failureCount sb append sb append suite errorCount sb append sb append numberFormat format suite getRunTime sb append sb append StringUtils LINE_SEP sb append StringUtils LINE_SEP if systemOutput null systemOutput length sb append append StringUtils LINE_SEP append systemOutput append append StringUtils LINE_SEP if systemError null systemError length sb append append StringUtils LINE_SEP append systemError append append StringUtils LINE_SEP if output null try output write sb toString resultWriter close output write results toString output flush finally if out System out out System err FileUtils close out public void startTest Test test public void endTest Test test public void addFailure Test test Throwable formatError test public void addFailure Test test AssertionFailedError addFailure test Throwable public void addError Test test Throwable error formatError test error protected String formatTest Test test if test null return else return test toString protected synchronized void formatError String type Test test Throwable error if test null endTest test resultWriter println formatTest test type resultWriter println error getMessage String strace JUnitTestRunner getFilteredTrace error resultWriter println strace resultWriter println public class FilesMatch implements Condition private static final FileUtils FILE_UTILS FileUtils getFileUtils private File file1 file2 private boolean textfile false public void setFile1 File file1 this file1 file1 public void setFile2 File file2 this file2 file2 public void setTextfile boolean textfile this textfile textfile public boolean eval throws BuildException if file1 null file2 null throw new BuildException boolean matches false try matches FILE_UTILS contentEquals file1 file2 textfile catch IOException ioe throw new BuildException ioe getMessage ioe return matches public class CCRmtype extends ClearCase private String mTypeKind null private String mTypeName null private String mVOB null private String mComment null private String mCfile null private boolean mRmall false private boolean mIgnore false public void execute throws BuildException Commandline commandLine new Commandline int result if getTypeKind null throw new BuildException if getTypeName null throw new BuildException commandLine setExecutable getClearToolCommand commandLine createArgument setValue COMMAND_RMTYPE checkOptions commandLine if getFailOnErr getProject log getTypeSpecifier Project MSG_VERBOSE result run commandLine if Execute isFailure result getFailOnErr String msg commandLine toString throw new BuildException msg getLocation private void checkOptions Commandline cmd if getIgnore cmd createArgument setValue FLAG_IGNORE if getRmAll cmd createArgument setValue FLAG_RMALL cmd createArgument setValue FLAG_FORCE if getComment null getCommentCommand cmd else if getCommentFile null getCommentFileCommand cmd else cmd createArgument setValue FLAG_NOCOMMENT cmd createArgument setValue getTypeSpecifier public void setIgnore boolean ignore mIgnore ignore public boolean getIgnore return mIgnore public void setRmAll boolean rmall mRmall rmall public boolean getRmAll return mRmall public void setComment String comment mComment comment public String getComment return mComment public void setCommentFile String cfile mCfile cfile public String getCommentFile return mCfile public void setTypeKind String tk mTypeKind tk public String getTypeKind return mTypeKind public void setTypeName String tn mTypeName tn public String getTypeName return mTypeName public void setVOB String vob mVOB vob public String getVOB return mVOB private String getTypeSpecifier String tkind getTypeKind String tname getTypeName String typeSpec null typeSpec tkind tname if getVOB null typeSpec getVOB return typeSpec private void getCommentCommand Commandline cmd if getComment null cmd createArgument setValue FLAG_COMMENT cmd createArgument setValue getComment private void getCommentFileCommand Commandline cmd if getCommentFile null cmd createArgument setValue FLAG_COMMENTFILE cmd createArgument setValue getCommentFile public static final String FLAG_IGNORE public static final String FLAG_RMALL public static final String FLAG_FORCE public static final String FLAG_COMMENT public static final String FLAG_COMMENTFILE public static final String FLAG_NOCOMMENT public class PackageNameMapper extends GlobPatternMapper protected String extractVariablePart String name String var name substring prefixLength name length postfixLength return var replace File separatorChar public final class SelectorUtils private static SelectorUtils instance new SelectorUtils private static final FileUtils FILE_UTILS FileUtils getFileUtils private SelectorUtils public static SelectorUtils getInstance return instance public static boolean matchPatternStart String pattern String str return matchPatternStart pattern str true public static boolean matchPatternStart String pattern String str boolean isCaseSensitive if str startsWith File separator pattern startsWith File separator return false String patDirs tokenizePathAsArray pattern String strDirs tokenizePathAsArray str int patIdxStart int patIdxEnd patDirs length int strIdxStart int strIdxEnd strDirs length while patIdxStart patIdxEnd strIdxStart strIdxEnd String patDir patDirs patIdxStart if patDir equals break if match patDir strDirs strIdxStart isCaseSensitive return false patIdxStart strIdxStart if strIdxStart strIdxEnd return true else if patIdxStart patIdxEnd return false else return true public static boolean matchPath String pattern String str return matchPath pattern str true public static boolean matchPath String pattern String str boolean isCaseSensitive String patDirs tokenizePathAsArray pattern String strDirs tokenizePathAsArray str int patIdxStart int patIdxEnd patDirs length int strIdxStart int strIdxEnd strDirs length while patIdxStart patIdxEnd strIdxStart strIdxEnd String patDir patDirs patIdxStart if patDir equals break if match patDir strDirs strIdxStart isCaseSensitive patDirs null strDirs null return false patIdxStart strIdxStart if strIdxStart strIdxEnd for int patIdxStart patIdxEnd if patDirs equals patDirs null strDirs null return false return true else if patIdxStart patIdxEnd patDirs null strDirs null return false while patIdxStart patIdxEnd strIdxStart strIdxEnd String patDir patDirs patIdxEnd if patDir equals break if match patDir strDirs strIdxEnd isCaseSensitive patDirs null strDirs null return false patIdxEnd strIdxEnd if strIdxStart strIdxEnd for int patIdxStart patIdxEnd if patDirs equals patDirs null strDirs null return false return true while patIdxStart patIdxEnd strIdxStart strIdxEnd int patIdxTmp for int patIdxStart patIdxEnd if patDirs equals patIdxTmp break if patIdxTmp patIdxStart patIdxStart continue int patLength patIdxTmp patIdxStart int strLength strIdxEnd strIdxStart int foundIdx strLoop for int strLength patLength for int patLength String subPat patDirs patIdxStart String subStr strDirs strIdxStart if match subPat subStr isCaseSensitive continue strLoop foundIdx strIdxStart break if foundIdx patDirs null strDirs null return false patIdxStart patIdxTmp strIdxStart foundIdx patLength for int patIdxStart patIdxEnd if patDirs equals patDirs null strDirs null return false return true public static boolean match String pattern String str return match pattern str true public static boolean match String pattern String str boolean isCaseSensitive char patArr pattern toCharArray char strArr str toCharArray int patIdxStart int patIdxEnd patArr length int strIdxStart int strIdxEnd strArr length char ch boolean containsStar false for int patArr length if patArr containsStar true break if containsStar if patIdxEnd strIdxEnd for int patIdxEnd ch patArr if ch if isCaseSensitive ch strArr if isCaseSensitive Character toUpperCase ch Character toUpperCase strArr if patIdxEnd while ch patArr patIdxStart strIdxStart strIdxEnd if ch if isCaseSensitive ch strArr strIdxStart if isCaseSensitive Character toUpperCase ch Character toUpperCase strArr strIdxStart patIdxStart strIdxStart if strIdxStart strIdxEnd for int patIdxStart patIdxEnd if patArr return false return true while ch patArr patIdxEnd strIdxStart strIdxEnd if ch if isCaseSensitive ch strArr strIdxEnd if isCaseSensitive Character toUpperCase ch Character toUpperCase strArr strIdxEnd patIdxEnd strIdxEnd if strIdxStart strIdxEnd for int patIdxStart patIdxEnd if patArr return false return true while patIdxStart patIdxEnd strIdxStart strIdxEnd int patIdxTmp for int patIdxStart patIdxEnd if patArr patIdxTmp break if patIdxTmp patIdxStart patIdxStart continue int patLength patIdxTmp patIdxStart int strLength strIdxEnd strIdxStart int foundIdx strLoop for int strLength patLength for int patLength ch patArr patIdxStart if ch if isCaseSensitive ch strArr strIdxStart continue strLoop if isCaseSensitive Character toUpperCase ch Character toUpperCase strArr strIdxStart continue strLoop foundIdx strIdxStart break if foundIdx return false patIdxStart patIdxTmp strIdxStart foundIdx patLength for int patIdxStart patIdxEnd if patArr return false return true public static Vector tokenizePath String path return tokenizePath path File separator public static Vector tokenizePath String path String separator Vector ret new Vector if FileUtils isAbsolutePath path String FILE_UTILS dissect path ret add path StringTokenizer st new StringTokenizer path separator while st hasMoreTokens ret addElement st nextToken return ret private static String tokenizePathAsArray String path String root null if FileUtils isAbsolutePath path String FILE_UTILS dissect path root path char sep File separatorChar int start int len path length int count for int pos pos len pos if path charAt pos sep if pos start count start pos if len start count String new String count root null if root null root count else count start for int pos pos len pos if path charAt pos sep if pos start String tok path substring start pos count tok start pos if len start String tok path substring start return public static boolean isOutOfDate File src File target int granularity if src exists return false if target exists return true if src lastModified granularity target lastModified return true return false public static boolean isOutOfDate Resource src Resource target int granularity return isOutOfDate src target long granularity public static boolean isOutOfDate Resource src Resource target long granularity if src isExists return false if target isExists return true if src getLastModified granularity target getLastModified return true return false public static String removeWhitespace String input StringBuffer result new StringBuffer if input null StringTokenizer st new StringTokenizer input while st hasMoreTokens result append st nextToken return result toString public static boolean hasWildcards String input return input indexOf input indexOf public static String rtrimWildcardTokens String input String tokens tokenizePathAsArray input StringBuffer sb new StringBuffer for int tokens length if hasWildcards tokens break if sb charAt sb length File separatorChar sb append File separator sb append tokens return sb toString public class Javah extends Task private Vector classes new Vector private String cls private File destDir private Path classpath null private File outputFile null private boolean verbose false private boolean force false private boolean old false private boolean stubs false private Path bootclasspath private static String lSep System getProperty private FacadeTaskHelper facade null public Javah facade new FacadeTaskHelper JavahAdapterFactory getDefault public void setClass String cls this cls cls public ClassArgument createClass ClassArgument ga new ClassArgument classes addElement ga return ga public class ClassArgument private String name public ClassArgument public void setName String name this name name public String getName return name public String getClasses ArrayList al new ArrayList if cls null StringTokenizer tok new StringTokenizer cls false while tok hasMoreTokens al add tok nextToken trim Enumeration classes elements while hasMoreElements ClassArgument arg ClassArgument nextElement al add arg getName return String al toArray new String al size public void setDestdir File destDir this destDir destDir public File getDestdir return destDir public void setClasspath Path src if classpath null classpath src else classpath append src public Path createClasspath if classpath null classpath new Path getProject return classpath createPath public void setClasspathRef Reference createClasspath setRefid public Path getClasspath return classpath public void setBootclasspath Path src if bootclasspath null bootclasspath src else bootclasspath append src public Path createBootclasspath if bootclasspath null bootclasspath new Path getProject return bootclasspath createPath public void setBootClasspathRef Reference createBootclasspath setRefid public Path getBootclasspath return bootclasspath public void setOutputFile File outputFile this outputFile outputFile public File getOutputfile return outputFile public void setForce boolean force this force force public boolean getForce return force public void setOld boolean old this old old public boolean getOld return old public void setStubs boolean stubs this stubs stubs public boolean getStubs return stubs public void setVerbose boolean verbose this verbose verbose public boolean getVerbose return verbose public void setImplementation String impl if equals impl facade setImplementation JavahAdapterFactory getDefault else facade setImplementation impl public ImplementationSpecificArgument createArg ImplementationSpecificArgument arg new ImplementationSpecificArgument facade addImplementationArgument arg return arg public String getCurrentArgs return facade getArgs public void execute throws BuildException if cls null classes size throw new BuildException getLocation if cls null classes size throw new BuildException getLocation if destDir null if destDir isDirectory throw new BuildException destDir getLocation if outputFile null throw new BuildException getLocation if classpath null classpath new Path getProject concatSystemClasspath else classpath classpath concatSystemClasspath JavahAdapter ad JavahAdapterFactory getAdapter facade getImplementation this if ad compile this throw new BuildException public void logAndAddFiles Commandline cmd logAndAddFilesToCompile cmd protected void logAndAddFilesToCompile Commandline cmd log cmd describeArguments Project MSG_VERBOSE StringBuffer niceClassList new StringBuffer String getClasses for int length cmd createArgument setValue niceClassList append niceClassList append niceClassList append lSep StringBuffer prefix new StringBuffer if length prefix append prefix append prefix append lSep log prefix toString niceClassList toString Project MSG_VERBOSE public class LoadFile extends LoadResource public final void setSrcFile final File srcFile addConfigured new FileResource srcFile public class HasMethod extends ProjectComponent implements Condition private String classname private String method private String field private Path classpath private AntClassLoader loader private boolean ignoreSystemClasses false public void setClasspath Path classpath createClasspath append classpath public Path createClasspath if this classpath null this classpath new Path getProject return this classpath createPath public void setClasspathRef Reference createClasspath setRefid public void setClassname String classname this classname classname public void setMethod String method this method method public void setField String field this field field public void setIgnoreSystemClasses boolean ignoreSystemClasses this ignoreSystemClasses ignoreSystemClasses private Class loadClass String classname try if ignoreSystemClasses loader getProject createClassLoader classpath loader setParentFirst false loader addJavaLibraries if loader null try return loader findClass classname catch SecurityException se return null else return null else if loader null return loader loadClass classname else ClassLoader this getClass getClassLoader if null return Class forName classname true else return Class forName classname catch ClassNotFoundException throw new BuildException classname catch NoClassDefFoundError throw new BuildException getMessage classname public boolean eval throws BuildException if classname null throw new BuildException Class clazz loadClass classname if method null return isMethodFound clazz if field null return isFieldFound clazz throw new BuildException private boolean isFieldFound Class clazz Field fields clazz getDeclaredFields for int fields length Field fieldEntry fields if fieldEntry getName equals field return true return false private boolean isMethodFound Class clazz Method methods clazz getDeclaredMethods for int methods length Method methodEntry methods if methodEntry getName equals method return true return false public class WhichResource extends Task private Path classpath private String classname private String resource private String property public void setClasspath Path cp if classpath null classpath cp else classpath append cp public Path createClasspath if classpath null classpath new Path getProject return classpath createPath private void validate int setcount if classname null setcount if resource null setcount if setcount throw new BuildException if setcount throw new BuildException if property null throw new BuildException public void execute throws BuildException validate if classpath null getProject log classpath Project MSG_DEBUG classpath classpath concatSystemClasspath else classpath new Path getProject classpath classpath concatSystemClasspath getProject log classpath Project MSG_DEBUG AntClassLoader loader loader new AntClassLoader getProject getCoreLoader getProject classpath false String loc null if classname null resource classname replace if resource null throw new BuildException if resource startsWith resource resource substring log resource Project MSG_VERBOSE URL url url loader getResource resource if url null loc url toExternalForm getProject setNewProperty property loc public void setResource String resource this resource resource public void setClass String classname this classname classname public void setProperty String property this property property public class Difference extends BaseResourceCollectionContainer protected Collection getCollection List rc getResourceCollections int size rc size if size throw new BuildException size size HashSet hs new HashSet ArrayList al new ArrayList for Iterator rcIter rc iterator rcIter hasNext for Iterator nextRC rcIter iterator hasNext Object next next if hs add next al add next else al remove next return al private static ResourceCollection nextRC Iterator return ResourceCollection next public class AntSoundPlayer implements LineListener BuildListener private File fileSuccess null private int loopsSuccess private Long durationSuccess null private File fileFail null private int loopsFail private Long durationFail null public AntSoundPlayer public void addBuildSuccessfulSound File file int loops Long duration this fileSuccess file this loopsSuccess loops this durationSuccess duration public void addBuildFailedSound File fileFail int loopsFail Long durationFail this fileFail fileFail this loopsFail loopsFail this durationFail durationFail private void play Project project File file int loops Long duration Clip audioClip null AudioInputStream audioInputStream null try audioInputStream AudioSystem getAudioInputStream file catch UnsupportedAudioFileException uafe project log uafe getMessage catch IOException ioe ioe printStackTrace if audioInputStream null AudioFormat format audioInputStream getFormat DataLine Info info new DataLine Info Clip class format AudioSystem NOT_SPECIFIED try audioClip Clip AudioSystem getLine info audioClip addLineListener this audioClip open audioInputStream catch LineUnavailableException project log return catch IOException printStackTrace if duration null playClip audioClip duration longValue else playClip audioClip loops audioClip drain audioClip close else project log file getName private void playClip Clip clip int loops clip loop loops while clip isRunning private void playClip Clip clip long duration clip loop Clip LOOP_CONTINUOUSLY try Thread sleep duration catch InterruptedException public void update LineEvent event if event getType equals LineEvent Type STOP Line line event getLine line close else if event getType equals LineEvent Type CLOSE public void buildStarted BuildEvent event public void buildFinished BuildEvent event if event getException null fileSuccess null play event getProject fileSuccess loopsSuccess durationSuccess else if event getException null fileFail null play event getProject fileFail loopsFail durationFail public void targetStarted BuildEvent event public void targetFinished BuildEvent event public void taskStarted BuildEvent event public void taskFinished BuildEvent event public void messageLogged BuildEvent event public class GenericHotDeploymentTool extends AbstractHotDeploymentTool private Java java private String className private static final String VALID_ACTIONS ACTION_DEPLOY public Commandline Argument createArg return java createArg public Commandline Argument createJvmarg return java createJvmarg protected boolean isActionValid return getTask getAction equals VALID_ACTIONS public void setTask ServerDeploy task super setTask task java new Java task public void deploy throws BuildException java setClassname className java setClasspath getClasspath java setFork true java setFailonerror true java execute public void validateAttributes throws BuildException super validateAttributes if className null throw new BuildException public void setClassName String className this className className public Java getJava return java public String getClassName return className public class ImplementationSpecificArgument extends Commandline Argument private String impl public ImplementationSpecificArgument super public void setImplementation String impl this impl impl public final String getParts String chosenImpl if impl null impl equals chosenImpl return super getParts else return new String public class Move extends Copy public Move super setOverwrite true protected void validateAttributes throws BuildException if file null file isDirectory if destFile null destDir null destFile null destDir null throw new BuildException destFile destFile null new File destDir file getName destFile destDir destDir null destFile getParentFile destDir completeDirMap put file destFile file null else super validateAttributes protected void doFileOperations if completeDirMap size Enumeration completeDirMap keys while hasMoreElements File fromDir File nextElement File toDir File completeDirMap get fromDir boolean renamed false try log fromDir toDir verbosity renamed renameFile fromDir toDir filtering forceOverwrite catch IOException ioe String msg fromDir toDir ioe getMessage throw new BuildException msg ioe getLocation if renamed FileSet fs new FileSet fs setProject getProject fs setDir fromDir addFileset fs DirectoryScanner ds fs getDirectoryScanner getProject String files ds getIncludedFiles String dirs ds getIncludedDirectories scan fromDir toDir files dirs int moveCount fileCopyMap size log moveCount moveCount destDir getAbsolutePath Enumeration fileCopyMap keys while hasMoreElements String fromFile String nextElement File new File fromFile boolean selfMove false String toFiles String fileCopyMap get fromFile for int toFiles length String toFile String toFiles if fromFile equals toFile log fromFile verbosity selfMove true continue File new File toFile if toFiles length selfMove moveFile filtering forceOverwrite else copyFile filtering forceOverwrite if includeEmpty Enumeration dirCopyMap keys int createCount while hasMoreElements String fromDirName String nextElement String toDirNames String dirCopyMap get fromDirName boolean selfMove false for int toDirNames length if fromDirName equals toDirNames log fromDirName verbosity selfMove true continue File new File toDirNames if exists if mkdirs log getAbsolutePath Project MSG_ERR else createCount File fromDir new File fromDirName if selfMove okToDelete fromDir deleteDir fromDir if createCount log dirCopyMap size dirCopyMap size createCount createCount destDir getAbsolutePath private void moveFile File fromFile File toFile boolean filtering boolean overwrite boolean moved false try log fromFile toFile verbosity moved renameFile fromFile toFile filtering forceOverwrite catch IOException ioe String msg fromFile toFile ioe getMessage throw new BuildException msg ioe getLocation if moved copyFile fromFile toFile filtering overwrite if fromFile delete throw new BuildException fromFile getAbsolutePath private void copyFile File fromFile File toFile boolean filtering boolean overwrite try log fromFile toFile verbosity FilterSetCollection executionFilters new FilterSetCollection if filtering executionFilters addFilterSet getProject getGlobalFilterSet for Enumeration filterEnum getFilterSets elements filterEnum hasMoreElements executionFilters addFilterSet FilterSet filterEnum nextElement getFileUtils copyFile fromFile toFile executionFilters getFilterChains forceOverwrite getPreserveLastModified getEncoding getOutputEncoding getProject catch IOException ioe String msg fromFile toFile ioe getMessage throw new BuildException msg ioe getLocation protected boolean okToDelete File String list list if list null return false for int list length String list File new File if isDirectory if okToDelete return false else return true protected void deleteDir File deleteDir false protected void deleteDir File boolean deleteFiles String list list if list null return for int list length String list File new File if isDirectory deleteDir else if deleteFiles delete throw new BuildException getAbsolutePath else throw new BuildException getAbsolutePath log getAbsolutePath verbosity if delete throw new BuildException getAbsolutePath protected boolean renameFile File sourceFile File destFile boolean filtering boolean overwrite throws IOException BuildException boolean renamed false if getFilterSets size getFilterChains size filtering destFile isDirectory File parent destFile getParentFile if parent null parent exists parent mkdirs if destFile isFile destFile equals sourceFile destFile delete throw new BuildException destFile renamed sourceFile renameTo destFile return renamed public class Equals implements Condition private String arg1 arg2 private boolean trim false private boolean caseSensitive true public void setArg1 String a1 arg1 a1 public void setArg2 String a2 arg2 a2 public void setTrim boolean trim public void setCasesensitive boolean caseSensitive public boolean eval throws BuildException if arg1 null arg2 null throw new BuildException if trim arg1 arg1 trim arg2 arg2 trim return caseSensitive arg1 equals arg2 arg1 equalsIgnoreCase arg2 public class Comparison extends EnumeratedAttribute private static final String VALUES new String public static final Comparison EQUAL new Comparison public static final Comparison NOT_EQUAL new Comparison public static final Comparison GREATER new Comparison public static final Comparison LESS new Comparison public static final Comparison GREATER_EQUAL new Comparison public static final Comparison LESS_EQUAL new Comparison private static final int EQUAL_INDEX private static final int LESS_INDEX private static final int GREATER_INDEX public Comparison public Comparison String value setValue value public String getValues return VALUES public boolean evaluate int comparisonResult if getIndex throw new BuildException int comparisonResult LESS_INDEX comparisonResult GREATER_INDEX EQUAL_INDEX return Arrays binarySearch getIndex public final class JUnitTaskMirrorImpl implements JUnitTaskMirror private final JUnitTask task public JUnitTaskMirrorImpl JUnitTask task this task task public void addVmExit JUnitTest test JUnitTaskMirror JUnitResultFormatterMirror aFormatter OutputStream out String message String testCase JUnitResultFormatter formatter JUnitResultFormatter aFormatter formatter setOutput out formatter startTestSuite test TestCase new VmExitErrorTest message test testCase formatter startTest formatter addError new AssertionFailedError message formatter endTestSuite test public JUnitTaskMirror JUnitTestRunnerMirror newJUnitTestRunner JUnitTest test boolean haltOnError boolean filterTrace boolean haltOnFailure boolean showOutput boolean logTestListenerEvents AntClassLoader classLoader return new JUnitTestRunner test haltOnError filterTrace haltOnFailure showOutput logTestListenerEvents classLoader public JUnitTaskMirror SummaryJUnitResultFormatterMirror newSummaryJUnitResultFormatter return new SummaryJUnitResultFormatter static class VmExitErrorTest extends TestCase private String message private JUnitTest test private String testCase VmExitErrorTest String aMessage JUnitTest anOriginalTest String aTestCase message aMessage test anOriginalTest testCase aTestCase public int countTestCases return public void run TestResult throw new AssertionFailedError message public String getName return testCase String getClassName return test getName public String toString return test getName testCase public final class IntrospectionHelper private static final Map EMPTY_MAP Collections unmodifiableMap new HashMap private static final Map HELPERS new Hashtable private static final Map PRIMITIVE_TYPE_MAP new HashMap static Class primitives Boolean TYPE Byte TYPE Character TYPE Short TYPE Integer TYPE Long TYPE Float TYPE Double TYPE Class wrappers Boolean class Byte class Character class Short class Integer class Long class Float class Double class for int primitives length PRIMITIVE_TYPE_MAP put primitives wrappers private static final int MAX_REPORT_NESTED_TEXT private static final String ELLIPSIS private Hashtable attributeTypes new Hashtable private Hashtable attributeSetters new Hashtable private Hashtable nestedTypes new Hashtable private Hashtable nestedCreators new Hashtable private List addTypeMethods new ArrayList private Method addText null private Class bean private IntrospectionHelper final Class bean this bean bean Method methods bean getMethods for int methods length final Method methods final String name getName Class returnType getReturnType Class args getParameterTypes if args length java lang Void TYPE equals returnType equals name equals name insertAddTypeMethod continue if org apache tools ant ProjectComponent class isAssignableFrom bean args length isHiddenSetMethod name args continue if isContainer args length equals name org apache tools ant Task class equals args continue if equals name java lang Void TYPE equals returnType args length java lang String class equals args addText methods else if name startsWith java lang Void TYPE equals returnType args length args isArray String propName getPropertyName name if attributeSetters get propName null if java lang String class equals args continue AttributeSetter as createAttributeSetter args propName if as null attributeTypes put propName args attributeSetters put propName as else if name startsWith returnType isArray returnType isPrimitive args length String propName getPropertyName name if nestedCreators get propName null nestedTypes put propName returnType nestedCreators put propName new CreateNestedCreator else if name startsWith java lang Void TYPE equals returnType args length java lang String class equals args args isArray args isPrimitive try Constructor constructor null try constructor args getConstructor new Class catch NoSuchMethodException ex constructor args getConstructor new Class Project class String propName getPropertyName name nestedTypes put propName args nestedCreators put propName new AddNestedCreator constructor AddNestedCreator ADD_CONFIGURED catch NoSuchMethodException nse else if name startsWith java lang Void TYPE equals returnType args length java lang String class equals args args isArray args isPrimitive try Constructor constructor null try constructor args getConstructor new Class catch NoSuchMethodException ex constructor args getConstructor new Class Project class String propName getPropertyName name if nestedTypes get propName null continue nestedTypes put propName args nestedCreators put propName new AddNestedCreator constructor AddNestedCreator ADD catch NoSuchMethodException nse private boolean isHiddenSetMethod String name Class type if equals name org apache tools ant Location class equals type return true if equals name java lang String class equals type return true return false public static synchronized IntrospectionHelper getHelper Class return getHelper null public static IntrospectionHelper getHelper Project Class IntrospectionHelper ih IntrospectionHelper HELPERS get getName if ih null ih bean ih new IntrospectionHelper if null HELPERS put getName ih return ih public void setAttribute Project Object element String attributeName String value throws BuildException AttributeSetter as AttributeSetter attributeSetters get attributeName toLowerCase Locale US if as null if element instanceof DynamicAttributeNS DynamicAttributeNS dc DynamicAttributeNS element String uriPlusPrefix ProjectHelper extractUriFromComponentName attributeName String uri ProjectHelper extractUriFromComponentName uriPlusPrefix String localName ProjectHelper extractNameFromComponentName attributeName String qName equals uri localName uri localName dc setDynamicAttribute uri localName qName value return else if element instanceof DynamicAttribute DynamicAttribute dc DynamicAttribute element dc setDynamicAttribute attributeName toLowerCase Locale US value return else if attributeName indexOf String msg getElementName element attributeName throw new UnsupportedAttributeException msg attributeName try as set element value catch IllegalAccessException ie throw new BuildException ie catch InvocationTargetException ite Throwable ite getTargetException if instanceof BuildException throw BuildException throw new BuildException public void addText Project project Object element String text throws BuildException if addText null text text trim if text length return else String msg project getElementName element condenseText text throw new BuildException msg try addText invoke element new Object text catch IllegalAccessException ie throw new BuildException ie catch InvocationTargetException ite Throwable ite getTargetException if instanceof BuildException throw BuildException throw new BuildException public void throwNotSupported Project project Object parent String elementName String msg project getElementName parent elementName throw new UnsupportedElementException msg elementName private NestedCreator getNestedCreator Project project String parentUri Object parent String elementName UnknownElement child throws BuildException String uri ProjectHelper extractUriFromComponentName elementName String name ProjectHelper extractNameFromComponentName elementName if uri equals ProjectHelper ANT_CORE_URI uri if parentUri equals ProjectHelper ANT_CORE_URI parentUri NestedCreator nc null if uri equals parentUri uri equals nc NestedCreator nestedCreators get name toLowerCase Locale US if nc null nc createAddTypeCreator project parent elementName if nc null parent instanceof DynamicElementNS DynamicElementNS dc DynamicElementNS parent String qName child null name child getQName final Object nestedElement dc createDynamicElement child null child getNamespace name qName if nestedElement null nc new NestedCreator null Object create Project project Object parent Object ignore return nestedElement if nc null parent instanceof DynamicElement DynamicElement dc DynamicElement parent final Object nestedElement dc createDynamicElement name toLowerCase Locale US if nestedElement null nc new NestedCreator null Object create Project project Object parent Object ignore return nestedElement if nc null throwNotSupported project parent elementName return nc public Object createElement Project project Object parent String elementName throws BuildException NestedCreator nc getNestedCreator project parent elementName null try Object nestedElement nc create project parent null if project null project setProjectReference nestedElement return nestedElement catch IllegalAccessException ie throw new BuildException ie catch InstantiationException ine throw new BuildException ine catch InvocationTargetException ite Throwable ite getTargetException if instanceof BuildException throw BuildException throw new BuildException public Creator getElementCreator Project project String parentUri Object parent String elementName UnknownElement ue NestedCreator nc getNestedCreator project parentUri parent elementName ue return new Creator project parent nc public boolean isDynamic return DynamicElement class isAssignableFrom bean DynamicElementNS class isAssignableFrom bean public boolean isContainer return TaskContainer class isAssignableFrom bean public boolean supportsNestedElement String elementName return nestedCreators containsKey elementName toLowerCase Locale US isDynamic addTypeMethods size public boolean supportsNestedElement String parentUri String elementName if parentUri equals ProjectHelper ANT_CORE_URI parentUri String uri ProjectHelper extractUriFromComponentName elementName if uri equals ProjectHelper ANT_CORE_URI uri String name ProjectHelper extractNameFromComponentName elementName return nestedCreators containsKey name toLowerCase Locale US uri equals parentUri equals uri isDynamic addTypeMethods size public void storeElement Project project Object parent Object child String elementName throws BuildException if elementName null return NestedCreator ns NestedCreator nestedCreators get elementName toLowerCase Locale US if ns null return try ns store parent child catch IllegalAccessException ie throw new BuildException ie catch InstantiationException ine throw new BuildException ine catch InvocationTargetException ite Throwable ite getTargetException if instanceof BuildException throw BuildException throw new BuildException public Class getElementType String elementName throws BuildException Class nt Class nestedTypes get elementName if nt null throw new UnsupportedElementException bean getName elementName elementName return nt public Class getAttributeType String attributeName throws BuildException Class at Class attributeTypes get attributeName if at null throw new UnsupportedAttributeException bean getName attributeName attributeName return at public Method getAddTextMethod throws BuildException if supportsCharacters throw new BuildException bean getName return addText public Method getElementMethod String elementName throws BuildException Object creator nestedCreators get elementName if creator null throw new UnsupportedElementException bean getName elementName elementName return NestedCreator creator method public Method getAttributeMethod String attributeName throws BuildException Object setter attributeSetters get attributeName if setter null throw new UnsupportedAttributeException bean getName attributeName attributeName return AttributeSetter setter method public boolean supportsCharacters return addText null public Enumeration getAttributes return attributeSetters keys public Map getAttributeMap return attributeTypes size EMPTY_MAP Collections unmodifiableMap attributeTypes public Enumeration getNestedElements return nestedTypes keys public Map getNestedElementMap return nestedTypes size EMPTY_MAP Collections unmodifiableMap nestedTypes public List getExtensionPoints return addTypeMethods size Collections EMPTY_LIST Collections unmodifiableList addTypeMethods private AttributeSetter createAttributeSetter final Method Class arg final String attrName final Class reflectedArg PRIMITIVE_TYPE_MAP containsKey arg Class PRIMITIVE_TYPE_MAP get arg arg if java lang String class equals reflectedArg return new AttributeSetter public void set Project Object parent String value throws InvocationTargetException IllegalAccessException invoke parent Object new String value else if java lang Character class equals reflectedArg return new AttributeSetter public void set Project Object parent String value throws InvocationTargetException IllegalAccessException if value length throw new BuildException attrName invoke parent Object new Character new Character value charAt else if java lang Boolean class equals reflectedArg return new AttributeSetter public void set Project Object parent String value throws InvocationTargetException IllegalAccessException invoke parent Object new Boolean Project toBoolean value Boolean TRUE Boolean FALSE else if java lang Class class equals reflectedArg return new AttributeSetter public void set Project Object parent String value throws InvocationTargetException IllegalAccessException BuildException try invoke parent new Object Class forName value catch ClassNotFoundException ce throw new BuildException ce else if java io File class equals reflectedArg return new AttributeSetter public void set Project Object parent String value throws InvocationTargetException IllegalAccessException invoke parent new Object resolveFile value else if EnumeratedAttribute class isAssignableFrom reflectedArg return new AttributeSetter public void set Project Object parent String value throws InvocationTargetException IllegalAccessException BuildException try EnumeratedAttribute ea EnumeratedAttribute reflectedArg newInstance ea setValue value invoke parent new Object ea catch InstantiationException ie throw new BuildException ie else if reflectedArg getSuperclass null reflectedArg getSuperclass getName equals return new AttributeSetter public void set Project Object parent String value throws InvocationTargetException IllegalAccessException BuildException try invoke parent new Object reflectedArg getMethod new Class String class invoke null new Object value catch InvocationTargetException if getTargetException instanceof IllegalArgumentException throw new BuildException value reflectedArg getName else throw new BuildException getTargetException catch Exception throw new BuildException else boolean includeProject Constructor try reflectedArg getConstructor new Class Project class String class includeProject true catch NoSuchMethodException nme try reflectedArg getConstructor new Class String class includeProject false catch NoSuchMethodException nme2 return null final boolean finalIncludeProject includeProject final Constructor finalConstructor return new AttributeSetter public void set Project Object parent String value throws InvocationTargetException IllegalAccessException BuildException try Object args finalIncludeProject new Object value new Object value Object attribute finalConstructor newInstance args if null setProjectReference attribute invoke parent new Object attribute catch InstantiationException ie throw new BuildException ie protected String getElementName Project project Object element return project getElementName element private String getPropertyName String methodName String prefix return methodName substring prefix length toLowerCase Locale US public static final class Creator private NestedCreator nestedCreator private Object parent private Project project private Object nestedObject private String polyType private Creator Project project Object parent NestedCreator nestedCreator this project project this parent parent this nestedCreator nestedCreator public void setPolyType String polyType this polyType polyType public Object create if polyType null if nestedCreator isPolyMorphic throw new BuildException ComponentHelper helper ComponentHelper getComponentHelper project nestedObject helper createComponent polyType if nestedObject null throw new BuildException polyType try nestedObject nestedCreator create project parent nestedObject if project null project setProjectReference nestedObject return nestedObject catch IllegalAccessException ex throw new BuildException ex catch InstantiationException ex throw new BuildException ex catch IllegalArgumentException ex if polyType null throw new BuildException polyType throw ex catch InvocationTargetException ex Throwable ex getTargetException if instanceof BuildException throw BuildException throw new BuildException public Object getRealObject return nestedCreator getRealObject public void store try nestedCreator store parent nestedObject catch IllegalAccessException ex throw new BuildException ex catch InstantiationException ex throw new BuildException ex catch IllegalArgumentException ex if polyType null throw new BuildException polyType throw ex catch InvocationTargetException ex Throwable ex getTargetException if instanceof BuildException throw BuildException throw new BuildException private abstract static class NestedCreator NestedCreator Method this method Method getMethod return method boolean isPolyMorphic return false Object getRealObject return null abstract Object create Project project Object parent Object child throws InvocationTargetException IllegalAccessException InstantiationException void store Object parent Object child throws InvocationTargetException IllegalAccessException InstantiationException private class CreateNestedCreator extends NestedCreator CreateNestedCreator Method super Object create Project project Object parent Object ignore throws InvocationTargetException IllegalAccessException return getMethod invoke parent new Object private class AddNestedCreator extends NestedCreator static final int ADD static final int ADD_CONFIGURED private Constructor constructor AddNestedCreator Method Constructor int behavior super this constructor this behavior behavior boolean isPolyMorphic return true Object create Project project Object parent Object child throws InvocationTargetException IllegalAccessException InstantiationException if child null child constructor newInstance constructor getParameterTypes length new Object new Object project if child instanceof PreSetDef PreSetDefinition child PreSetDef PreSetDefinition child createObject project if behavior ADD istore parent child return child void store Object parent Object child throws InvocationTargetException IllegalAccessException InstantiationException if behavior ADD_CONFIGURED istore parent child private void istore Object parent Object child throws InvocationTargetException IllegalAccessException InstantiationException getMethod invoke parent new Object child private abstract static class AttributeSetter AttributeSetter Method this method abstract void set Project Object parent String value throws InvocationTargetException IllegalAccessException BuildException public static void clearCache HELPERS clear private NestedCreator createAddTypeCreator Project project Object parent String elementName throws BuildException if addTypeMethods size return null ComponentHelper helper ComponentHelper getComponentHelper project Object addedObject null Method addMethod null Class clazz helper getComponentClass elementName if clazz null return null addMethod findMatchingMethod clazz addTypeMethods if addMethod null return null addedObject helper createComponent elementName if addedObject null return null Object rObject addedObject if addedObject instanceof PreSetDef PreSetDefinition rObject PreSetDef PreSetDefinition addedObject createObject project final Object nestedObject addedObject final Object realObject rObject return new NestedCreator addMethod Object create Project project Object parent Object ignore throws InvocationTargetException IllegalAccessException if getMethod getName endsWith getMethod invoke parent new Object realObject return nestedObject Object getRealObject return realObject void store Object parent Object child throws InvocationTargetException IllegalAccessException InstantiationException if getMethod getName endsWith getMethod invoke parent new Object realObject private void insertAddTypeMethod Method method Class argClass method getParameterTypes for int addTypeMethods size Method current Method addTypeMethods get if current getParameterTypes equals argClass if method getName equals addTypeMethods set method if current getParameterTypes isAssignableFrom argClass addTypeMethods add method addTypeMethods add method private Method findMatchingMethod Class paramClass List methods Class matchedClass null Method matchedMethod null for int methods size Method method Method methods get Class methodClass method getParameterTypes if methodClass isAssignableFrom paramClass if matchedClass null matchedClass methodClass matchedMethod method else if methodClass isAssignableFrom matchedClass throw new BuildException matchedClass getName methodClass getName paramClass getName return matchedMethod private String condenseText final String text if text length MAX_REPORT_NESTED_TEXT return text int ends MAX_REPORT_NESTED_TEXT ELLIPSIS length return new StringBuffer text replace ends text length ends ELLIPSIS toString public interface XSLTLoggerAware void setLogger XSLTLogger public class ChangeLogTask extends AbstractCvsTask private File usersFile private Vector cvsUsers new Vector private File inputDir private File destFile private Date startDate private Date endDate private final Vector filesets new Vector public void setDir final File inputDir this inputDir inputDir public void setDestfile final File destFile this destFile destFile public void setUsersfile final File usersFile this usersFile usersFile public void addUser final CvsUser user cvsUsers addElement user public void setStart final Date start this startDate start public void setEnd final Date endDate this endDate endDate public void setDaysinpast final int days final long time System currentTimeMillis long days setStart new Date time public void addFileset final FileSet fileSet filesets addElement fileSet public void execute throws BuildException try validate final Properties userList new Properties loadUserlist userList for int size cvsUsers size size final CvsUser user CvsUser cvsUsers get user validate userList put user getUserID user getDisplayname setCommand if getTag null CvsVersion myCvsVersion new CvsVersion myCvsVersion setProject getProject myCvsVersion setTaskName myCvsVersion setCvsRoot getCvsRoot myCvsVersion setCvsRsh getCvsRsh myCvsVersion setPassfile getPassFile myCvsVersion setDest inputDir myCvsVersion execute if myCvsVersion supportsCvsLogWithSOption addCommandArgument if null startDate final SimpleDateFormat outputDate new SimpleDateFormat final String dateRange outputDate format startDate addCommandArgument addCommandArgument dateRange if filesets isEmpty final Enumeration filesets elements while hasMoreElements final FileSet fileSet FileSet nextElement final DirectoryScanner scanner fileSet getDirectoryScanner getProject final String files scanner getIncludedFiles for int files length addCommandArgument files final ChangeLogParser parser new ChangeLogParser final RedirectingStreamHandler handler new RedirectingStreamHandler parser log getCommand Project MSG_VERBOSE setDest inputDir setExecuteStreamHandler handler try super execute finally final String errors handler getErrors if null errors log errors Project MSG_ERR final CVSEntry entrySet parser getEntrySetAsArray final CVSEntry filteredEntrySet filterEntrySet entrySet replaceAuthorIdWithName userList filteredEntrySet writeChangeLog filteredEntrySet finally inputDir savedDir private void validate throws BuildException if null inputDir inputDir getProject getBaseDir if null destFile final String message throw new BuildException message if inputDir exists final String message inputDir getAbsolutePath throw new BuildException message if null usersFile usersFile exists final String message usersFile getAbsolutePath throw new BuildException message private void loadUserlist final Properties userList throws BuildException if null usersFile try userList load new FileInputStream usersFile catch final IOException ioe throw new BuildException ioe toString ioe private CVSEntry filterEntrySet final CVSEntry entrySet final Vector results new Vector for int entrySet length final CVSEntry cvsEntry entrySet final Date date cvsEntry getDate if null date continue if null startDate startDate after date continue if null endDate endDate before date continue results addElement cvsEntry final CVSEntry resultArray new CVSEntry results size results copyInto resultArray return resultArray private void replaceAuthorIdWithName final Properties userList final CVSEntry entrySet for int entrySet length final CVSEntry entry entrySet if userList containsKey entry getAuthor entry setAuthor userList getProperty entry getAuthor private void writeChangeLog final CVSEntry entrySet throws BuildException FileOutputStream output null try output new FileOutputStream destFile final PrintWriter writer new PrintWriter new OutputStreamWriter output final ChangeLogWriter serializer new ChangeLogWriter serializer printChangeLog writer entrySet catch final UnsupportedEncodingException uee getProject log uee toString Project MSG_ERR catch final IOException ioe throw new BuildException ioe toString ioe finally FileUtils close output public class FieldRefCPInfo extends ConstantPoolEntry private String fieldClassName private String fieldName private String fieldType private int classIndex private int nameAndTypeIndex public FieldRefCPInfo super CONSTANT_FIELDREF public void read DataInputStream cpStream throws IOException classIndex cpStream readUnsignedShort nameAndTypeIndex cpStream readUnsignedShort public void resolve ConstantPool constantPool ClassCPInfo fieldClass ClassCPInfo constantPool getEntry classIndex fieldClass resolve constantPool fieldClassName fieldClass getClassName NameAndTypeCPInfo nt NameAndTypeCPInfo constantPool getEntry nameAndTypeIndex nt resolve constantPool fieldName nt getName fieldType nt getType super resolve constantPool public String toString String value if isResolved value fieldClassName fieldName fieldType else value classIndex nameAndTypeIndex return value public String getFieldClassName return fieldClassName public String getFieldName return fieldName public String getFieldType return fieldType class ChangeLogParser private static final int GET_FILE private static final int GET_DATE private static final int GET_COMMENT private static final int GET_REVISION private static final int GET_PREVIOUS_REV private static final SimpleDateFormat INPUT_DATE new SimpleDateFormat Locale US private static final SimpleDateFormat CVS1129_INPUT_DATE new SimpleDateFormat Locale US static TimeZone utc TimeZone getTimeZone INPUT_DATE setTimeZone utc CVS1129_INPUT_DATE setTimeZone utc private String file private String date private String author private String comment private String revision private String previousRevision private int status GET_FILE private final Hashtable entries new Hashtable public CVSEntry getEntrySetAsArray final CVSEntry array new CVSEntry entries size int for Enumeration entries elements hasMoreElements array CVSEntry nextElement return array public void stdout final String line switch status case GET_FILE reset processFile line break case GET_REVISION processRevision line break case GET_DATE processDate line break case GET_COMMENT processComment line break case GET_PREVIOUS_REV processGetPreviousRevision line break default break private void processComment final String line final String lineSeparator System getProperty if line equals final int end comment comment substring end saveEntry status GET_FILE else if line equals final int end comment comment substring end status GET_PREVIOUS_REV else comment line lineSeparator private void processFile final String line if line startsWith file line substring line length status GET_REVISION private void processRevision final String line if line startsWith revision line substring status GET_DATE else if line startsWith status GET_FILE private void processDate final String line if line startsWith int endOfDateIndex line indexOf date line substring length endOfDateIndex int startOfAuthorIndex line indexOf endOfDateIndex int endOfAuthorIndex line indexOf startOfAuthorIndex author line substring length startOfAuthorIndex endOfAuthorIndex status GET_COMMENT comment private void processGetPreviousRevision final String line if line startsWith throw new IllegalStateException line previousRevision line substring length saveEntry revision previousRevision status GET_DATE private void saveEntry final String entryKey date author comment CVSEntry entry if entries containsKey entryKey Date dateObject parseDate date entry new CVSEntry dateObject author comment entries put entryKey entry else entry CVSEntry entries get entryKey entry addFile file revision previousRevision private Date parseDate final String date try return INPUT_DATE parse date catch ParseException try return CVS1129_INPUT_DATE parse date catch ParseException e2 throw new IllegalStateException date public void reset this file null this date null this author null this comment null this revision null this previousRevision null public interface Dispatchable String getActionParameterName public class CvsTagDiff extends AbstractCvsTask private static final FileUtils FILE_UTILS FileUtils getFileUtils private static final DOMElementWriter DOM_WRITER new DOMElementWriter static final String FILE_STRING static final String TO_STRING static final String FILE_IS_NEW static final String REVISION static final String FILE_HAS_CHANGED static final String FILE_WAS_REMOVED private String mystartTag private String myendTag private String mystartDate private String myendDate private File mydestfile public void setPackage String public void setStartTag String mystartTag public void setStartDate String mystartDate public void setEndTag String myendTag public void setEndDate String myendDate public void setDestFile File mydestfile public void execute throws BuildException validate addCommandArgument addCommandArgument if mystartTag null addCommandArgument addCommandArgument mystartTag else addCommandArgument addCommandArgument mystartDate if myendTag null addCommandArgument addCommandArgument myendTag else addCommandArgument addCommandArgument myendDate while myTokenizer hasMoreTokens addCommandArgument myTokenizer nextToken setCommand File tmpFile null try tmpFile FILE_UTILS createTempFile null tmpFile deleteOnExit setOutput tmpFile super execute CvsTagEntry entries parseRDiff tmpFile writeTagDiff entries finally if tmpFile null tmpFile delete private CvsTagEntry parseRDiff File tmpFile throws BuildException BufferedReader reader null try reader new BufferedReader new FileReader tmpFile int headerLength toBeRemoved length Vector entries new Vector String line reader readLine int index CvsTagEntry entry null while null line if line length headerLength if line startsWith toBeRemoved line line substring headerLength else line line substring FILE_STRING length if index line indexOf FILE_IS_NEW String filename line substring index String rev null int indexrev if indexrev line indexOf REVISION index rev line substring indexrev REVISION length entry new CvsTagEntry filename rev entries addElement entry log entry toString Project MSG_VERBOSE else if index line indexOf FILE_HAS_CHANGED String filename line substring index int revSeparator line indexOf index String prevRevision line substring index FILE_HAS_CHANGED length revSeparator String revision line substring revSeparator TO_STRING length entry new CvsTagEntry filename revision prevRevision entries addElement entry log entry toString Project MSG_VERBOSE else if index line indexOf FILE_WAS_REMOVED String filename line substring index String rev null int indexrev if indexrev line indexOf REVISION index rev line substring indexrev REVISION length entry new CvsTagEntry filename null rev entries addElement entry log entry toString Project MSG_VERBOSE line reader readLine CvsTagEntry array new CvsTagEntry entries size entries copyInto array return array catch IOException throw new BuildException finally if reader null try reader close catch IOException log toString Project MSG_ERR private void writeTagDiff CvsTagEntry entries throws BuildException FileOutputStream output null try output new FileOutputStream mydestfile PrintWriter writer new PrintWriter new OutputStreamWriter output writer println Document doc DOMUtils newDocument Element root doc createElement if mystartTag null root setAttribute mystartTag else root setAttribute mystartDate if myendTag null root setAttribute myendTag else root setAttribute myendDate root setAttribute getCvsRoot DOM_WRITER openElement root writer writer println for int entries length writeTagEntry doc writer entries DOM_WRITER closeElement root writer true writer flush writer close catch UnsupportedEncodingException uee log uee toString Project MSG_ERR catch IOException ioe throw new BuildException ioe toString ioe finally if null output try output close catch IOException ioe log ioe toString Project MSG_ERR private void writeTagEntry Document doc PrintWriter writer CvsTagEntry entry throws IOException Element ent doc createElement Element DOMUtils createChildElement ent DOMUtils appendCDATAElement entry getFile if entry getRevision null DOMUtils appendTextElement entry getRevision if entry getPreviousRevision null DOMUtils appendTextElement entry getPreviousRevision DOM_WRITER write ent writer private void validate throws BuildException throw new BuildException if null mydestfile throw new BuildException if null mystartTag null mystartDate throw new BuildException if null mystartTag null mystartDate throw new BuildException if null myendTag null myendDate throw new BuildException if null myendTag null myendDate throw new BuildException public class CBZip2OutputStream extends OutputStream implements BZip2Constants public static final int MIN_BLOCKSIZE public static final int MAX_BLOCKSIZE protected static final int SETMASK protected static final int CLEARMASK SETMASK protected static final int GREATER_ICOST protected static final int LESSER_ICOST protected static final int SMALL_THRESH protected static final int DEPTH_THRESH protected static final int WORK_FACTOR protected static final int QSORT_STACK_SIZE private static final int INCS protected static void hbMakeCodeLengths char len int freq int alphaSize int maxLen final int heap new int MAX_ALPHA_SIZE final int weight new int MAX_ALPHA_SIZE final int parent new int MAX_ALPHA_SIZE for int alphaSize weight freq freq for boolean tooLong true tooLong tooLong false int nNodes alphaSize int nHeap heap weight parent for int alphaSize parent nHeap heap nHeap int zz nHeap int tmp heap zz while weight tmp weight heap zz heap zz heap zz zz heap zz tmp while nHeap int n1 heap heap heap nHeap nHeap int yy int zz int tmp heap while true yy zz if yy nHeap break if yy nHeap weight heap yy weight heap yy yy if weight tmp weight heap yy break heap zz heap yy zz yy heap zz tmp int n2 heap heap heap nHeap nHeap yy zz tmp heap while true yy zz if yy nHeap break if yy nHeap weight heap yy weight heap yy yy if weight tmp weight heap yy break heap zz heap yy zz yy heap zz tmp nNodes parent n1 parent n2 nNodes final int weight_n1 weight n1 final int weight_n2 weight n2 weight nNodes weight_n1 weight_n2 weight_n1 weight_n2 weight_n1 weight_n2 parent nNodes nHeap heap nHeap nNodes tmp zz nHeap tmp heap zz final int weight_tmp weight tmp while weight_tmp weight heap zz heap zz heap zz zz heap zz tmp for int alphaSize int int for int parent_k parent_k parent parent_k len char if maxLen tooLong true if tooLong for int alphaSize int weight weight private static void hbMakeCodeLengths final byte len final int freq final Data dat final int alphaSize final int maxLen final int heap dat heap final int weight dat weight final int parent dat parent for int alphaSize weight freq freq for boolean tooLong true tooLong tooLong false int nNodes alphaSize int nHeap heap weight parent for int alphaSize parent nHeap heap nHeap int zz nHeap int tmp heap zz while weight tmp weight heap zz heap zz heap zz zz heap zz tmp while nHeap int n1 heap heap heap nHeap nHeap int yy int zz int tmp heap while true yy zz if yy nHeap break if yy nHeap weight heap yy weight heap yy yy if weight tmp weight heap yy break heap zz heap yy zz yy heap zz tmp int n2 heap heap heap nHeap nHeap yy zz tmp heap while true yy zz if yy nHeap break if yy nHeap weight heap yy weight heap yy yy if weight tmp weight heap yy break heap zz heap yy zz yy heap zz tmp nNodes parent n1 parent n2 nNodes final int weight_n1 weight n1 final int weight_n2 weight n2 weight nNodes weight_n1 weight_n2 weight_n1 weight_n2 weight_n1 weight_n2 parent nNodes nHeap heap nHeap nNodes tmp zz nHeap tmp heap zz final int weight_tmp weight tmp while weight_tmp weight heap zz heap zz heap zz zz heap zz tmp for int alphaSize int int for int parent_k parent_k parent parent_k len byte if maxLen tooLong true if tooLong for int alphaSize int weight weight private int last private int origPtr private final int blockSize100k private boolean blockRandomised private int bsBuff private int bsLive private final CRC crc new CRC private int nInUse private int nMTF private int workDone private int workLimit private boolean firstAttempt private int currentChar private int runLength private int blockCRC private int combinedCRC private int allowableBlockSize private CBZip2OutputStream Data data private OutputStream out public static int chooseBlockSize long inputLength return inputLength int Math min inputLength MAX_BLOCKSIZE public CBZip2OutputStream final OutputStream out throws IOException this out MAX_BLOCKSIZE public CBZip2OutputStream final OutputStream out final int blockSize throws IOException super if blockSize throw new IllegalArgumentException blockSize if blockSize throw new IllegalArgumentException blockSize this blockSize100k blockSize this out out init public void write final int throws IOException if this out null write0 else throw new IOException private void writeRun throws IOException final int lastShadow this last if lastShadow this allowableBlockSize final int currentCharShadow this currentChar final Data dataShadow this data dataShadow inUse currentCharShadow true final byte ch byte currentCharShadow int runLengthShadow this runLength this crc updateCRC currentCharShadow runLengthShadow switch runLengthShadow case dataShadow block lastShadow ch this last lastShadow break case dataShadow block lastShadow ch dataShadow block lastShadow ch this last lastShadow break case final byte block dataShadow block block lastShadow ch block lastShadow ch block lastShadow ch this last lastShadow break default runLengthShadow dataShadow inUse runLengthShadow true final byte block dataShadow block block lastShadow ch block lastShadow ch block lastShadow ch block lastShadow ch block lastShadow byte runLengthShadow this last lastShadow break else endBlock initBlock writeRun protected void finalize throws Throwable close super finalize public void close throws IOException OutputStream outShadow this out if outShadow null try if this runLength writeRun this currentChar endBlock endCompression outShadow close finally this out null this data null public void flush throws IOException OutputStream outShadow this out if outShadow null outShadow flush private void init throws IOException this data new Data this blockSize100k bsPutUByte bsPutUByte this blockSize100k this combinedCRC initBlock private void initBlock this crc initialiseCRC this last boolean inUse this data inUse for int inUse false this allowableBlockSize this blockSize100k BZip2Constants baseBlockSize private void endBlock throws IOException this blockCRC this crc getFinalCRC this combinedCRC this combinedCRC this combinedCRC this combinedCRC this blockCRC if this last return blockSort bsPutUByte bsPutUByte bsPutUByte bsPutUByte bsPutUByte bsPutUByte bsPutInt this blockCRC if this blockRandomised bsW else bsW moveToFrontCodeAndSend private void endCompression throws IOException bsPutUByte bsPutUByte bsPutUByte bsPutUByte bsPutUByte bsPutUByte bsPutInt this combinedCRC bsFinishedWithStream public final int getBlockSize return this blockSize100k public void write final byte buf int offs final int len throws IOException if offs throw new IndexOutOfBoundsException offs if len throw new IndexOutOfBoundsException len if offs len buf length throw new IndexOutOfBoundsException offs len buf length if this out null throw new IOException for int hi offs len offs hi write0 buf offs private void write0 int throws IOException if this currentChar if this currentChar if this runLength writeRun this currentChar this runLength else writeRun this runLength this currentChar else this currentChar this runLength private static void hbAssignCodes final int code final byte length final int minLen final int maxLen final int alphaSize int vec for int minLen maxLen for int alphaSize if length code vec vec vec private void bsFinishedWithStream throws IOException while this bsLive int ch this bsBuff this bsBuff this bsLive private void bsW final int final int throws IOException final OutputStream outShadow this out int bsLiveShadow this bsLive int bsBuffShadow this bsBuff while bsLiveShadow bsBuffShadow bsLiveShadow this bsBuff bsBuffShadow bsLiveShadow this bsLive bsLiveShadow private void bsPutUByte final int throws IOException bsW private void bsPutInt final int throws IOException bsW bsW bsW bsW private void sendMTFValues throws IOException final byte len this data sendMTFValues_len final int alphaSize this nInUse for int N_GROUPS byte len_t len for int alphaSize len_t GREATER_ICOST final int nGroups this nMTF this nMTF this nMTF this nMTF sendMTFValues0 nGroups alphaSize final int nSelectors sendMTFValues1 nGroups alphaSize sendMTFValues2 nGroups nSelectors sendMTFValues3 nGroups alphaSize sendMTFValues4 sendMTFValues5 nGroups nSelectors sendMTFValues6 nGroups alphaSize sendMTFValues7 nSelectors private void sendMTFValues0 final int nGroups final int alphaSize final byte len this data sendMTFValues_len final int mtfFreq this data mtfFreq int remF this nMTF int gs for int nPart nGroups nPart nPart final int tFreq remF nPart int ge gs int aFreq for final int alphaSize aFreq tFreq ge aFreq mtfFreq ge if ge gs nPart nGroups nPart nGroups nPart aFreq mtfFreq ge final byte len_np len nPart for int alphaSize if gs ge len_np LESSER_ICOST else len_np GREATER_ICOST gs ge remF aFreq private int sendMTFValues1 final int nGroups final int alphaSize final Data dataShadow this data final int rfreq dataShadow sendMTFValues_rfreq final int fave dataShadow sendMTFValues_fave final short cost dataShadow sendMTFValues_cost final char sfmap dataShadow sfmap final byte selector dataShadow selector final byte len dataShadow sendMTFValues_len final byte len_0 len final byte len_1 len final byte len_2 len final byte len_3 len final byte len_4 len final byte len_5 len final int nMTFShadow this nMTF int nSelectors for int iter iter N_ITERS iter for int nGroups fave int rfreqt rfreq for int alphaSize rfreqt nSelectors for int gs gs this nMTF final int ge Math min gs G_SIZE nMTFShadow if nGroups N_GROUPS short cost0 short cost1 short cost2 short cost3 short cost4 short cost5 for int gs ge final int icv sfmap cost0 len_0 icv cost1 len_1 icv cost2 len_2 icv cost3 len_3 icv cost4 len_4 icv cost5 len_5 icv cost cost0 cost cost1 cost cost2 cost cost3 cost cost4 cost cost5 else for int nGroups cost for int gs ge final int icv sfmap for int nGroups cost len icv int bt for int nGroups bc final int cost_t cost if cost_t bc bc cost_t bt fave bt selector nSelectors byte bt nSelectors final int rfreq_bt rfreq bt for int gs ge rfreq_bt sfmap gs ge for int nGroups hbMakeCodeLengths len rfreq this data alphaSize return nSelectors private void sendMTFValues2 final int nGroups final int nSelectors final Data dataShadow this data byte pos dataShadow sendMTFValues2_pos for int nGroups pos byte for int nSelectors final byte ll_i dataShadow selector byte tmp pos int while ll_i tmp byte tmp2 tmp tmp pos pos tmp2 pos tmp dataShadow selectorMtf byte private void sendMTFValues3 final int nGroups final int alphaSize int code this data sendMTFValues_code byte len this data sendMTFValues_len for int nGroups int minLen int maxLen final byte len_t len for int alphaSize final int len_t if maxLen maxLen if minLen minLen hbAssignCodes code len minLen maxLen alphaSize private void sendMTFValues4 throws IOException final boolean inUse this data inUse final boolean inUse16 this data sentMTFValues4_inUse16 for int inUse16 false final int i16 for int if inUse i16 inUse16 true for int bsW inUse16 final OutputStream outShadow this out int bsLiveShadow this bsLive int bsBuffShadow this bsBuff for int if inUse16 final int i16 for int while bsLiveShadow bsBuffShadow bsLiveShadow if inUse i16 bsBuffShadow bsLiveShadow bsLiveShadow this bsBuff bsBuffShadow this bsLive bsLiveShadow private void sendMTFValues5 final int nGroups final int nSelectors throws IOException bsW nGroups bsW nSelectors final OutputStream outShadow this out final byte selectorMtf this data selectorMtf int bsLiveShadow this bsLive int bsBuffShadow this bsBuff for int nSelectors for int hj selectorMtf hj while bsLiveShadow outShadow write bsBuffShadow bsBuffShadow bsLiveShadow bsBuffShadow bsLiveShadow bsLiveShadow while bsLiveShadow outShadow write bsBuffShadow bsBuffShadow bsLiveShadow bsLiveShadow this bsBuff bsBuffShadow this bsLive bsLiveShadow private void sendMTFValues6 final int nGroups final int alphaSize throws IOException final byte len this data sendMTFValues_len final OutputStream outShadow this out int bsLiveShadow this bsLive int bsBuffShadow this bsBuff for int nGroups byte len_t len int curr len_t while bsLiveShadow bsBuffShadow bsLiveShadow bsBuffShadow curr bsLiveShadow bsLiveShadow for int alphaSize int lti len_t while curr lti while bsLiveShadow bsBuffShadow bsLiveShadow bsBuffShadow bsLiveShadow bsLiveShadow while curr lti while bsLiveShadow bsBuffShadow bsLiveShadow bsBuffShadow bsLiveShadow bsLiveShadow while bsLiveShadow bsBuffShadow bsLiveShadow bsLiveShadow this bsBuff bsBuffShadow this bsLive bsLiveShadow private void sendMTFValues7 final int nSelectors throws IOException final Data dataShadow this data final byte len dataShadow sendMTFValues_len final int code dataShadow sendMTFValues_code final OutputStream outShadow this out final byte selector dataShadow selector final char sfmap dataShadow sfmap final int nMTFShadow this nMTF int selCtr int bsLiveShadow this bsLive int bsBuffShadow this bsBuff for int gs gs nMTFShadow final int ge Math min gs G_SIZE nMTFShadow final int selector_selCtr selector selCtr final int code_selCtr code selector_selCtr final byte len_selCtr len selector_selCtr while gs ge final int sfmap_i sfmap gs while bsLiveShadow outShadow write bsBuffShadow bsBuffShadow bsLiveShadow final int len_selCtr sfmap_i bsBuffShadow code_selCtr sfmap_i bsLiveShadow bsLiveShadow gs gs ge selCtr this bsBuff bsBuffShadow this bsLive bsLiveShadow private void moveToFrontCodeAndSend throws IOException bsW this origPtr generateMTFValues sendMTFValues private boolean mainSimpleSort final Data dataShadow final int lo final int hi final int final int bigN hi lo if bigN return this firstAttempt this workDone this workLimit int hp while INCS hp bigN hp final int fmap dataShadow fmap final char quadrant dataShadow quadrant final byte block dataShadow block final int lastShadow this last final int lastPlus1 lastShadow final boolean firstAttemptShadow this firstAttempt final int workLimitShadow this workLimit int workDoneShadow this workDone HP while hp final int INCS hp final int mj lo for int lo hi for int hi final int fmap final int vd int boolean onceRunned false int HAMMER while true if onceRunned fmap if mj break HAMMER else onceRunned true fmap int i1 int i2 vd if block i1 block i2 if block i1 block i2 if block i1 block i2 if block i1 block i2 if block i1 block i2 if block i1 block i2 int lastShadow while if block i1 block i2 if quadrant i1 quadrant i2 if block i1 block i2 if quadrant i1 quadrant i2 if block i1 block i2 if quadrant i1 quadrant i2 if block i1 block i2 if quadrant i1 quadrant i2 if i1 lastPlus1 i1 lastPlus1 if i2 lastPlus1 i2 lastPlus1 workDoneShadow continue else if quadrant i1 quadrant i2 continue HAMMER else break HAMMER else if block i1 block i2 continue HAMMER else break HAMMER else if quadrant i1 quadrant i2 continue HAMMER else break HAMMER else if block i1 block i2 continue HAMMER else break HAMMER else if quadrant i1 quadrant i2 continue HAMMER else break HAMMER else if block i1 block i2 continue HAMMER else break HAMMER else if quadrant i1 quadrant i2 continue HAMMER else break HAMMER else if block i1 block i2 continue HAMMER else break HAMMER break HAMMER else if block i1 block i2 continue HAMMER else break HAMMER else if block i1 block i2 continue HAMMER else break HAMMER else if block i1 block i2 continue HAMMER else break HAMMER else if block i1 block i2 continue HAMMER else break HAMMER else if block i1 block i2 continue HAMMER else break HAMMER else if block i1 block i2 continue HAMMER else break HAMMER fmap if firstAttemptShadow hi workDoneShadow workLimitShadow break HP this workDone workDoneShadow return firstAttemptShadow workDoneShadow workLimitShadow private static void vswap int fmap int p1 int p2 int p1 while p1 int fmap p1 fmap p1 fmap p2 fmap p2 private static byte med3 byte byte byte return private void blockSort this workLimit WORK_FACTOR this last this workDone this blockRandomised false this firstAttempt true mainSort if this firstAttempt this workDone this workLimit randomiseBlock this workLimit this workDone this firstAttempt false mainSort int fmap this data fmap this origPtr for int lastShadow this last lastShadow if fmap this origPtr break private void mainQSort3 final Data dataShadow final int loSt final int hiSt final int dSt final int stack_ll dataShadow stack_ll final int stack_hh dataShadow stack_hh final int stack_dd dataShadow stack_dd final int fmap dataShadow fmap final byte block dataShadow block stack_ll loSt stack_hh hiSt stack_dd dSt for int sp sp final int lo stack_ll sp final int hi stack_hh sp final int stack_dd sp if hi lo SMALL_THRESH DEPTH_THRESH if mainSimpleSort dataShadow lo hi return else final int d1 final int med med3 block fmap lo d1 block fmap hi d1 block fmap lo hi d1 int unLo lo int unHi hi int ltLo lo int gtHi hi while true while unLo unHi final int int block fmap unLo d1 med if final int temp fmap unLo fmap unLo fmap ltLo fmap ltLo temp else if unLo else break while unLo unHi final int int block fmap unHi d1 med if final int temp fmap unHi fmap unHi fmap gtHi fmap gtHi temp else if unHi else break if unLo unHi final int temp fmap unLo fmap unLo fmap unHi fmap unHi temp else break if gtHi ltLo stack_ll sp lo stack_hh sp hi stack_dd sp d1 sp else int ltLo lo unLo ltLo ltLo lo unLo ltLo vswap fmap lo unLo int hi gtHi gtHi unHi hi gtHi gtHi unHi vswap fmap unLo hi lo unLo ltLo hi gtHi unHi stack_ll sp lo stack_hh sp stack_dd sp sp stack_ll sp stack_hh sp stack_dd sp d1 sp stack_ll sp stack_hh sp hi stack_dd sp sp private void mainSort final Data dataShadow this data final int runningOrder dataShadow mainSort_runningOrder final int copy dataShadow mainSort_copy final boolean bigDone dataShadow mainSort_bigDone final int ftab dataShadow ftab final byte block dataShadow block final int fmap dataShadow fmap final char quadrant dataShadow quadrant final int lastShadow this last final int workLimitShadow this workLimit final boolean firstAttemptShadow this firstAttempt for int ftab for int NUM_OVERSHOOT_BYTES block lastShadow block lastShadow for int lastShadow NUM_OVERSHOOT_BYTES quadrant block block lastShadow int c1 block for int lastShadow final int c2 block ftab c1 c2 c1 c2 for int ftab ftab c1 block for int lastShadow final int c2 block fmap ftab c1 c2 c1 c2 fmap ftab block lastShadow block lastShadow for int bigDone false runningOrder for int for int final int vv runningOrder final int ftab vv ftab vv final int int for int ro runningOrder ftab ro ftab ro ro runningOrder runningOrder ro if break runningOrder vv for int final int ss runningOrder for int final int sb ss final int ftab_sb ftab sb if ftab_sb SETMASK SETMASK final int lo ftab_sb CLEARMASK final int hi ftab sb CLEARMASK if hi lo mainQSort3 dataShadow lo hi if firstAttemptShadow this workDone workLimitShadow return ftab sb ftab_sb SETMASK for int copy ftab ss CLEARMASK for int ftab ss CLEARMASK hj ftab ss CLEARMASK hj final int fmap_j fmap c1 block fmap_j if bigDone c1 fmap copy c1 fmap_j lastShadow fmap_j copy c1 for int ftab ss SETMASK bigDone ss true if final int bbStart ftab ss CLEARMASK final int bbSize ftab ss CLEARMASK bbStart int shifts while bbSize shifts shifts for int bbSize final int a2update fmap bbStart final char qVal char shifts quadrant a2update qVal if a2update NUM_OVERSHOOT_BYTES quadrant a2update lastShadow qVal private void randomiseBlock final boolean inUse this data inUse final byte block this data block final int lastShadow this last for int inUse false int rNToGo int rTPos for int lastShadow if rNToGo rNToGo char BZip2Constants rNums rTPos if rTPos rTPos rNToGo block rNToGo inUse block true this blockRandomised true private void generateMTFValues final int lastShadow this last final Data dataShadow this data final boolean inUse dataShadow inUse final byte block dataShadow block final int fmap dataShadow fmap final char sfmap dataShadow sfmap final int mtfFreq dataShadow mtfFreq final byte unseqToSeq dataShadow unseqToSeq final byte yy dataShadow generateMTFValues_yy int nInUseShadow for int if inUse unseqToSeq byte nInUseShadow nInUseShadow this nInUse nInUseShadow final int eob nInUseShadow for int eob mtfFreq for int nInUseShadow yy byte int wr int zPend for int lastShadow final byte ll_i unseqToSeq block fmap byte tmp yy int while ll_i tmp byte tmp2 tmp tmp yy yy tmp2 yy tmp if zPend else if zPend zPend while true if zPend sfmap wr RUNA wr mtfFreq RUNA else sfmap wr RUNB wr mtfFreq RUNB if zPend zPend zPend else break zPend sfmap wr char wr mtfFreq if zPend zPend while true if zPend sfmap wr RUNA wr mtfFreq RUNA else sfmap wr RUNB wr mtfFreq RUNB if zPend zPend zPend else break sfmap wr char eob mtfFreq eob this nMTF wr private static final class Data extends Object final char quadrant Data int blockSize100k super final int blockSize100k BZip2Constants baseBlockSize this block new byte NUM_OVERSHOOT_BYTES this fmap new int this sfmap new char this quadrant this sfmap public class Os implements Condition private static final String OS_NAME System getProperty toLowerCase Locale US private static final String OS_ARCH System getProperty toLowerCase Locale US private static final String OS_VERSION System getProperty toLowerCase Locale US private static final String PATH_SEP System getProperty private String family private String name private String version private String arch public static final String FAMILY_WINDOWS public static final String FAMILY_9X public static final String FAMILY_NT public static final String FAMILY_OS2 public static final String FAMILY_NETWARE public static final String FAMILY_DOS public static final String FAMILY_MAC public static final String FAMILY_TANDEM public static final String FAMILY_UNIX public static final String FAMILY_VMS public static final String FAMILY_ZOS public static final String FAMILY_OS400 public Os public Os String family setFamily family public void setFamily String family toLowerCase Locale US public void setName String name this name name toLowerCase Locale US public void setArch String arch this arch arch toLowerCase Locale US public void setVersion String version this version version toLowerCase Locale US public boolean eval throws BuildException return isOs family name arch version public static boolean isFamily String family return isOs family null null null public static boolean isName String name return isOs null name null null public static boolean isArch String arch return isOs null null arch null public static boolean isVersion String version return isOs null null null version public static boolean isOs String family String name String arch String version boolean retValue false if family null name null arch null version null boolean isFamily true boolean isName true boolean isArch true boolean isVersion true if family null boolean isWindows OS_NAME indexOf FAMILY_WINDOWS boolean is9x false boolean isNT false if isWindows is9x OS_NAME indexOf OS_NAME indexOf OS_NAME indexOf OS_NAME indexOf isNT is9x if family equals FAMILY_WINDOWS isFamily isWindows else if family equals FAMILY_9X isFamily isWindows is9x else if family equals FAMILY_NT isFamily isWindows isNT else if family equals FAMILY_OS2 isFamily OS_NAME indexOf FAMILY_OS2 else if family equals FAMILY_NETWARE isFamily OS_NAME indexOf FAMILY_NETWARE else if family equals FAMILY_DOS isFamily PATH_SEP equals isFamily FAMILY_NETWARE else if family equals FAMILY_MAC isFamily OS_NAME indexOf FAMILY_MAC else if family equals FAMILY_TANDEM isFamily OS_NAME indexOf else if family equals FAMILY_UNIX isFamily PATH_SEP equals isFamily FAMILY_VMS isFamily FAMILY_MAC OS_NAME endsWith else if family equals FAMILY_ZOS isFamily OS_NAME indexOf FAMILY_ZOS OS_NAME indexOf else if family equals FAMILY_OS400 isFamily OS_NAME indexOf FAMILY_OS400 else if family equals FAMILY_VMS isFamily OS_NAME indexOf FAMILY_VMS else throw new BuildException family if name null isName name equals OS_NAME if arch null isArch arch equals OS_ARCH if version null isVersion version equals OS_VERSION retValue isFamily isName isArch isVersion return retValue public class ScriptRunnerHelper private ClasspathUtils Delegate cpDelegate null private File srcFile private String manager private String language private String text private boolean setBeans true private ProjectComponent projectComponent private ClassLoader scriptLoader null public void setProjectComponent ProjectComponent component this projectComponent component public ScriptRunnerBase getScriptRunner ScriptRunnerBase runner getRunner if srcFile null runner setSrc srcFile if text null runner addText text if setBeans runner bindToComponent projectComponent else runner bindToComponentMinimum projectComponent return runner public Path createClasspath return getClassPathDelegate createClasspath public void setClasspath Path classpath getClassPathDelegate setClasspath classpath public void setClasspathRef Reference getClassPathDelegate setClasspathref public void setSrc File file this srcFile file public void addText String text this text text public void setManager String manager this manager manager public void setLanguage String language this language language public String getLanguage return language public void setSetBeans boolean setBeans this setBeans setBeans public void setClassLoader ClassLoader loader scriptLoader loader private ClassLoader generateClassLoader if scriptLoader null return scriptLoader if cpDelegate null scriptLoader getClass getClassLoader return scriptLoader scriptLoader cpDelegate getClassLoader return scriptLoader private ClasspathUtils Delegate getClassPathDelegate if cpDelegate null cpDelegate ClasspathUtils getDelegate projectComponent return cpDelegate private ScriptRunnerBase getRunner return new ScriptRunnerCreator projectComponent getProject createRunner manager language generateClassLoader public class Exit extends Task private static class NestedCondition extends ConditionBase implements Condition public boolean eval if countConditions throw new BuildException return Condition getConditions nextElement eval private String message private String ifCondition unlessCondition private NestedCondition nestedCondition private Integer status public void setMessage String value this message value public void setIf String ifCondition public void setUnless String unlessCondition public void setStatus int status new Integer public void execute throws BuildException boolean fail nestedConditionPresent testNestedCondition testIfCondition testUnlessCondition if fail String text null if message null message trim length text message trim else if ifCondition null ifCondition length getProject getProperty ifCondition null text ifCondition if unlessCondition null unlessCondition length getProject getProperty unlessCondition null if text null text else text text unlessCondition if nestedConditionPresent text else if text null text log text Project MSG_DEBUG throw status null new BuildException text new ExitStatusException text status intValue public void addText String msg if message null message message getProject replaceProperties msg public ConditionBase createCondition if nestedCondition null throw new BuildException nestedCondition new NestedCondition return nestedCondition private boolean testIfCondition if ifCondition null equals ifCondition return true return getProject getProperty ifCondition null private boolean testUnlessCondition if unlessCondition null equals unlessCondition return true return getProject getProperty unlessCondition null private boolean testNestedCondition boolean result nestedConditionPresent if result ifCondition null unlessCondition null throw new BuildException return result nestedCondition eval private boolean nestedConditionPresent return nestedCondition null public class MergingMapper implements FileNameMapper protected String mergedFile null public void setFrom String from public void setTo String to mergedFile new String to public String mapFileName String sourceFileName return mergedFile public class MacroDef extends AntlibDefinition private NestedSequential nestedSequential private String name private boolean backTrace true private List attributes new ArrayList private Map elements new HashMap private String textName null private Text text null private boolean hasImplicitElement false public void setName String name this name name public void addConfiguredText Text text if this text null throw new BuildException if text getName null throw new BuildException for Iterator attributes iterator hasNext Attribute attribute Attribute next if text getName equals attribute getName throw new BuildException text getName this text text this textName text getName public Text getText return text public void setBackTrace boolean backTrace this backTrace backTrace public boolean getBackTrace return backTrace public NestedSequential createSequential if this nestedSequential null throw new BuildException this nestedSequential new NestedSequential return this nestedSequential public static class NestedSequential implements TaskContainer private List nested new ArrayList public void addTask Task task nested add task public List getNested return nested public boolean similar NestedSequential other if nested size other nested size return false for int nested size UnknownElement me UnknownElement nested get UnknownElement UnknownElement other nested get if me similar return false return true public UnknownElement getNestedTask UnknownElement ret new UnknownElement ret setTaskName ret setNamespace ret setQName new RuntimeConfigurable ret for int nestedSequential getNested size UnknownElement UnknownElement nestedSequential getNested get ret addChild ret getWrapper addChild getWrapper return ret public List getAttributes return attributes public Map getElements return elements public static boolean isValidNameCharacter char return Character isLetterOrDigit private static boolean isValidName String name if name length return false for int name length if isValidNameCharacter name charAt return false return true public void addConfiguredAttribute Attribute attribute if attribute getName null throw new BuildException if attribute getName equals textName throw new BuildException attribute getName for int attributes size Attribute att Attribute attributes get if att getName equals attribute getName throw new BuildException attribute getName attributes add attribute public void addConfiguredElement TemplateElement element if element getName null throw new BuildException if elements get element getName null throw new BuildException element getName if hasImplicitElement element isImplicit elements size throw new BuildException hasImplicitElement element isImplicit elements put element getName element public void execute if nestedSequential null throw new BuildException if name null throw new BuildException name ProjectHelper genComponentName getURI name MyAntTypeDefinition def new MyAntTypeDefinition this def setName name def setClass MacroInstance class ComponentHelper helper ComponentHelper getComponentHelper getProject helper addDataTypeDefinition def log name Project MSG_VERBOSE public static class Attribute private String name private String defaultValue private String description public void setName String name if isValidName name throw new BuildException name this name name toLowerCase Locale US public String getName return name public void setDefault String defaultValue this defaultValue defaultValue public String getDefault return defaultValue public void setDescription String desc description desc public String getDescription return description public boolean equals Object obj if obj null return false if obj getClass getClass return false Attribute other Attribute obj if name null if other name null return false else if name equals other name return false if defaultValue null if other defaultValue null return false else if defaultValue equals other defaultValue return false return true public int hashCode return objectHashCode defaultValue objectHashCode name public static class Text private String name private boolean optional private boolean trim private String description public void setName String name if isValidName name throw new BuildException name this name name toLowerCase Locale US public String getName return name public void setOptional boolean optional this optional optional public boolean getOptional return optional public void setTrim boolean trim this trim trim public boolean getTrim return trim public void setDescription String desc description desc public String getDescription return description public boolean equals Object obj if obj null return false if obj getClass getClass return false Text other Text obj if name null if other name null return false else if name equals other name return false if optional other optional return false if trim other trim return false return true public int hashCode return objectHashCode name public static class TemplateElement private String name private String description private boolean optional false private boolean implicit false public void setName String name if isValidName name throw new BuildException name this name name toLowerCase Locale US public String getName return name public void setDescription String desc description desc public String getDescription return description public void setOptional boolean optional this optional optional public boolean isOptional return optional public void setImplicit boolean implicit this implicit implicit public boolean isImplicit return implicit public boolean equals Object obj if obj this return true if obj null obj getClass equals getClass return false TemplateElement TemplateElement obj return name null name null name equals name optional optional implicit implicit public int hashCode return objectHashCode name optional implicit private boolean sameOrSimilar Object obj boolean same if obj this return true if obj null return false if obj getClass equals getClass return false MacroDef other MacroDef obj if name null return other name null if name equals other name return false if other getLocation null other getLocation equals getLocation same return true if text null if other text null return false else if text equals other text return false if getURI null getURI equals getURI equals ProjectHelper ANT_CORE_URI if other getURI null other getURI equals other getURI equals ProjectHelper ANT_CORE_URI return false else if getURI equals other getURI return false if nestedSequential similar other nestedSequential return false if attributes equals other attributes return false if elements equals other elements return false return true public boolean similar Object obj return sameOrSimilar obj false public boolean sameDefinition Object obj return sameOrSimilar obj true private static class MyAntTypeDefinition extends AntTypeDefinition private MacroDef macroDef public MyAntTypeDefinition MacroDef macroDef this macroDef macroDef public Object create Project project Object super create project if null return null MacroInstance setMacroDef macroDef return public boolean sameDefinition AntTypeDefinition other Project project if super sameDefinition other project return false MyAntTypeDefinition otherDef MyAntTypeDefinition other return macroDef sameDefinition otherDef macroDef public boolean similarDefinition AntTypeDefinition other Project project if super similarDefinition other project return false MyAntTypeDefinition otherDef MyAntTypeDefinition other return macroDef similar otherDef macroDef private static int objectHashCode Object if null return else return hashCode public class TempFile extends Task private static final FileUtils FILE_UTILS FileUtils getFileUtils private String property private File destDir null private String prefix private String suffix private boolean deleteOnExit public void setProperty String property this property property public void setDestDir File destDir this destDir destDir public void setPrefix String prefix this prefix prefix public void setSuffix String suffix this suffix suffix public void setDeleteOnExit boolean deleteOnExit this deleteOnExit deleteOnExit public boolean isDeleteOnExit return deleteOnExit public void execute throws BuildException if property null property length throw new BuildException if destDir null destDir getProject resolveFile File tfile FILE_UTILS createTempFile prefix suffix destDir deleteOnExit getProject setNewProperty property tfile toString public class MakeUrl extends Task private String property private File file private String separator private List filesets new LinkedList private List paths new LinkedList private boolean validate true public static final String ERROR_MISSING_FILE public static final String ERROR_NO_PROPERTY public static final String ERROR_NO_FILES public void setProperty String property this property property public void setFile File file this file file public void addFileSet FileSet fileset filesets add fileset public void setSeparator String separator this separator separator public void setValidate boolean validate this validate validate public void addPath Path path paths add path private String filesetsToURL if filesets isEmpty return int count StringBuffer urls new StringBuffer ListIterator list filesets listIterator while list hasNext FileSet set FileSet list next DirectoryScanner scanner set getDirectoryScanner getProject String files scanner getIncludedFiles for int files length File new File scanner getBasedir files validateFile String asUrl toURL urls append asUrl log asUrl Project MSG_DEBUG urls append separator count return stripTrailingSeparator urls count private String stripTrailingSeparator StringBuffer urls int count if count urls delete urls length separator length urls length return new String urls else return private String pathsToURL if paths isEmpty return int count StringBuffer urls new StringBuffer ListIterator list paths listIterator while list hasNext Path path Path list next String elements path list for int elements length File new File elements validateFile String asUrl toURL urls append asUrl log asUrl Project MSG_DEBUG urls append separator count return stripTrailingSeparator urls count private void validateFile File fileToCheck if validate fileToCheck exists throw new BuildException ERROR_MISSING_FILE fileToCheck toString public void execute throws BuildException validate if getProject getProperty property null return String url String filesetURL filesetsToURL if file null validateFile file url toURL file if filesetURL length url url separator filesetURL else url filesetURL String pathURL pathsToURL if pathURL length if url length url url separator pathURL else url pathURL log property url Project MSG_VERBOSE getProject setNewProperty property url private void validate if property null throw new BuildException ERROR_NO_PROPERTY if file null filesets isEmpty paths isEmpty throw new BuildException ERROR_NO_FILES private String toURL File fileToConvert String url url FileUtils getFileUtils toURI fileToConvert getAbsolutePath return url public interface SOSCmd String COMMAND_SOS_EXE String COMMAND_GET_FILE String COMMAND_GET_PROJECT String COMMAND_CHECKOUT_FILE String COMMAND_CHECKOUT_PROJECT String COMMAND_CHECKIN_FILE String COMMAND_CHECKIN_PROJECT String COMMAND_HISTORY String COMMAND_LABEL String PROJECT_PREFIX String FLAG_COMMAND String FLAG_VSS_SERVER String FLAG_USERNAME String FLAG_PASSWORD String FLAG_COMMENT String FLAG_WORKING_DIR String FLAG_RECURSION String FLAG_VERSION String FLAG_LABEL String FLAG_NO_COMPRESSION String FLAG_NO_CACHE String FLAG_SOS_SERVER String FLAG_SOS_HOME String FLAG_PROJECT String FLAG_FILE String FLAG_VERBOSE public class IsReachable extends ProjectComponent implements Condition private String host private String url public static final int DEFAULT_TIMEOUT private int timeout DEFAULT_TIMEOUT public static final String ERROR_NO_HOSTNAME public static final String ERROR_BAD_TIMEOUT private static final String WARN_UNKNOWN_HOST public static final String ERROR_ON_NETWORK public static final String ERROR_BOTH_TARGETS public static final String MSG_NO_REACHABLE_TEST public static final String ERROR_BAD_URL public static final String ERROR_NO_HOST_IN_URL public static final String METHOD_NAME public void setHost String host this host host public void setUrl String url this url url public void setTimeout int timeout this timeout timeout private boolean empty String string return string null string length private static Class parameterTypes Integer TYPE public boolean eval throws BuildException if empty host empty url throw new BuildException ERROR_NO_HOSTNAME if timeout throw new BuildException ERROR_BAD_TIMEOUT String target host if empty url if empty host throw new BuildException ERROR_BOTH_TARGETS try URL realURL new URL url target realURL getHost if empty target throw new BuildException ERROR_NO_HOST_IN_URL url catch MalformedURLException throw new BuildException ERROR_BAD_URL url log target Project MSG_VERBOSE InetAddress address try address InetAddress getByName target catch UnknownHostException e1 log WARN_UNKNOWN_HOST target return false log address getHostAddress Project MSG_VERBOSE boolean reachable Method reachableMethod null try reachableMethod InetAddress class getMethod METHOD_NAME parameterTypes Object params new Object params new Integer timeout SECOND try reachable Boolean reachableMethod invoke address params booleanValue catch IllegalAccessException throw new BuildException reachableMethod catch InvocationTargetException Throwable nested getTargetException log ERROR_ON_NETWORK target nested toString reachable false catch NoSuchMethodException log METHOD_NAME Project MSG_VERBOSE log MSG_NO_REACHABLE_TEST reachable true log reachable Project MSG_VERBOSE return reachable public class DefaultExcludes extends Task private String add private String remove private boolean defaultrequested false private boolean echo false private int logLevel Project MSG_WARN public void execute throws BuildException if defaultrequested add equals remove equals echo throw new BuildException if defaultrequested DirectoryScanner resetDefaultExcludes if add equals DirectoryScanner addDefaultExclude add if remove equals DirectoryScanner removeDefaultExclude remove if echo StringBuffer message new StringBuffer message append StringUtils LINE_SEP String excludes DirectoryScanner getDefaultExcludes for int excludes length message append message append excludes message append StringUtils LINE_SEP log message toString logLevel public void setDefault boolean def defaultrequested def public void setAdd String add this add add public void setRemove String remove this remove remove public void setEcho boolean echo this echo echo public final class StripLineBreaks extends BaseParamFilterReader implements ChainableReader private static final String DEFAULT_LINE_BREAKS private static final String LINE_BREAKS_KEY private String lineBreaks DEFAULT_LINE_BREAKS public StripLineBreaks super public StripLineBreaks final Reader in super in public int read throws IOException if getInitialized initialize setInitialized true int ch in read while ch if lineBreaks indexOf ch break else ch in read return ch public void setLineBreaks final String lineBreaks this lineBreaks lineBreaks private String getLineBreaks return lineBreaks public Reader chain final Reader rdr StripLineBreaks newFilter new StripLineBreaks rdr newFilter setLineBreaks getLineBreaks newFilter setInitialized true return newFilter private void initialize String userDefinedLineBreaks null Parameter params getParameters if params null for int params length if LINE_BREAKS_KEY equals params getName userDefinedLineBreaks params getValue break if userDefinedLineBreaks null lineBreaks userDefinedLineBreaks public class Transform extends ExecuteOn public class DefaultLogger implements BuildLogger public static final int LEFT_COLUMN_SIZE protected PrintStream out protected PrintStream err protected int msgOutputLevel Project MSG_ERR private long startTime System currentTimeMillis protected static final String lSep StringUtils LINE_SEP protected boolean emacsMode false public DefaultLogger public void setMessageOutputLevel int level this msgOutputLevel level public void setOutputPrintStream PrintStream output this out new PrintStream output true public void setErrorPrintStream PrintStream err this err new PrintStream err true public void setEmacsMode boolean emacsMode this emacsMode emacsMode public void buildStarted BuildEvent event startTime System currentTimeMillis public void buildFinished BuildEvent event Throwable error event getException StringBuffer message new StringBuffer if error null message append StringUtils LINE_SEP message append getBuildSuccessfulMessage else message append StringUtils LINE_SEP message append getBuildFailedMessage message append StringUtils LINE_SEP if Project MSG_VERBOSE msgOutputLevel error instanceof BuildException message append StringUtils getStackTrace error else message append error toString append lSep message append StringUtils LINE_SEP message append message append formatTime System currentTimeMillis startTime String msg message toString if error null printMessage msg out Project MSG_VERBOSE else printMessage msg err Project MSG_ERR log msg protected String getBuildFailedMessage return protected String getBuildSuccessfulMessage return public void targetStarted BuildEvent event if Project MSG_INFO msgOutputLevel event getTarget getName equals String msg StringUtils LINE_SEP event getTarget getName printMessage msg out event getPriority log msg public void targetFinished BuildEvent event public void taskStarted BuildEvent event public void taskFinished BuildEvent event public void messageLogged BuildEvent event int priority event getPriority if priority msgOutputLevel StringBuffer message new StringBuffer if event getTask null emacsMode String name event getTask getTaskName String label name int size LEFT_COLUMN_SIZE label length StringBuffer tmp new StringBuffer for int size tmp append tmp append label label tmp toString try BufferedReader new BufferedReader new StringReader event getMessage String line readLine boolean first true do if first if line null message append label break else message append StringUtils LINE_SEP first false message append label append line line readLine while line null catch IOException message append label append event getMessage else message append event getMessage Throwable ex event getException if Project MSG_DEBUG msgOutputLevel ex null message append StringUtils getStackTrace ex String msg message toString if priority Project MSG_ERR printMessage msg out priority else printMessage msg err priority log msg protected static String formatTime final long millis return DateUtils formatElapsedTime millis protected void printMessage final String message final PrintStream stream final int priority stream println message protected void log String message public class ClasspathUtils public static final String REUSE_LOADER_REF MagicNames REFID_CLASSPATH_REUSE_LOADER public static ClassLoader getClassLoaderForPath Project Reference ref return getClassLoaderForPath ref false public static ClassLoader getClassLoaderForPath Project Reference ref boolean reverseLoader String pathId ref getRefId Object path getReference pathId if path instanceof Path throw new BuildException pathId String loaderId MagicNames REFID_CLASSPATH_LOADER_PREFIX pathId return getClassLoaderForPath Path path loaderId reverseLoader public static ClassLoader getClassLoaderForPath Project Path path String loaderId return getClassLoaderForPath path loaderId false public static ClassLoader getClassLoaderForPath Project Path path String loaderId boolean reverseLoader return getClassLoaderForPath path loaderId reverseLoader isMagicPropertySet public static ClassLoader getClassLoaderForPath Project Path path String loaderId boolean reverseLoader boolean reuseLoader ClassLoader cl null if loaderId null reuseLoader Object reusedLoader getReference loaderId if reusedLoader null reusedLoader instanceof ClassLoader throw new BuildException loaderId cl ClassLoader reusedLoader if cl null cl getUniqueClassLoaderForPath path reverseLoader if loaderId null reuseLoader addReference loaderId cl return cl public static ClassLoader getUniqueClassLoaderForPath Project Path path boolean reverseLoader AntClassLoader acl createClassLoader path if reverseLoader acl setParentFirst false acl addJavaLibraries return acl public static Object newInstance String className ClassLoader userDefinedLoader return newInstance className userDefinedLoader Object class public static Object newInstance String className ClassLoader userDefinedLoader Class expectedType try Class clazz Class forName className true userDefinedLoader Object clazz newInstance if expectedType isInstance throw new BuildException className expectedType return catch ClassNotFoundException throw new BuildException className catch InstantiationException throw new BuildException className catch IllegalAccessException throw new BuildException className catch LinkageError throw new BuildException className public static Delegate getDelegate ProjectComponent component return new Delegate component private static boolean isMagicPropertySet Project return getProperty REUSE_LOADER_REF null public static class Delegate private final ProjectComponent component private Path classpath private String classpathId private String className private String loaderId private boolean reverseLoader false Delegate ProjectComponent component this component component public void setClasspath Path classpath if this classpath null this classpath classpath else this classpath append classpath public Path createClasspath if this classpath null this classpath new Path component getProject return this classpath createPath public void setClassname String fcqn this className fcqn public void setClasspathref Reference this classpathId getRefId createClasspath setRefid public void setReverseLoader boolean reverseLoader this reverseLoader reverseLoader public void setLoaderRef Reference this loaderId getRefId public ClassLoader getClassLoader return getClassLoaderForPath getContextProject this classpath getClassLoadId this reverseLoader loaderId null isMagicPropertySet getContextProject private Project getContextProject return this component getProject public String getClassLoadId return this loaderId null this classpathId null MagicNames REFID_CLASSPATH_LOADER_PREFIX this classpathId this loaderId public Object newInstance return ClasspathUtils newInstance this className getClassLoader public Path getClasspath return classpath public boolean isReverseLoader return reverseLoader public class Sort extends BaseResourceCollectionWrapper private static class SortedBag extends AbstractCollection private class MutableInt private int value private class MyIterator implements Iterator private Iterator keyIter keySet iterator private Object current private int occurrence public synchronized boolean hasNext return occurrence keyIter hasNext public synchronized Object next if hasNext throw new NoSuchElementException if occurrence current keyIter next occurrence MutableInt get current value occurrence return current public void remove throw new UnsupportedOperationException private TreeMap private int size SortedBag Comparator new TreeMap public synchronized Iterator iterator return new MyIterator public synchronized boolean add Object if size Integer MAX_VALUE size MutableInt MutableInt get if null new MutableInt put value return true public synchronized int size return size private DelegatedResourceComparator comp new DelegatedResourceComparator protected synchronized Collection getCollection ResourceCollection rc getResourceCollection Iterator iter rc iterator if iter hasNext return Collections EMPTY_SET SortedBag new SortedBag comp while iter hasNext add iter next return public synchronized void add ResourceComparator if isReference throw noChildrenAllowed comp add FailFast invalidate this protected synchronized void dieOnCircularReference Stack stk Project throws BuildException if isChecked return if isReference super dieOnCircularReference stk else DataType invokeCircularReferenceCheck comp stk setChecked true public class Copydir extends MatchingTask private File srcDir private File destDir private boolean filtering false private boolean flatten false private boolean forceOverwrite false private Hashtable filecopyList new Hashtable public void setSrc File src srcDir src public void setDest File dest destDir dest public void setFiltering boolean filter filtering filter public void setFlatten boolean flatten this flatten flatten public void setForceoverwrite boolean force forceOverwrite force public void execute throws BuildException log if srcDir null throw new BuildException getLocation if srcDir exists throw new BuildException srcDir toString getLocation if destDir null throw new BuildException getLocation if srcDir equals destDir log Project MSG_WARN DirectoryScanner ds super getDirectoryScanner srcDir try String files ds getIncludedFiles scanDir srcDir destDir files if filecopyList size log filecopyList size filecopyList size destDir getAbsolutePath Enumeration filecopyList keys while hasMoreElements String fromFile String nextElement String toFile String filecopyList get fromFile try getProject copyFile fromFile toFile filtering forceOverwrite catch IOException ioe String msg fromFile toFile ioe getMessage throw new BuildException msg ioe getLocation finally filecopyList clear private void scanDir File from File to String files for int files length String filename files File srcFile new File from filename File destFile if flatten destFile new File to new File filename getName else destFile new File to filename if forceOverwrite srcFile lastModified destFile lastModified filecopyList put srcFile getAbsolutePath destFile getAbsolutePath public class PatternSet extends DataType implements Cloneable private Vector includeList new Vector private Vector excludeList new Vector private Vector includesFileList new Vector private Vector excludesFileList new Vector public class NameEntry private String name private String ifCond private String unlessCond public void setName String name this name name public void setIf String cond ifCond cond public void setUnless String cond unlessCond cond public String getName return name public String evalName Project return valid name null private boolean valid Project if ifCond null getProperty ifCond null return false else if unlessCond null getProperty unlessCond null return false return true public String toString StringBuffer buf new StringBuffer if name null buf append else buf append name if ifCond null unlessCond null buf append String connector if ifCond null buf append buf append ifCond connector if unlessCond null buf append connector buf append buf append unlessCond return buf toString public PatternSet super public void setRefid Reference throws BuildException if includeList isEmpty excludeList isEmpty throw tooManyAttributes super setRefid public void addConfiguredPatternset PatternSet if isReference throw noChildrenAllowed String nestedIncludes getIncludePatterns getProject String nestedExcludes getExcludePatterns getProject if nestedIncludes null for int nestedIncludes length createInclude setName nestedIncludes if nestedExcludes null for int nestedExcludes length createExclude setName nestedExcludes public NameEntry createInclude if isReference throw noChildrenAllowed return addPatternToList includeList public NameEntry createIncludesFile if isReference throw noChildrenAllowed return addPatternToList includesFileList public NameEntry createExclude if isReference throw noChildrenAllowed return addPatternToList excludeList public NameEntry createExcludesFile if isReference throw noChildrenAllowed return addPatternToList excludesFileList public void setIncludes String includes if isReference throw tooManyAttributes if includes null includes length StringTokenizer tok new StringTokenizer includes false while tok hasMoreTokens createInclude setName tok nextToken public void setExcludes String excludes if isReference throw tooManyAttributes if excludes null excludes length StringTokenizer tok new StringTokenizer excludes false while tok hasMoreTokens createExclude setName tok nextToken private NameEntry addPatternToList Vector list NameEntry result new NameEntry list addElement result return result public void setIncludesfile File includesFile throws BuildException if isReference throw tooManyAttributes createIncludesFile setName includesFile getAbsolutePath public void setExcludesfile File excludesFile throws BuildException if isReference throw tooManyAttributes createExcludesFile setName excludesFile getAbsolutePath private void readPatterns File patternfile Vector patternlist Project throws BuildException BufferedReader patternReader null try patternReader new BufferedReader new FileReader patternfile String line patternReader readLine while line null if line length line replaceProperties line addPatternToList patternlist setName line line patternReader readLine catch IOException ioe String msg patternfile throw new BuildException msg ioe finally if null patternReader try patternReader close catch IOException ioe public void append PatternSet other Project if isReference throw new BuildException String incl other getIncludePatterns if incl null for int incl length createInclude setName incl String excl other getExcludePatterns if excl null for int excl length createExclude setName excl public String getIncludePatterns Project if isReference return getRef getIncludePatterns else readFiles return makeArray includeList public String getExcludePatterns Project if isReference return getRef getExcludePatterns else readFiles return makeArray excludeList public boolean hasPatterns Project if isReference return getRef hasPatterns else return includesFileList size excludesFileList size includeList size excludeList size private PatternSet getRef Project return PatternSet getCheckedRef private String makeArray Vector list Project if list size return null Vector tmpNames new Vector for Enumeration list elements hasMoreElements NameEntry ne NameEntry nextElement String pattern ne evalName if pattern null pattern length tmpNames addElement pattern String result new String tmpNames size tmpNames copyInto result return result private void readFiles Project if includesFileList size Enumeration includesFileList elements while hasMoreElements NameEntry ne NameEntry nextElement String fileName ne evalName if fileName null File inclFile resolveFile fileName if inclFile exists throw new BuildException inclFile getAbsolutePath readPatterns inclFile includeList includesFileList removeAllElements if excludesFileList size Enumeration excludesFileList elements while hasMoreElements NameEntry ne NameEntry nextElement String fileName ne evalName if fileName null File exclFile resolveFile fileName if exclFile exists throw new BuildException exclFile getAbsolutePath readPatterns exclFile excludeList excludesFileList removeAllElements public String toString return includeList excludeList public Object clone try PatternSet ps PatternSet super clone ps includeList Vector includeList clone ps excludeList Vector excludeList clone ps includesFileList Vector includesFileList clone ps excludesFileList Vector excludesFileList clone return ps catch CloneNotSupportedException throw new BuildException public class Environment protected Vector variables public static class Variable private String key value public Variable super public void setKey String key this key key public void setValue String value this value value public String getKey return this key public String getValue return this value public void setPath Path path this value path toString public void setFile java io File file this value file getAbsolutePath public String getContent throws BuildException validate StringBuffer sb new StringBuffer key trim sb append append value trim return sb toString public void validate if key null value null throw new BuildException public Environment variables new Vector public void addVariable Variable var variables addElement var public String getVariables throws BuildException if variables size return null String result new String variables size for int result length result Variable variables elementAt getContent return result public Vector getVariablesVector return variables public class ProjectHelperImpl extends ProjectHelper private static final FileUtils FILE_UTILS FileUtils getFileUtils private org xml sax Parser parser private Project project private File buildFile private File buildFileParent private Locator locator private Target implicitTarget new Target public ProjectHelperImpl implicitTarget setName public void parse Project project Object source throws BuildException if source instanceof File throw new BuildException File bFile File source FileInputStream inputStream null InputSource inputSource null this project project this buildFile new File bFile getAbsolutePath buildFileParent new File this buildFile getParent try try parser JAXPUtils getParser catch BuildException parser new XMLReaderAdapter JAXPUtils getXMLReader String uri FILE_UTILS toURI bFile getAbsolutePath inputStream new FileInputStream bFile inputSource new InputSource inputStream inputSource setSystemId uri project log bFile uri Project MSG_VERBOSE HandlerBase hb new RootHandler this parser setDocumentHandler hb parser setEntityResolver hb parser setErrorHandler hb parser setDTDHandler hb parser parse inputSource catch SAXParseException exc Location location new Location exc getSystemId exc getLineNumber exc getColumnNumber Throwable exc getException if instanceof BuildException BuildException be BuildException if be getLocation Location UNKNOWN_LOCATION be setLocation location throw be throw new BuildException exc getMessage location catch SAXException exc Throwable exc getException if instanceof BuildException throw BuildException throw new BuildException exc getMessage catch FileNotFoundException exc throw new BuildException exc catch UnsupportedEncodingException exc throw new BuildException exc catch IOException exc throw new BuildException exc getMessage exc finally FileUtils close inputStream static class AbstractHandler extends HandlerBase protected DocumentHandler parentHandler ProjectHelperImpl helperImpl public AbstractHandler ProjectHelperImpl helperImpl DocumentHandler parentHandler this parentHandler parentHandler this helperImpl helperImpl helperImpl parser setDocumentHandler this public void startElement String tag AttributeList attrs throws SAXParseException throw new SAXParseException tag helperImpl locator public void characters char buf int start int count throws SAXParseException String new String buf start count trim if length throw new SAXParseException helperImpl locator public void endElement String name throws SAXException helperImpl parser setDocumentHandler parentHandler static class RootHandler extends HandlerBase ProjectHelperImpl helperImpl public RootHandler ProjectHelperImpl helperImpl this helperImpl helperImpl public InputSource resolveEntity String publicId String systemId helperImpl project log systemId Project MSG_VERBOSE if systemId startsWith String path FILE_UTILS fromURI systemId File file new File path if file isAbsolute file FILE_UTILS resolveFile helperImpl buildFileParent path helperImpl project log systemId helperImpl buildFile path replace Project MSG_WARN try InputSource inputSource new InputSource new FileInputStream file inputSource setSystemId FILE_UTILS toURI file getAbsolutePath return inputSource catch FileNotFoundException fne helperImpl project log file getAbsolutePath Project MSG_WARN return null public void startElement String tag AttributeList attrs throws SAXParseException if tag equals new ProjectHandler helperImpl this init tag attrs else throw new SAXParseException helperImpl locator public void setDocumentLocator Locator locator helperImpl locator locator static class ProjectHandler extends AbstractHandler public ProjectHandler ProjectHelperImpl helperImpl DocumentHandler parentHandler super helperImpl parentHandler public void init String tag AttributeList attrs throws SAXParseException String def null String name null String id null String baseDir null for int attrs getLength String key attrs getName String value attrs getValue if key equals def value else if key equals name value else if key equals id value else if key equals baseDir value else throw new SAXParseException attrs getName helperImpl locator if def null def equals helperImpl project setDefaultTarget def else throw new BuildException if name null helperImpl project setName name helperImpl project addReference name helperImpl project if id null helperImpl project addReference id helperImpl project if helperImpl project getProperty null helperImpl project setBasedir helperImpl project getProperty else if baseDir null helperImpl project setBasedir helperImpl buildFileParent getAbsolutePath else if new File baseDir isAbsolute helperImpl project setBasedir baseDir else File resolvedBaseDir FILE_UTILS resolveFile helperImpl buildFileParent baseDir helperImpl project setBaseDir resolvedBaseDir helperImpl project addTarget helperImpl implicitTarget public void startElement String name AttributeList attrs throws SAXParseException if name equals handleTarget name attrs else handleElement helperImpl this helperImpl implicitTarget name attrs private void handleTarget String tag AttributeList attrs throws SAXParseException new TargetHandler helperImpl this init tag attrs static class TargetHandler extends AbstractHandler private Target target public TargetHandler ProjectHelperImpl helperImpl DocumentHandler parentHandler super helperImpl parentHandler public void init String tag AttributeList attrs throws SAXParseException String name null String depends String ifCond null String unlessCond null String id null String description null for int attrs getLength String key attrs getName String value attrs getValue if key equals name value if name equals throw new BuildException new Location helperImpl locator else if key equals depends value else if key equals ifCond value else if key equals unlessCond value else if key equals id value else if key equals description value else throw new SAXParseException key helperImpl locator if name null throw new SAXParseException helperImpl locator target new Target target addDependency target setName name target setIf ifCond target setUnless unlessCond target setDescription description helperImpl project addTarget name target if id null id equals helperImpl project addReference id target if depends length target setDepends depends public void startElement String name AttributeList attrs throws SAXParseException handleElement helperImpl this target name attrs private static void handleElement ProjectHelperImpl helperImpl DocumentHandler parent Target target String elementName AttributeList attrs throws SAXParseException if elementName equals new DescriptionHandler helperImpl parent else if helperImpl project getDataTypeDefinitions get elementName null new DataTypeHandler helperImpl parent target init elementName attrs else new TaskHandler helperImpl parent target null target init elementName attrs static class DescriptionHandler extends AbstractHandler public DescriptionHandler ProjectHelperImpl helperImpl DocumentHandler parentHandler super helperImpl parentHandler public void characters char buf int start int count String text new String buf start count String currentDescription helperImpl project getDescription if currentDescription null helperImpl project setDescription text else helperImpl project setDescription currentDescription text static class TaskHandler extends AbstractHandler private Target target private TaskContainer container private Task task private RuntimeConfigurable parentWrapper private RuntimeConfigurable wrapper null public TaskHandler ProjectHelperImpl helperImpl DocumentHandler parentHandler TaskContainer container RuntimeConfigurable parentWrapper Target target super helperImpl parentHandler this container container this parentWrapper parentWrapper this target target public void init String tag AttributeList attrs throws SAXParseException try task helperImpl project createTask tag catch BuildException if task null task new UnknownElement tag task setProject helperImpl project task setTaskName tag task setLocation new Location helperImpl locator helperImpl configureId task attrs task setOwningTarget target container addTask task task init wrapper task getRuntimeConfigurableWrapper wrapper setAttributes attrs if parentWrapper null parentWrapper addChild wrapper public void characters char buf int start int count wrapper addText buf start count public void startElement String name AttributeList attrs throws SAXParseException if task instanceof TaskContainer new TaskHandler helperImpl this TaskContainer task wrapper target init name attrs else new NestedElementHandler helperImpl this task wrapper target init name attrs static class NestedElementHandler extends AbstractHandler private Object parent private Object child private RuntimeConfigurable parentWrapper private RuntimeConfigurable childWrapper null private Target target public NestedElementHandler ProjectHelperImpl helperImpl DocumentHandler parentHandler Object parent RuntimeConfigurable parentWrapper Target target super helperImpl parentHandler if parent instanceof TypeAdapter this parent TypeAdapter parent getProxy else this parent parent this parentWrapper parentWrapper this target target public void init String propType AttributeList attrs throws SAXParseException Class parentClass parent getClass IntrospectionHelper ih IntrospectionHelper getHelper helperImpl project parentClass try String elementName propType toLowerCase Locale US if parent instanceof UnknownElement UnknownElement uc new UnknownElement elementName uc setProject helperImpl project UnknownElement parent addChild uc child uc else child ih createElement helperImpl project parent elementName helperImpl configureId child attrs childWrapper new RuntimeConfigurable child propType childWrapper setAttributes attrs parentWrapper addChild childWrapper catch BuildException exc throw new SAXParseException exc getMessage helperImpl locator exc public void characters char buf int start int count childWrapper addText buf start count public void startElement String name AttributeList attrs throws SAXParseException if child instanceof TaskContainer new TaskHandler helperImpl this TaskContainer child childWrapper target init name attrs else new NestedElementHandler helperImpl this child childWrapper target init name attrs static class DataTypeHandler extends AbstractHandler private Target target private Object element private RuntimeConfigurable wrapper null public DataTypeHandler ProjectHelperImpl helperImpl DocumentHandler parentHandler Target target super helperImpl parentHandler this target target public void init String propType AttributeList attrs throws SAXParseException try element helperImpl project createDataType propType if element null throw new BuildException propType wrapper new RuntimeConfigurable element propType wrapper setAttributes attrs target addDataType wrapper catch BuildException exc throw new SAXParseException exc getMessage helperImpl locator exc public void characters char buf int start int count wrapper addText buf start count public void startElement String name AttributeList attrs throws SAXParseException new NestedElementHandler helperImpl this element wrapper target init name attrs private void configureId Object target AttributeList attr String id attr getValue if id null project addReference id target public class Expand extends Task private boolean overwrite true private Mapper mapperElement null private Vector patternsets new Vector private Union resources new Union private boolean resourcesSpecified false private static final String NATIVE_ENCODING private String encoding public static final String ERROR_MULTIPLE_MAPPERS private static final FileUtils FILE_UTILS FileUtils getFileUtils public void execute throws BuildException if equals getTaskType log if source null resourcesSpecified throw new BuildException if dest null throw new BuildException if dest exists dest isDirectory throw new BuildException getLocation if source null if source isDirectory throw new BuildException getLocation else expandFile FILE_UTILS source dest Iterator iter resources iterator while iter hasNext Resource Resource iter next if isExists continue if instanceof FileResource expandFile FILE_UTILS FileResource getFile dest else expandResource dest protected void expandFile FileUtils fileUtils File srcF File dir log srcF dir Project MSG_INFO ZipFile zf null FileNameMapper mapper getMapper try zf new ZipFile srcF encoding Enumeration zf getEntries while hasMoreElements ZipEntry ze ZipEntry nextElement extractFile fileUtils srcF dir zf getInputStream ze ze getName new Date ze getTime ze isDirectory mapper log Project MSG_VERBOSE catch IOException ioe throw new BuildException srcF getPath ioe finally ZipFile closeQuietly zf protected void expandResource Resource srcR File dir throw new BuildException protected FileNameMapper getMapper FileNameMapper mapper null if mapperElement null mapper mapperElement getImplementation else mapper new IdentityMapper return mapper protected void extractFile FileUtils fileUtils File srcF File dir InputStream compressedInputStream String entryName Date entryDate boolean isDirectory FileNameMapper mapper throws IOException if patternsets null patternsets size String name entryName replace File separatorChar replace File separatorChar boolean included false Set includePatterns new HashSet Set excludePatterns new HashSet for int size patternsets size size PatternSet PatternSet patternsets elementAt String incls getIncludePatterns getProject if incls null incls length incls new String for int incls length String pattern incls replace File separatorChar replace File separatorChar if pattern endsWith File separator pattern includePatterns add pattern String excls getExcludePatterns getProject if excls null for int excls length String pattern excls replace File separatorChar replace File separatorChar if pattern endsWith File separator pattern excludePatterns add pattern for Iterator iter includePatterns iterator included iter hasNext String pattern String iter next included SelectorUtils matchPath pattern name for Iterator iter excludePatterns iterator included iter hasNext String pattern String iter next included SelectorUtils matchPath pattern name if included return String mappedNames mapper mapFileName entryName if mappedNames null mappedNames length mappedNames new String entryName File fileUtils resolveFile dir mappedNames try if overwrite exists lastModified entryDate getTime log Project MSG_DEBUG return log entryName Project MSG_VERBOSE File dirF getParentFile if dirF null dirF mkdirs if isDirectory mkdirs else byte buffer new byte int length FileOutputStream fos null try fos new FileOutputStream while length compressedInputStream read buffer fos write buffer length fos close fos null finally FileUtils close fos fileUtils setFileLastModified entryDate getTime catch FileNotFoundException ex log getPath Project MSG_WARN public void setDest File this dest public void setSrc File this source public void setOverwrite boolean overwrite public void addPatternset PatternSet set patternsets addElement set public void addFileset FileSet set add set public void add ResourceCollection rc resourcesSpecified true resources add rc public Mapper createMapper throws BuildException if mapperElement null throw new BuildException ERROR_MULTIPLE_MAPPERS getLocation mapperElement new Mapper getProject return mapperElement public void add FileNameMapper fileNameMapper createMapper add fileNameMapper public void setEncoding String encoding if NATIVE_ENCODING equals encoding encoding null this encoding encoding public abstract class BaseSelectorContainer extends BaseSelector implements SelectorContainer private Vector selectorsList new Vector public BaseSelectorContainer public boolean hasSelectors return selectorsList isEmpty public int selectorCount return selectorsList size public FileSelector getSelectors Project FileSelector result new FileSelector selectorsList size selectorsList copyInto result return result public Enumeration selectorElements return selectorsList elements public String toString StringBuffer buf new StringBuffer Enumeration selectorElements if hasMoreElements while hasMoreElements buf append nextElement toString if hasMoreElements buf append return buf toString public void appendSelector FileSelector selector selectorsList addElement selector public void validate verifySettings String errmsg getError if errmsg null throw new BuildException errmsg Enumeration selectorElements while hasMoreElements Object nextElement if instanceof BaseSelector BaseSelector validate public abstract boolean isSelected File basedir String filename File file public void addSelector SelectSelector selector appendSelector selector public void addAnd AndSelector selector appendSelector selector public void addOr OrSelector selector appendSelector selector public void addNot NotSelector selector appendSelector selector public void addNone NoneSelector selector appendSelector selector public void addMajority MajoritySelector selector appendSelector selector public void addDate DateSelector selector appendSelector selector public void addSize SizeSelector selector appendSelector selector public void addFilename FilenameSelector selector appendSelector selector public void addCustom ExtendSelector selector appendSelector selector public void addContains ContainsSelector selector appendSelector selector public void addPresent PresentSelector selector appendSelector selector public void addDepth DepthSelector selector appendSelector selector public void addDepend DependSelector selector appendSelector selector public void addDifferent DifferentSelector selector appendSelector selector public void addType TypeSelector selector appendSelector selector public void addContainsRegexp ContainsRegexpSelector selector appendSelector selector public void addModified ModifiedSelector selector appendSelector selector public void add FileSelector selector appendSelector selector public interface JavahAdapter boolean compile Javah javah throws BuildException public class PresentSelector extends BaseSelector private File targetdir null private Mapper mapperElement null private FileNameMapper map null private boolean destmustexist true public PresentSelector public String toString StringBuffer buf new StringBuffer if targetdir null buf append else buf append targetdir getName buf append if destmustexist buf append else buf append if map null buf append map toString else if mapperElement null buf append mapperElement toString buf append return buf toString public void setTargetdir File targetdir this targetdir targetdir public Mapper createMapper throws BuildException if mapperElement null throw new BuildException mapperElement new Mapper getProject return mapperElement public void setPresent FilePresence fp if fp getIndex destmustexist false public void verifySettings if targetdir null setError if mapperElement null map new IdentityMapper else map mapperElement getImplementation if map null setError public boolean isSelected File basedir String filename File file validate String destfiles map mapFileName filename if destfiles null return false if destfiles length destfiles null throw new BuildException targetdir filename String destname destfiles File destfile new File targetdir destname return destfile exists destmustexist public static class FilePresence extends EnumeratedAttribute public String getValues return new String public class MultipleChoiceInputRequest extends InputRequest private Vector choices new Vector public MultipleChoiceInputRequest String prompt Vector choices super prompt if choices null throw new IllegalArgumentException this choices choices public Vector getChoices return choices public boolean isInputValid return choices contains getInput equals getInput getDefaultValue null public class EchoXML extends XMLFragment private File file private boolean append private static final String ERROR_NO_XML public void setFile File file public void setAppend boolean append public void execute DOMElementWriter writer new DOMElementWriter append OutputStream os null try if file null os new FileOutputStream file getAbsolutePath append else os new LogOutputStream this Project MSG_INFO Node getFragment getFirstChild if null throw new BuildException ERROR_NO_XML writer write Element os catch BuildException throw catch Exception throw new BuildException finally FileUtils close os public class MailMessage public static final String DEFAULT_HOST public static final int DEFAULT_PORT private String host private int port DEFAULT_PORT private String from private Vector replyto private Vector to private Vector cc private Vector headersKeys private Vector headersValues private MailPrintStream out private SmtpResponseReader in private Socket socket private static final int OK_READY private static final int OK_HELO private static final int OK_FROM private static final int OK_RCPT_1 private static final int OK_RCPT_2 private static final int OK_DATA private static final int OK_DOT private static final int OK_QUIT public MailMessage throws IOException this DEFAULT_HOST DEFAULT_PORT public MailMessage String host throws IOException this host DEFAULT_PORT public MailMessage String host int port throws IOException this port port this host host replyto new Vector to new Vector cc new Vector headersKeys new Vector headersValues new Vector connect sendHelo public void setPort int port this port port public void from String from throws IOException sendFrom from this from from public void replyto String rto this replyto addElement rto public void to String to throws IOException sendRcpt to this to addElement to public void cc String cc throws IOException sendRcpt cc this cc addElement cc public void bcc String bcc throws IOException sendRcpt bcc public void setSubject String subj setHeader subj public void setHeader String name String value headersKeys add name headersValues add value public PrintStream getPrintStream throws IOException setFromHeader setReplyToHeader setToHeader setCcHeader setHeader sendData flushHeaders return out void setFromHeader setHeader from void setReplyToHeader if replyto isEmpty setHeader vectorToList replyto void setToHeader if to isEmpty setHeader vectorToList to void setCcHeader if cc isEmpty setHeader vectorToList cc String vectorToList Vector StringBuffer buf new StringBuffer Enumeration elements while hasMoreElements buf append nextElement if hasMoreElements buf append return buf toString void flushHeaders throws IOException for int headersKeys size String name String headersKeys elementAt String value String headersValues elementAt out println name value out println out flush public void sendAndClose throws IOException try sendDot sendQuit finally disconnect static String sanitizeAddress String int paramDepth int start int end int len length for int len char charAt if paramDepth if start else if paramDepth if end else if paramDepth start else if paramDepth end if end end len return substring start end void connect throws IOException socket new Socket host port out new MailPrintStream new BufferedOutputStream socket getOutputStream in new SmtpResponseReader socket getInputStream getReady void getReady throws IOException String response in getResponse int ok OK_READY if isResponseOK response ok throw new IOException response void sendHelo throws IOException String local InetAddress getLocalHost getHostName int ok OK_HELO send local ok void sendFrom String from throws IOException int ok OK_FROM send sanitizeAddress from ok void sendRcpt String rcpt throws IOException int ok OK_RCPT_1 OK_RCPT_2 send sanitizeAddress rcpt ok void sendData throws IOException int ok OK_DATA send ok void sendDot throws IOException int ok OK_DOT void sendQuit throws IOException int ok OK_QUIT try send ok catch IOException throw new ErrorInQuitException void send String msg int ok throws IOException String response in getResponse if isResponseOK response ok throw new IOException msg response boolean isResponseOK String response int ok for int ok length if response startsWith ok return true return false void disconnect throws IOException if out null out close if in null try in close catch IOException if socket null try socket close catch IOException class MailPrintStream extends PrintStream private int lastChar public MailPrintStream OutputStream out public void write int if lastChar rawWrite else if lastChar rawWrite else rawWrite lastChar public void write byte buf int off int len for int len write buf off void rawWrite int super write void rawPrint String int len length for int len rawWrite charAt public class DoubleCPInfo extends ConstantCPInfo public DoubleCPInfo super CONSTANT_DOUBLE public void read DataInputStream cpStream throws IOException setValue new Double cpStream readDouble public String toString return getValue public class Socket extends ProjectComponent implements Condition private String server null private int port public void setServer String server this server server public void setPort int port this port port public boolean eval throws BuildException if server null throw new BuildException if port throw new BuildException log server port Project MSG_VERBOSE java net Socket null try new java net Socket server port catch IOException return false finally if null try close catch IOException ioe return true public class ExitStatusException extends BuildException private int status public ExitStatusException int status super this status status public ExitStatusException String msg int status super msg this status status public ExitStatusException String message int status Location location super message location this status status public int getStatus return status public class Target implements TaskContainer private String name private String ifCondition private String unlessCondition private List dependencies null private List children new ArrayList private Location location Location UNKNOWN_LOCATION private Project project private String description null public Target public Target Target other this name other name this ifCondition other ifCondition this unlessCondition other unlessCondition this dependencies other dependencies this location other location this project other project this description other description this children other children public void setProject Project project this project project public Project getProject return project public void setLocation Location location this location location public Location getLocation return location public void setDepends String depS if depS length StringTokenizer tok new StringTokenizer depS true while tok hasMoreTokens String token tok nextToken trim if equals token equals token throw new BuildException getName addDependency token if tok hasMoreTokens token tok nextToken if tok hasMoreTokens equals token throw new BuildException getName public void setName String name this name name public String getName return name public void addTask Task task children add task public void addDataType RuntimeConfigurable children add public Task getTasks List tasks new ArrayList children size Iterator it children iterator while it hasNext Object it next if instanceof Task tasks add return Task tasks toArray new Task tasks size public void addDependency String dependency if dependencies null dependencies new ArrayList dependencies add dependency public Enumeration getDependencies return dependencies null Collections enumeration dependencies new CollectionUtils EmptyEnumeration public boolean dependsOn String other Project getProject Hashtable null null getTargets return null topoSort getName false contains get other public void setIf String property ifCondition property null property public String getIf return equals ifCondition null ifCondition public void setUnless String property unlessCondition property null property public String getUnless return equals unlessCondition null unlessCondition public void setDescription String description this description description public String getDescription return description public String toString return name public void execute throws BuildException if testIfCondition testUnlessCondition for int taskPosition taskPosition children size taskPosition Object children get taskPosition if instanceof Task Task task Task task perform else RuntimeConfigurable RuntimeConfigurable maybeConfigure project else if testIfCondition project log this project replaceProperties ifCondition Project MSG_VERBOSE else project log this project replaceProperties unlessCondition Project MSG_VERBOSE public final void performTasks RuntimeException thrown null project fireTargetStarted this try execute catch RuntimeException exc thrown exc throw exc finally project fireTargetFinished this thrown void replaceChild Task el RuntimeConfigurable int index while index children indexOf el children set index void replaceChild Task el Task int index while index children indexOf el children set index private boolean testIfCondition if equals ifCondition return true String test project replaceProperties ifCondition return project getProperty test null private boolean testUnlessCondition if equals unlessCondition return true String test project replaceProperties unlessCondition return project getProperty test null public class Name implements ResourceSelector private String pattern private boolean cs true public void setName String pattern public String getName return pattern public void setCaseSensitive boolean cs public boolean isCaseSensitive return cs public boolean isSelected Resource String getName if SelectorUtils match pattern cs return true String toString return equals false SelectorUtils match pattern cs public class Contains implements Condition private String string subString private boolean caseSensitive true public void setString String string this string string public void setSubstring String subString this subString subString public void setCasesensitive boolean caseSensitive public boolean eval throws BuildException if string null subString null throw new BuildException return caseSensitive string indexOf subString string toLowerCase indexOf subString toLowerCase public interface JUnitTaskMirror void addVmExit JUnitTest test JUnitResultFormatterMirror formatter OutputStream out String message String testCase JUnitTestRunnerMirror newJUnitTestRunner JUnitTest test boolean haltOnError boolean filterTrace boolean haltOnFailure boolean showOutput boolean logTestListenerEvents AntClassLoader classLoader SummaryJUnitResultFormatterMirror newSummaryJUnitResultFormatter public interface JUnitResultFormatterMirror void setOutput OutputStream outputStream public interface SummaryJUnitResultFormatterMirror extends JUnitResultFormatterMirror void setWithOutAndErr boolean value public interface JUnitTestRunnerMirror String IGNORED_FILE_NAME int SUCCESS int FAILURES int ERRORS void setPermissions Permissions perm void run void addFormatter JUnitResultFormatterMirror formatter int getRetCode void handleErrorFlush String output void handleErrorOutput String output void handleOutput String output int handleInput byte buffer int offset int length throws IOException void handleFlush String output public abstract class ProjectComponent implements Cloneable protected Project project protected Location location Location UNKNOWN_LOCATION protected String description public ProjectComponent public void setProject Project project this project project public Project getProject return project public Location getLocation return location public void setLocation Location location this location location public void setDescription String desc description desc public String getDescription return description public void log String msg log msg Project MSG_INFO public void log String msg int msgLevel if getProject null getProject log msg msgLevel else if msgLevel Project MSG_INFO System err println msg public Object clone throws CloneNotSupportedException ProjectComponent pc ProjectComponent super clone pc setLocation getLocation pc setProject getProject return pc public final class StripLineComments extends BaseParamFilterReader implements ChainableReader private static final String COMMENTS_KEY private Vector comments new Vector private String line null public StripLineComments super public StripLineComments final Reader in super in public int read throws IOException if getInitialized initialize setInitialized true int ch if line null ch line charAt if line length line null else line line substring else line readLine final int commentsSize comments size while line null for int commentsSize String comment String comments elementAt if line startsWith comment line null break if line null line readLine else break if line null return read return ch public void addConfiguredComment final Comment comment comments addElement comment getValue private void setComments final Vector comments this comments comments private Vector getComments return comments public Reader chain final Reader rdr StripLineComments newFilter new StripLineComments rdr newFilter setComments getComments newFilter setInitialized true return newFilter private void initialize Parameter params getParameters if params null for int params length if COMMENTS_KEY equals params getType comments addElement params getValue public static class Comment private String value public final void setValue String comment value comment public final String getValue return value public class CSharp extends DotnetCompile String definitions private File docFile private int fileAlign private boolean fullpaths false private boolean incremental protected boolean unsafe private boolean noconfig false public CSharp clear public void clear super clear docFile null fileAlign fullpaths true incremental false unsafe false noconfig false definitions null setExecutable isWindows public void setDocFile File docFile protected String getDocFileParameter if docFile null return docFile toString else return null public void setFileAlign int fileAlign this fileAlign fileAlign protected String getFileAlignParameter if fileAlign equals getExecutable return fileAlign else return null public void setFullPaths boolean enabled fullpaths enabled protected String getFullPathsParameter return fullpaths null public void setIncremental boolean incremental this incremental incremental public boolean getIncremental return incremental protected String getIncrementalParameter return incremental public void setOutputFile File params setDestFile params public void setUnsafe boolean unsafe this unsafe unsafe public boolean getUnsafe return this unsafe protected String getUnsafeParameter return unsafe null public void setNoConfig boolean enabled noconfig enabled protected String getNoConfigParameter return noconfig null public void setDefinitions String params definitions params protected String getDefinitionsParameter String predecessors super getDefinitionsParameter if notEmpty definitions if predecessors null predecessors return predecessors definitions else return predecessors public void addCompilerSpecificOptions NetCommand command command addArgument getIncludeDefaultReferencesParameter command addArgument getWarnLevelParameter command addArgument getDocFileParameter command addArgument getFullPathsParameter command addArgument getFileAlignParameter command addArgument getIncrementalParameter command addArgument getNoConfigParameter command addArgument getUnsafeParameter public String getReferenceDelimiter return public String getFileExtension return protected void createResourceParameter NetCommand command DotnetResource resource resource getParameters getProject command true public interface ResourceFactory Resource getResource String name public interface DynamicConfiguratorNS extends DynamicAttributeNS DynamicElementNS public class TimeComparison extends EnumeratedAttribute private static final String VALUES new String private static final FileUtils FILE_UTILS FileUtils getFileUtils public static final TimeComparison BEFORE new TimeComparison public static final TimeComparison AFTER new TimeComparison public static final TimeComparison EQUAL new TimeComparison public TimeComparison public TimeComparison String value setValue value public String getValues return VALUES public boolean evaluate long t1 long t2 return evaluate t1 t2 FILE_UTILS getFileTimestampGranularity public boolean evaluate long t1 long t2 long int cmp getIndex if cmp throw new BuildException if cmp return t1 t2 if cmp return t1 t2 return Math abs t1 t2 public static int compare long t1 long t2 return compare t1 t2 FILE_UTILS getFileTimestampGranularity public static int compare long t1 long t2 long long diff t1 t2 long abs Math abs diff return abs Math abs int diff abs public class MSVSSCREATE extends MSVSS Commandline buildCmdLine Commandline commandLine new Commandline if getVsspath null String msg throw new BuildException msg getLocation commandLine setExecutable getSSCommand commandLine createArgument setValue COMMAND_CREATE commandLine createArgument setValue getVsspath commandLine createArgument setValue getComment commandLine createArgument setValue getAutoresponse commandLine createArgument setValue getQuiet commandLine createArgument setValue getLogin return commandLine public void setComment String comment super setInternalComment comment public final void setQuiet boolean quiet super setInternalQuiet quiet public void setAutoresponse String response super setInternalAutoResponse response public class TarBuffer public static final int DEFAULT_RCDSIZE public static final int DEFAULT_BLKSIZE DEFAULT_RCDSIZE private InputStream inStream private OutputStream outStream private byte blockBuffer private int currBlkIdx private int currRecIdx private int blockSize private int recordSize private int recsPerBlock private boolean debug public TarBuffer InputStream inStream this inStream TarBuffer DEFAULT_BLKSIZE public TarBuffer InputStream inStream int blockSize this inStream blockSize TarBuffer DEFAULT_RCDSIZE public TarBuffer InputStream inStream int blockSize int recordSize this inStream inStream this outStream null this initialize blockSize recordSize public TarBuffer OutputStream outStream this outStream TarBuffer DEFAULT_BLKSIZE public TarBuffer OutputStream outStream int blockSize this outStream blockSize TarBuffer DEFAULT_RCDSIZE public TarBuffer OutputStream outStream int blockSize int recordSize this inStream null this outStream outStream this initialize blockSize recordSize private void initialize int blockSize int recordSize this debug false this blockSize blockSize this recordSize recordSize this recsPerBlock this blockSize this recordSize this blockBuffer new byte this blockSize if this inStream null this currBlkIdx this currRecIdx this recsPerBlock else this currBlkIdx this currRecIdx public int getBlockSize return this blockSize public int getRecordSize return this recordSize public void setDebug boolean debug this debug debug public boolean isEOFRecord byte record for int sz this getRecordSize sz if record return false return true public void skipRecord throws IOException if this debug System err println this currRecIdx this currBlkIdx if this inStream null throw new IOException if this currRecIdx this recsPerBlock if this readBlock this currRecIdx public byte readRecord throws IOException if this debug System err println this currRecIdx this currBlkIdx if this inStream null throw new IOException if this currRecIdx this recsPerBlock if this readBlock return null byte result new byte this recordSize System arraycopy this blockBuffer this currRecIdx this recordSize result this recordSize this currRecIdx return result private boolean readBlock throws IOException if this debug System err println this currBlkIdx if this inStream null throw new IOException this currRecIdx int offset int bytesNeeded this blockSize while bytesNeeded long numBytes this inStream read this blockBuffer offset bytesNeeded if numBytes if offset return false Arrays fill blockBuffer offset offset bytesNeeded byte break offset numBytes bytesNeeded numBytes if numBytes this blockSize if this debug System err println numBytes this blockSize this currBlkIdx return true public int getCurrentBlockNum return this currBlkIdx public int getCurrentRecordNum return this currRecIdx public void writeRecord byte record throws IOException if this debug System err println this currRecIdx this currBlkIdx if this outStream null throw new IOException if record length this recordSize throw new IOException record length this recordSize if this currRecIdx this recsPerBlock this writeBlock System arraycopy record this blockBuffer this currRecIdx this recordSize this recordSize this currRecIdx public void writeRecord byte buf int offset throws IOException if this debug System err println this currRecIdx this currBlkIdx if this outStream null throw new IOException if offset this recordSize buf length throw new IOException buf length offset this recordSize if this currRecIdx this recsPerBlock this writeBlock System arraycopy buf offset this blockBuffer this currRecIdx this recordSize this recordSize this currRecIdx private void writeBlock throws IOException if this debug System err println this currBlkIdx if this outStream null throw new IOException this outStream write this blockBuffer this blockSize this outStream flush this currRecIdx this currBlkIdx private void flushBlock throws IOException if this debug System err println if this outStream null throw new IOException if this currRecIdx this writeBlock public void close throws IOException if this debug System err println if this outStream null this flushBlock if this outStream System out this outStream System err this outStream close this outStream null else if this inStream null if this inStream System in this inStream close this inStream null public class NotSelector extends NoneSelector public NotSelector public NotSelector FileSelector other this appendSelector other public String toString StringBuffer buf new StringBuffer if hasSelectors buf append buf append super toString buf append return buf toString public void verifySettings if selectorCount setError public class AncestorAnalyzer extends AbstractAnalyzer public AncestorAnalyzer try new ClassParser catch IOException protected void determineDependencies Vector files Vector classes Hashtable dependencies new Hashtable Hashtable containers new Hashtable Hashtable toAnalyze new Hashtable Hashtable nextAnalyze new Hashtable for Enumeration getRootClasses hasMoreElements String classname String nextElement toAnalyze put classname classname int count int maxCount isClosureRequired MAX_LOOPS while toAnalyze size count maxCount nextAnalyze clear for Enumeration toAnalyze keys hasMoreElements String classname String nextElement dependencies put classname classname try File container getClassContainer classname if container null continue containers put container container ClassParser parser null if container getName endsWith parser new ClassParser container getPath else parser new ClassParser container getPath classname replace JavaClass javaClass parser parse String interfaces javaClass getInterfaceNames for int interfaces length String interfaceName interfaces if dependencies containsKey interfaceName nextAnalyze put interfaceName interfaceName if javaClass isClass String superClass javaClass getSuperclassName if dependencies containsKey superClass nextAnalyze put superClass superClass catch IOException ioe Hashtable temp toAnalyze toAnalyze nextAnalyze nextAnalyze temp files removeAllElements for Enumeration containers keys hasMoreElements files addElement File nextElement classes removeAllElements for Enumeration dependencies keys hasMoreElements classes addElement String nextElement protected boolean supportsFileDependencies return true public class DependSet extends MatchingTask private static final ResourceSelector NOT_EXISTS new Not new Exists private static final ResourceComparator DATE_ASC new org apache tools ant types resources comparators Date private static final ResourceComparator DATE_DESC new Reverse DATE_ASC private static class NonExistent extends Restrict private NonExistent ResourceCollection rc super add rc super add NOT_EXISTS private static class Xest extends Sort private Xest ResourceCollection rc ResourceComparator super add super add rc private static class Oldest extends Xest private Oldest ResourceCollection rc super rc DATE_ASC private static class Newest extends Xest private Newest ResourceCollection rc super rc DATE_DESC private static class HideMissingBasedir implements ResourceCollection private FileSet fs private HideMissingBasedir FileSet fs this fs fs public Iterator iterator return basedirExists fs iterator Resources EMPTY_ITERATOR public int size return basedirExists fs size public boolean isFilesystemOnly return true private boolean basedirExists File basedir fs getDir return basedir null basedir exists private Union sources null private Path targets null public synchronized Union createSources sources sources null new Union sources return sources public void addSrcfileset FileSet fs createSources add fs public void addSrcfilelist FileList fl createSources add fl public synchronized Path createTargets targets targets null new Path getProject targets return targets public void addTargetfileset FileSet fs createTargets add new HideMissingBasedir fs public void addTargetfilelist FileList fl createTargets add fl public void execute throws BuildException if sources null throw new BuildException if targets null throw new BuildException if sources size targets size uptodate sources targets log Project MSG_VERBOSE Delete delete new Delete delete bindToOwner this delete add targets delete perform private boolean uptodate ResourceCollection src ResourceCollection target org apache tools ant types resources selectors Date datesel new org apache tools ant types resources selectors Date datesel setMillis System currentTimeMillis datesel setWhen TimeComparison AFTER logFuture targets datesel int neTargets new NonExistent targets size if neTargets log neTargets Project MSG_VERBOSE return false FileResource oldestTarget FileResource new Oldest targets iterator next log oldestTarget Project MSG_VERBOSE logFuture sources datesel int neSources new NonExistent sources size if neSources log neSources Project MSG_VERBOSE return false Resource newestSource Resource new Newest sources iterator next log newestSource toLongString Project MSG_VERBOSE return oldestTarget getLastModified newestSource getLastModified private void logFuture ResourceCollection rc ResourceSelector rsel Restrict new Restrict add rsel add rc for Iterator iterator hasNext log next Project MSG_WARN public class Ilasm extends DotnetBaseMatchingTask protected static final String exe_name protected static final String file_ext protected static final String exe_title protected String targetType protected boolean verbose protected boolean listing protected File resourceFile protected boolean failOnError protected boolean debug private File keyfile protected String extraOptions protected Vector referenceFilesets new Vector private boolean isMono Os isFamily public Ilasm Clear setIncludes file_pattern public void Clear targetType null srcDir null listing false verbose false debug true outputFile null failOnError true resourceFile null extraOptions null public void setTargetType String targetType throws BuildException this targetType targetType toLowerCase if targetType equals targetType equals throw new BuildException targetType public String getTargetType return targetType protected String getTargetTypeParameter if notEmpty targetType return null if targetType equals return else if targetType equals return else return null public void setOwner String log Project MSG_WARN protected boolean notEmpty String return null length public void setVerbose boolean verbose protected String getVerboseParameter return verbose null public void setListing boolean listing protected String getListingParameter if isMono return listing return null public void setOutputFile File params outputFile params protected String getOutputFileParameter if outputFile null return null return outputFile toString public void setResourceFile File fileName resourceFile fileName protected String getResourceFileParameter if resourceFile null return resourceFile toString else return null public void setFailOnError boolean failOnError public boolean getFailOnError return failOnError public void setDebug boolean debug public boolean getDebug return debug protected String getDebugParameter return debug null public void setKeyfile File keyfile this keyfile keyfile protected String getKeyfileParameter if keyfile null return keyfile toString else return null public void setExtraOptions String extraOptions this extraOptions extraOptions public String getExtraOptions return this extraOptions protected String getExtraOptionsParameter if extraOptions null extraOptions length return extraOptions else return null public void setTargetType TargetTypes targetType this targetType targetType getValue public void setMono boolean isMono public void execute throws BuildException log Project MSG_WARN NetCommand command buildIlasmCommand addFilesAndExecute command false private NetCommand buildIlasmCommand NetCommand command new NetCommand this exe_title exe_name command setFailOnError getFailOnError command addArgument getDebugParameter command addArgument getTargetTypeParameter command addArgument getListingParameter command addArgument getOutputFileParameter command addArgument getResourceFileParameter command addArgument getVerboseParameter command addArgument getKeyfileParameter command addArgument getExtraOptionsParameter return command public void addReference FileSet reference referenceFilesets add reference protected static boolean isFileManagedBinary File file String filename file toString toLowerCase return filename endsWith filename endsWith filename endsWith public static class TargetTypes extends EnumeratedAttribute public String getValues return new String public class DependSelector extends MappingSelector public DependSelector public String toString StringBuffer buf new StringBuffer if targetdir null buf append else buf append targetdir getName buf append buf append granularity if map null buf append buf append map toString else if mapperElement null buf append buf append mapperElement toString buf append return buf toString public boolean selectionTest File srcfile File destfile boolean selected SelectorUtils isOutOfDate srcfile destfile granularity return selected public class TarResource extends ArchiveResource private String userName private String groupName private int uid private int gid public TarResource public TarResource File TarEntry super true setEntry public TarResource Resource TarEntry super true setEntry public InputStream getInputStream throws IOException if isReference return Resource getCheckedRef getInputStream Resource archive getArchive final TarInputStream new TarInputStream archive getInputStream TarEntry te null while te getNextEntry null if te getName equals getName return FileUtils close throw new BuildException getName getArchive public OutputStream getOutputStream throws IOException if isReference return Resource getCheckedRef getOutputStream throw new UnsupportedOperationException public String getUserName if isReference return TarResource getCheckedRef getUserName return userName public String getGroup if isReference return TarResource getCheckedRef getGroup return groupName public int getUid if isReference return TarResource getCheckedRef getUid return uid public int getGid if isReference return TarResource getCheckedRef getGid return uid protected void fetchEntry Resource archive getArchive TarInputStream null try new TarInputStream archive getInputStream TarEntry te null while te getNextEntry null if te getName equals getName setEntry te return catch IOException log getMessage Project MSG_DEBUG throw new BuildException finally if null FileUtils close setEntry null private void setEntry TarEntry if null setExists false return setName getName setExists true setLastModified getModTime getTime setDirectory isDirectory setSize getSize setMode getMode userName getUserName groupName getGroupName uid getUserId gid getGroupId public class P4Submit extends P4Base public String change private String changeProperty private String needsResolveProperty public void setChange String change this change change public void setChangeProperty String changeProperty this changeProperty changeProperty public void setNeedsResolveProperty String needsResolveProperty this needsResolveProperty needsResolveProperty public void execute throws BuildException if change null execP4Command change P4HandlerAdapter new P4SubmitAdapter this else throw new BuildException public class P4SubmitAdapter extends SimpleP4OutputHandler public P4SubmitAdapter P4Base parent super parent public void process String line super process line getProject setProperty if util match line try Vector myarray new Vector util split myarray line boolean found false for int counter counter myarray size counter if found String chnum String myarray elementAt counter int changenumber Integer parseInt chnum log changenumber Project MSG_INFO getProject setProperty changenumber if changeProperty null getProject setNewProperty changeProperty chnum found false if myarray elementAt counter equals found true catch Exception String msg line getMessage throw new BuildException msg getLocation if util match line getProject setProperty if needsResolveProperty null getProject setNewProperty needsResolveProperty public interface Parameterizable void setParameters Parameter parameters public class Copy extends Task static final File NULL_FILE_PLACEHOLDER new File static final String LINE_SEPARATOR System getProperty protected Vector rcs new Vector private boolean enableMultipleMappings false protected boolean filtering false protected boolean preserveLastModified false protected boolean forceOverwrite false protected boolean flatten false protected int verbosity Project MSG_VERBOSE protected boolean includeEmpty true protected boolean failonerror true protected Hashtable fileCopyMap new Hashtable protected Hashtable dirCopyMap new Hashtable protected Hashtable completeDirMap new Hashtable protected Mapper mapperElement null protected FileUtils fileUtils private Vector filterChains new Vector private Vector filterSets new Vector private String inputEncoding null private String outputEncoding null private long granularity public Copy fileUtils FileUtils getFileUtils granularity fileUtils getFileTimestampGranularity protected FileUtils getFileUtils return fileUtils public void setFile File file this file file public void setTofile File destFile this destFile destFile public void setTodir File destDir this destDir destDir public FilterChain createFilterChain FilterChain filterChain new FilterChain filterChains addElement filterChain return filterChain public FilterSet createFilterSet FilterSet filterSet new FilterSet filterSets addElement filterSet return filterSet public void setPreserveLastModified String preserve setPreserveLastModified Project toBoolean preserve public void setPreserveLastModified boolean preserve preserveLastModified preserve public boolean getPreserveLastModified return preserveLastModified protected Vector getFilterSets return filterSets protected Vector getFilterChains return filterChains public void setFiltering boolean filtering this filtering filtering public void setOverwrite boolean overwrite this forceOverwrite overwrite public void setFlatten boolean flatten this flatten flatten public void setVerbose boolean verbose this verbosity verbose Project MSG_INFO Project MSG_VERBOSE public void setIncludeEmptyDirs boolean includeEmpty this includeEmpty includeEmpty public void setEnableMultipleMappings boolean enableMultipleMappings this enableMultipleMappings enableMultipleMappings public boolean isEnableMultipleMapping return enableMultipleMappings public void setFailOnError boolean failonerror this failonerror failonerror public void addFileset FileSet set add set public void add ResourceCollection res rcs add res public Mapper createMapper throws BuildException if mapperElement null throw new BuildException getLocation mapperElement new Mapper getProject return mapperElement public void add FileNameMapper fileNameMapper createMapper add fileNameMapper public void setEncoding String encoding this inputEncoding encoding if outputEncoding null outputEncoding encoding public String getEncoding return inputEncoding public void setOutputEncoding String encoding this outputEncoding encoding public String getOutputEncoding return outputEncoding public void setGranularity long granularity this granularity granularity public void execute throws BuildException File savedDestFile destFile File savedDestDir destDir ResourceCollection savedRc null if file null destFile null rcs size savedRc ResourceCollection rcs elementAt validateAttributes try if file null if file exists if destFile null destFile new File destDir file getName if forceOverwrite destFile exists file lastModified granularity destFile lastModified fileCopyMap put file getAbsolutePath new String destFile getAbsolutePath else log file destFile Project MSG_VERBOSE else String message file getAbsolutePath if failonerror log message Project MSG_ERR else throw new BuildException message HashMap filesByBasedir new HashMap HashMap dirsByBasedir new HashMap HashSet baseDirs new HashSet ArrayList nonFileResources new ArrayList for int rcs size ResourceCollection rc ResourceCollection rcs elementAt if rc instanceof FileSet rc isFilesystemOnly FileSet fs FileSet rc DirectoryScanner ds null try ds fs getDirectoryScanner getProject catch BuildException if failonerror getMessage endsWith throw else log getMessage Project MSG_ERR continue File fromDir fs getDir getProject String srcFiles ds getIncludedFiles String srcDirs ds getIncludedDirectories if flatten mapperElement null ds isEverythingIncluded fs hasPatterns completeDirMap put fromDir destDir add fromDir srcFiles filesByBasedir add fromDir srcDirs dirsByBasedir baseDirs add fromDir if rc isFilesystemOnly supportsNonFileResources throw new BuildException Iterator resources rc iterator while resources hasNext Resource Resource resources next if isExists continue File baseDir NULL_FILE_PLACEHOLDER String name getName if instanceof FileResource FileResource fr FileResource baseDir getKeyFile fr getBaseDir if fr getBaseDir null name fr getFile getAbsolutePath if isDirectory instanceof FileResource add baseDir name isDirectory dirsByBasedir filesByBasedir baseDirs add baseDir nonFileResources add Iterator iter baseDirs iterator while iter hasNext File File iter next List files List filesByBasedir get List dirs List dirsByBasedir get String srcFiles new String if files null srcFiles String files toArray srcFiles String srcDirs new String if dirs null srcDirs String dirs toArray srcDirs scan NULL_FILE_PLACEHOLDER null destDir srcFiles srcDirs try doFileOperations catch BuildException if failonerror log getMessage Project MSG_ERR else throw if nonFileResources size Resource nonFiles Resource nonFileResources toArray new Resource nonFileResources size Map map scan nonFiles destDir try doResourceOperations map catch BuildException if failonerror log getMessage Project MSG_ERR else throw finally file savedFile destFile savedDestFile destDir savedDestDir if savedRc null rcs insertElementAt savedRc fileCopyMap clear dirCopyMap clear completeDirMap clear protected void validateAttributes throws BuildException if file null rcs size throw new BuildException if destFile null destDir null throw new BuildException if destFile null destDir null throw new BuildException if file null file isDirectory throw new BuildException if destFile null rcs size if rcs size throw new BuildException else ResourceCollection rc ResourceCollection rcs elementAt if rc isFilesystemOnly throw new BuildException if rc size throw new BuildException else if rc size FileResource FileResource rc iterator next if file null file getFile rcs removeElementAt else throw new BuildException else throw new BuildException if destFile null destDir destFile getParentFile protected void scan File fromDir File toDir String files String dirs FileNameMapper mapper getMapper buildMap fromDir toDir files mapper fileCopyMap if includeEmpty buildMap fromDir toDir dirs mapper dirCopyMap protected Map scan Resource fromResources File toDir return buildMap fromResources toDir getMapper protected void buildMap File fromDir File toDir String names FileNameMapper mapper Hashtable map String toCopy null if forceOverwrite Vector new Vector for int names length if mapper mapFileName names null addElement names toCopy new String size copyInto toCopy else SourceFileScanner ds new SourceFileScanner this toCopy ds restrict names fromDir toDir mapper granularity for int toCopy length File src new File fromDir toCopy String mappedFiles mapper mapFileName toCopy if enableMultipleMappings map put src getAbsolutePath new String new File toDir mappedFiles getAbsolutePath else for int mappedFiles length mappedFiles new File toDir mappedFiles getAbsolutePath map put src getAbsolutePath mappedFiles protected Map buildMap Resource fromResources final File toDir FileNameMapper mapper HashMap map new HashMap Resource toCopy null if forceOverwrite Vector new Vector for int fromResources length if mapper mapFileName fromResources getName null addElement fromResources toCopy new Resource size copyInto toCopy else toCopy ResourceUtils selectOutOfDateSources this fromResources mapper new ResourceFactory public Resource getResource String name return new FileResource toDir name granularity for int toCopy length String mappedFiles mapper mapFileName toCopy getName if enableMultipleMappings map put toCopy new String new File toDir mappedFiles getAbsolutePath else for int mappedFiles length mappedFiles new File toDir mappedFiles getAbsolutePath map put toCopy mappedFiles return map protected void doFileOperations if fileCopyMap size log fileCopyMap size fileCopyMap size destDir getAbsolutePath Enumeration fileCopyMap keys while hasMoreElements String fromFile String nextElement String toFiles String fileCopyMap get fromFile for int toFiles length String toFile toFiles if fromFile equals toFile log fromFile verbosity continue try log fromFile toFile verbosity FilterSetCollection executionFilters new FilterSetCollection if filtering executionFilters addFilterSet getProject getGlobalFilterSet for Enumeration filterEnum filterSets elements filterEnum hasMoreElements executionFilters addFilterSet FilterSet filterEnum nextElement fileUtils copyFile fromFile toFile executionFilters filterChains forceOverwrite preserveLastModified inputEncoding outputEncoding getProject catch IOException ioe String msg fromFile toFile getDueTo ioe File targetFile new File toFile if targetFile exists targetFile delete msg toFile if failonerror throw new BuildException msg ioe getLocation log msg Project MSG_ERR if includeEmpty Enumeration dirCopyMap elements int createCount while hasMoreElements String dirs String nextElement for int dirs length File new File dirs if exists if mkdirs log getAbsolutePath Project MSG_ERR else createCount if createCount log dirCopyMap size dirCopyMap size createCount createCount destDir getAbsolutePath protected void doResourceOperations Map map if map size log map size map size destDir getAbsolutePath Iterator iter map keySet iterator while iter hasNext Resource fromResource Resource iter next String toFiles String map get fromResource for int toFiles length String toFile toFiles try log fromResource toFile verbosity FilterSetCollection executionFilters new FilterSetCollection if filtering executionFilters addFilterSet getProject getGlobalFilterSet for Enumeration filterEnum filterSets elements filterEnum hasMoreElements executionFilters addFilterSet FilterSet filterEnum nextElement ResourceUtils copyResource fromResource new FileResource destDir toFile executionFilters filterChains forceOverwrite preserveLastModified inputEncoding outputEncoding getProject catch IOException ioe String msg fromResource toFile getDueTo ioe File targetFile new File toFile if targetFile exists targetFile delete msg toFile if failonerror throw new BuildException msg ioe getLocation log msg Project MSG_ERR protected boolean supportsNonFileResources return getClass equals Copy class private static void add File baseDir String names Map if names null baseDir getKeyFile baseDir List List get baseDir if null new ArrayList names length put baseDir addAll java util Arrays asList names private static void add File baseDir String name Map if name null add baseDir new String name private static File getKeyFile File return null NULL_FILE_PLACEHOLDER private FileNameMapper getMapper FileNameMapper mapper null if mapperElement null mapper mapperElement getImplementation else if flatten mapper new FlatFileNameMapper else mapper new IdentityMapper return mapper private String getMessage Exception ex return ex getMessage null ex toString ex getMessage private String getDueTo Exception ex boolean baseIOException ex getClass IOException class StringBuffer message new StringBuffer if baseIOException ex getMessage null message append ex getClass getName if ex getMessage null if baseIOException message append message append ex getMessage if ex getClass getName indexOf message append LINE_SEPARATOR message append message append LINE_SEPARATOR message append message append inputEncoding null fileUtils getDefaultEncoding inputEncoding message append LINE_SEPARATOR return message toString public class WeakishReference private WeakReference weakref WeakishReference Object reference this weakref new WeakReference reference public Object get return weakref get public static WeakishReference createReference Object object return new WeakishReference object public static class HardReference extends WeakishReference public HardReference Object object super object public class CVSPass extends Task private String cvsRoot null private File passFile null private String password null private final char shifts public CVSPass passFile new File System getProperty System getProperty File separatorChar public final void execute throws BuildException if cvsRoot null throw new BuildException if password null throw new BuildException log cvsRoot Project MSG_DEBUG log password Project MSG_DEBUG log passFile Project MSG_DEBUG BufferedReader reader null PrintWriter writer null try StringBuffer buf new StringBuffer if passFile exists reader new BufferedReader new FileReader passFile String line null while line reader readLine null if line startsWith cvsRoot buf append line append StringUtils LINE_SEP String pwdfile buf toString cvsRoot mangle password log pwdfile Project MSG_DEBUG writer new PrintWriter new FileWriter passFile writer println pwdfile catch IOException throw new BuildException finally if reader null try reader close catch IOException if writer null writer close private final String mangle String password StringBuffer buf new StringBuffer for int password length buf append shifts password charAt return buf toString public void setCvsroot String cvsRoot this cvsRoot cvsRoot public void setPassfile File passFile this passFile passFile public void setPassword String password this password password public class LogLevel extends EnumeratedAttribute public static final LogLevel ERR new LogLevel public static final LogLevel WARN new LogLevel public static final LogLevel INFO new LogLevel public static final LogLevel VERBOSE new LogLevel public static final LogLevel DEBUG new LogLevel public LogLevel private LogLevel String value this setValue value public String getValues return new String private static int levels Project MSG_ERR Project MSG_WARN Project MSG_WARN Project MSG_INFO Project MSG_VERBOSE Project MSG_DEBUG public int getLevel return levels getIndex public class WsdlToDotnet extends Task private static final FileUtils FILE_UTILS FileUtils getFileUtils private File destFile null private String language private boolean server false private String namespace null private boolean failOnError true protected String extraOptions null private String protocol null private boolean ideErrors false private Vector schemas new Vector private Schema wsdl new Schema private Compiler compiler null public static final String ERROR_DEST_FILE_IS_DIR public static final String ERROR_NO_DEST_FILE public void setDestFile File destFile this destFile destFile public void setUrl String url wsdl setUrl url public void setSrcFile File srcFile wsdl setFile srcFile public void setLanguage String language this language language public void setServer boolean server this server server public void setNamespace String namespace this namespace namespace public void setFailOnError boolean failOnError this failOnError failOnError public void setExtraOptions String extraOptions this extraOptions extraOptions public void setIdeErrors boolean ideErrors this ideErrors ideErrors public void setProtocol String protocol this protocol protocol public void addSchema Schema source schemas add source public void setMakeURL boolean wsdl setMakeURL public void setCompiler Compiler compiler this compiler compiler protected void validate throws BuildException if destFile null throw new BuildException ERROR_NO_DEST_FILE if destFile isDirectory throw new BuildException ERROR_DEST_FILE_IS_DIR wsdl validate public void execute throws BuildException log Project MSG_WARN if compiler null compiler Compiler createDefaultCompiler validate NetCommand command new NetCommand this compiler getCommand command setFailOnError failOnError compiler applyExtraArgs command command addArgument command addArgument destFile command addArgument language if server command addArgument command addArgument namespace if protocol null command addArgument protocol if ideErrors command addArgument command addArgument extraOptions boolean rebuild true long destLastModified if destFile exists destLastModified destFile lastModified rebuild isRebuildNeeded wsdl destLastModified String path path wsdl evaluate if compiler supportsAbsoluteFiles wsdl getFile null File wsdl getFile command setDirectory getParentFile path getName command addArgument path Iterator it schemas iterator while it hasNext Schema schema Schema it next rebuild isRebuildNeeded schema destLastModified command addArgument schema evaluate if rebuild command runCommand private boolean isRebuildNeeded Schema schema long destLastModified if destLastModified return true return FILE_UTILS isUpToDate schema getTimestamp destLastModified public static class Schema private File file private String url private boolean makeURL false public static final String ERROR_NONE_DECLARED public static final String ERROR_BOTH_DECLARED public static final String ERROR_FILE_NOT_FOUND public static final String ERROR_FILE_IS_DIR public static final String ERROR_NO_URL_CONVERT public void validate if file null if file exists throw new BuildException ERROR_FILE_NOT_FOUND file toString if file isDirectory throw new BuildException ERROR_FILE_IS_DIR file toString if file null url null throw new BuildException ERROR_BOTH_DECLARED if file null url null throw new BuildException ERROR_NONE_DECLARED public String evaluate validate if url null return getUrl if makeURL try return file toURL toExternalForm catch MalformedURLException throw new BuildException ERROR_NO_URL_CONVERT file return file toString public File getFile return file public void setFile File file this file file public String getUrl return url public void setUrl String url this url url public boolean isMakeURL return makeURL public void setMakeURL boolean makeURL this makeURL makeURL public long getTimestamp if file null return file lastModified else return public static class Compiler extends EnumeratedAttribute public static final String COMPILER_MS public static final String COMPILER_MONO public static final String COMPILER_MS_ON_MONO String compilers COMPILER_MS COMPILER_MONO COMPILER_MS_ON_MONO public static final String EXE_WSDL public static final String EXE_MONO String compilerExecutables EXE_WSDL EXE_WSDL EXE_MONO String extraCompilerArgs EXE_WSDL boolean absoluteFiles true false true public String getValues return compilers public static Compiler createDefaultCompiler Compiler new Compiler String compilerName compilerName Os isFamily COMPILER_MS COMPILER_MONO setValue compilerName return public String getCommand return compilerExecutables getIndex public String getExtraArgs return extraCompilerArgs getIndex public boolean supportsAbsoluteFiles return absoluteFiles getIndex public void applyExtraArgs NetCommand command String args getExtraArgs for int args length command addArgument args public class Size extends ResourceComparator protected int resourceCompare Resource foo Resource bar return int foo getSize bar getSize public class PropertySet extends DataType implements ResourceCollection private boolean dynamic true private boolean negate false private Set cachedNames private Vector ptyRefs new Vector private Vector setRefs new Vector private Mapper mapper public static class PropertyRef private int count private String name private String regex private String prefix private String builtin public void setName String name assertValid name this name name public void setRegex String regex assertValid regex this regex regex public void setPrefix String prefix assertValid prefix this prefix prefix public void setBuiltin BuiltinPropertySetName String pBuiltIn getValue assertValid pBuiltIn this builtin pBuiltIn private void assertValid String attr String value if value null value length throw new BuildException attr if count throw new BuildException public String toString return name regex prefix builtin public void appendName String name PropertyRef new PropertyRef setName name addPropertyref public void appendRegex String regex PropertyRef new PropertyRef setRegex regex addPropertyref public void appendPrefix String prefix PropertyRef new PropertyRef setPrefix prefix addPropertyref public void appendBuiltin BuiltinPropertySetName PropertyRef new PropertyRef setBuiltin addPropertyref public void setMapper String type String from String to Mapper createMapper Mapper MapperType mapperType new Mapper MapperType mapperType setValue type setType mapperType setFrom from setTo to public void addPropertyref PropertyRef ref assertNotReference ptyRefs addElement ref public void addPropertyset PropertySet ref assertNotReference setRefs addElement ref public Mapper createMapper assertNotReference if mapper null throw new BuildException mapper new Mapper getProject return mapper public void add FileNameMapper fileNameMapper createMapper add fileNameMapper public void setDynamic boolean dynamic assertNotReference this dynamic dynamic public void setNegate boolean negate assertNotReference this negate negate public boolean getDynamic return isReference getRef dynamic dynamic public Mapper getMapper return isReference getRef mapper mapper private Hashtable getAllSystemProperties Hashtable ret new Hashtable for Enumeration System getProperties propertyNames hasMoreElements String name String nextElement ret put name System getProperties getProperty name return ret public Properties getProperties if isReference return getRef getProperties Set names null Project prj getProject Hashtable props prj null getAllSystemProperties prj getProperties for Enumeration setRefs elements hasMoreElements PropertySet set PropertySet nextElement props putAll set getProperties if getDynamic cachedNames null names new HashSet addPropertyNames names props for Enumeration setRefs elements hasMoreElements PropertySet set PropertySet nextElement names addAll set getProperties keySet if negate HashSet complement new HashSet props keySet complement removeAll names names complement if getDynamic cachedNames names else names cachedNames FileNameMapper null Mapper myMapper getMapper if myMapper null myMapper getImplementation Properties properties new Properties for Iterator iter names iterator iter hasNext String name String iter next String value String props get name if value null if null String newname mapFileName name if newname null name newname properties setProperty name value return properties private void addPropertyNames Set names Hashtable properties for Enumeration ptyRefs elements hasMoreElements PropertyRef PropertyRef nextElement if name null if properties get name null names add name else if prefix null for Enumeration properties keys hasMoreElements String name String nextElement if name startsWith prefix names add name else if regex null RegexpMatcherFactory matchMaker new RegexpMatcherFactory RegexpMatcher matcher matchMaker newRegexpMatcher matcher setPattern regex for Enumeration properties keys hasMoreElements String name String nextElement if matcher matches name names add name else if builtin null if builtin equals BuiltinPropertySetName ALL names addAll properties keySet else if builtin equals BuiltinPropertySetName SYSTEM names addAll System getProperties keySet else if builtin equals BuiltinPropertySetName COMMANDLINE names addAll getProject getUserProperties keySet else throw new BuildException else throw new BuildException protected PropertySet getRef return PropertySet getCheckedRef PropertySet class public final void setRefid Reference if noAttributeSet throw tooManyAttributes super setRefid protected final void assertNotReference if isReference throw tooManyAttributes noAttributeSet false private boolean noAttributeSet true public static class BuiltinPropertySetName extends EnumeratedAttribute static final String ALL static final String SYSTEM static final String COMMANDLINE public String getValues return new String ALL SYSTEM COMMANDLINE public String toString StringBuffer new StringBuffer TreeMap sorted new TreeMap getProperties for Iterator sorted entrySet iterator hasNext Map Entry Map Entry next if length append append getKey toString append append getValue toString return toString public Iterator iterator final Enumeration getProperties propertyNames return new Iterator public boolean hasNext return hasMoreElements public Object next return new PropertyResource getProject String nextElement public void remove throw new UnsupportedOperationException public int size return isReference getRef size getProperties size public boolean isFilesystemOnly return isReference getRef isFilesystemOnly public class ServerDeploy extends Task private String action private File source private Vector vendorTools new Vector public void addGeneric GenericHotDeploymentTool tool tool setTask this vendorTools addElement tool public void addWeblogic WebLogicHotDeploymentTool tool tool setTask this vendorTools addElement tool public void addJonas JonasHotDeploymentTool tool tool setTask this vendorTools addElement tool public void execute throws BuildException for Enumeration vendorTools elements hasMoreElements HotDeploymentTool tool HotDeploymentTool nextElement tool validateAttributes tool deploy public String getAction return action public void setAction String action this action action public File getSource return source public void setSource File source this source source public class CollectionUtils public static boolean equals Vector v1 Vector v2 if v1 v2 return true if v1 null v2 null return false return v1 equals v2 public static boolean equals Dictionary d1 Dictionary d2 if d1 d2 return true if d1 null d2 null return false if d1 size d2 size return false Enumeration e1 d1 keys while e1 hasMoreElements Object key e1 nextElement Object value1 d1 get key Object value2 d2 get key if value2 null value1 equals value2 return false return true public static void putAll Dictionary m1 Dictionary m2 for Enumeration it m2 keys it hasMoreElements Object key it nextElement m1 put key m2 get key public static final class EmptyEnumeration implements Enumeration public EmptyEnumeration public boolean hasMoreElements return false public Object nextElement throws NoSuchElementException throw new NoSuchElementException public static Enumeration append Enumeration e1 Enumeration e2 return new CompoundEnumeration e1 e2 public static Enumeration asEnumeration final Iterator iter return new Enumeration public boolean hasMoreElements return iter hasNext public Object nextElement return iter next public static Iterator asIterator final Enumeration return new Iterator public boolean hasNext return hasMoreElements public Object next return nextElement public void remove throw new UnsupportedOperationException private static final class CompoundEnumeration implements Enumeration private final Enumeration e1 e2 public CompoundEnumeration Enumeration e1 Enumeration e2 this e1 e1 this e2 e2 public boolean hasMoreElements return e1 hasMoreElements e2 hasMoreElements public Object nextElement throws NoSuchElementException if e1 hasMoreElements return e1 nextElement else return e2 nextElement public class Project implements ResourceFactory private static final String LINE_SEP System getProperty public static final int MSG_ERR public static final int MSG_WARN public static final int MSG_INFO public static final int MSG_VERBOSE public static final int MSG_DEBUG private static final String VISITING private static final String VISITED public static final String JAVA_1_0 JavaEnvUtils JAVA_1_0 public static final String JAVA_1_1 JavaEnvUtils JAVA_1_1 public static final String JAVA_1_2 JavaEnvUtils JAVA_1_2 public static final String JAVA_1_3 JavaEnvUtils JAVA_1_3 public static final String JAVA_1_4 JavaEnvUtils JAVA_1_4 public static final String TOKEN_START FilterSet DEFAULT_TOKEN_START public static final String TOKEN_END FilterSet DEFAULT_TOKEN_END private static final FileUtils FILE_UTILS FileUtils getFileUtils private String name private String description private Hashtable references new AntRefTable private HashMap idReferences new HashMap private Project parentIdProject null private String defaultTarget private Hashtable targets new Hashtable private FilterSet globalFilterSet new FilterSet globalFilterSet setProject this private FilterSetCollection globalFilters new FilterSetCollection globalFilterSet private File baseDir private Vector listeners new Vector private ClassLoader coreLoader null Collections synchronizedMap new WeakHashMap private InputHandler inputHandler null private InputStream defaultInputStream null private boolean keepGoingMode false private boolean loggingMessage false public void setInputHandler InputHandler handler inputHandler handler public void setDefaultInputStream InputStream defaultInputStream this defaultInputStream defaultInputStream public InputStream getDefaultInputStream return defaultInputStream public InputHandler getInputHandler return inputHandler public Project inputHandler new DefaultInputHandler public Project createSubProject Project subProject null try subProject Project getClass newInstance catch Exception subProject new Project initSubProject subProject return subProject public void initSubProject Project subProject ComponentHelper getComponentHelper subProject initSubProject ComponentHelper getComponentHelper this subProject setDefaultInputStream getDefaultInputStream subProject setKeepGoingMode this isKeepGoingMode subProject setExecutor getExecutor getSubProjectExecutor public void init throws BuildException initProperties ComponentHelper getComponentHelper this initDefaultDefinitions public void initProperties throws BuildException setJavaVersionProperty setSystemProperties setPropertyInternal MagicNames ANT_VERSION Main getAntVersion setAntLib private void setAntLib File antlib org apache tools ant launch Locator getClassSource Project class if antlib null setPropertyInternal MagicNames ANT_LIB antlib getAbsolutePath public AntClassLoader createClassLoader Path path return new AntClassLoader getClass getClassLoader this path public AntClassLoader createClassLoader ClassLoader parent Path path return new AntClassLoader parent this path public void setCoreLoader ClassLoader coreLoader this coreLoader coreLoader public ClassLoader getCoreLoader return coreLoader public synchronized void addBuildListener BuildListener listener if listeners contains listener return Vector newListeners getBuildListeners newListeners addElement listener listeners newListeners public synchronized void removeBuildListener BuildListener listener Vector newListeners getBuildListeners newListeners removeElement listener listeners newListeners public Vector getBuildListeners return Vector listeners clone public void log String message log message MSG_INFO public void log String message int msgLevel log message null msgLevel public void log String message Throwable throwable int msgLevel fireMessageLogged this message throwable msgLevel public void log Task task String message int msgLevel fireMessageLogged task message null msgLevel public void log Task task String message Throwable throwable int msgLevel fireMessageLogged task message throwable msgLevel public void log Target target String message int msgLevel log target message null msgLevel public void log Target target String message Throwable throwable int msgLevel fireMessageLogged target message throwable msgLevel public FilterSet getGlobalFilterSet return globalFilterSet public void setProperty String name String value PropertyHelper getPropertyHelper this setProperty null name value true public void setNewProperty String name String value PropertyHelper getPropertyHelper this setNewProperty null name value public void setUserProperty String name String value PropertyHelper getPropertyHelper this setUserProperty null name value public void setInheritedProperty String name String value PropertyHelper ph PropertyHelper getPropertyHelper this ph setInheritedProperty null name value private void setPropertyInternal String name String value PropertyHelper ph PropertyHelper getPropertyHelper this ph setProperty null name value false public String getProperty String propertyName PropertyHelper ph PropertyHelper getPropertyHelper this return String ph getProperty null propertyName public String replaceProperties String value throws BuildException PropertyHelper ph PropertyHelper getPropertyHelper this return ph replaceProperties null value null public String getUserProperty String propertyName PropertyHelper ph PropertyHelper getPropertyHelper this return String ph getUserProperty null propertyName public Hashtable getProperties PropertyHelper ph PropertyHelper getPropertyHelper this return ph getProperties public Hashtable getUserProperties PropertyHelper ph PropertyHelper getPropertyHelper this return ph getUserProperties public void copyUserProperties Project other PropertyHelper ph PropertyHelper getPropertyHelper this ph copyUserProperties other public void copyInheritedProperties Project other PropertyHelper ph PropertyHelper getPropertyHelper this ph copyInheritedProperties other public void setDefaultTarget String defaultTarget this defaultTarget defaultTarget public String getDefaultTarget return defaultTarget public void setDefault String defaultTarget this defaultTarget defaultTarget public void setName String name setUserProperty name this name name public String getName return name public void setDescription String description this description description public String getDescription if description null description Description getDescription this return description public void addFilter String token String value if token null return globalFilterSet addFilter new FilterSet Filter token value public Hashtable getFilters return globalFilterSet getFilterHash public void setBasedir String baseD throws BuildException setBaseDir new File baseD public void setBaseDir File baseDir throws BuildException baseDir FILE_UTILS normalize baseDir getAbsolutePath if baseDir exists throw new BuildException baseDir getAbsolutePath if baseDir isDirectory throw new BuildException baseDir getAbsolutePath this baseDir baseDir setPropertyInternal MagicNames PROJECT_BASEDIR this baseDir getPath String msg this baseDir log msg MSG_VERBOSE public File getBaseDir if baseDir null try setBasedir catch BuildException ex ex printStackTrace return baseDir public void setKeepGoingMode boolean keepGoingMode this keepGoingMode keepGoingMode public boolean isKeepGoingMode return this keepGoingMode public static String getJavaVersion return JavaEnvUtils getJavaVersion public void setJavaVersionProperty throws BuildException String javaVersion JavaEnvUtils getJavaVersion setPropertyInternal MagicNames ANT_JAVA_VERSION javaVersion if JavaEnvUtils isJavaVersion JavaEnvUtils JAVA_1_0 JavaEnvUtils isJavaVersion JavaEnvUtils JAVA_1_1 throw new BuildException log javaVersion System getProperty MSG_VERBOSE log System getProperty MSG_VERBOSE public void setSystemProperties Properties systemP System getProperties Enumeration systemP propertyNames while hasMoreElements String propertyName String nextElement String value systemP getProperty propertyName this setPropertyInternal propertyName value public void addTaskDefinition String taskName Class taskClass throws BuildException ComponentHelper getComponentHelper this addTaskDefinition taskName taskClass public void checkTaskClass final Class taskClass throws BuildException ComponentHelper getComponentHelper this checkTaskClass taskClass if Modifier isPublic taskClass getModifiers final String message taskClass log message Project MSG_ERR throw new BuildException message if Modifier isAbstract taskClass getModifiers final String message taskClass log message Project MSG_ERR throw new BuildException message try taskClass getConstructor Class null catch NoSuchMethodException final String message taskClass log message Project MSG_ERR throw new BuildException message catch LinkageError String message taskClass log message Project MSG_ERR throw new BuildException message if Task class isAssignableFrom taskClass TaskAdapter checkTaskClass taskClass this public Hashtable getTaskDefinitions return ComponentHelper getComponentHelper this getTaskDefinitions public void addDataTypeDefinition String typeName Class typeClass ComponentHelper getComponentHelper this addDataTypeDefinition typeName typeClass public Hashtable getDataTypeDefinitions return ComponentHelper getComponentHelper this getDataTypeDefinitions public void addTarget Target target throws BuildException addTarget target getName target public void addTarget String targetName Target target throws BuildException if targets get targetName null throw new BuildException targetName addOrReplaceTarget targetName target public void addOrReplaceTarget Target target addOrReplaceTarget target getName target public void addOrReplaceTarget String targetName Target target String msg targetName log msg MSG_DEBUG target setProject this targets put targetName target public Hashtable getTargets return targets public Task createTask String taskType throws BuildException return ComponentHelper getComponentHelper this createTask taskType public Object createDataType String typeName throws BuildException return ComponentHelper getComponentHelper this createDataType typeName public void setExecutor Executor addReference MagicNames ANT_EXECUTOR_REFERENCE public Executor getExecutor Object getReference MagicNames ANT_EXECUTOR_REFERENCE if null String classname getProperty MagicNames ANT_EXECUTOR_CLASSNAME if classname null classname DefaultExecutor class getName log classname MSG_DEBUG try Class forName classname true coreLoader newInstance catch ClassNotFoundException seaEnEfEx try Class forName classname newInstance catch Exception ex log ex toString MSG_ERR catch Exception ex log ex toString MSG_ERR if null throw new BuildException setExecutor Executor return Executor public void executeTargets Vector names throws BuildException getExecutor executeTargets this String names toArray new String names size public void demuxOutput String output boolean isWarning Task task getThreadTask Thread currentThread if task null log output isWarning MSG_WARN MSG_INFO else if isWarning task handleErrorOutput output else task handleOutput output public int defaultInput byte buffer int offset int length throws IOException if defaultInputStream null System out flush return defaultInputStream read buffer offset length else throw new EOFException public int demuxInput byte buffer int offset int length throws IOException Task task getThreadTask Thread currentThread if task null return defaultInput buffer offset length else return task handleInput buffer offset length public void demuxFlush String output boolean isError Task task getThreadTask Thread currentThread if task null fireMessageLogged this output isError MSG_ERR MSG_INFO else if isError task handleErrorFlush output else task handleFlush output public void executeTarget String targetName throws BuildException if targetName null String msg throw new BuildException msg executeSortedTargets topoSort targetName targets false public void executeSortedTargets Vector sortedTargets throws BuildException Set succeededTargets new HashSet for Enumeration iter sortedTargets elements iter hasMoreElements Target curtarget Target iter nextElement boolean canExecute true for Enumeration depIter curtarget getDependencies depIter hasMoreElements String dependencyName String depIter nextElement if succeededTargets contains dependencyName canExecute false log curtarget curtarget getName dependencyName MSG_ERR break if canExecute Throwable thrownException null try curtarget performTasks succeededTargets add curtarget getName catch RuntimeException ex if keepGoingMode thrownException ex catch Throwable ex if keepGoingMode throw new BuildException ex thrownException ex if thrownException null if thrownException instanceof BuildException log curtarget curtarget getName thrownException getMessage MSG_ERR if buildException null buildException BuildException thrownException else log curtarget curtarget getName thrownException getMessage MSG_ERR thrownException printStackTrace System err if buildException null buildException new BuildException thrownException if buildException null throw buildException public File resolveFile String fileName File rootDir return FILE_UTILS resolveFile rootDir fileName public File resolveFile String fileName return FILE_UTILS resolveFile baseDir fileName public static String translatePath String toProcess return FileUtils translatePath toProcess public void copyFile String sourceFile String destFile throws IOException FILE_UTILS copyFile sourceFile destFile public void copyFile String sourceFile String destFile boolean filtering throws IOException FILE_UTILS copyFile sourceFile destFile filtering globalFilters null public void copyFile String sourceFile String destFile boolean filtering boolean overwrite throws IOException FILE_UTILS copyFile sourceFile destFile filtering globalFilters null overwrite public void copyFile String sourceFile String destFile boolean filtering boolean overwrite boolean preserveLastModified throws IOException FILE_UTILS copyFile sourceFile destFile filtering globalFilters null overwrite preserveLastModified public void copyFile File sourceFile File destFile throws IOException FILE_UTILS copyFile sourceFile destFile public void copyFile File sourceFile File destFile boolean filtering throws IOException FILE_UTILS copyFile sourceFile destFile filtering globalFilters null public void copyFile File sourceFile File destFile boolean filtering boolean overwrite throws IOException FILE_UTILS copyFile sourceFile destFile filtering globalFilters null overwrite public void copyFile File sourceFile File destFile boolean filtering boolean overwrite boolean preserveLastModified throws IOException FILE_UTILS copyFile sourceFile destFile filtering globalFilters null overwrite preserveLastModified public void setFileLastModified File file long time throws BuildException FILE_UTILS setFileLastModified file time log file MSG_VERBOSE public static boolean toBoolean String return equalsIgnoreCase equalsIgnoreCase equalsIgnoreCase public final Vector topoSort String root Hashtable targetTable throws BuildException return topoSort new String root targetTable true public final Vector topoSort String root Hashtable targetTable boolean returnAll throws BuildException return topoSort new String root targetTable returnAll public final Vector topoSort String root Hashtable targetTable boolean returnAll throws BuildException Vector ret new Vector Hashtable state new Hashtable Stack visiting new Stack for int root length String st String state get root if st null tsort root targetTable state visiting ret else if st VISITING throw new RuntimeException root StringBuffer buf new StringBuffer for int root length buf append append root append buf append ret log buf toString MSG_VERBOSE Vector complete returnAll ret new Vector ret for Enumeration en targetTable keys en hasMoreElements String curTarget String en nextElement String st String state get curTarget if st null tsort curTarget targetTable state visiting complete else if st VISITING throw new RuntimeException curTarget log complete MSG_VERBOSE return ret private void tsort String root Hashtable targetTable Hashtable state Stack visiting Vector ret throws BuildException state put root VISITING visiting push root Target target Target targetTable get root if target null StringBuffer sb new StringBuffer sb append root sb append sb append name sb append visiting pop if visiting empty String parent String visiting peek sb append sb append parent sb append throw new BuildException new String sb for Enumeration en target getDependencies en hasMoreElements String cur String en nextElement String String state get cur if null tsort cur targetTable state visiting ret else if VISITING throw makeCircularException cur visiting String String visiting pop if root throw new RuntimeException root state put root VISITED ret addElement target private static BuildException makeCircularException String end Stack stk StringBuffer sb new StringBuffer sb append end String do String stk pop sb append sb append while equals end return new BuildException new String sb public void inheritIDReferences Project parent parentIdProject parent private Object resolveIdReference String key Project callerProject UnknownElement origUE UnknownElement idReferences get key if origUE null return parentIdProject null null parentIdProject resolveIdReference key callerProject callerProject log key LINE_SEP LINE_SEP MSG_WARN UnknownElement copyUE origUE copy callerProject copyUE maybeConfigure return copyUE getRealThing public void addIdReference String id Object value idReferences put id value public void addReference String referenceName Object value synchronized references Object old AntRefTable references getReal referenceName if old value return if old null old instanceof UnknownElement log referenceName MSG_VERBOSE log referenceName MSG_DEBUG references put referenceName value public Hashtable getReferences return references public Object getReference String key Object ret references get key if ret null return ret ret resolveIdReference key this if ret null key equals MagicNames REFID_PROPERTY_HELPER Vector new Vector PropertyHelper getPropertyHelper this parsePropertyString key new Vector if size log key MSG_WARN return ret public String getElementName Object element return ComponentHelper getComponentHelper this getElementName element public void fireBuildStarted BuildEvent event new BuildEvent this Iterator iter listeners iterator while iter hasNext BuildListener listener BuildListener iter next listener buildStarted event public void fireBuildFinished Throwable exception BuildEvent event new BuildEvent this event setException exception Iterator iter listeners iterator while iter hasNext BuildListener listener BuildListener iter next listener buildFinished event IntrospectionHelper clearCache public void fireSubBuildStarted BuildEvent event new BuildEvent this Iterator iter listeners iterator while iter hasNext Object listener iter next if listener instanceof SubBuildListener SubBuildListener listener subBuildStarted event public void fireSubBuildFinished Throwable exception BuildEvent event new BuildEvent this event setException exception Iterator iter listeners iterator while iter hasNext Object listener iter next if listener instanceof SubBuildListener SubBuildListener listener subBuildFinished event protected void fireTargetStarted Target target BuildEvent event new BuildEvent target Iterator iter listeners iterator while iter hasNext BuildListener listener BuildListener iter next listener targetStarted event protected void fireTargetFinished Target target Throwable exception BuildEvent event new BuildEvent target event setException exception Iterator iter listeners iterator while iter hasNext BuildListener listener BuildListener iter next listener targetFinished event protected void fireTaskStarted Task task registerThreadTask Thread currentThread task BuildEvent event new BuildEvent task Iterator iter listeners iterator while iter hasNext BuildListener listener BuildListener iter next listener taskStarted event protected void fireTaskFinished Task task Throwable exception registerThreadTask Thread currentThread null System out flush System err flush BuildEvent event new BuildEvent task event setException exception Iterator iter listeners iterator while iter hasNext BuildListener listener BuildListener iter next listener taskFinished event private void fireMessageLoggedEvent BuildEvent event String message int priority if message endsWith StringUtils LINE_SEP int endIndex message length StringUtils LINE_SEP length event setMessage message substring endIndex priority else event setMessage message priority synchronized this if loggingMessage return try loggingMessage true Iterator iter listeners iterator while iter hasNext BuildListener listener BuildListener iter next listener messageLogged event finally loggingMessage false protected void fireMessageLogged Project project String message int priority fireMessageLogged project message null priority protected void fireMessageLogged Project project String message Throwable throwable int priority BuildEvent event new BuildEvent project event setException throwable fireMessageLoggedEvent event message priority protected void fireMessageLogged Target target String message int priority fireMessageLogged target message null priority protected void fireMessageLogged Target target String message Throwable throwable int priority BuildEvent event new BuildEvent target event setException throwable fireMessageLoggedEvent event message priority protected void fireMessageLogged Task task String message int priority fireMessageLogged task message null priority protected void fireMessageLogged Task task String message Throwable throwable int priority BuildEvent event new BuildEvent task event setException throwable fireMessageLoggedEvent event message priority public synchronized void registerThreadTask Thread thread Task task if task null threadTasks put thread task threadGroupTasks put thread getThreadGroup task else threadTasks remove thread threadGroupTasks remove thread getThreadGroup public Task getThreadTask Thread thread Task task Task threadTasks get thread if task null ThreadGroup group thread getThreadGroup while task null group null task Task threadGroupTasks get group group group getParent return task private static class AntRefTable extends Hashtable AntRefTable super private Object getReal Object key return super get key public Object get Object key Object getReal key if instanceof UnknownElement UnknownElement ue UnknownElement ue maybeConfigure ue getRealThing return public final void setProjectReference final Object obj if obj instanceof ProjectComponent ProjectComponent obj setProject this return try Method method obj getClass getMethod new Class Project class if method null method invoke obj new Object this catch Throwable public Resource getResource String name return new FileResource getBaseDir name public class JspNameMangler implements JspMangler public static final String keywords public String mapJspToJavaName File jspFile return mapJspToBaseName jspFile private String mapJspToBaseName File jspFile String className className stripExtension jspFile for int keywords length if className equals keywords className break StringBuffer modifiedClassName new StringBuffer className length char firstChar className charAt if Character isJavaIdentifierStart firstChar modifiedClassName append firstChar else modifiedClassName append mangleChar firstChar for int className length char subChar className charAt if Character isJavaIdentifierPart subChar modifiedClassName append subChar else modifiedClassName append mangleChar subChar return modifiedClassName toString private String stripExtension File jspFile String className String filename jspFile getName if filename endsWith className filename substring filename length else className filename return className private static String mangleChar char ch if ch File separatorChar ch String Integer toHexString ch int nzeros length char result new char result for int nzeros result int resultIndex for int nzeros result charAt resultIndex return new String result public String mapPath String path return null public class Replace extends MatchingTask private static final FileUtils FILE_UTILS FileUtils getFileUtils private File src null private NestedString token null private NestedString value new NestedString private File propertyFile null private File replaceFilterFile null private Properties properties null private Vector replacefilters new Vector private File dir null private int fileCount private int replaceCount private boolean summary false private String encoding null public class NestedString private StringBuffer buf new StringBuffer public void addText String val buf append val public String getText return buf toString public class Replacefilter private String token private String value private String replaceValue private String property private StringBuffer inputBuffer private StringBuffer outputBuffer new StringBuffer public void validate throws BuildException if token null String message throw new BuildException message if equals token String message throw new BuildException message if value null property null String message throw new BuildException message if property null if propertyFile null String message throw new BuildException message if properties null properties getProperty property null String message property propertyFile getPath throw new BuildException message replaceValue getReplaceValue public String getReplaceValue if property null return properties getProperty property else if value null return value else if Replace this value null return Replace this value getText else return public void setToken String token this token token public String getToken return token public void setValue String value this value value public String getValue return value public void setProperty String property this property property public String getProperty return property StringBuffer getOutputBuffer return outputBuffer void setInputBuffer StringBuffer input inputBuffer input boolean process if inputBuffer length token length int pos replace pos Math max inputBuffer length token length pos outputBuffer append inputBuffer substring pos inputBuffer delete pos return true return false void flush replace outputBuffer append inputBuffer toString inputBuffer delete inputBuffer length private int replace int found inputBuffer toString indexOf token int pos while found inputBuffer replace found found token length replaceValue pos found replaceValue length found inputBuffer toString indexOf token pos replaceCount return pos private class FileInput private StringBuffer outputBuffer private Reader reader private char buffer private static final int BUFF_SIZE FileInput File source throws IOException outputBuffer new StringBuffer buffer new char BUFF_SIZE if encoding null reader new BufferedReader new FileReader source else reader new BufferedReader new InputStreamReader new FileInputStream source encoding StringBuffer getOutputBuffer return outputBuffer boolean readChunk throws IOException int bufferLength bufferLength reader read buffer if bufferLength return false outputBuffer append new String buffer bufferLength return true void close throws IOException reader close void closeQuietly FileUtils close reader private class FileOutput private StringBuffer inputBuffer private Writer writer FileOutput File out throws IOException if encoding null writer new BufferedWriter new FileWriter out else writer new BufferedWriter new OutputStreamWriter new FileOutputStream out encoding void setInputBuffer StringBuffer input inputBuffer input boolean process throws IOException writer write inputBuffer toString inputBuffer delete inputBuffer length return false void flush throws IOException process writer flush void close throws IOException writer close void closeQuietly FileUtils close writer public void execute throws BuildException Vector savedFilters Vector replacefilters clone Properties savedProperties properties null null Properties properties clone if token null StringBuffer val new StringBuffer value getText stringReplace val stringReplace val StringUtils LINE_SEP StringBuffer tok new StringBuffer token getText stringReplace tok stringReplace tok StringUtils LINE_SEP Replacefilter firstFilter createPrimaryfilter firstFilter setToken tok toString firstFilter setValue val toString try if replaceFilterFile null Properties props getProperties replaceFilterFile Enumeration props keys while hasMoreElements String tok nextElement toString Replacefilter replaceFilter createReplacefilter replaceFilter setToken tok replaceFilter setValue props getProperty tok validateAttributes if propertyFile null properties getProperties propertyFile validateReplacefilters fileCount replaceCount if src null processFile src if dir null DirectoryScanner ds super getDirectoryScanner dir String srcs ds getIncludedFiles for int srcs length File file new File dir srcs processFile file if summary log replaceCount fileCount Project MSG_INFO finally replacefilters savedFilters properties savedProperties public void validateAttributes throws BuildException if src null dir null String message throw new BuildException message getLocation if propertyFile null propertyFile exists String message propertyFile getPath throw new BuildException message getLocation if token null replacefilters size String message throw new BuildException message getLocation if token null equals token getText String message throw new BuildException message getLocation public void validateReplacefilters throws BuildException for int replacefilters size Replacefilter element Replacefilter replacefilters elementAt element validate public Properties getProperties File propertyFile throws BuildException Properties props new Properties FileInputStream in null try in new FileInputStream propertyFile props load in catch FileNotFoundException String message propertyFile getPath throw new BuildException message catch IOException String message propertyFile getPath throw new BuildException message finally FileUtils close in return props private void processFile File src throws BuildException if src exists throw new BuildException src getPath getLocation File temp null FileInput in null FileOutput out null try in new FileInput src temp FILE_UTILS createTempFile src getParentFile out new FileOutput temp int repCountStart replaceCount logFilterChain src getPath out setInputBuffer buildFilterChain in getOutputBuffer while in readChunk if processFilterChain out process flushFilterChain out flush in close in null out close out null boolean changes replaceCount repCountStart if changes FILE_UTILS rename temp src temp null catch IOException ioe throw new BuildException src ioe getClass getName ioe getMessage ioe getLocation finally if null in in closeQuietly if null out out closeQuietly if temp null if temp delete temp deleteOnExit private void flushFilterChain for int replacefilters size Replacefilter filter Replacefilter replacefilters elementAt filter flush private boolean processFilterChain for int replacefilters size Replacefilter filter Replacefilter replacefilters elementAt if filter process return false return true private StringBuffer buildFilterChain StringBuffer inputBuffer StringBuffer buf inputBuffer for int replacefilters size Replacefilter filter Replacefilter replacefilters elementAt filter setInputBuffer buf buf filter getOutputBuffer return buf private void logFilterChain String filename for int replacefilters size Replacefilter filter Replacefilter replacefilters elementAt log filename filter getToken filter getReplaceValue Project MSG_VERBOSE public void setFile File file this src file public void setSummary boolean summary this summary summary public void setReplaceFilterFile File replaceFilterFile this replaceFilterFile replaceFilterFile public void setDir File dir this dir dir public void setToken String token createReplaceToken addText token public void setValue String value createReplaceValue addText value public void setEncoding String encoding this encoding encoding public NestedString createReplaceToken if token null token new NestedString return token public NestedString createReplaceValue return value public void setPropertyFile File propertyFile this propertyFile propertyFile public Replacefilter createReplacefilter Replacefilter filter new Replacefilter replacefilters addElement filter return filter private Replacefilter createPrimaryfilter Replacefilter filter new Replacefilter replacefilters insertElementAt filter return filter private void stringReplace StringBuffer str String str1 String str2 int found str toString indexOf str1 while found str replace found found str1 length str2 found str toString indexOf str1 found str2 length public class CCMkdir extends ClearCase private String mComment null private String mCfile null private boolean mNoco false public void execute throws BuildException Commandline commandLine new Commandline Project aProj getProject int result if getViewPath null setViewPath aProj getBaseDir getPath commandLine setExecutable getClearToolCommand commandLine createArgument setValue COMMAND_MKDIR checkOptions commandLine if getFailOnErr getProject log getViewPathBasename Project MSG_VERBOSE result run commandLine if Execute isFailure result getFailOnErr String msg commandLine toString throw new BuildException msg getLocation private void checkOptions Commandline cmd if getComment null getCommentCommand cmd else if getCommentFile null getCommentFileCommand cmd else cmd createArgument setValue FLAG_NOCOMMENT if getNoCheckout cmd createArgument setValue FLAG_NOCHECKOUT cmd createArgument setValue getViewPath public void setComment String comment mComment comment public String getComment return mComment public void setCommentFile String cfile mCfile cfile public String getCommentFile return mCfile public void setNoCheckout boolean co mNoco co public boolean getNoCheckout return mNoco private void getCommentCommand Commandline cmd if getComment null cmd createArgument setValue FLAG_COMMENT cmd createArgument setValue getComment private void getCommentFileCommand Commandline cmd if getCommentFile null cmd createArgument setValue FLAG_COMMENTFILE cmd createArgument setValue getCommentFile public static final String FLAG_COMMENT public static final String FLAG_COMMENTFILE public static final String FLAG_NOCOMMENT public static final String FLAG_NOCHECKOUT public class UnrecognizedExtraField implements ZipExtraField private ZipShort headerId public void setHeaderId ZipShort headerId this headerId headerId public ZipShort getHeaderId return headerId private byte localData public void setLocalFileDataData byte data localData data public ZipShort getLocalFileDataLength return new ZipShort localData length public byte getLocalFileDataData return localData private byte centralData public void setCentralDirectoryData byte data centralData data public ZipShort getCentralDirectoryLength if centralData null return new ZipShort centralData length return getLocalFileDataLength public byte getCentralDirectoryData if centralData null return centralData return getLocalFileDataData public void parseFromLocalFileData byte data int offset int length byte tmp new byte length System arraycopy data offset tmp length setLocalFileDataData tmp public class SchemaValidate extends XMLValidateTask private HashMap schemaLocations new HashMap private boolean fullChecking true private boolean disableDTD false private SchemaLocation anonymousSchema public static final String ERROR_SAX_1 public static final String ERROR_NO_XSD_SUPPORT public static final String ERROR_TOO_MANY_DEFAULT_SCHEMAS public static final String ERROR_PARSER_CREATION_FAILURE public static final String MESSAGE_ADDING_SCHEMA public static final String ERROR_DUPLICATE_SCHEMA public void init throws BuildException super init setLenient false public boolean enableXercesSchemaValidation try setFeature XmlConstants FEATURE_XSD true setNoNamespaceSchemaProperty XmlConstants PROPERTY_NO_NAMESPACE_SCHEMA_LOCATION catch BuildException log toString Project MSG_VERBOSE return false return true private void setNoNamespaceSchemaProperty String property String anonSchema getNoNamespaceSchemaURL if anonSchema null setProperty property anonSchema public boolean enableJAXP12SchemaValidation try setProperty XmlConstants FEATURE_JAXP12_SCHEMA_LANGUAGE XmlConstants URI_XSD setNoNamespaceSchemaProperty XmlConstants FEATURE_JAXP12_SCHEMA_SOURCE catch BuildException log toString Project MSG_VERBOSE return false return true public void addConfiguredSchema SchemaLocation location log location Project MSG_DEBUG location validateNamespace SchemaLocation old SchemaLocation schemaLocations get location getNamespace if old null old equals location throw new BuildException ERROR_DUPLICATE_SCHEMA location schemaLocations put location getNamespace location public void setFullChecking boolean fullChecking this fullChecking fullChecking protected void createAnonymousSchema if anonymousSchema null anonymousSchema new SchemaLocation anonymousSchema setNamespace public void setNoNamespaceURL String defaultSchemaURL createAnonymousSchema this anonymousSchema setUrl defaultSchemaURL public void setNoNamespaceFile File defaultSchemaFile createAnonymousSchema this anonymousSchema setFile defaultSchemaFile public void setDisableDTD boolean disableDTD this disableDTD disableDTD protected void initValidator super initValidator if isSax1Parser throw new BuildException ERROR_SAX_1 setFeature XmlConstants FEATURE_NAMESPACES true if enableXercesSchemaValidation enableJAXP12SchemaValidation throw new BuildException ERROR_NO_XSD_SUPPORT setFeature XmlConstants FEATURE_XSD_FULL_VALIDATION fullChecking setFeatureIfSupported XmlConstants FEATURE_DISALLOW_DTD disableDTD addSchemaLocations protected XMLReader createDefaultReader SAXParserFactory factory SAXParserFactory newInstance factory setValidating true factory setNamespaceAware true XMLReader reader null try SAXParser saxParser factory newSAXParser reader saxParser getXMLReader catch ParserConfigurationException throw new BuildException ERROR_PARSER_CREATION_FAILURE catch SAXException throw new BuildException ERROR_PARSER_CREATION_FAILURE return reader protected void addSchemaLocations Iterator it schemaLocations values iterator StringBuffer buffer new StringBuffer int count while it hasNext if count buffer append SchemaLocation schemaLocation SchemaLocation it next String tuple schemaLocation getURIandLocation buffer append tuple log tuple Project MSG_VERBOSE count if count setProperty XmlConstants PROPERTY_SCHEMA_LOCATION buffer toString protected String getNoNamespaceSchemaURL if anonymousSchema null return null else return anonymousSchema getSchemaLocationURL protected void setFeatureIfSupported String feature boolean value try getXmlReader setFeature feature value catch SAXNotRecognizedException log feature Project MSG_VERBOSE catch SAXNotSupportedException log feature Project MSG_VERBOSE protected void onSuccessfulValidation int fileProcessed log fileProcessed MESSAGE_FILES_VALIDATED Project MSG_VERBOSE public static class SchemaLocation private String namespace private File file private String url public static final String ERROR_NO_URI public static final String ERROR_TWO_LOCATIONS public static final String ERROR_NO_FILE public static final String ERROR_NO_URL_REPRESENTATION public static final String ERROR_NO_LOCATION public SchemaLocation public String getNamespace return namespace public void setNamespace String namespace this namespace namespace public File getFile return file public void setFile File file this file file public String getUrl return url public void setUrl String url this url url public String getSchemaLocationURL boolean hasFile file null boolean hasURL isSet url if hasFile hasURL throw new BuildException ERROR_NO_LOCATION namespace if hasFile hasURL throw new BuildException ERROR_TWO_LOCATIONS namespace String schema url if hasFile if file exists throw new BuildException ERROR_NO_FILE file try schema FileUtils getFileUtils getFileURL file toString catch MalformedURLException throw new BuildException ERROR_NO_URL_REPRESENTATION file return schema public String getURIandLocation throws BuildException validateNamespace StringBuffer buffer new StringBuffer buffer append namespace buffer append buffer append getSchemaLocationURL return new String buffer public void validateNamespace if isSet getNamespace throw new BuildException ERROR_NO_URI private boolean isSet String property return property null property length public boolean equals Object if this return true if instanceof SchemaLocation return false final SchemaLocation schemaLocation SchemaLocation if file null file equals schemaLocation file schemaLocation file null return false if namespace null namespace equals schemaLocation namespace schemaLocation namespace null return false if url null url equals schemaLocation url schemaLocation url null return false return true public int hashCode int result result namespace null namespace hashCode result result file null file hashCode result result url null url hashCode return result public String toString StringBuffer buffer new StringBuffer buffer append namespace null namespace buffer append buffer append url null url buffer append file null file getAbsolutePath return buffer toString public class Path extends DataType implements Cloneable ResourceCollection public static Path systemClasspath new Path null System getProperty public static Path systemBootClasspath new Path null System getProperty private static final Iterator EMPTY_ITERATOR Collections EMPTY_SET iterator public class PathElement implements ResourceCollection private String parts public void setLocation File loc parts new String translateFile loc getAbsolutePath public void setPath String path parts Path translatePath getProject path public String getParts return parts public Iterator iterator return new FileResourceIterator null parts public boolean isFilesystemOnly return true public int size return parts null parts length private Union union null public Path Project String path this createPathElement setPath path public Path Project project setProject project public void setLocation File location throws BuildException checkAttributesAllowed createPathElement setLocation location public void setPath String path throws BuildException checkAttributesAllowed createPathElement setPath path public void setRefid Reference throws BuildException if union null throw tooManyAttributes super setRefid public PathElement createPathElement throws BuildException if isReference throw noChildrenAllowed PathElement pe new PathElement add pe return pe public void addFileset FileSet fs throws BuildException if fs getProject null fs setProject getProject add fs public void addFilelist FileList fl throws BuildException if fl getProject null fl setProject getProject add fl public void addDirset DirSet dset throws BuildException if dset getProject null dset setProject getProject add dset public void add Path path throws BuildException if path this throw circularReference if path getProject null path setProject getProject add ResourceCollection path public void add ResourceCollection checkChildrenAllowed if null return if union null union new Union union setProject getProject union setCache false union add setChecked false public Path createPath throws BuildException Path new Path getProject add return public void append Path other if other null return add other public void addExisting Path source addExisting source false public void addExisting Path source boolean tryUserDir String list source list File userDir tryUserDir new File System getProperty null for int list length File resolveFile getProject list if tryUserDir exists new File userDir list if exists setLocation else log Project MSG_VERBOSE public String list if isReference return Path getCheckedRef list return assertFilesystemOnly union null new String union list public String toString return isReference getCheckedRef toString union null union toString public static String translatePath Project project String source final Vector result new Vector if source null return new String PathTokenizer tok new PathTokenizer source StringBuffer element new StringBuffer while tok hasMoreTokens String pathElement tok nextToken try element append resolveFile project pathElement getPath catch BuildException project log pathElement Project MSG_VERBOSE for int element length translateFileSep element result addElement element toString element new StringBuffer String res new String result size result copyInto res return res public static String translateFile String source if source null return final StringBuffer result new StringBuffer source for int result length translateFileSep result return result toString protected static boolean translateFileSep StringBuffer buffer int pos if buffer charAt pos buffer charAt pos buffer setCharAt pos File separatorChar return true return false public synchronized int size if isReference return Path getCheckedRef size dieOnCircularReference return union null assertFilesystemOnly union size public Object clone try Path result Path super clone result union union null union Union union clone return result catch CloneNotSupportedException throw new BuildException protected synchronized void dieOnCircularReference Stack stk Project throws BuildException if isChecked return if isReference super dieOnCircularReference stk else if union null stk push union invokeCircularReferenceCheck union stk stk pop setChecked true private static File resolveFile Project project String relativeName return FileUtils getFileUtils resolveFile project null null project getBaseDir relativeName public Path concatSystemClasspath return concatSystemClasspath public Path concatSystemClasspath String defValue return concatSpecialPath defValue Path systemClasspath public Path concatSystemBootClasspath String defValue return concatSpecialPath defValue Path systemBootClasspath private Path concatSpecialPath String defValue Path Path result new Path getProject String order defValue if getProject null String getProject getProperty if null order if order equals result addExisting true else if order equals result addExisting true result addExisting this else if order equals result addExisting this else if order equals log order Project MSG_WARN result addExisting this result addExisting true return result public void addJavaRuntime if JavaEnvUtils isKaffe File kaffeShare new File System getProperty File separator File separator if kaffeShare isDirectory FileSet kaffeJarFiles new FileSet kaffeJarFiles setDir kaffeShare kaffeJarFiles setIncludes addFileset kaffeJarFiles else if equals System getProperty addExisting systemBootClasspath if System getProperty toLowerCase Locale US indexOf FileSet msZipFiles new FileSet msZipFiles setDir new File System getProperty File separator msZipFiles setIncludes addFileset msZipFiles else addExisting new Path null System getProperty File separator File separator addExisting new Path null System getProperty File separator File separator File separator String secJars for int secJars length addExisting new Path null System getProperty File separator File separator secJars addExisting new Path null System getProperty File separator File separator File separator secJars String ibmJars for int ibmJars length addExisting new Path null System getProperty File separator File separator ibmJars addExisting new Path null System getProperty File separator File separator File separator addExisting new Path null System getProperty File separator File separator File separator public void addExtdirs Path extdirs if extdirs null String extProp System getProperty if extProp null extdirs new Path getProject extProp else return String dirs extdirs list for int dirs length File dir resolveFile getProject dirs if dir exists dir isDirectory FileSet fs new FileSet fs setDir dir fs setIncludes addFileset fs public final synchronized Iterator iterator if isReference return Path getCheckedRef iterator dieOnCircularReference return union null EMPTY_ITERATOR assertFilesystemOnly union iterator public synchronized boolean isFilesystemOnly if isReference return Path getCheckedRef isFilesystemOnly dieOnCircularReference assertFilesystemOnly union return true protected ResourceCollection assertFilesystemOnly ResourceCollection rc if rc null rc isFilesystemOnly throw new BuildException getDataTypeName return rc public class CCMkelem extends ClearCase private String mComment null private String mCfile null private boolean mNwarn false private boolean mPtime false private boolean mNoco false private boolean mCheckin false private boolean mMaster false private String mEltype null public void execute throws BuildException Commandline commandLine new Commandline Project aProj getProject int result if getViewPath null setViewPath aProj getBaseDir getPath commandLine setExecutable getClearToolCommand commandLine createArgument setValue COMMAND_MKELEM checkOptions commandLine if getFailOnErr getProject log getViewPathBasename Project MSG_VERBOSE result run commandLine if Execute isFailure result getFailOnErr String msg commandLine toString throw new BuildException msg getLocation private void checkOptions Commandline cmd if getComment null getCommentCommand cmd else if getCommentFile null getCommentFileCommand cmd else cmd createArgument setValue FLAG_NOCOMMENT if getNoWarn cmd createArgument setValue FLAG_NOWARN if getNoCheckout getCheckin throw new BuildException if getNoCheckout cmd createArgument setValue FLAG_NOCHECKOUT if getCheckin cmd createArgument setValue FLAG_CHECKIN if getPreserveTime cmd createArgument setValue FLAG_PRESERVETIME if getMaster cmd createArgument setValue FLAG_MASTER if getEltype null getEltypeCommand cmd cmd createArgument setValue getViewPath public void setComment String comment mComment comment public String getComment return mComment public void setCommentFile String cfile mCfile cfile public String getCommentFile return mCfile public void setNoWarn boolean nwarn mNwarn nwarn public boolean getNoWarn return mNwarn public void setPreserveTime boolean ptime mPtime ptime public boolean getPreserveTime return mPtime public void setNoCheckout boolean co mNoco co public boolean getNoCheckout return mNoco public void setCheckin boolean ci mCheckin ci public boolean getCheckin return mCheckin public void setMaster boolean master mMaster master public boolean getMaster return mMaster public void setEltype String eltype mEltype eltype public String getEltype return mEltype private void getCommentCommand Commandline cmd if getComment null cmd createArgument setValue FLAG_COMMENT cmd createArgument setValue getComment private void getCommentFileCommand Commandline cmd if getCommentFile null cmd createArgument setValue FLAG_COMMENTFILE cmd createArgument setValue getCommentFile private void getEltypeCommand Commandline cmd if getEltype null cmd createArgument setValue FLAG_ELTYPE cmd createArgument setValue getEltype public static final String FLAG_COMMENT public static final String FLAG_COMMENTFILE public static final String FLAG_NOCOMMENT public static final String FLAG_NOWARN public static final String FLAG_PRESERVETIME public static final String FLAG_NOCHECKOUT public static final String FLAG_CHECKIN public static final String FLAG_MASTER public static final String FLAG_ELTYPE public class RegularExpression extends DataType public static final String DATA_TYPE_NAME private boolean alreadyInit false private static final RegexpFactory FACTORY new RegexpFactory private Regexp regexp null private String myPattern private boolean setPatternPending false public RegularExpression private void init Project if alreadyInit this regexp FACTORY newRegexp alreadyInit true private void setPattern if setPatternPending regexp setPattern myPattern setPatternPending false public void setPattern String pattern if regexp null myPattern pattern setPatternPending true else regexp setPattern pattern public String getPattern Project init if isReference return getRef getPattern setPattern return regexp getPattern public Regexp getRegexp Project init if isReference return getRef getRegexp setPattern return this regexp public RegularExpression getRef Project return RegularExpression getCheckedRef private static final WeakHashMap MAP new WeakHashMap static synchronized void invalidate Object Set Set MAP get if null clear private static synchronized void add FailFast Set Set MAP get parent if null new HashSet MAP put parent add private static synchronized void remove FailFast Set Set MAP get parent if null remove private static synchronized void failFast FailFast Set Set MAP get parent if contains throw new ConcurrentModificationException private Object parent private Iterator wrapped FailFast Object Iterator if null throw new IllegalArgumentException if null throw new IllegalArgumentException parent if hasNext wrapped add this public boolean hasNext if wrapped null return false failFast this return wrapped hasNext public Object next if wrapped null wrapped hasNext throw new NoSuchElementException failFast this try return wrapped next finally if wrapped hasNext wrapped null remove this public void remove throw new UnsupportedOperationException public class CopyPath extends Task public static final String ERROR_NO_DESTDIR public static final String ERROR_NO_PATH public static final String ERROR_NO_MAPPER private static final FileUtils FILE_UTILS FileUtils getFileUtils private FileNameMapper mapper private Path path private File destDir private long granularity FILE_UTILS getFileTimestampGranularity private boolean preserveLastModified false public void setDestDir File destDir this destDir destDir public void add FileNameMapper newmapper if mapper null throw new BuildException mapper newmapper public void setPath Path createPath append public void setPathRef Reference createPath setRefid public Path createPath if path null path new Path getProject return path public void setGranularity long granularity this granularity granularity public void setPreserveLastModified boolean preserveLastModified this preserveLastModified preserveLastModified protected void validateAttributes throws BuildException if destDir null throw new BuildException ERROR_NO_DESTDIR if mapper null throw new BuildException ERROR_NO_MAPPER if path null throw new BuildException ERROR_NO_PATH public void execute throws BuildException validateAttributes String sourceFiles path list if sourceFiles length log Project MSG_VERBOSE return for int sources sources sourceFiles length sources String sourceFileName sourceFiles sources File sourceFile new File sourceFileName String toFiles String mapper mapFileName sourceFileName for int toFiles length String destFileName toFiles File destFile new File destDir destFileName if sourceFile equals destFile log sourceFileName Project MSG_VERBOSE continue if sourceFile isDirectory log sourceFileName continue try log sourceFile destFile Project MSG_VERBOSE FILE_UTILS copyFile sourceFile destFile null null false preserveLastModified null null getProject catch IOException ioe String msg sourceFile destFile ioe getMessage if destFile exists destFile delete msg destFile throw new BuildException msg ioe getLocation public class Jvc extends DefaultCompilerAdapter public boolean execute throws BuildException attributes log Project MSG_VERBOSE Path classpath new Path project Path getBootClassPath if size classpath append if includeJavaRuntime classpath addExtdirs extdirs classpath append getCompileClasspath if compileSourcepath null classpath append compileSourcepath else classpath append src Commandline cmd new Commandline String exec getJavac getExecutable cmd setExecutable exec null exec if destDir null cmd createArgument setValue cmd createArgument setFile destDir cmd createArgument setValue cmd createArgument setPath classpath boolean msExtensions true String mse getProject getProperty if mse null msExtensions Project toBoolean mse if msExtensions cmd createArgument setValue cmd createArgument setValue cmd createArgument setValue if debug cmd createArgument setValue if optimize cmd createArgument setValue if verbose cmd createArgument setValue addCurrentCompilerArgs cmd int firstFileName cmd size logAndAddFilesToCompile cmd return executeExternalCompile cmd getCommandline firstFileName public class ApacheCatalogResolver extends CatalogResolver private XMLCatalog xmlCatalog null static CatalogManager getStaticManager setIgnoreMissingProperties true System getProperties put ApacheCatalog class getName CatalogManager getStaticManager setUseStaticCatalog false public void setXMLCatalog XMLCatalog xmlCatalog this xmlCatalog xmlCatalog public void parseCatalog String file Catalog catalog getCatalog if catalog instanceof ApacheCatalog throw new BuildException catalog getClass getName ApacheCatalog apacheCatalog ApacheCatalog catalog apacheCatalog setResolver this try apacheCatalog parseCatalog file catch MalformedURLException ex throw new BuildException ex catch IOException ex throw new BuildException ex public void addPublicEntry String publicid String systemid URL base ResourceLocation dtd new ResourceLocation dtd setBase base dtd setPublicId publicid dtd setLocation systemid xmlCatalog addDTD dtd public void addURIEntry String uri String altURI URL base ResourceLocation entity new ResourceLocation entity setBase base entity setPublicId uri entity setLocation altURI xmlCatalog addEntity entity public final class Specification private static final String MISSING public static final Attributes Name SPECIFICATION_TITLE Attributes Name SPECIFICATION_TITLE public static final Attributes Name SPECIFICATION_VERSION Attributes Name SPECIFICATION_VERSION public static final Attributes Name SPECIFICATION_VENDOR Attributes Name SPECIFICATION_VENDOR public static final Attributes Name IMPLEMENTATION_TITLE Attributes Name IMPLEMENTATION_TITLE public static final Attributes Name IMPLEMENTATION_VERSION Attributes Name IMPLEMENTATION_VERSION public static final Attributes Name IMPLEMENTATION_VENDOR Attributes Name IMPLEMENTATION_VENDOR public static final Compatibility COMPATIBLE new Compatibility public static final Compatibility REQUIRE_SPECIFICATION_UPGRADE new Compatibility public static final Compatibility REQUIRE_VENDOR_SWITCH new Compatibility public static final Compatibility REQUIRE_IMPLEMENTATION_CHANGE new Compatibility public static final Compatibility INCOMPATIBLE new Compatibility private String specificationTitle private DeweyDecimal specificationVersion private String specificationVendor private String implementationTitle private String implementationVendor private String implementationVersion private String sections public static Specification getSpecifications final Manifest manifest throws ParseException if null manifest return new Specification final ArrayList results new ArrayList final Map entries manifest getEntries final Iterator keys entries keySet iterator while keys hasNext final String key String keys next final Attributes attributes Attributes entries get key final Specification specification getSpecification key attributes if null specification results add specification final ArrayList trimmedResults removeDuplicates results return Specification trimmedResults toArray new Specification trimmedResults size public Specification final String specificationTitle final String specificationVersion final String specificationVendor final String implementationTitle final String implementationVersion final String implementationVendor this specificationTitle specificationVersion specificationVendor implementationTitle implementationVersion implementationVendor null public Specification final String specificationTitle final String specificationVersion final String specificationVendor final String implementationTitle final String implementationVersion final String implementationVendor final String sections this specificationTitle specificationTitle this specificationVendor specificationVendor if null specificationVersion try this specificationVersion new DeweyDecimal specificationVersion catch final NumberFormatException nfe final String error specificationVersion specificationTitle nfe throw new IllegalArgumentException error this implementationTitle implementationTitle this implementationVendor implementationVendor this implementationVersion implementationVersion if null this specificationTitle throw new NullPointerException String copy null if null sections copy new String sections length System arraycopy sections copy sections length this sections copy public String getSpecificationTitle return specificationTitle public String getSpecificationVendor return specificationVendor public String getImplementationTitle return implementationTitle public DeweyDecimal getSpecificationVersion return specificationVersion public String getImplementationVendor return implementationVendor public String getImplementationVersion return implementationVersion public String getSections if null sections return null final String newSections new String sections length System arraycopy sections newSections sections length return newSections public Compatibility getCompatibilityWith final Specification other if specificationTitle equals other getSpecificationTitle return INCOMPATIBLE final DeweyDecimal otherSpecificationVersion other getSpecificationVersion if null specificationVersion if null otherSpecificationVersion isCompatible specificationVersion otherSpecificationVersion return REQUIRE_SPECIFICATION_UPGRADE final String otherImplementationVendor other getImplementationVendor if null implementationVendor if null otherImplementationVendor implementationVendor equals otherImplementationVendor return REQUIRE_VENDOR_SWITCH final String otherImplementationVersion other getImplementationVersion if null implementationVersion if null otherImplementationVersion implementationVersion equals otherImplementationVersion return REQUIRE_IMPLEMENTATION_CHANGE return COMPATIBLE public boolean isCompatibleWith final Specification other return COMPATIBLE getCompatibilityWith other public String toString final String brace final StringBuffer sb new StringBuffer SPECIFICATION_TITLE toString sb append brace sb append specificationTitle sb append StringUtils LINE_SEP if null specificationVersion sb append SPECIFICATION_VERSION sb append brace sb append specificationVersion sb append StringUtils LINE_SEP if null specificationVendor sb append SPECIFICATION_VENDOR sb append brace sb append specificationVendor sb append StringUtils LINE_SEP if null implementationTitle sb append IMPLEMENTATION_TITLE sb append brace sb append implementationTitle sb append StringUtils LINE_SEP if null implementationVersion sb append IMPLEMENTATION_VERSION sb append brace sb append implementationVersion sb append StringUtils LINE_SEP if null implementationVendor sb append IMPLEMENTATION_VENDOR sb append brace sb append implementationVendor sb append StringUtils LINE_SEP return sb toString private boolean isCompatible final DeweyDecimal first final DeweyDecimal second return first isGreaterThanOrEqual second private static ArrayList removeDuplicates final ArrayList list final ArrayList results new ArrayList final ArrayList sections new ArrayList while list size final Specification specification Specification list remove final Iterator iterator list iterator while iterator hasNext final Specification other Specification iterator next if isEqual specification other final String otherSections other getSections if null sections sections addAll Arrays asList otherSections iterator remove final Specification merged mergeInSections specification sections results add merged sections clear return results private static boolean isEqual final Specification specification final Specification other return specification getSpecificationTitle equals other getSpecificationTitle specification getSpecificationVersion isEqual other getSpecificationVersion specification getSpecificationVendor equals other getSpecificationVendor specification getImplementationTitle equals other getImplementationTitle specification getImplementationVersion equals other getImplementationVersion specification getImplementationVendor equals other getImplementationVendor private static Specification mergeInSections final Specification specification final ArrayList sectionsToAdd if sectionsToAdd size return specification sectionsToAdd addAll Arrays asList specification getSections final String sections String sectionsToAdd toArray new String sectionsToAdd size return new Specification specification getSpecificationTitle specification getSpecificationVersion toString specification getSpecificationVendor specification getImplementationTitle specification getImplementationVersion specification getImplementationVendor sections private static String getTrimmedString final String value return value null null value trim private static Specification getSpecification final String section final Attributes attributes throws ParseException final String name getTrimmedString attributes getValue SPECIFICATION_TITLE if null name return null final String specVendor getTrimmedString attributes getValue SPECIFICATION_VENDOR if null specVendor throw new ParseException MISSING SPECIFICATION_VENDOR final String specVersion getTrimmedString attributes getValue SPECIFICATION_VERSION if null specVersion throw new ParseException MISSING SPECIFICATION_VERSION final String impTitle getTrimmedString attributes getValue IMPLEMENTATION_TITLE if null impTitle throw new ParseException MISSING IMPLEMENTATION_TITLE final String impVersion getTrimmedString attributes getValue IMPLEMENTATION_VERSION if null impVersion throw new ParseException MISSING IMPLEMENTATION_VERSION final String impVendor getTrimmedString attributes getValue IMPLEMENTATION_VENDOR if null impVendor throw new ParseException MISSING IMPLEMENTATION_VENDOR return new Specification name specVersion specVendor impTitle impVersion impVendor new String section public class ScriptDefBase extends Task implements DynamicConfigurator private Map nestedElementMap new HashMap private Map attributes new HashMap private String text public void execute getScript executeScript attributes nestedElementMap this private ScriptDef getScript String name getTaskType Map scriptRepository Map getProject getReference MagicNames SCRIPT_REPOSITORY if scriptRepository null throw new BuildException name ScriptDef definition ScriptDef scriptRepository get getTaskType if definition null throw new BuildException name return definition public Object createDynamicElement String name List nestedElementList List nestedElementMap get name if nestedElementList null nestedElementList new ArrayList nestedElementMap put name nestedElementList Object element getScript createNestedElement name nestedElementList add element return element public void setDynamicAttribute String name String value ScriptDef definition getScript if definition isAttributeSupported name throw new BuildException getTaskType name attributes put name value public void addText String text this text getProject replaceProperties text public String getText return text public void fail String message throw new BuildException message public class CCUpdate extends ClearCase private boolean mGraphical false private boolean mOverwrite false private boolean mRename false private boolean mCtime false private boolean mPtime false private String mLog null public void execute throws BuildException Commandline commandLine new Commandline Project aProj getProject int result if getViewPath null setViewPath aProj getBaseDir getPath commandLine setExecutable getClearToolCommand commandLine createArgument setValue COMMAND_UPDATE checkOptions commandLine getProject log commandLine toString Project MSG_DEBUG if getFailOnErr getProject log getViewPathBasename Project MSG_VERBOSE result run commandLine if Execute isFailure result getFailOnErr String msg commandLine toString throw new BuildException msg getLocation private void checkOptions Commandline cmd if getGraphical cmd createArgument setValue FLAG_GRAPHICAL else if getOverwrite cmd createArgument setValue FLAG_OVERWRITE else if getRename cmd createArgument setValue FLAG_RENAME else cmd createArgument setValue FLAG_NOVERWRITE if getCurrentTime cmd createArgument setValue FLAG_CURRENTTIME else if getPreserveTime cmd createArgument setValue FLAG_PRESERVETIME getLogCommand cmd cmd createArgument setValue getViewPath public void setGraphical boolean graphical mGraphical graphical public boolean getGraphical return mGraphical public void setOverwrite boolean ow mOverwrite ow public boolean getOverwrite return mOverwrite public void setRename boolean ren mRename ren public boolean getRename return mRename public void setCurrentTime boolean ct mCtime ct public boolean getCurrentTime return mCtime public void setPreserveTime boolean pt mPtime pt public boolean getPreserveTime return mPtime public void setLog String log mLog log public String getLog return mLog private void getLogCommand Commandline cmd if getLog null return else cmd createArgument setValue FLAG_LOG cmd createArgument setValue getLog public static final String FLAG_GRAPHICAL public static final String FLAG_LOG public static final String FLAG_OVERWRITE public static final String FLAG_NOVERWRITE public static final String FLAG_RENAME public static final String FLAG_CURRENTTIME public static final String FLAG_PRESERVETIME public class Depend extends MatchingTask private static class ClassFileInfo private File absoluteFile private String className private File sourceFile private boolean isUserWarned false private Path srcPath private Path destPath private File cache private String srcPathList private Hashtable affectedClassMap private Hashtable classFileInfoMap private Hashtable classpathDependencies private Hashtable outOfDateClasses private boolean closure false private boolean warnOnRmiStubs true private boolean dump false private Path dependClasspath private static final String CACHE_FILE_NAME private static final String CLASSNAME_PREPEND public void setClasspath Path classpath if dependClasspath null dependClasspath classpath else dependClasspath append classpath public Path getClasspath return dependClasspath public Path createClasspath if dependClasspath null dependClasspath new Path getProject return dependClasspath createPath public void setClasspathRef Reference createClasspath setRefid public void setWarnOnRmiStubs boolean warnOnRmiStubs this warnOnRmiStubs warnOnRmiStubs private Hashtable readCachedDependencies File depFile throws IOException Hashtable dependencyMap new Hashtable BufferedReader in null try in new BufferedReader new FileReader depFile String line null Vector dependencyList null String className null int prependLength CLASSNAME_PREPEND length while line in readLine null if line startsWith CLASSNAME_PREPEND dependencyList new Vector className line substring prependLength dependencyMap put className dependencyList else dependencyList addElement line finally if in null in close return dependencyMap private void writeCachedDependencies Hashtable dependencyMap throws IOException if cache null PrintWriter pw null try cache mkdirs File depFile new File cache CACHE_FILE_NAME pw new PrintWriter new FileWriter depFile Enumeration dependencyMap keys while hasMoreElements String className String nextElement pw println CLASSNAME_PREPEND className Vector dependencyList Vector dependencyMap get className int size dependencyList size for int size pw println dependencyList elementAt finally if pw null pw close private Path getCheckClassPath if dependClasspath null return null String destPathElements destPath list String classpathElements dependClasspath list String checkPath for int classpathElements length String element classpathElements boolean inDestPath false for int destPathElements length inDestPath inDestPath destPathElements equals element if inDestPath if checkPath length checkPath element else checkPath element if checkPath length return null return new Path getProject checkPath private void determineDependencies throws IOException affectedClassMap new Hashtable classFileInfoMap new Hashtable boolean cacheDirty false Hashtable dependencyMap new Hashtable File cacheFile null boolean cacheFileExists true long cacheLastModified Long MAX_VALUE if cache null cacheFile new File cache CACHE_FILE_NAME cacheFileExists cacheFile exists cacheLastModified cacheFile lastModified if cacheFileExists dependencyMap readCachedDependencies cacheFile Enumeration classfileEnum getClassFiles destPath elements while classfileEnum hasMoreElements ClassFileInfo info ClassFileInfo classfileEnum nextElement log info className Project MSG_DEBUG classFileInfoMap put info className info Vector dependencyList null if cache null if cacheFileExists cacheLastModified info absoluteFile lastModified dependencyList Vector dependencyMap get info className if dependencyList null DependencyAnalyzer analyzer new AntAnalyzer analyzer addRootClass info className analyzer addClassPath destPath analyzer setClosure false dependencyList new Vector Enumeration depEnum analyzer getClassDependencies while depEnum hasMoreElements dependencyList addElement depEnum nextElement cacheDirty true dependencyMap put info className dependencyList Enumeration depEnum dependencyList elements while depEnum hasMoreElements String dependentClass String depEnum nextElement Hashtable affectedClasses Hashtable affectedClassMap get dependentClass if affectedClasses null affectedClasses new Hashtable affectedClassMap put dependentClass affectedClasses affectedClasses put info className info classpathDependencies null Path checkPath getCheckClassPath if checkPath null classpathDependencies new Hashtable AntClassLoader loader getProject createClassLoader checkPath Hashtable classpathFileCache new Hashtable Object nullFileMarker new Object for Enumeration dependencyMap keys hasMoreElements String className String nextElement Vector dependencyList Vector dependencyMap get className Hashtable dependencies new Hashtable classpathDependencies put className dependencies Enumeration e2 dependencyList elements while e2 hasMoreElements String dependency String e2 nextElement Object classpathFileObject classpathFileCache get dependency if classpathFileObject null classpathFileObject nullFileMarker if dependency startsWith dependency startsWith URL classURL loader getResource dependency replace if classURL null if classURL getProtocol equals String jarFilePath classURL getFile int classMarker jarFilePath indexOf jarFilePath jarFilePath substring classMarker if jarFilePath startsWith classpathFileObject new File FileUtils getFileUtils fromURI jarFilePath else throw new IOException jarFilePath else if classURL getProtocol equals classpathFileObject new File FileUtils getFileUtils fromURI classURL toExternalForm log className classpathFileObject dependency Project MSG_DEBUG classpathFileCache put dependency classpathFileObject if classpathFileObject null classpathFileObject nullFileMarker File jarFile File classpathFileObject dependencies put jarFile jarFile if cache null cacheDirty writeCachedDependencies dependencyMap private int deleteAllAffectedFiles int count for Enumeration outOfDateClasses elements hasMoreElements String className String nextElement count deleteAffectedFiles className ClassFileInfo classInfo ClassFileInfo classFileInfoMap get className if classInfo null classInfo absoluteFile exists classInfo absoluteFile delete count return count private int deleteAffectedFiles String className int count Hashtable affectedClasses Hashtable affectedClassMap get className if affectedClasses null return count for Enumeration affectedClasses keys hasMoreElements String affectedClass String nextElement ClassFileInfo affectedClassInfo ClassFileInfo affectedClasses get affectedClass if affectedClassInfo absoluteFile exists continue if affectedClassInfo sourceFile null warnOutOfDateButNotDeleted affectedClassInfo affectedClass className continue log affectedClassInfo absoluteFile getPath className Project MSG_VERBOSE affectedClassInfo absoluteFile delete count if closure count deleteAffectedFiles affectedClass else if affectedClass indexOf continue String topLevelClassName affectedClass substring affectedClass indexOf log topLevelClassName Project MSG_VERBOSE ClassFileInfo topLevelClassInfo ClassFileInfo classFileInfoMap get topLevelClassName if topLevelClassInfo null topLevelClassInfo absoluteFile exists log topLevelClassInfo absoluteFile getPath Project MSG_VERBOSE topLevelClassInfo absoluteFile delete count if closure count deleteAffectedFiles topLevelClassName return count private void warnOutOfDateButNotDeleted ClassFileInfo affectedClassInfo String affectedClass String className if affectedClassInfo isUserWarned return int level Project MSG_WARN if warnOnRmiStubs if isRmiStub affectedClass className level Project MSG_VERBOSE log affectedClass affectedClassInfo absoluteFile getPath className level affectedClassInfo isUserWarned true private boolean isRmiStub String affectedClass String className return isStub affectedClass className DefaultRmicAdapter RMI_STUB_SUFFIX isStub affectedClass className DefaultRmicAdapter RMI_SKEL_SUFFIX isStub affectedClass className WLRmic RMI_STUB_SUFFIX isStub affectedClass className WLRmic RMI_SKEL_SUFFIX private boolean isStub String affectedClass String baseClass String suffix return baseClass suffix equals affectedClass private void dumpDependencies log affectedClassMap size Project MSG_DEBUG Enumeration classEnum affectedClassMap keys while classEnum hasMoreElements String className String classEnum nextElement log className Project MSG_DEBUG Hashtable affectedClasses Hashtable affectedClassMap get className Enumeration affectedClassEnum affectedClasses keys while affectedClassEnum hasMoreElements String affectedClass String affectedClassEnum nextElement ClassFileInfo info ClassFileInfo affectedClasses get affectedClass log affectedClass info absoluteFile getPath Project MSG_DEBUG if classpathDependencies null log Project MSG_DEBUG Enumeration classpathEnum classpathDependencies keys while classpathEnum hasMoreElements String className String classpathEnum nextElement log className Project MSG_DEBUG Hashtable dependencies Hashtable classpathDependencies get className Enumeration classpathFileEnum dependencies elements while classpathFileEnum hasMoreElements File classpathFile File classpathFileEnum nextElement log classpathFile getPath Project MSG_DEBUG private void determineOutOfDateClasses outOfDateClasses new Hashtable for int srcPathList length File srcDir getProject resolveFile srcPathList if srcDir exists DirectoryScanner ds this getDirectoryScanner srcDir String files ds getIncludedFiles scanDir srcDir files if classpathDependencies null return Enumeration classpathDepsEnum classpathDependencies keys while classpathDepsEnum hasMoreElements String className String classpathDepsEnum nextElement if outOfDateClasses containsKey className continue ClassFileInfo info ClassFileInfo classFileInfoMap get className if info null Hashtable dependencies Hashtable classpathDependencies get className for Enumeration e2 dependencies elements e2 hasMoreElements File classpathFile File e2 nextElement if classpathFile lastModified info absoluteFile lastModified log className classpathFile Project MSG_DEBUG outOfDateClasses put className className break public void execute throws BuildException try long start System currentTimeMillis if srcPath null throw new BuildException getLocation srcPathList srcPath list if srcPathList length throw new BuildException getLocation if destPath null destPath srcPath if cache null cache exists cache isDirectory throw new BuildException if cache null cache exists cache mkdirs determineDependencies if dump dumpDependencies determineOutOfDateClasses int count deleteAllAffectedFiles long duration System currentTimeMillis start final int summaryLogLevel if count summaryLogLevel Project MSG_INFO else summaryLogLevel Project MSG_DEBUG log count duration summaryLogLevel catch Exception throw new BuildException protected void scanDir File srcDir String files for int files length File srcFile new File srcDir files if files endsWith String filePath srcFile getPath String className filePath substring srcDir getPath length filePath length length className ClassFileUtils convertSlashName className ClassFileInfo info ClassFileInfo classFileInfoMap get className if info null outOfDateClasses put className className else if srcFile lastModified info absoluteFile lastModified outOfDateClasses put className className private Vector getClassFiles Path classLocations String classLocationsList classLocations list Vector classFileList new Vector for int classLocationsList length File dir new File classLocationsList if dir isDirectory addClassFiles classFileList dir dir return classFileList private File findSourceFile String classname String sourceFilename classname int innerIndex classname indexOf if innerIndex sourceFilename classname substring innerIndex for int srcPathList length File sourceFile new File srcPathList sourceFilename if sourceFile exists return sourceFile return null private void addClassFiles Vector classFileList File dir File root String filesInDir dir list if filesInDir null return int length filesInDir length int rootLength root getPath length for int length File file new File dir filesInDir if file isDirectory addClassFiles classFileList file root else if file getName endsWith ClassFileInfo info new ClassFileInfo info absoluteFile file String relativeName file getPath substring rootLength file getPath length info className ClassFileUtils convertSlashName relativeName info sourceFile findSourceFile relativeName classFileList addElement info public void setSrcdir Path srcPath this srcPath srcPath public void setDestDir Path destPath this destPath destPath public void setCache File cache this cache cache public void setClosure boolean closure this closure closure public void setDump boolean dump this dump dump public abstract class P4Base extends org apache tools ant Task protected Perl5Util util null protected String shell protected String P4Port protected String P4Client protected String P4User protected String P4View protected boolean failOnError true protected String P4Opts protected String P4CmdOpts private boolean inError false private String errorMessage public boolean getInError return inError public void setInError boolean inError this inError inError public String getErrorMessage return errorMessage public void setErrorMessage String errorMessage this errorMessage errorMessage public void setPort String p4Port this P4Port p4Port public void setClient String p4Client this P4Client p4Client public void setUser String p4User this P4User p4User public void setGlobalopts String p4Opts this P4Opts p4Opts public void setView String p4View this P4View p4View public void setCmdopts String p4CmdOpts this P4CmdOpts p4CmdOpts public void setFailonerror boolean fail failOnError fail public void init util new Perl5Util String tmpprop if tmpprop getProject getProperty null setPort tmpprop if tmpprop getProject getProperty null setClient tmpprop if tmpprop getProject getProperty null setUser tmpprop protected void execP4Command String command throws BuildException execP4Command command null protected void execP4Command String command P4Handler handler throws BuildException try inError false errorMessage Commandline commandline new Commandline commandline setExecutable if P4Port null P4Port length commandline createArgument setValue P4Port if P4User null P4User length commandline createArgument setValue P4User if P4Client null P4Client length commandline createArgument setValue P4Client if P4Opts null P4Opts length commandline createArgument setLine P4Opts commandline createArgument setLine command log commandline describeCommand Project MSG_VERBOSE if handler null handler new SimpleP4OutputHandler this Execute exe new Execute handler null exe setAntRun getProject exe setCommandline commandline getCommandline try exe execute if inError failOnError throw new BuildException errorMessage catch IOException throw new BuildException finally try handler stop catch Exception log toString Project MSG_ERR catch Exception String failMsg getMessage if failOnError throw new BuildException failMsg else log failMsg Project MSG_ERR public class TarOutputStream extends FilterOutputStream public static final int LONGFILE_ERROR public static final int LONGFILE_TRUNCATE public static final int LONGFILE_GNU protected boolean debug protected long currSize protected String currName protected long currBytes protected byte oneBuf protected byte recordBuf protected int assemLen protected byte assemBuf protected TarBuffer buffer protected int longFileMode LONGFILE_ERROR private boolean closed false public TarOutputStream OutputStream os this os TarBuffer DEFAULT_BLKSIZE TarBuffer DEFAULT_RCDSIZE public TarOutputStream OutputStream os int blockSize this os blockSize TarBuffer DEFAULT_RCDSIZE public TarOutputStream OutputStream os int blockSize int recordSize super os this buffer new TarBuffer os blockSize recordSize this debug false this assemLen this assemBuf new byte recordSize this recordBuf new byte recordSize this oneBuf new byte public void setLongFileMode int longFileMode this longFileMode longFileMode public void setDebug boolean debugF this debug debugF public void setBufferDebug boolean debug this buffer setDebug debug public void finish throws IOException this writeEOFRecord this writeEOFRecord public void close throws IOException if closed this finish this buffer close out close closed true public int getRecordSize return this buffer getRecordSize public void putNextEntry TarEntry entry throws IOException if entry getName length TarConstants NAMELEN if longFileMode LONGFILE_GNU TarEntry longLinkEntry new TarEntry TarConstants GNU_LONGLINK TarConstants LF_GNUTYPE_LONGNAME longLinkEntry setSize entry getName length putNextEntry longLinkEntry write entry getName getBytes write closeEntry else if longFileMode LONGFILE_TRUNCATE throw new RuntimeException entry getName TarConstants NAMELEN entry writeEntryHeader this recordBuf this buffer writeRecord this recordBuf this currBytes if entry isDirectory this currSize else this currSize entry getSize currName entry getName public void closeEntry throws IOException if this assemLen for int this assemLen this assemBuf length this assemBuf this buffer writeRecord this assemBuf this currBytes this assemLen this assemLen if this currBytes this currSize throw new IOException currName this currBytes this currSize public void write int throws IOException this oneBuf byte this write this oneBuf public void write byte wBuf throws IOException this write wBuf wBuf length public void write byte wBuf int wOffset int numToWrite throws IOException if this currBytes numToWrite this currSize throw new IOException numToWrite this currSize currName if this assemLen if this assemLen numToWrite this recordBuf length int aLen this recordBuf length this assemLen System arraycopy this assemBuf this recordBuf this assemLen System arraycopy wBuf wOffset this recordBuf this assemLen aLen this buffer writeRecord this recordBuf this currBytes this recordBuf length wOffset aLen numToWrite aLen this assemLen else System arraycopy wBuf wOffset this assemBuf this assemLen numToWrite wOffset numToWrite this assemLen numToWrite numToWrite numToWrite while numToWrite if numToWrite this recordBuf length System arraycopy wBuf wOffset this assemBuf this assemLen numToWrite this assemLen numToWrite break this buffer writeRecord wBuf wOffset int num this recordBuf length this currBytes num numToWrite num wOffset num private void writeEOFRecord throws IOException for int this recordBuf length this recordBuf this buffer writeRecord this recordBuf public class Resources extends DataType implements ResourceCollection public static final ResourceCollection NONE new ResourceCollection public boolean isFilesystemOnly return true public Iterator iterator return EMPTY_ITERATOR public int size return public static final Iterator EMPTY_ITERATOR new Iterator public Object next throw new NoSuchElementException public boolean hasNext return false public void remove throw new UnsupportedOperationException private class MyCollection extends AbstractCollection private int size MyCollection size for Iterator rci getNested iterator rci hasNext size ResourceCollection rci next size public int size return size public Iterator iterator return new MyIterator private class MyIterator implements Iterator private Iterator rci getNested iterator private Iterator ri null public boolean hasNext boolean result ri null ri hasNext while result rci hasNext ri ResourceCollection rci next iterator result ri hasNext return result public Object next if hasNext throw new NoSuchElementException return ri next public void remove throw new UnsupportedOperationException private Vector rc private Collection coll public synchronized void add ResourceCollection if isReference throw noChildrenAllowed if null return if rc null rc new Vector rc add FailFast invalidate this coll null setChecked false public synchronized Iterator iterator if isReference return getRef iterator validate return new FailFast this coll iterator public synchronized int size if isReference return getRef size validate return coll size public boolean isFilesystemOnly if isReference return getRef isFilesystemOnly validate for Iterator getNested iterator hasNext if ResourceCollection next isFilesystemOnly return false return true public synchronized String toString if isReference return getCheckedRef toString if coll null coll isEmpty return StringBuffer sb new StringBuffer for Iterator coll iterator hasNext if sb length sb append File pathSeparatorChar sb append next return sb toString protected void dieOnCircularReference Stack stk Project throws BuildException if isChecked return if isReference super dieOnCircularReference stk else for Iterator getNested iterator hasNext Object next if instanceof DataType invokeCircularReferenceCheck DataType stk setChecked true private ResourceCollection getRef return ResourceCollection getCheckedRef ResourceCollection class private synchronized void validate dieOnCircularReference coll coll null new MyCollection coll private synchronized List getNested return rc null Collections EMPTY_LIST rc public class ScpFromMessage extends AbstractSshMessage private static final byte LINE_FEED private static final int BUFFER_SIZE private String remoteFile private File localFile private boolean isRecursive false public ScpFromMessage Session session super session public ScpFromMessage boolean verbose Session session super verbose session public ScpFromMessage boolean verbose Session session String aRemoteFile File aLocalFile boolean recursive super verbose session this remoteFile aRemoteFile this localFile aLocalFile this isRecursive recursive public ScpFromMessage Session session String aRemoteFile File aLocalFile boolean recursive this false session aRemoteFile aLocalFile recursive public void execute throws IOException JSchException String command if isRecursive command command remoteFile Channel channel openExecChannel command try OutputStream out channel getOutputStream InputStream in channel getInputStream channel connect sendAck out startRemoteCpProtocol in out localFile finally if channel null channel disconnect log private void startRemoteCpProtocol InputStream in OutputStream out File localFile throws IOException File startFile localFile while true ByteArrayOutputStream stream new ByteArrayOutputStream while true int read in read if read return if byte read LINE_FEED break stream write read String serverResponse stream toString if serverResponse charAt parseAndFetchFile serverResponse startFile out in else if serverResponse charAt startFile parseAndCreateDirectory serverResponse startFile sendAck out else if serverResponse charAt startFile startFile getParentFile sendAck out else if serverResponse charAt serverResponse charAt throw new IOException serverResponse substring private File parseAndCreateDirectory String serverResponse File localFile int start serverResponse indexOf start serverResponse indexOf start String directoryName serverResponse substring start if localFile isDirectory File dir new File localFile directoryName dir mkdir log dir return dir return null private void parseAndFetchFile String serverResponse File localFile OutputStream out InputStream in throws IOException int start int end serverResponse indexOf start start end end serverResponse indexOf start long filesize Long parseLong serverResponse substring start end String filename serverResponse substring end log filename filesize File transferFile localFile isDirectory new File localFile filename localFile fetchFile transferFile filesize out in waitForAck in sendAck out private void fetchFile File localFile long filesize OutputStream out InputStream in throws IOException byte buf new byte BUFFER_SIZE sendAck out FileOutputStream fos new FileOutputStream localFile int length long totalLength long startTime System currentTimeMillis boolean trackProgress getVerbose filesize long initFilesize filesize int percentTransmitted try while true length in read buf BUFFER_SIZE filesize BUFFER_SIZE int filesize if length throw new EOFException fos write buf length filesize length totalLength length if filesize break if trackProgress percentTransmitted trackProgress initFilesize totalLength percentTransmitted finally long endTime System currentTimeMillis logStats startTime endTime totalLength fos flush fos close public interface JUnitResultFormatter extends TestListener JUnitTaskMirror JUnitResultFormatterMirror void startTestSuite JUnitTest suite throws BuildException void endTestSuite JUnitTest suite throws BuildException void setOutput OutputStream out void setSystemOutput String out void setSystemError String err public class Ear extends Jar private static final FileUtils FILE_UTILS FileUtils getFileUtils private File deploymentDescriptor private boolean descriptorAdded public Ear super archiveType emptyBehavior public void setEarfile File earFile setDestFile earFile public void setAppxml File descr deploymentDescriptor descr if deploymentDescriptor exists throw new BuildException deploymentDescriptor ZipFileSet fs new ZipFileSet fs setFile deploymentDescriptor fs setFullpath super addFileset fs public void addArchives ZipFileSet fs fs setPrefix super addFileset fs protected void initZipOutputStream ZipOutputStream zOut throws IOException BuildException if deploymentDescriptor null isInUpdateMode throw new BuildException getLocation super initZipOutputStream zOut protected void zipFile File file ZipOutputStream zOut String vPath int mode throws IOException if vPath equalsIgnoreCase if deploymentDescriptor null FILE_UTILS fileNameEquals deploymentDescriptor file descriptorAdded log archiveType archiveType Project MSG_WARN else super zipFile file zOut vPath mode descriptorAdded true else super zipFile file zOut vPath mode protected void cleanUp descriptorAdded false super cleanUp public interface Tokenizer String getToken Reader in throws IOException String getPostToken public class Rmic extends MatchingTask public static final String ERROR_RMIC_FAILED private File baseDir private String classname private File sourceBase private String stubVersion private Path compileClasspath private Path extDirs private boolean verify false private boolean filtering false private boolean iiop false private String iiopOpts private boolean idl false private String idlOpts private boolean debug false private boolean includeAntRuntime true private boolean includeJavaRuntime false private Vector compileList new Vector private ClassLoader loader null private FacadeTaskHelper facade public static final String ERROR_UNABLE_TO_VERIFY_CLASS public static final String ERROR_NOT_FOUND public static final String ERROR_NOT_DEFINED public static final String ERROR_LOADING_CAUSED_EXCEPTION public static final String ERROR_NO_BASE_EXISTS public static final String ERROR_NOT_A_DIR public static final String ERROR_BASE_NOT_SET private static final FileUtils FILE_UTILS FileUtils getFileUtils public Rmic facade new FacadeTaskHelper RmicAdapterFactory DEFAULT_COMPILER public void setBase File base this baseDir base public File getBase return this baseDir public void setClassname String classname this classname classname public String getClassname return classname public void setSourceBase File sourceBase this sourceBase sourceBase public File getSourceBase return sourceBase public void setStubVersion String stubVersion this stubVersion stubVersion public String getStubVersion return stubVersion public void setFiltering boolean filter this filtering filter public boolean getFiltering return filtering public void setDebug boolean debug this debug debug public boolean getDebug return debug public void setClasspath Path classpath if compileClasspath null compileClasspath classpath else compileClasspath append classpath public Path createClasspath if compileClasspath null compileClasspath new Path getProject return compileClasspath createPath public void setClasspathRef Reference pathRef createClasspath setRefid pathRef public Path getClasspath return compileClasspath public void setVerify boolean verify this verify verify public boolean getVerify return verify public void setIiop boolean iiop this iiop iiop public boolean getIiop return iiop public void setIiopopts String iiopOpts this iiopOpts iiopOpts public String getIiopopts return iiopOpts public void setIdl boolean idl this idl idl public boolean getIdl return idl public void setIdlopts String idlOpts this idlOpts idlOpts public String getIdlopts return idlOpts public Vector getFileList return compileList public void setIncludeantruntime boolean include includeAntRuntime include public boolean getIncludeantruntime return includeAntRuntime public void setIncludejavaruntime boolean include includeJavaRuntime include public boolean getIncludejavaruntime return includeJavaRuntime public void setExtdirs Path extDirs if this extDirs null this extDirs extDirs else this extDirs append extDirs public Path createExtdirs if extDirs null extDirs new Path getProject return extDirs createPath public Path getExtdirs return extDirs public Vector getCompileList return compileList public void setCompiler String compiler if compiler length facade setImplementation compiler public String getCompiler facade setMagicValue getProject getProperty return facade getImplementation public ImplementationSpecificArgument createCompilerArg ImplementationSpecificArgument arg new ImplementationSpecificArgument facade addImplementationArgument arg return arg public String getCurrentCompilerArgs getCompiler return facade getArgs public void execute throws BuildException if baseDir null throw new BuildException ERROR_BASE_NOT_SET getLocation if baseDir exists throw new BuildException ERROR_NO_BASE_EXISTS baseDir getLocation if baseDir isDirectory throw new BuildException ERROR_NOT_A_DIR baseDir getLocation if verify log Project MSG_VERBOSE RmicAdapter adapter RmicAdapterFactory getRmic getCompiler this adapter setRmic this Path classpath adapter getClasspath loader getProject createClassLoader classpath try if classname null DirectoryScanner ds this getDirectoryScanner baseDir String files ds getIncludedFiles scanDir baseDir files adapter getMapper else scanDir baseDir new String classname replace File separatorChar adapter getMapper int fileCount compileList size if fileCount log fileCount fileCount baseDir Project MSG_INFO if adapter execute throw new BuildException ERROR_RMIC_FAILED getLocation if null sourceBase baseDir equals sourceBase fileCount if idl log Project MSG_WARN log Project MSG_WARN else for int fileCount moveGeneratedFile baseDir sourceBase String compileList elementAt adapter finally compileList removeAllElements private void moveGeneratedFile File baseDir File sourceBaseFile String classname RmicAdapter adapter throws BuildException String classFileName classname replace File separatorChar String generatedFiles adapter getMapper mapFileName classFileName for int generatedFiles length final String generatedFile generatedFiles if generatedFile endsWith continue final int pos generatedFile length length String sourceFileName generatedFile substring pos File oldFile new File baseDir sourceFileName if oldFile exists continue File newFile new File sourceBaseFile sourceFileName try if filtering FILE_UTILS copyFile oldFile newFile new FilterSetCollection getProject getGlobalFilterSet else FILE_UTILS copyFile oldFile newFile oldFile delete catch IOException ioe String msg oldFile newFile ioe getMessage throw new BuildException msg ioe getLocation protected void scanDir File baseDir String files FileNameMapper mapper String newFiles files if idl log Project MSG_VERBOSE else if iiop iiopOpts null iiopOpts indexOf log Project MSG_VERBOSE else SourceFileScanner sfs new SourceFileScanner this newFiles sfs restrict files baseDir baseDir mapper for int newFiles length String name newFiles replace File separatorChar name name substring name lastIndexOf compileList addElement name public boolean isValidRmiRemote String classname try Class testClass loader loadClass classname if testClass isInterface iiop idl return false return isValidRmiRemote testClass catch ClassNotFoundException log ERROR_UNABLE_TO_VERIFY_CLASS classname ERROR_NOT_FOUND Project MSG_WARN catch NoClassDefFoundError log ERROR_UNABLE_TO_VERIFY_CLASS classname ERROR_NOT_DEFINED Project MSG_WARN catch Throwable log ERROR_UNABLE_TO_VERIFY_CLASS classname ERROR_LOADING_CAUSED_EXCEPTION getMessage Project MSG_WARN return false public Class getRemoteInterface Class testClass if Remote class isAssignableFrom testClass Class interfaces testClass getInterfaces if interfaces null for int interfaces length if Remote class isAssignableFrom interfaces return interfaces return null private boolean isValidRmiRemote Class testClass return getRemoteInterface testClass null public ClassLoader getLoader return loader public class ImplementationSpecificArgument extends org apache tools ant util facade ImplementationSpecificArgument public void setCompiler String impl super setImplementation impl public class DefaultInputHandler implements InputHandler public DefaultInputHandler public void handleInput InputRequest request throws BuildException String prompt getPrompt request BufferedReader null try new BufferedReader new InputStreamReader getInputStream do System err println prompt System err flush try String input readLine request setInput input catch IOException throw new BuildException while request isInputValid finally if null try close catch IOException throw new BuildException protected String getPrompt InputRequest request String prompt request getPrompt String def request getDefaultValue if request instanceof MultipleChoiceInputRequest StringBuffer sb new StringBuffer prompt sb append Enumeration MultipleChoiceInputRequest request getChoices elements boolean first true while hasMoreElements if first sb append String next String nextElement if next equals def sb append sb append next if next equals def sb append first false sb append return sb toString else if def null return prompt def else return prompt protected InputStream getInputStream return System in public class RegexpPatternMapper implements FileNameMapper protected RegexpMatcher reg null protected char to null protected StringBuffer result new StringBuffer public RegexpPatternMapper throws BuildException reg new RegexpMatcherFactory newRegexpMatcher private boolean handleDirSep false private int regexpOptions public void setHandleDirSep boolean handleDirSep this handleDirSep handleDirSep public void setCaseSensitive boolean caseSensitive if caseSensitive regexpOptions RegexpMatcher MATCH_CASE_INSENSITIVE else regexpOptions public void setFrom String from throws BuildException try reg setPattern from catch NoClassDefFoundError throw new BuildException public void setTo String to this to to toCharArray public String mapFileName String sourceFileName if handleDirSep if sourceFileName indexOf sourceFileName sourceFileName replace if reg null to null reg matches sourceFileName regexpOptions return null return new String replaceReferences sourceFileName protected String replaceReferences String source Vector reg getGroups source regexpOptions result setLength for int to length if to if to length int value Character digit to if value result append String elementAt value else result append to else result append else result append to return result substring public class CCMCheckinDefault extends CCMCheck public CCMCheckinDefault super setCcmAction COMMAND_CHECKIN setTask DEFAULT_TASK public static final String DEFAULT_TASK public interface Condition boolean eval throws BuildException public class Chgrp extends AbstractAccessTask private boolean haveGroup false public Chgrp super setExecutable public void setGroup String group createArg setValue group haveGroup true protected void checkConfiguration if haveGroup throw new BuildException getLocation super checkConfiguration public void setExecutable String throw new BuildException getTaskType getLocation public interface XSLTLiaison2 extends XSLTLiaison void configure XSLTProcess xsltTask public interface XSLTLiaison3 extends XSLTLiaison2 void setStylesheet Resource stylesheet throws Exception public interface RmicAdapter void setRmic Rmic attributes boolean execute throws BuildException FileNameMapper getMapper Path getClasspath public class ProxyDiagnostics private String destination private URI destURI public ProxyDiagnostics String destination this destination destination try this destURI new URI destination catch URISyntaxException throw new BuildException public ProxyDiagnostics this DEFAULT_DESTINATION public String toString ProxySelector selector ProxySelector getDefault List list selector select destURI StringBuffer result new StringBuffer Iterator proxies list listIterator while proxies hasNext Proxy proxy Proxy proxies next SocketAddress address proxy address if address null result append else result append proxy toString if address instanceof InetSocketAddress InetSocketAddress ina InetSocketAddress address result append result append ina getHostName result append result append ina getPort if ina isUnresolved result append else InetAddress addr ina getAddress result append result append addr getHostAddress result append result append return result toString public class Xor extends ConditionBase implements Condition public boolean eval throws BuildException Enumeration getConditions boolean state false while hasMoreElements Condition Condition nextElement state eval return state public class FlatFileNameMapper implements FileNameMapper public void setFrom String from public void setTo String to public String mapFileName String sourceFileName return new String new java io File sourceFileName getName public final class JavaClassHelper private static final String LS System getProperty public static StringBuffer getConstants byte bytes throws IOException final StringBuffer sb new StringBuffer final ByteArrayInputStream bis new ByteArrayInputStream bytes final ClassParser parser new ClassParser bis final JavaClass javaClass parser parse final Field fields javaClass getFields for int fields length final Field field fields if field null final ConstantValue cv field getConstantValue if cv null String cvs cv toString if cvs startsWith cvs endsWith cvs cvs substring cvs length sb append field getName sb append sb append cvs sb append LS return sb public class InnerClassFilenameFilter implements FilenameFilter private String baseClassName InnerClassFilenameFilter String baseclass int extidx baseclass lastIndexOf if extidx extidx baseclass length baseClassName baseclass substring extidx public boolean accept File dir String filename if filename lastIndexOf filename lastIndexOf filename indexOf baseClassName return false return true public class Compare extends DataType implements ResourceSelector private static final String ONE_CONTROL_MESSAGE private DelegatedResourceComparator comp new DelegatedResourceComparator private Quantifier against Quantifier ALL private Comparison when Comparison EQUAL private Union control public synchronized void add ResourceComparator if isReference throw noChildrenAllowed comp add public synchronized void setAgainst Quantifier against if isReference throw tooManyAttributes this against against public synchronized void setWhen Comparison when if isReference throw tooManyAttributes this when when public synchronized ResourceCollection createControl if isReference throw noChildrenAllowed if control null throw oneControl control new Union return control public synchronized boolean isSelected Resource if isReference return ResourceSelector getCheckedRef isSelected if control null throw oneControl int for Iterator it control iterator it hasNext if when evaluate comp compare Resource it next else return against evaluate protected synchronized void dieOnCircularReference Stack stk Project throws BuildException if isChecked return if isReference super dieOnCircularReference stk else if control null DataType invokeCircularReferenceCheck control stk DataType invokeCircularReferenceCheck comp stk setChecked true private BuildException oneControl return new BuildException super toString ONE_CONTROL_MESSAGE public class FloatCPInfo extends ConstantCPInfo public FloatCPInfo super CONSTANT_FLOAT public void read DataInputStream cpStream throws IOException setValue new Float cpStream readFloat public String toString return getValue public interface FileNameMapper void setFrom String from void setTo String to String mapFileName String sourceFileName public class P4Counter extends P4Base public String counter null public String property null public boolean shouldSetValue false public boolean shouldSetProperty false public int value public void setName String counter this counter counter public void setValue int value this value value shouldSetValue true public void setProperty String property this property property shouldSetProperty true public void execute throws BuildException if counter null counter length throw new BuildException if shouldSetValue shouldSetProperty throw new BuildException String command P4CmdOpts counter if shouldSetProperty command command if shouldSetValue command value if shouldSetProperty final Project myProj getProject P4Handler handler new P4HandlerAdapter public void process String line log line Project MSG_VERBOSE try value Integer parseInt line myProj setProperty property value catch NumberFormatException nfe throw new BuildException execP4Command command handler else execP4Command command new SimpleP4OutputHandler this public class ImmutableResourceException extends IOException public ImmutableResourceException super public ImmutableResourceException String super public class BorlandGenerateClient extends Task static final String JAVA_MODE static final String FORK_MODE boolean debug false File ejbjarfile null File clientjarfile null Path classpath String mode FORK_MODE int version BorlandDeploymentTool BAS public void setVersion int version this version version public void setMode String mode public void setDebug boolean debug this debug debug public void setEjbjar File ejbfile ejbjarfile ejbfile public void setClientjar File clientjar clientjarfile clientjar public void setClasspath Path classpath if this classpath null this classpath classpath else this classpath append classpath public Path createClasspath if this classpath null this classpath new Path getProject return this classpath createPath public void setClasspathRef Reference createClasspath setRefid public void execute throws BuildException if ejbjarfile null ejbjarfile isDirectory throw new BuildException if clientjarfile null clientjarfile isDirectory log Project MSG_VERBOSE String ejbjarname ejbjarfile getAbsolutePath String clientname ejbjarname substring ejbjarname lastIndexOf clientname clientname clientjarfile new File clientname if mode null log setMode JAVA_MODE if version BorlandDeploymentTool BES version BorlandDeploymentTool BAS throw new BuildException version log clientjarfile if mode equalsIgnoreCase FORK_MODE executeFork else executeJava protected void executeJava throws BuildException try if version BorlandDeploymentTool BES throw new BuildException BorlandDeploymentTool BAS log Java execTask null execTask new Java this execTask setDir new File execTask setClassname execTask setClasspath classpath concatSystemClasspath execTask setFork true execTask createArg setValue if debug execTask createArg setValue execTask createArg setValue execTask createArg setValue execTask createArg setValue ejbjarfile getAbsolutePath execTask createArg setValue execTask createArg setValue execTask createArg setValue clientjarfile getAbsolutePath log Project MSG_VERBOSE execTask execute catch Exception String msg toString throw new BuildException msg protected void executeFork throws BuildException if version BorlandDeploymentTool BAS executeForkV4 if version BorlandDeploymentTool BES executeForkV5 protected void executeForkV4 throws BuildException try log BorlandDeploymentTool BAS Project MSG_DEBUG ExecTask execTask new ExecTask this execTask setDir new File execTask setExecutable execTask createArg setValue if debug execTask createArg setValue execTask createArg setValue execTask createArg setValue execTask createArg setValue ejbjarfile getAbsolutePath execTask createArg setValue execTask createArg setValue execTask createArg setValue clientjarfile getAbsolutePath log Project MSG_VERBOSE execTask execute catch Exception String msg toString throw new BuildException msg protected void executeForkV5 throws BuildException try log BorlandDeploymentTool BES Project MSG_DEBUG ExecTask execTask new ExecTask this execTask setDir new File execTask setExecutable if debug execTask createArg setValue execTask createArg setValue execTask createArg setValue execTask createArg setValue ejbjarfile getAbsolutePath execTask createArg setValue execTask createArg setValue clientjarfile getAbsolutePath execTask createArg setValue execTask createArg setValue classpath toString log Project MSG_VERBOSE execTask execute catch Exception String msg toString throw new BuildException msg public class NoExitSecurityManager extends SecurityManager public void checkExit int status throw new ExitException status public void checkPermission Permission perm public final class ChainReaderHelper private static final int DEFAULT_BUFFER_SIZE public Reader primaryReader public int bufferSize DEFAULT_BUFFER_SIZE public Vector filterChains new Vector private Project project null public void setPrimaryReader Reader rdr primaryReader rdr public void setProject final Project project this project project public Project getProject return project public void setBufferSize int size bufferSize size public void setFilterChains Vector fchain filterChains fchain public Reader getAssembledReader throws BuildException if primaryReader null throw new BuildException Reader instream primaryReader final int filterReadersCount filterChains size final Vector finalFilters new Vector for int filterReadersCount final FilterChain filterchain FilterChain filterChains elementAt final Vector filterReaders filterchain getFilterReaders final int readerCount filterReaders size for int readerCount finalFilters addElement filterReaders elementAt final int filtersCount finalFilters size if filtersCount for int filtersCount Object finalFilters elementAt if instanceof AntFilterReader final AntFilterReader filter AntFilterReader finalFilters elementAt final String className filter getClassName final Path classpath filter getClasspath final Project pro filter getProject if className null try Class clazz null if classpath null clazz Class forName className else AntClassLoader al pro createClassLoader classpath clazz Class forName className true al if clazz null if FilterReader class isAssignableFrom clazz throw new BuildException className final Constructor constructors clazz getConstructors int boolean consPresent false for constructors length Class types constructors getParameterTypes if types length types isAssignableFrom Reader class consPresent true break if consPresent throw new BuildException className final Reader rdr instream instream Reader constructors newInstance Object rdr setProjectOnObject instream if Parameterizable class isAssignableFrom clazz final Parameter params filter getParams Parameterizable instream setParameters params catch final ClassNotFoundException cnfe throw new BuildException cnfe catch final InstantiationException ie throw new BuildException ie catch final IllegalAccessException iae throw new BuildException iae catch final InvocationTargetException ite throw new BuildException ite else if instanceof ChainableReader setProjectOnObject instream ChainableReader chain instream setProjectOnObject instream return instream private void setProjectOnObject Object obj if project null return if obj instanceof BaseFilterReader BaseFilterReader obj setProject project return project setProjectReference obj public String readFully Reader rdr throws IOException return FileUtils readFully rdr bufferSize public class ManifestException extends Exception public ManifestException String msg super msg public class ExecuteWatchdog implements TimeoutObserver private Process process private volatile boolean watch false private Exception caught null private volatile boolean killedProcess false private Watchdog watchdog public ExecuteWatchdog long timeout watchdog new Watchdog timeout watchdog addTimeoutObserver this public ExecuteWatchdog int timeout this long timeout public synchronized void start Process process if process null throw new NullPointerException if this process null throw new IllegalStateException this caught null this killedProcess false this watch true this process process watchdog start public synchronized void stop watchdog stop cleanUp public synchronized void timeoutOccured Watchdog try try process exitValue catch IllegalThreadStateException itse if watch killedProcess true process destroy catch Exception caught finally cleanUp protected synchronized void cleanUp watch false process null public synchronized void checkException throws BuildException if caught null throw new BuildException caught getMessage caught public boolean isWatching return watch public boolean killedProcess return killedProcess public class TeeOutputStream extends OutputStream private OutputStream left private OutputStream right public TeeOutputStream OutputStream left OutputStream right this left left this right right public void close throws IOException try left close finally right close public void flush throws IOException left flush right flush public void write byte throws IOException left write right write public void write byte int off int len throws IOException left write off len right write off len public void write int throws IOException left write right write public interface P4Handler extends ExecuteStreamHandler void process String line throws BuildException void setOutput String line throws BuildException public class CCMkattr extends ClearCase private boolean mReplace false private boolean mRecurse false private String mVersion null private String mTypeName null private String mTypeValue null private String mComment null private String mCfile null public void execute throws BuildException Commandline commandLine new Commandline Project aProj getProject int result if getTypeName null throw new BuildException if getTypeValue null throw new BuildException if getViewPath null setViewPath aProj getBaseDir getPath commandLine setExecutable getClearToolCommand commandLine createArgument setValue COMMAND_MKATTR checkOptions commandLine if getFailOnErr getProject log getViewPathBasename Project MSG_VERBOSE result run commandLine if Execute isFailure result getFailOnErr String msg commandLine toString throw new BuildException msg getLocation private void checkOptions Commandline cmd if getReplace cmd createArgument setValue FLAG_REPLACE if getRecurse cmd createArgument setValue FLAG_RECURSE if getVersion null getVersionCommand cmd if getComment null getCommentCommand cmd else if getCommentFile null getCommentFileCommand cmd else cmd createArgument setValue FLAG_NOCOMMENT if getTypeName null getTypeCommand cmd if getTypeValue null getTypeValueCommand cmd cmd createArgument setValue getViewPath public void setReplace boolean replace mReplace replace public boolean getReplace return mReplace public void setRecurse boolean recurse mRecurse recurse public boolean getRecurse return mRecurse public void setVersion String version mVersion version public String getVersion return mVersion public void setComment String comment mComment comment public String getComment return mComment public void setCommentFile String cfile mCfile cfile public String getCommentFile return mCfile public void setTypeName String tn mTypeName tn public String getTypeName return mTypeName public void setTypeValue String tv mTypeValue tv public String getTypeValue return mTypeValue private void getVersionCommand Commandline cmd if getVersion null cmd createArgument setValue FLAG_VERSION cmd createArgument setValue getVersion private void getCommentCommand Commandline cmd if getComment null cmd createArgument setValue FLAG_COMMENT cmd createArgument setValue getComment private void getCommentFileCommand Commandline cmd if getCommentFile null cmd createArgument setValue FLAG_COMMENTFILE cmd createArgument setValue getCommentFile private void getTypeCommand Commandline cmd String typenm getTypeName if typenm null cmd createArgument setValue typenm private void getTypeValueCommand Commandline cmd String typevl getTypeValue if typevl null if Os isFamily else typevl typevl cmd createArgument setValue typevl public static final String FLAG_REPLACE public static final String FLAG_RECURSE public static final String FLAG_VERSION public static final String FLAG_COMMENT public static final String FLAG_COMMENTFILE public static final String FLAG_NOCOMMENT public class RegexpFactory extends RegexpMatcherFactory public RegexpFactory public Regexp newRegexp throws BuildException return Regexp newRegexp null public Regexp newRegexp Project throws BuildException String systemDefault null if null systemDefault System getProperty else systemDefault getProperty if systemDefault null return createRegexpInstance systemDefault Throwable cause null try testAvailability return createRegexpInstance catch BuildException be cause orCause cause be JavaEnvUtils getJavaVersionNumber try testAvailability return createRegexpInstance catch BuildException be cause orCause cause be true try testAvailability return createRegexpInstance catch BuildException be cause orCause cause be true throw new BuildException cause null cause cause protected Regexp createRegexpInstance String classname throws BuildException RegexpMatcher createInstance classname if instanceof Regexp return Regexp else throw new BuildException classname public class LibFileSet extends FileSet private boolean includeURL private boolean includeImpl private String urlBase public void setIncludeUrl boolean includeURL this includeURL includeURL public void setIncludeImpl boolean includeImpl this includeImpl includeImpl public void setUrlBase String urlBase this urlBase urlBase boolean isIncludeURL return includeURL boolean isIncludeImpl return includeImpl String getUrlBase return urlBase public final class Compatibility private final String name Compatibility final String name this name name public String toString return name public class StringResource extends Resource private static final int STRING_MAGIC Resource getMagicNumber getBytes private String encoding null public StringResource public StringResource String value setValue value public synchronized void setName String if getName null throw new BuildException new ImmutableResourceException super setName public synchronized void setValue String setName public synchronized String getName return super getName public synchronized String getValue return getName public synchronized void setEncoding String encoding public synchronized String getEncoding return encoding public synchronized long getSize return isReference Resource getCheckedRef getSize long getContent length public synchronized int hashCode if isReference return getCheckedRef hashCode return super hashCode STRING_MAGIC public String toString if isReference return getCheckedRef toString return String valueOf getContent public synchronized InputStream getInputStream throws IOException if isReference return Resource getCheckedRef getInputStream return new ByteArrayInputStream getContent getBytes public synchronized OutputStream getOutputStream throws IOException if isReference return Resource getCheckedRef getOutputStream if getValue null throw new ImmutableResourceException final ByteArrayOutputStream baos new ByteArrayOutputStream return new FilterOutputStream baos public void close throws IOException super close StringResource this setValue encoding null baos toString baos toString encoding public void setRefid Reference if encoding null throw tooManyAttributes super setRefid protected synchronized String getContent if isReference return StringResource getCheckedRef getContent String value getValue if value null return value return getProject null value getProject replaceProperties value public class TokenFilter extends BaseFilterReader implements ChainableReader public interface Filter String filter String string private Vector filters new Vector private Tokenizer tokenizer null private String delimOutput null private String line null private int linePos public TokenFilter super public TokenFilter final Reader in super in public int read throws IOException if tokenizer null tokenizer new LineTokenizer while line null line length line tokenizer getToken in if line null return for Enumeration filters elements hasMoreElements Filter filter Filter nextElement line filter filter line if line null break linePos if line null if tokenizer getPostToken length if delimOutput null line line delimOutput else line line tokenizer getPostToken int ch line charAt linePos linePos if linePos line length line null return ch public final Reader chain final Reader reader TokenFilter newFilter new TokenFilter reader newFilter filters filters newFilter tokenizer tokenizer newFilter delimOutput delimOutput newFilter setProject getProject return newFilter public void setDelimOutput String delimOutput this delimOutput resolveBackSlash delimOutput public void addLineTokenizer LineTokenizer tokenizer add tokenizer public void addStringTokenizer StringTokenizer tokenizer add tokenizer public void addFileTokenizer FileTokenizer tokenizer add tokenizer public void add Tokenizer tokenizer if this tokenizer null throw new BuildException this tokenizer tokenizer public void addReplaceString ReplaceString filter filters addElement filter public void addContainsString ContainsString filter filters addElement filter public void addReplaceRegex ReplaceRegex filter filters addElement filter public void addContainsRegex ContainsRegex filter filters addElement filter public void addTrim Trim filter filters addElement filter public void addIgnoreBlank IgnoreBlank filter filters addElement filter public void addDeleteCharacters DeleteCharacters filter filters addElement filter public void add Filter filter filters addElement filter public static class FileTokenizer extends org apache tools ant util FileTokenizer public static class StringTokenizer extends org apache tools ant util StringTokenizer public abstract static class ChainableReaderFilter extends ProjectComponent implements ChainableReader Filter private boolean byLine true public void setByLine boolean byLine this byLine byLine public Reader chain Reader reader TokenFilter tokenFilter new TokenFilter reader if byLine tokenFilter add new FileTokenizer tokenFilter add this return tokenFilter public static class ReplaceString extends ChainableReaderFilter private String from private String to public void setFrom String from this from from public void setTo String to this to to public String filter String line if from null throw new BuildException StringBuffer ret new StringBuffer int start int found line indexOf from while found if found start ret append line substring start found if to null ret append to start found from length found line indexOf from start if line length start ret append line substring start line length return ret toString public static class ContainsString extends ProjectComponent implements Filter private String contains public void setContains String contains this contains contains public String filter String string if contains null throw new BuildException if string indexOf contains return string return null public static class ReplaceRegex extends ChainableReaderFilter private String from private String to private RegularExpression regularExpression private Substitution substitution private boolean initialized false private String flags private int options private Regexp regexp public void setPattern String from this from from public void setReplace String to this to to public void setFlags String flags this flags flags private void initialize if initialized return options convertRegexOptions flags if from null throw new BuildException regularExpression new RegularExpression regularExpression setPattern from regexp regularExpression getRegexp getProject if to null to substitution new Substitution substitution setExpression to public String filter String line initialize if regexp matches line options return line return regexp substitute line substitution getExpression getProject options public static class ContainsRegex extends ChainableReaderFilter private String from private String to private RegularExpression regularExpression private Substitution substitution private boolean initialized false private String flags private int options private Regexp regexp public void setPattern String from this from from public void setReplace String to this to to public void setFlags String flags this flags flags private void initialize if initialized return options convertRegexOptions flags if from null throw new BuildException regularExpression new RegularExpression regularExpression setPattern from regexp regularExpression getRegexp getProject if to null return substitution new Substitution substitution setExpression to public String filter String string initialize if regexp matches string options return null if substitution null return string return regexp substitute string substitution getExpression getProject options public static class Trim extends ChainableReaderFilter public String filter String line return line trim public static class IgnoreBlank extends ChainableReaderFilter public String filter String line if line trim length return null return line public static class DeleteCharacters extends ProjectComponent implements Filter ChainableReader private String deleteChars public void setChars String deleteChars this deleteChars resolveBackSlash deleteChars public String filter String string StringBuffer output new StringBuffer string length for int string length char ch string charAt if isDeleteCharacter ch output append ch return output toString public Reader chain Reader reader return new BaseFilterReader reader public int read throws IOException while true int in read if return if isDeleteCharacter char return private boolean isDeleteCharacter char for int deleteChars length if deleteChars charAt return true return false public static String resolveBackSlash String input return StringUtils resolveBackSlash input public static int convertRegexOptions String flags if flags null return int options if flags indexOf options Regexp REPLACE_ALL if flags indexOf options Regexp MATCH_CASE_INSENSITIVE if flags indexOf options Regexp MATCH_MULTILINE if flags indexOf options Regexp MATCH_SINGLELINE return options public class OutputStreamFunneler public static final long DEFAULT_TIMEOUT_MILLIS private final class Funnel extends OutputStream private boolean closed false private Funnel synchronized OutputStreamFunneler this count public void flush throws IOException synchronized OutputStreamFunneler this dieIfClosed out flush public void write int throws IOException synchronized OutputStreamFunneler this dieIfClosed out write public void write byte throws IOException synchronized OutputStreamFunneler this dieIfClosed out write public void write byte int off int len throws IOException synchronized OutputStreamFunneler this dieIfClosed out write off len public void close throws IOException release this private OutputStream out private int count private boolean closed private long timeoutMillis public OutputStreamFunneler OutputStream out this out DEFAULT_TIMEOUT_MILLIS public OutputStreamFunneler OutputStream out long timeoutMillis if out null throw new IllegalArgumentException this out out setTimeout timeoutMillis public synchronized void setTimeout long timeoutMillis this timeoutMillis timeoutMillis public synchronized OutputStream getFunnelInstance throws IOException dieIfClosed try return new Funnel finally notifyAll private synchronized void release Funnel funnel throws IOException if funnel closed try if timeoutMillis try wait timeoutMillis catch InterruptedException eyeEx if count close finally funnel closed true private synchronized void close throws IOException try dieIfClosed out close finally closed true private synchronized void dieIfClosed throws IOException if closed throw new IOException public class SubAnt extends Task private Path buildpath private Ant ant null private String subTarget null private String antfile private File genericantfile null private boolean verbose false private boolean inheritAll false private boolean inheritRefs false private boolean failOnError true private String output null private Vector properties new Vector private Vector references new Vector private Vector propertySets new Vector public void handleOutput String output if ant null ant handleOutput output else super handleOutput output public int handleInput byte buffer int offset int length throws IOException if ant null return ant handleInput buffer offset length else return super handleInput buffer offset length public void handleFlush String output if ant null ant handleFlush output else super handleFlush output public void handleErrorOutput String output if ant null ant handleErrorOutput output else super handleErrorOutput output public void handleErrorFlush String output if ant null ant handleErrorFlush output else super handleErrorFlush output public void execute if buildpath null throw new BuildException final String filenames buildpath list final int count filenames length if count log Project MSG_WARN return BuildException buildException null for int count File file null String subdirPath null Throwable thrownException null try File directory null file new File filenames if file isDirectory if verbose subdirPath file getPath log subdirPath Project MSG_INFO if genericantfile null directory file file genericantfile else file new File file antfile execute file directory if verbose subdirPath null log subdirPath Project MSG_INFO catch RuntimeException ex if getProject isKeepGoingMode if verbose subdirPath null log subdirPath Project MSG_INFO thrownException ex catch Throwable ex if getProject isKeepGoingMode if verbose subdirPath null log subdirPath Project MSG_INFO throw new BuildException ex thrownException ex if thrownException null if thrownException instanceof BuildException log file thrownException getMessage Project MSG_ERR if buildException null buildException BuildException thrownException else log file thrownException getMessage Project MSG_ERR thrownException printStackTrace System err if buildException null buildException new BuildException thrownException if verbose subdirPath null log subdirPath Project MSG_INFO if buildException null throw buildException private void execute File file File directory throws BuildException if file exists file isDirectory file canRead String msg file if failOnError throw new BuildException msg log msg Project MSG_WARN return ant createAntTask directory String antfilename file getAbsolutePath ant setAntfile antfilename for int targets size TargetElement targetElement TargetElement targets get ant addConfiguredTarget targetElement try ant execute catch BuildException if failOnError throw log subTarget antfilename getMessage Project MSG_WARN catch Throwable if failOnError throw new BuildException log subTarget antfilename toString Project MSG_WARN finally ant null public void setAntfile String antfile this antfile antfile public void setGenericAntfile File afile this genericantfile afile public void setFailonerror boolean failOnError this failOnError failOnError public void setTarget String target this subTarget target public void addConfiguredTarget TargetElement String name getName if equals name throw new BuildException targets add public void setVerbose boolean on this verbose on public void setOutput String this output public void setInheritall boolean this inheritAll public void setInheritrefs boolean this inheritRefs public void addProperty Property properties addElement public void addReference Ant Reference references addElement public void addPropertyset PropertySet ps propertySets addElement ps public void addDirset DirSet set add set public void addFileset FileSet set add set public void addFilelist FileList list add list public void add ResourceCollection rc getBuildpath add rc public void setBuildpath Path getBuildpath append public Path createBuildpath return getBuildpath createPath public Path PathElement createBuildpathElement return getBuildpath createPathElement private Path getBuildpath if buildpath null buildpath new Path getProject return buildpath public void setBuildpathRef Reference createBuildpath setRefid private Ant createAntTask File directory Ant antTask new Ant this antTask init if subTarget null subTarget length antTask setTarget subTarget if output null antTask setOutput output if directory null antTask setDir directory antTask setInheritAll inheritAll for Enumeration properties elements hasMoreElements copyProperty antTask createProperty Property nextElement for Enumeration propertySets elements hasMoreElements antTask addPropertyset PropertySet nextElement antTask setInheritRefs inheritRefs for Enumeration references elements hasMoreElements antTask addReference Ant Reference nextElement return antTask private static void copyProperty Property to Property from to setName from getName if from getValue null to setValue from getValue if from getFile null to setFile from getFile if from getResource null to setResource from getResource if from getPrefix null to setPrefix from getPrefix if from getRefid null to setRefid from getRefid if from getEnvironment null to setEnvironment from getEnvironment if from getClasspath null to setClasspath from getClasspath public class DependScanner extends DirectoryScanner public static final String DEFAULT_ANALYZER_CLASS private Vector rootClasses private Vector included private DirectoryScanner parentScanner public DependScanner DirectoryScanner parentScanner this parentScanner parentScanner public synchronized void setRootClasses Vector rootClasses this rootClasses rootClasses public String getIncludedFiles String files new String getIncludedFilesCount for int files length files String included elementAt return files public synchronized int getIncludedFilesCount if included null throw new IllegalStateException return included size public synchronized void scan throws IllegalStateException included new Vector String analyzerClassName DEFAULT_ANALYZER_CLASS DependencyAnalyzer analyzer null try Class analyzerClass Class forName analyzerClassName analyzer DependencyAnalyzer analyzerClass newInstance catch Exception throw new BuildException analyzerClassName analyzer addClassPath new Path null basedir getPath for Enumeration rootClasses elements hasMoreElements String rootClass String nextElement analyzer addRootClass rootClass Enumeration analyzer getClassDependencies String parentFiles parentScanner getIncludedFiles Hashtable parentSet new Hashtable for int parentFiles length parentSet put parentFiles parentFiles while hasMoreElements String classname String nextElement String filename classname replace File separatorChar filename filename File depFile new File basedir filename if depFile exists parentSet containsKey filename included addElement filename public void addDefaultExcludes public String getExcludedDirectories return null public String getExcludedFiles return null public String getIncludedDirectories return new String public int getIncludedDirsCount return public String getNotIncludedDirectories return null public String getNotIncludedFiles return null public void setExcludes String excludes public void setIncludes String includes public void setCaseSensitive boolean isCaseSensitive public interface AntMain void startAnt String args Properties additionalUserProperties ClassLoader coreLoader public class Ant extends Task private static final FileUtils FILE_UTILS FileUtils getFileUtils private File dir null private String antFile null private String output null private boolean inheritAll true private boolean inheritRefs false private Vector properties new Vector private Vector references new Vector private Project newProject private PrintStream out null private Vector propertySets new Vector private Vector targets new Vector private boolean targetAttributeSet false public Ant public Ant Task owner bindToOwner owner public void setInheritAll boolean value inheritAll value public void setInheritRefs boolean value inheritRefs value public void init newProject getProject createSubProject newProject setJavaVersionProperty private void reinit init private void initializeProject newProject setInputHandler getProject getInputHandler Iterator iter getBuildListeners while iter hasNext newProject addBuildListener BuildListener iter next if output null File outfile null if dir null outfile FILE_UTILS resolveFile dir output else outfile getProject resolveFile output try out new PrintStream new FileOutputStream outfile DefaultLogger logger new DefaultLogger logger setMessageOutputLevel Project MSG_INFO logger setOutputPrintStream out logger setErrorPrintStream out newProject addBuildListener logger catch IOException ex log output getProject copyUserProperties newProject if inheritAll newProject setSystemProperties else addAlmostAll getProject getProperties Enumeration propertySets elements while hasMoreElements PropertySet ps PropertySet nextElement addAlmostAll ps getProperties public void handleOutput String outputToHandle if newProject null newProject demuxOutput outputToHandle false else super handleOutput outputToHandle public int handleInput byte buffer int offset int length throws IOException if newProject null return newProject demuxInput buffer offset length return super handleInput buffer offset length public void handleFlush String toFlush if newProject null newProject demuxFlush toFlush false else super handleFlush toFlush public void handleErrorOutput String errorOutputToHandle if newProject null newProject demuxOutput errorOutputToHandle true else super handleErrorOutput errorOutputToHandle public void handleErrorFlush String errorOutputToFlush if newProject null newProject demuxFlush errorOutputToFlush true else super handleErrorFlush errorOutputToFlush public void execute throws BuildException File savedDir dir String savedAntFile antFile Vector locals new Vector targets try getNewProject if dir null inheritAll dir getProject getBaseDir initializeProject if dir null newProject setBaseDir dir if savedDir null newProject setInheritedProperty MagicNames PROJECT_BASEDIR dir getAbsolutePath else dir getProject getBaseDir overrideProperties if antFile null antFile Main DEFAULT_BUILD_FILENAME File file FILE_UTILS resolveFile dir antFile antFile file getAbsolutePath log locals size locals toString antFile Project MSG_VERBOSE newProject setUserProperty MagicNames ANT_FILE antFile String thisAntFile getProject getProperty MagicNames ANT_FILE if thisAntFile null file equals getProject resolveFile thisAntFile getOwningTarget null if getOwningTarget getName equals if getTaskName equals throw new BuildException throw new BuildException getTaskName try ProjectHelper configureProject newProject file catch BuildException ex throw ProjectHelper addLocationToBuildException ex getLocation if locals size String defaultTarget newProject getDefaultTarget if defaultTarget null locals add defaultTarget if newProject getProperty MagicNames ANT_FILE equals getProject getProperty MagicNames ANT_FILE getOwningTarget null String owningTargetName getOwningTarget getName if locals contains owningTargetName throw new BuildException getTaskName boolean circular false for Iterator it locals iterator circular it hasNext Target other Target getProject getTargets get it next circular other null other dependsOn owningTargetName if circular throw new BuildException getTaskName owningTargetName addReferences if locals size locals size equals locals get BuildException be null try log antFile Project MSG_VERBOSE newProject fireSubBuildStarted newProject executeTargets locals catch BuildException ex be ProjectHelper addLocationToBuildException ex getLocation throw be finally log antFile Project MSG_VERBOSE newProject fireSubBuildFinished be finally newProject null Enumeration properties elements while hasMoreElements Property Property nextElement setProject null if output null out null try out close catch final Exception ex dir savedDir antFile savedAntFile private void overrideProperties throws BuildException Set set new HashSet for int properties size Property Property properties get if getName null getName equals if set contains getName properties remove else set add getName Enumeration properties elements while hasMoreElements Property Property nextElement setProject newProject execute getProject copyInheritedProperties newProject private void addReferences throws BuildException Hashtable thisReferences Hashtable getProject getReferences clone Hashtable newReferences newProject getReferences Enumeration if references size for references elements hasMoreElements Reference ref Reference nextElement String refid ref getRefId if refid null throw new BuildException if thisReferences containsKey refid log refid Project MSG_WARN continue thisReferences remove refid String toRefid ref getToRefid if toRefid null toRefid refid copyReference refid toRefid if inheritRefs for thisReferences keys hasMoreElements String key String nextElement if newReferences containsKey key continue copyReference key key newProject inheritIDReferences getProject private void copyReference String oldKey String newKey Object orig getProject getReference oldKey if orig null log oldKey newKey Project MSG_WARN return Class orig getClass Object copy orig try Method cloneM getMethod new Class if cloneM null copy cloneM invoke orig new Object log oldKey Project MSG_DEBUG catch Exception if copy instanceof ProjectComponent ProjectComponent copy setProject newProject else try Method setProjectM getMethod new Class Project class if setProjectM null setProjectM invoke copy new Object newProject catch NoSuchMethodException catch Exception e2 String msg oldKey throw new BuildException msg e2 getLocation newProject addReference newKey copy private void addAlmostAll Hashtable props Enumeration props keys while hasMoreElements String key nextElement toString if MagicNames PROJECT_BASEDIR equals key MagicNames ANT_FILE equals key continue String value props get key toString if newProject getProperty key null newProject setNewProperty key value public void setDir File dir this dir dir public void setAntfile String antFile this antFile antFile public void setTarget String targetToAdd if targetToAdd equals throw new BuildException targets add targetToAdd targetAttributeSet true public void setOutput String outputFile this output outputFile public Property createProperty Property new Property true getProject setProject getNewProject setTaskName properties addElement return public void addReference Reference ref references addElement ref public void addConfiguredTarget TargetElement if targetAttributeSet throw new BuildException String name getName if name equals throw new BuildException targets add name public void addPropertyset PropertySet ps propertySets addElement ps protected Project getNewProject if newProject null reinit return newProject private Iterator getBuildListeners return getProject getBuildListeners iterator public static class Reference extends org apache tools ant types Reference public Reference super private String targetid null public void setToRefid String targetid this targetid targetid public String getToRefid return targetid public static class TargetElement private String name public TargetElement public void setName String name this name name public String getName return name public class ReflectWrapper private Object obj public ReflectWrapper ClassLoader loader String name try Class clazz clazz Class forName name true loader Constructor constructor constructor clazz getConstructor Class null obj constructor newInstance Object null catch Exception ReflectUtil throwBuildException public ReflectWrapper Object obj this obj obj public Object getObject return obj public Object invoke String methodName return ReflectUtil invoke obj methodName public Object invoke String methodName Class argType Object arg return ReflectUtil invoke obj methodName argType arg public Object invoke String methodName Class argType1 Object arg1 Class argType2 Object arg2 return ReflectUtil invoke obj methodName argType1 arg1 argType2 arg2 public interface SelectorScanner void setSelectors FileSelector selectors String getDeselectedDirectories String getDeselectedFiles public final class DateUtils public static final String ISO8601_DATETIME_PATTERN public static final String ISO8601_DATE_PATTERN public static final String ISO8601_TIME_PATTERN public static final DateFormat DATE_HEADER_FORMAT new SimpleDateFormat Locale US private static final MessageFormat MINUTE_SECONDS new MessageFormat private static final double LIMITS private static final String MINUTES_PART private static final String SECONDS_PART private static final ChoiceFormat MINUTES_FORMAT new ChoiceFormat LIMITS MINUTES_PART private static final ChoiceFormat SECONDS_FORMAT new ChoiceFormat LIMITS SECONDS_PART static MINUTE_SECONDS setFormat MINUTES_FORMAT MINUTE_SECONDS setFormat SECONDS_FORMAT private DateUtils public static String format long date String pattern return format new Date date pattern public static String format Date date String pattern DateFormat df createDateFormat pattern return df format date public static String formatElapsedTime long millis long seconds millis long minutes seconds Object args new Long minutes new Long seconds return MINUTE_SECONDS format args private static DateFormat createDateFormat String pattern SimpleDateFormat sdf new SimpleDateFormat pattern TimeZone gmt TimeZone getTimeZone sdf setTimeZone gmt sdf setLenient true return sdf public static int getPhaseOfMoon Calendar cal int dayOfTheYear cal get Calendar DAY_OF_YEAR int yearInMetonicCycle cal get Calendar YEAR int epact yearInMetonicCycle if epact yearInMetonicCycle epact epact return dayOfTheYear epact public static String getDateForHeader Calendar cal Calendar getInstance TimeZone tz cal getTimeZone int offset tz getOffset cal get Calendar ERA cal get Calendar YEAR cal get Calendar MONTH cal get Calendar DAY_OF_MONTH cal get Calendar DAY_OF_WEEK cal get Calendar MILLISECOND StringBuffer tzMarker new StringBuffer offset offset Math abs offset int hours offset int minutes offset hours if hours tzMarker append tzMarker append hours if minutes tzMarker append tzMarker append minutes return DATE_HEADER_FORMAT format cal getTime tzMarker toString public static Date parseIso8601DateTime String datestr throws ParseException return new SimpleDateFormat ISO8601_DATETIME_PATTERN parse datestr public static Date parseIso8601Date String datestr throws ParseException return new SimpleDateFormat ISO8601_DATE_PATTERN parse datestr public static Date parseIso8601DateTimeOrDate String datestr throws ParseException try return parseIso8601DateTime datestr catch ParseException px return parseIso8601Date datestr public class FilterChain extends DataType implements Cloneable private Vector filterReaders new Vector public void addFilterReader final AntFilterReader filterReader filterReaders addElement filterReader public Vector getFilterReaders return filterReaders public void addClassConstants final ClassConstants classConstants filterReaders addElement classConstants public void addExpandProperties final ExpandProperties expandProperties filterReaders addElement expandProperties public void addHeadFilter final HeadFilter headFilter filterReaders addElement headFilter public void addLineContains final LineContains lineContains filterReaders addElement lineContains public void addLineContainsRegExp final LineContainsRegExp lineContainsRegExp filterReaders addElement lineContainsRegExp public void addPrefixLines final PrefixLines prefixLines filterReaders addElement prefixLines public void addReplaceTokens final ReplaceTokens replaceTokens filterReaders addElement replaceTokens public void addStripJavaComments final StripJavaComments stripJavaComments filterReaders addElement stripJavaComments public void addStripLineBreaks final StripLineBreaks stripLineBreaks filterReaders addElement stripLineBreaks public void addStripLineComments final StripLineComments stripLineComments filterReaders addElement stripLineComments public void addTabsToSpaces final TabsToSpaces tabsToSpaces filterReaders addElement tabsToSpaces public void addTailFilter final TailFilter tailFilter filterReaders addElement tailFilter public void addEscapeUnicode final EscapeUnicode escapeUnicode filterReaders addElement escapeUnicode public void addTokenFilter final TokenFilter tokenFilter filterReaders addElement tokenFilter public void addDeleteCharacters TokenFilter DeleteCharacters filter filterReaders addElement filter public void addContainsRegex TokenFilter ContainsRegex filter filterReaders addElement filter public void addReplaceRegex TokenFilter ReplaceRegex filter filterReaders addElement filter public void addTrim TokenFilter Trim filter filterReaders addElement filter public void addReplaceString TokenFilter ReplaceString filter filterReaders addElement filter public void addIgnoreBlank TokenFilter IgnoreBlank filter filterReaders addElement filter public void setRefid Reference throws BuildException if filterReaders isEmpty throw tooManyAttributes Object getReferencedObject getProject if instanceof FilterChain FilterChain fc FilterChain filterReaders fc getFilterReaders else String msg getRefId throw new BuildException msg super setRefid public void add ChainableReader filter filterReaders addElement filter public class LaunchException extends Exception public LaunchException String message super message public interface Native2AsciiAdapter boolean convert Native2Ascii args File srcFile File destFile throws BuildException public class GreedyInputHandler extends DefaultInputHandler private static final int BUFFER_SIZE public GreedyInputHandler public void handleInput InputRequest request throws BuildException String prompt getPrompt request InputStream in null try in getInputStream System err println prompt System err flush ByteArrayOutputStream baos new ByteArrayOutputStream StreamPumper new StreamPumper in baos Thread new Thread start try join catch InterruptedException try join catch InterruptedException e2 request setInput new String baos toByteArray if request isInputValid throw new BuildException if getException null throw new BuildException getException finally FileUtils close in public class ScriptMapper extends AbstractScriptComponent implements FileNameMapper private ArrayList files static final String EMPTY_STRING_ARRAY new String public void setFrom String from public void setTo String to public void clear files new ArrayList public void addMappedName String mapping files add mapping public String mapFileName String sourceFileName initScriptRunner getRunner addBean sourceFileName clear executeScript if files size return null else return String files toArray EMPTY_STRING_ARRAY public class ApacheCatalog extends Catalog private ApacheCatalogResolver resolver null protected Catalog newCatalog ApacheCatalog cat ApacheCatalog super newCatalog cat setResolver resolver return cat public void setResolver ApacheCatalogResolver resolver this resolver resolver public void addEntry CatalogEntry entry int type entry getEntryType if type PUBLIC String publicid PublicId normalize entry getEntryArg String systemid normalizeURI entry getEntryArg if resolver null catalogManager debug message else resolver addPublicEntry publicid systemid base else if type URI String uri normalizeURI entry getEntryArg String altURI normalizeURI entry getEntryArg if resolver null catalogManager debug message else resolver addURIEntry uri altURI base super addEntry entry public class StreamPumper implements Runnable private InputStream is private OutputStream os private volatile boolean finish private volatile boolean finished private boolean closeWhenExhausted private boolean autoflush false private Exception exception null private int bufferSize private boolean started false public StreamPumper InputStream is OutputStream os boolean closeWhenExhausted this is is this os os this closeWhenExhausted closeWhenExhausted public StreamPumper InputStream is OutputStream os this is os false this autoflush autoflush public void run synchronized this started true finished false finish false final byte buf new byte bufferSize int length try while length is read buf finish os write buf length if autoflush os flush os flush catch Exception synchronized this exception finally if closeWhenExhausted try os close catch IOException finished true synchronized this notifyAll public boolean isFinished return finished public synchronized void waitFor throws InterruptedException while isFinished wait public synchronized void setBufferSize int bufferSize if started throw new IllegalStateException this bufferSize bufferSize public synchronized int getBufferSize return bufferSize public synchronized Exception getException return exception finish true notifyAll public class P4Edit extends P4Base public String change null public void setChange String change this change change public void execute throws BuildException if change null P4CmdOpts change if P4View null throw new BuildException execP4Command P4CmdOpts P4View new SimpleP4OutputHandler this public class MSVSSCHECKIN extends MSVSS protected Commandline buildCmdLine Commandline commandLine new Commandline if getVsspath null String msg throw new BuildException msg getLocation commandLine setExecutable getSSCommand commandLine createArgument setValue COMMAND_CHECKIN commandLine createArgument setValue getVsspath commandLine createArgument setValue getLocalpath commandLine createArgument setValue getAutoresponse commandLine createArgument setValue getRecursive commandLine createArgument setValue getWritable commandLine createArgument setValue getLogin commandLine createArgument setValue getComment return commandLine public void setLocalpath Path localPath super setInternalLocalPath localPath toString public void setRecursive boolean recursive super setInternalRecursive recursive public final void setWritable boolean writable super setInternalWritable writable public void setAutoresponse String response super setInternalAutoResponse response public void setComment String comment super setInternalComment comment public interface DynamicElementNS Object createDynamicElement String uri String localName String qName throws BuildException public abstract class JDBCTask extends Task private static Hashtable loaderMap new Hashtable private boolean caching true private Path classpath private AntClassLoader loader private boolean autocommit false private String driver null private String url null private String userId null private String password null private String rdbms null private String version null public void setClasspath Path classpath this classpath classpath public void setCaching boolean enable caching enable public Path createClasspath if this classpath null this classpath new Path getProject return this classpath createPath public void setClasspathRef Reference createClasspath setRefid public void setDriver String driver this driver driver trim public void setUrl String url this url url public void setPassword String password this password password public void setAutocommit boolean autocommit this autocommit autocommit public void setRdbms String rdbms this rdbms rdbms public void setVersion String version this version version protected boolean isValidRdbms Connection conn if rdbms null version null return true try DatabaseMetaData dmd conn getMetaData if rdbms null String theVendor dmd getDatabaseProductName toLowerCase log theVendor Project MSG_VERBOSE if theVendor null theVendor indexOf rdbms log rdbms Project MSG_VERBOSE return false if version null String theVersion dmd getDatabaseProductVersion toLowerCase Locale ENGLISH log theVersion Project MSG_VERBOSE if theVersion null theVersion startsWith version theVersion indexOf version log version Project MSG_VERBOSE return false catch SQLException log Project MSG_ERR return false return true protected static Hashtable getLoaderMap return loaderMap protected AntClassLoader getLoader return loader protected Connection getConnection throws BuildException if userId null throw new BuildException getLocation if password null throw new BuildException getLocation if url null throw new BuildException getLocation try log getUrl Project MSG_VERBOSE Properties info new Properties info put getUserId info put getPassword Connection conn getDriver connect getUrl info if conn null throw new SQLException url conn setAutoCommit autocommit return conn catch SQLException throw new BuildException getLocation private Driver getDriver throws BuildException if driver null throw new BuildException getLocation Driver driverInstance null try Class dc if classpath null synchronized loaderMap if caching loader AntClassLoader loaderMap get driver if loader null log driver classpath Project MSG_VERBOSE loader getProject createClassLoader classpath if caching loaderMap put driver loader else log driver Project MSG_VERBOSE dc loader loadClass driver else log driver Project MSG_VERBOSE dc Class forName driver driverInstance Driver dc newInstance catch ClassNotFoundException throw new BuildException driver getLocation catch IllegalAccessException throw new BuildException driver getLocation catch InstantiationException throw new BuildException driver getLocation return driverInstance public void isCaching boolean value caching value public Path getClasspath return classpath public boolean isAutocommit return autocommit public String getUrl return url public String getUserId return userId public void setUserid String userId this userId userId public String getPassword return password public String getRdbms return rdbms public String getVersion return version public class EmailTask extends Task public static final String AUTO public static final String MIME public static final String UU public static final String PLAIN public static class Encoding extends EnumeratedAttribute public String getValues return new String AUTO MIME UU PLAIN private String encoding AUTO private String host private int port private String subject null private Message message null private boolean failOnError true private boolean includeFileNames false private String messageMimeType null private EmailAddress from null private Vector replyToList new Vector private Vector toList new Vector private Vector ccList new Vector private Vector bccList new Vector private Vector headers new Vector private Path attachments null private String charset null private String user null private String password null private boolean ssl false public void setUser String user this user user public void setPassword String password this password password public void setSSL boolean ssl this ssl ssl public void setEncoding Encoding encoding this encoding encoding getValue public void setMailport int port this port port public void setMailhost String host this host host public void setSubject String subject this subject subject public void setMessage String message if this message null throw new BuildException this message new Message message this message setProject getProject public void setMessageFile File file if this message null throw new BuildException this message new Message file this message setProject getProject public void setMessageMimeType String type this messageMimeType type public void addMessage Message message throws BuildException if this message null throw new BuildException this message message public void addFrom EmailAddress address if this from null throw new BuildException this from address public void setFrom String address if this from null throw new BuildException this from new EmailAddress address public void addReplyTo EmailAddress address this replyToList add address public void setReplyTo String address this replyToList add new EmailAddress address public void addTo EmailAddress address toList addElement address public void setToList String list StringTokenizer tokens new StringTokenizer list while tokens hasMoreTokens toList addElement new EmailAddress tokens nextToken public void addCc EmailAddress address ccList addElement address public void setCcList String list StringTokenizer tokens new StringTokenizer list while tokens hasMoreTokens ccList addElement new EmailAddress tokens nextToken public void addBcc EmailAddress address bccList addElement address public void setBccList String list StringTokenizer tokens new StringTokenizer list while tokens hasMoreTokens bccList addElement new EmailAddress tokens nextToken public void setFailOnError boolean failOnError this failOnError failOnError public void setFiles String filenames StringTokenizer new StringTokenizer filenames while hasMoreTokens createAttachments add new FileResource getProject resolveFile nextToken public void addFileset FileSet fs createAttachments add fs public Path createAttachments if attachments null attachments new Path getProject return attachments createPath public Header createHeader Header new Header headers add return public void setIncludefilenames boolean includeFileNames this includeFileNames includeFileNames public boolean getIncludeFileNames return includeFileNames public void execute Message savedMessage message try Mailer mailer null boolean autoFound false if encoding equals MIME encoding equals AUTO autoFound try mailer Mailer ClasspathUtils newInstance EmailTask class getClassLoader Mailer class autoFound true log Project MSG_VERBOSE catch BuildException Throwable getCause null getCause log getMessage Project MSG_WARN return if autoFound user null password null encoding equals UU encoding equals PLAIN throw new BuildException if autoFound ssl encoding equals UU encoding equals PLAIN throw new BuildException if encoding equals UU encoding equals AUTO autoFound try mailer Mailer ClasspathUtils newInstance EmailTask class getClassLoader Mailer class autoFound true log Project MSG_VERBOSE catch BuildException Throwable getCause null getCause log getMessage Project MSG_WARN return if encoding equals PLAIN encoding equals AUTO autoFound mailer new PlainMailer autoFound true log Project MSG_VERBOSE if mailer null throw new BuildException encoding if message null message new Message message setProject getProject if from null from getAddress null throw new BuildException if toList isEmpty ccList isEmpty bccList isEmpty throw new BuildException if messageMimeType null if message isMimeTypeSpecified throw new BuildException message setMimeType messageMimeType if charset null if message getCharset null throw new BuildException message setCharset charset Vector files new Vector if attachments null Iterator iter attachments iterator while iter hasNext FileResource fr FileResource iter next files addElement fr getFile log subject Project MSG_INFO log from Project MSG_VERBOSE log replyToList Project MSG_VERBOSE log toList Project MSG_VERBOSE log ccList Project MSG_VERBOSE log bccList Project MSG_VERBOSE mailer setHost host mailer setPort port mailer setUser user mailer setPassword password mailer setSSL ssl mailer setMessage message mailer setFrom from mailer setReplyToList replyToList mailer setToList toList mailer setCcList ccList mailer setBccList bccList mailer setFiles files mailer setSubject subject mailer setTask this mailer setIncludeFileNames includeFileNames mailer setHeaders headers mailer send int count files size log count count Project MSG_INFO catch BuildException Throwable getCause null getCause log getMessage Project MSG_WARN if failOnError throw catch Exception log getMessage Project MSG_WARN if failOnError throw new BuildException finally message savedMessage public void setCharset String charset this charset charset public String getCharset return charset public class Execute public static final int INVALID Integer MAX_VALUE private static final FileUtils FILE_UTILS FileUtils getFileUtils private String cmdl null private String env null private int exitValue INVALID private ExecuteStreamHandler streamHandler private ExecuteWatchdog watchdog private File workingDirectory null private Project project null private boolean newEnvironment false private boolean spawn false private boolean useVMLauncher true private static String antWorkingDirectory System getProperty private static CommandLauncher vmLauncher null private static CommandLauncher shellLauncher null private static Vector procEnvironment null private static ProcessDestroyer processDestroyer new ProcessDestroyer private static boolean environmentCaseInSensitive false static try if Os isFamily vmLauncher new Java13CommandLauncher catch NoSuchMethodException exc if Os isFamily Os isFamily shellLauncher new MacCommandLauncher new CommandLauncher else if Os isFamily shellLauncher new OS2CommandLauncher new CommandLauncher else if Os isFamily environmentCaseInSensitive true CommandLauncher baseLauncher new CommandLauncher if Os isFamily shellLauncher new WinNTCommandLauncher baseLauncher else shellLauncher new ScriptCommandLauncher baseLauncher else if Os isFamily CommandLauncher baseLauncher new CommandLauncher shellLauncher new PerlScriptCommandLauncher baseLauncher else if Os isFamily try shellLauncher new VmsCommandLauncher catch NoSuchMethodException exc else shellLauncher new ScriptCommandLauncher new CommandLauncher public void setSpawn boolean spawn this spawn spawn public static synchronized Vector getProcEnvironment if procEnvironment null return procEnvironment procEnvironment new Vector try ByteArrayOutputStream out new ByteArrayOutputStream Execute exe new Execute new PumpStreamHandler out exe setCommandline getProcEnvCommand exe setNewenvironment true int retval exe execute if retval BufferedReader in new BufferedReader new StringReader toString out if Os isFamily procEnvironment addVMSLogicals procEnvironment in return procEnvironment String var null String line lineSep StringUtils LINE_SEP while line in readLine null if line indexOf if var null var lineSep line else var lineSep line else if var null procEnvironment addElement var var line if var null procEnvironment addElement var catch java io IOException exc exc printStackTrace return procEnvironment private static String getProcEnvCommand if Os isFamily return new String else if Os isFamily if Os isFamily return new String else return new String else if Os isFamily Os isFamily String cmd new String if new File canRead cmd else if new File canRead cmd else cmd return cmd else if Os isFamily Os isFamily return new String else if Os isFamily return new String else return null public static String toString ByteArrayOutputStream bos if Os isFamily try return bos toString catch java io UnsupportedEncodingException else if Os isFamily try return bos toString catch java io UnsupportedEncodingException return bos toString public Execute this new PumpStreamHandler null public Execute ExecuteStreamHandler streamHandler this streamHandler null public Execute ExecuteStreamHandler streamHandler ExecuteWatchdog watchdog setStreamHandler streamHandler this watchdog watchdog if Os isFamily useVMLauncher false public void setStreamHandler ExecuteStreamHandler streamHandler this streamHandler streamHandler public String getCommandline return cmdl public void setCommandline String commandline cmdl commandline public void setNewenvironment boolean newenv newEnvironment newenv public String getEnvironment return env null newEnvironment env patchEnvironment public void setEnvironment String env this env env public void setWorkingDirectory File wd workingDirectory wd null wd getAbsolutePath equals antWorkingDirectory null wd public File getWorkingDirectory return workingDirectory null new File antWorkingDirectory workingDirectory public void setAntRun Project project throws BuildException this project project public void setVMLauncher boolean useVMLauncher this useVMLauncher useVMLauncher public static Process launch Project project String command String env File dir boolean useVM throws IOException if dir null dir exists throw new BuildException dir CommandLauncher launcher useVM vmLauncher null vmLauncher shellLauncher return launcher exec project command env dir public int execute throws IOException if workingDirectory null workingDirectory exists throw new BuildException workingDirectory final Process process launch project getCommandline getEnvironment workingDirectory useVMLauncher try streamHandler setProcessInputStream process getOutputStream streamHandler setProcessOutputStream process getInputStream streamHandler setProcessErrorStream process getErrorStream catch IOException process destroy throw streamHandler start try processDestroyer add process if watchdog null watchdog start process waitFor process if watchdog null watchdog stop streamHandler stop closeStreams process if watchdog null watchdog checkException return getExitValue catch ThreadDeath process destroy throw finally processDestroyer remove process public void spawn throws IOException if workingDirectory null workingDirectory exists throw new BuildException workingDirectory final Process process launch project getCommandline getEnvironment workingDirectory useVMLauncher if Os isFamily try Thread sleep catch InterruptedException project log Project MSG_VERBOSE OutputStream dummyOut new OutputStream public void write int throws IOException ExecuteStreamHandler handler new PumpStreamHandler dummyOut handler setProcessErrorStream process getErrorStream handler setProcessOutputStream process getInputStream handler start process getOutputStream close project log process toString Project MSG_VERBOSE protected void waitFor Process process try process waitFor setExitValue process exitValue catch InterruptedException process destroy protected void setExitValue int value exitValue value public int getExitValue return exitValue public static boolean isFailure int exitValue return Os isFamily exitValue exitValue public boolean isFailure return isFailure getExitValue public boolean killedProcess return watchdog null watchdog killedProcess private String patchEnvironment if Os isFamily return env Vector osEnv Vector getProcEnvironment clone for int env length String keyValue env String key keyValue substring keyValue indexOf if environmentCaseInSensitive key key toLowerCase int size osEnv size for int size String osEnvItem String osEnv elementAt String convertedItem environmentCaseInSensitive osEnvItem toLowerCase osEnvItem if convertedItem startsWith key osEnv removeElementAt if environmentCaseInSensitive keyValue osEnvItem substring key length keyValue substring key length break osEnv addElement keyValue return String osEnv toArray new String osEnv size public static void runCommand Task task String cmdline throws BuildException try task log Commandline describeCommand cmdline Project MSG_VERBOSE Execute exe new Execute new LogStreamHandler task Project MSG_INFO Project MSG_ERR exe setAntRun task getProject exe setCommandline cmdline int retval exe execute if isFailure retval throw new BuildException cmdline retval task getLocation catch java io IOException exc throw new BuildException cmdline exc task getLocation public static void closeStreams Process process FileUtils close process getInputStream FileUtils close process getOutputStream FileUtils close process getErrorStream private static Vector addVMSLogicals Vector environment BufferedReader in throws IOException HashMap logicals new HashMap String logName null logValue null newLogName String line null while line in readLine null if line startsWith if logName null logValue line substring line length else if line startsWith if logName null logicals put logName logValue int eqIndex line indexOf newLogName line substring eqIndex if logicals containsKey newLogName logName null else logName newLogName logValue line substring eqIndex line length if logName null logicals put logName logValue for Iterator logicals keySet iterator hasNext String logical String next environment add logical logicals get logical return environment private static class CommandLauncher public Process exec Project project String cmd String env throws IOException if project null project log Commandline describeCommand cmd Project MSG_DEBUG return Runtime getRuntime exec cmd env public Process exec Project project String cmd String env File workingDir throws IOException if workingDir null return exec project cmd env throw new IOException private static class Java13CommandLauncher extends CommandLauncher private Method myExecWithCWD public Java13CommandLauncher throws NoSuchMethodException myExecWithCWD Runtime class getMethod new Class String class String class File class public Process exec Project project String cmd String env File workingDir throws IOException try if project null project log Commandline describeCommand cmd Project MSG_DEBUG return Process myExecWithCWD invoke Runtime getRuntime catch InvocationTargetException exc Throwable realexc exc getTargetException if realexc instanceof ThreadDeath throw ThreadDeath realexc else if realexc instanceof IOException throw IOException realexc else throw new BuildException realexc catch Exception exc throw new BuildException exc private static class CommandLauncherProxy extends CommandLauncher private CommandLauncher myLauncher CommandLauncherProxy CommandLauncher launcher myLauncher launcher public Process exec Project project String cmd String env throws IOException return myLauncher exec project cmd env private static class OS2CommandLauncher extends CommandLauncherProxy OS2CommandLauncher CommandLauncher launcher super launcher public Process exec Project project String cmd String env File workingDir throws IOException File commandDir workingDir if workingDir null if project null commandDir project getBaseDir else return exec project cmd env final int preCmdLength final String cmdDir commandDir getAbsolutePath String newcmd new String cmd length preCmdLength newcmd newcmd newcmd cmdDir substring newcmd newcmd newcmd cmdDir substring newcmd System arraycopy cmd newcmd preCmdLength cmd length return exec project newcmd env private static class WinNTCommandLauncher extends CommandLauncherProxy WinNTCommandLauncher CommandLauncher launcher super launcher public Process exec Project project String cmd String env File workingDir throws IOException File commandDir workingDir if workingDir null if project null commandDir project getBaseDir else return exec project cmd env final int preCmdLength String newcmd new String cmd length preCmdLength newcmd newcmd newcmd newcmd newcmd commandDir getAbsolutePath newcmd System arraycopy cmd newcmd preCmdLength cmd length return exec project newcmd env private static class MacCommandLauncher extends CommandLauncherProxy MacCommandLauncher CommandLauncher launcher super launcher public Process exec Project project String cmd String env File workingDir throws IOException if workingDir null return exec project cmd env System getProperties put workingDir getAbsolutePath try return exec project cmd env finally System getProperties put antWorkingDirectory private static class ScriptCommandLauncher extends CommandLauncherProxy ScriptCommandLauncher String script CommandLauncher launcher super launcher myScript script public Process exec Project project String cmd String env File workingDir throws IOException if project null if workingDir null return exec project cmd env throw new IOException String antHome project getProperty MagicNames ANT_HOME if antHome null throw new IOException MagicNames ANT_HOME String antRun FILE_UTILS resolveFile project getBaseDir antHome File separator myScript toString File commandDir workingDir if workingDir null project null commandDir project getBaseDir String newcmd new String cmd length newcmd antRun newcmd commandDir getAbsolutePath System arraycopy cmd newcmd cmd length return exec project newcmd env private String myScript private static class PerlScriptCommandLauncher extends CommandLauncherProxy private String myScript PerlScriptCommandLauncher String script CommandLauncher launcher super launcher myScript script public Process exec Project project String cmd String env File workingDir throws IOException if project null if workingDir null return exec project cmd env throw new IOException String antHome project getProperty MagicNames ANT_HOME if antHome null throw new IOException MagicNames ANT_HOME String antRun FILE_UTILS resolveFile project getBaseDir antHome File separator myScript toString File commandDir workingDir if workingDir null project null commandDir project getBaseDir String newcmd new String cmd length newcmd newcmd antRun newcmd commandDir getAbsolutePath System arraycopy cmd newcmd cmd length return exec project newcmd env private static class VmsCommandLauncher extends Java13CommandLauncher public VmsCommandLauncher throws NoSuchMethodException super public Process exec Project project String cmd String env throws IOException File cmdFile createCommandFile cmd env Process super exec project new String cmdFile getPath env deleteAfter cmdFile return public Process exec Project project String cmd String env File workingDir throws IOException File cmdFile createCommandFile cmd env Process super exec project new String cmdFile getPath env workingDir deleteAfter cmdFile return private File createCommandFile String cmd String env throws IOException File script FILE_UTILS createTempFile null script deleteOnExit PrintWriter out null try out new PrintWriter new FileWriter script if env null int eqIndex for int env length eqIndex env indexOf if eqIndex out print out print env substring eqIndex out print out print env substring eqIndex out println out print cmd for int cmd length out println out print cmd finally if out null out close return script private void deleteAfter final File final Process new Thread public void run try waitFor catch InterruptedException FileUtils delete start public class XMLValidateTask extends Task private static final FileUtils FILE_UTILS FileUtils getFileUtils protected static final String INIT_FAILED_MSG protected boolean failOnError true protected boolean warn true protected boolean lenient false protected String readerClassName null protected File file null protected Vector filesets new Vector protected Path classpath protected XMLReader xmlReader null protected ValidatorErrorHandler errorHandler new ValidatorErrorHandler private Vector attributeList new Vector private final Vector propertyList new Vector private XMLCatalog xmlCatalog new XMLCatalog public static final String MESSAGE_FILES_VALIDATED public void setFailOnError boolean fail failOnError fail public void setWarn boolean bool warn bool public void setLenient boolean bool lenient bool public void setClassName String className readerClassName className public void setClasspath Path classpath if this classpath null this classpath classpath else this classpath append classpath public Path createClasspath if this classpath null this classpath new Path getProject return this classpath createPath public void setClasspathRef Reference createClasspath setRefid public void setFile File file this file file public void addConfiguredXMLCatalog XMLCatalog catalog xmlCatalog addConfiguredXMLCatalog catalog public void addFileset FileSet set filesets addElement set public Attribute createAttribute final Attribute feature new Attribute attributeList addElement feature return feature public Property createProperty final Property prop new Property propertyList addElement prop return prop public void init throws BuildException super init xmlCatalog setProject getProject public DTDLocation createDTD DTDLocation dtdLocation new DTDLocation xmlCatalog addDTD dtdLocation return dtdLocation protected EntityResolver getEntityResolver return xmlCatalog protected XMLReader getXmlReader return xmlReader public void execute throws BuildException int fileProcessed if file null filesets size throw new BuildException if file null if file exists file canRead file isFile doValidate file fileProcessed else String errorMsg file if failOnError throw new BuildException errorMsg else log errorMsg Project MSG_ERR for int filesets size FileSet fs FileSet filesets elementAt DirectoryScanner ds fs getDirectoryScanner getProject String files ds getIncludedFiles for int files length File srcFile new File fs getDir getProject files doValidate srcFile fileProcessed onSuccessfulValidation fileProcessed protected void onSuccessfulValidation int fileProcessed log fileProcessed MESSAGE_FILES_VALIDATED protected void initValidator xmlReader createXmlReader xmlReader setEntityResolver getEntityResolver xmlReader setErrorHandler errorHandler if isSax1Parser if lenient setFeature XmlConstants FEATURE_VALIDATION true for int attributeList size Attribute feature Attribute attributeList elementAt setFeature feature getName feature getValue for int propertyList size final Property prop Property propertyList elementAt setProperty prop getName prop getValue protected boolean isSax1Parser return xmlReader instanceof ParserAdapter protected XMLReader createXmlReader Object reader null if readerClassName null reader createDefaultReaderOrParser else Class readerClass null try if classpath null AntClassLoader loader getProject createClassLoader classpath readerClass Class forName readerClassName true loader else readerClass Class forName readerClassName reader readerClass newInstance catch ClassNotFoundException throw new BuildException INIT_FAILED_MSG readerClassName catch InstantiationException throw new BuildException INIT_FAILED_MSG readerClassName catch IllegalAccessException throw new BuildException INIT_FAILED_MSG readerClassName XMLReader newReader if reader instanceof XMLReader newReader XMLReader reader log reader getClass getName Project MSG_VERBOSE else if reader instanceof Parser newReader new ParserAdapter Parser reader log reader getClass getName Project MSG_VERBOSE else throw new BuildException INIT_FAILED_MSG reader getClass getName return newReader private Object createDefaultReaderOrParser Object reader try reader createDefaultReader catch BuildException exc reader JAXPUtils getParser return reader protected XMLReader createDefaultReader return JAXPUtils getXMLReader protected void setFeature String feature boolean value throws BuildException log feature value Project MSG_DEBUG try xmlReader setFeature feature value catch SAXNotRecognizedException throw new BuildException xmlReader getClass getName feature getLocation catch SAXNotSupportedException throw new BuildException xmlReader getClass getName feature getLocation protected void setProperty String name String value throws BuildException if name null value null throw new BuildException try xmlReader setProperty name value catch SAXNotRecognizedException throw new BuildException xmlReader getClass getName name getLocation catch SAXNotSupportedException throw new BuildException xmlReader getClass getName name getLocation protected boolean doValidate File afile initValidator boolean result true try log afile getName Project MSG_VERBOSE errorHandler init afile InputSource is new InputSource new FileInputStream afile String uri FILE_UTILS toURI afile getAbsolutePath is setSystemId uri xmlReader parse is catch SAXException ex log ex toString Project MSG_DEBUG if failOnError throw new BuildException afile log afile ex toString result false catch IOException ex throw new BuildException afile ex if errorHandler getFailure if failOnError throw new BuildException afile result false log afile Project MSG_ERR return result protected class ValidatorErrorHandler implements ErrorHandler protected File currentFile null protected String lastErrorMessage null protected boolean failed false public void init File file currentFile file failed false public boolean getFailure return failed public void fatalError SAXParseException exception failed true doLog exception Project MSG_ERR public void error SAXParseException exception failed true doLog exception Project MSG_ERR public void warning SAXParseException exception if warn doLog exception Project MSG_WARN private void doLog SAXParseException int logLevel log getMessage logLevel private String getMessage SAXParseException String sysID getSystemId if sysID null String name sysID if sysID startsWith try name FILE_UTILS fromURI sysID catch Exception ex int line getLineNumber int col getColumnNumber return name line line col col getMessage return getMessage public static class Attribute private String attributeName null private boolean attributeValue public void setName String name attributeName name public void setValue boolean value attributeValue value public String getName return attributeName public boolean getValue return attributeValue public static final class Property private String name private String value public String getName return name public void setName String name this name name public String getValue return value public void setValue String value this value value public class ClassfileSet extends FileSet private Vector rootClasses new Vector private Vector rootFileSets new Vector public static class ClassRoot private String rootClass public void setClassname String name this rootClass name public String getClassname return rootClass public ClassfileSet public void addRootFileset FileSet rootFileSet rootFileSets addElement rootFileSet protected ClassfileSet ClassfileSet super rootClasses Vector rootClasses clone public void setRootClass String rootClass rootClasses addElement rootClass public DirectoryScanner getDirectoryScanner Project if isReference return getRef getDirectoryScanner Vector allRootClasses Vector rootClasses clone for Enumeration rootFileSets elements hasMoreElements FileSet additionalRootSet FileSet nextElement DirectoryScanner additionalScanner additionalRootSet getDirectoryScanner String files additionalScanner getIncludedFiles for int files length if files endsWith String classFilePath files substring files length String className classFilePath replace replace allRootClasses addElement className DirectoryScanner parentScanner super getDirectoryScanner DependScanner scanner new DependScanner parentScanner scanner setBasedir getDir scanner setRootClasses allRootClasses scanner scan return scanner public void addConfiguredRoot ClassRoot root rootClasses addElement root getClassname public Object clone return new ClassfileSet isReference ClassfileSet getRef getProject this public class KeepAliveOutputStream extends FilterOutputStream public KeepAliveOutputStream OutputStream out super out public void close throws IOException public class JlinkTask extends MatchingTask public void setOutfile File outfile this outfile outfile public Path createMergefiles if this mergefiles null this mergefiles new Path getProject return this mergefiles createPath public void setMergefiles Path mergefiles if this mergefiles null this mergefiles mergefiles else this mergefiles append mergefiles public Path createAddfiles if this addfiles null this addfiles new Path getProject return this addfiles createPath public void setAddfiles Path addfiles if this addfiles null this addfiles addfiles else this addfiles append addfiles public void setCompress boolean compress this compress compress public void execute throws BuildException if outfile null throw new BuildException if haveAddFiles haveMergeFiles throw new BuildException log outfile getPath log compress Project MSG_VERBOSE jlink linker new jlink linker setOutfile outfile getPath linker setCompression compress if haveMergeFiles log mergefiles toString Project MSG_VERBOSE linker addMergeFiles mergefiles list if haveAddFiles log addfiles toString Project MSG_VERBOSE linker addAddFiles addfiles list try linker link catch Exception ex throw new BuildException ex getLocation private boolean haveAddFiles return haveEntries addfiles private boolean haveMergeFiles return haveEntries mergefiles private boolean haveEntries Path if null return false if size return true return false private File outfile null private Path mergefiles null private Path addfiles null private boolean compress false public class XmlLogger implements BuildLogger private int msgOutputLevel Project MSG_DEBUG private PrintStream outStream private static DocumentBuilder builder getDocumentBuilder private static DocumentBuilder getDocumentBuilder try return DocumentBuilderFactory newInstance newDocumentBuilder catch Exception exc throw new ExceptionInInitializerError exc private static final String BUILD_TAG private static final String TARGET_TAG private static final String TASK_TAG private static final String MESSAGE_TAG private static final String NAME_ATTR private static final String TIME_ATTR private static final String PRIORITY_ATTR private static final String LOCATION_ATTR private static final String ERROR_ATTR private static final String STACKTRACE_TAG private Document doc builder newDocument private Hashtable tasks new Hashtable private Hashtable targets new Hashtable private Hashtable threadStacks new Hashtable private TimedElement buildElement null private static class TimedElement private long startTime private Element element public String toString return element getTagName element getAttribute public XmlLogger public void buildStarted BuildEvent event buildElement new TimedElement buildElement startTime System currentTimeMillis buildElement element doc createElement BUILD_TAG public void buildFinished BuildEvent event long totalTime System currentTimeMillis buildElement startTime buildElement element setAttribute TIME_ATTR DefaultLogger formatTime totalTime if event getException null buildElement element setAttribute ERROR_ATTR event getException toString Throwable event getException Text errText doc createCDATASection StringUtils getStackTrace Element stacktrace doc createElement STACKTRACE_TAG stacktrace appendChild errText buildElement element appendChild stacktrace String outFilename event getProject getProperty if outFilename null outFilename String xslUri event getProject getProperty if xslUri null xslUri Writer out null try OutputStream stream outStream if stream null stream new FileOutputStream outFilename out new OutputStreamWriter stream out write if xslUri length out write xslUri new DOMElementWriter write buildElement element out out flush catch IOException exc throw new BuildException exc finally if out null try out close catch IOException buildElement null private Stack getStack Stack threadStack Stack threadStacks get Thread currentThread if threadStack null threadStack new Stack threadStacks put Thread currentThread threadStack return threadStack public void targetStarted BuildEvent event Target target event getTarget TimedElement targetElement new TimedElement targetElement startTime System currentTimeMillis targetElement element doc createElement TARGET_TAG targetElement element setAttribute NAME_ATTR target getName targets put target targetElement getStack push targetElement public void targetFinished BuildEvent event Target target event getTarget TimedElement targetElement TimedElement targets get target if targetElement null long totalTime System currentTimeMillis targetElement startTime targetElement element setAttribute TIME_ATTR DefaultLogger formatTime totalTime TimedElement parentElement null Stack threadStack getStack if threadStack empty TimedElement poppedStack TimedElement threadStack pop if poppedStack targetElement throw new RuntimeException poppedStack targetElement if threadStack empty parentElement TimedElement threadStack peek if parentElement null buildElement element appendChild targetElement element else parentElement element appendChild targetElement element targets remove target public void taskStarted BuildEvent event TimedElement taskElement new TimedElement taskElement startTime System currentTimeMillis taskElement element doc createElement TASK_TAG Task task event getTask String name event getTask getTaskName if name null name taskElement element setAttribute NAME_ATTR name taskElement element setAttribute LOCATION_ATTR event getTask getLocation toString tasks put task taskElement getStack push taskElement public void taskFinished BuildEvent event Task task event getTask TimedElement taskElement TimedElement tasks get task if taskElement null long totalTime System currentTimeMillis taskElement startTime taskElement element setAttribute TIME_ATTR DefaultLogger formatTime totalTime Target target task getOwningTarget TimedElement targetElement null if target null targetElement TimedElement targets get target if targetElement null buildElement element appendChild taskElement element else targetElement element appendChild taskElement element Stack threadStack getStack if threadStack empty TimedElement poppedStack TimedElement threadStack pop if poppedStack taskElement throw new RuntimeException poppedStack taskElement tasks remove task else throw new RuntimeException task tasks private TimedElement getTaskElement Task task TimedElement element TimedElement tasks get task if element null return element for Enumeration tasks keys hasMoreElements Task key Task nextElement if key instanceof UnknownElement if UnknownElement key getTask task return TimedElement tasks get key return null public void messageLogged BuildEvent event int priority event getPriority if priority msgOutputLevel return Element messageElement doc createElement MESSAGE_TAG String name switch event getPriority case Project MSG_ERR name break case Project MSG_WARN name break case Project MSG_INFO name break default name break messageElement setAttribute PRIORITY_ATTR name Throwable ex event getException if Project MSG_DEBUG msgOutputLevel ex null Text errText doc createCDATASection StringUtils getStackTrace ex Element stacktrace doc createElement STACKTRACE_TAG stacktrace appendChild errText buildElement element appendChild stacktrace Text messageText doc createCDATASection event getMessage messageElement appendChild messageText TimedElement parentElement null Task task event getTask Target target event getTarget if task null parentElement getTaskElement task if parentElement null target null parentElement TimedElement targets get target if parentElement null parentElement element appendChild messageElement else buildElement element appendChild messageElement public void setMessageOutputLevel int level msgOutputLevel level public void setOutputPrintStream PrintStream output this outStream new PrintStream output true public void setEmacsMode boolean emacsMode public void setErrorPrintStream PrintStream err public interface XMLConstants String TESTSUITES String TESTSUITE String TESTCASE String ERROR String FAILURE String SYSTEM_ERR String SYSTEM_OUT String ATTR_NAME String ATTR_TIME String ATTR_ERRORS String ATTR_FAILURES String ATTR_TESTS String ATTR_TYPE String ATTR_MESSAGE String PROPERTIES String PROPERTY String ATTR_VALUE String ATTR_CLASSNAME String ATTR_ID String TIMESTAMP String HOSTNAME public class StringInputStream extends ReaderInputStream public StringInputStream String source super new StringReader source public StringInputStream String source String encoding super new StringReader source encoding public abstract class DefaultRmicAdapter implements RmicAdapter private Rmic attributes private FileNameMapper mapper private static final Random RAND new Random public static final String RMI_STUB_SUFFIX public static final String RMI_SKEL_SUFFIX public static final String RMI_TIE_SUFFIX public static final String STUB_COMPAT public static final String STUB_1_1 public static final String STUB_1_2 public DefaultRmicAdapter public void setRmic final Rmic attributes this attributes attributes mapper new RmicFileNameMapper public Rmic getRmic return attributes protected String getStubClassSuffix return RMI_STUB_SUFFIX protected String getSkelClassSuffix return RMI_SKEL_SUFFIX protected String getTieClassSuffix return RMI_TIE_SUFFIX public FileNameMapper getMapper return mapper public Path getClasspath return getCompileClasspath protected Path getCompileClasspath Path classpath new Path attributes getProject classpath setLocation attributes getBase Path cp attributes getClasspath if cp null cp new Path attributes getProject if attributes getIncludeantruntime classpath addExisting cp concatSystemClasspath else classpath addExisting cp concatSystemClasspath if attributes getIncludejavaruntime classpath addJavaRuntime return classpath protected Commandline setupRmicCommand return setupRmicCommand null protected Commandline setupRmicCommand String options Commandline cmd new Commandline if options null for int options length cmd createArgument setValue options Path classpath getCompileClasspath cmd createArgument setValue cmd createArgument setFile attributes getBase if attributes getExtdirs null cmd createArgument setValue cmd createArgument setPath attributes getExtdirs cmd createArgument setValue cmd createArgument setPath classpath String stubVersion attributes getStubVersion String stubOption null if null stubVersion if equals stubVersion stubOption STUB_1_1 else if equals stubVersion stubOption STUB_1_2 else if equals stubVersion stubOption STUB_COMPAT else attributes log stubVersion if stubOption null attributes getIiop attributes getIdl stubOption STUB_COMPAT if stubOption null cmd createArgument setValue stubOption if null attributes getSourceBase cmd createArgument setValue if attributes getIiop attributes log Project MSG_INFO cmd createArgument setValue if attributes getIiopopts null attributes log attributes getIiopopts Project MSG_INFO cmd createArgument setValue attributes getIiopopts if attributes getIdl cmd createArgument setValue attributes log Project MSG_INFO if attributes getIdlopts null cmd createArgument setValue attributes getIdlopts attributes log attributes getIdlopts Project MSG_INFO if attributes getDebug cmd createArgument setValue cmd addArguments attributes getCurrentCompilerArgs logAndAddFilesToCompile cmd return cmd protected void logAndAddFilesToCompile Commandline cmd Vector compileList attributes getCompileList attributes log cmd describeArguments Project MSG_VERBOSE StringBuffer niceSourceList new StringBuffer int cListSize compileList size if cListSize niceSourceList append niceSourceList append for int cListSize String arg String compileList elementAt cmd createArgument setValue arg niceSourceList append niceSourceList append arg attributes log niceSourceList toString Project MSG_VERBOSE private class RmicFileNameMapper implements FileNameMapper RmicFileNameMapper public void setFrom String public void setTo String public String mapFileName String name if name null name endsWith name endsWith getStubClassSuffix name endsWith getSkelClassSuffix name endsWith getTieClassSuffix return null String base name substring name length String classname base replace File separatorChar if attributes getVerify attributes isValidRmiRemote classname return null String target new String name RAND nextLong if attributes getIiop attributes getIdl if equals attributes getStubVersion target new String base getStubClassSuffix else target new String base getStubClassSuffix base getSkelClassSuffix else if attributes getIdl int lastSlash base lastIndexOf File separatorChar String dirname int index if lastSlash index else index lastSlash dirname base substring index String filename base substring index try Class attributes getLoader loadClass classname if isInterface target new String dirname filename getStubClassSuffix else Class interf attributes getRemoteInterface String iName interf getName String iDir int iIndex int lastDot iName lastIndexOf if lastDot iIndex else iIndex lastDot iDir iName substring iIndex iDir iDir replace File separatorChar target new String dirname filename getTieClassSuffix iDir iName substring iIndex getStubClassSuffix catch ClassNotFoundException attributes log classname Project MSG_WARN catch NoClassDefFoundError attributes log classname Project MSG_WARN catch Throwable attributes log classname getMessage Project MSG_WARN return target public class Dirname extends Task private File file private String property public void setFile File file this file file public void setProperty String property this property property public void execute throws BuildException if property null throw new BuildException getLocation if file null throw new BuildException getLocation else String value file getParent getProject setNewProperty property value public class P4Fstat extends P4Base private int changelist private String addCmd private Vector filesets new Vector private static final int DEFAULT_CMD_LENGTH private int cmdLength DEFAULT_CMD_LENGTH private static final int SHOW_ALL private static final int SHOW_EXISTING private static final int SHOW_NON_EXISTING private int show SHOW_NON_EXISTING private FStatP4OutputHandler handler private StringBuffer filelist private int fileNum private int doneFileNum private boolean debug false private static final String EXISTING_HEADER private static final String NONEXISTING_HEADER public void setShowFilter String filter if filter equalsIgnoreCase show SHOW_ALL else if filter equalsIgnoreCase show SHOW_EXISTING else if filter equalsIgnoreCase show SHOW_NON_EXISTING else throw new BuildException public void setChangelist int changelist throws BuildException if changelist throw new BuildException this changelist changelist public void addFileset FileSet set filesets addElement set public void execute throws BuildException handler new FStatP4OutputHandler this if P4View null addCmd P4View P4CmdOpts changelist changelist filelist new StringBuffer for int filesets size FileSet fs FileSet filesets elementAt DirectoryScanner ds fs getDirectoryScanner getProject String srcFiles ds getIncludedFiles fileNum srcFiles length if srcFiles null for int srcFiles length File new File ds getBasedir srcFiles filelist append append append getAbsolutePath append doneFileNum if filelist length cmdLength execP4Fstat filelist filelist new StringBuffer if filelist length execP4Fstat filelist else log Project MSG_WARN if show SHOW_ALL show SHOW_EXISTING printRes handler getExisting EXISTING_HEADER if show SHOW_ALL show SHOW_NON_EXISTING printRes handler getNonExisting NONEXISTING_HEADER public int getLengthOfTask return fileNum int getPasses return filesets size private void printRes ArrayList ar String header log header Project MSG_INFO for int ar size log String ar get Project MSG_INFO private void execP4Fstat StringBuffer list String list substring if debug log P4CmdOpts addCmd Project MSG_INFO execP4Command P4CmdOpts addCmd handler public class MSVSSCHECKOUT extends MSVSS protected Commandline buildCmdLine Commandline commandLine new Commandline if getVsspath null String msg throw new BuildException msg getLocation commandLine setExecutable getSSCommand commandLine createArgument setValue COMMAND_CHECKOUT commandLine createArgument setValue getVsspath commandLine createArgument setValue getLocalpath commandLine createArgument setValue getAutoresponse commandLine createArgument setValue getRecursive commandLine createArgument setValue getVersionDateLabel commandLine createArgument setValue getLogin commandLine createArgument setValue getFileTimeStamp commandLine createArgument setValue getWritableFiles commandLine createArgument setValue getGetLocalCopy return commandLine public void setLocalpath Path localPath super setInternalLocalPath localPath toString public void setRecursive boolean recursive super setInternalRecursive recursive public void setVersion String version super setInternalVersion version public void setDate String date super setInternalDate date public void setLabel String label super setInternalLabel label public void setAutoresponse String response super setInternalAutoResponse response public void setFileTimeStamp CurrentModUpdated timestamp super setInternalFileTimeStamp timestamp public void setWritableFiles WritableFiles files super setInternalWritableFiles files public void setGetLocalCopy boolean get super setInternalGetLocalCopy get class LibraryDisplayer void displayLibrary final File file throws BuildException final Manifest manifest ExtensionUtil getManifest file displayLibrary file manifest void displayLibrary final File file final Manifest manifest throws BuildException final Extension available Extension getAvailable manifest final Extension required Extension getRequired manifest final Extension options Extension getOptions manifest final Specification specifications getSpecifications manifest if available length required length options length specifications length return final String message file final int size message length printLine size System out println message printLine size if available length System out println for int available length final Extension extension available System out println extension toString if required length System out println for int required length final Extension extension required System out println extension toString if options length System out println for int options length final Extension extension options System out println extension toString if specifications length System out println for int specifications length final Specification specification specifications displaySpecification specification private void printLine final int size for int size System out print System out println private Specification getSpecifications final Manifest manifest throws BuildException try return Specification getSpecifications manifest catch final ParseException pe throw new BuildException pe getMessage pe private void displaySpecification final Specification specification final String sections specification getSections if null sections final StringBuffer sb new StringBuffer for int sections length sb append sb append sections System out println sb System out println specification toString public class TarScanner extends ArchiveScanner protected void fillMapsFromArchive Resource src String encoding Map fileEntries Map matchFileEntries Map dirEntries Map matchDirEntries TarEntry entry null TarInputStream ti null try try ti new TarInputStream src getInputStream catch IOException ex throw new BuildException srcFile ex while entry ti getNextEntry null Resource new TarResource src entry String name entry getName if entry isDirectory name trimSeparator name dirEntries put name if match name matchDirEntries put name else fileEntries put name if match name matchFileEntries put name catch IOException ex throw new BuildException srcFile ex finally if ti null try ti close catch IOException ex public final class ConcatFilter extends BaseParamFilterReader implements ChainableReader private File prepend private File append private Reader prependReader null private Reader appendReader null public ConcatFilter super public ConcatFilter final Reader in super in public int read throws IOException if getInitialized initialize setInitialized true int ch if prependReader null ch prependReader read if ch prependReader close prependReader null if ch ch super read if ch if appendReader null ch appendReader read if ch appendReader close appendReader null return ch public void setPrepend final File prepend this prepend prepend public File getPrepend return prepend public void setAppend final File append this append append public File getAppend return append public Reader chain final Reader rdr ConcatFilter newFilter new ConcatFilter rdr newFilter setPrepend getPrepend newFilter setAppend getAppend return newFilter private void initialize throws IOException Parameter params getParameters if params null for int params length if equals params getName setPrepend new File params getValue continue if equals params getName setAppend new File params getValue continue if prepend null if prepend isAbsolute prepend new File getProject getBaseDir prepend getPath prependReader new BufferedReader new FileReader prepend if append null if append isAbsolute append new File getProject getBaseDir append getPath appendReader new BufferedReader new FileReader append public class ImportTask extends Task private String file private boolean optional private static final FileUtils FILE_UTILS FileUtils getFileUtils public void setOptional boolean optional this optional optional public void setFile String file this file file public void execute if file null if getOwningTarget null equals getOwningTarget getName ProjectHelper helper ProjectHelper getProject getReference ProjectHelper PROJECTHELPER_REFERENCE if helper null if getLocation null getLocation getFileName null File buildFile new File getLocation getFileName getAbsoluteFile File buildFileParent new File buildFile getParent buildFile getAbsolutePath Project MSG_VERBOSE String message buildFile getAbsolutePath if optional getProject log message Project MSG_VERBOSE return else throw new BuildException message getProject log return try catch BuildException ex throw ProjectHelper addLocationToBuildException ex getLocation public class P4Resolve extends P4Base private String resolvemode null private static final String AUTOMATIC private static final String FORCE private static final String SAFE private static final String THEIRS private static final String YOURS private static final String RESOLVE_MODES AUTOMATIC FORCE SAFE THEIRS YOURS public String getResolvemode return resolvemode public void setResolvemode String resolvemode boolean found false for int counter counter RESOLVE_MODES length counter if resolvemode equals RESOLVE_MODES counter found true break if found throw new BuildException this resolvemode resolvemode public boolean isRedoall return redoall public void setRedoall boolean redoall this redoall redoall public boolean isSimulationmode return simulationmode public void setSimulationmode boolean simulationmode this simulationmode simulationmode public boolean isForcetextmode return forcetextmode public void setForcetextmode boolean forcetextmode this forcetextmode forcetextmode public boolean isMarkersforall return markersforall public void setMarkersforall boolean markersforall this markersforall markersforall public void execute throws BuildException if this resolvemode equals AUTOMATIC P4CmdOpts P4CmdOpts else if this resolvemode equals FORCE P4CmdOpts P4CmdOpts else if this resolvemode equals SAFE P4CmdOpts P4CmdOpts else if this resolvemode equals THEIRS P4CmdOpts P4CmdOpts else if this resolvemode equals YOURS P4CmdOpts P4CmdOpts else throw new BuildException if P4View null throw new BuildException if this isRedoall P4CmdOpts P4CmdOpts if this isSimulationmode P4CmdOpts P4CmdOpts if this isForcetextmode P4CmdOpts P4CmdOpts if this isMarkersforall P4CmdOpts P4CmdOpts execP4Command P4CmdOpts P4View new SimpleP4OutputHandler this public class SendEmail extends EmailTask public void setMailport Integer value setMailport value intValue public class Delete extends MatchingTask private static final int DELETE_RETRY_SLEEP_MILLIS private static final ResourceComparator REVERSE_FILESYSTEM new Reverse new FileSystem private static final ResourceSelector EXISTS new Exists private static class ReverseDirs implements ResourceCollection static final Comparator REVERSE new Comparator public int compare Object foo Object bar return Comparable foo compareTo bar private File basedir private String dirs ReverseDirs File basedir String dirs this basedir basedir this dirs dirs Arrays sort this dirs REVERSE public Iterator iterator return new FileResourceIterator basedir dirs public boolean isFilesystemOnly return true public int size return dirs length protected File file null protected File dir null protected Vector filesets new Vector protected boolean usedMatchingTask false protected boolean includeEmpty false private int verbosity Project MSG_VERBOSE private boolean quiet false private boolean failonerror true private boolean deleteOnExit false private Resources rcs null public void setFile File file this file file public void setDir File dir this dir dir getImplicitFileSet setDir dir public void setVerbose boolean verbose if verbose this verbosity Project MSG_INFO else this verbosity Project MSG_VERBOSE public void setQuiet boolean quiet this quiet quiet if quiet this failonerror false public void setFailOnError boolean failonerror this failonerror failonerror public void setDeleteOnExit boolean deleteOnExit this deleteOnExit deleteOnExit public void setIncludeEmptyDirs boolean includeEmpty this includeEmpty includeEmpty public void addFileset FileSet set filesets addElement set public void add ResourceCollection rc if rc null return rcs rcs null new Resources rcs rcs add rc public PatternSet NameEntry createInclude usedMatchingTask true return super createInclude public PatternSet NameEntry createIncludesFile usedMatchingTask true return super createIncludesFile public PatternSet NameEntry createExclude usedMatchingTask true return super createExclude public PatternSet NameEntry createExcludesFile usedMatchingTask true return super createExcludesFile public PatternSet createPatternSet usedMatchingTask true return super createPatternSet public void setIncludes String includes usedMatchingTask true super setIncludes includes public void setExcludes String excludes usedMatchingTask true super setExcludes excludes public void setDefaultexcludes boolean useDefaultExcludes usedMatchingTask true super setDefaultexcludes useDefaultExcludes public void setIncludesfile File includesfile usedMatchingTask true super setIncludesfile includesfile public void setExcludesfile File excludesfile usedMatchingTask true super setExcludesfile excludesfile public void setCaseSensitive boolean isCaseSensitive usedMatchingTask true super setCaseSensitive isCaseSensitive public void setFollowSymlinks boolean followSymlinks usedMatchingTask true super setFollowSymlinks followSymlinks public void addSelector SelectSelector selector usedMatchingTask true super addSelector selector public void addAnd AndSelector selector usedMatchingTask true super addAnd selector public void addOr OrSelector selector usedMatchingTask true super addOr selector public void addNot NotSelector selector usedMatchingTask true super addNot selector public void addNone NoneSelector selector usedMatchingTask true super addNone selector public void addMajority MajoritySelector selector usedMatchingTask true super addMajority selector public void addDate DateSelector selector usedMatchingTask true super addDate selector public void addSize SizeSelector selector usedMatchingTask true super addSize selector public void addFilename FilenameSelector selector usedMatchingTask true super addFilename selector public void addCustom ExtendSelector selector usedMatchingTask true super addCustom selector public void addContains ContainsSelector selector usedMatchingTask true super addContains selector public void addPresent PresentSelector selector usedMatchingTask true super addPresent selector public void addDepth DepthSelector selector usedMatchingTask true super addDepth selector public void addDepend DependSelector selector usedMatchingTask true super addDepend selector public void addContainsRegexp ContainsRegexpSelector selector usedMatchingTask true super addContainsRegexp selector public void addModified ModifiedSelector selector usedMatchingTask true super addModified selector public void add FileSelector selector usedMatchingTask true super add selector public void execute throws BuildException if usedMatchingTask log quiet Project MSG_VERBOSE verbosity if file null dir null filesets size rcs null throw new BuildException if quiet failonerror throw new BuildException getLocation if file null if file exists if file isDirectory log file getAbsolutePath quiet Project MSG_VERBOSE verbosity else log file getAbsolutePath if delete file handle file getAbsolutePath else log file getAbsolutePath quiet Project MSG_VERBOSE verbosity if dir null dir exists dir isDirectory usedMatchingTask if verbosity Project MSG_VERBOSE log dir getAbsolutePath removeDir dir Resources resourcesToDelete new Resources resourcesToDelete setProject getProject Resources filesetDirs new Resources filesetDirs setProject getProject FileSet implicit null if usedMatchingTask dir null dir isDirectory implicit getImplicitFileSet implicit setProject getProject filesets add implicit for int size filesets size size FileSet fs FileSet filesets get if fs getProject null log Project MSG_VERBOSE fs FileSet fs clone fs setProject getProject if fs getDir isDirectory handle fs getDir else resourcesToDelete add fs if includeEmpty filesetDirs add new ReverseDirs fs getDir fs getDirectoryScanner getIncludedDirectories resourcesToDelete add filesetDirs if rcs null Restrict exists new Restrict exists add EXISTS exists add rcs Sort new Sort add REVERSE_FILESYSTEM add exists resourcesToDelete add try if resourcesToDelete isFilesystemOnly for Iterator iter resourcesToDelete iterator iter hasNext FileResource FileResource iter next if isExists continue if isDirectory getFile list length log verbosity if delete getFile failonerror handle isDirectory else handle getTaskName catch Exception handle finally if implicit null filesets remove implicit private void handle String msg handle new BuildException msg private void handle Exception if failonerror throw instanceof BuildException BuildException new BuildException log quiet Project MSG_VERBOSE verbosity private boolean delete File if delete if Os isFamily System gc try Thread sleep DELETE_RETRY_SLEEP_MILLIS catch InterruptedException ex if delete if deleteOnExit int level quiet Project MSG_VERBOSE Project MSG_INFO log level deleteOnExit return true return false return true protected void removeDir File String list list if list null list new String for int list length String list File new File if isDirectory removeDir else log getAbsolutePath quiet Project MSG_VERBOSE verbosity if delete handle getAbsolutePath log getAbsolutePath verbosity if delete handle dir getAbsolutePath protected void removeFiles File String files String dirs if files length log files length getAbsolutePath quiet Project MSG_VERBOSE verbosity for int files length File new File files log getAbsolutePath quiet Project MSG_VERBOSE verbosity if delete handle getAbsolutePath if dirs length includeEmpty int dirCount for int dirs length File currDir new File dirs String dirFiles currDir list if dirFiles null dirFiles length log currDir getAbsolutePath quiet Project MSG_VERBOSE verbosity if delete currDir handle currDir getAbsolutePath else dirCount if dirCount log dirCount dirCount getAbsolutePath quiet Project MSG_VERBOSE verbosity public class StringTokenizer extends ProjectComponent implements Tokenizer private String intraString private int pushed private char delims null private boolean delimsAreTokens false private boolean suppressDelims false private boolean includeDelims false public void setDelims String delims this delims StringUtils resolveBackSlash delims toCharArray public void setDelimsAreTokens boolean delimsAreTokens this delimsAreTokens delimsAreTokens public void setSuppressDelims boolean suppressDelims this suppressDelims suppressDelims public void setIncludeDelims boolean includeDelims this includeDelims includeDelims public String getToken Reader in throws IOException int ch if pushed ch pushed pushed else ch in read if ch return null boolean inToken true intraString StringBuffer word new StringBuffer StringBuffer padding new StringBuffer while ch char char ch boolean isDelim isDelim if inToken if isDelim if delimsAreTokens if word length word append else pushed ch break padding append inToken false else word append else if isDelim padding append else pushed ch break ch in read intraString padding toString if includeDelims word append intraString return word toString public String getPostToken return suppressDelims includeDelims intraString private boolean isDelim char ch if delims null return Character isWhitespace ch for int delims length if delims ch return true return false public class Input extends Task public class Handler extends DefBase private String refid null private HandlerType type null private String classname null public void setRefid String refid this refid refid public String getRefid return refid public void setClassname String classname this classname classname public String getClassname return classname public void setType HandlerType type this type type public HandlerType getType return type private InputHandler getInputHandler if type null return type getInputHandler if refid null try return InputHandler getProject getReference refid catch ClassCastException throw new BuildException refid if classname null return InputHandler ClasspathUtils newInstance classname createLoader InputHandler class throw new BuildException public static class HandlerType extends EnumeratedAttribute private static final String VALUES private static final InputHandler HANDLERS new DefaultInputHandler new PropertyFileInputHandler new GreedyInputHandler public String getValues return VALUES private InputHandler getInputHandler return HANDLERS getIndex private String validargs null private String message private String addproperty null private String defaultvalue null private Handler handler null private boolean messageAttribute public void setValidargs String validargs this validargs validargs public void setAddproperty String addproperty this addproperty addproperty public void setMessage String message this message message messageAttribute true public void setDefaultvalue String defaultvalue this defaultvalue defaultvalue public void addText String msg if messageAttribute equals msg trim return message getProject replaceProperties msg public Input public void execute throws BuildException if addproperty null getProject getProperty addproperty null log getTaskName addproperty return InputRequest request null if validargs null Vector accept StringUtils split validargs request new MultipleChoiceInputRequest message accept else request new InputRequest message request setDefaultValue defaultvalue InputHandler handler null getProject getInputHandler handler getInputHandler handleInput request String value request getInput if value null value trim length defaultvalue null value defaultvalue if addproperty null value null getProject setNewProperty addproperty value public Handler createHandler if handler null throw new BuildException handler new Handler return handler public abstract class SOS extends Task implements SOSCmd private String sosCmdDir null private String sosUsername null private String sosPassword private String projectPath null private String vssServerPath null private String sosServerPath null private String sosHome null private String localPath null private String version null private String label null private String comment null private String filename null private boolean noCompress false private boolean noCache false private boolean recursive false private boolean verbose false protected Commandline commandLine public final void setNoCache boolean nocache noCache nocache public final void setNoCompress boolean nocompress noCompress nocompress public final void setSosCmd String dir sosCmdDir FileUtils translatePath dir public final void setUsername String username sosUsername username public final void setPassword String password sosPassword password public final void setProjectPath String projectpath if projectpath startsWith SOSCmd PROJECT_PREFIX projectPath projectpath else projectPath SOSCmd PROJECT_PREFIX projectpath public final void setVssServerPath String vssServerPath this vssServerPath vssServerPath public final void setSosHome String sosHome this sosHome sosHome public final void setSosServerPath String sosServerPath this sosServerPath sosServerPath public final void setLocalPath Path path localPath path toString public void setVerbose boolean verbose this verbose verbose protected void setInternalFilename String file filename file protected void setInternalRecursive boolean recurse recursive recurse protected void setInternalComment String text comment text protected void setInternalLabel String text label text protected void setInternalVersion String text version text protected String getSosCommand if sosCmdDir null return COMMAND_SOS_EXE else return sosCmdDir File separator COMMAND_SOS_EXE protected String getComment return comment protected String getVersion return version protected String getLabel return label protected String getUsername return sosUsername protected String getPassword return sosPassword protected String getProjectPath return projectPath protected String getVssServerPath return vssServerPath protected String getSosHome return sosHome protected String getSosServerPath return sosServerPath protected String getFilename return filename protected String getNoCompress return noCompress FLAG_NO_COMPRESSION protected String getNoCache return noCache FLAG_NO_CACHE protected String getVerbose return verbose FLAG_VERBOSE protected String getRecursive return recursive FLAG_RECURSION protected String getLocalPath if localPath null return getProject getBaseDir getAbsolutePath else File dir getProject resolveFile localPath if dir exists boolean done dir mkdirs if done String msg localPath throw new BuildException msg getLocation getProject log dir getAbsolutePath return dir getAbsolutePath abstract Commandline buildCmdLine public void execute throws BuildException int result buildCmdLine result run commandLine String msg commandLine toString throw new BuildException msg getLocation protected int run Commandline cmd try Execute exe new Execute new LogStreamHandler this Project MSG_INFO Project MSG_WARN exe setAntRun getProject exe setWorkingDirectory getProject getBaseDir exe setCommandline cmd getCommandline return exe execute catch java io IOException throw new BuildException getLocation protected void getRequiredAttributes commandLine setExecutable getSosCommand if getSosServerPath null throw new BuildException getLocation commandLine createArgument setValue FLAG_SOS_SERVER commandLine createArgument setValue getSosServerPath if getUsername null throw new BuildException getLocation commandLine createArgument setValue FLAG_USERNAME commandLine createArgument setValue getUsername commandLine createArgument setValue FLAG_PASSWORD commandLine createArgument setValue getPassword if getVssServerPath null throw new BuildException getLocation commandLine createArgument setValue FLAG_VSS_SERVER commandLine createArgument setValue getVssServerPath if getProjectPath null throw new BuildException getLocation commandLine createArgument setValue FLAG_PROJECT commandLine createArgument setValue getProjectPath protected void getOptionalAttributes commandLine createArgument setValue getVerbose commandLine createArgument setValue getNoCompress if getSosHome null commandLine createArgument setValue getNoCache else commandLine createArgument setValue FLAG_SOS_HOME commandLine createArgument setValue getSosHome if getLocalPath null commandLine createArgument setValue FLAG_WORKING_DIR commandLine createArgument setValue getLocalPath public class DotnetDefine private String name private String ifCond private String unlessCond public void setIf String condition this ifCond condition public void setUnless String condition this unlessCond condition public String getName return name public void setName String name this name name public String getValue Task owner throws BuildException if name null throw new BuildException owner getLocation if isSet owner return null return name public boolean isSet Task owner Project owner getProject if ifCond null getProperty ifCond null return false else if unlessCond null getProperty unlessCond null return false return true public class CCMCheckin extends CCMCheck public CCMCheckin super setCcmAction COMMAND_CHECKIN setComment new Date public interface SubBuildListener extends BuildListener void subBuildStarted BuildEvent event void subBuildFinished BuildEvent event public class XmlProperty extends org apache tools ant Task private Resource src private String prefix private boolean keepRoot true private boolean validate false private boolean collapseAttributes false private boolean semanticAttributes false private boolean includeSemanticAttribute false private File rootDirectory null private Hashtable addedAttributes new Hashtable private XMLCatalog xmlCatalog new XMLCatalog private static final String ID private static final String REF_ID private static final String LOCATION private static final String VALUE private static final String PATH private static final String PATHID private static final String ATTRIBUTES new String ID REF_ID LOCATION VALUE PATH PATHID private static final FileUtils FILE_UTILS FileUtils getFileUtils public XmlProperty super public void init super init xmlCatalog setProject getProject protected EntityResolver getEntityResolver return xmlCatalog public void execute throws BuildException Resource getResource if null String msg throw new BuildException msg try log src Project MSG_VERBOSE if isExists DocumentBuilderFactory factory DocumentBuilderFactory newInstance factory setValidating validate factory setNamespaceAware false DocumentBuilder builder factory newDocumentBuilder builder setEntityResolver getEntityResolver Document document null if src instanceof FileResource document builder parse FileResource src getFile else document builder parse src getInputStream Element topElement document getDocumentElement addedAttributes new Hashtable if keepRoot addNodeRecursively topElement prefix null else NodeList topChildren topElement getChildNodes int numChildren topChildren getLength for int numChildren addNodeRecursively topChildren item prefix null else log Project MSG_VERBOSE catch SAXException sxe Exception sxe if sxe getException null sxe getException throw new BuildException src catch ParserConfigurationException pce throw new BuildException pce catch IOException ioe throw new BuildException src ioe private void addNodeRecursively Node node String prefix Object container String nodePrefix prefix if node getNodeType Node TEXT_NODE if prefix trim length nodePrefix nodePrefix node getNodeName Object nodeObject processNode node nodePrefix container if node hasChildNodes NodeList nodeChildren node getChildNodes int numChildren nodeChildren getLength for int numChildren addNodeRecursively nodeChildren item nodePrefix nodeObject void addNodeRecursively org w3c dom Node node String prefix addNodeRecursively node prefix null public Object processNode Node node String prefix Object container Object addedPath null String id null if node hasAttributes NamedNodeMap nodeAttributes node getAttributes Node idNode nodeAttributes getNamedItem ID id semanticAttributes idNode null idNode getNodeValue null for int nodeAttributes getLength Node attributeNode nodeAttributes item if semanticAttributes String attributeName getAttributeName attributeNode String attributeValue getAttributeValue attributeNode addProperty prefix attributeName attributeValue null else String nodeName attributeNode getNodeName String attributeValue getAttributeValue attributeNode Path containingPath container null container instanceof Path Path container null if nodeName equals ID continue else if containingPath null nodeName equals PATH containingPath setPath attributeValue else if container instanceof Path nodeName equals REF_ID containingPath setPath attributeValue else if container instanceof Path nodeName equals LOCATION containingPath setLocation resolveFile attributeValue else if nodeName equals PATHID if container null throw new BuildException addedPath new Path getProject getProject addReference attributeValue addedPath else String attributeName getAttributeName attributeNode addProperty prefix attributeName attributeValue id String nodeText null boolean emptyNode false boolean semanticEmptyOverride false if node getNodeType Node ELEMENT_NODE semanticAttributes node hasAttributes node getAttributes getNamedItem VALUE null node getAttributes getNamedItem LOCATION null node getAttributes getNamedItem REF_ID null node getAttributes getNamedItem PATH null node getAttributes getNamedItem PATHID null semanticEmptyOverride true if node getNodeType Node TEXT_NODE nodeText getAttributeValue node else if node getNodeType Node ELEMENT_NODE node getChildNodes getLength node getFirstChild getNodeType Node CDATA_SECTION_NODE nodeText node getFirstChild getNodeValue if equals nodeText semanticEmptyOverride emptyNode true else if node getNodeType Node ELEMENT_NODE node getChildNodes getLength semanticEmptyOverride nodeText emptyNode true else if node getNodeType Node ELEMENT_NODE node getChildNodes getLength node getFirstChild getNodeType Node TEXT_NODE equals node getFirstChild getNodeValue semanticEmptyOverride nodeText emptyNode true if nodeText null if semanticAttributes id null container instanceof String id String container if nodeText trim length emptyNode addProperty prefix nodeText id return addedPath null addedPath id private void addProperty String name String value String id String msg name value if id null msg id log msg Project MSG_DEBUG if addedAttributes containsKey name value String addedAttributes get name value getProject setProperty name value addedAttributes put name value else if getProject getProperty name null getProject setNewProperty name value addedAttributes put name value else log name Project MSG_VERBOSE if id null getProject addReference id value private String getAttributeName Node attributeNode String attributeName attributeNode getNodeName if semanticAttributes if attributeName equals REF_ID return else if isSemanticAttribute attributeName includeSemanticAttribute return attributeName else return else if collapseAttributes return attributeName else return attributeName private static boolean isSemanticAttribute String attributeName for int ATTRIBUTES length if attributeName equals ATTRIBUTES return true return false private String getAttributeValue Node attributeNode String nodeValue attributeNode getNodeValue trim if semanticAttributes String attributeName attributeNode getNodeName nodeValue getProject replaceProperties nodeValue if attributeName equals LOCATION File resolveFile nodeValue return getPath else if attributeName equals REF_ID Object ref getProject getReference nodeValue if ref null return ref toString return nodeValue public void setFile File src setSrcResource new FileResource src public void setSrcResource Resource src if src isDirectory throw new BuildException if src instanceof FileResource supportsNonFileResources throw new BuildException this src src public void addConfigured ResourceCollection if size throw new BuildException setSrcResource Resource iterator next public void setPrefix String prefix this prefix prefix trim public void setKeeproot boolean keepRoot this keepRoot keepRoot public void setValidate boolean validate this validate validate public void setCollapseAttributes boolean collapseAttributes this collapseAttributes collapseAttributes public void setSemanticAttributes boolean semanticAttributes this semanticAttributes semanticAttributes public void setRootDirectory File rootDirectory this rootDirectory rootDirectory public void setIncludeSemanticAttribute boolean includeSemanticAttribute this includeSemanticAttribute includeSemanticAttribute public void addConfiguredXMLCatalog XMLCatalog catalog xmlCatalog addConfiguredXMLCatalog catalog protected File getFile if src instanceof FileResource return FileResource src getFile else return null protected Resource getResource File getFile if null return new FileResource else return src protected String getPrefix return this prefix protected boolean getKeeproot return this keepRoot protected boolean getValidate return this validate protected boolean getCollapseAttributes return this collapseAttributes protected boolean getSemanticAttributes return this semanticAttributes protected File getRootDirectory return this rootDirectory protected boolean getIncludeSementicAttribute return this includeSemanticAttribute private File resolveFile String fileName if rootDirectory null return FILE_UTILS resolveFile getProject getBaseDir fileName return FILE_UTILS resolveFile rootDirectory fileName protected boolean supportsNonFileResources return getClass equals XmlProperty class public class GZipResource extends CompressedResource public GZipResource public GZipResource org apache tools ant types ResourceCollection other super other protected InputStream wrapStream InputStream in throws IOException return new GZIPInputStream in protected OutputStream wrapStream OutputStream out throws IOException return new GZIPOutputStream out protected String getCompressionName return public class Main implements AntMain public static final String DEFAULT_BUILD_FILENAME private int msgOutputLevel Project MSG_INFO private static PrintStream out System out private static PrintStream err System err private Vector targets new Vector private Properties definedProps new Properties private Vector listeners new Vector private Vector propertyFiles new Vector private boolean allowInput true private boolean keepGoingMode false private String loggerClassname null private String inputHandlerClassname null private boolean emacsMode false private boolean readyToRun false private boolean projectHelp false private static boolean isLogFileUsed false private Integer threadPriority null private boolean proxy false private static void printMessage Throwable String message getMessage if message null System err println message public static void start String args Properties additionalUserProperties ClassLoader coreLoader Main new Main startAnt args additionalUserProperties coreLoader public void startAnt String args Properties additionalUserProperties ClassLoader coreLoader try Diagnostics validateVersion processArgs args catch Throwable exc handleLogfile printMessage exc exit return if additionalUserProperties null for Enumeration additionalUserProperties keys hasMoreElements String key String nextElement String property additionalUserProperties getProperty key definedProps put key property int exitCode try try runBuild coreLoader exitCode catch ExitStatusException ese exitCode ese getStatus if exitCode throw ese catch BuildException be if err System err printMessage be catch Throwable exc exc printStackTrace printMessage exc finally handleLogfile exit exitCode protected void exit int exitCode System exit exitCode private static void handleLogfile if isLogFileUsed FileUtils close out FileUtils close err public static void main String args start args null null public Main protected Main String args throws BuildException processArgs args private void processArgs String args String searchForThis null PrintStream logTo null HashMap launchCommands new HashMap launchCommands put launchCommands put launchCommands put launchCommands put launchCommands put launchCommands put launchCommands put for int args length String arg args if arg equals arg equals printUsage return else if arg equals printVersion return else if arg equals Diagnostics doReport System out return else if arg equals arg equals msgOutputLevel Project MSG_WARN else if arg equals arg equals printVersion msgOutputLevel Project MSG_VERBOSE else if arg equals arg equals printVersion msgOutputLevel Project MSG_DEBUG else if arg equals allowInput false else if arg equals arg equals try File logFile new File args logTo new PrintStream new FileOutputStream logFile isLogFileUsed true catch IOException ioe String msg throw new BuildException msg catch ArrayIndexOutOfBoundsException aioobe String msg throw new BuildException msg else if arg equals arg equals arg equals try buildFile new File args replace File separatorChar catch ArrayIndexOutOfBoundsException aioobe String msg throw new BuildException msg else if arg equals try listeners addElement args catch ArrayIndexOutOfBoundsException aioobe String msg throw new BuildException msg else if arg startsWith String name arg substring arg length String value null int posEq name indexOf if posEq value name substring posEq name name substring posEq else if args length value args else throw new BuildException name definedProps put name value else if arg equals if loggerClassname null throw new BuildException try loggerClassname args catch ArrayIndexOutOfBoundsException aioobe throw new BuildException else if arg equals if inputHandlerClassname null throw new BuildException try inputHandlerClassname args catch ArrayIndexOutOfBoundsException aioobe throw new BuildException else if arg equals arg equals emacsMode true else if arg equals arg equals projectHelp true else if arg equals arg equals if args length searchForThis args else searchForThis DEFAULT_BUILD_FILENAME else if arg startsWith try propertyFiles addElement args catch ArrayIndexOutOfBoundsException aioobe String msg throw new BuildException msg else if arg equals arg equals keepGoingMode true else if arg equals try threadPriority Integer decode args catch ArrayIndexOutOfBoundsException aioobe throw new BuildException catch NumberFormatException throw new BuildException args if threadPriority intValue Thread MIN_PRIORITY threadPriority intValue Thread MAX_PRIORITY throw new BuildException else if launchCommands get arg null String msg arg throw new BuildException msg else if arg equals proxy false else if arg startsWith String msg arg System err println msg printUsage throw new BuildException else targets addElement arg if buildFile null if searchForThis null buildFile findBuildFile System getProperty searchForThis else buildFile new File DEFAULT_BUILD_FILENAME if buildFile exists System out println buildFile throw new BuildException if buildFile isDirectory System out println buildFile throw new BuildException for int propertyFileIndex propertyFileIndex propertyFiles size propertyFileIndex String filename String propertyFiles elementAt propertyFileIndex Properties props new Properties FileInputStream fis null try fis new FileInputStream filename props load fis catch IOException System out println filename getMessage finally FileUtils close fis Enumeration propertyNames props propertyNames while propertyNames hasMoreElements String name String propertyNames nextElement if definedProps getProperty name null definedProps put name props getProperty name if msgOutputLevel Project MSG_INFO System out println buildFile if logTo null out logTo err logTo System setOut out System setErr err readyToRun true private File getParentFile File file File parent file getParentFile if parent null msgOutputLevel Project MSG_VERBOSE System out println parent getAbsolutePath return parent private File findBuildFile String start String suffix throws BuildException if msgOutputLevel Project MSG_INFO System out println suffix File parent new File new File start getAbsolutePath File file new File parent suffix while file exists parent getParentFile parent if parent null throw new BuildException file new File parent suffix return file private void runBuild ClassLoader coreLoader throws BuildException if readyToRun return final Project project new Project project setCoreLoader coreLoader Throwable error null try addBuildListeners project addInputHandler project PrintStream savedErr System err PrintStream savedOut System out InputStream savedIn System in SecurityManager oldsm null oldsm System getSecurityManager try if allowInput project setDefaultInputStream System in System setIn new DemuxInputStream project System setOut new PrintStream new DemuxOutputStream project false System setErr new PrintStream new DemuxOutputStream project true if projectHelp project fireBuildStarted if threadPriority null try project log threadPriority Project MSG_VERBOSE Thread currentThread setPriority threadPriority intValue catch SecurityException swallowed project log project init Enumeration definedProps keys while hasMoreElements String arg String nextElement String value String definedProps get arg project setUserProperty arg value project setUserProperty MagicNames ANT_FILE buildFile getAbsolutePath project setKeepGoingMode keepGoingMode if proxy ProxySetup proxySetup new ProxySetup project proxySetup enableProxies ProjectHelper configureProject project buildFile if projectHelp printDescription project printTargets project msgOutputLevel Project MSG_INFO return if targets size if project getDefaultTarget null targets addElement project getDefaultTarget project executeTargets targets finally if oldsm null System setSecurityManager oldsm System setOut savedOut System setErr savedErr System setIn savedIn catch RuntimeException exc error exc throw exc catch Error error throw finally if projectHelp project fireBuildFinished error else if error null project log error toString Project MSG_ERR protected void addBuildListeners Project project project addBuildListener createLogger for int listeners size String className String listeners elementAt BuildListener listener BuildListener ClasspathUtils newInstance className Main class getClassLoader BuildListener class if project null project setProjectReference listener project addBuildListener listener private void addInputHandler Project project throws BuildException InputHandler handler null if inputHandlerClassname null handler new DefaultInputHandler else handler InputHandler ClasspathUtils newInstance inputHandlerClassname Main class getClassLoader InputHandler class if project null project setProjectReference handler project setInputHandler handler private BuildLogger createLogger BuildLogger logger null if loggerClassname null try logger BuildLogger ClasspathUtils newInstance loggerClassname Main class getClassLoader BuildLogger class catch BuildException System err println loggerClassname getMessage throw new RuntimeException else logger new DefaultLogger logger setMessageOutputLevel msgOutputLevel logger setOutputPrintStream out logger setErrorPrintStream err logger setEmacsMode emacsMode return logger private static void printUsage String lSep System getProperty StringBuffer msg new StringBuffer msg append lSep msg append lSep msg append lSep msg append lSep msg append lSep msg append lSep msg append lSep msg append lSep msg append lSep msg append lSep msg append lSep msg append lSep msg append lSep msg append lSep msg append lSep msg append lSep msg append lSep msg append lSep msg append lSep msg append lSep msg append lSep msg append lSep msg append lSep msg append lSep msg append lSep msg append lSep msg append lSep msg append lSep msg append lSep lSep msg append lSep lSep msg append lSep msg append lSep msg append System out println msg toString private static void printVersion throws BuildException System out println getAntVersion private static String antVersion null public static synchronized String getAntVersion throws BuildException if antVersion null try Properties props new Properties InputStream in Main class getResourceAsStream props load in in close StringBuffer msg new StringBuffer msg append msg append props getProperty msg append msg append props getProperty antVersion msg toString catch IOException ioe throw new BuildException ioe getMessage catch NullPointerException npe throw new BuildException return antVersion private static void printDescription Project project if project getDescription null project log project getDescription private static void printTargets Project project boolean printSubTargets int maxLength Enumeration ptargets project getTargets elements String targetName String targetDescription Target currentTarget Vector topNames new Vector Vector topDescriptions new Vector Vector subNames new Vector while ptargets hasMoreElements currentTarget Target ptargets nextElement targetName currentTarget getName if targetName equals continue targetDescription currentTarget getDescription if targetDescription null int pos findTargetPosition subNames targetName subNames insertElementAt targetName pos else int pos findTargetPosition topNames targetName topNames insertElementAt targetName pos topDescriptions insertElementAt targetDescription pos if targetName length maxLength maxLength targetName length printTargets project topNames topDescriptions maxLength if topNames size printSubTargets true if printSubTargets printTargets project subNames null String defaultTarget project getDefaultTarget if defaultTarget null equals defaultTarget project log defaultTarget private static int findTargetPosition Vector names String name int res names size for int names size res names size if name compareTo String names elementAt res return res private static void printTargets Project project Vector names Vector descriptions String heading int maxlen String lSep System getProperty String spaces while spaces length maxlen spaces spaces StringBuffer msg new StringBuffer msg append heading lSep lSep for int names size msg append msg append names elementAt if descriptions null msg append spaces substring maxlen String names elementAt length msg append descriptions elementAt msg append lSep project log msg toString Project MSG_WARN public final class LineContainsRegExp extends BaseParamFilterReader implements ChainableReader private static final String REGEXP_KEY private static final String NEGATE_KEY private Vector regexps new Vector private String line null private boolean negate false public LineContainsRegExp super public LineContainsRegExp final Reader in super in public int read throws IOException if getInitialized initialize setInitialized true int ch if line null ch line charAt if line length line null else line line substring else final int regexpsSize regexps size for line readLine line null line readLine boolean matches true for int matches regexpsSize RegularExpression regexp RegularExpression regexps elementAt Regexp re regexp getRegexp getProject matches re matches line if matches isNegated break if line null return read return ch public void addConfiguredRegexp final RegularExpression regExp this regexps addElement regExp private void setRegexps final Vector regexps this regexps regexps private Vector getRegexps return regexps public Reader chain final Reader rdr LineContainsRegExp newFilter new LineContainsRegExp rdr newFilter setRegexps getRegexps newFilter setNegate isNegated return newFilter public void setNegate boolean negate public boolean isNegated return negate private void initialize Parameter params getParameters if params null for int params length if REGEXP_KEY equals params getType String pattern params getValue RegularExpression regexp new RegularExpression regexp setPattern pattern regexps addElement regexp else if NEGATE_KEY equals params getType setNegate Project toBoolean params getValue public class JUnitTask extends Task private static final String CLASSPATH private CommandlineJava commandline private Vector tests new Vector private Vector batchTests new Vector private Vector formatters new Vector private File dir null private Integer timeout null private boolean summary false private boolean reloading true private String summaryValue private JUnitTaskMirror JUnitTestRunnerMirror runner null private boolean newEnvironment false private Environment env new Environment private boolean includeAntRuntime true private Path antRuntimeClasses null private boolean showOutput false private boolean outputToFormatters true private File tmpDir private AntClassLoader classLoader null private Permissions perm null private ForkMode forkMode new ForkMode private boolean splitJunit false private JUnitTaskMirror delegate private boolean haltOnError false private boolean haltOnFail false private boolean filterTrace true private boolean fork false private String failureProperty private String errorProperty private static final int STRING_BUFFER_SIZE public static final String TESTLISTENER_PREFIX private static final FileUtils FILE_UTILS FileUtils getFileUtils public void setReloading boolean value reloading value public void setFiltertrace boolean value this filterTrace value public void setHaltonerror boolean value this haltOnError value public void setErrorProperty String propertyName this errorProperty propertyName public void setHaltonfailure boolean value this haltOnFail value public void setFailureProperty String propertyName this failureProperty propertyName public void setFork boolean value this fork value public void setForkMode ForkMode mode this forkMode mode public void setPrintsummary SummaryAttribute value summaryValue value getValue summary value asBoolean public static class SummaryAttribute extends EnumeratedAttribute public String getValues return new String public boolean asBoolean String getValue return equals equals equals equals public void setTimeout Integer value timeout value public void setMaxmemory String max getCommandline setMaxmemory max public void setJvm String value getCommandline setVm value public Commandline Argument createJvmarg return getCommandline createVmArgument public void setDir File dir this dir dir public void addSysproperty Environment Variable sysp getCommandline addSysproperty sysp public void addConfiguredSysproperty Environment Variable sysp String testString sysp getContent getProject log testString Project MSG_DEBUG getCommandline addSysproperty sysp public void addSyspropertyset PropertySet sysp getCommandline addSyspropertyset sysp public Path createClasspath return getCommandline createClasspath getProject createPath public Path createBootclasspath return getCommandline createBootclasspath getProject createPath public void addEnv Environment Variable var env addVariable var public void setNewenvironment boolean newenv newEnvironment newenv private void preConfigure BaseTest test test setFiltertrace filterTrace test setHaltonerror haltOnError if errorProperty null test setErrorProperty errorProperty test setHaltonfailure haltOnFail if failureProperty null test setFailureProperty failureProperty test setFork fork public void addTest JUnitTest test tests addElement test preConfigure test public BatchTest createBatchTest BatchTest test new BatchTest getProject batchTests addElement test preConfigure test return test public void addFormatter FormatterElement fe formatters addElement fe public void setIncludeantruntime boolean includeAntRuntime public void setShowOutput boolean showOutput this showOutput showOutput public void setOutputToFormatters boolean outputToFormatters this outputToFormatters outputToFormatters public void addAssertions Assertions asserts if getCommandline getAssertions null throw new BuildException getCommandline setAssertions asserts public Permissions createPermissions if perm null perm new Permissions return perm public void setCloneVm boolean cloneVm getCommandline setCloneVm cloneVm public JUnitTask throws Exception getCommandline setClassname public void setTempdir File tmpDir if tmpDir null if tmpDir exists tmpDir isDirectory throw new BuildException tmpDir toString this tmpDir tmpDir public void init antRuntimeClasses new Path getProject splitJunit addClasspathEntry addClasspathEntry addClasspathEntry addClasspathEntry private static JUnitTaskMirror createMirror JUnitTask task ClassLoader loader try catch ClassNotFoundException throw new BuildException task getLocation try Class loader loadClass JUnitTaskMirror class getName if getClassLoader loader throw new BuildException task getLocation Constructor cons getConstructor new Class JUnitTask class return JUnitTaskMirror cons newInstance new Object task catch Exception throw new BuildException task getLocation private final class SplitLoader extends AntClassLoader public SplitLoader ClassLoader parent Path path super parent getProject path true protected synchronized Class loadClass String classname boolean resolve throws ClassNotFoundException Class theClass findLoadedClass classname if theClass null return theClass if isSplit classname theClass findClass classname if resolve resolveClass theClass return theClass else return super loadClass classname resolve private final String splitClasses private boolean isSplit String classname String simplename classname substring classname lastIndexOf for int splitClasses length if simplename equals splitClasses simplename startsWith splitClasses return true return false public void execute throws BuildException ClassLoader myLoader JUnitTask class getClassLoader ClassLoader mirrorLoader if splitJunit Path path new Path getProject path add antRuntimeClasses path add getCommandline getClasspath mirrorLoader new SplitLoader myLoader path else mirrorLoader myLoader delegate createMirror this mirrorLoader List testLists new ArrayList boolean forkPerTest forkMode getValue equals ForkMode PER_TEST if forkPerTest forkMode getValue equals ForkMode ONCE testLists addAll executeOrQueue getIndividualTests forkPerTest final int count batchTests size for int count BatchTest batchtest BatchTest batchTests elementAt testLists addAll executeOrQueue batchtest elements false testLists addAll executeOrQueue tests elements forkPerTest try Iterator iter testLists iterator while iter hasNext List List iter next if size execute JUnitTest get else execute finally deleteClassLoader if mirrorLoader instanceof SplitLoader SplitLoader mirrorLoader cleanup delegate null protected void execute JUnitTest arg throws BuildException JUnitTest test JUnitTest arg clone if test getTodir null test setTodir getProject resolveFile if test getOutfile null test setOutfile test getName TestResultHolder result null if test getFork result executeInVM test else ExecuteWatchdog watchdog createWatchdog result executeAsForked test watchdog null actOnTestResult result test test getName protected void execute List tests throws BuildException JUnitTest test null File casesFile createTempPropertiesFile PrintWriter writer null try writer new PrintWriter new BufferedWriter new FileWriter casesFile Iterator iter tests iterator while iter hasNext test JUnitTest iter next writer print test getName if test getTodir null writer print getProject resolveFile else writer print test getTodir if test getOutfile null writer println test getName else writer println test getOutfile writer flush writer close writer null ExecuteWatchdog watchdog createWatchdog TestResultHolder result executeAsForked test watchdog casesFile actOnTestResult result test catch IOException log toString Project MSG_ERR throw new BuildException finally if writer null writer close try casesFile delete catch Exception log toString Project MSG_ERR private TestResultHolder executeAsForked JUnitTest test ExecuteWatchdog watchdog File casesFile throws BuildException if perm null log Project MSG_WARN CommandlineJava cmd null try cmd CommandlineJava getCommandline clone catch CloneNotSupportedException throw new BuildException getLocation cmd setClassname if casesFile null cmd createArgument setValue test getName else log Project MSG_VERBOSE cmd createArgument setValue Constants TESTSFILE casesFile cmd createArgument setValue Constants FILTERTRACE test getFiltertrace cmd createArgument setValue Constants HALT_ON_ERROR test getHaltonerror cmd createArgument setValue Constants HALT_ON_FAILURE test getHaltonfailure if includeAntRuntime Vector Execute getProcEnvironment Enumeration elements while hasMoreElements String String nextElement if startsWith CLASSPATH cmd createClasspath getProject createPath append new Path getProject substring CLASSPATH length log antRuntimeClasses Project MSG_VERBOSE cmd createClasspath getProject createPath append antRuntimeClasses if summary String prefix if equalsIgnoreCase summaryValue prefix cmd createArgument setValue Constants FORMATTER prefix cmd createArgument setValue Constants SHOWOUTPUT String valueOf showOutput cmd createArgument setValue Constants OUTPUT_TO_FORMATTERS String valueOf outputToFormatters cmd createArgument setValue StringBuffer formatterArg new StringBuffer STRING_BUFFER_SIZE final FormatterElement feArray mergeFormatters test for int feArray length FormatterElement fe feArray if fe shouldUse this formatterArg append Constants FORMATTER formatterArg append fe getClassname File outFile getOutput fe test if outFile null formatterArg append formatterArg append outFile cmd createArgument setValue formatterArg toString formatterArg new StringBuffer File vmWatcher createTempPropertiesFile cmd createArgument setValue Constants CRASHFILE vmWatcher getAbsolutePath File propsFile createTempPropertiesFile cmd createArgument setValue Constants PROPSFILE propsFile getAbsolutePath Hashtable getProject getProperties Properties props new Properties for Enumeration keys hasMoreElements Object key nextElement props put key get key try FileOutputStream outstream new FileOutputStream propsFile props store outstream outstream close catch java io IOException propsFile delete throw new BuildException getLocation Execute execute new Execute new JUnitLogStreamHandler this Project MSG_INFO Project MSG_WARN watchdog execute setCommandline cmd getCommandline execute setAntRun getProject if dir null execute setWorkingDirectory dir String environment env getVariables if environment null for int environment length log environment Project MSG_VERBOSE execute setNewenvironment newEnvironment execute setEnvironment environment log cmd describeCommand Project MSG_VERBOSE TestResultHolder result new TestResultHolder try result exitCode execute execute catch IOException throw new BuildException getLocation finally String vmCrashString BufferedReader br null try br new BufferedReader new FileReader vmWatcher vmCrashString br readLine catch Exception printStackTrace finally FileUtils close br if watchdog null watchdog killedProcess result timedOut true logTimeout feArray test vmCrashString else if Constants TERMINATED_SUCCESSFULLY equals vmCrashString result crashed true logVmCrash feArray test vmCrashString vmWatcher delete if propsFile delete throw new BuildException return result private File createTempPropertiesFile String prefix File propsFile FILE_UTILS createTempFile prefix tmpDir null tmpDir getProject getBaseDir true return propsFile protected void handleOutput String output if output startsWith TESTLISTENER_PREFIX log output Project MSG_VERBOSE else if runner null if outputToFormatters runner handleOutput output if showOutput super handleOutput output else super handleOutput output protected int handleInput byte buffer int offset int length throws IOException if runner null return runner handleInput buffer offset length else return super handleInput buffer offset length protected void handleFlush String output if runner null runner handleFlush output if showOutput super handleFlush output else super handleFlush output public void handleErrorOutput String output if runner null runner handleErrorOutput output if showOutput super handleErrorOutput output else super handleErrorOutput output public void handleErrorFlush String output if runner null runner handleErrorFlush output if showOutput super handleErrorFlush output else super handleErrorFlush output private TestResultHolder executeInVM JUnitTest arg throws BuildException JUnitTest test JUnitTest arg clone test setProperties getProject getProperties if dir null log Project MSG_WARN if newEnvironment null env getVariables log Project MSG_WARN if getCommandline getBootclasspath null log Project MSG_WARN CommandlineJava SysProperties sysProperties getCommandline getSystemProperties if sysProperties null sysProperties setSystem try log System getProperties Project MSG_VERBOSE if splitJunit classLoader AntClassLoader delegate getClass getClassLoader else createClassLoader if classLoader null classLoader setThreadContextLoader runner delegate newJUnitTestRunner test test getHaltonerror test getFiltertrace test getHaltonfailure false true classLoader if summary JUnitTaskMirror SummaryJUnitResultFormatterMirror delegate newSummaryJUnitResultFormatter setWithOutAndErr equalsIgnoreCase summaryValue setOutput getDefaultOutput runner addFormatter runner setPermissions perm final FormatterElement feArray mergeFormatters test for int feArray length FormatterElement fe feArray if fe shouldUse this File outFile getOutput fe test if outFile null fe setOutfile outFile else fe setOutput getDefaultOutput runner addFormatter fe createFormatter classLoader runner run TestResultHolder result new TestResultHolder result exitCode runner getRetCode return result finally if sysProperties null sysProperties restoreSystem if classLoader null classLoader resetThreadContextLoader protected ExecuteWatchdog createWatchdog throws BuildException if timeout null return null return new ExecuteWatchdog long timeout intValue protected OutputStream getDefaultOutput return new LogOutputStream this Project MSG_INFO protected Enumeration getIndividualTests final int count batchTests size final Enumeration enums new Enumeration count for int count BatchTest batchtest BatchTest batchTests elementAt enums batchtest elements enums enums length tests elements return Enumerations fromCompound enums protected Enumeration allTests Enumeration enums tests elements batchTests elements return Enumerations fromCompound enums private FormatterElement mergeFormatters JUnitTest test Vector feVector Vector formatters clone test addFormattersTo feVector FormatterElement feArray new FormatterElement feVector size feVector copyInto feArray return feArray protected File getOutput FormatterElement fe JUnitTest test if fe getUseFile String base test getOutfile if base null base JUnitTaskMirror JUnitTestRunnerMirror IGNORED_FILE_NAME String filename base fe getExtension File destFile new File test getTodir filename String absFilename destFile getAbsolutePath return getProject resolveFile absFilename return null protected boolean addClasspathEntry String resource if resource startsWith resource resource substring else resource resource File LoaderUtils getResourceSource getClass getClassLoader resource if null log getAbsolutePath Project MSG_DEBUG antRuntimeClasses createPath setLocation return true else log resource Project MSG_DEBUG return false private void logTimeout FormatterElement feArray JUnitTest test String testCase logVmExit feArray test testCase private void logVmCrash FormatterElement feArray JUnitTest test String testCase logVmExit feArray test testCase private void logVmExit FormatterElement feArray JUnitTest test String message String testCase try log System getProperties Project MSG_VERBOSE if splitJunit classLoader AntClassLoader delegate getClass getClassLoader else createClassLoader if classLoader null classLoader setThreadContextLoader test setCounts test setProperties getProject getProperties for int feArray length FormatterElement fe feArray File outFile getOutput fe test JUnitTaskMirror JUnitResultFormatterMirror formatter fe createFormatter classLoader if outFile null formatter null try OutputStream out new FileOutputStream outFile delegate addVmExit test formatter out message testCase catch IOException if summary JUnitTaskMirror SummaryJUnitResultFormatterMirror delegate newSummaryJUnitResultFormatter setWithOutAndErr equalsIgnoreCase summaryValue delegate addVmExit test getDefaultOutput message testCase finally if classLoader null classLoader resetThreadContextLoader private void createClassLoader Path userClasspath getCommandline getClasspath if userClasspath null if reloading classLoader null deleteClassLoader Path classpath Path userClasspath clone if includeAntRuntime log antRuntimeClasses Project MSG_VERBOSE classpath append antRuntimeClasses classLoader getProject createClassLoader classpath if getClass getClassLoader null getClass getClassLoader Project class getClassLoader classLoader setParent getClass getClassLoader classLoader setParentFirst false classLoader addJavaLibraries log classLoader getClasspath Project MSG_VERBOSE classLoader addSystemPackageRoot classLoader addSystemPackageRoot classLoader addSystemPackageRoot private void deleteClassLoader if classLoader null classLoader cleanup classLoader null protected CommandlineJava getCommandline if commandline null commandline new CommandlineJava return commandline private static final class ForkedTestConfiguration private boolean filterTrace private boolean haltOnError private boolean haltOnFailure private String errorProperty private String failureProperty ForkedTestConfiguration boolean filterTrace boolean haltOnError boolean haltOnFailure String errorProperty String failureProperty this filterTrace filterTrace this haltOnError haltOnError this haltOnFailure haltOnFailure this errorProperty errorProperty this failureProperty failureProperty ForkedTestConfiguration JUnitTest test this test getFiltertrace test getHaltonerror test getHaltonfailure test getErrorProperty test getFailureProperty public boolean equals Object other if other null other getClass ForkedTestConfiguration class return false ForkedTestConfiguration ForkedTestConfiguration other return filterTrace filterTrace haltOnError haltOnError haltOnFailure haltOnFailure errorProperty null errorProperty null errorProperty null errorProperty equals errorProperty failureProperty null failureProperty null failureProperty null failureProperty equals failureProperty public int hashCode return filterTrace haltOnError haltOnFailure public static final class ForkMode extends EnumeratedAttribute public static final String ONCE public static final String PER_TEST public static final String PER_BATCH public ForkMode super public ForkMode String value super setValue value public String getValues return new String ONCE PER_TEST PER_BATCH protected Collection executeOrQueue Enumeration testList boolean runIndividual Map testConfigurations new HashMap while testList hasMoreElements JUnitTest test JUnitTest testList nextElement if test shouldRun getProject if runIndividual test getFork execute test else ForkedTestConfiguration new ForkedTestConfiguration test List List testConfigurations get if null new ArrayList testConfigurations put add test return testConfigurations values protected void actOnTestResult int exitValue boolean wasKilled JUnitTest test String name TestResultHolder new TestResultHolder exitCode exitValue timedOut wasKilled actOnTestResult test name protected void actOnTestResult TestResultHolder result JUnitTest test String name boolean fatal result timedOut result crashed boolean errorOccurredHere result exitCode JUnitTaskMirror JUnitTestRunnerMirror ERRORS fatal boolean failureOccurredHere result exitCode JUnitTaskMirror JUnitTestRunnerMirror SUCCESS fatal if errorOccurredHere failureOccurredHere if errorOccurredHere test getHaltonerror failureOccurredHere test getHaltonfailure throw new BuildException name result timedOut result crashed getLocation else log name result timedOut result crashed Project MSG_ERR if errorOccurredHere test getErrorProperty null getProject setNewProperty test getErrorProperty if failureOccurredHere test getFailureProperty null getProject setNewProperty test getFailureProperty protected class TestResultHolder public int exitCode JUnitTaskMirror JUnitTestRunnerMirror ERRORS public boolean timedOut false public boolean crashed false protected static class JUnitLogOutputStream extends LogOutputStream public JUnitLogOutputStream Task task int level super task level this task task protected void processLine String line int level if line startsWith TESTLISTENER_PREFIX task log line Project MSG_VERBOSE else super processLine line level protected static class JUnitLogStreamHandler extends PumpStreamHandler public JUnitLogStreamHandler Task task int outlevel int errlevel super new JUnitLogOutputStream task outlevel new LogOutputStream task errlevel public class FileSet extends AbstractFileSet implements ResourceCollection public FileSet super protected FileSet FileSet fileset super fileset public Object clone if isReference return FileSet getRef getProject clone else return super clone public Iterator iterator if isReference return FileSet getRef getProject iterator return new FileResourceIterator getDir getProject getDirectoryScanner getProject getIncludedFiles public int size if isReference return FileSet getRef getProject size return getDirectoryScanner getProject getIncludedFilesCount public boolean isFilesystemOnly return true public class ResourcesMatch implements Condition private Union resources null private boolean asText false public void setAsText boolean asText this asText asText public void add ResourceCollection rc if rc null return resources resources null new Union resources resources add rc public boolean eval throws BuildException if resources null throw new BuildException if resources size Iterator resources iterator Resource r1 Resource next Resource r2 null while hasNext r2 Resource next try if ResourceUtils contentEquals r1 r2 asText return false catch IOException ioe throw new BuildException r1 toString r2 toString ioe r1 r2 return true public class ConditionTask extends ConditionBase private String property null private String value private String alternative null public ConditionTask super public void setProperty String property public void setValue String value public void setElse String alternative public void execute throws BuildException if countConditions throw new BuildException getTaskName if countConditions throw new BuildException getTaskName if property null throw new BuildException Condition Condition getConditions nextElement if eval log property value Project MSG_DEBUG getProject setNewProperty property value else if alternative null log property alternative Project MSG_DEBUG getProject setNewProperty property alternative else log property Project MSG_DEBUG public class Java extends Task private CommandlineJava cmdl new CommandlineJava private Environment env new Environment private boolean fork false private boolean newEnvironment false private File dir null private boolean failOnError false private Long timeout null private String inputString private File input private File output private File error protected Redirector redirector new Redirector this protected RedirectorElement redirectorElement private String resultProperty private Permissions perm null private boolean spawn false private boolean incompatibleWithSpawn false public Java public Java Task owner bindToOwner owner public void execute throws BuildException File savedDir dir Permissions savedPermissions perm int err try err executeJava if err if failOnError throw new ExitStatusException err err getLocation else log err Project MSG_ERR maybeSetResultPropertyValue err finally dir savedDir perm savedPermissions public int executeJava throws BuildException String classname getCommandLine getClassname if classname null getCommandLine getJar null throw new BuildException if fork getCommandLine getJar null throw new BuildException if spawn fork throw new BuildException if getCommandLine getClasspath null getCommandLine getJar null log Project MSG_VERBOSE if spawn incompatibleWithSpawn getProject log Project MSG_ERR getProject log Project MSG_ERR getProject log Project MSG_ERR throw new BuildException if getCommandLine getAssertions null fork log if fork if perm null log Project MSG_WARN log getCommandLine describeCommand Project MSG_VERBOSE else if getCommandLine getVmCommand size log Project MSG_WARN if dir null log Project MSG_WARN if newEnvironment null env getVariables log Project MSG_WARN if getCommandLine getBootclasspath null log Project MSG_WARN if perm null perm new Permissions true log this getCommandLine getClassname Project MSG_VERBOSE log getCommandLine describeJavaCommand Project MSG_VERBOSE setupRedirector try if fork if spawn return fork getCommandLine getCommandline else spawn getCommandLine getCommandline return else try run getCommandLine return catch ExitException ex return ex getStatus catch BuildException if getLocation null getLocation null setLocation getLocation if failOnError throw else log return catch ThreadDeath catch Throwable if failOnError throw new BuildException getLocation else log return public void setSpawn boolean spawn this spawn spawn public void setClasspath Path createClasspath append public Path createClasspath return getCommandLine createClasspath getProject createPath public Path createBootclasspath return getCommandLine createBootclasspath getProject createPath public Permissions createPermissions perm perm null new Permissions perm return perm public void setClasspathRef Reference createClasspath setRefid public void setJar File jarfile throws BuildException if getCommandLine getClassname null throw new BuildException getCommandLine setJar jarfile getAbsolutePath public void setClassname String throws BuildException if getCommandLine getJar null throw new BuildException getCommandLine setClassname public void setArgs String log Project MSG_WARN getCommandLine createArgument setLine public void setCloneVm boolean cloneVm getCommandLine setCloneVm cloneVm public Commandline Argument createArg return getCommandLine createArgument public void setResultProperty String resultProperty this resultProperty resultProperty incompatibleWithSpawn true protected void maybeSetResultPropertyValue int result String res Integer toString result if resultProperty null getProject setNewProperty resultProperty res public void setFork boolean this fork public void setJvmargs String log Project MSG_WARN getCommandLine createVmArgument setLine public Commandline Argument createJvmarg return getCommandLine createVmArgument public void setJvm String getCommandLine setVm public void addSysproperty Environment Variable sysp getCommandLine addSysproperty sysp public void addSyspropertyset PropertySet sysp getCommandLine addSyspropertyset sysp public void setFailonerror boolean fail failOnError fail incompatibleWithSpawn fail public void setDir File this dir public void setOutput File out this output out incompatibleWithSpawn true public void setInput File input if inputString null throw new BuildException this input input incompatibleWithSpawn true public void setInputString String inputString if input null throw new BuildException this inputString inputString incompatibleWithSpawn true public void setLogError boolean logError redirector setLogError logError incompatibleWithSpawn logError public void setError File error this error error incompatibleWithSpawn true public void setOutputproperty String outputProp redirector setOutputProperty outputProp incompatibleWithSpawn true public void setErrorProperty String errorProperty redirector setErrorProperty errorProperty incompatibleWithSpawn true public void setMaxmemory String max getCommandLine setMaxmemory max public void setJVMVersion String value getCommandLine setVmversion value public void addEnv Environment Variable var env addVariable var public void setNewenvironment boolean newenv newEnvironment newenv public void setAppend boolean append redirector setAppend append incompatibleWithSpawn true public void setTimeout Long value timeout value incompatibleWithSpawn timeout null public void addAssertions Assertions asserts if getCommandLine getAssertions null throw new BuildException getCommandLine setAssertions asserts public void addConfiguredRedirector RedirectorElement redirectorElement if this redirectorElement null throw new BuildException this redirectorElement redirectorElement incompatibleWithSpawn true protected void handleOutput String output if redirector getOutputStream null redirector handleOutput output else super handleOutput output public int handleInput byte buffer int offset int length throws IOException return redirector handleInput buffer offset length protected void handleFlush String output if redirector getOutputStream null redirector handleFlush output else super handleFlush output protected void handleErrorOutput String output if redirector getErrorStream null redirector handleErrorOutput output else super handleErrorOutput output protected void handleErrorFlush String output if redirector getErrorStream null redirector handleErrorFlush output else super handleErrorOutput output protected void setupRedirector redirector setInput input redirector setInputString inputString redirector setOutput output redirector setError error if redirectorElement null redirectorElement configure redirector if spawn input null inputString null redirector setInputStream new KeepAliveInputStream getProject getDefaultInputStream private void run CommandlineJava command throws BuildException try ExecuteJava exe new ExecuteJava exe setJavaCommand command getJavaCommand exe setClasspath command getClasspath exe setSystemProperties command getSystemProperties exe setPermissions perm exe setTimeout timeout redirector createStreams exe execute getProject redirector complete if exe killedProcess throw new BuildException catch IOException throw new BuildException private int fork String command throws BuildException Execute exe new Execute redirector createHandler createWatchdog setupExecutable exe command try int rc exe execute redirector complete if exe killedProcess throw new BuildException return rc catch IOException throw new BuildException getLocation private void spawn String command throws BuildException Execute exe new Execute setupExecutable exe command try exe spawn catch IOException throw new BuildException getLocation private void setupExecutable Execute exe String command exe setAntRun getProject setupWorkingDir exe setupEnvironment exe setupCommandLine exe command private void setupEnvironment Execute exe String environment env getVariables if environment null for int environment length log environment Project MSG_VERBOSE exe setNewenvironment newEnvironment exe setEnvironment environment private void setupWorkingDir Execute exe if dir null dir getProject getBaseDir else if dir exists dir isDirectory throw new BuildException dir getAbsolutePath getLocation exe setWorkingDirectory dir private void setupCommandLine Execute exe String command if Os isFamily setupCommandLineForVMS exe command else exe setCommandline command private void setupCommandLineForVMS Execute exe String command ExecuteJava setupCommandLineForVMS exe command protected void run String classname Vector args throws BuildException CommandlineJava cmdj new CommandlineJava cmdj setClassname classname for int args size cmdj createArgument setValue String args elementAt run cmdj public void clearArgs getCommandLine clearJavaArgs protected ExecuteWatchdog createWatchdog throws BuildException if timeout null return null return new ExecuteWatchdog timeout longValue private void log Throwable StringWriter sw new StringWriter PrintWriter new PrintWriter sw printStackTrace close log sw toString Project MSG_ERR public CommandlineJava getCommandLine return cmdl public CommandlineJava SysProperties getSysProperties return getCommandLine getSystemProperties public interface DependencyAnalyzer void addSourcePath Path sourcePath void addClassPath Path classpath void addRootClass String classname Enumeration getFileDependencies Enumeration getClassDependencies void reset void config String name Object info void setClosure boolean closure File getClassContainer String classname throws IOException File getSourceContainer String classname throws IOException public class SOSCheckout extends SOS public final void setFile String filename super setInternalFilename filename public void setRecursive boolean recursive super setInternalRecursive recursive protected Commandline buildCmdLine commandLine new Commandline if getFilename null commandLine createArgument setValue SOSCmd FLAG_COMMAND commandLine createArgument setValue SOSCmd COMMAND_CHECKOUT_FILE commandLine createArgument setValue SOSCmd FLAG_FILE commandLine createArgument setValue getFilename else commandLine createArgument setValue SOSCmd FLAG_COMMAND commandLine createArgument setValue SOSCmd COMMAND_CHECKOUT_PROJECT commandLine createArgument setValue getRecursive getRequiredAttributes getOptionalAttributes return commandLine public class ScriptCondition extends AbstractScriptComponent implements Condition private boolean value false public boolean eval throws BuildException initScriptRunner executeScript return getValue public boolean getValue return value public void setValue boolean value this value value public class FileTokenizer extends ProjectComponent implements Tokenizer public String getToken Reader in throws IOException return FileUtils readFully in public String getPostToken return public class Copyfile extends Task private File srcFile private File destFile private boolean filtering false private boolean forceOverwrite false public void setSrc File src srcFile src public void setForceoverwrite boolean force forceOverwrite force public void setDest File dest destFile dest public void setFiltering String filter filtering Project toBoolean filter public void execute throws BuildException log if srcFile null throw new BuildException getLocation if srcFile exists throw new BuildException srcFile toString getLocation if destFile null throw new BuildException getLocation if srcFile equals destFile log Project MSG_WARN if forceOverwrite srcFile lastModified destFile lastModified try getProject copyFile srcFile destFile filtering forceOverwrite catch IOException ioe String msg srcFile getAbsolutePath ioe getMessage throw new BuildException msg public class ScpFromMessageBySftp extends ScpFromMessage private String remoteFile private File localFile private boolean isRecursive false private boolean verbose false public ScpFromMessageBySftp boolean verbose Session session String aRemoteFile File aLocalFile boolean recursive super verbose session this verbose verbose this remoteFile aRemoteFile this localFile aLocalFile this isRecursive recursive public ScpFromMessageBySftp Session session String aRemoteFile File aLocalFile boolean recursive this false session aRemoteFile aLocalFile recursive public void execute throws IOException JSchException ChannelSftp channel openSftpChannel try channel connect try SftpATTRS attrs channel stat remoteFile if attrs isDir remoteFile endsWith remoteFile remoteFile catch SftpException ee getDir channel remoteFile localFile catch SftpException throw new JSchException toString finally if channel null channel disconnect log private void getDir ChannelSftp channel String remoteFile File localFile throws IOException SftpException String pwd remoteFile if remoteFile lastIndexOf if remoteFile length pwd remoteFile substring remoteFile lastIndexOf channel cd pwd if localFile exists localFile mkdirs java util Vector files channel ls remoteFile for int files size ChannelSftp LsEntry le ChannelSftp LsEntry files elementAt String name le getFilename if le getAttrs isDir if name equals name equals continue getDir channel channel pwd name new File localFile le getFilename else getFile channel le localFile channel cd private void getFile ChannelSftp channel ChannelSftp LsEntry le File localFile throws IOException SftpException String remoteFile le getFilename if localFile exists String path localFile getAbsolutePath int if path lastIndexOf File pathSeparator if path length File pathSeparator length new File path substring mkdirs if localFile isDirectory localFile new File localFile remoteFile long startTime System currentTimeMillis long totalLength le getAttrs getSize SftpProgressMonitor monitor null boolean trackProgress getVerbose totalLength if trackProgress monitor getProgressMonitor try log remoteFile le getAttrs getSize channel get remoteFile localFile getAbsolutePath monitor finally long endTime System currentTimeMillis logStats startTime endTime int totalLength public class TaskAdapter extends Task implements TypeAdapter private Object proxy public static void checkTaskClass final Class taskClass final Project project if Dispatchable class isAssignableFrom taskClass try final Method executeM taskClass getMethod Class null if Void TYPE equals executeM getReturnType final String message executeM getReturnType taskClass project log message Project MSG_WARN catch NoSuchMethodException final String message taskClass project log message Project MSG_ERR throw new BuildException message catch LinkageError String message taskClass project log message Project MSG_ERR throw new BuildException message public void checkProxyClass Class proxyClass checkTaskClass proxyClass getProject public void execute throws BuildException try Method setLocationM proxy getClass getMethod new Class Location class if setLocationM null setLocationM invoke proxy new Object getLocation catch NoSuchMethodException catch Exception ex log proxy getClass Project MSG_ERR throw new BuildException ex try Method setProjectM proxy getClass getMethod new Class Project class if setProjectM null setProjectM invoke proxy new Object getProject catch NoSuchMethodException catch Exception ex log proxy getClass Project MSG_ERR throw new BuildException ex try DispatchUtils execute proxy catch BuildException be throw be catch Exception ex log proxy getClass Project MSG_VERBOSE throw new BuildException ex public void setProxy Object this proxy public Object getProxy return proxy public class AntStructure extends Task private static final String LINE_SEP System getProperty private File output private StructurePrinter printer new DTDPrinter public void setOutput File output this output output public void add StructurePrinter printer public void execute throws BuildException if output null throw new BuildException getLocation PrintWriter out null try try out new PrintWriter new OutputStreamWriter new FileOutputStream output catch UnsupportedEncodingException ue out new PrintWriter new FileWriter output printer printHead out getProject getProject getTaskDefinitions getProject getDataTypeDefinitions printer printTargetDecl out Enumeration dataTypes getProject getDataTypeDefinitions keys while dataTypes hasMoreElements String typeName String dataTypes nextElement printer printElementDecl out getProject typeName Class getProject getDataTypeDefinitions get typeName Enumeration tasks getProject getTaskDefinitions keys while tasks hasMoreElements String tName String tasks nextElement printer printElementDecl out getProject tName Class getProject getTaskDefinitions get tName printer printTail out catch IOException ioe throw new BuildException output getAbsolutePath ioe getLocation finally if out null out close public static interface StructurePrinter void printHead PrintWriter out Project Hashtable tasks Hashtable types void printTargetDecl PrintWriter out void printElementDecl PrintWriter out Project String name Class element void printTail PrintWriter out private static class DTDPrinter implements StructurePrinter private static final String BOOLEAN private static final String TASKS private static final String TYPES private Hashtable visited new Hashtable public void printTail PrintWriter out visited clear public void printHead PrintWriter out Project Hashtable tasks Hashtable types printHead out tasks keys types keys private void printHead PrintWriter out Enumeration tasks Enumeration types out println out println out print boolean first true while tasks hasMoreElements String tName String tasks nextElement if first out print else first false out print tName out println out print first true while types hasMoreElements String typeName String types nextElement if first out print else first false out print typeName out println out println out print out print TASKS out print out print TYPES out println out println out println out println out println out println public void printTargetDecl PrintWriter out out print out print TASKS out print out print TYPES out println out println out println out println out println out println out println out println out println out println public void printElementDecl PrintWriter out Project String name Class element if visited containsKey name return visited put name IntrospectionHelper ih null try ih IntrospectionHelper getHelper element catch Throwable return StringBuffer sb new StringBuffer sb append name append if org apache tools ant types Reference class equals element sb append append LINE_SEP sb append append name sb append LINE_SEP append sb append LINE_SEP append sb append append LINE_SEP out println sb return Vector new Vector if ih supportsCharacters addElement if TaskContainer class isAssignableFrom element addElement TASKS Enumeration ih getNestedElements while hasMoreElements addElement nextElement if isEmpty sb append else sb append final int count size for int count if sb append sb append elementAt sb append if count elementAt equals sb append sb append out println sb sb new StringBuffer sb append name sb append LINE_SEP append ih getAttributes while hasMoreElements String attrName String nextElement if equals attrName continue sb append LINE_SEP append append attrName append Class type ih getAttributeType attrName if type equals java lang Boolean class type equals java lang Boolean TYPE sb append BOOLEAN append else if Reference class isAssignableFrom type sb append else if EnumeratedAttribute class isAssignableFrom type try EnumeratedAttribute ea EnumeratedAttribute type newInstance String values ea getValues if values null values length areNmtokens values sb append else sb append for int values length if sb append sb append values sb append catch InstantiationException ie sb append catch IllegalAccessException ie sb append else if type getSuperclass null type getSuperclass getName equals try Object values Object type getMethod Class null invoke null Object null if values length sb append else sb append for int values length if sb append sb append type getMethod Class null invoke values Object null sb append catch Exception sb append else sb append sb append sb append append LINE_SEP out println sb final int count size for int count String nestedName String elementAt if equals nestedName TASKS equals nestedName TYPES equals nestedName printElementDecl out nestedName ih getElementType nestedName public static final boolean isNmtoken String final int length length for int length char charAt if Character isLetterOrDigit return false return true public static final boolean areNmtokens String for int length if isNmtoken return false return true protected boolean isNmtoken String return DTDPrinter isNmtoken protected boolean areNmtokens String return DTDPrinter areNmtokens public class CVSEntry private Date date private String author private final String comment private final Vector files new Vector public CVSEntry final Date date final String author final String comment this date date this author author this comment comment public void addFile final String file final String revision files addElement new RCSFile file revision public void addFile final String file final String revision final String previousRevision files addElement new RCSFile file revision previousRevision public Date getDate return date public void setAuthor final String author this author author public String getAuthor return author public String getComment return comment public Vector getFiles return files public String toString return getAuthor getDate getFiles getComment public class NoBannerLogger extends DefaultLogger protected String targetName public NoBannerLogger public void targetStarted BuildEvent event targetName event getTarget getName public void targetFinished BuildEvent event targetName null public void messageLogged BuildEvent event if event getPriority msgOutputLevel null event getMessage equals event getMessage trim return if null targetName out println StringUtils LINE_SEP targetName targetName null super messageLogged event public class Antlib extends Task implements TaskContainer public static final String TAG public static Antlib createAntlib Project project URL antlibUrl String uri try antlibUrl openConnection connect catch IOException ex throw new BuildException antlibUrl ex ComponentHelper helper ComponentHelper getComponentHelper project helper enterAntLib uri try ProjectHelper2 parser new ProjectHelper2 UnknownElement ue parser parseUnknownElement project antlibUrl if ue getTag equals TAG throw new BuildException ue getTag TAG ue getLocation Antlib antlib new Antlib antlib setProject project antlib setLocation ue getLocation antlib setTaskName antlib init ue configure antlib return antlib finally helper exitAntLib private ClassLoader classLoader private String uri private List tasks new ArrayList protected void setClassLoader ClassLoader classLoader this classLoader classLoader protected void setURI String uri this uri uri private ClassLoader getClassLoader if classLoader null classLoader Antlib class getClassLoader return classLoader public void addTask Task nestedTask tasks add nestedTask public void execute for Iterator tasks iterator hasNext UnknownElement ue UnknownElement next setLocation ue getLocation ue maybeConfigure Object configuredObject ue getRealThing if configuredObject null continue if configuredObject instanceof AntlibDefinition throw new BuildException ue getTag configuredObject getClass AntlibDefinition def AntlibDefinition configuredObject def setURI uri def setAntlibClassLoader getClassLoader def init def execute public class InstanceOf implements ResourceSelector private static final String ONE_ONLY private Project project private Class clazz private String type private String uri public void setProject Project project public void setClass Class if clazz null throw new BuildException clazz public void setType String type public void setURI String uri public Class getCheckClass return clazz public String getType return type public String getURI return uri public boolean isSelected Resource if clazz null type null throw new BuildException ONE_ONLY Class clazz if type null if project null throw new BuildException AntTypeDefinition ComponentHelper getComponentHelper project getDefinition ProjectHelper genComponentName uri type if null throw new BuildException type try innerGetTypeClass catch ClassNotFoundException throw new BuildException return isAssignableFrom getClass public class WLJspc extends MatchingTask private File destinationDirectory private File sourceDirectory private String destinationPackage private Path compileClasspath private String pathToPackage private Vector filesToDo new Vector public void execute throws BuildException if destinationDirectory isDirectory throw new BuildException destinationDirectory getPath if sourceDirectory isDirectory throw new BuildException sourceDirectory getPath if destinationPackage null getLocation pathToPackage this destinationPackage replace File separatorChar DirectoryScanner ds super getDirectoryScanner sourceDirectory if compileClasspath null compileClasspath new Path getProject compileClasspath compileClasspath concatSystemClasspath String files ds getIncludedFiles Java helperTask new Java this helperTask setFork true helperTask setClassname helperTask setTaskName getTaskName String args new String File jspFile null String parents int args args destinationDirectory getAbsolutePath trim args args sourceDirectory getAbsolutePath trim args args args args compileClasspath toString this scanDir files log filesToDo size for int filesToDo size String filename String filesToDo elementAt jspFile new File filename parents jspFile getParent if parents null equals parents parents this replaceString parents File separator args destinationPackage parents else args destinationPackage args sourceDirectory File separator filename helperTask clearArgs for int helperTask createArg setValue args helperTask setClasspath compileClasspath if helperTask executeJava log filename Project MSG_WARN public void setClasspath Path classpath if compileClasspath null compileClasspath classpath else compileClasspath append classpath public Path createClasspath if compileClasspath null compileClasspath new Path getProject return compileClasspath public void setSrc File dirName sourceDirectory dirName public void setDest File dirName destinationDirectory dirName protected void scanDir String files long now new Date getTime File jspFile null String parents null String pack for int files length File srcFile new File this sourceDirectory files jspFile new File files parents jspFile getParent if parents null equals parents parents this replaceString parents File separator pack pathToPackage File separator parents else pack pathToPackage String filePath pack File separator int startingIndex files lastIndexOf File separator files lastIndexOf File separator int endingIndex files indexOf if endingIndex log files Project MSG_VERBOSE continue filePath files substring startingIndex endingIndex filePath File classFile new File this destinationDirectory filePath if srcFile lastModified now log files Project MSG_WARN if srcFile lastModified classFile lastModified filesToDo addElement files log files Project MSG_VERBOSE protected String replaceString String inpString String escapeChars String replaceChars String localString int numTokens StringTokenizer st new StringTokenizer inpString escapeChars true numTokens st countTokens for int numTokens String test st nextToken test test equals escapeChars replaceChars test localString test return localString public final class MagicNames private MagicNames public static final String ANTLIB_PREFIX public static final String ANT_VERSION public static final String BUILD_SYSCLASSPATH public static final String SCRIPT_REPOSITORY public static final String SYSTEM_LOADER_REF public static final String REPOSITORY_DIR_PROPERTY public static final String REPOSITORY_URL_PROPERTY public static final String TASKDEF_PROPERTIES_RESOURCE public static final String TYPEDEFS_PROPERTIES_RESOURCE public static final String ANT_EXECUTOR_REFERENCE public static final String ANT_EXECUTOR_CLASSNAME public static final String PROJECT_BASEDIR public static final String ANT_FILE public static final String ANT_JAVA_VERSION public static final String ANT_HOME Launcher ANTHOME_PROPERTY public static final String ANT_LIB public static final String REGEXP_IMPL public static final String BUILD_JAVAC_SOURCE public static final String BUILD_JAVAC_TARGET public static final String REFID_CLASSPATH_REUSE_LOADER public static final String REFID_CLASSPATH_LOADER_PREFIX public static final String REFID_PROPERTY_HELPER public class RedirectorElement extends DataType private boolean usingInput false private boolean usingOutput false private boolean usingError false private Boolean logError private String outputProperty private String errorProperty private String inputString private Boolean append private Boolean alwaysLog private Boolean createEmptyFiles private Mapper inputMapper private Mapper outputMapper private Mapper errorMapper private Vector inputFilterChains new Vector private Vector outputFilterChains new Vector private Vector errorFilterChains new Vector private String outputEncoding private String errorEncoding private String inputEncoding private Boolean logInputString public void addConfiguredInputMapper Mapper inputMapper if isReference throw noChildrenAllowed if this inputMapper null if usingInput throw new BuildException else throw new BuildException this inputMapper inputMapper public void addConfiguredOutputMapper Mapper outputMapper if isReference throw noChildrenAllowed if this outputMapper null if usingOutput throw new BuildException else throw new BuildException this outputMapper outputMapper public void addConfiguredErrorMapper Mapper errorMapper if isReference throw noChildrenAllowed if this errorMapper null if usingError throw new BuildException else throw new BuildException this errorMapper errorMapper public void setRefid Reference throws BuildException if usingInput usingOutput usingError inputString null logError null append null createEmptyFiles null inputEncoding null outputEncoding null errorEncoding null outputProperty null errorProperty null logInputString null throw tooManyAttributes super setRefid public void setInput File input if isReference throw tooManyAttributes if inputString null throw new BuildException usingInput true inputMapper createMergeMapper input public void setInputString String inputString if isReference throw tooManyAttributes if usingInput throw new BuildException this inputString inputString public void setLogInputString boolean logInputString if isReference throw tooManyAttributes this logInputString logInputString Boolean TRUE Boolean FALSE public void setOutput File out if isReference throw tooManyAttributes if out null throw new IllegalArgumentException usingOutput true outputMapper createMergeMapper out public void setOutputEncoding String outputEncoding if isReference throw tooManyAttributes this outputEncoding outputEncoding public void setErrorEncoding String errorEncoding if isReference throw tooManyAttributes this errorEncoding errorEncoding public void setInputEncoding String inputEncoding if isReference throw tooManyAttributes this inputEncoding inputEncoding public void setLogError boolean logError if isReference throw tooManyAttributes this logError logError Boolean TRUE Boolean FALSE public void setError File error if isReference throw tooManyAttributes if error null throw new IllegalArgumentException usingError true errorMapper createMergeMapper error public void setOutputProperty String outputProperty if isReference throw tooManyAttributes this outputProperty outputProperty public void setAppend boolean append if isReference throw tooManyAttributes this append append Boolean TRUE Boolean FALSE public void setAlwaysLog boolean alwaysLog if isReference throw tooManyAttributes this alwaysLog alwaysLog Boolean TRUE Boolean FALSE public void setCreateEmptyFiles boolean createEmptyFiles if isReference throw tooManyAttributes this createEmptyFiles createEmptyFiles Boolean TRUE Boolean FALSE public void setErrorProperty String errorProperty if isReference throw tooManyAttributes this errorProperty errorProperty public FilterChain createInputFilterChain if isReference throw noChildrenAllowed FilterChain result new FilterChain result setProject getProject inputFilterChains add result return result public FilterChain createOutputFilterChain if isReference throw noChildrenAllowed FilterChain result new FilterChain result setProject getProject outputFilterChains add result return result public FilterChain createErrorFilterChain if isReference throw noChildrenAllowed FilterChain result new FilterChain result setProject getProject errorFilterChains add result return result public void configure Redirector redirector configure redirector null public void configure Redirector redirector String sourcefile if isReference getRef configure redirector sourcefile return if alwaysLog null redirector setAlwaysLog alwaysLog booleanValue if logError null redirector setLogError logError booleanValue if append null redirector setAppend append booleanValue if createEmptyFiles null redirector setCreateEmptyFiles createEmptyFiles booleanValue if outputProperty null redirector setOutputProperty outputProperty if errorProperty null redirector setErrorProperty errorProperty if inputString null redirector setInputString inputString if logInputString null redirector setLogInputString logInputString booleanValue if inputMapper null String inputTargets null try inputTargets inputMapper getImplementation mapFileName sourcefile catch NullPointerException enPeaEx if sourcefile null throw enPeaEx if inputTargets null inputTargets length redirector setInput toFileArray inputTargets if outputMapper null String outputTargets null try outputTargets outputMapper getImplementation mapFileName sourcefile catch NullPointerException enPeaEx if sourcefile null throw enPeaEx if outputTargets null outputTargets length redirector setOutput toFileArray outputTargets if errorMapper null String errorTargets null try errorTargets errorMapper getImplementation mapFileName sourcefile catch NullPointerException enPeaEx if sourcefile null throw enPeaEx if errorTargets null errorTargets length redirector setError toFileArray errorTargets if inputFilterChains size redirector setInputFilterChains inputFilterChains if outputFilterChains size redirector setOutputFilterChains outputFilterChains if errorFilterChains size redirector setErrorFilterChains errorFilterChains if inputEncoding null redirector setInputEncoding inputEncoding if outputEncoding null redirector setOutputEncoding outputEncoding if errorEncoding null redirector setErrorEncoding errorEncoding protected Mapper createMergeMapper File destfile Mapper result new Mapper getProject result setClassname org apache tools ant util MergingMapper class getName result setTo destfile getAbsolutePath return result protected File toFileArray String name if name null return null ArrayList list new ArrayList name length for int name length if name null list add getProject resolveFile name return File list toArray new File list size protected void dieOnCircularReference Stack stk Project throws BuildException if isChecked return if isReference super dieOnCircularReference stk else Mapper new Mapper inputMapper outputMapper errorMapper for int length if null stk push dieOnCircularReference stk stk pop Vector new Vector inputFilterChains outputFilterChains errorFilterChains for int length if null for Iterator fci iterator fci hasNext FilterChain fc FilterChain fci next stk push fc fc dieOnCircularReference stk stk pop setChecked true private RedirectorElement getRef return RedirectorElement getCheckedRef public class Kjc extends DefaultCompilerAdapter public boolean execute throws BuildException attributes log Project MSG_VERBOSE Commandline cmd setupKjcCommand cmd setExecutable ExecuteJava ej new ExecuteJava ej setJavaCommand cmd return ej fork getJavac protected Commandline setupKjcCommand Commandline cmd new Commandline Path classpath getCompileClasspath if deprecation cmd createArgument setValue if destDir null cmd createArgument setValue cmd createArgument setFile destDir cmd createArgument setValue Path cp new Path project Path getBootClassPath if size cp append if extdirs null cp addExtdirs extdirs cp append classpath if compileSourcepath null cp append compileSourcepath else cp append src cmd createArgument setPath cp if encoding null cmd createArgument setValue cmd createArgument setValue encoding if debug cmd createArgument setValue if optimize cmd createArgument setValue if verbose cmd createArgument setValue addCurrentCompilerArgs cmd logAndAddFilesToCompile cmd return cmd public class None extends ResourceSelectorContainer implements ResourceSelector public None public None ResourceSelector super public boolean isSelected Resource boolean none true for Iterator getSelectors none hasNext none ResourceSelector next isSelected return none public class Classloader extends Task public static final String SYSTEM_LOADER_REF MagicNames SYSTEM_LOADER_REF private String name null private Path classpath private boolean reset false private boolean parentFirst true private String parentName null public Classloader public void setName String name this name name public void setReset boolean this reset public void setReverse boolean this parentFirst public void setParentFirst boolean this parentFirst public void setParentName String name this parentName name public void setClasspathRef Reference pathRef throws BuildException classpath Path pathRef getReferencedObject getProject public void setClasspath Path classpath if this classpath null this classpath classpath else this classpath append classpath public Path createClasspath if this classpath null this classpath new Path null return this classpath createPath public void execute try if equals getProject getProperty name null SYSTEM_LOADER_REF equals name log Project MSG_WARN return String loaderName name null SYSTEM_LOADER_REF name Object obj getProject getReference loaderName if reset if obj null obj instanceof AntClassLoader log Project MSG_ERR return AntClassLoader acl AntClassLoader obj if acl null Object parent null if parentName null parent getProject getReference parentName if parent instanceof ClassLoader parent null if parent null parent this getClass getClassLoader if name null getProject log name parent parentFirst Project MSG_DEBUG acl new AntClassLoader ClassLoader parent getProject classpath parentFirst getProject addReference loaderName acl if name null acl addLoaderPackageRoot getProject setCoreLoader acl if classpath null String list classpath list for int list length File new File list if exists acl addPathElement getAbsolutePath log acl getAbsolutePath Project MSG_DEBUG catch Exception ex ex printStackTrace public class WeblogicTOPLinkDeploymentTool extends WeblogicDeploymentTool private static final String TL_DTD_LOC private String toplinkDescriptor private String toplinkDTD public void setToplinkdescriptor String inString this toplinkDescriptor inString public void setToplinkdtd String inString this toplinkDTD inString protected DescriptorHandler getDescriptorHandler File srcDir DescriptorHandler handler super getDescriptorHandler srcDir if toplinkDTD null else return handler protected void addVendorFiles Hashtable ejbFiles String ddPrefix super addVendorFiles ejbFiles ddPrefix File toplinkDD new File getConfig descriptorDir ddPrefix toplinkDescriptor if toplinkDD exists ejbFiles put META_DIR toplinkDescriptor toplinkDD else log toplinkDD getPath Project MSG_WARN public void validateConfigured throws BuildException super validateConfigured if toplinkDescriptor null throw new BuildException public interface DynamicConfigurator extends DynamicAttribute DynamicElement public class JonasHotDeploymentTool extends GenericHotDeploymentTool implements HotDeploymentTool protected static final String DEFAULT_ORB private static final String JONAS_DEPLOY_CLASS_NAME private static final String VALID_ACTIONS ACTION_DELETE ACTION_DEPLOY ACTION_LIST ACTION_UNDEPLOY ACTION_UPDATE private File jonasroot private String orb null private String davidHost private int davidPort public void setDavidhost final String inValue davidHost inValue public void setDavidport final int inValue davidPort inValue public void setJonasroot final File inValue jonasroot inValue public void setOrb final String inValue orb inValue public Path getClasspath Path aClassPath super getClasspath if aClassPath null aClassPath new Path getTask getProject if orb null String aOrbJar new File jonasroot orb toString String aConfigDir new File jonasroot toString Path aJOnASOrbPath new Path aClassPath getProject aOrbJar File pathSeparator aConfigDir aClassPath append aJOnASOrbPath return aClassPath public void validateAttributes throws BuildException Java java getJava String action getTask getAction if action null throw new BuildException if isActionValid throw new BuildException action if getClassName null setClassName JONAS_DEPLOY_CLASS_NAME if jonasroot null jonasroot isDirectory java createJvmarg setValue jonasroot java createJvmarg setValue jonasroot if equals orb java createJvmarg setValue java createJvmarg setValue java createJvmarg setValue java createJvmarg setValue java createJvmarg setValue java createJvmarg setValue java createJvmarg setValue if davidHost null java createJvmarg setValue davidHost if davidPort java createJvmarg setValue davidPort if getServer null java createArg setLine getServer if action equals ACTION_DEPLOY action equals ACTION_UPDATE action equals java createArg setLine getTask getSource else if action equals ACTION_DELETE action equals ACTION_UNDEPLOY java createArg setLine getTask getSource else if action equals ACTION_LIST java createArg setValue protected boolean isActionValid boolean valid false String action getTask getAction for int VALID_ACTIONS length if action equals VALID_ACTIONS valid true break return valid public class CCUnCheckout extends ClearCase private boolean mKeep false public void execute throws BuildException Commandline commandLine new Commandline Project aProj getProject int result if getViewPath null setViewPath aProj getBaseDir getPath commandLine setExecutable getClearToolCommand commandLine createArgument setValue COMMAND_UNCHECKOUT checkOptions commandLine if getFailOnErr getProject log getViewPathBasename Project MSG_VERBOSE result run commandLine if Execute isFailure result getFailOnErr String msg commandLine toString throw new BuildException msg getLocation private void checkOptions Commandline cmd if getKeepCopy cmd createArgument setValue FLAG_KEEPCOPY else cmd createArgument setValue FLAG_RM cmd createArgument setValue getViewPath public void setKeepCopy boolean keep mKeep keep public boolean getKeepCopy return mKeep public static final String FLAG_KEEPCOPY public static final String FLAG_RM public class MSVSSHISTORY extends MSVSS Commandline buildCmdLine Commandline commandLine new Commandline if getVsspath null String msg throw new BuildException msg getLocation commandLine setExecutable getSSCommand commandLine createArgument setValue COMMAND_HISTORY commandLine createArgument setValue getVsspath commandLine createArgument setValue getVersionDate commandLine createArgument setValue getVersionLabel commandLine createArgument setValue getRecursive commandLine createArgument setValue getStyle commandLine createArgument setValue getLogin commandLine createArgument setValue getOutput return commandLine public void setRecursive boolean recursive super setInternalRecursive recursive public void setUser String user super setInternalUser user public void setFromDate String fromDate super setInternalFromDate fromDate public void setToDate String toDate super setInternalToDate toDate public void setFromLabel String fromLabel super setInternalFromLabel fromLabel public void setToLabel String toLabel super setInternalToLabel toLabel public void setNumdays int numd super setInternalNumDays numd public void setOutput File outfile if outfile null super setInternalOutputFilename outfile getAbsolutePath public void setDateFormat String dateFormat super setInternalDateFormat new SimpleDateFormat dateFormat public void setStyle BriefCodediffNofile attr String option attr getValue if option equals STYLE_BRIEF super setInternalStyle FLAG_BRIEF else if option equals STYLE_CODEDIFF super setInternalStyle FLAG_CODEDIFF else if option equals STYLE_DEFAULT super setInternalStyle else if option equals STYLE_NOFILE super setInternalStyle FLAG_NO_FILE else throw new BuildException attr getLocation public static class BriefCodediffNofile extends EnumeratedAttribute public String getValues return new String STYLE_BRIEF STYLE_CODEDIFF STYLE_NOFILE STYLE_DEFAULT public interface DynamicAttributeNS void setDynamicAttribute String uri String localName String qName String value throws BuildException public class Tar extends MatchingTask public static final String WARN public static final String FAIL public static final String TRUNCATE public static final String GNU public static final String OMIT File tarFile File baseDir private TarLongFileMode longFileMode new TarLongFileMode Vector filesets new Vector private Vector resourceCollections new Vector Vector fileSetFiles new Vector private boolean longWarningGiven false private TarCompressionMethod compression new TarCompressionMethod public TarFileSet createTarFileSet TarFileSet fs new TarFileSet fs setProject getProject filesets addElement fs return fs public void add ResourceCollection res resourceCollections add res public void setTarfile File tarFile this tarFile tarFile public void setDestFile File destFile this tarFile destFile public void setBasedir File baseDir this baseDir baseDir public void setLongfile String mode log this longFileMode new TarLongFileMode longFileMode setValue mode public void setLongfile TarLongFileMode mode this longFileMode mode public void setCompression TarCompressionMethod mode this compression mode public void execute throws BuildException if tarFile null throw new BuildException getLocation if tarFile exists tarFile isDirectory throw new BuildException getLocation if tarFile exists tarFile canWrite throw new BuildException getLocation Vector savedFileSets Vector filesets clone try if baseDir null if baseDir exists throw new BuildException getLocation TarFileSet mainFileSet new TarFileSet fileset mainFileSet setDir baseDir filesets addElement mainFileSet if filesets size resourceCollections size throw new BuildException getLocation boolean upToDate true for Enumeration filesets elements hasMoreElements upToDate check TarFileSet nextElement for Enumeration resourceCollections elements hasMoreElements upToDate check ResourceCollection nextElement if upToDate log tarFile getAbsolutePath Project MSG_INFO return log tarFile getAbsolutePath Project MSG_INFO TarOutputStream tOut null try tOut new TarOutputStream compression compress new BufferedOutputStream new FileOutputStream tarFile tOut setDebug true if longFileMode isTruncateMode tOut setLongFileMode TarOutputStream LONGFILE_TRUNCATE else if longFileMode isFailMode longFileMode isOmitMode tOut setLongFileMode TarOutputStream LONGFILE_ERROR else tOut setLongFileMode TarOutputStream LONGFILE_GNU longWarningGiven false for Enumeration filesets elements hasMoreElements tar TarFileSet nextElement tOut for Enumeration resourceCollections elements hasMoreElements tar ResourceCollection nextElement tOut catch IOException ioe String msg ioe getMessage throw new BuildException msg ioe getLocation finally FileUtils close tOut finally filesets savedFileSets protected void tarFile File file TarOutputStream tOut String vPath TarFileSet tarFileSet throws IOException if file equals tarFile return tarResource new FileResource file tOut vPath tarFileSet protected void tarResource Resource TarOutputStream tOut String vPath TarFileSet tarFileSet throws IOException if isExists return if tarFileSet null String fullpath tarFileSet getFullpath this getProject if fullpath length vPath fullpath else if vPath length return String prefix tarFileSet getPrefix this getProject if prefix length prefix endsWith prefix prefix vPath prefix vPath if vPath startsWith tarFileSet getPreserveLeadingSlashes int vPath length if return vPath vPath substring if isDirectory vPath endsWith vPath if vPath length TarConstants NAMELEN if longFileMode isOmitMode log vPath Project MSG_INFO return else if longFileMode isWarnMode log vPath TarConstants NAMELEN Project MSG_WARN if longWarningGiven log Project MSG_WARN longWarningGiven true else if longFileMode isFailMode throw new BuildException vPath TarConstants NAMELEN getLocation TarEntry te new TarEntry vPath te setModTime getLastModified if instanceof ArchiveResource ArchiveResource ar ArchiveResource te setMode ar getMode if instanceof TarResource TarResource tr TarResource te setUserName tr getUserName te setUserId tr getUid te setGroupName tr getGroup te setGroupId tr getGid if isDirectory if size TarConstants MAXSIZE throw new BuildException TarConstants MAXSIZE te setSize getSize if tarFileSet null tarFileSet hasFileModeBeenSet te setMode tarFileSet getMode else if tarFileSet null tarFileSet hasDirModeBeenSet te setMode tarFileSet getDirMode this getProject if tarFileSet null if tarFileSet hasUserNameBeenSet te setUserName tarFileSet getUserName if tarFileSet hasGroupBeenSet te setGroupName tarFileSet getGroup if tarFileSet hasUserIdBeenSet te setUserId tarFileSet getUid if tarFileSet hasGroupIdBeenSet te setGroupId tarFileSet getGid InputStream in null try tOut putNextEntry te if isDirectory in getInputStream byte buffer new byte int count do tOut write buffer count count in read buffer buffer length while count tOut closeEntry finally FileUtils close in protected boolean archiveIsUpToDate String files return archiveIsUpToDate files baseDir protected boolean archiveIsUpToDate String files File dir SourceFileScanner sfs new SourceFileScanner this MergingMapper mm new MergingMapper mm setTo tarFile getAbsolutePath return sfs restrict files dir null mm length protected boolean archiveIsUpToDate Resource return SelectorUtils isOutOfDate new FileResource tarFile FileUtils getFileUtils getFileTimestampGranularity protected boolean supportsNonFileResources return getClass equals Tar class protected boolean check ResourceCollection rc boolean upToDate true if isFileFileSet rc FileSet fs FileSet rc upToDate check fs getDir getProject getFileNames fs else if rc isFilesystemOnly supportsNonFileResources throw new BuildException else if rc isFilesystemOnly HashSet basedirs new HashSet HashMap basedirToFilesMap new HashMap Iterator iter rc iterator while iter hasNext FileResource FileResource iter next File base getBaseDir if base null base Copy NULL_FILE_PLACEHOLDER basedirs add base Vector files Vector basedirToFilesMap get base if files null files new Vector basedirToFilesMap put base new Vector files add getName iter basedirs iterator while iter hasNext File base File iter next Vector Vector basedirToFilesMap get base String files String toArray new String size upToDate check base Copy NULL_FILE_PLACEHOLDER null base files Iterator iter rc iterator while upToDate iter hasNext Resource Resource iter next upToDate archiveIsUpToDate return upToDate protected boolean check File basedir String files boolean upToDate true if archiveIsUpToDate files basedir upToDate false for int files length if tarFile equals new File basedir files throw new BuildException getLocation return upToDate protected void tar ResourceCollection rc TarOutputStream tOut throws IOException ArchiveFileSet afs null if rc instanceof ArchiveFileSet afs ArchiveFileSet rc if afs null afs size afs getFullpath this getProject length throw new BuildException TarFileSet tfs asTarFileSet afs if isFileFileSet rc FileSet fs FileSet rc String files getFileNames fs for int files length File new File fs getDir getProject files String name files replace File separatorChar tarFile tOut name tfs else if rc isFilesystemOnly Iterator iter rc iterator while iter hasNext FileResource FileResource iter next File getFile if null new File getBaseDir getName tarFile tOut getName tfs Iterator iter rc iterator while iter hasNext Resource Resource iter next tarResource tOut getName tfs protected static final boolean isFileFileSet ResourceCollection rc return rc instanceof FileSet rc isFilesystemOnly protected static final String getFileNames FileSet fs DirectoryScanner ds fs getDirectoryScanner fs getProject String directories ds getIncludedDirectories String filesPerSe ds getIncludedFiles String files new String directories length filesPerSe length System arraycopy directories files directories length System arraycopy filesPerSe files directories length filesPerSe length return files protected TarFileSet asTarFileSet ArchiveFileSet archiveFileSet TarFileSet tfs null if archiveFileSet null archiveFileSet instanceof TarFileSet tfs TarFileSet archiveFileSet else tfs new TarFileSet tfs setProject getProject if archiveFileSet null tfs setPrefix archiveFileSet getPrefix getProject tfs setFullpath archiveFileSet getFullpath getProject if archiveFileSet hasFileModeBeenSet tfs integerSetFileMode archiveFileSet getFileMode getProject if archiveFileSet hasDirModeBeenSet tfs integerSetDirMode archiveFileSet getDirMode getProject if archiveFileSet instanceof org apache tools ant types TarFileSet org apache tools ant types TarFileSet org apache tools ant types TarFileSet archiveFileSet if hasUserNameBeenSet tfs setUserName getUserName if hasGroupBeenSet tfs setGroup getGroup if hasUserIdBeenSet tfs setUid getUid if hasGroupIdBeenSet tfs setGid getGid return tfs public static class TarFileSet extends org apache tools ant types TarFileSet private String files null private boolean preserveLeadingSlashes false public TarFileSet FileSet fileset super fileset public TarFileSet super public String getFiles Project if files null files getFileNames this return files public void setMode String octalString setFileMode octalString public int getMode return getFileMode this getProject public void setPreserveLeadingSlashes boolean this preserveLeadingSlashes public boolean getPreserveLeadingSlashes return preserveLeadingSlashes public static class TarLongFileMode extends EnumeratedAttribute public static final String WARN FAIL TRUNCATE GNU OMIT private final String validModes WARN FAIL TRUNCATE GNU OMIT public TarLongFileMode super setValue WARN public String getValues return validModes public boolean isTruncateMode return TRUNCATE equalsIgnoreCase getValue public boolean isWarnMode return WARN equalsIgnoreCase getValue public boolean isGnuMode return GNU equalsIgnoreCase getValue public boolean isFailMode return FAIL equalsIgnoreCase getValue public boolean isOmitMode return OMIT equalsIgnoreCase getValue public static final class TarCompressionMethod extends EnumeratedAttribute private static final String NONE private static final String GZIP private static final String BZIP2 public TarCompressionMethod super setValue NONE public String getValues return new String NONE GZIP BZIP2 private OutputStream compress final OutputStream ostream throws IOException final String getValue if GZIP equals return new GZIPOutputStream ostream else if BZIP2 equals ostream write ostream write return new CBZip2OutputStream ostream return ostream public class WLRmic extends DefaultRmicAdapter public static final String WLRMIC_CLASSNAME public static final String COMPILER_NAME public static final String ERROR_NO_WLRMIC_ON_CLASSPATH public static final String ERROR_WLRMIC_FAILED public static final String WL_RMI_STUB_SUFFIX public static final String WL_RMI_SKEL_SUFFIX public boolean execute throws BuildException getRmic log Project MSG_VERBOSE Commandline cmd setupRmicCommand new String AntClassLoader loader null try Class null if getRmic getClasspath null Class forName WLRMIC_CLASSNAME else loader getRmic getProject createClassLoader getRmic getClasspath Class forName WLRMIC_CLASSNAME true loader Method doRmic getMethod new Class String class doRmic invoke null new Object cmd getArguments return true catch ClassNotFoundException ex throw new BuildException ERROR_NO_WLRMIC_ON_CLASSPATH getRmic getLocation catch Exception ex if ex instanceof BuildException throw BuildException ex else throw new BuildException ERROR_WLRMIC_FAILED ex getRmic getLocation finally if loader null loader cleanup public String getStubClassSuffix return WL_RMI_STUB_SUFFIX public String getSkelClassSuffix return WL_RMI_SKEL_SUFFIX public class SignJar extends AbstractJarSignerTask private static final FileUtils FILE_UTILS FileUtils getFileUtils protected String sigfile protected File signedjar protected boolean internalsf protected boolean sectionsonly private boolean preserveLastModified protected boolean lazy protected File destDir private FileNameMapper mapper protected String tsaurl protected String tsacert public static final String ERROR_TODIR_AND_SIGNEDJAR public static final String ERROR_TOO_MANY_MAPPERS public static final String ERROR_SIGNEDJAR_AND_PATHS public static final String ERROR_BAD_MAP public static final String ERROR_MAPPER_WITHOUT_DEST public static final String ERROR_NO_ALIAS public static final String ERROR_NO_STOREPASS public void setSigfile final String sigfile this sigfile sigfile public void setSignedjar final File signedjar this signedjar signedjar public void setInternalsf final boolean internalsf this internalsf internalsf public void setSectionsonly final boolean sectionsonly this sectionsonly sectionsonly public void setLazy final boolean lazy this lazy lazy public void setDestDir File destDir this destDir destDir public void add FileNameMapper newMapper if mapper null throw new BuildException ERROR_TOO_MANY_MAPPERS mapper newMapper public FileNameMapper getMapper return mapper public String getTsaurl return tsaurl public void setTsaurl String tsaurl this tsaurl tsaurl public String getTsacert return tsacert public void setTsacert String tsacert this tsacert tsacert public void execute throws BuildException final boolean hasJar jar null final boolean hasSignedJar signedjar null final boolean hasDestDir destDir null final boolean hasMapper mapper null if hasJar hasResources throw new BuildException ERROR_NO_SOURCE if null alias throw new BuildException ERROR_NO_ALIAS if null storepass throw new BuildException ERROR_NO_STOREPASS if hasDestDir hasSignedJar throw new BuildException ERROR_TODIR_AND_SIGNEDJAR if hasResources hasSignedJar throw new BuildException ERROR_SIGNEDJAR_AND_PATHS if hasDestDir hasMapper throw new BuildException ERROR_MAPPER_WITHOUT_DEST beginExecution try if hasJar hasSignedJar signOneJar jar signedjar return Path sources createUnifiedSourcePath FileNameMapper destMapper if hasMapper destMapper mapper else destMapper new IdentityMapper Iterator iter sources iterator while iter hasNext FileResource fr FileResource iter next File toDir hasDestDir destDir fr getBaseDir String destFilenames destMapper mapFileName fr getName if destFilenames null destFilenames length throw new BuildException ERROR_BAD_MAP fr getFile File destFile new File toDir destFilenames signOneJar fr getFile destFile finally endExecution private void signOneJar File jarSource File jarTarget throws BuildException File targetFile jarTarget if targetFile null targetFile jarSource if isUpToDate jarSource targetFile return long lastModified jarSource lastModified final ExecTask cmd createJarSigner setCommonOptions cmd bindToKeystore cmd if null sigfile addValue cmd String value this sigfile addValue cmd value if null targetFile jarSource equals targetFile addValue cmd addValue cmd targetFile getPath if internalsf addValue cmd if sectionsonly addValue cmd addTimestampAuthorityCommands cmd addValue cmd jarSource getPath addValue cmd alias log jarSource getAbsolutePath targetFile getAbsolutePath alias cmd execute if preserveLastModified targetFile setLastModified lastModified private void addTimestampAuthorityCommands final ExecTask cmd if tsaurl null addValue cmd addValue cmd tsaurl if tsacert null addValue cmd addValue cmd tsacert protected boolean isUpToDate File jarFile File signedjarFile if null jarFile jarFile exists return false File destFile signedjarFile if destFile null destFile jarFile if jarFile equals destFile if lazy return isSigned jarFile return false return FILE_UTILS isUpToDate jarFile destFile protected boolean isSigned File file try return IsSigned isSigned file alias catch IOException log toString Project MSG_VERBOSE return false public void setPreserveLastModified boolean preserveLastModified this preserveLastModified preserveLastModified public abstract class Definer extends DefBase private static final String ANTLIB_XML private static class ResourceStack extends ThreadLocal public Object initialValue return new HashMap Map getStack return Map get private static ResourceStack resourceStack new ResourceStack private String name private String classname private File file private String resource private int format Format PROPERTIES private boolean definerSet false private int onError OnError FAIL private String adapter private String adaptTo private Class adapterClass private Class adaptToClass public static class OnError extends EnumeratedAttribute public static final int FAIL REPORT IGNORE FAIL_ALL public static final String POLICY_FAIL public static final String POLICY_REPORT public static final String POLICY_IGNORE public static final String POLICY_FAILALL public OnError super public OnError String value setValue value public String getValues return new String POLICY_FAIL POLICY_REPORT POLICY_IGNORE POLICY_FAILALL public static class Format extends EnumeratedAttribute public static final int PROPERTIES XML public String getValues return new String public void setOnError OnError onError this onError onError getIndex public void setFormat Format format this format format getIndex public String getName return name public File getFile return file public String getResource return resource public void execute throws BuildException ClassLoader al createLoader if definerSet if getURI null throw new BuildException getTaskName getLocation if getURI startsWith MagicNames ANTLIB_PREFIX String uri1 getURI setResource makeResourceFromURI uri1 else throw new BuildException getURI if name null if classname null throw new BuildException getTaskName getLocation addDefinition al name classname else if classname null String msg throw new BuildException msg getLocation if file null final URL url fileToURL if url null return urls new Enumeration private boolean more true public boolean hasMoreElements return more public Object nextElement throws NoSuchElementException if more more false return url else throw new NoSuchElementException else urls resourceToURLs al while urls hasMoreElements URL url URL urls nextElement int fmt this format if url toString toLowerCase Locale US endsWith fmt Format XML if fmt Format PROPERTIES loadProperties al url break else if resourceStack getStack get url null log url getLocation resourceStack getStack get url Project MSG_WARN else try resourceStack getStack put url getLocation loadAntlib al url finally resourceStack getStack remove url public static String makeResourceFromURI String uri String path uri substring MagicNames ANTLIB_PREFIX length String resource if resource endsWith resource resource ANTLIB_XML else resource path replace ANTLIB_XML return resource private URL fileToURL String message null if file exists message file if message null file isFile message file try if message null return file toURL catch Exception ex message file ex toString switch onError case OnError FAIL_ALL throw new BuildException message case OnError FAIL case OnError REPORT log message Project MSG_WARN break case OnError IGNORE log message Project MSG_VERBOSE break default break return null Enumeration ret try ret classLoader getResources resource catch IOException throw new BuildException resource getLocation if ret hasMoreElements String message resource switch onError case OnError FAIL_ALL throw new BuildException message case OnError FAIL case OnError REPORT log message Project MSG_WARN break case OnError IGNORE log message Project MSG_VERBOSE break default break return ret protected void loadProperties ClassLoader al URL url InputStream is null try is url openStream if is null log url Project MSG_WARN return Properties props new Properties props load is Enumeration keys props keys while keys hasMoreElements name String keys nextElement classname props getProperty name addDefinition al name classname catch IOException ex throw new BuildException ex getLocation finally FileUtils close is private void loadAntlib ClassLoader classLoader URL url try Antlib antlib Antlib createAntlib getProject url getURI antlib setClassLoader classLoader antlib setURI getURI antlib execute catch BuildException ex throw ProjectHelper addLocationToBuildException ex getLocation public void setFile File file if definerSet tooManyDefinitions definerSet true this file file public void setResource String res if definerSet tooManyDefinitions definerSet true this resource res public void setAntlib String antlib if definerSet tooManyDefinitions if antlib startsWith throw new BuildException setURI antlib this resource antlib substring length replace definerSet true public void setName String name if definerSet tooManyDefinitions definerSet true this name name public String getClassname return classname public void setClassname String classname this classname classname public void setAdapter String adapter this adapter adapter protected void setAdapterClass Class adapterClass this adapterClass adapterClass public void setAdaptTo String adaptTo this adaptTo adaptTo protected void setAdaptToClass Class adaptToClass this adaptToClass adaptToClass protected void addDefinition ClassLoader al String name String classname throws BuildException Class cl null try try name ProjectHelper genComponentName getURI name if onError OnError IGNORE cl Class forName classname true al if adapter null adapterClass Class forName adapter true al if adaptTo null adaptToClass Class forName adaptTo true al AntTypeDefinition def new AntTypeDefinition def setName name def setClassName classname def setClass cl def setAdapterClass adapterClass def setAdaptToClass adaptToClass def setClassLoader al if cl null def checkClass getProject ComponentHelper getComponentHelper getProject addDataTypeDefinition def catch ClassNotFoundException cnfe String msg getTaskName classname throw new BuildException msg cnfe getLocation catch NoClassDefFoundError ncdfe String msg getTaskName classname ncdfe getMessage throw new BuildException msg ncdfe getLocation catch BuildException ex switch onError case OnError FAIL_ALL case OnError FAIL throw ex case OnError REPORT log ex getLocation ex getMessage Project MSG_WARN break default log ex getLocation ex getMessage Project MSG_DEBUG private void tooManyDefinitions throw new BuildException getLocation public class JarLibResolveTask extends Task private String propertyName private Extension requiredExtension private final ArrayList resolvers new ArrayList private boolean checkExtension true private boolean failOnError true public void setProperty final String property this propertyName property public void setCheckExtension final boolean checkExtension this checkExtension checkExtension public void setFailOnError final boolean failOnError this failOnError failOnError public void addConfiguredLocation final LocationResolver loc resolvers add loc public void addConfiguredUrl final URLResolver url resolvers add url public void addConfiguredAnt final AntResolver ant resolvers add ant public void addConfiguredExtension final ExtensionAdapter extension if null requiredExtension final String message throw new BuildException message requiredExtension extension toExtension public void execute throws BuildException validate getProject log requiredExtension Project MSG_VERBOSE String candidate getProject getProperty propertyName if null candidate final String message candidate if failOnError throw new BuildException message getProject log message Project MSG_ERR return final int size resolvers size for int size final ExtensionResolver resolver ExtensionResolver resolvers get getProject log resolver Project MSG_VERBOSE try final File file resolver resolve requiredExtension getProject try checkExtension file return catch final BuildException be final String message file be getMessage getProject log message Project MSG_WARN catch final BuildException be final String message resolver be getProject log message Project MSG_WARN missingExtension private void missingExtension final String message if failOnError throw new BuildException message getProject log message Project MSG_ERR private void checkExtension final File file if file exists final String message file throw new BuildException message if file isFile final String message file throw new BuildException message if checkExtension final String message file getProject log message Project MSG_VERBOSE setLibraryProperty file else getProject log file Project MSG_VERBOSE final Manifest manifest ExtensionUtil getManifest file final Extension extensions Extension getAvailable manifest for int extensions length final Extension extension extensions if extension isCompatibleWith requiredExtension setLibraryProperty file return getProject log file Project MSG_VERBOSE final String message file throw new BuildException message private void setLibraryProperty final File file getProject setNewProperty propertyName file getAbsolutePath private void validate throws BuildException if null propertyName final String message throw new BuildException message if null requiredExtension final String message throw new BuildException message public class AptExternalCompilerAdapter extends DefaultCompilerAdapter protected Apt getApt return Apt getJavac public boolean execute throws BuildException attributes log Project MSG_VERBOSE Apt apt getApt Commandline cmd new Commandline cmd setExecutable apt getAptExecutable setupModernJavacCommandlineSwitches cmd AptCompilerAdapter setAptCommandlineSwitches apt cmd int firstFileName cmd size logAndAddFilesToCompile cmd return executeExternalCompile cmd getCommandline firstFileName true public abstract class DefaultJspCompilerAdapter implements JspCompilerAdapter private static String lSep System getProperty protected void logAndAddFilesToCompile JspC jspc Vector compileList CommandlineJava cmd jspc log cmd describeJavaCommand Project MSG_VERBOSE StringBuffer niceSourceList new StringBuffer if compileList size niceSourceList append niceSourceList append niceSourceList append lSep Enumeration compileList elements while hasMoreElements String arg String nextElement cmd createArgument setValue arg niceSourceList append niceSourceList append arg niceSourceList append lSep jspc log niceSourceList toString Project MSG_VERBOSE protected JspC owner public void setJspc JspC owner this owner owner public JspC getJspc return owner protected void addArg CommandlineJava cmd String argument if argument null argument length cmd createArgument setValue argument protected void addArg CommandlineJava cmd String argument String value if value null cmd createArgument setValue argument cmd createArgument setValue value protected void addArg CommandlineJava cmd String argument File file if file null cmd createArgument setValue argument cmd createArgument setFile file public boolean implementsOwnDependencyChecking return false public Project getProject return getJspc getProject public class ResourceLocation private String publicId null private String location null private URL base null public void setPublicId String publicId this publicId publicId public void setLocation String location this location location public void setBase URL base this base base public String getPublicId return publicId public String getLocation return location public URL getBase return base public class ModifiedSelector extends BaseExtendSelector implements BuildListener ResourceSelector private CacheName cacheName null private String cacheClass private AlgorithmName algoName null private String algorithmClass private ComparatorName compName null private String comparatorClass private boolean update true private boolean selectDirectories true private boolean selectResourcesWithoutInputStream true private boolean delayUpdate true private Comparator comparator null private Algorithm algorithm null private Cache cache null private int modified private boolean isConfigured false private Vector configParameter new Vector private Vector specialParameter new Vector private ClassLoader myClassLoader null private Path classpath null public ModifiedSelector public void verifySettings configure if cache null setError else if algorithm null setError else if cache isValid setError else if algorithm isValid setError public void configure if isConfigured return isConfigured true Project getProject String filename File cachefile null if null cachefile new File getBaseDir filename getProject addBuildListener this else cachefile new File filename setDelayUpdate false Cache defaultCache new PropertiesfileCache cachefile Algorithm defaultAlgorithm new DigestAlgorithm Comparator defaultComparator new EqualComparator update true selectDirectories true for Iterator itConfig configParameter iterator itConfig hasNext Parameter par Parameter itConfig next if par getName indexOf specialParameter add par else useParameter par configParameter new Vector if algoName null if equals algoName getValue algorithm new HashvalueAlgorithm else if equals algoName getValue algorithm new DigestAlgorithm else if equals algoName getValue algorithm new ChecksumAlgorithm else if algorithmClass null algorithm Algorithm loadClass algorithmClass Algorithm class else algorithm defaultAlgorithm if cacheName null if equals cacheName getValue cache new PropertiesfileCache else if cacheClass null cache Cache loadClass cacheClass Cache class else cache defaultCache if compName null if equals compName getValue comparator new EqualComparator else if equals compName getValue throw new BuildException else if comparatorClass null comparator Comparator loadClass comparatorClass Comparator class else comparator defaultComparator for Iterator itSpecial specialParameter iterator itSpecial hasNext Parameter par Parameter itSpecial next useParameter par specialParameter new Vector protected Object loadClass String classname String msg Class type try ClassLoader cl getClassLoader Class clazz null if cl null clazz cl loadClass classname else clazz Class forName classname Object rv clazz newInstance if type isInstance rv throw new BuildException classname msg return rv catch ClassNotFoundException throw new BuildException classname catch Exception throw new BuildException public boolean isSelected Resource resource if resource isFilesystemOnly FileResource fileResource FileResource resource File file fileResource getFile String filename fileResource getName File basedir fileResource getBaseDir return isSelected basedir filename file else try FileUtils fu FileUtils getFileUtils File tmpFile fu createTempFile null Resource tmpResource new FileResource tmpFile ResourceUtils copyResource resource tmpResource boolean isSelected isSelected tmpFile getParentFile tmpFile getName resource toLongString tmpFile delete return isSelected catch UnsupportedOperationException uoe log resource getName selectResourcesWithoutInputStream Project MSG_INFO return selectResourcesWithoutInputStream catch Exception throw new BuildException public boolean isSelected File basedir String filename File file return isSelected basedir filename file getAbsolutePath private boolean isSelected File basedir String filename String cacheKey validate File new File basedir filename if isDirectory return selectDirectories String cachedValue String valueOf cache get getAbsolutePath String newValue algorithm getValue boolean rv comparator compare cachedValue newValue if update rv cache put getAbsolutePath newValue setModified getModified if getDelayUpdate saveCache return rv protected void saveCache if getModified cache save setModified public void setAlgorithmClass String classname algorithmClass classname public void setComparatorClass String classname comparatorClass classname public void setCacheClass String classname cacheClass classname public void setUpdate boolean update this update update public void setSeldirs boolean seldirs selectDirectories seldirs public void setSelres boolean newValue this selectResourcesWithoutInputStream newValue public int getModified return modified public void setModified int modified this modified modified public boolean getDelayUpdate return delayUpdate public void setDelayUpdate boolean delayUpdate this delayUpdate delayUpdate public void addClasspath Path path if classpath null throw new BuildException classpath path public ClassLoader getClassLoader if myClassLoader null myClassLoader classpath null getClass getClassLoader getProject createClassLoader classpath return myClassLoader public void setClassLoader ClassLoader loader myClassLoader loader public void addParam String key Object value Parameter par new Parameter par setName key par setValue String valueOf value configParameter add par public void addParam Parameter parameter configParameter add parameter public void setParameters Parameter parameters if parameters null for int parameters length configParameter add parameters public void useParameter Parameter parameter String key parameter getName String value parameter getValue if equals key CacheName cn new CacheName cn setValue value setCache cn else if equals key AlgorithmName an new AlgorithmName an setValue value setAlgorithm an else if equals key ComparatorName cn new ComparatorName cn setValue value setComparator cn else if equals key boolean updateValue equalsIgnoreCase value true false setUpdate updateValue else if equals key boolean updateValue equalsIgnoreCase value true false setDelayUpdate updateValue else if equals key boolean sdValue equalsIgnoreCase value true false setSeldirs sdValue else if key startsWith String name key substring tryToSetAParameter cache name value else if key startsWith String name key substring tryToSetAParameter algorithm name value else if key startsWith String name key substring tryToSetAParameter comparator name value else setError key protected void tryToSetAParameter Object obj String name String value Project prj getProject null getProject new Project IntrospectionHelper iHelper IntrospectionHelper getHelper prj obj getClass try iHelper setAttribute prj obj name value catch org apache tools ant BuildException public String toString StringBuffer buf new StringBuffer buf append append update buf append append selectDirectories buf append append cache buf append append algorithm buf append append comparator buf append return buf toString public void buildFinished BuildEvent event if getDelayUpdate saveCache public void targetFinished BuildEvent event if getDelayUpdate saveCache public void taskFinished BuildEvent event if getDelayUpdate saveCache public void buildStarted BuildEvent event public void targetStarted BuildEvent event public void taskStarted BuildEvent event public void messageLogged BuildEvent event public Cache getCache return cache public void setCache CacheName name cacheName name public static class CacheName extends EnumeratedAttribute public String getValues return new String public Algorithm getAlgorithm return algorithm public void setAlgorithm AlgorithmName name algoName name public static class AlgorithmName extends EnumeratedAttribute public String getValues return new String public Comparator getComparator return comparator public void setComparator ComparatorName name compName name public static class ComparatorName extends EnumeratedAttribute public String getValues return new String public class AntAnalyzer extends AbstractAnalyzer public AntAnalyzer protected void determineDependencies Vector files Vector classes Hashtable dependencies new Hashtable Hashtable containers new Hashtable Hashtable toAnalyze new Hashtable for Enumeration getRootClasses hasMoreElements String classname String nextElement toAnalyze put classname classname int count int maxCount isClosureRequired MAX_LOOPS Hashtable analyzedDeps null while toAnalyze size count maxCount analyzedDeps new Hashtable for Enumeration toAnalyze keys hasMoreElements String classname String nextElement dependencies put classname classname try File container getClassContainer classname if container null continue containers put container container ZipFile zipFile null InputStream inStream null try if container getName endsWith inStream new FileInputStream container getPath else zipFile new ZipFile container getPath String entryName classname replace ZipEntry entry new ZipEntry entryName inStream zipFile getInputStream entry ClassFile classFile new ClassFile classFile read inStream Vector dependencyList classFile getClassRefs Enumeration depEnum dependencyList elements while depEnum hasMoreElements String dependency String depEnum nextElement analyzedDeps put dependency dependency finally if inStream null inStream close if zipFile null zipFile close catch IOException ioe toAnalyze clear Enumeration depsEnum analyzedDeps elements while depsEnum hasMoreElements String className String depsEnum nextElement if dependencies containsKey className toAnalyze put className className Enumeration depsEnum analyzedDeps elements while depsEnum hasMoreElements String className String depsEnum nextElement dependencies put className className files removeAllElements for Enumeration containers keys hasMoreElements files addElement File nextElement classes removeAllElements for Enumeration dependencies keys hasMoreElements classes addElement String nextElement protected boolean supportsFileDependencies return true public abstract class ConditionBase extends ProjectComponent implements DynamicElement private static final String CONDITION_ANTLIB private String taskName private Vector conditions new Vector protected ConditionBase taskName protected ConditionBase String taskName this taskName taskName protected int countConditions return conditions size protected final Enumeration getConditions return conditions elements public void setTaskName String name this taskName name public String getTaskName return taskName public void addAvailable Available conditions addElement public void addChecksum Checksum conditions addElement public void addUptodate UpToDate conditions addElement public void addNot Not conditions addElement public void addAnd And conditions addElement public void addOr Or conditions addElement public void addEquals Equals conditions addElement public void addOs Os conditions addElement public void addIsSet IsSet conditions addElement public void addHttp Http conditions addElement public void addSocket Socket conditions addElement public void addFilesMatch FilesMatch test conditions addElement test public void addContains Contains test conditions addElement test public void addIsTrue IsTrue test conditions addElement test public void addIsFalse IsFalse test conditions addElement test public void addIsReference IsReference conditions addElement public void addIsFileSelected IsFileSelected test conditions addElement test public void add Condition conditions addElement public Object createDynamicElement String name Object cond ComponentHelper getComponentHelper getProject createComponent CONDITION_ANTLIB name if cond instanceof Condition return null log name cond Project MSG_DEBUG add Condition cond return cond public class P4Integrate extends P4Base private String change null private String fromfile null private String tofile null private String branch null private boolean restoredeletedrevisions false private boolean forceintegrate false private boolean leavetargetrevision false private boolean enablebaselessmerges false private boolean simulationmode false private boolean reversebranchmappings false private boolean propagatesourcefiletype false private boolean nocopynewtargetfiles false public String getChange return change public void setChange String change this change change public String getFromfile return fromfile public void setFromfile String fromf this fromfile fromf public String getTofile return tofile public void setTofile String tof this tofile tof public String getBranch return branch public void setBranch String br this branch br public boolean isRestoreDeletedRevisions return restoredeletedrevisions public void setRestoreDeletedRevisions boolean setrest this restoredeletedrevisions setrest public boolean isForceIntegrate return forceintegrate public void setForceIntegrate boolean setrest this forceintegrate setrest public boolean isLeaveTargetRevision return leavetargetrevision public void setLeaveTargetRevision boolean setrest this leavetargetrevision setrest public boolean isEnableBaselessMerges return enablebaselessmerges public void setEnableBaselessMerges boolean setrest this enablebaselessmerges setrest public boolean isSimulationMode return simulationmode public void setSimulationMode boolean setrest this simulationmode setrest public boolean isReversebranchmappings return reversebranchmappings public void setReversebranchmappings boolean reversebranchmappings this reversebranchmappings reversebranchmappings public boolean isPropagatesourcefiletype return propagatesourcefiletype public void setPropagatesourcefiletype boolean propagatesourcefiletype this propagatesourcefiletype propagatesourcefiletype public boolean isNocopynewtargetfiles return nocopynewtargetfiles public void setNocopynewtargetfiles boolean nocopynewtargetfiles this nocopynewtargetfiles nocopynewtargetfiles public void execute throws BuildException if change null P4CmdOpts change if this forceintegrate P4CmdOpts P4CmdOpts if this restoredeletedrevisions P4CmdOpts P4CmdOpts if this leavetargetrevision P4CmdOpts P4CmdOpts if this enablebaselessmerges P4CmdOpts P4CmdOpts if this simulationmode P4CmdOpts P4CmdOpts if this reversebranchmappings P4CmdOpts P4CmdOpts if this propagatesourcefiletype P4CmdOpts P4CmdOpts if this nocopynewtargetfiles P4CmdOpts P4CmdOpts String command if branch null fromfile null tofile null command P4CmdOpts fromfile tofile else if branch null fromfile null tofile null command P4CmdOpts branch tofile else if branch null fromfile null command P4CmdOpts branch fromfile tofile else throw new BuildException execP4Command command new SimpleP4OutputHandler this public class ReflectUtil private ReflectUtil public static Object invoke Object obj String methodName try Method method method obj getClass getMethod methodName Class null return method invoke obj Object null catch Exception throwBuildException public static Object invoke Object obj String methodName Class argType Object arg try Method method method obj getClass getMethod methodName new Class argType return method invoke obj new Object arg catch Exception throwBuildException public static Object invoke Object obj String methodName Class argType1 Object arg1 Class argType2 Object arg2 try Method method method obj getClass getMethod methodName new Class argType1 argType2 return method invoke obj new Object arg1 arg2 catch Exception throwBuildException public static Object getField Object obj String fieldName throws BuildException try Field field obj getClass getDeclaredField fieldName field setAccessible true return field get obj catch Exception throwBuildException public static void throwBuildException Exception throws BuildException if instanceof InvocationTargetException Throwable t2 InvocationTargetException getTargetException if t2 instanceof BuildException throw BuildException t2 throw new BuildException t2 else throw new BuildException public class CCMCreateTask extends Continuus implements ExecuteStreamHandler private String comment null private String platform null private String resolver null private String release null private String subSystem null private String task null public CCMCreateTask super setCcmAction COMMAND_CREATE_TASK public void execute throws BuildException Commandline commandLine new Commandline int result commandLine setExecutable getCcmCommand commandLine createArgument setValue getCcmAction checkOptions commandLine result run commandLine this if Execute isFailure result String msg commandLine toString throw new BuildException msg getLocation Commandline commandLine2 new Commandline commandLine2 setExecutable getCcmCommand commandLine2 createArgument setValue COMMAND_DEFAULT_TASK commandLine2 createArgument setValue getTask log commandLine describeCommand Project MSG_DEBUG result run commandLine2 if result String msg commandLine2 toString throw new BuildException msg getLocation private void checkOptions Commandline cmd if getComment null cmd createArgument setValue FLAG_COMMENT cmd createArgument setValue getComment if getPlatform null cmd createArgument setValue FLAG_PLATFORM cmd createArgument setValue getPlatform if getResolver null cmd createArgument setValue FLAG_RESOLVER cmd createArgument setValue getResolver if getSubSystem null cmd createArgument setValue FLAG_SUBSYSTEM cmd createArgument setValue getSubSystem if getRelease null cmd createArgument setValue FLAG_RELEASE cmd createArgument setValue getRelease public String getComment return comment public void setComment String this comment public String getPlatform return platform public void setPlatform String this platform public String getResolver return resolver public void setResolver String this resolver public String getRelease return release public void setRelease String this release public String getSubSystem return subSystem public void setSubSystem String this subSystem public String getTask return task public void setTask String this task public static final String FLAG_COMMENT public static final String FLAG_PLATFORM public static final String FLAG_RESOLVER public static final String FLAG_RELEASE public static final String FLAG_SUBSYSTEM public static final String FLAG_TASK public void start throws IOException public void stop public void setProcessInputStream OutputStream param1 throws IOException public void setProcessErrorStream InputStream is throws IOException BufferedReader reader new BufferedReader new InputStreamReader is String reader readLine if null log Project MSG_DEBUG public void setProcessOutputStream InputStream is throws IOException String buffer try BufferedReader reader new BufferedReader new InputStreamReader is buffer reader readLine if buffer null log buffer Project MSG_DEBUG String taskstring buffer substring buffer indexOf trim taskstring taskstring substring taskstring lastIndexOf trim setTask taskstring log getTask Project MSG_DEBUG catch NullPointerException npe log Project MSG_ERR npe printStackTrace throw new BuildException npe getClass getName catch Exception log getMessage Project MSG_ERR throw new BuildException getMessage public class Get extends Task private static final FileUtils FILE_UTILS FileUtils getFileUtils private boolean verbose false private boolean ignoreErrors false private String uname null private String pword null public void execute throws BuildException int logLevel Project MSG_INFO DownloadProgress progress null if verbose progress new VerboseProgress System out try doGet logLevel progress catch IOException ioe log source dest if ignoreErrors throw new BuildException ioe getLocation public boolean doGet int logLevel DownloadProgress progress throws IOException if source null throw new BuildException getLocation if dest null throw new BuildException getLocation if dest exists dest isDirectory throw new BuildException getLocation if dest exists dest canWrite throw new BuildException dest getAbsolutePath getLocation if progress null progress new NullProgress log source logLevel log dest getAbsolutePath logLevel long timestamp boolean hasTimestamp false if useTimestamp dest exists timestamp dest lastModified if verbose Date new Date timestamp log toString logLevel hasTimestamp true URLConnection connection source openConnection if hasTimestamp connection setIfModifiedSince timestamp if uname null pword null String up uname pword String encoding Base64Converter encoder new Base64Converter encoding encoder encode up getBytes connection setRequestProperty encoding connection connect if connection instanceof HttpURLConnection HttpURLConnection httpConnection HttpURLConnection connection long lastModified httpConnection getLastModified if httpConnection getResponseCode HttpURLConnection HTTP_NOT_MODIFIED lastModified hasTimestamp timestamp lastModified log logLevel return false if httpConnection getResponseCode HttpURLConnection HTTP_UNAUTHORIZED String message if ignoreErrors log message logLevel return false else throw new BuildException message InputStream is null for int try is connection getInputStream break catch IOException ex log ex logLevel if is null log source dest logLevel if ignoreErrors return false throw new BuildException source dest getLocation FileOutputStream fos new FileOutputStream dest progress beginDownload boolean finished false try byte buffer new byte int length while length is read buffer fos write buffer length progress onTick finished true finally FileUtils close fos FileUtils close is if finished dest delete progress endDownload if useTimestamp long remoteTimestamp connection getLastModified if verbose Date new Date remoteTimestamp log toString remoteTimestamp logLevel if remoteTimestamp FILE_UTILS setFileLastModified dest remoteTimestamp return true public void setSrc URL this source public void setDest File dest this dest dest public void setVerbose boolean verbose public void setIgnoreErrors boolean ignoreErrors public void setUseTimestamp boolean useTimestamp public void setUsername String this uname public void setPassword String this pword protected static class Base64Converter extends org apache tools ant util Base64Converter public interface DownloadProgress void beginDownload void onTick void endDownload public static class NullProgress implements DownloadProgress public void beginDownload public void onTick public void endDownload public static class VerboseProgress implements DownloadProgress private int dots PrintStream out public VerboseProgress PrintStream out this out out public void beginDownload dots public void onTick out print if dots out flush dots public void endDownload out println out flush public class RetryHandler private int retriesAllowed private Task task public RetryHandler int retriesAllowed Task task this retriesAllowed retriesAllowed this task task public void execute Retryable exe String desc throws IOException int retries while true try exe execute break catch IOException retries if retries this retriesAllowed this retriesAllowed task log retries desc this retriesAllowed Project MSG_WARN throw else task log retries desc Project MSG_WARN public class FilterMapper extends FilterChain implements FileNameMapper public void setFrom String from throw new UnsupportedAttributeException public void setTo String to throw new UnsupportedAttributeException public String mapFileName String sourceFileName try Reader stringReader new StringReader sourceFileName ChainReaderHelper helper new ChainReaderHelper helper setBufferSize helper setPrimaryReader stringReader helper setProject getProject Vector filterChains new Vector filterChains add this helper setFilterChains filterChains String result FileUtils readFully helper getAssembledReader if result length return null else return new String result catch BuildException ex throw ex catch Exception ex throw new BuildException ex public class ZipFile private Hashtable entries new Hashtable private Hashtable nameMap new Hashtable private static final class OffsetEntry private long headerOffset private long dataOffset private String encoding null private RandomAccessFile archive public ZipFile File throws IOException this null public ZipFile String name throws IOException this new File name null public ZipFile String name String encoding throws IOException this new File name encoding public ZipFile File String encoding throws IOException this encoding encoding archive new RandomAccessFile try populateFromCentralDirectory resolveLocalFileHeaderData catch IOException try archive close catch IOException e2 throw public String getEncoding return encoding public void close throws IOException archive close public static void closeQuietly ZipFile zipfile if zipfile null try zipfile close catch IOException public Enumeration getEntries return entries keys public ZipEntry getEntry String name return ZipEntry nameMap get name public InputStream getInputStream ZipEntry ze throws IOException ZipException OffsetEntry offsetEntry OffsetEntry entries get ze if offsetEntry null return null long start offsetEntry dataOffset BoundedInputStream bis new BoundedInputStream start ze getCompressedSize switch ze getMethod case ZipEntry STORED return bis case ZipEntry DEFLATED bis addDummy return new InflaterInputStream bis new Inflater true default throw new ZipException ze getMethod private static final int CFH_LEN private void populateFromCentralDirectory throws IOException positionAtCentralDirectory byte cfh new byte CFH_LEN byte signatureBytes new byte archive readFully signatureBytes long sig ZipLong getValue signatureBytes final long cfhSig ZipLong getValue ZipOutputStream CFH_SIG while sig cfhSig archive readFully cfh int off ZipEntry ze new ZipEntry int versionMadeBy ZipShort getValue cfh off off ze setPlatform versionMadeBy ze setMethod ZipShort getValue cfh off off long time dosToJavaTime ZipLong getValue cfh off ze setTime time off ze setCrc ZipLong getValue cfh off off ze setCompressedSize ZipLong getValue cfh off off ze setSize ZipLong getValue cfh off off int fileNameLen ZipShort getValue cfh off off int extraLen ZipShort getValue cfh off off int commentLen ZipShort getValue cfh off off ze setInternalAttributes ZipShort getValue cfh off off ze setExternalAttributes ZipLong getValue cfh off off byte fileName new byte fileNameLen archive readFully fileName ze setName getString fileName OffsetEntry offset new OffsetEntry offset headerOffset ZipLong getValue cfh off entries put ze offset nameMap put ze getName ze archive skipBytes extraLen byte comment new byte commentLen archive readFully comment ze setComment getString comment archive readFully signatureBytes sig ZipLong getValue signatureBytes private static final int MIN_EOCD_SIZE private static final int CFD_LOCATOR_OFFSET private void positionAtCentralDirectory throws IOException boolean found false long off archive length MIN_EOCD_SIZE if off archive seek off byte sig ZipOutputStream EOCD_SIG int curr archive read while curr if curr sig curr archive read if curr sig curr archive read if curr sig curr archive read if curr sig found true break archive seek off curr archive read if found throw new ZipException archive seek off CFD_LOCATOR_OFFSET byte cfdOffset new byte archive readFully cfdOffset archive seek ZipLong getValue cfdOffset private static final long LFH_OFFSET_FOR_FILENAME_LENGTH private void resolveLocalFileHeaderData throws IOException Enumeration getEntries while hasMoreElements ZipEntry ze ZipEntry nextElement OffsetEntry offsetEntry OffsetEntry entries get ze long offset offsetEntry headerOffset archive seek offset LFH_OFFSET_FOR_FILENAME_LENGTH byte new byte archive readFully int fileNameLen ZipShort getValue archive readFully int extraFieldLen ZipShort getValue archive skipBytes fileNameLen byte localExtraData new byte extraFieldLen archive readFully localExtraData ze setExtra localExtraData offsetEntry dataOffset offset LFH_OFFSET_FOR_FILENAME_LENGTH fileNameLen extraFieldLen protected static Date fromDosTime ZipLong zipDosTime long dosTime zipDosTime getValue return new Date dosToJavaTime dosTime private static long dosToJavaTime long dosTime Calendar cal Calendar getInstance cal set Calendar YEAR int dosTime cal set Calendar MONTH int dosTime cal set Calendar DATE int dosTime cal set Calendar HOUR_OF_DAY int dosTime cal set Calendar MINUTE int dosTime cal set Calendar SECOND int dosTime return cal getTime getTime protected String getString byte bytes throws ZipException if encoding null return new String bytes else try return new String bytes encoding catch UnsupportedEncodingException uee throw new ZipException uee getMessage private class BoundedInputStream extends InputStream private long remaining private long loc private boolean addDummyByte false BoundedInputStream long start long remaining this remaining remaining loc start public int read throws IOException if remaining if addDummyByte addDummyByte false return return synchronized archive archive seek loc return archive read public int read byte int off int len throws IOException if remaining if addDummyByte addDummyByte false off return return if len return if len remaining len int remaining int ret synchronized archive archive seek loc ret archive read off len if ret loc ret remaining ret return ret void addDummy addDummyByte true public final class CompilerAdapterFactory private static final String MODERN_COMPILER private CompilerAdapterFactory public static CompilerAdapter getCompiler String compilerType Task task throws BuildException boolean isClassicCompilerSupported true if JavaEnvUtils isJavaVersion JavaEnvUtils JAVA_1_2 JavaEnvUtils isJavaVersion JavaEnvUtils JAVA_1_3 isClassicCompilerSupported false if compilerType equalsIgnoreCase return new Jikes if compilerType equalsIgnoreCase return new JavacExternal if compilerType equalsIgnoreCase compilerType equalsIgnoreCase compilerType equalsIgnoreCase if isClassicCompilerSupported return new Javac12 else task log Project MSG_WARN compilerType if compilerType equalsIgnoreCase compilerType equalsIgnoreCase compilerType equalsIgnoreCase compilerType equalsIgnoreCase compilerType equalsIgnoreCase if doesModernCompilerExist return new Javac13 else if isClassicCompilerSupported task log Project MSG_WARN return new Javac12 else throw new BuildException MODERN_COMPILER JavaEnvUtils getJavaHome if compilerType equalsIgnoreCase compilerType equalsIgnoreCase return new Jvc if compilerType equalsIgnoreCase return new Kjc if compilerType equalsIgnoreCase return new Gcj if compilerType equalsIgnoreCase compilerType equalsIgnoreCase return new Sj return resolveClassName compilerType private static boolean doesModernCompilerExist try Class forName MODERN_COMPILER return true catch ClassNotFoundException cnfe try ClassLoader cl CompilerAdapterFactory class getClassLoader if cl null cl loadClass MODERN_COMPILER return true catch ClassNotFoundException cnfe2 return false private static CompilerAdapter resolveClassName String className throws BuildException return CompilerAdapter ClasspathUtils newInstance className CompilerAdapterFactory class getClassLoader CompilerAdapter class public class LazyHashtable extends Hashtable protected boolean initAllDone false public LazyHashtable super protected void initAll if initAllDone return initAllDone true public Enumeration elements initAll return super elements public boolean isEmpty initAll return super isEmpty public int size initAll return super size public boolean contains Object value initAll return super contains value public boolean containsKey Object value initAll return super containsKey value public boolean containsValue Object value return contains value public Enumeration keys initAll return super keys public class DateSelector extends BaseExtendSelector private static final FileUtils FILE_UTILS FileUtils getFileUtils private long millis private String dateTime null private boolean includeDirs false private long granularity private String pattern private TimeComparison when TimeComparison EQUAL public static final String MILLIS_KEY public static final String DATETIME_KEY public static final String CHECKDIRS_KEY public static final String GRANULARITY_KEY public static final String WHEN_KEY public static final String PATTERN_KEY public DateSelector granularity FILE_UTILS getFileTimestampGranularity public String toString StringBuffer buf new StringBuffer buf append dateTime buf append append when getValue buf append buf append granularity if pattern null buf append append pattern buf append return buf toString public void setMillis long millis this millis millis public long getMillis if dateTime null validate return millis public void setDatetime String dateTime this dateTime dateTime millis public void setCheckdirs boolean includeDirs this includeDirs includeDirs public void setGranularity int granularity this granularity granularity public void setWhen TimeComparisons tcmp setWhen TimeComparison tcmp public void setWhen TimeComparison when public void setPattern String pattern this pattern pattern public void setParameters Parameter parameters super setParameters parameters if parameters null for int parameters length String paramname parameters getName if MILLIS_KEY equalsIgnoreCase paramname try setMillis new Long parameters getValue longValue catch NumberFormatException nfe setError parameters getValue else if DATETIME_KEY equalsIgnoreCase paramname setDatetime parameters getValue else if CHECKDIRS_KEY equalsIgnoreCase paramname setCheckdirs Project toBoolean parameters getValue else if GRANULARITY_KEY equalsIgnoreCase paramname try setGranularity new Integer parameters getValue intValue catch NumberFormatException nfe setError parameters getValue else if WHEN_KEY equalsIgnoreCase paramname setWhen new TimeComparison parameters getValue else if PATTERN_KEY equalsIgnoreCase paramname setPattern parameters getValue else setError paramname public void verifySettings if dateTime null millis setError else if millis dateTime null DateFormat df pattern null DateFormat getDateTimeInstance DateFormat SHORT DateFormat SHORT Locale US new SimpleDateFormat pattern try setMillis df parse dateTime getTime if millis setError dateTime catch ParseException pe setError dateTime pattern null pattern public boolean isSelected File basedir String filename File file validate return file isDirectory includeDirs when evaluate file lastModified millis granularity public static class TimeComparisons extends TimeComparison public class ScriptDef extends DefBase private ScriptRunnerHelper helper new ScriptRunnerHelper private ScriptRunnerBase runner null private String name private List attributes new ArrayList private List nestedElements new ArrayList private Set attributeSet private Map nestedElementMap public void setProject Project project super setProject project helper setProjectComponent this helper setSetBeans false public void setName String name this name name public boolean isAttributeSupported String attributeName return attributeSet contains attributeName public static class Attribute private String name public void setName String name this name name toLowerCase Locale US public void addAttribute Attribute attribute attributes add attribute public static class NestedElement private String name private String type private String className public void setName String name this name name toLowerCase Locale US public void setType String type this type type public void setClassName String className this className className public void addElement NestedElement nestedElement nestedElements add nestedElement public void execute if name null throw new BuildException if helper getLanguage null throw new BuildException if getAntlibClassLoader null hasCpDelegate helper setClassLoader createLoader runner helper getScriptRunner attributeSet new HashSet for Iterator attributes iterator hasNext Attribute attribute Attribute next if attribute name null throw new BuildException if attributeSet contains attribute name throw new BuildException name attribute name attributeSet add attribute name nestedElementMap new HashMap for Iterator nestedElements iterator hasNext NestedElement nestedElement NestedElement next if nestedElement name null throw new BuildException if nestedElementMap containsKey nestedElement name throw new BuildException name nestedElement name if nestedElement className null nestedElement type null throw new BuildException if nestedElement className null nestedElement type null throw new BuildException nestedElementMap put nestedElement name nestedElement Map scriptRepository null Project getProject synchronized scriptRepository Map getReference MagicNames SCRIPT_REPOSITORY if scriptRepository null scriptRepository new HashMap addReference MagicNames SCRIPT_REPOSITORY scriptRepository name ProjectHelper genComponentName getURI name scriptRepository put name this AntTypeDefinition def new AntTypeDefinition def setName name def setClass ScriptDefBase class ComponentHelper getComponentHelper getProject addDataTypeDefinition def public Object createNestedElement String elementName NestedElement definition NestedElement nestedElementMap get elementName if definition null throw new BuildException name elementName Object instance null String classname definition className if classname null instance getProject createTask definition type if instance null instance getProject createDataType definition type else ClassLoader loader createLoader try instance ClasspathUtils newInstance classname loader catch BuildException instance ClasspathUtils newInstance classname ScriptDef class getClassLoader getProject setProjectReference instance if instance null throw new BuildException name elementName return instance public void executeScript Map attributes Map elements executeScript attributes elements null public void executeScript Map attributes Map elements ScriptDefBase instance runner addBean attributes runner addBean elements runner addBean getProject if instance null runner addBean instance runner executeScript name public void setManager String manager helper setManager manager public void setLanguage String language helper setLanguage language public void setSrc File file helper setSrc file public void addText String text helper addText text public class IsFileSelected extends AbstractSelectorContainer implements Condition private static final FileUtils FILE_UTILS FileUtils getFileUtils private File file private File baseDir public void setFile File file this file file public void setBaseDir File baseDir this baseDir baseDir public void validate if selectorCount throw new BuildException super validate public boolean eval if file null throw new BuildException validate File myBaseDir baseDir if myBaseDir null myBaseDir getProject getBaseDir FileSelector getSelectors getProject return isSelected myBaseDir FILE_UTILS removeLeadingPath myBaseDir file file public class ExecuteOn extends ExecTask private Union resources null private boolean relative false private boolean parallel false private boolean forwardSlash false protected String type FileDirBoth FILE protected Commandline Marker srcFilePos null private boolean skipEmpty false protected Commandline Marker targetFilePos null protected Mapper mapperElement null protected FileNameMapper mapper null protected File destDir null private int maxParallel private boolean addSourceFile true private boolean verbose false private boolean ignoreMissing true private boolean force false protected boolean srcIsFirst true public void addFileset FileSet set filesets addElement set public void addDirset DirSet set filesets addElement set public void addFilelist FileList list add list public void add ResourceCollection rc if resources null resources new Union resources add rc public void setRelative boolean relative this relative relative public void setParallel boolean parallel this parallel parallel public void setType FileDirBoth type this type type getValue public void setSkipEmptyFilesets boolean skip skipEmpty skip public void setDest File destDir this destDir destDir public void setForwardslash boolean forwardSlash this forwardSlash forwardSlash public void setMaxParallel int max maxParallel max public void setAddsourcefile boolean addSourceFile public void setVerbose boolean verbose public void setIgnoremissing boolean ignoreMissing public void setForce boolean force public Commandline Marker createSrcfile if srcFilePos null throw new BuildException getTaskType getLocation srcFilePos cmdl createMarker return srcFilePos public Commandline Marker createTargetfile if targetFilePos null throw new BuildException getTaskType getLocation targetFilePos cmdl createMarker srcIsFirst srcFilePos null return targetFilePos public Mapper createMapper throws BuildException if mapperElement null throw new BuildException getLocation mapperElement new Mapper getProject return mapperElement public void add FileNameMapper fileNameMapper createMapper add fileNameMapper protected void checkConfiguration if equals getTaskName log super checkConfiguration if filesets size resources null throw new BuildException getLocation if targetFilePos null mapperElement null throw new BuildException getLocation if destDir null mapperElement null throw new BuildException getLocation if mapperElement null mapper mapperElement getImplementation protected ExecuteStreamHandler createHandler throws BuildException return redirectorElement null super createHandler new PumpStreamHandler protected void setupRedirector super setupRedirector redirector setAppendProperties true protected void runExec Execute exe throws BuildException int totalFiles int totalDirs boolean haveExecuted false try Vector fileNames new Vector Vector baseDirs new Vector for int filesets size String currentType type AbstractFileSet fs AbstractFileSet filesets elementAt if fs instanceof DirSet if FileDirBoth DIR equals type log type Project MSG_DEBUG currentType FileDirBoth DIR File base fs getDir getProject DirectoryScanner ds fs getDirectoryScanner getProject if FileDirBoth DIR equals currentType String getFiles base ds for int length totalFiles fileNames addElement baseDirs addElement base if FileDirBoth FILE equals currentType String getDirs base ds for int length totalDirs fileNames addElement baseDirs addElement base if fileNames size skipEmpty int includedCount FileDirBoth DIR equals currentType ds getIncludedFilesCount FileDirBoth FILE equals currentType ds getIncludedDirsCount log base includedCount Project MSG_INFO continue if parallel String new String fileNames size fileNames copyInto for int length String command getCommandline base log Commandline describeCommand command Project MSG_VERBOSE exe setCommandline command if redirectorElement null setupRedirector redirectorElement configure redirector if redirectorElement null haveExecuted exe setStreamHandler redirector createHandler runExecute exe haveExecuted true fileNames removeAllElements baseDirs removeAllElements if resources null Iterator iter resources iterator while iter hasNext Resource res Resource iter next if res isExists ignoreMissing continue File base null String name res getName if res instanceof FileResource FileResource fr FileResource res base fr getBaseDir if base null name fr getFile getAbsolutePath if restrict new String name base length continue if res isDirectory res isExists FileDirBoth DIR equals type totalFiles else if res isDirectory FileDirBoth FILE equals type totalDirs else continue baseDirs add base fileNames add name if parallel String command getCommandline name base log Commandline describeCommand command Project MSG_VERBOSE exe setCommandline command if redirectorElement null setupRedirector redirectorElement configure redirector name if redirectorElement null haveExecuted exe setStreamHandler redirector createHandler runExecute exe haveExecuted true fileNames removeAllElements baseDirs removeAllElements if parallel fileNames size skipEmpty runParallel exe fileNames baseDirs haveExecuted true if haveExecuted log cmdl getExecutable totalFiles totalFiles totalDirs totalDirs verbose Project MSG_INFO Project MSG_VERBOSE catch IOException throw new BuildException getLocation finally logFlush redirector setAppendProperties false redirector setProperties protected String getCommandline String srcFiles File baseDirs final char fileSeparator File separatorChar Vector targets new Vector if targetFilePos null Hashtable addedFiles new Hashtable for int srcFiles length String subTargets mapper mapFileName srcFiles if subTargets null for int subTargets length String name null if relative name new File destDir subTargets getAbsolutePath else name subTargets if forwardSlash fileSeparator name name replace fileSeparator if addedFiles contains name targets addElement name addedFiles put name name String targetFiles new String targets size targets copyInto targetFiles if addSourceFile srcFiles new String String orig cmdl getCommandline String result new String orig length srcFiles length targetFiles length int srcIndex orig length if srcFilePos null srcIndex srcFilePos getPosition if targetFilePos null int targetIndex targetFilePos getPosition if srcIndex targetIndex srcIndex targetIndex srcIsFirst System arraycopy orig result srcIndex System arraycopy orig srcIndex result srcIndex srcFiles length targetIndex srcIndex System arraycopy targetFiles result targetIndex srcFiles length targetFiles length System arraycopy orig targetIndex result targetIndex srcFiles length targetFiles length orig length targetIndex else System arraycopy orig result targetIndex System arraycopy targetFiles result targetIndex targetFiles length System arraycopy orig targetIndex result targetIndex targetFiles length srcIndex targetIndex System arraycopy orig srcIndex result srcIndex srcFiles length targetFiles length orig length srcIndex srcIndex targetFiles length System arraycopy orig result srcIndex System arraycopy orig srcIndex result srcIndex srcFiles length orig length srcIndex for int srcFiles length if relative result srcIndex new File baseDirs srcFiles getAbsolutePath else result srcIndex srcFiles if forwardSlash fileSeparator result srcIndex result srcIndex replace fileSeparator return result protected String getCommandline String srcFile File baseDir return getCommandline new String srcFile new File baseDir protected String getFiles File baseDir DirectoryScanner ds return restrict ds getIncludedFiles baseDir protected String getDirs File baseDir DirectoryScanner ds return restrict ds getIncludedDirectories baseDir protected String getFilesAndDirs FileList list return restrict list getFiles getProject list getDir getProject private String restrict String File baseDir return mapper null force new SourceFileScanner this restrict baseDir destDir mapper protected void runParallel Execute exe Vector fileNames Vector baseDirs throws IOException BuildException String new String fileNames size fileNames copyInto File new File baseDirs size baseDirs copyInto if maxParallel String command getCommandline log Commandline describeCommand command Project MSG_VERBOSE exe setCommandline command runExecute exe else int stillToDo fileNames size int currentOffset while stillToDo int currentAmount Math min stillToDo maxParallel String cs new String currentAmount System arraycopy currentOffset cs currentAmount File cb new File currentAmount System arraycopy currentOffset cb currentAmount String command getCommandline cs cb log Commandline describeCommand command Project MSG_VERBOSE exe setCommandline command if redirectorElement null setupRedirector redirectorElement configure redirector null if redirectorElement null currentOffset exe setStreamHandler redirector createHandler runExecute exe stillToDo currentAmount currentOffset currentAmount public static class FileDirBoth extends EnumeratedAttribute public static final String FILE public static final String DIR public String getValues return new String FILE DIR public class PathConvert extends Task private static boolean onWindows Os isFamily private Union path null private Reference refid null private String targetOS null private boolean targetWindows false private boolean setonempty true private String property null private Vector prefixMap new Vector private String pathSep null private String dirSep null private Mapper mapper null public PathConvert public class MapEntry private String from null private String to null public void setFrom String from this from from public void setTo String to this to to public String apply String elem if from null to null throw new BuildException String cmpElem onWindows elem toLowerCase replace elem String cmpFrom onWindows from toLowerCase replace from return cmpElem startsWith cmpFrom to elem substring from length elem public static class TargetOs extends EnumeratedAttribute public String getValues return new String public Path createPath if isReference throw noChildrenAllowed Path result new Path getProject add result return result public void add ResourceCollection rc if isReference throw noChildrenAllowed getPath add rc private synchronized Union getPath if path null path new Union path setProject getProject return path public MapEntry createMap MapEntry entry new MapEntry prefixMap addElement entry return entry public void setTargetos String target TargetOs to new TargetOs to setValue target setTargetos to public void setTargetos TargetOs target targetOS target getValue targetWindows targetOS equals targetOS equals public void setSetonempty boolean setonempty this setonempty setonempty public void setProperty String property public void setRefid Reference if path null throw noChildrenAllowed refid public void setPathSep String sep pathSep sep public void setDirSep String sep dirSep sep public boolean isReference return refid null public void execute throws BuildException Union savedPath path try if isReference Object refid getReferencedObject getProject if instanceof ResourceCollection throw new BuildException refid getRefId getPath add ResourceCollection String fromDirSep onWindows StringBuffer rslt new StringBuffer String elems path list if mapper null FileNameMapper impl mapper getImplementation List ret new ArrayList for int elems length String mapped impl mapFileName elems for int mapped null mapped length ret add mapped elems String ret toArray new String ret size for int elems length if rslt append pathSep StringTokenizer stDirectory new StringTokenizer elem fromDirSep true while stDirectory hasMoreTokens String token stDirectory nextToken rslt append fromDirSep equals token dirSep token if setonempty rslt length String value rslt toString if property null log value else log property value Project MSG_VERBOSE getProject setNewProperty property value finally path savedPath dirSep savedDirSep pathSep savedPathSep private String mapElement String elem int size prefixMap size if size for int size MapEntry entry MapEntry prefixMap elementAt String newElem entry apply elem if newElem elem elem newElem return elem public void addMapper Mapper mapper if this mapper null throw new BuildException this mapper mapper public void add FileNameMapper fileNameMapper Mapper new Mapper getProject add fileNameMapper addMapper private void validateSetup throws BuildException if path null throw new BuildException String dsep File separator String psep File pathSeparator if targetOS null psep targetWindows dsep targetWindows if pathSep null psep pathSep if dirSep null dsep dirSep pathSep psep dirSep dsep private BuildException noChildrenAllowed return new BuildException public class TarEntry implements TarConstants private StringBuffer name private int mode private int userId private int groupId private long size private long modTime private byte linkFlag private StringBuffer linkName private StringBuffer magic private StringBuffer userName private StringBuffer groupName private int devMajor private int devMinor private File file public static final int MAX_NAMELEN public static final int DEFAULT_DIR_MODE public static final int DEFAULT_FILE_MODE public static final int MILLIS_PER_SECOND private TarEntry this magic new StringBuffer TMAGIC this name new StringBuffer this linkName new StringBuffer String user System getProperty if user length MAX_NAMELEN user user substring MAX_NAMELEN this userId this groupId this userName new StringBuffer user this groupName new StringBuffer this file null public TarEntry String name this boolean isDir name endsWith this devMajor this devMinor this name new StringBuffer name this mode isDir DEFAULT_DIR_MODE DEFAULT_FILE_MODE this linkFlag isDir LF_DIR LF_NORMAL this userId this groupId this size this modTime new Date getTime MILLIS_PER_SECOND this linkName new StringBuffer this userName new StringBuffer this groupName new StringBuffer this devMajor this devMinor public TarEntry String name byte linkFlag this name this linkFlag linkFlag public TarEntry File file this this file file String fileName file getPath String osname System getProperty toLowerCase Locale US if osname null if osname startsWith if fileName length char ch1 fileName charAt char ch2 fileName charAt if ch2 ch1 ch1 ch1 ch1 fileName fileName substring else if osname indexOf int colon fileName indexOf if colon fileName fileName substring colon fileName fileName replace File separatorChar while fileName startsWith fileName fileName substring this linkName new StringBuffer this name new StringBuffer fileName if file isDirectory this mode DEFAULT_DIR_MODE this linkFlag LF_DIR if this name charAt this name length this name append else this mode DEFAULT_FILE_MODE this linkFlag LF_NORMAL this size file length this modTime file lastModified MILLIS_PER_SECOND this devMajor this devMinor public TarEntry byte headerBuf this this parseTarHeader headerBuf public boolean equals TarEntry it return this getName equals it getName public boolean equals Object it if it null getClass it getClass return false return equals TarEntry it public int hashCode return getName hashCode public boolean isDescendent TarEntry desc return desc getName startsWith this getName public String getName return this name toString public void setName String name this name new StringBuffer name public void setMode int mode this mode mode public String getLinkName return this linkName toString public int getUserId return this userId public void setUserId int userId this userId userId public int getGroupId return this groupId public void setGroupId int groupId this groupId groupId public String getUserName return this userName toString public void setUserName String userName this userName new StringBuffer userName public String getGroupName return this groupName toString public void setGroupName String groupName this groupName new StringBuffer groupName public void setIds int userId int groupId this setUserId userId this setGroupId groupId public void setNames String userName String groupName this setUserName userName this setGroupName groupName public void setModTime long time this modTime time MILLIS_PER_SECOND public void setModTime Date time this modTime time getTime MILLIS_PER_SECOND public Date getModTime return new Date this modTime MILLIS_PER_SECOND public File getFile return this file public int getMode return this mode public long getSize return this size public void setSize long size this size size public boolean isGNULongNameEntry return linkFlag LF_GNUTYPE_LONGNAME name toString equals GNU_LONGLINK public boolean isDirectory if this file null return this file isDirectory if this linkFlag LF_DIR return true if this getName endsWith return true return false public TarEntry getDirectoryEntries if this file null this file isDirectory return new TarEntry String list this file list TarEntry result new TarEntry list length for int list length result new TarEntry new File this file list return result public void writeEntryHeader byte outbuf int offset offset TarUtils getNameBytes this name outbuf offset NAMELEN offset TarUtils getOctalBytes this mode outbuf offset MODELEN offset TarUtils getOctalBytes this userId outbuf offset UIDLEN offset TarUtils getOctalBytes this groupId outbuf offset GIDLEN offset TarUtils getLongOctalBytes this size outbuf offset SIZELEN offset TarUtils getLongOctalBytes this modTime outbuf offset MODTIMELEN int csOffset offset for int CHKSUMLEN outbuf offset byte outbuf offset this linkFlag offset TarUtils getNameBytes this linkName outbuf offset NAMELEN offset TarUtils getNameBytes this magic outbuf offset MAGICLEN offset TarUtils getNameBytes this userName outbuf offset UNAMELEN offset TarUtils getNameBytes this groupName outbuf offset GNAMELEN offset TarUtils getOctalBytes this devMajor outbuf offset DEVLEN offset TarUtils getOctalBytes this devMinor outbuf offset DEVLEN while offset outbuf length outbuf offset long chk TarUtils computeCheckSum outbuf TarUtils getCheckSumOctalBytes chk outbuf csOffset CHKSUMLEN public void parseTarHeader byte header int offset this name TarUtils parseName header offset NAMELEN offset NAMELEN this mode int TarUtils parseOctal header offset MODELEN offset MODELEN this userId int TarUtils parseOctal header offset UIDLEN offset UIDLEN this groupId int TarUtils parseOctal header offset GIDLEN offset GIDLEN this size TarUtils parseOctal header offset SIZELEN offset SIZELEN this modTime TarUtils parseOctal header offset MODTIMELEN offset MODTIMELEN offset CHKSUMLEN this linkFlag header offset this linkName TarUtils parseName header offset NAMELEN offset NAMELEN this magic TarUtils parseName header offset MAGICLEN offset MAGICLEN this userName TarUtils parseName header offset UNAMELEN offset UNAMELEN this groupName TarUtils parseName header offset GNAMELEN offset GNAMELEN this devMajor int TarUtils parseOctal header offset DEVLEN offset DEVLEN this devMinor int TarUtils parseOctal header offset DEVLEN public class Jasper41Mangler implements JspMangler public String mapJspToJavaName File jspFile String jspUri jspFile getAbsolutePath int start jspUri lastIndexOf File separatorChar int end jspUri length StringBuffer modifiedClassName modifiedClassName new StringBuffer jspUri length start if Character isJavaIdentifierStart jspUri charAt start jspUri charAt start modifiedClassName append for int start end char ch jspUri charAt if Character isJavaIdentifierPart ch modifiedClassName append ch else if ch modifiedClassName append else modifiedClassName append mangleChar ch return modifiedClassName toString private static String mangleChar char ch String Integer toHexString ch int nzeros length char result new char result for int nzeros result for int nzeros result charAt return new String result public String mapPath String path return null public class Not implements ResourceSelector private ResourceSelector sel public Not public Not ResourceSelector add public void add ResourceSelector if sel null throw new IllegalStateException sel public boolean isSelected Resource return sel isSelected public class MethodRefCPInfo extends ConstantPoolEntry private String methodClassName private String methodName private String methodType private int classIndex private int nameAndTypeIndex public MethodRefCPInfo super CONSTANT_METHODREF public void read DataInputStream cpStream throws IOException classIndex cpStream readUnsignedShort nameAndTypeIndex cpStream readUnsignedShort public String toString String value if isResolved value methodClassName methodName methodType else value classIndex nameAndTypeIndex return value public void resolve ConstantPool constantPool ClassCPInfo methodClass ClassCPInfo constantPool getEntry classIndex methodClass resolve constantPool methodClassName methodClass getClassName NameAndTypeCPInfo nt NameAndTypeCPInfo constantPool getEntry nameAndTypeIndex nt resolve constantPool methodName nt getName methodType nt getType super resolve constantPool public String getMethodClassName return methodClassName public String getMethodName return methodName public String getMethodType return methodType public class Echo extends Task protected String message protected File file null protected boolean append false private String encoding protected int logLevel Project MSG_WARN public void execute throws BuildException if file null log message logLevel else Writer out null try String filename file getAbsolutePath if encoding null encoding length out new FileWriter filename append else out new BufferedWriter new OutputStreamWriter new FileOutputStream filename append encoding out write message message length catch IOException ioe throw new BuildException ioe getLocation finally FileUtils close out public void setMessage String msg this message msg public void setFile File file this file file public void setAppend boolean append this append append public void addText String msg message getProject replaceProperties msg public void setLevel EchoLevel echoLevel logLevel echoLevel getLevel public void setEncoding String encoding this encoding encoding public static class EchoLevel extends LogLevel public class DOMUtils public static Document newDocument return JAXPUtils getDocumentBuilder newDocument public static Element createChildElement Element parent String name Document doc parent getOwnerDocument Element doc createElement name parent appendChild return public static void appendText Element parent String content Document doc parent getOwnerDocument Text doc createTextNode content parent appendChild public static void appendCDATA Element parent String content Document doc parent getOwnerDocument CDATASection doc createCDATASection content parent appendChild public static void appendTextElement Element parent String name String content Element createChildElement parent name appendText content public static void appendCDATAElement Element parent String name String content Element createChildElement parent name appendCDATA content public class DefaultExecutor implements Executor private static final SingleCheckExecutor SUB_EXECUTOR new SingleCheckExecutor public void executeTargets Project project String targetNames throws BuildException BuildException thrownException null for int targetNames length try project executeTarget targetNames catch BuildException ex if project isKeepGoingMode thrownException ex else throw ex if thrownException null throw thrownException public Executor getSubProjectExecutor return SUB_EXECUTOR public final class Compatability private final String name Compatability final String name this name name public String toString return name public class Watchdog implements Runnable private Vector observers new Vector private long timeout private volatile boolean stopped false public static final String ERROR_INVALID_TIMEOUT public Watchdog long timeout if timeout throw new IllegalArgumentException ERROR_INVALID_TIMEOUT this timeout timeout public void addTimeoutObserver TimeoutObserver to observers addElement to public void removeTimeoutObserver TimeoutObserver to observers removeElement to protected final void fireTimeoutOccured Enumeration observers elements while hasMoreElements TimeoutObserver nextElement timeoutOccured this public synchronized void start stopped false Thread new Thread this setDaemon true start public synchronized void stop stopped true notifyAll public synchronized void run final long until System currentTimeMillis timeout long now while stopped until now System currentTimeMillis try wait until now catch InterruptedException if stopped fireTimeoutOccured public class MSVSSGET extends MSVSS Commandline buildCmdLine Commandline commandLine new Commandline commandLine setExecutable getSSCommand commandLine createArgument setValue COMMAND_GET if getVsspath null throw new BuildException getLocation commandLine createArgument setValue getVsspath commandLine createArgument setValue getLocalpath commandLine createArgument setValue getAutoresponse commandLine createArgument setValue getQuiet commandLine createArgument setValue getRecursive commandLine createArgument setValue getVersionDateLabel commandLine createArgument setValue getWritable commandLine createArgument setValue getLogin commandLine createArgument setValue getFileTimeStamp commandLine createArgument setValue getWritableFiles return commandLine public void setLocalpath Path localPath super setInternalLocalPath localPath toString public final void setRecursive boolean recursive super setInternalRecursive recursive public final void setQuiet boolean quiet super setInternalQuiet quiet public final void setWritable boolean writable super setInternalWritable writable public void setVersion String version super setInternalVersion version public void setDate String date super setInternalDate date public void setLabel String label super setInternalLabel label public void setAutoresponse String response super setInternalAutoResponse response public void setFileTimeStamp CurrentModUpdated timestamp super setInternalFileTimeStamp timestamp public void setWritableFiles WritableFiles files super setInternalWritableFiles files public class DiagnosticsTask extends Task private static final String ARGS new String public void execute throws BuildException Diagnostics main ARGS public final class DeweyDecimal extends org apache tools ant util DeweyDecimal public DeweyDecimal final int components super components public DeweyDecimal final String string throws NumberFormatException super string public class And extends ConditionBase implements Condition public boolean eval throws BuildException Enumeration getConditions while hasMoreElements Condition Condition nextElement if eval return false return true public class Commandline implements Cloneable private static final boolean IS_WIN_9X Os isFamily private Vector arguments new Vector private String executable null protected static final String DISCLAIMER StringUtils LINE_SEP StringUtils LINE_SEP StringUtils LINE_SEP public Commandline String toProcess super String tmp translateCommandline toProcess if tmp null tmp length setExecutable tmp for int tmp length createArgument setValue tmp public Commandline super public static class Argument extends ProjectComponent private String parts public void setValue String value parts new String value public void setLine String line if line null return parts translateCommandline line public void setPath Path value parts new String value toString public void setPathref Reference value Path new Path getProject setRefid value parts new String toString public void setFile File value parts new String value getAbsolutePath public String getParts return parts public class Marker private int position private int realPos Marker int position this position position public int getPosition if realPos realPos executable null for int position Argument arg Argument arguments elementAt realPos arg getParts length return realPos public Argument createArgument return this createArgument false public Argument createArgument boolean insertAtStart Argument argument new Argument if insertAtStart arguments insertElementAt argument else arguments addElement argument return argument public void setExecutable String executable if executable null executable length return this executable executable replace File separatorChar replace File separatorChar public String getExecutable return executable public void addArguments String line for int line length createArgument setValue line public String getCommandline List commands new LinkedList ListIterator list commands listIterator addCommandToList list final String result new String commands size return String commands toArray result public void addCommandToList ListIterator list if executable null list add executable addArgumentsToList list public String getArguments List result new ArrayList arguments size addArgumentsToList result listIterator String res new String result size return String result toArray res public void addArgumentsToList ListIterator list for int arguments size Argument arg Argument arguments elementAt String arg getParts if null for int length list add public String toString return toString getCommandline public static String quoteArgument String argument if argument indexOf if argument indexOf throw new BuildException else return argument else if argument indexOf argument indexOf IS_WIN_9X argument indexOf return argument else return argument public static String toString String line if line null line length return final StringBuffer result new StringBuffer for int line length if result append result append quoteArgument line return result toString public static String translateCommandline String toProcess if toProcess null toProcess length return new String final int normal final int inQuote final int inDoubleQuote int state normal StringTokenizer tok new StringTokenizer toProcess true Vector new Vector StringBuffer current new StringBuffer boolean lastTokenHasBeenQuoted false while tok hasMoreTokens String nextTok tok nextToken switch state case inQuote if equals nextTok lastTokenHasBeenQuoted true state normal else current append nextTok break case inDoubleQuote if equals nextTok lastTokenHasBeenQuoted true state normal else current append nextTok break default if equals nextTok state inQuote else if equals nextTok state inDoubleQuote else if equals nextTok if lastTokenHasBeenQuoted current length addElement current toString current new StringBuffer else current append nextTok lastTokenHasBeenQuoted false break if lastTokenHasBeenQuoted current length addElement current toString if state inQuote state inDoubleQuote throw new BuildException toProcess String args new String size copyInto args return args public int size return getCommandline length public Object clone try Commandline Commandline super clone arguments Vector arguments clone return catch CloneNotSupportedException throw new BuildException public void clear executable null arguments removeAllElements public void clearArgs arguments removeAllElements public Marker createMarker return new Marker arguments size public String describeCommand return describeCommand this public String describeArguments return describeArguments this public static String describeCommand Commandline line return describeCommand line getCommandline public static String describeArguments Commandline line return describeArguments line getArguments public static String describeCommand String args if args null args length return StringBuffer buf new StringBuffer buf append args buf append if args length buf append buf append describeArguments args else buf append DISCLAIMER return buf toString public static String describeArguments String args return describeArguments args protected static String describeArguments String args int offset if args null args length offset return StringBuffer buf new StringBuffer if args length offset buf append buf append append StringUtils LINE_SEP for int offset args length buf append append args append append StringUtils LINE_SEP buf append DISCLAIMER return buf toString public Iterator iterator return arguments iterator public class UnsupportedElementException extends BuildException private String element public UnsupportedElementException String msg String element super msg this element element public String getElement return element public class CCMReconfigure extends Continuus private String ccmProject null private boolean recurse false private boolean verbose false public CCMReconfigure super setCcmAction COMMAND_RECONFIGURE public void execute throws BuildException Commandline commandLine new Commandline int result commandLine setExecutable getCcmCommand commandLine createArgument setValue getCcmAction checkOptions commandLine result run commandLine if Execute isFailure result String msg commandLine toString throw new BuildException msg getLocation private void checkOptions Commandline cmd if isRecurse cmd createArgument setValue FLAG_RECURSE if isVerbose cmd createArgument setValue FLAG_VERBOSE if getCcmProject null cmd createArgument setValue FLAG_PROJECT cmd createArgument setValue getCcmProject public String getCcmProject return ccmProject public void setCcmProject String this ccmProject public boolean isRecurse return recurse public void setRecurse boolean this recurse public boolean isVerbose return verbose public void setVerbose boolean this verbose public static final String FLAG_RECURSE public static final String FLAG_VERBOSE public static final String FLAG_PROJECT public interface Executor void executeTargets Project project String targetNames throws BuildException Executor getSubProjectExecutor public class Recorder extends Task implements SubBuildListener private String filename null private Boolean append null private Boolean start null private int loglevel private boolean emacsMode false private static Hashtable recorderEntries new Hashtable public void init getProject addBuildListener this public void setName String fname filename fname public void setAction ActionChoices action if action getValue equalsIgnoreCase start Boolean TRUE else start Boolean FALSE public void setAppend boolean append this append append Boolean TRUE Boolean FALSE public void setEmacsMode boolean emacsMode this emacsMode emacsMode public void setLoglevel VerbosityLevelChoices level loglevel level getLevel public void execute throws BuildException if filename null throw new BuildException getProject log filename Project MSG_DEBUG RecorderEntry recorder getRecorder filename getProject recorder setMessageOutputLevel loglevel recorder setEmacsMode emacsMode if start null if start booleanValue recorder reopenFile recorder setRecordState start else recorder setRecordState start recorder closeFile public static class ActionChoices extends EnumeratedAttribute private static final String VALUES public String getValues return VALUES public static class VerbosityLevelChoices extends LogLevel protected RecorderEntry getRecorder String name Project proj throws BuildException Object recorderEntries get name RecorderEntry entry if null entry new RecorderEntry name if append null entry openFile false else entry openFile append booleanValue entry setProject proj recorderEntries put name entry else entry RecorderEntry return entry public void buildStarted BuildEvent event public void subBuildStarted BuildEvent event public void targetStarted BuildEvent event public void targetFinished BuildEvent event public void taskStarted BuildEvent event public void taskFinished BuildEvent event public void messageLogged BuildEvent event public void buildFinished BuildEvent event cleanup public void subBuildFinished BuildEvent event if event getProject getProject cleanup private void cleanup recorderEntries clear getProject removeBuildListener this public abstract class AbstractSelectorContainer extends DataType implements SelectorContainer private Vector selectorsList new Vector public boolean hasSelectors return selectorsList isEmpty public int selectorCount return selectorsList size public FileSelector getSelectors Project FileSelector result new FileSelector selectorsList size selectorsList copyInto result return result public Enumeration selectorElements return selectorsList elements public String toString StringBuffer buf new StringBuffer Enumeration selectorElements if hasMoreElements while hasMoreElements buf append nextElement toString if hasMoreElements buf append return buf toString public void appendSelector FileSelector selector selectorsList addElement selector public void validate Enumeration selectorElements while hasMoreElements Object nextElement if instanceof BaseSelector BaseSelector validate public void addSelector SelectSelector selector appendSelector selector public void addAnd AndSelector selector appendSelector selector public void addOr OrSelector selector appendSelector selector public void addNot NotSelector selector appendSelector selector public void addNone NoneSelector selector appendSelector selector public void addMajority MajoritySelector selector appendSelector selector public void addDate DateSelector selector appendSelector selector public void addSize SizeSelector selector appendSelector selector public void addFilename FilenameSelector selector appendSelector selector public void addCustom ExtendSelector selector appendSelector selector public void addContains ContainsSelector selector appendSelector selector public void addPresent PresentSelector selector appendSelector selector public void addDepth DepthSelector selector appendSelector selector public void addDepend DependSelector selector appendSelector selector public void addDifferent DifferentSelector selector appendSelector selector public void addType TypeSelector selector appendSelector selector public void addContainsRegexp ContainsRegexpSelector selector appendSelector selector public void addModified ModifiedSelector selector appendSelector selector public void add FileSelector selector appendSelector selector public class Tokens extends BaseResourceCollectionWrapper private Tokenizer tokenizer private String encoding protected synchronized Collection getCollection ResourceCollection rc getResourceCollection if rc size return Collections EMPTY_SET if tokenizer null tokenizer new LineTokenizer ConcatResourceInputStream cat new ConcatResourceInputStream rc cat setManagingComponent this InputStreamReader rdr null if encoding null rdr new InputStreamReader cat else try rdr new InputStreamReader cat encoding catch UnsupportedEncodingException throw new BuildException ArrayList result new ArrayList try for String tokenizer getToken rdr null tokenizer getToken rdr result add new StringResource catch IOException throw new BuildException return result public synchronized void setEncoding String encoding this encoding encoding public synchronized void add Tokenizer tokenizer if isReference throw noChildrenAllowed if this tokenizer null throw new BuildException this tokenizer tokenizer protected synchronized void dieOnCircularReference Stack stk Project throws BuildException if isChecked return if isReference super dieOnCircularReference stk else if tokenizer instanceof DataType stk push tokenizer invokeCircularReferenceCheck DataType tokenizer stk setChecked true public class Javac13 extends DefaultCompilerAdapter private static final int MODERN_COMPILER_SUCCESS public boolean execute throws BuildException attributes log Project MSG_VERBOSE Commandline cmd setupModernJavacCommand try Class Class forName Object compiler newInstance Method compile getMethod new Class new String getClass int result Integer compile invoke compiler new Object cmd getArguments intValue return result MODERN_COMPILER_SUCCESS catch Exception ex if ex instanceof BuildException throw BuildException ex else throw new BuildException ex location public class Javac12 extends DefaultCompilerAdapter protected static final String CLASSIC_COMPILER_CLASSNAME public boolean execute throws BuildException attributes log Project MSG_VERBOSE Commandline cmd setupJavacCommand true OutputStream logstr new LogOutputStream attributes Project MSG_WARN try Class Class forName CLASSIC_COMPILER_CLASSNAME Constructor cons getConstructor new Class OutputStream class String class Object compiler cons newInstance new Object logstr Method compile getMethod new Class String class Boolean ok Boolean compile invoke compiler new Object cmd getArguments return ok booleanValue catch ClassNotFoundException ex throw new BuildException JavaEnvUtils getJavaHome location catch Exception ex if ex instanceof BuildException throw BuildException ex else throw new BuildException ex location finally FileUtils close logstr public class P4Revert extends P4Base private String revertChange null private boolean onlyUnchanged false public void setChange String revertChange throws BuildException if revertChange null revertChange equals throw new BuildException this revertChange revertChange public void setRevertOnlyUnchanged boolean onlyUnchanged this onlyUnchanged onlyUnchanged public void execute throws BuildException String p4cmd if onlyUnchanged p4cmd if revertChange null p4cmd revertChange execP4Command p4cmd P4View new SimpleP4OutputHandler this public final class HeadFilter extends BaseParamFilterReader implements ChainableReader private static final String LINES_KEY private static final String SKIP_KEY private long linesRead private static final int DEFAULT_NUM_LINES private long lines DEFAULT_NUM_LINES private long skip private LineTokenizer lineTokenizer null private String line null private int linePos public HeadFilter super public HeadFilter final Reader in super in lineTokenizer new LineTokenizer lineTokenizer setIncludeDelims true public int read throws IOException if getInitialized initialize setInitialized true while line null line length line lineTokenizer getToken in if line null return line headFilter line linePos int ch line charAt linePos linePos if linePos line length line null return ch public void setLines final long lines this lines lines private long getLines return lines public void setSkip final long skip this skip skip private long getSkip return skip public Reader chain final Reader rdr HeadFilter newFilter new HeadFilter rdr newFilter setLines getLines newFilter setSkip getSkip newFilter setInitialized true return newFilter private void initialize Parameter params getParameters if params null for int params length if LINES_KEY equals params getName lines new Long params getValue longValue continue if SKIP_KEY equals params getName skip new Long params getValue longValue continue private String headFilter String line linesRead if skip if linesRead skip return null if lines if linesRead lines skip return null return line public class JUnitTestRunner implements TestListener JUnitTaskMirror JUnitTestRunnerMirror private Vector formatters new Vector private TestResult res private static boolean filtertrace true private boolean showOutput false private boolean outputToFormatters true private Permissions perm null private static final String DEFAULT_TRACE_FILTERS new String private boolean haltOnError false private boolean haltOnFailure false private int retCode SUCCESS private JUnitTest junitTest private PrintStream systemError private PrintStream systemOut private boolean forked false private static boolean multipleTests false private ClassLoader loader private boolean logTestListenerEvents false private boolean junit4 private static String crashFile null public JUnitTestRunner JUnitTest test boolean haltOnError boolean filtertrace boolean haltOnFailure this test haltOnError filtertrace haltOnFailure false public JUnitTestRunner JUnitTest test boolean haltOnError boolean filtertrace boolean haltOnFailure boolean showOutput this test haltOnError filtertrace haltOnFailure showOutput false public JUnitTestRunner JUnitTest test boolean haltOnError boolean filtertrace boolean haltOnFailure boolean showOutput boolean logTestListenerEvents this test haltOnError filtertrace haltOnFailure showOutput logTestListenerEvents null public JUnitTestRunner JUnitTest test boolean haltOnError boolean filtertrace boolean haltOnFailure ClassLoader loader this test haltOnError filtertrace haltOnFailure false loader public JUnitTestRunner JUnitTest test boolean haltOnError boolean filtertrace boolean haltOnFailure boolean showOutput ClassLoader loader this test haltOnError filtertrace haltOnFailure showOutput false loader public JUnitTestRunner JUnitTest test boolean haltOnError boolean filtertrace boolean haltOnFailure boolean showOutput boolean logTestListenerEvents ClassLoader loader JUnitTestRunner filtertrace filtertrace this junitTest test this haltOnError haltOnError this haltOnFailure haltOnFailure this showOutput showOutput this logTestListenerEvents logTestListenerEvents this loader loader private PrintStream savedOut null public void run res new TestResult res addListener wrapListener this for int formatters size res addListener wrapListener TestListener formatters elementAt ByteArrayOutputStream errStrm new ByteArrayOutputStream systemError new PrintStream errStrm ByteArrayOutputStream outStrm new ByteArrayOutputStream systemOut new PrintStream outStrm PrintStream savedErr null if forked if outputToFormatters if showOutput savedOut System out savedErr System err System setOut new PrintStream new OutputStream public void write int System setErr new PrintStream new OutputStream public void write int else savedOut System out savedErr System err if showOutput System setOut systemOut System setErr systemError else System setOut new PrintStream new TeeOutputStream savedOut systemOut System setErr new PrintStream new TeeOutputStream savedErr systemError perm null else if perm null perm setSecurityManager Test suite null Throwable exception null boolean startTestSuiteSuccess false try try Class testClass null if loader null testClass Class forName junitTest getName else testClass Class forName junitTest getName true loader Method suiteMethod null try suiteMethod testClass getMethod new Class catch NoSuchMethodException if suiteMethod null suite Test suiteMethod invoke null new Class else Class junit4TestAdapterClass null try Class forName if loader null junit4TestAdapterClass Class forName else junit4TestAdapterClass Class forName true loader catch ClassNotFoundException junit4 junit4TestAdapterClass null if junit4 suite Test junit4TestAdapterClass getConstructor new Class Class class newInstance new Object testClass else suite new TestSuite testClass catch Throwable retCode ERRORS exception long start System currentTimeMillis fireStartTestSuite startTestSuiteSuccess true for int formatters size TestListener formatters elementAt addError null exception junitTest setCounts junitTest setRunTime else try logTestListenerEvent suite countTestCases suite run res finally if junit4 int cnts findJUnit4FailureErrorCount res junitTest setCounts res runCount cnts cnts else junitTest setCounts res runCount res failureCount res errorCount junitTest setRunTime System currentTimeMillis start finally if perm null perm restoreSecurityManager if savedOut null System setOut savedOut if savedErr null System setErr savedErr systemError close systemError null systemOut close systemOut null if startTestSuiteSuccess sendOutAndErr new String outStrm toByteArray new String errStrm toByteArray fireEndTestSuite if retCode SUCCESS res errorCount retCode ERRORS else if res failureCount retCode FAILURES public int getRetCode return retCode public void startTest Test String testName JUnitVersionHelper getTestCaseName logTestListenerEvent testName public void endTest Test test String testName JUnitVersionHelper getTestCaseName test logTestListenerEvent testName private void logTestListenerEvent String msg PrintStream out savedOut null savedOut System out if logTestListenerEvents out flush out println JUnitTask TESTLISTENER_PREFIX msg out flush public void addFailure Test test Throwable String testName JUnitVersionHelper getTestCaseName test logTestListenerEvent testName getMessage if haltOnFailure res stop public void addFailure Test test AssertionFailedError addFailure test Throwable public void addError Test test Throwable String testName JUnitVersionHelper getTestCaseName test logTestListenerEvent testName getMessage if haltOnError res stop public void setPermissions Permissions permissions perm permissions public void handleOutput String output if logTestListenerEvents output startsWith JUnitTask TESTLISTENER_PREFIX else if systemOut null systemOut print output public int handleInput byte buffer int offset int length throws IOException return public void handleErrorOutput String output if systemError null systemError print output public void handleFlush String output if systemOut null systemOut print output public void handleErrorFlush String output if systemError null systemError print output private void sendOutAndErr String out String err for int formatters size JUnitResultFormatter formatter JUnitResultFormatter formatters elementAt formatter setSystemOutput out formatter setSystemError err private void fireStartTestSuite for int formatters size JUnitResultFormatter formatters elementAt startTestSuite junitTest private void fireEndTestSuite for int formatters size JUnitResultFormatter formatters elementAt endTestSuite junitTest public void addFormatter JUnitResultFormatter formatters addElement public void addFormatter JUnitTaskMirror JUnitResultFormatterMirror formatters addElement JUnitResultFormatter public static void main String args throws IOException boolean haltError false boolean haltFail false boolean stackfilter true Properties props new Properties boolean showOut false boolean outputToFormat true boolean logTestListenerEvents false if args length System err println System exit ERRORS if args startsWith Constants TESTSFILE multipleTests true args args substring Constants TESTSFILE length for int args length if args startsWith Constants HALT_ON_ERROR haltError Project toBoolean args substring Constants HALT_ON_ERROR length else if args startsWith Constants HALT_ON_FAILURE haltFail Project toBoolean args substring Constants HALT_ON_FAILURE length else if args startsWith Constants FILTERTRACE stackfilter Project toBoolean args substring Constants FILTERTRACE length else if args startsWith Constants CRASHFILE crashFile args substring Constants CRASHFILE length registerTestCase Constants BEFORE_FIRST_TEST else if args startsWith Constants FORMATTER try createAndStoreFormatter args substring Constants FORMATTER length catch BuildException be System err println be getMessage System exit ERRORS else if args startsWith Constants PROPSFILE FileInputStream in new FileInputStream args substring Constants PROPSFILE length props load in in close else if args startsWith Constants SHOWOUTPUT showOut Project toBoolean args substring Constants SHOWOUTPUT length else if args startsWith Constants LOGTESTLISTENEREVENTS logTestListenerEvents Project toBoolean args substring Constants LOGTESTLISTENEREVENTS length else if args startsWith Constants OUTPUT_TO_FORMATTERS outputToFormat Project toBoolean args substring Constants OUTPUT_TO_FORMATTERS length Hashtable System getProperties for Enumeration keys hasMoreElements Object key nextElement props put key get key int returnCode SUCCESS if multipleTests try java io BufferedReader reader new java io BufferedReader new java io FileReader args String testCaseName int code boolean errorOccurred false boolean failureOccurred false String line null while line reader readLine null StringTokenizer st new StringTokenizer line testCaseName st nextToken JUnitTest new JUnitTest testCaseName setTodir new File st nextToken setOutfile st nextToken code launch haltError stackfilter haltFail showOut outputToFormat logTestListenerEvents props errorOccurred code ERRORS failureOccurred code SUCCESS if errorOccurred failureOccurred if errorOccurred haltError failureOccurred haltFail registerNonCrash System exit code else if code returnCode returnCode code System out println getName catch IOException printStackTrace else returnCode launch new JUnitTest args haltError stackfilter haltFail showOut outputToFormat logTestListenerEvents props registerNonCrash System exit returnCode private static Vector fromCmdLine new Vector private static void transferFormatters JUnitTestRunner runner JUnitTest test runner addFormatter new JUnitResultFormatter public void startTestSuite JUnitTest suite throws BuildException public void endTestSuite JUnitTest suite throws BuildException public void setOutput OutputStream out public void setSystemOutput String out public void setSystemError String err public void addError Test arg0 Throwable arg1 public void addFailure Test arg0 AssertionFailedError arg1 public void endTest Test arg0 public void startTest Test arg0 registerTestCase JUnitVersionHelper getTestCaseName arg0 for int fromCmdLine size FormatterElement fe FormatterElement fromCmdLine elementAt if multipleTests fe getUseFile File destFile new File test getTodir test getOutfile fe getExtension fe setOutfile destFile runner addFormatter JUnitResultFormatter fe createFormatter private static void createAndStoreFormatter String line throws BuildException FormatterElement fe new FormatterElement int pos line indexOf if pos fe setClassname line fe setUseFile false else fe setClassname line substring pos fe setUseFile true if multipleTests fe setOutfile new File line substring pos else int fName line indexOf IGNORED_FILE_NAME if fName fe setExtension line substring fName IGNORED_FILE_NAME length fromCmdLine addElement fe public static String getFilteredTrace Throwable String trace StringUtils getStackTrace return JUnitTestRunner filterStack trace public static String filterStack String stack if filtertrace return stack StringWriter sw new StringWriter PrintWriter pw new PrintWriter sw StringReader sr new StringReader stack BufferedReader br new BufferedReader sr String line try while line br readLine null if filterLine line pw println line catch Exception return sw toString private static boolean filterLine String line for int DEFAULT_TRACE_FILTERS length if line indexOf DEFAULT_TRACE_FILTERS return true return false private static int launch JUnitTest boolean haltError boolean stackfilter boolean haltFail boolean showOut boolean outputToFormat boolean logTestListenerEvents Properties props setProperties props JUnitTestRunner runner new JUnitTestRunner haltError stackfilter haltFail showOut logTestListenerEvents null runner forked true runner outputToFormatters outputToFormat transferFormatters runner runner run return runner getRetCode private static void registerNonCrash throws IOException if crashFile null FileWriter out null try out new FileWriter crashFile out write Constants TERMINATED_SUCCESSFULLY out flush finally if out null out close private static void registerTestCase String testCase if crashFile null try FileWriter out null try out new FileWriter crashFile out write testCase out flush finally if out null out close catch IOException private TestListener wrapListener final TestListener testListener return new TestListener public void addError Test test Throwable if junit4 instanceof AssertionFailedError testListener addFailure test AssertionFailedError else if junit4 getClass getName equals try String msg getMessage AssertionFailedError failure msg null new AssertionFailedError msg new AssertionFailedError Method initCause Throwable class getMethod new Class Throwable class initCause invoke failure new Object testListener addFailure test failure catch Exception testListener addError test else testListener addError test public void addFailure Test test AssertionFailedError testListener addFailure test if instanceof AssertionFailedError testListener addFailure test AssertionFailedError else testListener addError test public void endTest Test test testListener endTest test public void startTest Test test testListener startTest test private int findJUnit4FailureErrorCount TestResult res int failures int errors Enumeration res failures while hasMoreElements nextElement failures res errors while hasMoreElements Throwable TestFailure nextElement thrownException if instanceof AssertionFailedError getClass getName equals failures else errors return new int failures errors public abstract class DispatchTask extends Task implements Dispatchable private String action public String getActionParameterName return public void setAction String action this action action public String getAction return action public class PropertyResource extends Resource private static final int PROPERTY_MAGIC Resource getMagicNumber getBytes private static final InputStream UNSET new InputStream public int read return public PropertyResource public PropertyResource Project String super setProject public String getValue Project getProject return null null getProperty getName public boolean isExists return getValue null public long getSize if isReference return Resource getCheckedRef getSize return isExists long getValue length public int hashCode if isReference return getCheckedRef hashCode return super hashCode PROPERTY_MAGIC public String toString if isReference return getCheckedRef toString return String valueOf getValue public InputStream getInputStream throws IOException if isReference return Resource getCheckedRef getInputStream return isExists new ByteArrayInputStream getValue getBytes UNSET public OutputStream getOutputStream throws IOException if isReference return Resource getCheckedRef getOutputStream if isExists throw new ImmutableResourceException return new PropertyOutputStream getProject getName public class Jar extends Zip private static final String INDEX_NAME private static final String MANIFEST_NAME private List serviceList new ArrayList private Manifest configuredManifest private Manifest savedConfiguredManifest private Manifest filesetManifest private Manifest originalManifest private FilesetManifestConfig filesetManifestConfig private boolean mergeManifestsMain true private Manifest manifest private String manifestEncoding private File manifestFile private boolean index false private boolean createEmpty false private Vector rootEntries private Path indexJars private static final ZipExtraField JAR_MARKER new ZipExtraField JarMarker getInstance protected String emptyBehavior public Jar super archiveType emptyBehavior setEncoding rootEntries new Vector public void setWhenempty WhenEmpty we log Project MSG_WARN public void setWhenmanifestonly WhenEmpty we emptyBehavior we getValue public void setJarfile File jarFile setDestFile jarFile public void setIndex boolean flag index flag public void setManifestEncoding String manifestEncoding this manifestEncoding manifestEncoding public void addConfiguredManifest Manifest newManifest throws ManifestException if configuredManifest null configuredManifest newManifest else configuredManifest merge newManifest savedConfiguredManifest configuredManifest public void setManifest File manifestFile if manifestFile exists throw new BuildException manifestFile getLocation this manifestFile manifestFile private Manifest getManifest File manifestFile Manifest newManifest null FileInputStream fis null InputStreamReader isr null try fis new FileInputStream manifestFile if manifestEncoding null isr new InputStreamReader fis else isr new InputStreamReader fis manifestEncoding newManifest getManifest isr catch UnsupportedEncodingException throw new BuildException getMessage catch IOException throw new BuildException manifestFile getMessage finally if isr null try isr close catch IOException return newManifest private Manifest getManifestFromJar File jarFile throws IOException ZipFile zf null try zf new ZipFile jarFile Enumeration zf entries while hasMoreElements ZipEntry ze ZipEntry nextElement if ze getName equalsIgnoreCase MANIFEST_NAME InputStreamReader isr new InputStreamReader zf getInputStream ze return getManifest isr return null finally if zf null try zf close catch IOException private Manifest getManifest Reader Manifest newManifest null try newManifest new Manifest catch ManifestException log getMessage Project MSG_ERR throw new BuildException manifestFile getLocation catch IOException throw new BuildException getMessage return newManifest public void setFilesetmanifest FilesetManifestConfig config filesetManifestConfig config mergeManifestsMain equals config getValue if filesetManifestConfig null filesetManifestConfig getValue equals doubleFilePass true public void addMetainf ZipFileSet fs fs setPrefix super addFileset fs public void addConfiguredIndexJars Path if indexJars null indexJars new Path getProject indexJars append public void addConfiguredService Service service service check serviceList add service private void writeServices ZipOutputStream zOut throws IOException Iterator serviceIterator Service service serviceIterator serviceList iterator while serviceIterator hasNext service Service serviceIterator next super zipFile service getAsStream zOut service getType System currentTimeMillis null ZipFileSet DEFAULT_FILE_MODE protected void initZipOutputStream ZipOutputStream zOut throws IOException BuildException if skipWriting Manifest jarManifest createManifest writeManifest zOut jarManifest writeServices zOut private Manifest createManifest throws BuildException try Manifest finalManifest Manifest getDefaultManifest if manifest null if manifestFile null manifest getManifest manifestFile if isInUpdateMode finalManifest merge originalManifest finalManifest merge filesetManifest finalManifest merge configuredManifest finalManifest merge manifest mergeManifestsMain return finalManifest catch ManifestException log getMessage Project MSG_ERR throw new BuildException getLocation private void writeManifest ZipOutputStream zOut Manifest manifest throws IOException for Enumeration manifest getWarnings hasMoreElements log String nextElement Project MSG_WARN zipDir null zOut ZipFileSet DEFAULT_DIR_MODE JAR_MARKER ByteArrayOutputStream baos new ByteArrayOutputStream OutputStreamWriter osw new OutputStreamWriter baos Manifest JAR_ENCODING PrintWriter writer new PrintWriter osw manifest write writer writer flush ByteArrayInputStream bais new ByteArrayInputStream baos toByteArray super zipFile bais zOut MANIFEST_NAME System currentTimeMillis null ZipFileSet DEFAULT_FILE_MODE super initZipOutputStream zOut protected void finalizeZipOutputStream ZipOutputStream zOut throws IOException BuildException if index createIndexList zOut private void createIndexList ZipOutputStream zOut throws IOException ByteArrayOutputStream baos new ByteArrayOutputStream PrintWriter writer new PrintWriter new OutputStreamWriter baos writer println writer println writer println zipFile getName writeIndexLikeList new ArrayList addedDirs keySet rootEntries writer writer println if indexJars null Manifest mf createManifest Manifest Attribute classpath mf getMainSection getAttribute Manifest ATTRIBUTE_CLASSPATH String cpEntries null if classpath null classpath getValue null StringTokenizer tok new StringTokenizer classpath getValue cpEntries new String tok countTokens int while tok hasMoreTokens cpEntries tok nextToken String indexJarEntries indexJars list for int indexJarEntries length String name findJarName indexJarEntries cpEntries if name null ArrayList dirs new ArrayList ArrayList files new ArrayList grabFilesAndDirs indexJarEntries dirs files if dirs size files size writer println name writeIndexLikeList dirs files writer writer println writer flush ByteArrayInputStream bais new ByteArrayInputStream baos toByteArray super zipFile bais zOut INDEX_NAME System currentTimeMillis null ZipFileSet DEFAULT_FILE_MODE protected void zipFile InputStream is ZipOutputStream zOut String vPath long lastModified File fromArchive int mode throws IOException if MANIFEST_NAME equalsIgnoreCase vPath if doubleFilePass doubleFilePass skipWriting filesetManifest fromArchive is else if INDEX_NAME equalsIgnoreCase vPath index log archiveType Project MSG_WARN else if index vPath indexOf rootEntries addElement vPath super zipFile is zOut vPath lastModified fromArchive mode private void filesetManifest File file InputStream is throws IOException if manifestFile null manifestFile equals file log file Project MSG_VERBOSE try if is null InputStreamReader isr if manifestEncoding null isr new InputStreamReader is else isr new InputStreamReader is manifestEncoding manifest getManifest isr else manifest getManifest file catch UnsupportedEncodingException throw new BuildException getMessage else if filesetManifestConfig null filesetManifestConfig getValue equals log file Project MSG_VERBOSE try Manifest newManifest null if is null InputStreamReader isr if manifestEncoding null isr new InputStreamReader is else isr new InputStreamReader is manifestEncoding newManifest getManifest isr else newManifest getManifest file if filesetManifest null filesetManifest newManifest else filesetManifest merge newManifest catch UnsupportedEncodingException throw new BuildException getMessage catch ManifestException log file getMessage Project MSG_ERR throw new BuildException getLocation else protected ArchiveState getResourcesToAdd ResourceCollection rcs File zipFile boolean needsUpdate throws BuildException if zipFile exists try originalManifest getManifestFromJar zipFile if originalManifest null log Project MSG_VERBOSE needsUpdate true else Manifest mf createManifest if mf equals originalManifest log Project MSG_VERBOSE needsUpdate true catch Throwable log zipFile toString getMessage Project MSG_WARN needsUpdate true else needsUpdate true createEmpty needsUpdate return super getResourcesToAdd rcs zipFile needsUpdate protected boolean createEmptyZip File zipFile throws BuildException if createEmpty return true if emptyBehavior equals log archiveType zipFile Project MSG_WARN return true else if emptyBehavior equals throw new BuildException archiveType zipFile getLocation ZipOutputStream zOut null try log getDestFile getAbsolutePath zOut new ZipOutputStream new FileOutputStream getDestFile zOut setEncoding getEncoding if isCompress zOut setMethod ZipOutputStream DEFLATED else zOut setMethod ZipOutputStream STORED initZipOutputStream zOut finalizeZipOutputStream zOut catch IOException ioe throw new BuildException ioe getMessage ioe getLocation finally try if zOut null zOut close catch IOException ex createEmpty false return true protected void cleanUp super cleanUp if doubleFilePass doubleFilePass skipWriting manifest null configuredManifest savedConfiguredManifest filesetManifest null originalManifest null rootEntries removeAllElements public void reset super reset emptyBehavior configuredManifest null filesetManifestConfig null mergeManifestsMain false manifestFile null index false public static class FilesetManifestConfig extends EnumeratedAttribute public String getValues return new String protected final void writeIndexLikeList List dirs List files PrintWriter writer throws IOException Collections sort dirs Collections sort files Iterator iter dirs iterator while iter hasNext String dir String iter next dir dir replace if dir startsWith dir dir substring while dir startsWith dir dir substring int pos dir lastIndexOf if pos dir dir substring pos if dir startsWith continue writer println dir iter files iterator while iter hasNext writer println iter next protected static final String findJarName String fileName String classpath if classpath null return new File fileName getName fileName fileName replace File separatorChar TreeMap matches new TreeMap new Comparator public int compare Object o1 Object o2 if o1 instanceof String o2 instanceof String return String o2 length String o1 length return for int classpath length if fileName endsWith classpath matches put classpath classpath else int slash classpath indexOf String candidate classpath while slash candidate candidate substring slash if fileName endsWith candidate matches put candidate classpath break slash candidate indexOf return matches size null String matches get matches firstKey protected static final void grabFilesAndDirs String file List dirs List files throws IOException org apache tools zip ZipFile zf null try zf new org apache tools zip ZipFile file Enumeration entries zf getEntries HashSet dirSet new HashSet while entries hasMoreElements org apache tools zip ZipEntry ze org apache tools zip ZipEntry entries nextElement String name ze getName if name startsWith if ze isDirectory dirSet add name else if name indexOf files add name else dirSet add name substring name lastIndexOf dirs addAll dirSet finally if zf null zf close public class JspC extends MatchingTask private Path classpath private Path compilerClasspath private Path src private File destDir private String compilerName private String iepluginid private boolean mapped private int verbose protected Vector compileList new Vector Vector javaFiles new Vector protected boolean failOnError true private File uriroot private File webinc private File webxml protected WebAppParameter webApp private static final String FAIL_MSG public void setSrcDir Path srcDir if src null src srcDir else src append srcDir public Path getSrcDir return src public void setDestdir File destDir this destDir destDir public File getDestdir return destDir public void setPackage String pkg public String getPackage public void setVerbose int verbose public int getVerbose return verbose public void setFailonerror boolean fail failOnError fail public boolean getFailonerror return failOnError public String getIeplugin return iepluginid public void setIeplugin String iepluginid this iepluginid iepluginid public boolean isMapped return mapped public void setMapped boolean mapped this mapped mapped public void setUribase File uribase log Project MSG_WARN public File getUribase return uriroot public void setUriroot File uriroot this uriroot uriroot public File getUriroot return uriroot public void setClasspath Path cp if classpath null classpath cp else classpath append cp public Path createClasspath if classpath null classpath new Path getProject return classpath createPath public void setClasspathRef Reference createClasspath setRefid public Path getClasspath return classpath public void setCompilerclasspath Path cp if compilerClasspath null compilerClasspath cp else compilerClasspath append cp public Path getCompilerclasspath return compilerClasspath public Path createCompilerclasspath if compilerClasspath null compilerClasspath new Path getProject return compilerClasspath createPath public void setWebxml File webxml this webxml webxml public File getWebxml return this webxml public void setWebinc File webinc this webinc webinc public File getWebinc return this webinc public void addWebApp WebAppParameter webappParam throws BuildException if webApp null webApp webappParam else throw new BuildException public WebAppParameter getWebApp return webApp public void setCompiler String compiler this compilerName compiler public Vector getCompileList return compileList public void execute throws BuildException if destDir null throw new BuildException getLocation if destDir isDirectory throw new BuildException destDir getLocation File dest getActualDestDir JspCompilerAdapter compiler JspCompilerAdapterFactory getCompiler compilerName this getProject createClassLoader compilerClasspath if webApp null doCompilation compiler return if src null throw new BuildException getLocation String list src list if list length throw new BuildException getLocation if compiler implementsOwnDependencyChecking doCompilation compiler return JspMangler mangler compiler createMangler resetFileLists int filecount for int list length File srcDir getProject resolveFile list if srcDir exists throw new BuildException srcDir getPath getLocation DirectoryScanner ds this getDirectoryScanner srcDir String files ds getIncludedFiles filecount files length scanDir srcDir dest mangler files log compileList size Project MSG_VERBOSE if compileList size log compileList size compileList size dest doCompilation compiler else if filecount log Project MSG_INFO else log Project MSG_VERBOSE private File getActualDestDir File dest null dest destDir else String path destDir getPath File separatorChar dest new File path return dest private void doCompilation JspCompilerAdapter compiler throws BuildException compiler setJspc this if compiler execute if failOnError throw new BuildException FAIL_MSG getLocation else log FAIL_MSG Project MSG_ERR protected void resetFileLists compileList removeAllElements protected void scanDir File srcDir File dest JspMangler mangler String files long now new Date getTime for int files length String filename files File srcFile new File srcDir filename File javaFile mapToJavaFile mangler srcFile srcDir dest if javaFile null continue if srcFile lastModified now log filename Project MSG_WARN boolean shouldCompile false shouldCompile isCompileNeeded srcFile javaFile if shouldCompile compileList addElement srcFile getAbsolutePath javaFiles addElement javaFile private boolean isCompileNeeded File srcFile File javaFile boolean shouldCompile false if javaFile exists shouldCompile true log srcFile getPath javaFile getPath Project MSG_VERBOSE else if srcFile lastModified javaFile lastModified shouldCompile true log srcFile getPath javaFile getPath Project MSG_VERBOSE else if javaFile length shouldCompile true log srcFile getPath javaFile getPath Project MSG_VERBOSE return shouldCompile protected File mapToJavaFile JspMangler mangler File srcFile File srcDir File dest if srcFile getName endsWith return null String javaFileName mangler mapJspToJavaName srcFile return new File dest javaFileName public void deleteEmptyJavaFiles if javaFiles null Enumeration javaFiles elements while hasMoreElements File file File nextElement if file exists file length log file file delete public static class WebAppParameter private File directory public File getDirectory return directory public void setBaseDir File directory this directory directory public final class ZipLong implements Cloneable private long value public ZipLong long value this value value public ZipLong byte bytes this bytes public ZipLong byte bytes int offset value ZipLong getValue bytes offset public byte getBytes return ZipLong getBytes value public long getValue return value public static byte getBytes long value byte result new byte result byte value result byte value result byte value result byte value return result public static long getValue byte bytes int offset long value bytes offset value bytes offset value bytes offset value bytes offset return value public static long getValue byte bytes return getValue bytes public boolean equals Object if null instanceof ZipLong return false return value ZipLong getValue public int hashCode return int value public abstract class AbstractAnalyzer implements DependencyAnalyzer public static final int MAX_LOOPS private Path sourcePath new Path null private Path classPath new Path null private Vector rootClasses new Vector private boolean determined false private Vector fileDependencies private Vector classDependencies private boolean closure true protected AbstractAnalyzer reset public void setClosure boolean closure this closure closure public Enumeration getFileDependencies if supportsFileDependencies throw new RuntimeException if determined determineDependencies fileDependencies classDependencies return fileDependencies elements public Enumeration getClassDependencies if determined determineDependencies fileDependencies classDependencies return classDependencies elements public File getClassContainer String classname throws IOException String classLocation classname replace return getResourceContainer classLocation classPath list public File getSourceContainer String classname throws IOException String sourceLocation classname replace return getResourceContainer sourceLocation sourcePath list public void addSourcePath Path sourcePath if sourcePath null return this sourcePath append sourcePath this sourcePath setProject sourcePath getProject public void addClassPath Path classPath if classPath null return this classPath append classPath this classPath setProject classPath getProject public void addRootClass String className if className null return if rootClasses contains className rootClasses addElement className public void config String name Object info public void reset rootClasses removeAllElements determined false fileDependencies new Vector classDependencies new Vector protected Enumeration getRootClasses return rootClasses elements protected boolean isClosureRequired return closure protected abstract void determineDependencies Vector files Vector classes protected abstract boolean supportsFileDependencies private File getResourceContainer String resourceLocation String paths throws IOException for int paths length File element new File paths if element exists continue if element isDirectory File resource new File element resourceLocation if resource exists return resource else ZipFile zipFile null try zipFile new ZipFile element if zipFile getEntry resourceLocation null return element finally if zipFile null zipFile close return null public class ReaderInputStream extends InputStream private Reader in private String encoding System getProperty private byte slack private int begin public ReaderInputStream Reader reader in reader public ReaderInputStream Reader reader String encoding this reader if encoding null throw new IllegalArgumentException else this encoding encoding public synchronized int read throws IOException if in null throw new IOException byte result if slack null begin slack length result slack begin if begin slack length slack null else byte buf new byte if read buf return else result buf return result public synchronized int read byte int off int len throws IOException if in null throw new IOException if len return while slack null int in read buf if return if slack new String buf getBytes encoding begin if len slack length begin len slack length begin System arraycopy slack begin off len if begin len slack length slack null return len public synchronized void mark final int limit try in mark limit catch IOException ioe throw new RuntimeException ioe getMessage public synchronized int available throws IOException if in null throw new IOException if slack null return slack length begin if in ready return else return public boolean markSupported public synchronized void reset throws IOException if in null throw new IOException slack null in reset public synchronized void close throws IOException if in null in close slack null in null public class ContainsSelector extends BaseExtendSelector implements ResourceSelector private String contains null private boolean casesensitive true private boolean ignorewhitespace false public static final String EXPRESSION_KEY public static final String CONTAINS_KEY public static final String CASE_KEY public static final String WHITESPACE_KEY public ContainsSelector public String toString StringBuffer buf new StringBuffer buf append append contains append buf append buf append casesensitive buf append buf append ignorewhitespace buf append return buf toString public void setText String contains this contains contains public void setCasesensitive boolean casesensitive this casesensitive casesensitive public void setIgnorewhitespace boolean ignorewhitespace this ignorewhitespace ignorewhitespace public void setParameters Parameter parameters super setParameters parameters if parameters null for int parameters length String paramname parameters getName if CONTAINS_KEY equalsIgnoreCase paramname setText parameters getValue else if CASE_KEY equalsIgnoreCase paramname setCasesensitive Project toBoolean parameters getValue else if WHITESPACE_KEY equalsIgnoreCase paramname setIgnorewhitespace Project toBoolean parameters getValue else setError paramname public void verifySettings if contains null setError public boolean isSelected File basedir String filename File file return isSelected new FileResource file public boolean isSelected Resource validate if isDirectory return true String userstr contains if casesensitive userstr contains toLowerCase if ignorewhitespace userstr SelectorUtils removeWhitespace userstr BufferedReader in null try in new BufferedReader new InputStreamReader getInputStream catch Exception throw new BuildException toLongString try String teststr in readLine while teststr null if casesensitive teststr teststr toLowerCase if ignorewhitespace teststr SelectorUtils removeWhitespace teststr if teststr indexOf userstr return true teststr in readLine return false catch IOException ioe throw new BuildException toLongString finally FileUtils close in public class GenerateKey extends Task public static class DnameParam private String name private String value public void setName String name this name name public String getName return name public void setValue String value this value value public String getValue return value public static class DistinguishedName private Vector params new Vector public Object createParam DnameParam param new DnameParam params addElement param return param public Enumeration getParams return params elements public String toString final int size params size final StringBuffer sb new StringBuffer boolean firstPass true for int size if firstPass sb append firstPass false final DnameParam param DnameParam params elementAt sb append encode param getName sb append sb append encode param getValue return sb toString public String encode final String string int end string indexOf if end return string final StringBuffer sb new StringBuffer int start while end sb append string substring start end sb append start end end string indexOf start sb append string substring start return sb toString protected String alias protected String keystore protected String storepass protected String storetype protected String keypass protected String sigalg protected String keyalg protected String dname protected DistinguishedName expandedDname protected int keysize protected int validity protected boolean verbose public DistinguishedName createDname throws BuildException if null expandedDname throw new BuildException if null dname throw new BuildException expandedDname new DistinguishedName return expandedDname public void setDname final String dname if null expandedDname throw new BuildException this dname dname public void setAlias final String alias this alias alias public void setKeystore final String keystore this keystore keystore public void setStorepass final String storepass this storepass storepass public void setStoretype final String storetype this storetype storetype public void setKeypass final String keypass this keypass keypass public void setSigalg final String sigalg this sigalg sigalg public void setKeyalg final String keyalg this keyalg keyalg public void setKeysize final String keysize throws BuildException try this keysize Integer parseInt keysize catch final NumberFormatException nfe throw new BuildException public void setValidity final String validity throws BuildException try this validity Integer parseInt validity catch final NumberFormatException nfe throw new BuildException public void setVerbose final boolean verbose this verbose verbose public void execute throws BuildException if null alias throw new BuildException if null storepass throw new BuildException if null dname null expandedDname throw new BuildException final StringBuffer sb new StringBuffer sb append if verbose sb append sb append sb append alias sb append if null dname sb append sb append dname sb append if null expandedDname sb append sb append expandedDname sb append if null keystore sb append sb append keystore sb append if null storepass sb append sb append storepass sb append if null storetype sb append sb append storetype sb append sb append if null keypass sb append keypass else sb append storepass sb append if null sigalg sb append sb append sigalg sb append if null keyalg sb append sb append keyalg sb append if keysize sb append sb append keysize sb append if validity sb append sb append validity sb append log alias final ExecTask cmd new ExecTask this cmd setExecutable JavaEnvUtils getJdkExecutable Commandline Argument arg cmd createArg arg setLine sb toString cmd setFailonerror true cmd setTaskName getTaskName cmd execute public abstract class BaseResourceCollectionContainer extends DataType implements ResourceCollection Cloneable private List rc new ArrayList private Collection coll null private boolean cache true public synchronized void setCache boolean cache public synchronized boolean isCache return cache public synchronized void clear throws BuildException if isReference throw noChildrenAllowed rc clear FailFast invalidate this coll null setChecked false public synchronized void add ResourceCollection throws BuildException if isReference throw noChildrenAllowed if null return rc add FailFast invalidate this coll null setChecked false public synchronized void addAll Collection throws BuildException if isReference throw noChildrenAllowed try for Iterator iterator hasNext add ResourceCollection next catch ClassCastException throw new BuildException public final synchronized Iterator iterator if isReference return BaseResourceCollectionContainer getCheckedRef iterator dieOnCircularReference return new FailFast this cacheCollection iterator public synchronized int size if isReference return BaseResourceCollectionContainer getCheckedRef size dieOnCircularReference return cacheCollection size public synchronized boolean isFilesystemOnly if isReference return BaseResourceCollectionContainer getCheckedRef isFilesystemOnly dieOnCircularReference boolean goEarly true for Iterator rc iterator goEarly hasNext goEarly ResourceCollection next isFilesystemOnly if goEarly return true for Iterator cacheCollection iterator hasNext if next instanceof FileResource return false return true protected synchronized void dieOnCircularReference Stack stk Project throws BuildException if isChecked return if isReference super dieOnCircularReference stk else for Iterator rc iterator hasNext Object next if instanceof DataType stk push invokeCircularReferenceCheck DataType stk stk pop setChecked true protected final synchronized List getResourceCollections dieOnCircularReference return Collections unmodifiableList rc protected abstract Collection getCollection public Object clone try BaseResourceCollectionContainer BaseResourceCollectionContainer super clone rc new ArrayList rc coll null return catch CloneNotSupportedException throw new BuildException public synchronized String toString if isReference return getCheckedRef toString if cacheCollection size return StringBuffer sb new StringBuffer for Iterator coll iterator hasNext if sb length sb append File pathSeparatorChar sb append next return sb toString private synchronized Collection cacheCollection if coll null isCache coll getCollection return coll public class Typedef extends Definer public class SingleCheckExecutor implements Executor public void executeTargets Project project String targetNames throws BuildException project executeSortedTargets project topoSort targetNames project getTargets false public Executor getSubProjectExecutor return this public class Resource extends DataType implements Cloneable Comparable ResourceCollection public static final long UNKNOWN_SIZE public static final long UNKNOWN_DATETIME protected static final int MAGIC getMagicNumber getBytes private static final int NULL_NAME getMagicNumber getBytes protected static int getMagicNumber byte seed return new BigInteger seed intValue private String name null private Boolean exists null private Long lastmodified null private Boolean directory null private Long size null public Resource public Resource String name this name false false public Resource String name boolean exists long lastmodified this name exists lastmodified false public Resource String name boolean exists long lastmodified boolean directory this name exists lastmodified directory UNKNOWN_SIZE public Resource String name boolean exists long lastmodified boolean directory long size this name name setName name setExists exists setLastModified lastmodified setDirectory directory setSize size public String getName return isReference Resource getCheckedRef getName name public void setName String name checkAttributesAllowed this name name public boolean isExists if isReference return Resource getCheckedRef isExists return exists null exists booleanValue public void setExists boolean exists checkAttributesAllowed this exists exists Boolean TRUE Boolean FALSE public long getLastModified if isReference return Resource getCheckedRef getLastModified if isExists lastmodified null return UNKNOWN_DATETIME long result lastmodified longValue return result UNKNOWN_DATETIME UNKNOWN_DATETIME result public void setLastModified long lastmodified checkAttributesAllowed this lastmodified new Long lastmodified public boolean isDirectory if isReference return Resource getCheckedRef isDirectory return directory null directory booleanValue public void setDirectory boolean directory checkAttributesAllowed this directory directory Boolean TRUE Boolean FALSE public void setSize long size checkAttributesAllowed this size new Long size UNKNOWN_SIZE size UNKNOWN_SIZE public long getSize if isReference return Resource getCheckedRef getSize return isExists size null size longValue UNKNOWN_SIZE public Object clone try return super clone catch CloneNotSupportedException throw new UnsupportedOperationException public int compareTo Object other if isReference return Comparable getCheckedRef compareTo other if other instanceof Resource throw new IllegalArgumentException return toString compareTo other toString public boolean equals Object other if isReference return getCheckedRef equals other return other getClass equals getClass compareTo other public int hashCode if isReference return getCheckedRef hashCode String name getName return MAGIC name null NULL_NAME name hashCode public InputStream getInputStream throws IOException if isReference return Resource getCheckedRef getInputStream throw new UnsupportedOperationException public OutputStream getOutputStream throws IOException if isReference return Resource getCheckedRef getOutputStream throw new UnsupportedOperationException public Iterator iterator return isReference Resource getCheckedRef iterator new Iterator private boolean done false public boolean hasNext return done public Object next if done throw new NoSuchElementException done true return Resource this public void remove throw new UnsupportedOperationException public int size return isReference Resource getCheckedRef size public boolean isFilesystemOnly return isReference Resource getCheckedRef isFilesystemOnly public String toString if isReference return getCheckedRef toString String getName return null public final String toLongString return isReference Resource getCheckedRef toLongString getDataTypeName toString public void setRefid Reference if name null exists null lastmodified null directory null size null throw tooManyAttributes super setRefid public class P4Add extends P4Base private static final int DEFAULT_CMD_LENGTH private int changelist private String addCmd private Vector filesets new Vector private int cmdLength DEFAULT_CMD_LENGTH public void setCommandlength int len throws BuildException if len throw new BuildException this cmdLength len public void setChangelist int changelist throws BuildException if changelist throw new BuildException this changelist changelist public void addFileset FileSet set filesets addElement set public void execute throws BuildException if P4View null addCmd P4View P4CmdOpts changelist changelist StringBuffer filelist new StringBuffer for int filesets size FileSet fs FileSet filesets elementAt DirectoryScanner ds fs getDirectoryScanner getProject String srcFiles ds getIncludedFiles if srcFiles null for int srcFiles length File new File ds getBasedir srcFiles filelist append append append getAbsolutePath append if filelist length cmdLength execP4Add filelist filelist new StringBuffer if filelist length execP4Add filelist else log Project MSG_WARN private void execP4Add StringBuffer list log P4CmdOpts addCmd list Project MSG_INFO execP4Command P4CmdOpts addCmd list new SimpleP4OutputHandler this public class PropertyFile extends Task private String comment private Properties properties private File propertyfile private Vector entries new Vector public void execute throws BuildException checkParameters readFile executeOperation writeFile public Entry createEntry Entry new Entry entries addElement return private void executeOperation throws BuildException for Enumeration entries elements hasMoreElements Entry entry Entry nextElement entry executeOn properties private void readFile throws BuildException properties new Properties try if propertyfile exists log propertyfile getAbsolutePath FileInputStream fis null try fis new FileInputStream propertyfile BufferedInputStream bis new BufferedInputStream fis properties load bis finally if fis null fis close else log propertyfile getAbsolutePath FileOutputStream out null try out new FileOutputStream propertyfile getAbsolutePath out flush finally if out null out close catch IOException ioe throw new BuildException ioe toString private void checkParameters throws BuildException if checkParam propertyfile throw new BuildException getLocation public void setFile File file propertyfile file public void setComment String hdr comment hdr private void writeFile throws BuildException BufferedOutputStream bos null try bos new BufferedOutputStream new FileOutputStream propertyfile properties store bos comment catch IOException ioe throw new BuildException ioe getLocation finally FileUtils close bos private boolean checkParam File param return param null public static class Entry private static final int DEFAULT_INT_VALUE private static final String DEFAULT_DATE_VALUE private static final String DEFAULT_STRING_VALUE private String key null private int type Type STRING_TYPE private int operation Operation EQUALS_OPER private String value null private String defaultValue null private String newValue null private String pattern null private int field Calendar DATE public void setKey String value this key value public void setValue String value this value value public void setOperation Operation value this operation Operation toOperation value getValue public void setType Type value this type Type toType value getValue public void setDefault String value this defaultValue value public void setPattern String value this pattern value public void setUnit PropertyFile Unit unit field unit getCalendarField protected void executeOn Properties props throws BuildException checkParameters String oldValue String props get key try if type Type INTEGER_TYPE executeInteger oldValue else if type Type DATE_TYPE executeDate oldValue else if type Type STRING_TYPE executeString oldValue else throw new BuildException type catch NullPointerException npe npe printStackTrace if newValue null newValue props put key newValue private void executeDate String oldValue throws BuildException Calendar currentValue Calendar getInstance if pattern null pattern DateFormat fmt new SimpleDateFormat pattern String currentStringValue getCurrentValue oldValue if currentStringValue null currentStringValue DEFAULT_DATE_VALUE if equals currentStringValue currentValue setTime new Date else try currentValue setTime fmt parse currentStringValue catch ParseException pe if operation Operation EQUALS_OPER int offset try offset Integer parseInt value if operation Operation DECREMENT_OPER offset offset catch NumberFormatException throw new BuildException key currentValue add field offset newValue fmt format currentValue getTime private void executeInteger String oldValue throws BuildException int currentValue DEFAULT_INT_VALUE int newV DEFAULT_INT_VALUE DecimalFormat fmt pattern null new DecimalFormat pattern new DecimalFormat try String curval getCurrentValue oldValue if curval null currentValue fmt parse curval intValue else currentValue catch NumberFormatException nfe catch ParseException pe if operation Operation EQUALS_OPER newV currentValue else int operationValue if value null try operationValue fmt parse value intValue catch NumberFormatException nfe catch ParseException pe if operation Operation INCREMENT_OPER newV currentValue operationValue else if operation Operation DECREMENT_OPER newV currentValue operationValue this newValue fmt format newV private void executeString String oldValue throws BuildException String newV DEFAULT_STRING_VALUE String currentValue getCurrentValue oldValue if currentValue null currentValue DEFAULT_STRING_VALUE if operation Operation EQUALS_OPER newV currentValue else if operation Operation INCREMENT_OPER newV currentValue value this newValue newV private void checkParameters throws BuildException if type Type STRING_TYPE operation Operation DECREMENT_OPER throw new BuildException key if value null defaultValue null throw new BuildException key if key null throw new BuildException if type Type STRING_TYPE pattern null throw new BuildException key private String getCurrentValue String oldValue String ret null if operation Operation EQUALS_OPER if value null defaultValue null ret value if value null defaultValue null oldValue null ret oldValue if value null defaultValue null oldValue null ret defaultValue if value null defaultValue null oldValue null ret value if value null defaultValue null oldValue null ret defaultValue else ret oldValue null defaultValue oldValue return ret public static class Operation extends EnumeratedAttribute public static final int INCREMENT_OPER public static final int DECREMENT_OPER public static final int EQUALS_OPER public String getValues return new String public static int toOperation String oper if equals oper return INCREMENT_OPER else if equals oper return DECREMENT_OPER return EQUALS_OPER public static class Type extends EnumeratedAttribute public static final int INTEGER_TYPE public static final int DATE_TYPE public static final int STRING_TYPE public String getValues return new String public static int toType String type if equals type return INTEGER_TYPE else if equals type return DATE_TYPE return STRING_TYPE public static class Unit extends EnumeratedAttribute private static final String MILLISECOND private static final String SECOND private static final String MINUTE private static final String HOUR private static final String DAY private static final String WEEK private static final String MONTH private static final String YEAR private static final String UNITS MILLISECOND SECOND MINUTE HOUR DAY WEEK MONTH YEAR private Map calendarFields new HashMap public Unit calendarFields put MILLISECOND new Integer Calendar MILLISECOND calendarFields put SECOND new Integer Calendar SECOND calendarFields put MINUTE new Integer Calendar MINUTE calendarFields put HOUR new Integer Calendar HOUR_OF_DAY calendarFields put DAY new Integer Calendar DATE calendarFields put WEEK new Integer Calendar WEEK_OF_YEAR calendarFields put MONTH new Integer Calendar MONTH calendarFields put YEAR new Integer Calendar YEAR public int getCalendarField String key getValue toLowerCase Integer Integer calendarFields get key return intValue public String getValues return UNITS public class Description extends DataType public void addText String text ProjectHelper ph ProjectHelper getProjectHelper if ph instanceof ProjectHelperImpl return String currentDescription getProject getDescription if currentDescription null getProject setDescription text else getProject setDescription currentDescription text public static String getDescription Project project Vector targets Vector project getReference if targets null return null StringBuffer description new StringBuffer for int targets size Target Target targets elementAt concatDescriptions project description return description toString private static void concatDescriptions Project project Target StringBuffer description if null return Vector tasks findElementInTarget project if tasks null return for int tasks size Task task Task tasks elementAt if task instanceof UnknownElement continue UnknownElement ue UnknownElement task String descComp ue getWrapper getText toString if descComp null description append project replaceProperties descComp private static Vector findElementInTarget Project project Target String name Task tasks getTasks Vector elems new Vector for int tasks length if name equals tasks getTaskName elems addElement tasks return elems public class FlexInteger private Integer value public FlexInteger String value this value Integer decode value public int intValue return value intValue public String toString return value toString public class Filter extends Task private String token private String value private File filtersFile public void setToken String token this token token public void setValue String value this value value public void setFiltersfile File filtersFile this filtersFile filtersFile public void execute throws BuildException boolean isFiltersFromFile filtersFile null token null value null boolean isSingleFilter filtersFile null token null value null if isFiltersFromFile isSingleFilter throw new BuildException getLocation if isSingleFilter getProject getGlobalFilterSet addFilter token value if isFiltersFromFile readFilters protected void readFilters throws BuildException log filtersFile Project MSG_VERBOSE getProject getGlobalFilterSet readFiltersFromFile filtersFile public abstract class AbstractCvsTask extends Task public static final int DEFAULT_COMPRESSION_LEVEL private static final int MAXIMUM_COMRESSION_LEVEL private Commandline cmd new Commandline private Vector vecCommandlines new Vector private String cvsRoot private String cvsRsh private String cvsPackage private String tag private static final String DEFAULT_COMMAND private String command null private boolean quiet false private boolean reallyquiet false private int compression private boolean noexec false private int port private File passFile null private File dest private boolean append false private File output private File error private boolean failOnError false private ExecuteStreamHandler executeStreamHandler private OutputStream outputStream private OutputStream errorStream public AbstractCvsTask super public void setExecuteStreamHandler ExecuteStreamHandler handler this executeStreamHandler handler protected ExecuteStreamHandler getExecuteStreamHandler if this executeStreamHandler null setExecuteStreamHandler new PumpStreamHandler getOutputStream getErrorStream return this executeStreamHandler protected void setOutputStream OutputStream outputStream this outputStream outputStream protected OutputStream getOutputStream if this outputStream null if output null try setOutputStream new PrintStream new BufferedOutputStream new FileOutputStream output getPath append catch IOException throw new BuildException getLocation else setOutputStream new LogOutputStream this Project MSG_INFO return this outputStream protected void setErrorStream OutputStream errorStream this errorStream errorStream protected OutputStream getErrorStream if this errorStream null if error null try setErrorStream new PrintStream new BufferedOutputStream new FileOutputStream error getPath append catch IOException throw new BuildException getLocation else setErrorStream new LogOutputStream this Project MSG_WARN return this errorStream protected void runCommand Commandline toExecute throws BuildException Environment env new Environment if port Environment Variable var new Environment Variable var setKey var setValue String valueOf port env addVariable var if passFile null File defaultPassFile new File System getProperty System getProperty File separatorChar if defaultPassFile exists this setPassfile defaultPassFile if passFile null if passFile isFile passFile canRead Environment Variable var new Environment Variable var setKey var setValue String valueOf passFile env addVariable var log String valueOf passFile Project MSG_VERBOSE else if passFile canRead log String valueOf passFile Project MSG_WARN else log String valueOf passFile Project MSG_WARN if cvsRsh null Environment Variable var new Environment Variable var setKey var setValue String valueOf cvsRsh env addVariable var Execute exe new Execute getExecuteStreamHandler null exe setAntRun getProject if dest null dest getProject getBaseDir if dest exists dest mkdirs exe setWorkingDirectory dest exe setCommandline toExecute getCommandline exe setEnvironment env getVariables try String actualCommandLine executeToString exe log actualCommandLine Project MSG_VERBOSE int retCode exe execute log retCode Project MSG_DEBUG if failOnError Execute isFailure retCode throw new BuildException retCode StringUtils LINE_SEP actualCommandLine getLocation catch IOException if failOnError throw new BuildException getLocation log getMessage Project MSG_WARN catch BuildException if failOnError throw Throwable getException if null log getMessage Project MSG_WARN catch Exception if failOnError throw new BuildException getLocation log getMessage Project MSG_WARN public void execute throws BuildException String savedCommand getCommand if this getCommand null vecCommandlines size this setCommand AbstractCvsTask DEFAULT_COMMAND String this getCommand Commandline cloned null if null cloned Commandline cmd clone cloned createArgument true setLine this addConfiguredCommandline cloned true try for int vecCommandlines size this runCommand Commandline vecCommandlines elementAt finally if cloned null removeCommandline cloned setCommand savedCommand FileUtils close outputStream FileUtils close errorStream private String executeToString Execute execute StringBuffer stringBuffer new StringBuffer Commandline describeCommand execute getCommandline String newLine StringUtils LINE_SEP String variableArray execute getEnvironment if variableArray null stringBuffer append newLine stringBuffer append newLine stringBuffer append stringBuffer append newLine for int variableArray length stringBuffer append newLine stringBuffer append stringBuffer append variableArray return stringBuffer toString public void setCvsRoot String root if root null if root trim equals root null this cvsRoot root public String getCvsRoot return this cvsRoot public void setCvsRsh String rsh if rsh null if rsh trim equals rsh null this cvsRsh rsh public String getCvsRsh return this cvsRsh public void setPort int port this port port public int getPort return this port public void setPassfile File passFile this passFile passFile public File getPassFile return this passFile public void setDest File dest this dest dest public File getDest return this dest public void setPackage String this cvsPackage public String getPackage return this cvsPackage public String getTag return tag public void setTag String if null trim length tag addCommandArgument public void addCommandArgument String arg this addCommandArgument cmd arg public void addCommandArgument Commandline String arg createArgument setValue arg public void setDate String if null trim length addCommandArgument addCommandArgument public void setCommand String this command public String getCommand return this command public void setQuiet boolean quiet public void setReallyquiet boolean reallyquiet public void setNoexec boolean ne noexec ne public void setOutput File output this output output public void setError File error this error error public void setAppend boolean value this append value public void setFailOnError boolean failOnError this failOnError failOnError protected void configureCommandline Commandline if null return setExecutable if cvsPackage null createArgument setLine cvsPackage if this compression this compression MAXIMUM_COMRESSION_LEVEL createArgument true setValue this compression if quiet reallyquiet createArgument true setValue if reallyquiet createArgument true setValue if noexec createArgument true setValue if cvsRoot null createArgument true setLine cvsRoot protected void removeCommandline Commandline vecCommandlines removeElement public void addConfiguredCommandline Commandline this addConfiguredCommandline false public void addConfiguredCommandline Commandline boolean insertAtStart if null return this configureCommandline if insertAtStart vecCommandlines insertElementAt else vecCommandlines addElement public void setCompressionLevel int level this compression level public void setCompression boolean usecomp setCompressionLevel usecomp AbstractCvsTask DEFAULT_COMPRESSION_LEVEL public class ExtensionUtil private ExtensionUtil static ArrayList toExtensions final List adapters throws BuildException final ArrayList results new ArrayList final int size adapters size for int size final ExtensionAdapter adapter ExtensionAdapter adapters get final Extension extension adapter toExtension results add extension return results static void extractExtensions final Project project final List libraries final List fileset throws BuildException if fileset isEmpty final Extension extensions getExtensions project fileset for int extensions length libraries add extensions private static Extension getExtensions final Project project final List libraries throws BuildException final ArrayList extensions new ArrayList final Iterator iterator libraries iterator while iterator hasNext final FileSet fileSet FileSet iterator next boolean includeImpl true boolean includeURL true if fileSet instanceof LibFileSet LibFileSet libFileSet LibFileSet fileSet includeImpl libFileSet isIncludeImpl includeURL libFileSet isIncludeURL final DirectoryScanner scanner fileSet getDirectoryScanner project final File basedir scanner getBasedir final String files scanner getIncludedFiles for int files length final File file new File basedir files loadExtensions file extensions includeImpl includeURL return Extension extensions toArray new Extension extensions size private static void loadExtensions final File file final List extensionList final boolean includeImpl final boolean includeURL throws BuildException try final JarFile jarFile new JarFile file final Extension extensions Extension getAvailable jarFile getManifest for int extensions length final Extension extension extensions addExtension extensionList extension includeImpl includeURL catch final Exception throw new BuildException getMessage private static void addExtension final List extensionList final Extension originalExtension final boolean includeImpl final boolean includeURL Extension extension originalExtension if includeURL null extension getImplementationURL extension new Extension extension getExtensionName extension getSpecificationVersion toString extension getSpecificationVendor extension getImplementationVersion toString extension getImplementationVendor extension getImplementationVendorID null final boolean hasImplAttributes null extension getImplementationURL null extension getImplementationVersion null extension getImplementationVendorID null extension getImplementationVendor if includeImpl hasImplAttributes extension new Extension extension getExtensionName extension getSpecificationVersion toString extension getSpecificationVendor null null null extension getImplementationURL extensionList add extension static Manifest getManifest final File file throws BuildException try final JarFile jarFile new JarFile file Manifest jarFile getManifest if null throw new BuildException file return catch final IOException ioe throw new BuildException ioe getMessage ioe public class Chown extends AbstractAccessTask private boolean haveOwner false public Chown super setExecutable public void setOwner String owner createArg setValue owner haveOwner true protected void checkConfiguration if haveOwner throw new BuildException getLocation super checkConfiguration public void setExecutable String throw new BuildException getTaskType getLocation public class BuildException extends RuntimeException private Throwable cause private Location location Location UNKNOWN_LOCATION public BuildException super public BuildException String message super message public BuildException String message Throwable cause super message this cause cause public BuildException String msg Throwable cause Location location this msg cause this location location public BuildException Throwable cause super cause toString this cause cause public BuildException String message Location location super message this location location public BuildException Throwable cause Location location this cause this location location public Throwable getException return cause public Throwable getCause return getException public String toString return location toString getMessage public void setLocation Location location this location location public Location getLocation return location public void printStackTrace printStackTrace System err public void printStackTrace PrintStream ps synchronized ps super printStackTrace ps if cause null ps println cause printStackTrace ps public void printStackTrace PrintWriter pw synchronized pw super printStackTrace pw if cause null pw println cause printStackTrace pw public class Sync extends Task private MyCopy myCopy private SyncTarget syncTarget public void init throws BuildException myCopy new MyCopy configureTask myCopy myCopy setFiltering false myCopy setIncludeEmptyDirs false myCopy setPreserveLastModified true private void configureTask Task helper helper setProject getProject helper setTaskName getTaskName helper setOwningTarget getOwningTarget helper init public void execute throws BuildException File toDir myCopy getToDir Set allFiles myCopy nonOrphans boolean noRemovalNecessary toDir exists toDir list length log toDir Project MSG_DEBUG myCopy execute if noRemovalNecessary log toDir Project MSG_DEBUG log toDir Project MSG_DEBUG int removedFileCount removeOrphanFiles allFiles toDir logRemovedCount removedFileCount logRemovedCount removedFileCount if myCopy getIncludeEmptyDirs log toDir Project MSG_DEBUG int removedDirCount removeEmptyDirectories toDir false logRemovedCount removedDirCount private void logRemovedCount int count String prefix String singularSuffix String pluralSuffix File toDir myCopy getToDir String what prefix null prefix what count singularSuffix pluralSuffix if count log count what toDir Project MSG_INFO else log what toDir Project MSG_VERBOSE private int removeOrphanFiles Set nonOrphans File toDir int removedCount new int String excls String nonOrphans toArray new String nonOrphans size excls nonOrphans size DirectoryScanner ds null if syncTarget null FileSet fs new FileSet fs setDir toDir fs setCaseSensitive syncTarget isCaseSensitive fs setFollowSymlinks syncTarget isFollowSymlinks PatternSet ps syncTarget mergePatterns getProject fs appendExcludes ps getIncludePatterns getProject fs appendIncludes ps getExcludePatterns getProject fs setDefaultexcludes syncTarget getDefaultexcludes FileSelector syncTarget getSelectors getProject if length NoneSelector ns new NoneSelector for int length ns appendSelector fs appendSelector ns ds fs getDirectoryScanner getProject else ds new DirectoryScanner ds setBasedir toDir ds addExcludes excls ds scan String files ds getIncludedFiles for int files length File new File toDir files log Project MSG_DEBUG delete removedCount String dirs ds getIncludedDirectories for int dirs length File new File toDir dirs if list length log Project MSG_DEBUG delete removedCount return removedCount private int removeEmptyDirectories File dir boolean removeIfEmpty int removedCount if dir isDirectory File children dir listFiles for int children length File file children if file isDirectory removedCount removeEmptyDirectories file true if children length children dir listFiles if children length removeIfEmpty log dir Project MSG_DEBUG dir delete removedCount return removedCount public void setTodir File destDir myCopy setTodir destDir public void setVerbose boolean verbose myCopy setVerbose verbose public void setOverwrite boolean overwrite myCopy setOverwrite overwrite public void setIncludeEmptyDirs boolean includeEmpty myCopy setIncludeEmptyDirs includeEmpty public void setFailOnError boolean failonerror myCopy setFailOnError failonerror public void addFileset FileSet set add set public void add ResourceCollection rc myCopy add rc public void setGranularity long granularity myCopy setGranularity granularity public void addPreserveInTarget SyncTarget if syncTarget null throw new BuildException syncTarget public static class MyCopy extends Copy private Set nonOrphans new HashSet public MyCopy protected void scan File fromDir File toDir String files String dirs assertTrue mapperElement null super scan fromDir toDir files dirs for int files length nonOrphans add files for int dirs length nonOrphans add dirs protected Map scan Resource resources File toDir assertTrue mapperElement null Map super scan resources toDir Iterator iter keySet iterator while iter hasNext nonOrphans add Resource iter next getName return public File getToDir return destDir public boolean getIncludeEmptyDirs return includeEmpty protected boolean supportsNonFileResources return true public static class SyncTarget extends AbstractFileSet public SyncTarget super public void setDir File dir throws BuildException throw new BuildException private static void assertTrue String message boolean condition if condition throw new BuildException message public class ClassFileUtils public static String convertSlashName String name return name replace replace public static String convertDotName String dotName return dotName replace public abstract class EnumeratedAttribute protected String value private int index public abstract String getValues protected EnumeratedAttribute public static EnumeratedAttribute getInstance String value throws BuildException if EnumeratedAttribute class isAssignableFrom clazz throw new BuildException EnumeratedAttribute ea null try ea EnumeratedAttribute clazz newInstance catch Exception throw new BuildException ea setValue value return ea public final void setValue String value throws BuildException int idx indexOfValue value if idx throw new BuildException value this index idx this value value public final boolean containsValue String value return indexOfValue value public final int indexOfValue String value String values getValues if values null value null return for int values length if value equals values return return public final String getValue return value public final int getIndex return index public String toString return getValue public class JasperC extends DefaultJspCompilerAdapter JspMangler mangler public JasperC JspMangler mangler this mangler mangler public boolean execute throws BuildException getJspc log Project MSG_VERBOSE CommandlineJava cmd setupJasperCommand try Java java new Java owner Path getClasspath if getJspc getClasspath null getProject log Project MSG_DEBUG else getProject log Project MSG_DEBUG java setClasspath java setDir getProject getBaseDir java setClassname String args cmd getJavaCommand getArguments for int args length java createArg setValue args java setFailonerror getJspc getFailonerror java setFork true java setTaskName java execute return true catch Exception ex if ex instanceof BuildException throw BuildException ex else throw new BuildException ex getJspc getLocation finally getJspc deleteEmptyJavaFiles private CommandlineJava setupJasperCommand CommandlineJava cmd new CommandlineJava JspC jspc getJspc addArg cmd jspc getDestdir addArg cmd jspc getPackage if isTomcat5x addArg cmd jspc getVerbose else getProject log addArg cmd jspc getUriroot addArg cmd jspc getUribase addArg cmd jspc getIeplugin addArg cmd jspc getWebinc addArg cmd jspc getWebxml addArg cmd if jspc isMapped addArg cmd if jspc getWebApp null File dir jspc getWebApp getDirectory addArg cmd dir logAndAddFilesToCompile getJspc getJspc getCompileList cmd return cmd public JspMangler createMangler return mangler private Path getClasspath Path getJspc getClasspath if null new Path getProject return concatSystemClasspath else return concatSystemClasspath private boolean isTomcat5x AntClassLoader null try getProject createClassLoader getClasspath loadClass return true catch ClassNotFoundException return false finally if null cleanup public class IPlanetEjbcTask extends Task private File ejbdescriptor private File iasdescriptor private File dest private Path classpath private boolean keepgenerated false private boolean debug false private File iashome public void setEjbdescriptor File ejbdescriptor this ejbdescriptor ejbdescriptor public void setIasdescriptor File iasdescriptor this iasdescriptor iasdescriptor public void setDest File dest this dest dest public void setClasspath Path classpath if this classpath null this classpath classpath else this classpath append classpath public Path createClasspath if classpath null classpath new Path getProject return classpath createPath public void setKeepgenerated boolean keepgenerated this keepgenerated keepgenerated public void setDebug boolean debug this debug debug public void setIashome File iashome this iashome iashome public void execute throws BuildException checkConfiguration executeEjbc getParser private void checkConfiguration throws BuildException if ejbdescriptor null String msg throw new BuildException msg getLocation if ejbdescriptor exists ejbdescriptor isFile String msg ejbdescriptor throw new BuildException msg getLocation if iasdescriptor null String msg throw new BuildException msg getLocation if iasdescriptor exists iasdescriptor isFile String msg iasdescriptor throw new BuildException msg getLocation if dest null String msg throw new BuildException msg getLocation if dest exists dest isDirectory String msg dest throw new BuildException msg getLocation if iashome null iashome isDirectory String msg iashome throw new BuildException msg getLocation private SAXParser getParser throws BuildException SAXParser saxParser null try SAXParserFactory saxParserFactory SAXParserFactory newInstance saxParserFactory setValidating true saxParser saxParserFactory newSAXParser catch SAXException String msg getMessage throw new BuildException msg getLocation catch ParserConfigurationException String msg getMessage throw new BuildException msg getLocation return saxParser private void executeEjbc SAXParser saxParser throws BuildException IPlanetEjbc ejbc new IPlanetEjbc ejbdescriptor iasdescriptor dest getClasspath toString saxParser ejbc setRetainSource keepgenerated ejbc setDebugOutput debug if iashome null ejbc setIasHomeDir iashome try ejbc execute catch IOException String msg getMessage throw new BuildException msg getLocation catch SAXException String msg getMessage throw new BuildException msg getLocation catch IPlanetEjbc EjbcException String msg getMessage throw new BuildException msg getLocation private Path getClasspath Path cp null if classpath null cp new Path getProject concatSystemClasspath else cp classpath concatSystemClasspath return cp public class JavaCC extends Task private static final String LOOKAHEAD private static final String CHOICE_AMBIGUITY_CHECK private static final String OTHER_AMBIGUITY_CHECK private static final String STATIC private static final String DEBUG_PARSER private static final String DEBUG_LOOKAHEAD private static final String DEBUG_TOKEN_MANAGER private static final String OPTIMIZE_TOKEN_MANAGER private static final String ERROR_REPORTING private static final String JAVA_UNICODE_ESCAPE private static final String UNICODE_INPUT private static final String IGNORE_CASE private static final String COMMON_TOKEN_ACTION private static final String USER_TOKEN_MANAGER private static final String USER_CHAR_STREAM private static final String BUILD_PARSER private static final String BUILD_TOKEN_MANAGER private static final String SANITY_CHECK private static final String FORCE_LA_CHECK private static final String CACHE_TOKENS private static final String KEEP_LINE_COLUMN private static final String JDK_VERSION private final Hashtable optionalAttrs new Hashtable private File outputDirectory null private File targetFile null private File javaccHome null private CommandlineJava cmdl new CommandlineJava protected static final int TASKDEF_TYPE_JAVACC protected static final int TASKDEF_TYPE_JJTREE protected static final int TASKDEF_TYPE_JJDOC protected static final String ARCHIVE_LOCATIONS new String protected static final int ARCHIVE_LOCATIONS_VS_MAJOR_VERSION new int protected static final String COM_PACKAGE protected static final String COM_JAVACC_CLASS protected static final String COM_JJTREE_CLASS protected static final String COM_JJDOC_CLASS protected static final String ORG_PACKAGE_3_0 protected static final String ORG_PACKAGE_3_1 protected static final String ORG_JAVACC_CLASS protected static final String ORG_JJTREE_CLASS COM_JJTREE_CLASS protected static final String ORG_JJDOC_CLASS COM_JJDOC_CLASS public void setLookahead int lookahead optionalAttrs put LOOKAHEAD new Integer lookahead public void setChoiceambiguitycheck int choiceAmbiguityCheck optionalAttrs put CHOICE_AMBIGUITY_CHECK new Integer choiceAmbiguityCheck public void setOtherambiguityCheck int otherAmbiguityCheck optionalAttrs put OTHER_AMBIGUITY_CHECK new Integer otherAmbiguityCheck public void setStatic boolean staticParser optionalAttrs put STATIC staticParser Boolean TRUE Boolean FALSE public void setDebugparser boolean debugParser optionalAttrs put DEBUG_PARSER debugParser Boolean TRUE Boolean FALSE public void setDebuglookahead boolean debugLookahead optionalAttrs put DEBUG_LOOKAHEAD debugLookahead Boolean TRUE Boolean FALSE public void setDebugtokenmanager boolean debugTokenManager optionalAttrs put DEBUG_TOKEN_MANAGER debugTokenManager Boolean TRUE Boolean FALSE public void setOptimizetokenmanager boolean optimizeTokenManager optionalAttrs put OPTIMIZE_TOKEN_MANAGER optimizeTokenManager Boolean TRUE Boolean FALSE public void setErrorreporting boolean errorReporting optionalAttrs put ERROR_REPORTING errorReporting Boolean TRUE Boolean FALSE public void setJavaunicodeescape boolean javaUnicodeEscape optionalAttrs put JAVA_UNICODE_ESCAPE javaUnicodeEscape Boolean TRUE Boolean FALSE public void setUnicodeinput boolean unicodeInput optionalAttrs put UNICODE_INPUT unicodeInput Boolean TRUE Boolean FALSE public void setIgnorecase boolean ignoreCase optionalAttrs put IGNORE_CASE ignoreCase Boolean TRUE Boolean FALSE public void setCommontokenaction boolean commonTokenAction optionalAttrs put COMMON_TOKEN_ACTION commonTokenAction Boolean TRUE Boolean FALSE public void setUsertokenmanager boolean userTokenManager optionalAttrs put USER_TOKEN_MANAGER userTokenManager Boolean TRUE Boolean FALSE public void setUsercharstream boolean userCharStream optionalAttrs put USER_CHAR_STREAM userCharStream Boolean TRUE Boolean FALSE public void setBuildparser boolean buildParser optionalAttrs put BUILD_PARSER buildParser Boolean TRUE Boolean FALSE public void setBuildtokenmanager boolean buildTokenManager optionalAttrs put BUILD_TOKEN_MANAGER buildTokenManager Boolean TRUE Boolean FALSE public void setSanitycheck boolean sanityCheck optionalAttrs put SANITY_CHECK sanityCheck Boolean TRUE Boolean FALSE public void setForcelacheck boolean forceLACheck optionalAttrs put FORCE_LA_CHECK forceLACheck Boolean TRUE Boolean FALSE public void setCachetokens boolean cacheTokens optionalAttrs put CACHE_TOKENS cacheTokens Boolean TRUE Boolean FALSE public void setKeeplinecolumn boolean keepLineColumn optionalAttrs put KEEP_LINE_COLUMN keepLineColumn Boolean TRUE Boolean FALSE public void setJDKversion String jdkVersion optionalAttrs put JDK_VERSION jdkVersion public void setOutputdirectory File outputDirectory this outputDirectory outputDirectory public void setTarget File targetFile this targetFile targetFile public void setJavacchome File javaccHome this javaccHome javaccHome public JavaCC cmdl setVm JavaEnvUtils getJreExecutable public void execute throws BuildException Enumeration iter optionalAttrs keys while iter hasMoreElements String name String iter nextElement Object value optionalAttrs get name cmdl createArgument setValue name value toString if targetFile null targetFile isFile throw new BuildException targetFile if outputDirectory null outputDirectory new File targetFile getParent else if outputDirectory isDirectory throw new BuildException cmdl createArgument setValue outputDirectory getAbsolutePath final File javaFile getOutputJavaFile outputDirectory targetFile if javaFile exists targetFile lastModified javaFile lastModified log targetFile Project MSG_VERBOSE return cmdl createArgument setValue targetFile getAbsolutePath final Path classpath cmdl createClasspath getProject final File javaccJar JavaCC getArchiveFile javaccHome classpath createPathElement setPath javaccJar getAbsolutePath classpath addJavaRuntime cmdl setClassname JavaCC getMainClass classpath JavaCC TASKDEF_TYPE_JAVACC final Commandline Argument arg cmdl createVmArgument arg setValue arg setValue javaccHome getAbsolutePath Execute runCommand this cmdl getCommandline protected static File getArchiveFile File home throws BuildException return new File home ARCHIVE_LOCATIONS getArchiveLocationIndex home protected static String getMainClass File home int type throws BuildException Path new Path null createPathElement setLocation getArchiveFile home addJavaRuntime return getMainClass type protected static String getMainClass Path path int type throws BuildException String mainClass null AntClassLoader new AntClassLoader setClassPath path concatSystemClasspath String javaccClass COM_PACKAGE COM_JAVACC_CLASS InputStream is getResourceAsStream javaccClass replace if is null switch type case TASKDEF_TYPE_JAVACC mainClass COM_JAVACC_CLASS break case TASKDEF_TYPE_JJTREE mainClass COM_JJTREE_CLASS break case TASKDEF_TYPE_JJDOC mainClass COM_JJDOC_CLASS break default else javaccClass ORG_PACKAGE_3_1 ORG_JAVACC_CLASS is getResourceAsStream javaccClass replace if is null else javaccClass ORG_PACKAGE_3_0 ORG_JAVACC_CLASS is getResourceAsStream javaccClass replace if is null if is null switch type case TASKDEF_TYPE_JAVACC mainClass ORG_JAVACC_CLASS break case TASKDEF_TYPE_JJTREE mainClass ORG_JJTREE_CLASS break case TASKDEF_TYPE_JJDOC mainClass ORG_JJDOC_CLASS break default throw new BuildException if mainClass null throw new BuildException type private static int getArchiveLocationIndex File home throws BuildException if home null home isDirectory throw new BuildException for int ARCHIVE_LOCATIONS length File new File home ARCHIVE_LOCATIONS if exists return throw new BuildException home protected static int getMajorVersionNumber File home throws BuildException return ARCHIVE_LOCATIONS_VS_MAJOR_VERSION getArchiveLocationIndex home private File getOutputJavaFile File outputdir File srcfile String path srcfile getPath int startBasename path lastIndexOf File separator if startBasename path path substring startBasename int startExtn path lastIndexOf if startExtn path path substring startExtn else path if outputdir null path outputdir File separator path return new File path public class ConcatResourceInputStream extends InputStream private static final int EOF private boolean eof false private Iterator iter private InputStream currentStream private ProjectComponent managingPc private boolean ignoreErrors false public ConcatResourceInputStream ResourceCollection rc iter rc iterator public void setIgnoreErrors boolean ignoreErrors public boolean isIgnoreErrors return ignoreErrors public void close throws IOException closeCurrent eof true public int read throws IOException if eof return EOF int result readCurrent if result EOF nextResource result readCurrent return result public void setManagingComponent ProjectComponent pc this managingPc pc public void log String message int loglevel if managingPc null managingPc log message loglevel else loglevel Project MSG_WARN System out System err println message private int readCurrent throws IOException return eof currentStream null EOF currentStream read private void nextResource throws IOException closeCurrent while iter hasNext Resource Resource iter next if isExists continue log toLongString Project MSG_VERBOSE try currentStream new BufferedInputStream getInputStream return catch IOException eyeOhEx if ignoreErrors log Project MSG_ERR throw eyeOhEx eof true private void closeCurrent FileUtils close currentStream currentStream null public class EqualComparator implements Comparator public int compare Object o1 Object o2 if o1 null if o2 null return return return o1 equals o2 public String toString return public class IsFalse extends ProjectComponent implements Condition private Boolean value null public void setValue boolean value this value value Boolean TRUE Boolean FALSE public boolean eval throws BuildException if value null throw new BuildException return value booleanValue public class RecorderEntry implements BuildLogger SubBuildListener private String filename null private boolean record true private int loglevel Project MSG_INFO private PrintStream out null private long targetStartTime private boolean emacsMode false private Project project protected RecorderEntry String name targetStartTime System currentTimeMillis filename name public String getFilename return filename public void setRecordState Boolean state if state null flush record state booleanValue public void buildStarted BuildEvent event log Project MSG_DEBUG public void buildFinished BuildEvent event log Project MSG_DEBUG if record out null Throwable error event getException if error null out println StringUtils LINE_SEP else out println StringUtils LINE_SEP StringUtils LINE_SEP error printStackTrace out cleanup public void subBuildFinished BuildEvent event if event getProject project cleanup public void subBuildStarted BuildEvent event public void targetStarted BuildEvent event log event getTarget Project MSG_DEBUG log StringUtils LINE_SEP event getTarget getName Project MSG_INFO targetStartTime System currentTimeMillis public void targetFinished BuildEvent event log event getTarget Project MSG_DEBUG String time formatTime System currentTimeMillis targetStartTime log event getTarget time Project MSG_VERBOSE flush public void taskStarted BuildEvent event log event getTask Project MSG_DEBUG public void taskFinished BuildEvent event log event getTask Project MSG_DEBUG flush public void messageLogged BuildEvent event log Project MSG_DEBUG StringBuffer buf new StringBuffer if event getTask null String name event getTask getTaskName if emacsMode String label name int size DefaultLogger LEFT_COLUMN_SIZE label length for int size buf append buf append label buf append event getMessage log buf toString event getPriority private void log String mesg int level if record level loglevel out null out println mesg private void flush if record out null out flush public void setMessageOutputLevel int level if level Project MSG_ERR level Project MSG_DEBUG loglevel level public void setOutputPrintStream PrintStream output closeFile out output public void setEmacsMode boolean emacsMode this emacsMode emacsMode public void setErrorPrintStream PrintStream err setOutputPrintStream err private static String formatTime long millis long seconds millis long minutes seconds if minutes return Long toString minutes minutes Long toString seconds seconds else return Long toString seconds seconds public void setProject Project project this project project if project null project addBuildListener this public void cleanup closeFile if project null project removeBuildListener this project null void openFile boolean append throws BuildException openFileImpl append void closeFile if out null out close out null void reopenFile throws BuildException openFileImpl true private void openFileImpl boolean append throws BuildException if out null try out new PrintStream new FileOutputStream filename append catch IOException ioe throw new BuildException ioe public class DispatchUtils public static final void execute Object task throws BuildException String methodName Dispatchable dispatchable null try if task instanceof Dispatchable dispatchable Dispatchable task else if task instanceof UnknownElement UnknownElement ue UnknownElement task Object realThing ue getRealThing if realThing null realThing instanceof Dispatchable realThing instanceof Task dispatchable Dispatchable realThing if dispatchable null String mName null try final String name dispatchable getActionParameterName if name null name trim length mName name trim substring toUpperCase if name length mName name substring final Class dispatchable getClass final Method actionM getMethod mName new Class if actionM null final Object actionM invoke dispatchable Object null if null final String toString if null trim length methodName trim Method executeM null executeM dispatchable getClass getMethod methodName new Class if executeM null throw new BuildException methodName dispatchable getClass executeM invoke dispatchable Object null if task instanceof UnknownElement UnknownElement task setRealThing null else throw new BuildException name trim else throw new BuildException name trim else throw new BuildException catch NoSuchMethodException nsme throw new BuildException mName task getClass else Method executeM null executeM task getClass getMethod methodName new Class if executeM null throw new BuildException methodName task getClass executeM invoke task Object null if task instanceof UnknownElement UnknownElement task setRealThing null catch InvocationTargetException ie Throwable ie getTargetException if instanceof BuildException throw BuildException else throw new BuildException catch NoSuchMethodException throw new BuildException catch IllegalAccessException throw new BuildException public interface Regexp extends RegexpMatcher int REPLACE_FIRST int REPLACE_ALL String substitute String input String argument int options throws BuildException public class SOSLabel extends SOS public void setVersion String version super setInternalVersion version public void setLabel String label super setInternalLabel label public void setComment String comment super setInternalComment comment protected Commandline buildCmdLine commandLine new Commandline commandLine createArgument setValue SOSCmd FLAG_COMMAND commandLine createArgument setValue SOSCmd COMMAND_LABEL getRequiredAttributes if getLabel null throw new BuildException getLocation commandLine createArgument setValue SOSCmd FLAG_LABEL commandLine createArgument setValue getLabel commandLine createArgument setValue getVerbose if getComment null commandLine createArgument setValue SOSCmd FLAG_COMMENT commandLine createArgument setValue getComment return commandLine public class Manifest public static final String ATTRIBUTE_MANIFEST_VERSION public static final String ATTRIBUTE_SIGNATURE_VERSION public static final String ATTRIBUTE_NAME public static final String ATTRIBUTE_FROM public static final String ATTRIBUTE_CLASSPATH public static final String DEFAULT_MANIFEST_VERSION public static final int MAX_LINE_LENGTH public static final int MAX_SECTION_LENGTH MAX_LINE_LENGTH public static final String EOL public static final String ERROR_FROM_FORBIDDEN ATTRIBUTE_FROM public static final String JAR_ENCODING public static class Attribute private static final int MAX_NAME_VALUE_LENGTH private static final int MAX_NAME_LENGTH private String name null private Vector values new Vector private int currentIndex public Attribute public Attribute String line throws ManifestException parse line public Attribute String name String value this name name setValue value public int hashCode int hashCode if name null hashCode getKey hashCode hashCode values hashCode return hashCode public boolean equals Object rhs if rhs null rhs getClass getClass return false if rhs this return true Attribute rhsAttribute Attribute rhs String lhsKey getKey String rhsKey rhsAttribute getKey if lhsKey null rhsKey null lhsKey null rhsKey null lhsKey equals rhsKey return false return values equals rhsAttribute values public void parse String line throws ManifestException int index line indexOf if index throw new ManifestException line name line substring index setValue line substring index public void setName String name this name name public String getName return name public String getKey if name null return null return name toLowerCase public void setValue String value if currentIndex values size values addElement value currentIndex values size else values setElementAt value currentIndex public String getValue if values size return null String fullValue for Enumeration getValues hasMoreElements String value String nextElement fullValue value return fullValue trim public void addValue String value currentIndex setValue value public Enumeration getValues return values elements public void addContinuation String line String currentValue String values elementAt currentIndex setValue currentValue line substring public void write PrintWriter writer throws IOException for Enumeration getValues hasMoreElements writeValue writer String nextElement private void writeValue PrintWriter writer String value throws IOException String line null int nameLength name getBytes JAR_ENCODING length if nameLength MAX_NAME_VALUE_LENGTH if nameLength MAX_NAME_LENGTH throw new IOException name value writer print name EOL line value else line name value while line getBytes JAR_ENCODING length MAX_SECTION_LENGTH int breakIndex MAX_SECTION_LENGTH if breakIndex line length breakIndex line length String section line substring breakIndex while section getBytes JAR_ENCODING length MAX_SECTION_LENGTH breakIndex breakIndex section line substring breakIndex if breakIndex throw new IOException name value writer print section EOL line line substring breakIndex writer print line EOL public static class Section private Vector warnings new Vector private String name null private Hashtable attributes new Hashtable private Vector attributeIndex new Vector public void setName String name this name name public String getName return name public String read BufferedReader reader throws ManifestException IOException Attribute attribute null while true String line reader readLine if line null line length return null if line charAt if attribute null if name null name line substring else throw new ManifestException line else attribute addContinuation line else attribute new Attribute line String nameReadAhead addAttributeAndCheck attribute attribute getAttribute attribute getKey if nameReadAhead null return nameReadAhead public void merge Section section throws ManifestException if name null section getName null name null name equalsIgnoreCase section getName throw new ManifestException Enumeration section getAttributeKeys Attribute classpathAttribute null while hasMoreElements String attributeName String nextElement Attribute attribute section getAttribute attributeName if attributeName equalsIgnoreCase ATTRIBUTE_CLASSPATH if classpathAttribute null classpathAttribute new Attribute classpathAttribute setName ATTRIBUTE_CLASSPATH Enumeration cpe attribute getValues while cpe hasMoreElements String value String cpe nextElement classpathAttribute addValue value else storeAttribute attribute if classpathAttribute null storeAttribute classpathAttribute Enumeration warnEnum section warnings elements while warnEnum hasMoreElements warnings addElement warnEnum nextElement public void write PrintWriter writer throws IOException if name null Attribute nameAttr new Attribute ATTRIBUTE_NAME name nameAttr write writer Enumeration getAttributeKeys while hasMoreElements String key String nextElement Attribute attribute getAttribute key attribute write writer writer print EOL public Attribute getAttribute String attributeName return Attribute attributes get attributeName toLowerCase public Enumeration getAttributeKeys return attributeIndex elements public String getAttributeValue String attributeName Attribute attribute getAttribute attributeName toLowerCase if attribute null return null return attribute getValue public void removeAttribute String attributeName String key attributeName toLowerCase attributes remove key attributeIndex removeElement key public void addConfiguredAttribute Attribute attribute throws ManifestException String check addAttributeAndCheck attribute if check null throw new BuildException public String addAttributeAndCheck Attribute attribute throws ManifestException if attribute getName null attribute getValue null throw new BuildException if attribute getKey equalsIgnoreCase ATTRIBUTE_NAME warnings addElement ATTRIBUTE_NAME attribute getName attribute getValue return attribute getValue if attribute getKey startsWith ATTRIBUTE_FROM toLowerCase warnings addElement ERROR_FROM_FORBIDDEN attribute getName attribute getValue else String attributeKey attribute getKey if attributeKey equalsIgnoreCase ATTRIBUTE_CLASSPATH Attribute classpathAttribute Attribute attributes get attributeKey if classpathAttribute null storeAttribute attribute else warnings addElement Enumeration attribute getValues while hasMoreElements String value String nextElement classpathAttribute addValue value else if attributes containsKey attributeKey throw new ManifestException attribute getName else storeAttribute attribute return null public Object clone Section cloned new Section cloned setName name Enumeration getAttributeKeys while hasMoreElements String key String nextElement Attribute attribute getAttribute key cloned storeAttribute new Attribute attribute getName attribute getValue return cloned private void storeAttribute Attribute attribute if attribute null return String attributeKey attribute getKey attributes put attributeKey attribute if attributeIndex contains attributeKey attributeIndex addElement attributeKey public Enumeration getWarnings return warnings elements public int hashCode return attributes hashCode public boolean equals Object rhs if rhs null rhs getClass getClass return false if rhs this return true Section rhsSection Section rhs return attributes equals rhsSection attributes private String manifestVersion DEFAULT_MANIFEST_VERSION private Section mainSection new Section private Hashtable sections new Hashtable private Vector sectionIndex new Vector public static Manifest getDefaultManifest throws BuildException InputStream in null InputStreamReader insr null try String defManifest in Manifest class getResourceAsStream defManifest if in null throw new BuildException defManifest try insr new InputStreamReader in Manifest defaultManifest new Manifest insr Attribute createdBy new Attribute System getProperty System getProperty defaultManifest getMainSection storeAttribute createdBy return defaultManifest catch UnsupportedEncodingException insr new InputStreamReader in return new Manifest insr catch ManifestException throw new BuildException catch IOException throw new BuildException finally FileUtils close insr FileUtils close in public Manifest manifestVersion null public Manifest Reader throws ManifestException IOException BufferedReader reader new BufferedReader String nextSectionName mainSection read reader String readManifestVersion mainSection getAttributeValue ATTRIBUTE_MANIFEST_VERSION if readManifestVersion null manifestVersion readManifestVersion mainSection removeAttribute ATTRIBUTE_MANIFEST_VERSION String line null while line reader readLine null if line length continue Section section new Section if nextSectionName null Attribute sectionName new Attribute line if sectionName getName equalsIgnoreCase ATTRIBUTE_NAME throw new ManifestException ATTRIBUTE_NAME sectionName getName nextSectionName sectionName getValue else Attribute firstAttribute new Attribute line section addAttributeAndCheck firstAttribute section setName nextSectionName nextSectionName section read reader addConfiguredSection section public void addConfiguredSection Section section throws ManifestException String sectionName section getName if sectionName null throw new BuildException sections put sectionName section if sectionIndex contains sectionName sectionIndex addElement sectionName public void addConfiguredAttribute Attribute attribute throws ManifestException if attribute getKey null attribute getValue null throw new BuildException if attribute getKey equalsIgnoreCase ATTRIBUTE_MANIFEST_VERSION manifestVersion attribute getValue else mainSection addConfiguredAttribute attribute public void merge Manifest other throws ManifestException merge other false public void merge Manifest other boolean overwriteMain throws ManifestException if other null if overwriteMain mainSection Section other mainSection clone else mainSection merge other mainSection if other manifestVersion null manifestVersion other manifestVersion Enumeration other getSectionNames while hasMoreElements String sectionName String nextElement Section ourSection Section sections get sectionName Section otherSection Section other sections get sectionName if ourSection null if otherSection null addConfiguredSection Section otherSection clone else ourSection merge otherSection public void write PrintWriter writer throws IOException writer print ATTRIBUTE_MANIFEST_VERSION manifestVersion EOL String signatureVersion mainSection getAttributeValue ATTRIBUTE_SIGNATURE_VERSION if signatureVersion null writer print ATTRIBUTE_SIGNATURE_VERSION signatureVersion EOL mainSection removeAttribute ATTRIBUTE_SIGNATURE_VERSION mainSection write writer if signatureVersion null try Attribute svAttr new Attribute ATTRIBUTE_SIGNATURE_VERSION signatureVersion mainSection addConfiguredAttribute svAttr catch ManifestException Enumeration sectionIndex elements while hasMoreElements String sectionName String nextElement Section section getSection sectionName section write writer public String toString StringWriter sw new StringWriter try write new PrintWriter sw catch IOException return null return sw toString public Enumeration getWarnings Vector warnings new Vector Enumeration warnEnum mainSection getWarnings while warnEnum hasMoreElements warnings addElement warnEnum nextElement Enumeration sections elements while hasMoreElements Section section Section nextElement Enumeration e2 section getWarnings while e2 hasMoreElements warnings addElement e2 nextElement return warnings elements public int hashCode int hashCode if manifestVersion null hashCode manifestVersion hashCode hashCode mainSection hashCode hashCode sections hashCode return hashCode public boolean equals Object rhs if rhs null rhs getClass getClass return false if rhs this return true Manifest rhsManifest Manifest rhs if manifestVersion null if rhsManifest manifestVersion null return false else if manifestVersion equals rhsManifest manifestVersion return false if mainSection equals rhsManifest mainSection return false return sections equals rhsManifest sections public String getManifestVersion return manifestVersion public Section getMainSection return mainSection public Section getSection String name return Section sections get name public Enumeration getSectionNames return sectionIndex elements public class Exists implements ResourceSelector public boolean isSelected Resource return isExists public class EjbJar extends MatchingTask public static class DTDLocation extends org apache tools ant types DTDLocation static class Config public File srcDir public File descriptorDir public String baseNameTerminator public String baseJarName public boolean flatDestDir false public Path classpath public List supportFileSets new ArrayList public ArrayList dtdLocations new ArrayList public NamingScheme namingScheme public File manifest public String analyzer public static class NamingScheme extends EnumeratedAttribute public static final String EJB_NAME public static final String DIRECTORY public static final String DESCRIPTOR public static final String BASEJARNAME public String getValues return new String EJB_NAME DIRECTORY DESCRIPTOR BASEJARNAME public static class CMPVersion extends EnumeratedAttribute public static final String CMP1_0 public static final String CMP2_0 public String getValues return new String CMP1_0 CMP2_0 private Config config new Config private File destDir private String genericJarSuffix private String cmpVersion CMPVersion CMP1_0 private ArrayList deploymentTools new ArrayList protected void addDeploymentTool EJBDeploymentTool deploymentTool deploymentTool setTask this deploymentTools add deploymentTool public WeblogicDeploymentTool createWeblogic WeblogicDeploymentTool tool new WeblogicDeploymentTool addDeploymentTool tool return tool public WebsphereDeploymentTool createWebsphere WebsphereDeploymentTool tool new WebsphereDeploymentTool addDeploymentTool tool return tool public BorlandDeploymentTool createBorland log Project MSG_VERBOSE BorlandDeploymentTool tool new BorlandDeploymentTool tool setTask this deploymentTools add tool return tool public IPlanetDeploymentTool createIplanet log Project MSG_VERBOSE IPlanetDeploymentTool tool new IPlanetDeploymentTool addDeploymentTool tool return tool public JbossDeploymentTool createJboss JbossDeploymentTool tool new JbossDeploymentTool addDeploymentTool tool return tool public JonasDeploymentTool createJonas log Project MSG_VERBOSE JonasDeploymentTool tool new JonasDeploymentTool addDeploymentTool tool return tool public WeblogicTOPLinkDeploymentTool createWeblogictoplink log Project MSG_INFO WeblogicTOPLinkDeploymentTool tool new WeblogicTOPLinkDeploymentTool addDeploymentTool tool return tool public Path createClasspath if config classpath null config classpath new Path getProject return config classpath createPath public DTDLocation createDTD DTDLocation dtdLocation new DTDLocation config dtdLocations add dtdLocation return dtdLocation public FileSet createSupport FileSet supportFileSet new FileSet config supportFileSets add supportFileSet return supportFileSet public void setManifest File manifest config manifest manifest public void setSrcdir File inDir config srcDir inDir public void setDescriptordir File inDir config descriptorDir inDir public void setDependency String analyzer config analyzer analyzer public void setBasejarname String inValue config baseJarName inValue if config namingScheme null config namingScheme new NamingScheme config namingScheme setValue NamingScheme BASEJARNAME else if config namingScheme getValue equals NamingScheme BASEJARNAME throw new BuildException config namingScheme getValue public void setNaming NamingScheme namingScheme config namingScheme namingScheme if config namingScheme getValue equals NamingScheme BASEJARNAME config baseJarName null throw new BuildException config namingScheme getValue public File getDestdir return this destDir public void setDestdir File inDir this destDir inDir public String getCmpversion return this cmpVersion public void setCmpversion CMPVersion version this cmpVersion version getValue public void setClasspath Path classpath config classpath classpath public void setFlatdestdir boolean inValue config flatDestDir inValue public void setGenericjarsuffix String inString this genericJarSuffix inString public void setBasenameterminator String inValue config baseNameTerminator inValue private void validateConfig throws BuildException if config srcDir null throw new BuildException if config descriptorDir null config descriptorDir config srcDir if config namingScheme null config namingScheme new NamingScheme config namingScheme setValue NamingScheme DESCRIPTOR else if config namingScheme getValue equals NamingScheme BASEJARNAME config baseJarName null throw new BuildException public void execute throws BuildException validateConfig if deploymentTools size GenericDeploymentTool genericTool new GenericDeploymentTool genericTool setTask this genericTool setDestdir destDir genericTool setGenericJarSuffix genericJarSuffix deploymentTools add genericTool for Iterator deploymentTools iterator hasNext EJBDeploymentTool tool EJBDeploymentTool next tool configure config tool validateConfigured try SAXParserFactory saxParserFactory SAXParserFactory newInstance saxParserFactory setValidating true SAXParser saxParser saxParserFactory newSAXParser DirectoryScanner ds getDirectoryScanner config descriptorDir ds scan String files ds getIncludedFiles log files length Project MSG_VERBOSE for int index index files length index for Iterator deploymentTools iterator hasNext EJBDeploymentTool tool EJBDeploymentTool next tool processDescriptor files index saxParser catch SAXException se String msg se getMessage throw new BuildException msg se catch ParserConfigurationException pce String msg pce getMessage throw new BuildException msg pce public class JDependTask extends Task private File outputFile private File dir private Path compileClasspath private boolean haltonerror false private boolean fork false private Long timeout null private String jvm null private String format private PatternSet defaultPatterns new PatternSet private static Method setFilter private boolean includeRuntime false private Path runtimeClasses null static try Class forName setFilter jdepend textui JDepend class getDeclaredMethod catch Throwable if setFilter null public void setIncluderuntime boolean includeRuntime public void setTimeout Long value timeout value public Long getTimeout return timeout public void setOutputFile File outputFile this outputFile outputFile public File getOutputFile return outputFile public void setHaltonerror boolean haltonerror this haltonerror haltonerror public boolean getHaltonerror return haltonerror public void setFork boolean value fork value public boolean getFork return fork public void setJvm String value jvm value public Path createSourcespath if sourcesPath null sourcesPath new Path getProject return sourcesPath createPath public Path getSourcespath return sourcesPath public Path createClassespath if classesPath null classesPath new Path getProject return classesPath createPath public Path getClassespath return classesPath public void setDir File dir this dir dir public File getDir return dir public void setClasspath Path classpath if compileClasspath null compileClasspath classpath else compileClasspath append classpath public Path getClasspath return compileClasspath public Path createClasspath if compileClasspath null compileClasspath new Path getProject return compileClasspath createPath public Commandline Argument createJvmarg CommandlineJava commandline return commandline createVmArgument public void setClasspathRef Reference createClasspath setRefid public PatternSet NameEntry createExclude return defaultPatterns createExclude public PatternSet getExcludes return defaultPatterns public void setFormat FormatAttribute ea format ea getValue public static class FormatAttribute extends EnumeratedAttribute private String formats new String public String getValues return formats private static final int SUCCESS private static final int ERRORS private void addClasspathEntry String resource if resource startsWith resource resource substring else resource resource File LoaderUtils getResourceSource getClass getClassLoader resource if null log getAbsolutePath Project MSG_DEBUG runtimeClasses createPath setLocation else log resource Project MSG_DEBUG public void execute throws BuildException CommandlineJava commandline new CommandlineJava if equals format commandline setClassname else if equals format commandline setClassname if jvm null commandline setVm jvm if getSourcespath null getClassespath null throw new BuildException else if getClassespath null String msg log msg int exitValue JDependTask ERRORS boolean wasKilled false if getFork exitValue executeInVM commandline else ExecuteWatchdog watchdog createWatchdog exitValue executeAsForked commandline watchdog if watchdog null wasKilled watchdog killedProcess boolean errorOccurred exitValue JDependTask ERRORS wasKilled if errorOccurred String errorMessage wasKilled if getHaltonerror throw new BuildException errorMessage getLocation else log errorMessage Project MSG_ERR public int executeInVM CommandlineJava commandline throws BuildException jdepend textui JDepend jdepend if equals format jdepend new jdepend xmlui JDepend else jdepend new jdepend textui JDepend FileWriter fw null if getOutputFile null try fw new FileWriter getOutputFile getPath catch IOException String msg getMessage log msg throw new BuildException msg jdepend setWriter new PrintWriter fw log getOutputFile getPath try if getClassespath null String cP getClassespath list for int cP length File new File cP if exists String msg getPath log msg throw new BuildException msg try jdepend addDirectory getPath catch IOException String msg getMessage log msg throw new BuildException msg else if getSourcespath null String sP getSourcespath list for int sP length File new File sP if exists isDirectory String msg getPath log msg throw new BuildException msg try jdepend addDirectory getPath catch IOException String msg getMessage log msg throw new BuildException msg String patterns defaultPatterns getExcludePatterns getProject if patterns null patterns length if setFilter null Vector new Vector for int patterns length addElement patterns try setFilter invoke jdepend new Object catch Throwable log getMessage Project MSG_WARN else log Project MSG_WARN jdepend analyze finally FileUtils close fw return SUCCESS public int executeAsForked CommandlineJava commandline ExecuteWatchdog watchdog throws BuildException runtimeClasses new Path getProject addClasspathEntry createClasspath if getClasspath toString length createJvmarg commandline setValue createJvmarg commandline setValue getClasspath toString if includeRuntime Vector Execute getProcEnvironment Enumeration elements while hasMoreElements String String nextElement if startsWith commandline createClasspath getProject createPath append new Path getProject substring length log runtimeClasses Project MSG_VERBOSE commandline createClasspath getProject createPath append runtimeClasses if getOutputFile null commandline createArgument setValue commandline createArgument setValue outputFile getPath if getSourcespath null String sP getSourcespath list for int sP length File new File sP if exists isDirectory throw new BuildException getPath commandline createArgument setValue getPath if getClassespath null String cP getClassespath list for int cP length File new File cP if exists throw new BuildException getPath commandline createArgument setValue getPath Execute execute new Execute new LogStreamHandler this Project MSG_INFO Project MSG_WARN watchdog execute setCommandline commandline getCommandline if getDir null execute setWorkingDirectory getDir execute setAntRun getProject if getOutputFile null log getOutputFile getPath log commandline describeCommand Project MSG_VERBOSE try return execute execute catch IOException throw new BuildException getLocation protected ExecuteWatchdog createWatchdog throws BuildException if getTimeout null return null return new ExecuteWatchdog getTimeout longValue public class CBZip2InputStream extends InputStream implements BZip2Constants private static void reportCRCError throws IOException System err println private void makeMaps final boolean inUse this data inUse final byte seqToUnseq this data seqToUnseq int nInUseShadow for int if inUse seqToUnseq nInUseShadow byte this nInUse nInUseShadow private int last private int origPtr private int blockSize100k private boolean blockRandomised private int bsBuff private int bsLive private final CRC crc new CRC private int nInUse private InputStream in private int currentChar private static final int EOF private static final int START_BLOCK_STATE private static final int RAND_PART_A_STATE private static final int RAND_PART_B_STATE private static final int RAND_PART_C_STATE private static final int NO_RAND_PART_A_STATE private static final int NO_RAND_PART_B_STATE private static final int NO_RAND_PART_C_STATE private int currentState START_BLOCK_STATE private int storedBlockCRC storedCombinedCRC private int computedBlockCRC computedCombinedCRC private int su_count private int su_ch2 private int su_chPrev private int su_i2 private int su_j2 private int su_rNToGo private int su_rTPos private int su_tPos private char su_z private CBZip2InputStream Data data public CBZip2InputStream final InputStream in throws IOException super this in in init public int read throws IOException if this in null return read0 else throw new IOException public int read final byte dest final int offs final int len throws IOException if offs throw new IndexOutOfBoundsException offs if len throw new IndexOutOfBoundsException len if offs len dest length throw new IndexOutOfBoundsException offs len dest length if this in null throw new IOException final int hi offs len int destOffs offs for int destOffs hi read0 dest destOffs byte return destOffs offs destOffs offs private int read0 throws IOException final int retChar this currentChar switch this currentState case EOF return case START_BLOCK_STATE throw new IllegalStateException case RAND_PART_A_STATE throw new IllegalStateException case RAND_PART_B_STATE setupRandPartB break case RAND_PART_C_STATE setupRandPartC break case NO_RAND_PART_A_STATE throw new IllegalStateException case NO_RAND_PART_B_STATE setupNoRandPartB break case NO_RAND_PART_C_STATE setupNoRandPartC break default throw new IllegalStateException return retChar private void init throws IOException int magic2 this in read if magic2 throw new IOException char magic2 int blockSize this in read if blockSize blockSize throw new IOException char blockSize this blockSize100k blockSize initBlock setupBlock private void initBlock throws IOException char magic0 bsGetUByte char magic1 bsGetUByte char magic2 bsGetUByte char magic3 bsGetUByte char magic4 bsGetUByte char magic5 bsGetUByte if magic0 magic1 magic2 magic3 magic4 magic5 this currentState EOF throw new IOException else this storedBlockCRC bsGetInt this blockRandomised bsR if this data null this data new Data this blockSize100k getAndMoveToFrontDecode this crc initialiseCRC this currentState START_BLOCK_STATE private void endBlock throws IOException this computedBlockCRC this crc getFinalCRC if this storedBlockCRC this computedBlockCRC this computedCombinedCRC this storedCombinedCRC this storedCombinedCRC this computedCombinedCRC this storedBlockCRC reportCRCError this computedCombinedCRC this computedCombinedCRC this computedCombinedCRC this computedCombinedCRC this computedBlockCRC private void complete throws IOException this storedCombinedCRC bsGetInt this currentState EOF this data null if this storedCombinedCRC this computedCombinedCRC reportCRCError public void close throws IOException InputStream inShadow this in if inShadow null try if inShadow System in inShadow close finally this data null this in null private int bsR final int throws IOException int bsLiveShadow this bsLive int bsBuffShadow this bsBuff if bsLiveShadow final InputStream inShadow this in do int thech inShadow read if thech throw new IOException bsBuffShadow bsBuffShadow thech bsLiveShadow while bsLiveShadow this bsBuff bsBuffShadow this bsLive bsLiveShadow return bsBuffShadow bsLiveShadow private boolean bsGetBit throws IOException int bsLiveShadow this bsLive int bsBuffShadow this bsBuff if bsLiveShadow int thech this in read if thech throw new IOException bsBuffShadow bsBuffShadow thech bsLiveShadow this bsBuff bsBuffShadow this bsLive bsLiveShadow return bsBuffShadow bsLiveShadow private char bsGetUByte throws IOException return char bsR private int bsGetInt throws IOException return bsR bsR bsR bsR private static void hbCreateDecodeTables final int limit final int base final int perm final char length final int minLen final int maxLen final int alphaSize for int minLen pp maxLen for int alphaSize if length perm pp for int MAX_CODE_LEN base limit for int alphaSize base length for int base MAX_CODE_LEN base base for int minLen vec base maxLen final int nb base vec nb nb limit vec vec for int minLen maxLen base limit base private void recvDecodingTables throws IOException final Data dataShadow this data final boolean inUse dataShadow inUse final byte pos dataShadow recvDecodingTables_pos final byte selector dataShadow selector final byte selectorMtf dataShadow selectorMtf int inUse16 for int if bsGetBit inUse16 for int inUse false for int if inUse16 final int i16 for int if bsGetBit inUse i16 true makeMaps final int alphaSize this nInUse final int nGroups bsR final int nSelectors bsR for int nSelectors int while bsGetBit selectorMtf byte for int nGroups pos byte for int nSelectors int selectorMtf final byte tmp pos while pos pos pos tmp selector tmp final char len dataShadow temp_charArray2d for int nGroups int curr bsR final char len_t len for int alphaSize while bsGetBit curr bsGetBit len_t char curr createHuffmanDecodingTables alphaSize nGroups private void createHuffmanDecodingTables final int alphaSize final int nGroups final Data dataShadow this data final char len dataShadow temp_charArray2d final int minLens dataShadow minLens final int limit dataShadow limit final int base dataShadow base final int perm dataShadow perm for int nGroups int minLen int maxLen final char len_t len for int alphaSize final char lent len_t if lent maxLen maxLen lent if lent minLen minLen lent hbCreateDecodeTables limit base perm len minLen maxLen alphaSize minLens minLen private void getAndMoveToFrontDecode throws IOException this origPtr bsR recvDecodingTables final InputStream inShadow this in final Data dataShadow this data final byte ll8 dataShadow ll8 final int unzftab dataShadow unzftab final byte selector dataShadow selector final byte seqToUnseq dataShadow seqToUnseq final char yy dataShadow getAndMoveToFrontDecode_yy final int minLens dataShadow minLens final int limit dataShadow limit final int base dataShadow base final int perm dataShadow perm final int limitLast this blockSize100k for int yy char unzftab int groupNo int groupPos G_SIZE final int eob this nInUse int nextSym getAndMoveToFrontDecode0 int bsBuffShadow this bsBuff int bsLiveShadow this bsLive int lastShadow int zt selector groupNo int base_zt base zt int limit_zt limit zt int perm_zt perm zt int minLens_zt minLens zt while nextSym eob if nextSym RUNA nextSym RUNB int for int true if nextSym RUNA else if nextSym RUNB else break if groupPos groupPos G_SIZE zt selector groupNo base_zt base zt limit_zt limit zt perm_zt perm zt minLens_zt minLens zt else groupPos int zn minLens_zt while bsLiveShadow zn final int thech inShadow read if thech bsBuffShadow bsBuffShadow thech bsLiveShadow continue else throw new IOException int zvec bsBuffShadow bsLiveShadow zn zn bsLiveShadow zn while zvec limit_zt zn zn while bsLiveShadow final int thech inShadow read if thech bsBuffShadow bsBuffShadow thech bsLiveShadow continue else throw new IOException bsLiveShadow zvec zvec bsBuffShadow bsLiveShadow nextSym perm_zt zvec base_zt zn final byte ch seqToUnseq yy unzftab ch while ll8 lastShadow ch if lastShadow limitLast throw new IOException else if lastShadow limitLast throw new IOException final char tmp yy nextSym unzftab seqToUnseq tmp ll8 lastShadow seqToUnseq tmp if nextSym for int nextSym yy yy else System arraycopy yy yy nextSym yy tmp if groupPos groupPos G_SIZE zt selector groupNo base_zt base zt limit_zt limit zt perm_zt perm zt minLens_zt minLens zt else groupPos int zn minLens_zt while bsLiveShadow zn final int thech inShadow read if thech bsBuffShadow bsBuffShadow thech bsLiveShadow continue else throw new IOException int zvec bsBuffShadow bsLiveShadow zn zn bsLiveShadow zn while zvec limit_zt zn zn while bsLiveShadow final int thech inShadow read if thech bsBuffShadow bsBuffShadow thech bsLiveShadow continue else throw new IOException bsLiveShadow zvec zvec bsBuffShadow bsLiveShadow nextSym perm_zt zvec base_zt zn this last lastShadow this bsLive bsLiveShadow this bsBuff bsBuffShadow private int getAndMoveToFrontDecode0 final int groupNo throws IOException final InputStream inShadow this in final Data dataShadow this data final int zt dataShadow selector groupNo final int limit_zt dataShadow limit zt int zn dataShadow minLens zt int zvec bsR zn int bsLiveShadow this bsLive int bsBuffShadow this bsBuff while zvec limit_zt zn zn while bsLiveShadow final int thech inShadow read if thech bsBuffShadow bsBuffShadow thech bsLiveShadow continue else throw new IOException bsLiveShadow zvec zvec bsBuffShadow bsLiveShadow this bsLive bsLiveShadow this bsBuff bsBuffShadow return dataShadow perm zt zvec dataShadow base zt zn private void setupBlock throws IOException if this data null return final int cftab this data cftab final int tt this data initTT this last final byte ll8 this data ll8 cftab System arraycopy this data unzftab cftab for int cftab cftab cftab for int lastShadow this last lastShadow tt cftab ll8 if this origPtr this origPtr tt length throw new IOException this su_tPos tt this origPtr this su_count this su_i2 if this blockRandomised this su_rNToGo this su_rTPos setupRandPartA else setupNoRandPartA private void setupRandPartA throws IOException if this su_i2 this last this su_chPrev this su_ch2 int su_ch2Shadow this data ll8 this su_tPos this su_tPos this data tt this su_tPos if this su_rNToGo this su_rNToGo BZip2Constants rNums this su_rTPos if this su_rTPos this su_rTPos else this su_rNToGo this su_ch2 su_ch2Shadow this su_rNToGo this su_i2 this currentChar su_ch2Shadow this currentState RAND_PART_B_STATE this crc updateCRC su_ch2Shadow else endBlock initBlock setupBlock private void setupNoRandPartA throws IOException if this su_i2 this last this su_chPrev this su_ch2 int su_ch2Shadow this data ll8 this su_tPos this su_ch2 su_ch2Shadow this su_tPos this data tt this su_tPos this su_i2 this currentChar su_ch2Shadow this currentState NO_RAND_PART_B_STATE this crc updateCRC su_ch2Shadow else this currentState NO_RAND_PART_A_STATE endBlock initBlock setupBlock private void setupRandPartB throws IOException if this su_ch2 this su_chPrev this currentState RAND_PART_A_STATE this su_count setupRandPartA else if this su_count this su_z char this data ll8 this su_tPos this su_tPos this data tt this su_tPos if this su_rNToGo this su_rNToGo BZip2Constants rNums this su_rTPos if this su_rTPos this su_rTPos else this su_rNToGo this su_j2 this currentState RAND_PART_C_STATE if this su_rNToGo this su_z setupRandPartC else this currentState RAND_PART_A_STATE setupRandPartA private void setupRandPartC throws IOException if this su_j2 this su_z this currentChar this su_ch2 this crc updateCRC this su_ch2 this su_j2 else this currentState RAND_PART_A_STATE this su_i2 this su_count setupRandPartA private void setupNoRandPartB throws IOException if this su_ch2 this su_chPrev this su_count setupNoRandPartA else if this su_count this su_z char this data ll8 this su_tPos this su_tPos this data tt this su_tPos this su_j2 setupNoRandPartC else setupNoRandPartA private void setupNoRandPartC throws IOException if this su_j2 this su_z int su_ch2Shadow this su_ch2 this currentChar su_ch2Shadow this crc updateCRC su_ch2Shadow this su_j2 this currentState NO_RAND_PART_C_STATE else this su_i2 this su_count setupNoRandPartA private static final class Data extends Object Data int blockSize100k super this ll8 new byte blockSize100k BZip2Constants baseBlockSize final int initTT int length int ttShadow this tt if ttShadow null ttShadow length length this tt ttShadow new int length return ttShadow public class JavacExternal extends DefaultCompilerAdapter public boolean execute throws BuildException attributes log Project MSG_VERBOSE Commandline cmd new Commandline cmd setExecutable getJavac getJavacExecutable if assumeJava11 assumeJava12 setupModernJavacCommandlineSwitches cmd else setupJavacCommandlineSwitches cmd true int firstFileName assumeJava11 cmd size logAndAddFilesToCompile cmd if Os isFamily return execOnVMS cmd firstFileName return executeExternalCompile cmd getCommandline firstFileName true private boolean execOnVMS Commandline cmd int firstFileName File vmsFile null try vmsFile JavaEnvUtils createVmsJavaOptionFile cmd getArguments String commandLine cmd getExecutable vmsFile getPath return executeExternalCompile commandLine firstFileName true catch IOException throw new BuildException finally FileUtils delete vmsFile public class ANTLR extends Task private CommandlineJava commandline new CommandlineJava private File targetFile private File outputDirectory private File superGrammar private boolean html private boolean diagnostic private boolean trace private boolean traceParser private boolean traceLexer private boolean traceTreeWalker private File workingdir null private ByteArrayOutputStream bos new ByteArrayOutputStream private boolean debug private static final FileUtils FILE_UTILS FileUtils getFileUtils public ANTLR commandline setVm JavaEnvUtils getJreExecutable commandline setClassname public void setTarget File target log target toString Project MSG_VERBOSE this targetFile target public void setOutputdirectory File outputDirectory log outputDirectory toString Project MSG_VERBOSE this outputDirectory outputDirectory public void setGlib String superGrammar String sg null if Os isFamily sg superGrammar replace else sg superGrammar setGlib FILE_UTILS resolveFile getProject getBaseDir sg public void setGlib File superGrammar this superGrammar superGrammar public void setDebug boolean enable this debug enable public void setHtml boolean enable html enable public void setDiagnostic boolean enable diagnostic enable public void setTrace boolean enable trace enable public void setTraceParser boolean enable traceParser enable public void setTraceLexer boolean enable traceLexer enable public void setTraceTreeWalker boolean enable traceTreeWalker enable public void setFork boolean public void setDir File this workingdir public Path createClasspath return commandline createClasspath getProject createPath public Commandline Argument createJvmarg return commandline createVmArgument public void init throws BuildException addClasspathEntry protected void addClasspathEntry String resource if resource startsWith resource resource substring else resource resource File LoaderUtils getResourceSource getClass getClassLoader resource if null log getAbsolutePath Project MSG_DEBUG createClasspath setLocation else log resource Project MSG_VERBOSE public void execute throws BuildException validateAttributes File generatedFile getGeneratedFile boolean targetIsOutOfDate targetFile lastModified generatedFile lastModified boolean superGrammarIsOutOfDate superGrammar null superGrammar lastModified generatedFile lastModified if targetIsOutOfDate superGrammarIsOutOfDate if targetIsOutOfDate log targetFile generatedFile Project MSG_VERBOSE else if superGrammarIsOutOfDate log targetFile superGrammar generatedFile Project MSG_VERBOSE populateAttributes commandline createArgument setValue targetFile toString log commandline describeCommand Project MSG_VERBOSE int err run commandline getCommandline if err throw new BuildException err getLocation else String output bos toString if output indexOf throw new BuildException output getLocation else log generatedFile Project MSG_VERBOSE private void populateAttributes commandline createArgument setValue commandline createArgument setValue outputDirectory toString if superGrammar null commandline createArgument setValue commandline createArgument setValue superGrammar toString if html commandline createArgument setValue if diagnostic commandline createArgument setValue if trace commandline createArgument setValue if traceParser commandline createArgument setValue if traceLexer commandline createArgument setValue if traceTreeWalker if is272 commandline createArgument setValue else commandline createArgument setValue if debug commandline createArgument setValue private void validateAttributes throws BuildException if targetFile null targetFile isFile throw new BuildException targetFile if outputDirectory null setOutputdirectory new File targetFile getParent if outputDirectory isDirectory throw new BuildException outputDirectory private File getGeneratedFile throws BuildException String generatedFileName null try BufferedReader in new BufferedReader new FileReader targetFile String line while line in readLine null int extendsIndex line indexOf if line startsWith extendsIndex generatedFileName line substring extendsIndex trim break in close catch Exception throw new BuildException if generatedFileName null throw new BuildException return new File outputDirectory generatedFileName html private int run String command throws BuildException PumpStreamHandler psh new PumpStreamHandler new LogOutputStream this Project MSG_INFO new TeeOutputStream new LogOutputStream this Project MSG_WARN bos Execute exe new Execute psh null exe setAntRun getProject if workingdir null exe setWorkingDirectory workingdir exe setCommandline command try return exe execute catch IOException throw new BuildException getLocation finally FileUtils close bos protected boolean is272 AntClassLoader null try getProject createClassLoader commandline getClasspath loadClass return true catch ClassNotFoundException return false finally if null cleanup public class BorlandDeploymentTool extends GenericDeploymentTool implements ExecuteStreamHandler public static final String PUBLICID_BORLAND_EJB protected static final String DEFAULT_BAS45_EJB11_DTD_LOCATION protected static final String DEFAULT_BAS_DTD_LOCATION protected static final String BAS_DD protected static final String BES_DD protected static final String JAVA2IIOP protected static final String VERIFY private String jarSuffix private String borlandDTD private boolean java2iiopdebug false private String java2iioparams null private boolean generateclient false static final int BES static final int BAS private int version BAS private boolean verify true private String verifyArgs private Hashtable genfiles new Hashtable public void setDebug boolean debug this java2iiopdebug debug public void setVerify boolean verify this verify verify public void setSuffix String inString this jarSuffix inString public void setVerifyArgs String args this verifyArgs args public void setBASdtd String inString this borlandDTD inString public void setGenerateclient boolean this generateclient public void setVersion int version this version version public void setJava2iiopParams String params this java2iioparams params protected DescriptorHandler getBorlandDescriptorHandler final File srcDir DescriptorHandler handler new DescriptorHandler getTask srcDir protected void processElement if currentElement equals String fileNameWithMETA currentText String fileName fileNameWithMETA substring META_DIR length fileNameWithMETA length File descriptorFile new File srcDir fileName ejbFiles put fileNameWithMETA descriptorFile handler registerDTD PUBLICID_BORLAND_EJB borlandDTD null DEFAULT_BAS_DTD_LOCATION borlandDTD for Iterator getConfig dtdLocations iterator hasNext EjbJar DTDLocation dtdLocation EjbJar DTDLocation next handler registerDTD dtdLocation getPublicId dtdLocation getLocation return handler protected void addVendorFiles Hashtable ejbFiles String ddPrefix if version BES version BAS throw new BuildException version String dd version BES BES_DD BAS_DD log ddPrefix dd Project MSG_DEBUG File borlandDD new File getConfig descriptorDir ddPrefix dd if borlandDD exists log borlandDD Project MSG_VERBOSE ejbFiles put META_DIR dd borlandDD else log borlandDD getPath Project MSG_WARN return File getVendorOutputJarFile String baseName return new File getDestDir baseName jarSuffix private void verifyBorlandJar File sourceJar if version BAS verifyBorlandJarV4 sourceJar return if version BES verifyBorlandJarV5 sourceJar return log version Project MSG_WARN private void verifyBorlandJarV5 File sourceJar log sourceJar Project MSG_INFO try ExecTask execTask null execTask new ExecTask getTask execTask setDir new File execTask setExecutable if getCombinedClasspath null execTask createArg setValue execTask createArg setValue getCombinedClasspath toString if java2iiopdebug execTask createArg setValue execTask createArg setValue execTask createArg setValue execTask createArg setValue sourceJar getPath log Project MSG_VERBOSE execTask execute catch Exception String msg toString throw new BuildException msg private void verifyBorlandJarV4 File sourceJar org apache tools ant taskdefs Java javaTask null log sourceJar Project MSG_INFO try String args verifyArgs args sourceJar getPath javaTask new Java getTask javaTask setTaskName javaTask setClassname VERIFY Commandline Argument arguments javaTask createArg arguments setLine args Path classpath getCombinedClasspath if classpath null javaTask setClasspath classpath javaTask setFork true log VERIFY sourceJar toString Project MSG_VERBOSE javaTask execute catch Exception String msg VERIFY toString throw new BuildException msg private void generateClient File sourceJar getTask getProject addTaskDefinition org apache tools ant taskdefs optional ejb BorlandGenerateClient class org apache tools ant taskdefs optional ejb BorlandGenerateClient gentask null log sourceJar Project MSG_INFO try Project project getTask getProject gentask BorlandGenerateClient project createTask gentask setEjbjar sourceJar gentask setDebug java2iiopdebug Path classpath getCombinedClasspath if classpath null gentask setClasspath classpath gentask setVersion version gentask setTaskName gentask execute catch Exception String msg VERIFY toString throw new BuildException msg private void buildBorlandStubs Iterator ithomes Execute execTask null execTask new Execute this Project project getTask getProject execTask setAntRun project execTask setWorkingDirectory project getBaseDir Commandline commandline new Commandline commandline setExecutable JAVA2IIOP if java2iiopdebug commandline createArgument setValue commandline createArgument setValue commandline createArgument setPath getCombinedClasspath commandline createArgument setValue commandline createArgument setValue if java2iioparams null log java2iioparams commandline createArgument setValue java2iioparams commandline createArgument setValue commandline createArgument setValue getConfig srcDir getAbsolutePath commandline createArgument setValue while ithomes hasNext commandline createArgument setValue ithomes next toString try log Project MSG_VERBOSE log commandline describeCommand Project MSG_DEBUG execTask setCommandline commandline getCommandline int result execTask execute if Execute isFailure result String msg result throw new BuildException msg getTask getLocation catch java io IOException log getMessage Project MSG_ERR throw new BuildException getTask getLocation protected void writeJar String baseName File jarFile Hashtable files String publicId throws BuildException Vector homes new Vector Iterator it files keySet iterator while it hasNext String clazz String it next if clazz endsWith String home toClass clazz homes add home log home Project MSG_VERBOSE buildBorlandStubs homes iterator files putAll genfiles super writeJar baseName jarFile files publicId if verify verifyBorlandJar jarFile if generateclient generateClient jarFile private String toClass String filename String classname filename substring filename lastIndexOf classname classname replace return classname private String toClassFile String filename String classfile filename substring filename lastIndexOf classfile classfile return classfile public void start throws IOException public void stop public void setProcessInputStream OutputStream param1 throws IOException public void setProcessOutputStream InputStream is throws IOException try BufferedReader reader new BufferedReader new InputStreamReader is String javafile while javafile reader readLine null if javafile endsWith String classfile toClassFile javafile String key classfile substring getConfig srcDir getAbsolutePath length genfiles put key new File classfile reader close catch Exception String msg toString throw new BuildException msg public void setProcessErrorStream InputStream is throws IOException BufferedReader reader new BufferedReader new InputStreamReader is String reader readLine if null log Project MSG_ERR public class MailLogger extends DefaultLogger private StringBuffer buffer new StringBuffer public void buildFinished BuildEvent event super buildFinished event Project project event getProject Hashtable properties project getProperties Properties fileProperties new Properties String filename String properties get if filename null InputStream is null try is new FileInputStream filename fileProperties load is catch IOException ioe finally if is null try is close catch IOException for Enumeration fileProperties keys hasMoreElements String key String nextElement String value fileProperties getProperty key properties put key project replaceProperties value boolean success event getException null String prefix success try boolean notify Project toBoolean getValue properties prefix if notify return String mailhost getValue properties int port Integer parseInt getValue properties String valueOf MailMessage DEFAULT_PORT String user getValue properties String password getValue properties boolean ssl Project toBoolean getValue properties String from getValue properties null String replytoList getValue properties String toList getValue properties prefix null String subject getValue properties prefix success if user equals password equals ssl sendMail mailhost port from replytoList toList subject buffer substring else sendMimeMail event getProject mailhost port user password ssl from replytoList toList subject buffer substring catch Exception System out println printStackTrace System err protected void log String message buffer append message append StringUtils LINE_SEP private String getValue Hashtable properties String name String defaultValue throws Exception String propertyName name String value String properties get propertyName if value null value defaultValue if value null throw new Exception propertyName return value private void sendMail String mailhost int port String from String replyToList String toList String subject String message throws IOException MailMessage mailMessage new MailMessage mailhost port mailMessage setHeader DateUtils getDateForHeader mailMessage from from if replyToList equals StringTokenizer new StringTokenizer replyToList false while hasMoreTokens mailMessage replyto nextToken StringTokenizer new StringTokenizer toList false while hasMoreTokens mailMessage to nextToken mailMessage setSubject subject PrintStream ps mailMessage getPrintStream ps println message mailMessage sendAndClose private void sendMimeMail Project project String host int port String user String password boolean ssl String from String replyToString String toString String subject String message Mailer mailer null try mailer Mailer ClasspathUtils newInstance MailLogger class getClassLoader Mailer class catch BuildException Throwable getCause null getCause log getMessage return Vector replyToList vectorizeEmailAddresses replyToString mailer setHost host mailer setPort port mailer setUser user mailer setPassword password mailer setSSL ssl Message mymessage new Message message mymessage setProject project mailer setMessage mymessage mailer setFrom new EmailAddress from mailer setReplyToList replyToList Vector toList vectorizeEmailAddresses toString mailer setToList toList mailer setCcList new Vector mailer setBccList new Vector mailer setFiles new Vector mailer setSubject subject mailer send private Vector vectorizeEmailAddresses String listString Vector emailList new Vector StringTokenizer tokens new StringTokenizer listString while tokens hasMoreTokens emailList addElement new EmailAddress tokens nextToken return emailList public class CCMklabel extends ClearCase private boolean mReplace false private boolean mRecurse false private String mVersion null private String mTypeName null private String mVOB null private String mComment null private String mCfile null public void execute throws BuildException Commandline commandLine new Commandline Project aProj getProject int result if getTypeName null throw new BuildException if getViewPath null setViewPath aProj getBaseDir getPath commandLine setExecutable getClearToolCommand commandLine createArgument setValue COMMAND_MKLABEL checkOptions commandLine if getFailOnErr getProject log getViewPathBasename Project MSG_VERBOSE result run commandLine if Execute isFailure result getFailOnErr String msg commandLine toString throw new BuildException msg getLocation private void checkOptions Commandline cmd if getReplace cmd createArgument setValue FLAG_REPLACE if getRecurse cmd createArgument setValue FLAG_RECURSE if getVersion null getVersionCommand cmd if getComment null getCommentCommand cmd else if getCommentFile null getCommentFileCommand cmd else cmd createArgument setValue FLAG_NOCOMMENT if getTypeName null getTypeCommand cmd cmd createArgument setValue getViewPath public void setReplace boolean replace mReplace replace public boolean getReplace return mReplace public void setRecurse boolean recurse mRecurse recurse public boolean getRecurse return mRecurse public void setVersion String version mVersion version public String getVersion return mVersion public void setComment String comment mComment comment public String getComment return mComment public void setCommentFile String cfile mCfile cfile public String getCommentFile return mCfile public void setTypeName String tn mTypeName tn public String getTypeName return mTypeName public void setVOB String vob mVOB vob public String getVOB return mVOB private void getVersionCommand Commandline cmd if getVersion null cmd createArgument setValue FLAG_VERSION cmd createArgument setValue getVersion private void getCommentCommand Commandline cmd if getComment null cmd createArgument setValue FLAG_COMMENT cmd createArgument setValue getComment private void getCommentFileCommand Commandline cmd if getCommentFile null cmd createArgument setValue FLAG_COMMENTFILE cmd createArgument setValue getCommentFile private void getTypeCommand Commandline cmd String typenm null if getTypeName null typenm getTypeName if getVOB null typenm getVOB cmd createArgument setValue typenm public static final String FLAG_REPLACE public static final String FLAG_RECURSE public static final String FLAG_VERSION public static final String FLAG_COMMENT public static final String FLAG_COMMENTFILE public static final String FLAG_NOCOMMENT public class UUEncoder protected static final int DEFAULT_MODE private static final int MAX_CHARS_PER_LINE private OutputStream out private String name public UUEncoder String name this name name public void encode InputStream is OutputStream out throws IOException this out out encodeBegin byte buffer new byte MAX_CHARS_PER_LINE int count while count is read buffer buffer length int pos while count int num count MAX_CHARS_PER_LINE MAX_CHARS_PER_LINE count encodeLine buffer pos num out pos num count num out flush encodeEnd private void encodeString String throws IOException PrintStream writer new PrintStream out writer print writer flush private void encodeBegin throws IOException encodeString DEFAULT_MODE name private void encodeEnd throws IOException encodeString private void encodeLine byte data int offset int length OutputStream out throws IOException out write byte length byte byte byte for int length data offset if length data offset if length data offset byte d1 byte byte d2 byte byte d3 byte byte d4 byte out write d1 out write d2 out write d3 out write d4 out write public class ExecuteJava implements Runnable TimeoutObserver private Commandline javaCommand null private Path classpath null private CommandlineJava SysProperties sysProperties null private Permissions perm null private Method main null private Long timeout null private volatile Throwable caught null private volatile boolean timedOut false private Thread thread null public void setJavaCommand Commandline javaCommand this javaCommand javaCommand public void setClasspath Path classpath public void setSystemProperties CommandlineJava SysProperties sysProperties public void setPermissions Permissions permissions perm permissions public void setOutput PrintStream out public void setTimeout Long timeout this timeout timeout public void execute Project project throws BuildException final String classname javaCommand getExecutable AntClassLoader loader null try if sysProperties null sysProperties setSystem Class target null try if classpath null target Class forName classname else loader project createClassLoader classpath loader setParent project getCoreLoader loader setParentFirst false loader addJavaLibraries loader setIsolated true loader setThreadContextLoader loader forceLoadClass classname target Class forName classname true loader catch ClassNotFoundException throw new BuildException classname main target getMethod new Class String class if main null throw new BuildException classname if main getModifiers Modifier STATIC throw new BuildException classname if timeout null run else thread new Thread this Task currentThreadTask project getThreadTask Thread currentThread project registerThreadTask thread currentThreadTask thread setDaemon true Watchdog new Watchdog timeout longValue addTimeoutObserver this synchronized this thread start start try wait catch InterruptedException if timedOut project log Project MSG_WARN else thread null stop if caught null throw caught catch BuildException throw catch SecurityException throw catch ThreadDeath throw catch Throwable throw new BuildException finally if loader null loader resetThreadContextLoader loader cleanup loader null if sysProperties null sysProperties restoreSystem public void run final Object argument javaCommand getArguments try if perm null perm setSecurityManager main invoke null argument catch InvocationTargetException Throwable getTargetException if instanceof InterruptedException caught catch Throwable caught finally if perm null perm restoreSecurityManager synchronized this notifyAll public synchronized void timeoutOccured Watchdog if thread null timedOut true thread interrupt notifyAll public synchronized boolean killedProcess return timedOut public int fork ProjectComponent pc throws BuildException CommandlineJava cmdl new CommandlineJava cmdl setClassname javaCommand getExecutable String args javaCommand getArguments for int args length cmdl createArgument setValue args if classpath null cmdl createClasspath pc getProject append classpath if sysProperties null cmdl addSysproperties sysProperties Redirector redirector new Redirector pc Execute exe new Execute redirector createHandler timeout null null new ExecuteWatchdog timeout longValue exe setAntRun pc getProject if Os isFamily setupCommandLineForVMS exe cmdl getCommandline else exe setCommandline cmdl getCommandline try int rc exe execute redirector complete return rc catch IOException throw new BuildException finally timedOut exe killedProcess public static void setupCommandLineForVMS Execute exe String command exe setVMLauncher true File vmsJavaOptionFile null try String args new String command length System arraycopy command args command length vmsJavaOptionFile JavaEnvUtils createVmsJavaOptionFile args vmsJavaOptionFile deleteOnExit String vmsCmd command vmsJavaOptionFile getPath exe setCommandline vmsCmd catch IOException throw new BuildException public class ParserSupports extends ProjectComponent implements Condition private String feature private String property private String value public static final String ERROR_BOTH_ATTRIBUTES public static final String FEATURE public static final String PROPERTY public static final String NOT_RECOGNIZED public static final String NOT_SUPPORTED public static final String ERROR_NO_ATTRIBUTES public static final String ERROR_NO_VALUE public void setFeature String feature this feature feature public void setProperty String property this property property public void setValue String value this value value public boolean eval throws BuildException if feature null property null throw new BuildException ERROR_BOTH_ATTRIBUTES if feature null property null throw new BuildException ERROR_NO_ATTRIBUTES if feature null return evalFeature if value null throw new BuildException ERROR_NO_VALUE return evalProperty private XMLReader getReader JAXPUtils getParser return JAXPUtils getXMLReader public boolean evalFeature XMLReader reader getReader if value null value boolean Project toBoolean value try reader setFeature feature catch SAXNotRecognizedException log FEATURE NOT_RECOGNIZED feature Project MSG_VERBOSE return false catch SAXNotSupportedException log FEATURE NOT_SUPPORTED feature Project MSG_VERBOSE return false return true public boolean evalProperty XMLReader reader getReader try reader setProperty property value catch SAXNotRecognizedException log PROPERTY NOT_RECOGNIZED property Project MSG_VERBOSE return false catch SAXNotSupportedException log PROPERTY NOT_SUPPORTED property Project MSG_VERBOSE return false return true public class SOSCheckin extends SOS public final void setFile String filename super setInternalFilename filename public void setRecursive boolean recursive super setInternalRecursive recursive public void setComment String comment super setInternalComment comment protected Commandline buildCmdLine commandLine new Commandline if getFilename null commandLine createArgument setValue SOSCmd FLAG_COMMAND commandLine createArgument setValue SOSCmd COMMAND_CHECKIN_FILE commandLine createArgument setValue SOSCmd FLAG_FILE commandLine createArgument setValue getFilename else commandLine createArgument setValue SOSCmd FLAG_COMMAND commandLine createArgument setValue SOSCmd COMMAND_CHECKIN_PROJECT commandLine createArgument setValue getRecursive getRequiredAttributes getOptionalAttributes if getComment null commandLine createArgument setValue SOSCmd FLAG_COMMENT commandLine createArgument setValue getComment return commandLine public interface Algorithm boolean isValid String getValue File file public class DependencyVisitor extends EmptyVisitor private Hashtable dependencies new Hashtable private ConstantPool constantPool public Enumeration getDependencies return dependencies keys public void clearDependencies dependencies clear public void visitConstantPool ConstantPool constantPool this constantPool constantPool public void visitConstantClass ConstantClass constantClass String classname constantClass getConstantValue constantPool toString addSlashClass classname public void visitConstantNameAndType ConstantNameAndType obj String name obj getName constantPool if obj getSignature constantPool equals name startsWith String classname name substring replace int index classname lastIndexOf if index char start int index2 classname lastIndexOf index if index2 start classname charAt index2 else start classname charAt if start start classname classname substring index classname substring index addClass classname else addClass classname else addClass classname public void visitField Field field addClasses field getSignature public void visitJavaClass JavaClass javaClass addClass javaClass getClassName public void visitMethod Method method String signature method getSignature int pos signature indexOf addClasses signature substring pos addClasses signature substring pos void addClass String classname dependencies put classname classname private void addClasses String string StringTokenizer tokens new StringTokenizer string while tokens hasMoreTokens String descriptor tokens nextToken int pos descriptor indexOf if pos addSlashClass descriptor substring pos private void addSlashClass String classname addClass classname replace public class KeySubst extends Task private File source null private File dest null private String sep private Hashtable replacements new Hashtable public void execute throws BuildException log log if source null dest null log return BufferedReader br null BufferedWriter bw null try br new BufferedReader new FileReader source dest delete bw new BufferedWriter new FileWriter dest String line null String newline null line br readLine while line null if line length bw newLine else newline KeySubst replace line replacements bw write newline bw newLine line br readLine bw flush catch IOException ioe ioe printStackTrace finally if bw null try bw close catch IOException if br null try br close catch IOException public void setSrc File this source public void setDest File dest this dest dest public void setSep String sep this sep sep public void setKeys String keys if keys null keys length StringTokenizer tok new StringTokenizer keys this sep false while tok hasMoreTokens String token tok nextToken trim StringTokenizer itok new StringTokenizer token false String name itok nextToken String value itok nextToken replacements put name value public static void main String args try Hashtable hash new Hashtable hash put hash put System out println KeySubst replace hash catch Exception printStackTrace public static String replace String origString Hashtable keys throws BuildException StringBuffer finalString new StringBuffer int index int String key null while index origString indexOf key origString substring index origString indexOf index finalString append origString substring index if keys containsKey key finalString append keys get key else finalString append finalString append key finalString append index key length finalString append origString substring return finalString toString public class FilterSet extends DataType implements Cloneable public static class Filter String token String value public Filter String token String value setToken token setValue value public Filter public void setToken String token this token token public void setValue String value this value value public String getToken return token public String getValue return value public class FiltersFile public FiltersFile public void setFile File file filtersFiles add file public static class OnMissing extends EnumeratedAttribute private static final String VALUES new String public static final OnMissing FAIL new OnMissing public static final OnMissing WARN new OnMissing public static final OnMissing IGNORE new OnMissing private static final int FAIL_INDEX private static final int WARN_INDEX private static final int IGNORE_INDEX public OnMissing public OnMissing String value setValue value public String getValues return VALUES public static final String DEFAULT_TOKEN_START public static final String DEFAULT_TOKEN_END private String startOfToken DEFAULT_TOKEN_START private String endOfToken DEFAULT_TOKEN_END private Vector passedTokens private boolean duplicateToken false private boolean recurse true private Hashtable filterHash null private Vector filtersFiles new Vector private OnMissing onMissingFiltersFile OnMissing FAIL private boolean readingFiles false private int recurseDepth private Vector filters new Vector public FilterSet protected FilterSet FilterSet filterset super this filters Vector filterset getFilters clone protected synchronized Vector getFilters if isReference return getRef getFilters if readingFiles readingFiles true for int sz filtersFiles size sz readFiltersFromFile File filtersFiles get filtersFiles clear readingFiles false return filters protected FilterSet getRef return FilterSet getCheckedRef FilterSet class public synchronized Hashtable getFilterHash if filterHash null filterHash new Hashtable getFilters size for Enumeration getFilters elements hasMoreElements Filter filter Filter nextElement filterHash put filter getToken filter getValue return filterHash public void setFiltersfile File filtersFile throws BuildException if isReference throw tooManyAttributes filtersFiles add filtersFile public void setBeginToken String startOfToken if isReference throw tooManyAttributes if startOfToken null equals startOfToken throw new BuildException this startOfToken startOfToken public String getBeginToken if isReference return getRef getBeginToken return startOfToken public void setEndToken String endOfToken if isReference throw tooManyAttributes if endOfToken null equals endOfToken throw new BuildException this endOfToken endOfToken public String getEndToken if isReference return getRef getEndToken return endOfToken public void setRecurse boolean recurse this recurse recurse public boolean isRecurse return recurse public synchronized void readFiltersFromFile File filtersFile throws BuildException if isReference throw tooManyAttributes if filtersFile exists handleMissingFile filtersFile if filtersFile isFile log filtersFile Project MSG_VERBOSE FileInputStream in null try Properties props new Properties in new FileInputStream filtersFile props load in Enumeration props propertyNames Vector filts getFilters while hasMoreElements String strPropName String nextElement String strValue props getProperty strPropName filts addElement new Filter strPropName strValue catch Exception ex throw new BuildException filtersFile finally FileUtils close in else handleMissingFile filtersFile filterHash null public synchronized String replaceTokens String line return iReplaceTokens line public synchronized void addFilter Filter filter if isReference throw noChildrenAllowed filters addElement filter filterHash null public FiltersFile createFiltersfile if isReference throw noChildrenAllowed return new FiltersFile public synchronized void addFilter String token String value if isReference throw noChildrenAllowed addFilter new Filter token value public synchronized void addConfiguredFilterSet FilterSet filterSet if isReference throw noChildrenAllowed for Enumeration filterSet getFilters elements hasMoreElements addFilter Filter nextElement public synchronized boolean hasFilters return getFilters size public synchronized Object clone throws BuildException if isReference return FilterSet getRef clone try FilterSet fs FilterSet super clone fs filters Vector getFilters clone fs setProject getProject return fs catch CloneNotSupportedException throw new BuildException public void setOnMissingFiltersFile OnMissing onMissingFiltersFile this onMissingFiltersFile onMissingFiltersFile public OnMissing getOnMissingFiltersFile return onMissingFiltersFile private synchronized String iReplaceTokens String line String beginToken getBeginToken String endToken getEndToken int index line indexOf beginToken if index Hashtable tokens getFilterHash try StringBuffer new StringBuffer int String token null String value null while index int endIndex line indexOf endToken index beginToken length if endIndex break token line substring index beginToken length endIndex append line substring index if tokens containsKey token value String tokens get token if recurse value equals token value replaceTokens value token log beginToken token endToken value Project MSG_VERBOSE append value index beginToken length token length endToken length else append beginToken index beginToken length index line indexOf beginToken append line substring return toString catch StringIndexOutOfBoundsException return line else return line private synchronized String replaceTokens String line String parent throws BuildException String beginToken getBeginToken String endToken getEndToken if recurseDepth passedTokens new Vector recurseDepth if passedTokens contains parent duplicateToken duplicateToken true System out println passedTokens toString beginToken parent endToken beginToken passedTokens lastElement toString endToken recurseDepth return parent passedTokens addElement parent String value iReplaceTokens line if value indexOf beginToken duplicateToken recurseDepth passedTokens null else if duplicateToken if passedTokens size value String passedTokens remove passedTokens size if passedTokens size value beginToken value endToken duplicateToken false recurseDepth return value private void handleMissingFile String message switch onMissingFiltersFile getIndex case OnMissing IGNORE_INDEX return case OnMissing FAIL_INDEX throw new BuildException message case OnMissing WARN_INDEX log message Project MSG_WARN return default throw new BuildException public class NameAndTypeCPInfo extends ConstantPoolEntry public NameAndTypeCPInfo super CONSTANT_NAMEANDTYPE public void read DataInputStream cpStream throws IOException nameIndex cpStream readUnsignedShort descriptorIndex cpStream readUnsignedShort public String toString String value if isResolved value name type else value nameIndex descriptorIndex return value public void resolve ConstantPool constantPool name Utf8CPInfo constantPool getEntry nameIndex getValue type Utf8CPInfo constantPool getEntry descriptorIndex getValue super resolve constantPool public String getName return name public String getType return type private String name private String type private int nameIndex private int descriptorIndex public class ChecksumAlgorithm implements Algorithm private String algorithm private Checksum checksum null public void setAlgorithm String algorithm this algorithm algorithm public void initChecksum if checksum null return if equalsIgnoreCase algorithm checksum new CRC32 else if equalsIgnoreCase algorithm checksum new Adler32 else throw new BuildException new NoSuchAlgorithmException public boolean isValid return equalsIgnoreCase algorithm equalsIgnoreCase algorithm public String getValue File file initChecksum String rval null try if file canRead checksum reset FileInputStream fis new FileInputStream file CheckedInputStream check new CheckedInputStream fis checksum BufferedInputStream in new BufferedInputStream check while in read rval Long toString check getChecksum getValue in close catch Exception rval null return rval public String toString StringBuffer buf new StringBuffer buf append buf append append algorithm buf append return buf toString public interface XSLTLogger void log String msg public class PropertyFileInputHandler implements InputHandler private Properties props null public static final String FILE_NAME_KEY public PropertyFileInputHandler public void handleInput InputRequest request throws BuildException readProps Object props get request getPrompt if null throw new BuildException request getPrompt request setInput toString if request isInputValid throw new BuildException request getPrompt private synchronized void readProps throws BuildException if props null String propsFile System getProperty FILE_NAME_KEY if propsFile null throw new BuildException FILE_NAME_KEY props new Properties try props load new FileInputStream propsFile catch IOException throw new BuildException propsFile public class DTDLocation extends ResourceLocation public class P4Sync extends P4Base String label private String syncCmd public void setLabel String label throws BuildException if label null label equals throw new BuildException this label label public void setForce String force throws BuildException if force null label equals throw new BuildException P4CmdOpts public void execute throws BuildException if P4View null syncCmd P4View if label null label equals syncCmd syncCmd label log P4CmdOpts syncCmd Project MSG_VERBOSE execP4Command P4CmdOpts syncCmd new SimpleP4OutputHandler this public class Deltree extends Task private File dir public void setDir File dir this dir dir public void execute throws BuildException log if dir null throw new BuildException getLocation if dir exists if dir isDirectory if dir delete throw new BuildException dir getAbsolutePath getLocation return log dir getAbsolutePath try removeDir dir catch IOException ioe String msg dir getAbsolutePath throw new BuildException msg getLocation private void removeDir File dir throws IOException String list dir list for int list length String list File new File dir if isDirectory removeDir else if delete throw new BuildException getAbsolutePath if dir delete throw new BuildException dir getAbsolutePath public class KaffeRmic extends DefaultRmicAdapter private static final String RMIC_CLASSNAMES new String public static final String COMPILER_NAME public boolean execute throws BuildException getRmic log Project MSG_VERBOSE Commandline cmd setupRmicCommand Class getRmicClass if null StringBuffer buf new StringBuffer for int RMIC_CLASSNAMES length if buf append buf append RMIC_CLASSNAMES buf append throw new BuildException buf toString getRmic getLocation cmd setExecutable getName if getName equals RMIC_CLASSNAMES RMIC_CLASSNAMES length cmd createArgument setValue getRmic log Commandline describeCommand cmd ExecuteJava ej new ExecuteJava ej setJavaCommand cmd return ej fork getRmic public static boolean isAvailable return getRmicClass null private static Class getRmicClass for int RMIC_CLASSNAMES length try return Class forName RMIC_CLASSNAMES catch ClassNotFoundException cnfe return null public class InputRequest private String prompt private String input private String defaultValue public InputRequest String prompt if prompt null throw new IllegalArgumentException this prompt prompt public String getPrompt return prompt public void setInput String input this input input public boolean isInputValid return true public String getInput return input public String getDefaultValue return defaultValue public void setDefaultValue String defaultValue public class UnsupportedAttributeException extends BuildException private String attribute public UnsupportedAttributeException String msg String attribute super msg this attribute attribute public String getAttribute return attribute public class Touch extends Task private interface DateFormatFactory DateFormat getPrimaryFormat DateFormat getFallbackFormat private static final DateFormatFactory DEFAULT_DF_FACTORY new DateFormatFactory public DateFormat getPrimaryFormat return DateFormat getDateTimeInstance DateFormat SHORT DateFormat SHORT Locale US public DateFormat getFallbackFormat return DateFormat getDateTimeInstance DateFormat SHORT DateFormat MEDIUM Locale US private static final FileUtils FILE_UTILS FileUtils getFileUtils private File file private long millis private String dateTime private Vector filesets new Vector private Union resources new Union private boolean dateTimeConfigured private boolean mkdirs private boolean verbose true private FileNameMapper fileNameMapper null private DateFormatFactory dfFactory DEFAULT_DF_FACTORY public Touch public void setFile File file this file file public void setMillis long millis this millis millis public void setDatetime String dateTime if this dateTime null log dateTime Project MSG_VERBOSE this dateTime dateTime dateTimeConfigured false public void setMkdirs boolean mkdirs this mkdirs mkdirs public void setVerbose boolean verbose this verbose verbose public void setPattern final String pattern dfFactory new DateFormatFactory public DateFormat getPrimaryFormat return new SimpleDateFormat pattern public DateFormat getFallbackFormat return null public void addConfiguredMapper Mapper mapper add mapper getImplementation public void add FileNameMapper fileNameMapper throws BuildException if this fileNameMapper null throw new BuildException getTaskName this fileNameMapper fileNameMapper public void addFileset FileSet set filesets add set add set public void addFilelist FileList list add list public void add ResourceCollection rc resources add rc protected synchronized void checkConfiguration throws BuildException if file null resources size throw new BuildException if file null file exists file isDirectory throw new BuildException if dateTime null dateTimeConfigured long workmillis millis DateFormat df dfFactory getPrimaryFormat ParseException pe null try workmillis df parse dateTime getTime catch ParseException peOne df dfFactory getFallbackFormat if df null pe peOne else try workmillis df parse dateTime getTime catch ParseException peTwo pe peTwo if pe null throw new BuildException pe getMessage pe getLocation if workmillis throw new BuildException dateTime log workmillis millis Project MSG_DEBUG Project MSG_VERBOSE setMillis workmillis dateTimeConfigured true public void execute throws BuildException checkConfiguration touch protected void touch throws BuildException long defaultTimestamp getTimestamp if file null touch new FileResource file getParentFile file getName defaultTimestamp Iterator iter resources iterator while iter hasNext Resource Resource iter next if instanceof Touchable throw new BuildException touch defaultTimestamp for int filesets size FileSet fs FileSet filesets elementAt DirectoryScanner ds fs getDirectoryScanner getProject File fromDir fs getDir getProject String srcDirs ds getIncludedDirectories for int srcDirs length touch new FileResource fromDir srcDirs defaultTimestamp protected void touch File file touch file getTimestamp private long getTimestamp return millis System currentTimeMillis millis private void touch Resource long defaultTimestamp if fileNameMapper null if instanceof FileResource touch FileResource getFile defaultTimestamp else Touchable touch defaultTimestamp else String mapped fileNameMapper mapFileName getName if mapped null mapped length long modTime isExists getLastModified defaultTimestamp for int mapped length touch getProject resolveFile mapped modTime private void touch File file long modTime if file exists log file verbose Project MSG_INFO Project MSG_VERBOSE try FILE_UTILS createNewFile file mkdirs catch IOException ioe throw new BuildException file ioe getLocation if file canWrite throw new BuildException file FILE_UTILS setFileLastModified file modTime public class SignedSelector extends DataType implements FileSelector private IsSigned isSigned new IsSigned public void setName String name isSigned setName name public boolean isSelected File basedir String filename File file if file isDirectory isSigned setProject getProject isSigned setFile file return isSigned eval public final class PrefixLines extends BaseParamFilterReader implements ChainableReader private static final String PREFIX_KEY private String prefix null private String queuedData null public PrefixLines super public PrefixLines final Reader in super in public int read throws IOException if getInitialized initialize setInitialized true int ch if queuedData null queuedData length queuedData null if queuedData null ch queuedData charAt queuedData queuedData substring if queuedData length queuedData null else queuedData readLine if queuedData null ch else if prefix null queuedData prefix queuedData return read return ch public void setPrefix final String prefix this prefix prefix private String getPrefix return prefix public Reader chain final Reader rdr PrefixLines newFilter new PrefixLines rdr newFilter setPrefix getPrefix newFilter setInitialized true return newFilter private void initialize Parameter params getParameters if params null for int params length if PREFIX_KEY equals params getName prefix params getValue break public class SplashTask extends Task private String imgurl null private String proxy null private String user null private String password null private String port private int showDuration private boolean useProxy false private static SplashScreen splash null public void setImageURL String imgurl this imgurl imgurl public void setUseproxy boolean useProxy this useProxy useProxy public void setProxy String proxy this proxy proxy public void setPort String port this port port public void setUser String user this user user public void setPassword String password this password password public void setShowduration int duration this showDuration duration public void execute throws BuildException if splash null splash setVisible false getProject removeBuildListener splash splash dispose splash null log Project MSG_VERBOSE InputStream in null if imgurl null try URLConnection conn null if useProxy proxy null proxy length port null port length log Project MSG_DEBUG System getProperties put System getProperties put proxy System getProperties put port URL url new URL imgurl conn url openConnection if user null user length String encodedcreds new Base64Converter encode user password conn setRequestProperty encodedcreds else System getProperties put System getProperties put System getProperties put log Project MSG_DEBUG URL url new URL imgurl conn url openConnection conn setDoInput true conn setDoOutput false in conn getInputStream catch Throwable ioe log Project MSG_DEBUG log ioe getMessage Project MSG_DEBUG if in null ClassLoader cl SplashTask class getClassLoader if cl null in cl getResourceAsStream else in ClassLoader getSystemResourceAsStream boolean success false if in null DataInputStream din new DataInputStream in try ByteArrayOutputStream bout new ByteArrayOutputStream int data while data din read bout write byte data log Project MSG_DEBUG try ImageIcon img new ImageIcon bout toByteArray splash new SplashScreen img success true catch Throwable logHeadless catch Exception throw new BuildException finally try din close catch IOException ioe if success throw new BuildException ioe else try splash new SplashScreen success true catch Throwable logHeadless if success splash setVisible true splash toFront getProject addBuildListener splash try Thread sleep showDuration catch InterruptedException private void logHeadless Throwable log getClass getName getMessage Project MSG_WARN public class Patch extends Task private File originalFile private File directory private boolean havePatchfile false private Commandline cmd new Commandline public void setOriginalfile File file originalFile file public void setDestfile File file if file null cmd createArgument setValue cmd createArgument setFile file public void setPatchfile File file if file exists throw new BuildException file getLocation cmd createArgument setValue cmd createArgument setFile file havePatchfile true public void setBackups boolean backups if backups cmd createArgument setValue public void setIgnorewhitespace boolean ignore if ignore cmd createArgument setValue public void setStrip int num throws BuildException if num throw new BuildException getLocation cmd createArgument setValue num public void setQuiet boolean if cmd createArgument setValue public void setReverse boolean if cmd createArgument setValue public void setDir File directory this directory directory public void execute throws BuildException if havePatchfile throw new BuildException getLocation Commandline toExecute Commandline cmd clone toExecute setExecutable if originalFile null toExecute createArgument setFile originalFile Execute exe new Execute new LogStreamHandler this Project MSG_INFO Project MSG_WARN null exe setCommandline toExecute getCommandline if directory null if directory exists directory isDirectory exe setWorkingDirectory directory else if directory isDirectory throw new BuildException directory getLocation else throw new BuildException directory getLocation else exe setWorkingDirectory getProject getBaseDir log toExecute describeCommand Project MSG_VERBOSE try exe execute catch IOException throw new BuildException getLocation public class ScriptSelector extends BaseSelector private ScriptRunnerHelper helper new ScriptRunnerHelper private ScriptRunnerBase runner private File basedir private String filename private File file private boolean selected public void setProject Project project super setProject project helper setProjectComponent this public void setManager String manager helper setManager manager public void setLanguage String language helper setLanguage language private void init throws BuildException if runner null return runner helper getScriptRunner public void setSrc File file helper setSrc file public void addText String text helper addText text public void setClasspath Path classpath helper setClasspath classpath public Path createClasspath return helper createClasspath public void setClasspathRef Reference helper setClasspathRef public void setSetBeans boolean setBeans helper setSetBeans setBeans public boolean isSelected File basedir String filename File file init setSelected true this file file this basedir basedir this filename filename runner addBean basedir runner addBean filename runner addBean file runner executeScript return isSelected public File getBasedir return basedir public String getFilename return filename public File getFile return file public boolean isSelected return selected public void setSelected boolean selected this selected selected public class EmailAddress private String name private String address public EmailAddress public EmailAddress String email final int minLen int len email length if len minLen if email charAt email charAt email charAt len email charAt len this address trim email true return int paramDepth int start int end int nStart int nEnd for int len char email charAt if paramDepth if start nStart else if paramDepth if end nEnd else if paramDepth if start nEnd start else if paramDepth end if end len nStart if end end len if nEnd nEnd len this address trim email substring start end true this name trim email substring nStart nEnd false if this name length this address length len this name null private String trim String boolean trimAngleBrackets int start int end length boolean trim false do trim false if charAt end charAt end trimAngleBrackets charAt end charAt end charAt end trim true end if charAt start charAt start trimAngleBrackets charAt start charAt start trim true start while trim return substring start end public void setName String name this name name public void setAddress String address this address address public String toString if name null return address else return name address public String getAddress return address public String getName return name public class XMLCatalog extends DataType implements Cloneable EntityResolver URIResolver private static final FileUtils FILE_UTILS FileUtils getFileUtils private Vector elements new Vector private Path classpath private Path catalogPath public static final String APACHE_RESOLVER public static final String CATALOG_RESOLVER public XMLCatalog setChecked false private Vector getElements return getRef elements private Path getClasspath return getRef classpath public Path createClasspath if isReference throw noChildrenAllowed if this classpath null this classpath new Path getProject setChecked false return this classpath createPath public void setClasspath Path classpath if isReference throw tooManyAttributes if this classpath null this classpath classpath else this classpath append classpath setChecked false public void setClasspathRef Reference if isReference throw tooManyAttributes createClasspath setRefid setChecked false public Path createCatalogPath if isReference throw noChildrenAllowed if this catalogPath null this catalogPath new Path getProject setChecked false return this catalogPath createPath public void setCatalogPathRef Reference if isReference throw tooManyAttributes createCatalogPath setRefid setChecked false public Path getCatalogPath return getRef catalogPath public void addDTD ResourceLocation dtd throws BuildException if isReference throw noChildrenAllowed getElements addElement dtd setChecked false public void addEntity ResourceLocation entity throws BuildException addDTD entity public void addConfiguredXMLCatalog XMLCatalog catalog if isReference throw noChildrenAllowed Vector newElements catalog getElements Vector ourElements getElements Enumeration newElements elements while hasMoreElements ourElements addElement nextElement Path nestedClasspath catalog getClasspath createClasspath append nestedClasspath Path nestedCatalogPath catalog getCatalogPath createCatalogPath append nestedCatalogPath setChecked false public void setRefid Reference throws BuildException if elements isEmpty throw tooManyAttributes super setRefid public InputSource resolveEntity String publicId String systemId throws SAXException IOException if isReference return getRef resolveEntity publicId systemId dieOnCircularReference log publicId systemId Project MSG_DEBUG InputSource inputSource getCatalogResolver resolveEntity publicId systemId if inputSource null log systemId Project MSG_DEBUG return inputSource public Source resolve String href String base throws TransformerException if isReference return getRef resolve href base dieOnCircularReference SAXSource source null String uri removeFragment href log uri base Project MSG_DEBUG source SAXSource getCatalogResolver resolve uri base if source null log href Project MSG_DEBUG source new SAXSource URL baseURL null try if base null baseURL FILE_UTILS getFileURL getProject getBaseDir else baseURL new URL base URL url uri length baseURL new URL baseURL uri source setInputSource new InputSource url toString catch MalformedURLException ex source setInputSource new InputSource uri setEntityResolver source return source private XMLCatalog getRef if isReference return this return XMLCatalog getCheckedRef XMLCatalog class private CatalogResolver catalogResolver null private CatalogResolver getCatalogResolver if catalogResolver null AntClassLoader loader null loader getProject createClassLoader Path systemClasspath try Class clazz Class forName APACHE_RESOLVER true loader ClassLoader apacheResolverLoader clazz getClassLoader Class baseResolverClass Class forName CATALOG_RESOLVER true apacheResolverLoader ClassLoader baseResolverLoader baseResolverClass getClassLoader clazz Class forName APACHE_RESOLVER true baseResolverLoader Object obj clazz newInstance catalogResolver new ExternalResolver clazz obj catch Throwable ex catalogResolver new InternalResolver if getCatalogPath null getCatalogPath list length log Project MSG_WARN log ex Project MSG_DEBUG return catalogResolver private void setEntityResolver SAXSource source throws TransformerException XMLReader reader source getXMLReader if reader null SAXParserFactory spFactory SAXParserFactory newInstance spFactory setNamespaceAware true try reader spFactory newSAXParser getXMLReader catch ParserConfigurationException ex throw new TransformerException ex catch SAXException ex throw new TransformerException ex reader setEntityResolver this source setXMLReader reader private ResourceLocation findMatchingEntry String publicId Enumeration getElements elements ResourceLocation element null while hasMoreElements Object nextElement if instanceof ResourceLocation element ResourceLocation if element getPublicId equals publicId return element return null private String removeFragment String uri String result uri int hashPos uri indexOf if hashPos result uri substring hashPos return result private InputSource filesystemLookup ResourceLocation matchingEntry String uri matchingEntry getLocation uri uri replace File separatorChar URL baseURL null if matchingEntry getBase null baseURL matchingEntry getBase else try baseURL FILE_UTILS getFileURL getProject getBaseDir catch MalformedURLException ex throw new BuildException InputSource source null URL url null try url new URL baseURL uri catch MalformedURLException ex File testFile new File uri if testFile exists testFile canRead log uri Project MSG_DEBUG try url FILE_UTILS getFileURL testFile catch MalformedURLException ex1 throw new BuildException testFile getAbsolutePath else log uri Project MSG_DEBUG if url null url getProtocol equals String fileName FILE_UTILS fromURI url toString if fileName null log fileName Project MSG_DEBUG File resFile new File fileName if resFile exists resFile canRead try source new InputSource new FileInputStream resFile String sysid JAXPUtils getSystemId resFile source setSystemId sysid log sysid Project MSG_DEBUG catch IOException ex return source private InputSource classpathLookup ResourceLocation matchingEntry InputSource source null AntClassLoader loader null Path cp classpath if cp null cp classpath concatSystemClasspath else cp new Path getProject concatSystemClasspath loader getProject createClassLoader cp InputStream is loader getResourceAsStream matchingEntry getLocation if is null source new InputSource is URL entryURL loader getResource matchingEntry getLocation String sysid entryURL toExternalForm source setSystemId sysid log sysid Project MSG_DEBUG return source private InputSource urlLookup ResourceLocation matchingEntry String uri matchingEntry getLocation URL baseURL null if matchingEntry getBase null baseURL matchingEntry getBase else try baseURL FILE_UTILS getFileURL getProject getBaseDir catch MalformedURLException ex throw new BuildException InputSource source null URL url null try url new URL baseURL uri catch MalformedURLException ex if url null try InputStream is url openStream if is null source new InputSource is String sysid url toExternalForm source setSystemId sysid log sysid Project MSG_DEBUG catch IOException ex return source private interface CatalogResolver extends URIResolver EntityResolver InputSource resolveEntity String publicId String systemId Source resolve String href String base throws TransformerException private class InternalResolver implements CatalogResolver public InternalResolver log Project MSG_VERBOSE public InputSource resolveEntity String publicId String systemId InputSource result null ResourceLocation matchingEntry findMatchingEntry publicId if matchingEntry null log matchingEntry getPublicId matchingEntry getLocation Project MSG_DEBUG result filesystemLookup matchingEntry if result null result classpathLookup matchingEntry if result null result urlLookup matchingEntry return result public Source resolve String href String base throws TransformerException SAXSource result null InputSource source null ResourceLocation matchingEntry findMatchingEntry href if matchingEntry null log matchingEntry getPublicId matchingEntry getLocation Project MSG_DEBUG ResourceLocation entryCopy matchingEntry if base null try URL baseURL new URL base entryCopy new ResourceLocation entryCopy setBase baseURL catch MalformedURLException ex entryCopy setPublicId matchingEntry getPublicId entryCopy setLocation matchingEntry getLocation source filesystemLookup entryCopy if source null source classpathLookup entryCopy if source null source urlLookup entryCopy if source null result new SAXSource source return result private class ExternalResolver implements CatalogResolver private Method setXMLCatalog null private Method parseCatalog null private Method resolveEntity null private Method resolve null private Object resolverImpl null private boolean externalCatalogsProcessed false public ExternalResolver Class resolverImplClass Object resolverImpl this resolverImpl resolverImpl try setXMLCatalog resolverImplClass getMethod new Class XMLCatalog class parseCatalog resolverImplClass getMethod new Class String class resolveEntity resolverImplClass getMethod new Class String class String class resolve resolverImplClass getMethod new Class String class String class catch NoSuchMethodException ex throw new BuildException ex log Project MSG_VERBOSE public InputSource resolveEntity String publicId String systemId InputSource result null processExternalCatalogs ResourceLocation matchingEntry findMatchingEntry publicId if matchingEntry null log matchingEntry getPublicId matchingEntry getLocation Project MSG_DEBUG result filesystemLookup matchingEntry if result null result classpathLookup matchingEntry if result null try result InputSource resolveEntity invoke resolverImpl new Object publicId systemId catch Exception ex throw new BuildException ex else try result InputSource resolveEntity invoke resolverImpl new Object publicId systemId catch Exception ex throw new BuildException ex return result public Source resolve String href String base throws TransformerException SAXSource result null InputSource source null processExternalCatalogs ResourceLocation matchingEntry findMatchingEntry href if matchingEntry null log matchingEntry getPublicId matchingEntry getLocation Project MSG_DEBUG ResourceLocation entryCopy matchingEntry if base null try URL baseURL new URL base entryCopy new ResourceLocation entryCopy setBase baseURL catch MalformedURLException ex entryCopy setPublicId matchingEntry getPublicId entryCopy setLocation matchingEntry getLocation source filesystemLookup entryCopy if source null source classpathLookup entryCopy if source null result new SAXSource source else try result SAXSource resolve invoke resolverImpl new Object href base catch Exception ex throw new BuildException ex else try result SAXSource resolve invoke resolverImpl new Object href base catch Exception ex throw new BuildException ex return result private void processExternalCatalogs if externalCatalogsProcessed try setXMLCatalog invoke resolverImpl new Object XMLCatalog this catch Exception ex throw new BuildException ex Path catPath getCatalogPath if catPath null log getCatalogPath Project MSG_DEBUG String catPathList getCatalogPath list for int catPathList length File catFile new File catPathList log catFile Project MSG_DEBUG try parseCatalog invoke resolverImpl new Object catFile getPath catch Exception ex throw new BuildException ex externalCatalogsProcessed true public class Native2AsciiAdapterFactory public static String getDefault if JavaEnvUtils isKaffe return KaffeNative2Ascii IMPLEMENTATION_NAME return SunNative2Ascii IMPLEMENTATION_NAME public static Native2AsciiAdapter getAdapter String choice ProjectComponent log throws BuildException if JavaEnvUtils isKaffe choice null KaffeNative2Ascii IMPLEMENTATION_NAME equals choice return new KaffeNative2Ascii else if SunNative2Ascii IMPLEMENTATION_NAME equals choice return new SunNative2Ascii else if choice null return resolveClassName choice return new SunNative2Ascii private static Native2AsciiAdapter resolveClassName String className throws BuildException return Native2AsciiAdapter ClasspathUtils newInstance className Native2AsciiAdapterFactory class getClassLoader Native2AsciiAdapter class final class CRC static final int crc32Table CRC initialiseCRC void initialiseCRC globalCrc int getFinalCRC return globalCrc int getGlobalCRC return globalCrc void setGlobalCRC int newCrc globalCrc newCrc void updateCRC int inCh int temp globalCrc inCh if temp temp temp globalCrc globalCrc CRC crc32Table temp void updateCRC int inCh int repeat int globalCrcShadow this globalCrc while repeat int temp globalCrcShadow inCh globalCrcShadow globalCrcShadow crc32Table temp temp temp this globalCrc globalCrcShadow int globalCrc public class AptCompilerAdapter extends DefaultCompilerAdapter private static final int APT_COMPILER_SUCCESS public static final String APT_ENTRY_POINT public static final String APT_METHOD_NAME protected Apt getApt return Apt getJavac static void setAptCommandlineSwitches Apt apt Commandline cmd if apt isCompile cmd createArgument setValue String factory apt getFactory if factory null cmd createArgument setValue cmd createArgument setValue factory Path factoryPath apt getFactoryPath if factoryPath null cmd createArgument setValue cmd createArgument setPath factoryPath File preprocessDir apt getPreprocessDir if preprocessDir null cmd createArgument setValue cmd createArgument setFile preprocessDir Vector options apt getOptions Enumeration elements options elements Apt Option opt StringBuffer arg null while elements hasMoreElements opt Apt Option elements nextElement arg new StringBuffer arg append append opt getName if opt getValue null arg append append opt getValue cmd createArgument setValue arg toString protected void setAptCommandlineSwitches Commandline cmd Apt apt getApt setAptCommandlineSwitches apt cmd public boolean execute throws BuildException attributes log Project MSG_VERBOSE Commandline cmd setupModernJavacCommand setAptCommandlineSwitches cmd try Class Class forName APT_ENTRY_POINT Object compiler newInstance Method compile getMethod APT_METHOD_NAME new Class new String getClass int result Integer compile invoke compiler new Object cmd getArguments intValue return result APT_COMPILER_SUCCESS catch BuildException be throw be catch Exception ex throw new BuildException ex location public class GZip extends Pack protected void pack GZIPOutputStream zOut null try zOut new GZIPOutputStream new FileOutputStream zipFile zipResource getSrcResource zOut catch IOException ioe String msg ioe getMessage throw new BuildException msg ioe getLocation finally FileUtils close zOut protected boolean supportsNonFileResources return getClass equals GZip class public class CvsTagEntry private String filename private String prevRevision private String revision public CvsTagEntry final String filename this filename null null public CvsTagEntry final String filename final String revision this filename revision null public CvsTagEntry final String filename final String revision final String prevRevision this filename filename this revision revision this prevRevision prevRevision public String getFile return filename public String getRevision return revision public String getPreviousRevision return prevRevision public String toString StringBuffer buffer new StringBuffer buffer append filename if revision null buffer append if prevRevision null buffer append append prevRevision else if revision null prevRevision null buffer append append revision else if revision null prevRevision null buffer append append prevRevision append append revision return buffer toString public abstract class ContainerMapper implements FileNameMapper private List mappers new ArrayList public void addConfiguredMapper Mapper mapper add mapper getImplementation public void addConfigured FileNameMapper fileNameMapper add fileNameMapper public synchronized void add FileNameMapper fileNameMapper if this fileNameMapper fileNameMapper instanceof ContainerMapper ContainerMapper fileNameMapper contains this throw new IllegalArgumentException else mappers add fileNameMapper protected synchronized boolean contains FileNameMapper fileNameMapper boolean foundit false for Iterator iter mappers iterator iter hasNext foundit FileNameMapper next FileNameMapper iter next foundit next fileNameMapper next instanceof ContainerMapper ContainerMapper next contains fileNameMapper return foundit public synchronized List getMappers return Collections unmodifiableList mappers public void setFrom String ignore public void setTo String ignore public class XMLFragment extends ProjectComponent implements DynamicElementNS private Document doc private DocumentFragment fragment public XMLFragment doc JAXPUtils getDocumentBuilder newDocument fragment doc createDocumentFragment public DocumentFragment getFragment return fragment public void addText String addText fragment public Object createDynamicElement String uri String name String qName Element null if uri equals doc createElement name else doc createElementNS uri qName fragment appendChild return new Child private void addText Node String getProject replaceProperties if null trim equals Text doc createTextNode trim appendChild public class Child implements DynamicConfiguratorNS private Element Child Element this public void addText String XMLFragment this addText public void setDynamicAttribute String uri String name String qName String value if uri equals setAttribute name value else setAttributeNS uri qName value public Object createDynamicElement String uri String name String qName Element e2 null if uri equals e2 doc createElement name else e2 doc createElementNS uri qName appendChild e2 return new Child e2 public class SummaryJUnitResultFormatter implements JUnitResultFormatter JUnitTaskMirror SummaryJUnitResultFormatterMirror private NumberFormat nf NumberFormat getInstance private OutputStream out private boolean withOutAndErr false private String systemOutput null private String systemError null public SummaryJUnitResultFormatter public void startTestSuite JUnitTest suite String newLine System getProperty StringBuffer sb new StringBuffer sb append suite getName sb append newLine try out write sb toString getBytes out flush catch IOException ioex throw new BuildException ioex public void startTest Test public void endTest Test test public void addFailure Test test Throwable public void addFailure Test test AssertionFailedError addFailure test Throwable public void addError Test test Throwable public void setOutput OutputStream out this out out public void setSystemOutput String out systemOutput out public void setSystemError String err systemError err public void setWithOutAndErr boolean value withOutAndErr value public void endTestSuite JUnitTest suite throws BuildException String newLine System getProperty StringBuffer sb new StringBuffer sb append suite runCount sb append sb append suite failureCount sb append sb append suite errorCount sb append sb append nf format suite getRunTime sb append sb append newLine if withOutAndErr if systemOutput null systemOutput length sb append append newLine append systemOutput append newLine if systemError null systemError length sb append append newLine append systemError append newLine try out write sb toString getBytes out flush catch IOException ioex throw new BuildException ioex finally if out System out out System err try out close catch IOException public class Redirector private static final String DEFAULT_ENCODING System getProperty private class PropertyOutputStream extends ByteArrayOutputStream private String property private boolean closed false PropertyOutputStream String property super this property property public void close throws IOException if closed append appendProperties setPropertyFromBAOS this property closed true private File input private File out private File error private boolean logError false private PropertyOutputStream baos null private PropertyOutputStream errorBaos null private String outputProperty private String errorProperty private String inputString private boolean append false private boolean alwaysLog false private boolean createEmptyFiles true private ProjectComponent managingTask private OutputStream outputStream null private OutputStream errorStream null private InputStream inputStream null private PrintStream outPrintStream null private PrintStream errorPrintStream null private Vector outputFilterChains private Vector errorFilterChains private Vector inputFilterChains private String outputEncoding DEFAULT_ENCODING private String errorEncoding DEFAULT_ENCODING private String inputEncoding DEFAULT_ENCODING private boolean appendProperties true private ThreadGroup threadGroup new ThreadGroup private boolean logInputString true public Redirector Task managingTask this ProjectComponent managingTask public Redirector ProjectComponent managingTask this managingTask managingTask public void setInput File input setInput input null null new File input public synchronized void setInput File input this input input public synchronized void setInputString String inputString this inputString inputString public void setLogInputString boolean logInputString this logInputString logInputString this inputStream inputStream public void setOutput File out setOutput out null null new File out public synchronized void setOutput File out this out out public synchronized void setOutputEncoding String outputEncoding if outputEncoding null throw new IllegalArgumentException else this outputEncoding outputEncoding public synchronized void setErrorEncoding String errorEncoding if errorEncoding null throw new IllegalArgumentException else this errorEncoding errorEncoding public synchronized void setInputEncoding String inputEncoding if inputEncoding null throw new IllegalArgumentException else this inputEncoding inputEncoding public synchronized void setLogError boolean logError this logError logError public synchronized void setAppendProperties boolean appendProperties this appendProperties appendProperties public void setError File error setError error null null new File error public synchronized void setError File error this error error public synchronized void setOutputProperty String outputProperty if outputProperty null outputProperty equals this outputProperty this outputProperty outputProperty baos null public synchronized void setAppend boolean append this append append public synchronized void setAlwaysLog boolean alwaysLog this alwaysLog alwaysLog public synchronized void setCreateEmptyFiles boolean createEmptyFiles this createEmptyFiles createEmptyFiles public synchronized void setErrorProperty String errorProperty if errorProperty null errorProperty equals this errorProperty this errorProperty errorProperty errorBaos null public synchronized void setInputFilterChains Vector inputFilterChains this inputFilterChains inputFilterChains public synchronized void setOutputFilterChains Vector outputFilterChains this outputFilterChains outputFilterChains public synchronized void setErrorFilterChains Vector errorFilterChains this errorFilterChains errorFilterChains private void setPropertyFromBAOS ByteArrayOutputStream baos String propertyName throws IOException BufferedReader in new BufferedReader new StringReader Execute toString baos String line null StringBuffer val new StringBuffer while line in readLine null if val length val append StringUtils LINE_SEP val append line managingTask getProject setNewProperty propertyName val toString public synchronized void createStreams if out null out length String logHead new StringBuffer append append append toString outputStream foldFiles out logHead Project MSG_VERBOSE if outputProperty null if baos null baos new PropertyOutputStream outputProperty managingTask log outputProperty Project MSG_VERBOSE OutputStream keepAliveOutput new KeepAliveOutputStream baos outputStream outputStream null keepAliveOutput new TeeOutputStream outputStream keepAliveOutput else baos null if error null error length String logHead new StringBuffer append append append toString errorStream foldFiles error logHead Project MSG_VERBOSE else if logError outputStream null long funnelTimeout OutputStreamFunneler funneler new OutputStreamFunneler outputStream funnelTimeout try outputStream funneler getFunnelInstance errorStream funneler getFunnelInstance catch IOException eyeOhEx throw new BuildException eyeOhEx if errorProperty null if errorBaos null errorBaos new PropertyOutputStream errorProperty managingTask log errorProperty Project MSG_VERBOSE OutputStream keepAliveError new KeepAliveOutputStream errorBaos errorStream error null error length keepAliveError new TeeOutputStream errorStream keepAliveError else errorBaos null if alwaysLog outputStream null OutputStream outputLog new LogOutputStream managingTask Project MSG_INFO outputStream outputStream null outputLog new TeeOutputStream outputLog outputStream if alwaysLog errorStream null OutputStream errorLog new LogOutputStream managingTask Project MSG_WARN errorStream errorStream null errorLog new TeeOutputStream errorLog errorStream if outputFilterChains null outputFilterChains size outputEncoding equalsIgnoreCase inputEncoding try LeadPipeInputStream snk new LeadPipeInputStream snk setManagingComponent managingTask InputStream outPumpIn snk Reader reader new InputStreamReader outPumpIn inputEncoding if outputFilterChains null outputFilterChains size ChainReaderHelper helper new ChainReaderHelper helper setProject managingTask getProject helper setPrimaryReader reader helper setFilterChains outputFilterChains reader helper getAssembledReader outPumpIn new ReaderInputStream reader outputEncoding Thread new Thread threadGroup new StreamPumper outPumpIn outputStream true setPriority Thread MAX_PRIORITY outputStream new PipedOutputStream snk start catch IOException eyeOhEx throw new BuildException eyeOhEx if errorFilterChains null errorFilterChains size errorEncoding equalsIgnoreCase inputEncoding try LeadPipeInputStream snk new LeadPipeInputStream snk setManagingComponent managingTask InputStream errPumpIn snk Reader reader new InputStreamReader errPumpIn inputEncoding if errorFilterChains null errorFilterChains size ChainReaderHelper helper new ChainReaderHelper helper setProject managingTask getProject helper setPrimaryReader reader helper setFilterChains errorFilterChains reader helper getAssembledReader errPumpIn new ReaderInputStream reader errorEncoding Thread new Thread threadGroup new StreamPumper errPumpIn errorStream true setPriority Thread MAX_PRIORITY errorStream new PipedOutputStream snk start catch IOException eyeOhEx throw new BuildException eyeOhEx if input null input length managingTask log input length Project MSG_VERBOSE try inputStream new ConcatFileInputStream input catch IOException eyeOhEx throw new BuildException eyeOhEx ConcatFileInputStream inputStream setManagingComponent managingTask else if inputString null StringBuffer buf new StringBuffer if logInputString buf append append inputString append else buf append managingTask log buf toString Project MSG_VERBOSE inputStream new ByteArrayInputStream inputString getBytes if inputStream null inputFilterChains null inputFilterChains size ChainReaderHelper helper new ChainReaderHelper helper setProject managingTask getProject try helper setPrimaryReader new InputStreamReader inputStream inputEncoding catch IOException eyeOhEx throw new BuildException eyeOhEx helper setFilterChains inputFilterChains inputStream new ReaderInputStream helper getAssembledReader inputEncoding public synchronized ExecuteStreamHandler createHandler throws BuildException createStreams return new PumpStreamHandler outputStream errorStream inputStream protected synchronized void handleOutput String output if outPrintStream null outPrintStream new PrintStream outputStream outPrintStream print output protected synchronized int handleInput byte buffer int offset int length throws IOException if inputStream null return managingTask getProject defaultInput buffer offset length else return inputStream read buffer offset length protected synchronized void handleFlush String output if outPrintStream null outPrintStream new PrintStream outputStream outPrintStream print output outPrintStream flush protected synchronized void handleErrorOutput String output if errorPrintStream null errorPrintStream new PrintStream errorStream errorPrintStream print output protected synchronized void handleErrorFlush String output if errorPrintStream null errorPrintStream new PrintStream errorStream errorPrintStream print output public synchronized OutputStream getOutputStream return outputStream public synchronized OutputStream getErrorStream return errorStream public synchronized InputStream getInputStream return inputStream public synchronized void complete throws IOException System out flush System err flush if inputStream null inputStream close outputStream flush outputStream close errorStream flush errorStream close while threadGroup activeCount try managingTask log threadGroup activeCount Project MSG_DEBUG Thread thread new Thread threadGroup activeCount threadGroup enumerate thread for int thread length thread null try managingTask log thread toString Project MSG_DEBUG catch NullPointerException enPeaEx wait catch InterruptedException eyeEx setProperties inputStream null outputStream null errorStream null outPrintStream null errorPrintStream null public synchronized void setProperties if baos null try baos close catch IOException eyeOhEx if errorBaos null try errorBaos close catch IOException eyeOhEx private OutputStream foldFiles File file String logHead int loglevel OutputStream result new LazyFileOutputStream file append createEmptyFiles managingTask log logHead file loglevel char new char logHead length Arrays fill String indent new String for int file length outputStream new TeeOutputStream outputStream new LazyFileOutputStream file append createEmptyFiles managingTask log indent file loglevel return result public final class ZipShort implements Cloneable private int value public ZipShort int value this value value public ZipShort byte bytes this bytes public ZipShort byte bytes int offset value ZipShort getValue bytes offset public byte getBytes byte result new byte result byte value result byte value return result public int getValue return value public static byte getBytes int value byte result new byte result byte value result byte value return result public static int getValue byte bytes int offset int value bytes offset value bytes offset return value public static int getValue byte bytes return getValue bytes public boolean equals Object if null instanceof ZipShort return false return value ZipShort getValue public int hashCode return value public class FileResourceIterator implements Iterator private File basedir private String files private int pos public FileResourceIterator public FileResourceIterator File basedir public FileResourceIterator File String this addFiles public void addFiles String int start files null files length String newfiles new String start length if start System arraycopy files newfiles start files newfiles System arraycopy files start length public boolean hasNext return pos files length public Object next return nextResource public void remove throw new UnsupportedOperationException public FileResource nextResource if hasNext throw new NoSuchElementException return new FileResource basedir files pos public interface TaskContainer void addTask Task task public class AndSelector extends BaseSelectorContainer public AndSelector public String toString StringBuffer buf new StringBuffer if hasSelectors buf append buf append super toString buf append return buf toString public boolean isSelected File basedir String filename File file validate Enumeration selectorElements boolean result while hasMoreElements result FileSelector nextElement isSelected basedir filename file if result return false return true public class JakartaOroRegexp extends JakartaOroMatcher implements Regexp public JakartaOroRegexp super public String substitute String input String argument int options throws BuildException StringBuffer subst new StringBuffer for int argument length char argument charAt if subst append subst append else if if argument length argument charAt int value Character digit if value subst append append value else subst append else subst append else subst append Substitution new Perl5Substitution subst toString Perl5Substitution INTERPOLATE_ALL return Util substitute matcher getCompiledPattern options input getSubsOptions options protected int getSubsOptions int options boolean replaceAll RegexpUtil hasFlag options REPLACE_ALL int subsOptions if replaceAll subsOptions Util SUBSTITUTE_ALL return subsOptions public interface CompilerAdapter void setJavac Javac attributes boolean execute throws BuildException public abstract class DotnetCompile extends DotnetBaseMatchingTask private String references private boolean includeDefaultReferences true private File win32icon private File win32res private boolean failOnError private Path referenceFiles private boolean optimize protected Vector definitionList new Vector protected Vector resources new Vector protected String executable protected static final String REFERENCE_OPTION protected boolean debug private int warnLevel protected String mainClass protected String extraOptions protected String targetType protected boolean utf8output false protected String additionalModules protected Vector referenceFilesets new Vector private boolean useResponseFile false private static final int AUTOMATIC_RESPONSE_FILE_THRESHOLD public DotnetCompile clear setIncludes getFilePattern public void clear targetType null win32icon null srcDir null mainClass null warnLevel optimize false debug true references null failOnError true additionalModules null includeDefaultReferences true extraOptions null public void setReferences String references protected String getReferencesParameter if notEmpty references if isWindows return REFERENCE_OPTION references else return REFERENCE_OPTION references else return null public void setReferenceFiles Path path if referenceFiles null referenceFiles new Path this getProject referenceFiles append path public void addReference FileSet reference referenceFilesets add reference protected String getReferenceFilesParameter if references null return null if references length return null StringBuffer new StringBuffer REFERENCE_OPTION if isWindows append append references if isWindows append return toString public void setIncludeDefaultReferences boolean includeDefaultReferences public boolean getIncludeDefaultReferences return includeDefaultReferences protected String getIncludeDefaultReferencesParameter return includeDefaultReferences public void setOptimize boolean optimize public boolean getOptimize return optimize protected String getOptimizeParameter return optimize public void setDebug boolean debug public boolean getDebug return debug protected String getDebugParameter return debug public void setWarnLevel int warnLevel this warnLevel warnLevel public int getWarnLevel return warnLevel protected String getWarnLevelParameter return warnLevel public void setMainClass String mainClass this mainClass mainClass public String getMainClass return this mainClass protected String getMainClassParameter if mainClass null mainClass length return mainClass else return null public void setExtraOptions String extraOptions this extraOptions extraOptions public String getExtraOptions return this extraOptions protected String getExtraOptionsParameter if extraOptions null extraOptions length return extraOptions else return null protected String getExtraOptionsParameters String extra getExtraOptionsParameter return extra null null Commandline translateCommandline extra public void setDestDir File dirName log Project MSG_WARN public void setTargetType TargetTypes targetType this targetType targetType getValue public void setTargetType String ttype throws BuildException ttype ttype toLowerCase if ttype equals ttype equals ttype equals ttype equals targetType ttype else throw new BuildException ttype public String getTargetType return targetType protected String getTargetTypeParameter if notEmpty targetType return targetType else return null public void setWin32Icon File fileName win32icon fileName protected String getWin32IconParameter if win32icon null return win32icon toString else return null public void setWin32Res File fileName win32res fileName public File getWin32Res return win32res protected String getWin32ResParameter if win32res null return win32res toString else return null public void setUtf8Output boolean enabled utf8output enabled protected String getUtf8OutputParameter return utf8output null public void addDefine DotnetDefine define definitionList addElement define protected String getDefinitionsParameter throws BuildException StringBuffer defines new StringBuffer Enumeration defEnum definitionList elements boolean firstDefinition true while defEnum hasMoreElements DotnetDefine define DotnetDefine defEnum nextElement if define isSet this if firstDefinition defines append getDefinitionsDelimiter defines append define getValue this firstDefinition false if defines length return null else return defines public void setAdditionalModules String params additionalModules params protected String getAdditionalModulesParameter if notEmpty additionalModules return additionalModules else return null protected String getDestFileParameter if outputFile null return outputFile toString else return null public void setFailOnError boolean failOnError public boolean getFailOnError return failOnError public void addResource DotnetResource resource resources add resource protected String getExecutable return executable public void setExecutable String executable this executable executable protected boolean notEmpty String return null length protected void validate throws BuildException if outputFile null outputFile isDirectory throw new BuildException if getExecutable null throw new BuildException public String getFilePattern public boolean isUseResponseFile return useResponseFile public void setUseResponseFile boolean useResponseFile this useResponseFile useResponseFile public void execute throws BuildException log Project MSG_WARN validate NetCommand command createNetCommand command setAutomaticResponseFileThreshold AUTOMATIC_RESPONSE_FILE_THRESHOLD command setUseResponseFile useResponseFile fillInSharedParameters command addResources command addCompilerSpecificOptions command int referencesOutOfDate addReferenceFilesets command getOutputFileTimestamp boolean forceBuild referencesOutOfDate addFilesAndExecute command forceBuild public abstract String getReferenceDelimiter public abstract String getFileExtension protected void fillInSharedParameters NetCommand command command setFailOnError getFailOnError command addArgument command addArgument getAdditionalModulesParameter command addArgument getDebugParameter command addArgument getDefinitionsParameter command addArguments getExtraOptionsParameters command addArgument getMainClassParameter command addArgument getOptimizeParameter command addArgument getDestFileParameter command addArgument getReferencesParameter command addArgument getTargetTypeParameter command addArgument getUtf8OutputParameter command addArgument getWin32IconParameter command addArgument getWin32ResParameter protected void addResources NetCommand command Enumeration resources elements while hasMoreElements DotnetResource resource DotnetResource nextElement createResourceParameter command resource protected abstract void createResourceParameter NetCommand command DotnetResource resource protected int addReferenceFilesets NetCommand command long outputTimestamp int filesOutOfDate Hashtable filesToBuild new Hashtable for int referenceFilesets size FileSet fs FileSet referenceFilesets elementAt filesOutOfDate command scanOneFileset fs getDirectoryScanner getProject filesToBuild outputTimestamp if filesToBuild size return Enumeration files filesToBuild elements while files hasMoreElements File file File files nextElement if isFileManagedBinary file if isWindows command addArgument REFERENCE_OPTION file toString else command addArgument REFERENCE_OPTION file toString else log file Project MSG_VERBOSE return filesOutOfDate protected NetCommand createNetCommand NetCommand command new NetCommand this getTaskName getExecutable return command protected abstract void addCompilerSpecificOptions NetCommand command public String getDefinitionsDelimiter return protected static boolean isFileManagedBinary File file String filename file toString toLowerCase return filename endsWith filename endsWith filename endsWith public static class TargetTypes extends EnumeratedAttribute public String getValues return new String public class PlainJUnitResultFormatter implements JUnitResultFormatter private NumberFormat nf NumberFormat getInstance private Hashtable testStarts new Hashtable private OutputStream out private StringWriter inner private PrintWriter wri private Hashtable failed new Hashtable private String systemOutput null private String systemError null public PlainJUnitResultFormatter inner new StringWriter wri new PrintWriter inner public void setOutput OutputStream out this out out public void setSystemOutput String out systemOutput out public void setSystemError String err systemError err public void startTestSuite JUnitTest suite throws BuildException if out null StringBuffer sb new StringBuffer sb append suite getName sb append StringUtils LINE_SEP try out write sb toString getBytes out flush catch IOException ex throw new BuildException ex public void endTestSuite JUnitTest suite throws BuildException StringBuffer sb new StringBuffer sb append suite runCount sb append sb append suite failureCount sb append sb append suite errorCount sb append sb append nf format suite getRunTime sb append sb append StringUtils LINE_SEP if systemOutput null systemOutput length sb append append StringUtils LINE_SEP append systemOutput append append StringUtils LINE_SEP if systemError null systemError length sb append append StringUtils LINE_SEP append systemError append append StringUtils LINE_SEP sb append StringUtils LINE_SEP if out null try out write sb toString getBytes wri close out write inner toString getBytes out flush catch IOException ioex throw new BuildException ioex finally if out System out out System err FileUtils close out public void startTest Test testStarts put new Long System currentTimeMillis failed put Boolean FALSE public void endTest Test test if Boolean TRUE equals failed get test return synchronized wri wri print JUnitVersionHelper getTestCaseName test Long Long testStarts get test double seconds if null seconds System currentTimeMillis longValue wri println nf format seconds public void addFailure Test test Throwable formatError test public void addFailure Test test AssertionFailedError addFailure test Throwable public void addError Test test Throwable formatError test private void formatError String type Test test Throwable synchronized wri if test null endTest test failed put test Boolean TRUE wri println type wri println getMessage String strace JUnitTestRunner getFilteredTrace wri print strace wri println public class Sequential extends Task implements TaskContainer private Vector nestedTasks new Vector public void addTask Task nestedTask nestedTasks addElement nestedTask public void execute throws BuildException for Iterator nestedTasks iterator hasNext Task nestedTask Task next nestedTask perform public abstract class AbstractFileSet extends DataType implements Cloneable SelectorContainer private PatternSet defaultPatterns new PatternSet private Vector additionalPatterns new Vector private Vector selectors new Vector private File dir private boolean useDefaultExcludes true private boolean caseSensitive true private boolean followSymlinks true private DirectoryScanner directoryScanner null public AbstractFileSet super protected AbstractFileSet AbstractFileSet fileset this dir fileset dir this defaultPatterns fileset defaultPatterns this additionalPatterns fileset additionalPatterns this selectors fileset selectors this useDefaultExcludes fileset useDefaultExcludes this caseSensitive fileset caseSensitive this followSymlinks fileset followSymlinks setProject fileset getProject public void setRefid Reference throws BuildException if dir null defaultPatterns hasPatterns getProject throw tooManyAttributes if additionalPatterns isEmpty throw noChildrenAllowed if selectors isEmpty throw noChildrenAllowed super setRefid public synchronized void setDir File dir throws BuildException if isReference throw tooManyAttributes this dir dir directoryScanner null public File getDir return getDir getProject public synchronized File getDir Project return isReference getRef getDir dir public synchronized PatternSet createPatternSet if isReference throw noChildrenAllowed PatternSet patterns new PatternSet additionalPatterns addElement patterns directoryScanner null return patterns public synchronized PatternSet NameEntry createInclude if isReference throw noChildrenAllowed directoryScanner null return defaultPatterns createInclude public synchronized PatternSet NameEntry createIncludesFile if isReference throw noChildrenAllowed directoryScanner null return defaultPatterns createIncludesFile public synchronized PatternSet NameEntry createExclude if isReference throw noChildrenAllowed directoryScanner null return defaultPatterns createExclude public synchronized PatternSet NameEntry createExcludesFile if isReference throw noChildrenAllowed directoryScanner null return defaultPatterns createExcludesFile public synchronized void setFile File file if isReference throw tooManyAttributes setDir file getParentFile createInclude setName file getName public synchronized void setIncludes String includes if isReference throw tooManyAttributes defaultPatterns setIncludes includes directoryScanner null public synchronized void appendIncludes String includes if isReference throw tooManyAttributes if includes null for int includes length defaultPatterns createInclude setName includes directoryScanner null public synchronized void setExcludes String excludes if isReference throw tooManyAttributes defaultPatterns setExcludes excludes directoryScanner null public synchronized void appendExcludes String excludes if isReference throw tooManyAttributes if excludes null for int excludes length defaultPatterns createExclude setName excludes directoryScanner null public synchronized void setIncludesfile File incl throws BuildException if isReference throw tooManyAttributes defaultPatterns setIncludesfile incl directoryScanner null public synchronized void setExcludesfile File excl throws BuildException if isReference throw tooManyAttributes defaultPatterns setExcludesfile excl directoryScanner null public synchronized void setDefaultexcludes boolean useDefaultExcludes if isReference throw tooManyAttributes this useDefaultExcludes useDefaultExcludes directoryScanner null public synchronized boolean getDefaultexcludes return isReference getRef getProject getDefaultexcludes useDefaultExcludes public synchronized void setCaseSensitive boolean caseSensitive if isReference throw tooManyAttributes this caseSensitive caseSensitive directoryScanner null public synchronized boolean isCaseSensitive return isReference getRef getProject isCaseSensitive caseSensitive public synchronized void setFollowSymlinks boolean followSymlinks if isReference throw tooManyAttributes this followSymlinks followSymlinks directoryScanner null public synchronized boolean isFollowSymlinks return isReference getRef getProject isFollowSymlinks followSymlinks public DirectoryScanner getDirectoryScanner return getDirectoryScanner getProject public DirectoryScanner getDirectoryScanner Project if isReference return getRef getDirectoryScanner DirectoryScanner ds null synchronized this if directoryScanner null getProject ds directoryScanner else if dir null throw new BuildException getDataTypeName if dir exists throw new BuildException dir getAbsolutePath if dir isDirectory throw new BuildException dir getAbsolutePath ds new DirectoryScanner setupDirectoryScanner ds ds setFollowSymlinks followSymlinks directoryScanner getProject ds directoryScanner ds scan return ds public void setupDirectoryScanner FileScanner ds setupDirectoryScanner ds getProject public synchronized void setupDirectoryScanner FileScanner ds Project if isReference getRef setupDirectoryScanner ds return if ds null throw new IllegalArgumentException ds setBasedir dir PatternSet ps mergePatterns log getDataTypeName dir ps Project MSG_DEBUG ds setIncludes ps getIncludePatterns ds setExcludes ps getExcludePatterns if ds instanceof SelectorScanner SelectorScanner ss SelectorScanner ds ss setSelectors getSelectors if useDefaultExcludes ds addDefaultExcludes ds setCaseSensitive caseSensitive protected AbstractFileSet getRef Project return AbstractFileSet getCheckedRef public synchronized boolean hasSelectors return isReference getProject null getRef getProject hasSelectors selectors isEmpty public synchronized boolean hasPatterns if isReference getProject null return getRef getProject hasPatterns if defaultPatterns hasPatterns getProject return true Enumeration additionalPatterns elements while hasMoreElements PatternSet ps PatternSet nextElement if ps hasPatterns getProject return true return false public synchronized int selectorCount return isReference getProject null getRef getProject selectorCount selectors size public synchronized FileSelector getSelectors Project return isReference getRef getSelectors FileSelector selectors toArray new FileSelector selectors size public synchronized Enumeration selectorElements return isReference getProject null getRef getProject selectorElements selectors elements public synchronized void appendSelector FileSelector selector if isReference throw noChildrenAllowed selectors addElement selector directoryScanner null public void addSelector SelectSelector selector appendSelector selector public void addAnd AndSelector selector appendSelector selector public void addOr OrSelector selector appendSelector selector public void addNot NotSelector selector appendSelector selector public void addNone NoneSelector selector appendSelector selector public void addMajority MajoritySelector selector appendSelector selector public void addDate DateSelector selector appendSelector selector public void addSize SizeSelector selector appendSelector selector public void addDifferent DifferentSelector selector appendSelector selector public void addFilename FilenameSelector selector appendSelector selector public void addType TypeSelector selector appendSelector selector public void addCustom ExtendSelector selector appendSelector selector public void addContains ContainsSelector selector appendSelector selector public void addPresent PresentSelector selector appendSelector selector public void addDepth DepthSelector selector appendSelector selector public void addDepend DependSelector selector appendSelector selector public void addContainsRegexp ContainsRegexpSelector selector appendSelector selector public void addModified ModifiedSelector selector appendSelector selector public void add FileSelector selector appendSelector selector public String toString DirectoryScanner ds getDirectoryScanner getProject String files ds getIncludedFiles StringBuffer sb new StringBuffer for int files length if sb append sb append files return sb toString public synchronized Object clone if isReference return getRef getProject clone else try AbstractFileSet fs AbstractFileSet super clone fs defaultPatterns PatternSet defaultPatterns clone fs additionalPatterns new Vector additionalPatterns size Enumeration additionalPatterns elements while hasMoreElements fs additionalPatterns addElement PatternSet nextElement clone fs selectors new Vector selectors return fs catch CloneNotSupportedException throw new BuildException public String mergeIncludes Project return mergePatterns getIncludePatterns public String mergeExcludes Project return mergePatterns getExcludePatterns public synchronized PatternSet mergePatterns Project if isReference return getRef mergePatterns PatternSet ps PatternSet defaultPatterns clone final int count additionalPatterns size for int count Object additionalPatterns elementAt ps append PatternSet return ps public class InterfaceMethodRefCPInfo extends ConstantPoolEntry private String interfaceMethodClassName private String interfaceMethodName private String interfaceMethodType private int classIndex private int nameAndTypeIndex public InterfaceMethodRefCPInfo super CONSTANT_INTERFACEMETHODREF public void read DataInputStream cpStream throws IOException classIndex cpStream readUnsignedShort nameAndTypeIndex cpStream readUnsignedShort public void resolve ConstantPool constantPool ClassCPInfo interfaceMethodClass ClassCPInfo constantPool getEntry classIndex interfaceMethodClass resolve constantPool interfaceMethodClassName interfaceMethodClass getClassName NameAndTypeCPInfo nt NameAndTypeCPInfo constantPool getEntry nameAndTypeIndex nt resolve constantPool interfaceMethodName nt getName interfaceMethodType nt getType super resolve constantPool public String toString String value if isResolved value interfaceMethodClassName interfaceMethodName interfaceMethodType else value classIndex nameAndTypeIndex return value public String getInterfaceMethodClassName return interfaceMethodClassName public String getInterfaceMethodName return interfaceMethodName public String getInterfaceMethodType return interfaceMethodType public interface FileScanner void addDefaultExcludes File getBasedir String getExcludedDirectories String getExcludedFiles String getIncludedDirectories String getIncludedFiles String getNotIncludedDirectories String getNotIncludedFiles void scan throws IllegalStateException void setBasedir String basedir void setBasedir File basedir void setExcludes String excludes void setIncludes String includes void setCaseSensitive boolean isCaseSensitive public interface EJBDeploymentTool void processDescriptor String descriptorFilename SAXParser saxParser throws BuildException void validateConfigured throws BuildException void setTask Task task void configure EjbJar Config config public final class JarLibManifestTask extends Task private static final String MANIFEST_VERSION private static final String CREATED_BY private File destFile private Extension extension private final ArrayList dependencies new ArrayList private final ArrayList optionals new ArrayList private final ArrayList extraAttributes new ArrayList public void setDestfile final File destFile this destFile destFile public void addConfiguredExtension final ExtensionAdapter extensionAdapter throws BuildException if null extension final String message throw new BuildException message extension extensionAdapter toExtension public void addConfiguredDepends final ExtensionSet extensionSet dependencies add extensionSet public void addConfiguredOptions final ExtensionSet extensionSet optionals add extensionSet public void addConfiguredAttribute final ExtraAttribute attribute extraAttributes add attribute public void execute throws BuildException validate final Manifest manifest new Manifest final Attributes attributes manifest getMainAttributes attributes put Attributes Name MANIFEST_VERSION MANIFEST_VERSION final String createdBy getProject getProperty MagicNames ANT_VERSION attributes putValue CREATED_BY createdBy appendExtraAttributes attributes if null extension Extension addExtension extension attributes final ArrayList depends toExtensions dependencies appendExtensionList attributes Extension EXTENSION_LIST depends size appendLibraryList attributes depends final ArrayList option toExtensions optionals appendExtensionList attributes Extension OPTIONAL_EXTENSION_LIST option size appendLibraryList attributes option try final String message destFile getAbsoluteFile log message Project MSG_INFO writeManifest manifest catch final IOException ioe throw new BuildException ioe getMessage ioe private void validate throws BuildException if null destFile final String message throw new BuildException message if destFile exists destFile isFile final String message destFile throw new BuildException message private void appendExtraAttributes final Attributes attributes final Iterator iterator extraAttributes iterator while iterator hasNext final ExtraAttribute attribute ExtraAttribute iterator next attributes putValue attribute getName attribute getValue private void writeManifest final Manifest manifest throws IOException FileOutputStream output null try output new FileOutputStream destFile manifest write output output flush finally if null output try output close catch IOException private void appendLibraryList final Attributes attributes final String listPrefix final ArrayList extensions throws BuildException final int size extensions size for int size final Extension ext Extension extensions get final String prefix listPrefix Extension addExtension ext prefix attributes private void appendExtensionList final Attributes attributes final Attributes Name extensionKey final String listPrefix final int size final StringBuffer sb new StringBuffer for int size sb append listPrefix sb append sb append attributes put extensionKey sb toString private ArrayList toExtensions final ArrayList extensionSets throws BuildException final ArrayList results new ArrayList final int size extensionSets size for int size final ExtensionSet set ExtensionSet extensionSets get final Extension extensions set toExtensions getProject for int extensions length results add extensions return results public final class Extension public static final Attributes Name EXTENSION_LIST new Attributes Name public static final Attributes Name OPTIONAL_EXTENSION_LIST new Attributes Name public static final Attributes Name EXTENSION_NAME new Attributes Name public static final Attributes Name SPECIFICATION_VERSION Attributes Name SPECIFICATION_VERSION public static final Attributes Name SPECIFICATION_VENDOR Attributes Name SPECIFICATION_VENDOR public static final Attributes Name IMPLEMENTATION_VERSION Attributes Name IMPLEMENTATION_VERSION public static final Attributes Name IMPLEMENTATION_VENDOR Attributes Name IMPLEMENTATION_VENDOR public static final Attributes Name IMPLEMENTATION_URL new Attributes Name public static final Attributes Name IMPLEMENTATION_VENDOR_ID new Attributes Name public static final Compatibility COMPATIBLE new Compatibility public static final Compatibility REQUIRE_SPECIFICATION_UPGRADE new Compatibility public static final Compatibility REQUIRE_VENDOR_SWITCH new Compatibility public static final Compatibility REQUIRE_IMPLEMENTATION_UPGRADE new Compatibility public static final Compatibility INCOMPATIBLE new Compatibility private String extensionName private DeweyDecimal specificationVersion private String specificationVendor private String implementationVendorID private String implementationVendor private DeweyDecimal implementationVersion private String implementationURL public static Extension getAvailable final Manifest manifest if null manifest return new Extension final ArrayList results new ArrayList final Attributes mainAttributes manifest getMainAttributes if null mainAttributes final Extension extension getExtension mainAttributes if null extension results add extension final Map entries manifest getEntries final Iterator keys entries keySet iterator while keys hasNext final String key String keys next final Attributes attributes Attributes entries get key final Extension extension getExtension attributes if null extension results add extension return Extension results toArray new Extension results size public static Extension getRequired final Manifest manifest return getListed manifest Attributes Name EXTENSION_LIST public static Extension getOptions final Manifest manifest return getListed manifest OPTIONAL_EXTENSION_LIST public static void addExtension final Extension extension final Attributes attributes addExtension extension attributes public static void addExtension final Extension extension final String prefix final Attributes attributes attributes putValue prefix EXTENSION_NAME extension getExtensionName final String specificationVendor extension getSpecificationVendor if null specificationVendor attributes putValue prefix SPECIFICATION_VENDOR specificationVendor final DeweyDecimal specificationVersion extension getSpecificationVersion if null specificationVersion attributes putValue prefix SPECIFICATION_VERSION specificationVersion toString final String implementationVendorID extension getImplementationVendorID if null implementationVendorID attributes putValue prefix IMPLEMENTATION_VENDOR_ID implementationVendorID final String implementationVendor extension getImplementationVendor if null implementationVendor attributes putValue prefix IMPLEMENTATION_VENDOR implementationVendor final DeweyDecimal implementationVersion extension getImplementationVersion if null implementationVersion attributes putValue prefix IMPLEMENTATION_VERSION implementationVersion toString final String implementationURL extension getImplementationURL if null implementationURL attributes putValue prefix IMPLEMENTATION_URL implementationURL public Extension final String extensionName final String specificationVersion final String specificationVendor final String implementationVersion final String implementationVendor final String implementationVendorId final String implementationURL this extensionName extensionName this specificationVendor specificationVendor if null specificationVersion try this specificationVersion new DeweyDecimal specificationVersion catch final NumberFormatException nfe final String error specificationVersion extensionName nfe throw new IllegalArgumentException error this implementationURL implementationURL this implementationVendor implementationVendor this implementationVendorID implementationVendorId if null implementationVersion try this implementationVersion new DeweyDecimal implementationVersion catch final NumberFormatException nfe final String error implementationVersion extensionName nfe throw new IllegalArgumentException error if null this extensionName throw new NullPointerException public String getExtensionName return extensionName public String getSpecificationVendor return specificationVendor public DeweyDecimal getSpecificationVersion return specificationVersion public String getImplementationURL return implementationURL public String getImplementationVendor return implementationVendor public String getImplementationVendorID return implementationVendorID public DeweyDecimal getImplementationVersion return implementationVersion public Compatibility getCompatibilityWith final Extension required if extensionName equals required getExtensionName return INCOMPATIBLE final DeweyDecimal requiredSpecificationVersion required getSpecificationVersion if null requiredSpecificationVersion if null specificationVersion isCompatible specificationVersion requiredSpecificationVersion return REQUIRE_SPECIFICATION_UPGRADE final String requiredImplementationVendorID required getImplementationVendorID if null requiredImplementationVendorID if null implementationVendorID implementationVendorID equals requiredImplementationVendorID return REQUIRE_VENDOR_SWITCH final DeweyDecimal requiredImplementationVersion required getImplementationVersion if null requiredImplementationVersion if null implementationVersion isCompatible implementationVersion requiredImplementationVersion return REQUIRE_IMPLEMENTATION_UPGRADE return COMPATIBLE public boolean isCompatibleWith final Extension required return COMPATIBLE getCompatibilityWith required public String toString final String brace final StringBuffer sb new StringBuffer EXTENSION_NAME toString sb append brace sb append extensionName sb append StringUtils LINE_SEP if null specificationVersion sb append SPECIFICATION_VERSION sb append brace sb append specificationVersion sb append StringUtils LINE_SEP if null specificationVendor sb append SPECIFICATION_VENDOR sb append brace sb append specificationVendor sb append StringUtils LINE_SEP if null implementationVersion sb append IMPLEMENTATION_VERSION sb append brace sb append implementationVersion sb append StringUtils LINE_SEP if null implementationVendorID sb append IMPLEMENTATION_VENDOR_ID sb append brace sb append implementationVendorID sb append StringUtils LINE_SEP if null implementationVendor sb append IMPLEMENTATION_VENDOR sb append brace sb append implementationVendor sb append StringUtils LINE_SEP if null implementationURL sb append IMPLEMENTATION_URL sb append brace sb append implementationURL sb append StringUtils LINE_SEP return sb toString private boolean isCompatible final DeweyDecimal first final DeweyDecimal second return first isGreaterThanOrEqual second private static Extension getListed final Manifest manifest final Attributes Name listKey final ArrayList results new ArrayList final Attributes mainAttributes manifest getMainAttributes if null mainAttributes getExtension mainAttributes results listKey final Map entries manifest getEntries final Iterator keys entries keySet iterator while keys hasNext final String key String keys next final Attributes attributes Attributes entries get key getExtension attributes results listKey return Extension results toArray new Extension results size private static void getExtension final Attributes attributes final ArrayList required final Attributes Name listKey final String names attributes getValue listKey if null names return final String extentions split names for int extentions length final String prefix extentions final Extension extension getExtension prefix attributes if null extension required add extension private static String split final String string final String onToken final StringTokenizer tokenizer new StringTokenizer string onToken final String result new String tokenizer countTokens for int result length result tokenizer nextToken return result private static Extension getExtension final String prefix final Attributes attributes final String nameKey prefix EXTENSION_NAME final String name getTrimmedString attributes getValue nameKey if null name return null final String specVendorKey prefix SPECIFICATION_VENDOR final String specVendor getTrimmedString attributes getValue specVendorKey final String specVersionKey prefix SPECIFICATION_VERSION final String specVersion getTrimmedString attributes getValue specVersionKey final String impVersionKey prefix IMPLEMENTATION_VERSION final String impVersion getTrimmedString attributes getValue impVersionKey final String impVendorKey prefix IMPLEMENTATION_VENDOR final String impVendor getTrimmedString attributes getValue impVendorKey final String impVendorIDKey prefix IMPLEMENTATION_VENDOR_ID final String impVendorId getTrimmedString attributes getValue impVendorIDKey final String impURLKey prefix IMPLEMENTATION_URL final String impURL getTrimmedString attributes getValue impURLKey return new Extension name specVersion specVendor impVersion impVendor impVendorId impURL private static String getTrimmedString final String value return null value null value trim public class IdentityMapper implements FileNameMapper public void setFrom String from public void setTo String to public String mapFileName String sourceFileName return new String sourceFileName public class JAXPUtils private static final FileUtils FILE_UTILS FileUtils getFileUtils private static SAXParserFactory parserFactory null private static SAXParserFactory nsParserFactory null private static DocumentBuilderFactory builderFactory null public static synchronized SAXParserFactory getParserFactory throws BuildException if parserFactory null parserFactory newParserFactory return parserFactory public static synchronized SAXParserFactory getNSParserFactory throws BuildException if nsParserFactory null nsParserFactory newParserFactory nsParserFactory setNamespaceAware true return nsParserFactory public static SAXParserFactory newParserFactory throws BuildException try return SAXParserFactory newInstance catch FactoryConfigurationError throw new BuildException getMessage public static Parser getParser throws BuildException try return newSAXParser getParserFactory getParser catch SAXException throw convertToBuildException public static XMLReader getXMLReader throws BuildException try return newSAXParser getParserFactory getXMLReader catch SAXException throw convertToBuildException public static XMLReader getNamespaceXMLReader throws BuildException try return newSAXParser getNSParserFactory getXMLReader catch SAXException throw convertToBuildException public static String getSystemId File file return FILE_UTILS toURI file getAbsolutePath public static DocumentBuilder getDocumentBuilder throws BuildException try return getDocumentBuilderFactory newDocumentBuilder catch ParserConfigurationException throw new BuildException private static SAXParser newSAXParser SAXParserFactory factory throws BuildException try return factory newSAXParser catch ParserConfigurationException throw new BuildException getMessage catch SAXException throw convertToBuildException private static BuildException convertToBuildException SAXException Exception nested getException if nested null return new BuildException nested else return new BuildException private static synchronized DocumentBuilderFactory getDocumentBuilderFactory throws BuildException if builderFactory null try builderFactory DocumentBuilderFactory newInstance catch FactoryConfigurationError throw new BuildException getMessage return builderFactory public class UnPackageNameMapper extends GlobPatternMapper protected String extractVariablePart String name String var name substring prefixLength name length postfixLength return var replace File separatorChar public abstract class MatchingTask extends Task implements SelectorContainer protected FileSet fileset new FileSet public void setProject Project project super setProject project fileset setProject project public PatternSet NameEntry createInclude return fileset createInclude public PatternSet NameEntry createIncludesFile return fileset createIncludesFile public PatternSet NameEntry createExclude return fileset createExclude public PatternSet NameEntry createExcludesFile return fileset createExcludesFile public PatternSet createPatternSet return fileset createPatternSet public void setIncludes String includes fileset setIncludes includes public void XsetItems String itemString log Project MSG_WARN if itemString null itemString equals itemString equals createInclude setName else StringTokenizer tok new StringTokenizer itemString while tok hasMoreTokens String pattern tok nextToken trim if pattern length public void setExcludes String excludes fileset setExcludes excludes public void XsetIgnore String ignoreString log Project MSG_WARN if ignoreString null ignoreString length StringTokenizer tok new StringTokenizer ignoreString false while tok hasMoreTokens public void setDefaultexcludes boolean useDefaultExcludes fileset setDefaultexcludes useDefaultExcludes protected DirectoryScanner getDirectoryScanner File baseDir fileset setDir baseDir return fileset getDirectoryScanner getProject public void setIncludesfile File includesfile fileset setIncludesfile includesfile public void setExcludesfile File excludesfile fileset setExcludesfile excludesfile public void setCaseSensitive boolean isCaseSensitive fileset setCaseSensitive isCaseSensitive public void setFollowSymlinks boolean followSymlinks fileset setFollowSymlinks followSymlinks public boolean hasSelectors return fileset hasSelectors public int selectorCount return fileset selectorCount public FileSelector getSelectors Project return fileset getSelectors public Enumeration selectorElements return fileset selectorElements public void appendSelector FileSelector selector fileset appendSelector selector public void addSelector SelectSelector selector fileset addSelector selector public void addAnd AndSelector selector fileset addAnd selector public void addOr OrSelector selector fileset addOr selector public void addNot NotSelector selector fileset addNot selector public void addNone NoneSelector selector fileset addNone selector public void addMajority MajoritySelector selector fileset addMajority selector public void addDate DateSelector selector fileset addDate selector public void addSize SizeSelector selector fileset addSize selector public void addFilename FilenameSelector selector fileset addFilename selector public void addCustom ExtendSelector selector fileset addCustom selector public void addContains ContainsSelector selector fileset addContains selector public void addPresent PresentSelector selector fileset addPresent selector public void addDepth DepthSelector selector fileset addDepth selector public void addDepend DependSelector selector fileset addDepend selector public void addContainsRegexp ContainsRegexpSelector selector fileset addContainsRegexp selector public void addDifferent DifferentSelector selector fileset addDifferent selector public void addType TypeSelector selector fileset addType selector public void addModified ModifiedSelector selector fileset addModified selector public void add FileSelector selector fileset add selector protected final FileSet getImplicitFileSet return fileset public class GenericDeploymentTool implements EJBDeploymentTool public static final int DEFAULT_BUFFER_SIZE public static final int JAR_COMPRESS_LEVEL protected static final String META_DIR protected static final String MANIFEST META_DIR protected static final String EJB_DD public static final String ANALYZER_SUPER public static final String ANALYZER_FULL public static final String ANALYZER_NONE public static final String DEFAULT_ANALYZER ANALYZER_SUPER public static final String ANALYZER_CLASS_SUPER public static final String ANALYZER_CLASS_FULL private EjbJar Config config private File destDir private Path classpath private String genericJarSuffix private Task task private ClassLoader classpathLoader null private Set addedfiles private DescriptorHandler handler private DependencyAnalyzer dependencyAnalyzer public GenericDeploymentTool public void setDestdir File inDir this destDir inDir protected File getDestDir return destDir public void setTask Task task this task task protected Task getTask return task protected EjbJar Config getConfig return config protected boolean usingBaseJarName return config baseJarName null public void setGenericJarSuffix String inString this genericJarSuffix inString public Path createClasspath if classpath null classpath new Path task getProject return classpath createPath public void setClasspath Path classpath this classpath classpath protected Path getCombinedClasspath Path combinedPath classpath if config classpath null if combinedPath null combinedPath config classpath else combinedPath append config classpath return combinedPath protected void log String message int level getTask log message level protected Location getLocation return getTask getLocation private void createAnalyzer String analyzer config analyzer if analyzer null analyzer DEFAULT_ANALYZER if analyzer equals ANALYZER_NONE return String analyzerClassName null if analyzer equals ANALYZER_SUPER analyzerClassName ANALYZER_CLASS_SUPER else if analyzer equals ANALYZER_FULL analyzerClassName ANALYZER_CLASS_FULL else analyzerClassName analyzer try Class analyzerClass Class forName analyzerClassName dependencyAnalyzer DependencyAnalyzer analyzerClass newInstance dependencyAnalyzer addClassPath new Path task getProject config srcDir getPath dependencyAnalyzer addClassPath config classpath catch NoClassDefFoundError dependencyAnalyzer null task log analyzerClassName getMessage Project MSG_WARN catch Exception dependencyAnalyzer null task log analyzerClassName getMessage Project MSG_WARN public void configure EjbJar Config config this config config createAnalyzer classpathLoader null protected void addFileToJar JarOutputStream jStream File inputFile String logicalFilename throws BuildException FileInputStream iStream null try if addedfiles contains logicalFilename iStream new FileInputStream inputFile ZipEntry zipEntry new ZipEntry logicalFilename replace jStream putNextEntry zipEntry byte byteBuffer new byte DEFAULT_BUFFER_SIZE int count do jStream write byteBuffer count count iStream read byteBuffer byteBuffer length while count addedfiles add logicalFilename catch IOException ioe log logicalFilename inputFile getPath ioe getClass getName ioe getMessage Project MSG_WARN finally if iStream null try iStream close catch IOException closeException protected DescriptorHandler getDescriptorHandler File srcDir DescriptorHandler new DescriptorHandler getTask srcDir registerKnownDTDs for Iterator getConfig dtdLocations iterator hasNext EjbJar DTDLocation dtdLocation EjbJar DTDLocation next registerDTD dtdLocation getPublicId dtdLocation getLocation return protected void registerKnownDTDs DescriptorHandler handler public void processDescriptor String descriptorFileName SAXParser saxParser checkConfiguration descriptorFileName saxParser try handler getDescriptorHandler config srcDir Hashtable ejbFiles parseEjbFiles descriptorFileName saxParser addSupportClasses ejbFiles String baseName getJarBaseName descriptorFileName String ddPrefix getVendorDDPrefix baseName descriptorFileName File manifestFile getManifestFile ddPrefix if manifestFile null ejbFiles put MANIFEST manifestFile ejbFiles put META_DIR EJB_DD new File config descriptorDir descriptorFileName addVendorFiles ejbFiles ddPrefix checkAndAddDependants ejbFiles if config flatDestDir baseName length int startName baseName lastIndexOf File separator if startName startName int endName baseName length baseName baseName substring startName endName File jarFile getVendorOutputJarFile baseName if needToRebuild ejbFiles jarFile log jarFile getName String valueOf ejbFiles size Project MSG_INFO String publicId getPublicId writeJar baseName jarFile ejbFiles publicId else log jarFile toString Project MSG_VERBOSE catch SAXException se String msg descriptorFileName se getMessage throw new BuildException msg se catch IOException ioe String msg descriptorFileName toString ioe getMessage throw new BuildException msg ioe protected void checkConfiguration String descriptorFileName SAXParser saxParser throws BuildException protected Hashtable parseEjbFiles String descriptorFileName SAXParser saxParser throws IOException SAXException FileInputStream descriptorStream null Hashtable ejbFiles null try descriptorStream new FileInputStream new File config descriptorDir descriptorFileName saxParser parse new InputSource descriptorStream handler ejbFiles handler getFiles finally if descriptorStream null try descriptorStream close catch IOException closeException return ejbFiles protected void addSupportClasses Hashtable ejbFiles Project project task getProject for Iterator config supportFileSets iterator hasNext FileSet supportFileSet FileSet next File supportBaseDir supportFileSet getDir project DirectoryScanner supportScanner supportFileSet getDirectoryScanner project supportScanner scan String supportFiles supportScanner getIncludedFiles for int supportFiles length ejbFiles put supportFiles new File supportBaseDir supportFiles protected String getJarBaseName String descriptorFileName String baseName if config namingScheme getValue equals EjbJar NamingScheme BASEJARNAME String canonicalDescriptor descriptorFileName replace int index canonicalDescriptor lastIndexOf if index baseName descriptorFileName substring index baseName config baseJarName else if config namingScheme getValue equals EjbJar NamingScheme DESCRIPTOR int lastSeparatorIndex descriptorFileName lastIndexOf File separator int endBaseName if lastSeparatorIndex endBaseName descriptorFileName indexOf config baseNameTerminator lastSeparatorIndex else endBaseName descriptorFileName indexOf config baseNameTerminator if endBaseName baseName descriptorFileName substring endBaseName else throw new BuildException descriptorFileName else if config namingScheme getValue equals EjbJar NamingScheme DIRECTORY File descriptorFile new File config descriptorDir descriptorFileName String path descriptorFile getAbsolutePath int lastSeparatorIndex path lastIndexOf File separator if lastSeparatorIndex throw new BuildException String dirName path substring lastSeparatorIndex int dirSeparatorIndex dirName lastIndexOf File separator if dirSeparatorIndex dirName dirName substring dirSeparatorIndex baseName dirName else if config namingScheme getValue equals EjbJar NamingScheme EJB_NAME baseName handler getEjbName return baseName public String getVendorDDPrefix String baseName String descriptorFileName String ddPrefix null if config namingScheme getValue equals EjbJar NamingScheme DESCRIPTOR ddPrefix baseName config baseNameTerminator else if config namingScheme getValue equals EjbJar NamingScheme BASEJARNAME config namingScheme getValue equals EjbJar NamingScheme EJB_NAME config namingScheme getValue equals EjbJar NamingScheme DIRECTORY String canonicalDescriptor descriptorFileName replace int index canonicalDescriptor lastIndexOf if index ddPrefix else ddPrefix descriptorFileName substring index return ddPrefix protected void addVendorFiles Hashtable ejbFiles String ddPrefix File getVendorOutputJarFile String baseName return new File destDir baseName genericJarSuffix protected boolean needToRebuild Hashtable ejbFiles File jarFile if jarFile exists long lastBuild jarFile lastModified Iterator fileIter ejbFiles values iterator while fileIter hasNext File currentFile File fileIter next if lastBuild currentFile lastModified log currentFile getPath Project MSG_VERBOSE return true return false return true protected String getPublicId return handler getPublicId protected File getManifestFile String prefix File manifestFile new File getConfig descriptorDir prefix if manifestFile exists return manifestFile if config manifest null return config manifest return null protected void writeJar String baseName File jarfile Hashtable files String publicId throws BuildException JarOutputStream jarStream null try if addedfiles null addedfiles new HashSet else addedfiles clear if jarfile exists jarfile delete jarfile getParentFile mkdirs jarfile createNewFile InputStream in null Manifest manifest null try File manifestFile File files get MANIFEST if manifestFile null manifestFile exists in new FileInputStream manifestFile else String defaultManifest in this getClass getResourceAsStream defaultManifest if in null throw new BuildException defaultManifest manifest new Manifest in catch IOException throw new BuildException getLocation finally if in null in close jarStream new JarOutputStream new FileOutputStream jarfile manifest jarStream setMethod JarOutputStream DEFLATED for Iterator entryIterator files keySet iterator entryIterator hasNext String entryName String entryIterator next if entryName equals MANIFEST continue File entryFile File files get entryName log entryName Project MSG_VERBOSE addFileToJar jarStream entryFile entryName InnerClassFilenameFilter flt new InnerClassFilenameFilter entryFile getName File entryDir entryFile getParentFile String innerfiles entryDir list flt if innerfiles null for int innerfiles length int entryIndex entryName lastIndexOf entryFile getName if entryIndex entryName innerfiles else entryName entryName substring entryIndex File separatorChar innerfiles entryFile new File config srcDir entryName log entryName Project MSG_VERBOSE addFileToJar jarStream entryFile entryName catch IOException ioe String msg jarfile toString ioe getMessage throw new BuildException msg ioe finally if jarStream null try jarStream close catch IOException closeException protected void checkAndAddDependants Hashtable checkEntries throws BuildException if dependencyAnalyzer null return dependencyAnalyzer reset Iterator checkEntries keySet iterator while hasNext String entryName String next if entryName endsWith String className entryName substring entryName length length className className replace File separatorChar className className replace dependencyAnalyzer addRootClass className Enumeration dependencyAnalyzer getClassDependencies while hasMoreElements String classname String nextElement String location classname replace File separatorChar File classFile new File config srcDir location if classFile exists checkEntries put location classFile log classname classFile Project MSG_VERBOSE protected ClassLoader getClassLoaderForBuild if classpathLoader null return classpathLoader Path combinedClasspath getCombinedClasspath if combinedClasspath null classpathLoader getClass getClassLoader else classpathLoader getTask getProject createClassLoader combinedClasspath return classpathLoader public void validateConfigured throws BuildException if destDir null destDir isDirectory String msg throw new BuildException msg getLocation public class SunRmic extends DefaultRmicAdapter public static final String RMIC_CLASSNAME public static final String COMPILER_NAME public static final String RMIC_EXECUTABLE public static final String ERROR_NO_RMIC_ON_CLASSPATH public static final String ERROR_RMIC_FAILED public boolean execute throws BuildException getRmic log Project MSG_VERBOSE Commandline cmd setupRmicCommand LogOutputStream logstr new LogOutputStream getRmic Project MSG_WARN try Class Class forName RMIC_CLASSNAME Constructor cons getConstructor new Class OutputStream class String class Object rmic cons newInstance new Object logstr Method doRmic getMethod new Class String class Boolean ok Boolean doRmic invoke rmic new Object cmd getArguments return ok booleanValue catch ClassNotFoundException ex throw new BuildException ERROR_NO_RMIC_ON_CLASSPATH getRmic getLocation catch Exception ex if ex instanceof BuildException throw BuildException ex else throw new BuildException ERROR_RMIC_FAILED ex getRmic getLocation finally try logstr close catch IOException throw new BuildException public class Union extends BaseResourceCollectionContainer public static Union getInstance ResourceCollection rc return rc instanceof Union Union rc new Union rc public Union public Union ResourceCollection rc add rc public String list if isReference return Union getCheckedRef list Collection result getCollection true return String result toArray new String result size public Resource listResources if isReference return Union getCheckedRef listResources Collection result getCollection return Resource result toArray new Resource result size protected Collection getCollection return getCollection false protected Collection getCollection boolean asString List rc getResourceCollections if rc isEmpty return Collections EMPTY_LIST ArrayList union new ArrayList rc size for Iterator rcIter rc iterator rcIter hasNext for Iterator nextRC rcIter iterator hasNext Object next if asString toString if union contains union add return union private static ResourceCollection nextRC Iterator return ResourceCollection next public final class Diagnostics private static final int BIG_DRIFT_LIMIT private static final int TEST_FILE_SIZE private static final int KILOBYTE private static final int SECONDS_PER_MILLISECOND private static final int SECONDS_PER_MINUTE private static final int MINUTES_PER_HOUR private static final String TEST_CLASS protected static final String ERROR_PROPERTY_ACCESS_BLOCKED private Diagnostics public static boolean isOptionalAvailable try Class forName TEST_CLASS catch ClassNotFoundException return false return true public static void validateVersion throws BuildException try Class optional Class forName TEST_CLASS String coreVersion getImplementationVersion Main class String optionalVersion getImplementationVersion optional if coreVersion null coreVersion equals optionalVersion throw new BuildException coreVersion optionalVersion catch ClassNotFoundException ignoreThrowable public static File listLibraries String home System getProperty MagicNames ANT_HOME if home null return null File libDir new File home return listJarFiles libDir private static File listJarFiles File libDir FilenameFilter filter new FilenameFilter public boolean accept File dir String name return name endsWith File files libDir listFiles filter return files public static void main String args doReport System out private static String getImplementationVersion Class clazz Package pkg clazz getPackage return pkg getImplementationVersion private static String getXmlParserName SAXParser saxParser getSAXParser if saxParser null return String saxParserName saxParser getClass getName return saxParserName private static SAXParser getSAXParser SAXParserFactory saxParserFactory SAXParserFactory newInstance if saxParserFactory null return null SAXParser saxParser null try saxParser saxParserFactory newSAXParser catch Exception ignoreThrowable return saxParser private static String getXMLParserLocation SAXParser saxParser getSAXParser if saxParser null return null String location getClassLocation saxParser getClass return location private static String getNamespaceParserName try XMLReader reader JAXPUtils getNamespaceXMLReader return reader getClass getName catch BuildException ignoreThrowable return null private static String getNamespaceParserLocation try XMLReader reader JAXPUtils getNamespaceXMLReader return getClassLocation reader getClass catch BuildException ignoreThrowable return null private static void ignoreThrowable Throwable thrown private static String getClassLocation Class clazz File LoaderUtils getClassSource clazz return null null getAbsolutePath public static void doReport PrintStream out out println out println Main getAntVersion header out out println getImplementationVersion Main class Class optional null try optional Class forName TEST_CLASS out println getImplementationVersion optional catch ClassNotFoundException ignoreThrowable out println header out doReportAntProperties out header out doReportAntHomeLibraries out header out doReportUserHomeLibraries out header out doReportTasksAvailability out header out doReportWhich out header out doReportParserInfo out header out doReportSystemProperties out header out doReportTempDir out header out doReportLocale out header out doReportProxy out out println private static void header PrintStream out String section out println out println out print out println section out println private static void doReportSystemProperties PrintStream out Properties sysprops null try sysprops System getProperties catch SecurityException ignoreThrowable out println for Enumeration keys sysprops propertyNames keys hasMoreElements String key String keys nextElement String value getProperty key out println key value private static String getProperty String key String value try value System getProperty key catch SecurityException value ERROR_PROPERTY_ACCESS_BLOCKED return value private static void doReportAntProperties PrintStream out Project new Project initProperties out println MagicNames ANT_VERSION getProperty MagicNames ANT_VERSION out println MagicNames ANT_JAVA_VERSION getProperty MagicNames ANT_JAVA_VERSION out println MagicNames ANT_LIB getProperty MagicNames ANT_LIB out println MagicNames ANT_HOME getProperty MagicNames ANT_HOME private static void doReportAntHomeLibraries PrintStream out out println MagicNames ANT_HOME System getProperty MagicNames ANT_HOME File libs listLibraries printLibraries libs out private static void doReportUserHomeLibraries PrintStream out String home System getProperty Launcher USER_HOMEDIR out println home File libDir new File home Launcher USER_LIBDIR File libs listJarFiles libDir printLibraries libs out private static void printLibraries File libs PrintStream out if libs null out println return for int libs length out println libs getName libs length private static void doReportWhich PrintStream out Throwable error null try Class which Class forName Method method which getMethod new Class String class method invoke null new Object new String catch ClassNotFoundException out println catch InvocationTargetException error getTargetException null getTargetException catch Throwable error if error null out println error printStackTrace private static void doReportTasksAvailability PrintStream out InputStream is Main class getResourceAsStream MagicNames TASKDEF_PROPERTIES_RESOURCE if is null out println else Properties props new Properties try props load is for Enumeration keys props keys keys hasMoreElements String key String keys nextElement String classname props getProperty key try Class forName classname props remove key catch ClassNotFoundException out println key catch NoClassDefFoundError String pkg getMessage replace out println key pkg catch LinkageError out println key if props size out println else out println catch IOException out println getMessage private static void doReportParserInfo PrintStream out String parserName getXmlParserName String parserLocation getXMLParserLocation printParserInfo out parserName parserLocation printParserInfo out getNamespaceParserName getNamespaceParserLocation private static void printParserInfo PrintStream out String parserType String parserName String parserLocation if parserName null parserName if parserLocation null parserLocation out println parserType parserName out println parserType parserLocation private static void doReportTempDir PrintStream out String tempdir System getProperty if tempdir null out println return out println tempdir File tempDirectory new File tempdir if tempDirectory exists out println tempdir return long now System currentTimeMillis File tempFile null FileOutputStream fileout null try tempFile File createTempFile tempDirectory fileout new FileOutputStream tempFile byte buffer new byte KILOBYTE for int TEST_FILE_SIZE fileout write buffer fileout close fileout null long filetime tempFile lastModified tempFile delete out println long drift filetime now out println drift if Math abs drift BIG_DRIFT_LIMIT out println catch IOException ignoreThrowable out println tempdir out println tempFile finally FileUtils close fileout if tempFile null tempFile exists tempFile delete private static void doReportLocale PrintStream out Calendar cal Calendar getInstance TimeZone tz cal getTimeZone out println tz getDisplayName tz getOffset cal get Calendar ERA cal get Calendar YEAR cal get Calendar MONTH cal get Calendar DAY_OF_MONTH cal get Calendar DAY_OF_WEEK cal get Calendar HOUR_OF_DAY MINUTES_PER_HOUR cal get Calendar MINUTE SECONDS_PER_MINUTE cal get Calendar SECOND SECONDS_PER_MILLISECOND cal get Calendar MILLISECOND private static void printProperty PrintStream out String key String value getProperty key if value null out print key out print out print out print value out println private static void doReportProxy PrintStream out printProperty out ProxySetup HTTP_PROXY_HOST printProperty out ProxySetup HTTP_PROXY_PORT printProperty out ProxySetup HTTP_PROXY_USERNAME printProperty out ProxySetup HTTP_PROXY_PASSWORD printProperty out ProxySetup HTTP_NON_PROXY_HOSTS printProperty out ProxySetup HTTPS_PROXY_HOST printProperty out ProxySetup HTTPS_PROXY_PORT printProperty out ProxySetup HTTPS_NON_PROXY_HOSTS printProperty out ProxySetup FTP_PROXY_HOST printProperty out ProxySetup FTP_PROXY_PORT printProperty out ProxySetup FTP_NON_PROXY_HOSTS printProperty out ProxySetup SOCKS_PROXY_HOST printProperty out ProxySetup SOCKS_PROXY_PORT printProperty out ProxySetup SOCKS_PROXY_USERNAME printProperty out ProxySetup SOCKS_PROXY_PASSWORD if JavaEnvUtils getJavaVersionNumber return printProperty out ProxySetup USE_SYSTEM_PROXIES final String proxyDiagClassname try Class proxyDiagClass Class forName proxyDiagClassname Object instance proxyDiagClass newInstance out println out println instance toString catch ClassNotFoundException catch IllegalAccessException catch InstantiationException catch NoClassDefFoundError public abstract class LineOrientedOutputStream extends OutputStream private static final int INTIAL_SIZE private static final int CR private static final int LF private ByteArrayOutputStream buffer new ByteArrayOutputStream INTIAL_SIZE private boolean skip false public final void write int cc throws IOException final byte byte cc if LF CR if skip processBuffer else buffer write cc skip CR public final void flush throws IOException if buffer size processBuffer protected void processBuffer throws IOException try processLine buffer toString finally buffer reset protected abstract void processLine String line throws IOException public final void close throws IOException if buffer size processBuffer super close public final void write byte int off int len throws IOException int offset off int blockStartOffset offset int remaining len while remaining while remaining offset LF offset CR offset remaining int blockLength offset blockStartOffset if blockLength buffer write blockStartOffset blockLength while remaining offset LF offset CR write offset offset remaining blockStartOffset offset class SplashScreen extends JWindow implements ActionListener BuildListener private JLabel text private JProgressBar pb private int total private static final int MIN private static final int MAX public SplashScreen String msg init null setText msg public SplashScreen ImageIcon img init img protected void init ImageIcon img JPanel pan JPanel getContentPane JLabel piccy if img null piccy new JLabel else piccy new JLabel img piccy setBorder BorderFactory createLineBorder Color black text new JLabel JLabel CENTER text setFont new Font Font BOLD text setBorder BorderFactory createEtchedBorder pb new JProgressBar MIN MAX pb setBorder BorderFactory createBevelBorder javax swing border BevelBorder LOWERED JPanel pan2 new JPanel pan2 setLayout new BorderLayout pan2 add text BorderLayout NORTH pan2 add pb BorderLayout SOUTH pan setLayout new BorderLayout pan add piccy BorderLayout CENTER pan add pan2 BorderLayout SOUTH pan setBorder BorderFactory createBevelBorder javax swing border BevelBorder RAISED pack Dimension size getSize Dimension scr Toolkit getDefaultToolkit getScreenSize int scr width size width int scr height size height setBounds size width size height public void setText String txt text setText txt public void actionPerformed ActionEvent if total MAX total else total MIN pb setValue total public void buildStarted BuildEvent event actionPerformed null public void buildFinished BuildEvent event pb setValue MAX setVisible false dispose public void targetStarted BuildEvent event actionPerformed null public void targetFinished BuildEvent event actionPerformed null public void taskStarted BuildEvent event actionPerformed null public void taskFinished BuildEvent event actionPerformed null public void messageLogged BuildEvent event actionPerformed null public class ScriptFilter extends TokenFilter ChainableReaderFilter private ScriptRunnerHelper helper new ScriptRunnerHelper private ScriptRunnerBase runner null private String token public void setProject Project project super setProject project helper setProjectComponent this public void setLanguage String language helper setLanguage language private void init throws BuildException if runner null return runner helper getScriptRunner public void setToken String token this token token public String getToken return token public String filter String token init setToken token runner executeScript return getToken public void setSrc File file helper setSrc file public void addText String text helper addText text public void setManager String manager helper setManager manager public void setClasspath Path classpath helper setClasspath classpath public Path createClasspath return helper createClasspath public void setClasspathRef Reference helper setClasspathRef public final class JspCompilerAdapterFactory private JspCompilerAdapterFactory public static JspCompilerAdapter getCompiler String compilerType Task task throws BuildException return getCompiler compilerType task task getProject createClassLoader null public static JspCompilerAdapter getCompiler String compilerType Task task AntClassLoader loader throws BuildException if compilerType equalsIgnoreCase return new JasperC new JspNameMangler if compilerType equalsIgnoreCase return new JasperC new Jasper41Mangler return resolveClassName compilerType loader private static JspCompilerAdapter resolveClassName String className AntClassLoader classloader throws BuildException try Class classloader findClass className Object newInstance return JspCompilerAdapter catch ClassNotFoundException cnfe throw new BuildException className cnfe catch ClassCastException cce throw new BuildException className cce catch Throwable throw new BuildException className public class LoadResource extends Task private Resource src private boolean failOnError true private boolean quiet false private String encoding null private String property null private final Vector filterChains new Vector public final void setEncoding final String encoding this encoding encoding public final void setProperty final String property this property property public final void setFailonerror final boolean fail failOnError fail public void setQuiet final boolean quiet this quiet quiet if quiet this failOnError false public final void execute throws BuildException if src null throw new BuildException if property null throw new BuildException if quiet failOnError throw new BuildException if src isExists String message src if failOnError throw new BuildException message else log message quiet Project MSG_WARN Project MSG_ERR return InputStream is null BufferedInputStream bis null Reader instream null log src property Project MSG_VERBOSE try final long len src getSize log len Resource UNKNOWN_SIZE String valueOf len Project MSG_DEBUG final int size int len is src getInputStream bis new BufferedInputStream is if encoding null instream new InputStreamReader bis else instream new InputStreamReader bis encoding String text if size ChainReaderHelper crh new ChainReaderHelper if len Resource UNKNOWN_SIZE crh setBufferSize size crh setPrimaryReader instream crh setFilterChains filterChains crh setProject getProject instream crh getAssembledReader text crh readFully instream if text null if text length getProject setNewProperty property text log text length Project MSG_VERBOSE log property text Project MSG_DEBUG catch final IOException ioe final String message ioe toString if failOnError throw new BuildException message ioe getLocation else log message quiet Project MSG_VERBOSE Project MSG_ERR catch final BuildException be if failOnError throw be else log be getMessage quiet Project MSG_VERBOSE Project MSG_ERR finally FileUtils close is public final void addFilterChain FilterChain filter filterChains addElement filter public void addConfigured ResourceCollection if size throw new BuildException src Resource iterator next public class ExtensionAdapter extends DataType private String extensionName private DeweyDecimal specificationVersion private String specificationVendor private String implementationVendorID private String implementationVendor private DeweyDecimal implementationVersion private String implementationURL public void setExtensionName final String extensionName verifyNotAReference this extensionName extensionName public void setSpecificationVersion final String specificationVersion verifyNotAReference this specificationVersion new DeweyDecimal specificationVersion public void setSpecificationVendor final String specificationVendor verifyNotAReference this specificationVendor specificationVendor public void setImplementationVendorId final String implementationVendorID verifyNotAReference this implementationVendorID implementationVendorID public void setImplementationVendor final String implementationVendor verifyNotAReference this implementationVendor implementationVendor public void setImplementationVersion final String implementationVersion verifyNotAReference this implementationVersion new DeweyDecimal implementationVersion public void setImplementationUrl final String implementationURL verifyNotAReference this implementationURL implementationURL public void setRefid final Reference reference throws BuildException if null extensionName null specificationVersion null specificationVendor null implementationVersion null implementationVendorID null implementationVendor null implementationURL throw tooManyAttributes Object reference getReferencedObject getProject if instanceof ExtensionAdapter final ExtensionAdapter other ExtensionAdapter extensionName other extensionName specificationVersion other specificationVersion specificationVendor other specificationVendor implementationVersion other implementationVersion implementationVendorID other implementationVendorID implementationVendor other implementationVendor implementationURL other implementationURL else final String message reference getRefId throw new BuildException message super setRefid reference private void verifyNotAReference throws BuildException if isReference throw tooManyAttributes Extension toExtension throws BuildException if null extensionName final String message throw new BuildException message String specificationVersionString null if null specificationVersion specificationVersionString specificationVersion toString String implementationVersionString null if null implementationVersion implementationVersionString implementationVersion toString return new Extension extensionName specificationVersionString specificationVendor implementationVersionString implementationVendor implementationVendorID implementationURL public String toString return toExtension toString public class ClassCPInfo extends ConstantPoolEntry private String className private int index public ClassCPInfo super CONSTANT_CLASS public void read DataInputStream cpStream throws IOException index cpStream readUnsignedShort className public String toString return className index public void resolve ConstantPool constantPool className Utf8CPInfo constantPool getEntry index getValue super resolve constantPool public String getClassName return className public class JakartaOroMatcher implements RegexpMatcher private String pattern protected final Perl5Compiler compiler new Perl5Compiler protected final Perl5Matcher matcher new Perl5Matcher public JakartaOroMatcher public void setPattern String pattern this pattern pattern public String getPattern return this pattern protected Pattern getCompiledPattern int options throws BuildException try Pattern compiler compile pattern getCompilerOptions options return catch Exception throw new BuildException public boolean matches String argument throws BuildException return matches argument MATCH_DEFAULT public boolean matches String input int options throws BuildException Pattern getCompiledPattern options return matcher contains input public Vector getGroups String argument throws BuildException return getGroups argument MATCH_DEFAULT public Vector getGroups String input int options throws BuildException if matches input options return null Vector new Vector MatchResult mr matcher getMatch int cnt mr groups for int cnt String match mr group if match null match addElement match return protected int getCompilerOptions int options int cOptions Perl5Compiler DEFAULT_MASK if RegexpUtil hasFlag options MATCH_CASE_INSENSITIVE cOptions Perl5Compiler CASE_INSENSITIVE_MASK if RegexpUtil hasFlag options MATCH_MULTILINE cOptions Perl5Compiler MULTILINE_MASK if RegexpUtil hasFlag options MATCH_SINGLELINE cOptions Perl5Compiler SINGLELINE_MASK return cOptions public class Provider extends ProjectComponent private String type public String getClassName return type public void setClassName String type this type type public void check if type null throw new BuildException getLocation if type length throw new BuildException getLocation public class P4Have extends P4Base public void execute throws BuildException execP4Command P4CmdOpts P4View new SimpleP4OutputHandler this public class Native2Ascii extends MatchingTask private Mapper mapper private FacadeTaskHelper facade null public Native2Ascii facade new FacadeTaskHelper Native2AsciiAdapterFactory getDefault public void setReverse boolean reverse this reverse reverse public boolean getReverse return reverse public void setEncoding String encoding this encoding encoding public String getEncoding return encoding public void setSrc File srcDir this srcDir srcDir public void setDest File destDir this destDir destDir public void setExt String ext this extension ext public void setImplementation String impl if equals impl facade setImplementation Native2AsciiAdapterFactory getDefault else facade setImplementation impl public Mapper createMapper throws BuildException if mapper null throw new BuildException getLocation mapper new Mapper getProject return mapper public void add FileNameMapper fileNameMapper createMapper add fileNameMapper public ImplementationSpecificArgument createArg ImplementationSpecificArgument arg new ImplementationSpecificArgument facade addImplementationArgument arg return arg public void execute throws BuildException if srcDir null srcDir getProject resolveFile if destDir null throw new BuildException if srcDir equals destDir extension null mapper null throw new BuildException FileNameMapper null if mapper null if extension null new IdentityMapper else new ExtMapper else mapper getImplementation scanner getDirectoryScanner srcDir files scanner getIncludedFiles SourceFileScanner sfs new SourceFileScanner this files sfs restrict files srcDir destDir int count files length if count return String message count count log message srcDir destDir for int files length convert files mapFileName files private void convert String srcName String destName throws BuildException srcFile new File srcDir srcName destFile new File destDir destName if srcFile equals destFile throw new BuildException srcFile String parentName destFile getParent if parentName null File parentFile new File parentName if parentFile exists parentFile mkdirs throw new BuildException parentName log srcName Project MSG_VERBOSE Native2AsciiAdapter ad Native2AsciiAdapterFactory getAdapter facade getImplementation this if ad convert this srcFile destFile throw new BuildException public String getCurrentArgs return facade getArgs private class ExtMapper implements FileNameMapper public void setFrom String public void setTo String public String mapFileName String fileName int lastDot fileName lastIndexOf if lastDot return new String fileName substring lastDot extension else return new String fileName extension public abstract class AbstractHotDeploymentTool implements HotDeploymentTool private ServerDeploy task private Path classpath private String userName private String password private String server public Path createClasspath if classpath null classpath new Path task getProject return classpath createPath protected abstract boolean isActionValid public void validateAttributes throws BuildException if task getAction null throw new BuildException if isActionValid throw new BuildException task getAction if classpath null throw new BuildException public abstract void deploy throws BuildException public void setTask ServerDeploy task this task task protected ServerDeploy getTask return task public Path getClasspath return classpath public void setClasspath Path classpath this classpath classpath public String getUserName return userName public void setUserName String userName this userName userName public String getPassword return password public void setPassword String password this password password public String getServer return server public void setServer String server this server server public class Date extends ResourceComparator protected int resourceCompare Resource foo Resource bar return int foo getLastModified bar getLastModified public class Location implements Serializable private String fileName private int lineNumber private int columnNumber public static final Location UNKNOWN_LOCATION new Location private static final FileUtils FILE_UTILS FileUtils getFileUtils private Location this null public Location String fileName this fileName public Location Locator loc this loc getSystemId loc getLineNumber loc getColumnNumber public Location String fileName int lineNumber int columnNumber if fileName null fileName startsWith this fileName FILE_UTILS fromURI fileName else this fileName fileName this lineNumber lineNumber this columnNumber columnNumber public String getFileName return fileName public int getLineNumber return lineNumber public int getColumnNumber return columnNumber public String toString StringBuffer buf new StringBuffer if fileName null buf append fileName if lineNumber buf append buf append lineNumber buf append return buf toString public boolean equals Object other if this other return true if other null return false if other getClass getClass return false return toString equals other toString public int hashCode return toString hashCode public class ZipFileSet extends ArchiveFileSet private String encoding null public ZipFileSet super protected ZipFileSet FileSet fileset super fileset protected ZipFileSet ZipFileSet fileset super fileset encoding fileset encoding public void setEncoding String enc checkZipFileSetAttributesAllowed this encoding enc public String getEncoding if isReference AbstractFileSet ref getRef getProject if ref instanceof ZipFileSet return ZipFileSet ref getEncoding else return null return encoding protected ArchiveScanner newArchiveScanner ZipScanner zs new ZipScanner zs setEncoding encoding return zs protected AbstractFileSet getRef Project dieOnCircularReference Object getRefid getReferencedObject if instanceof ZipFileSet return AbstractFileSet else if instanceof FileSet ZipFileSet zfs new ZipFileSet FileSet configureFileSet zfs return zfs else String msg getRefid getRefId throw new BuildException msg public Object clone if isReference return ZipFileSet getRef getProject clone else return super clone private void checkZipFileSetAttributesAllowed if getProject null isReference getRefid getReferencedObject getProject instanceof ZipFileSet checkAttributesAllowed public class GUnzip extends Unpack private static final String DEFAULT_EXTENSION protected String getDefaultExtension return DEFAULT_EXTENSION protected void extract if source lastModified dest lastModified log source getAbsolutePath dest getAbsolutePath FileOutputStream out null GZIPInputStream zIn null InputStream fis null try out new FileOutputStream dest fis srcResource getInputStream zIn new GZIPInputStream fis byte buffer new byte int count do out write buffer count count zIn read buffer buffer length while count catch IOException ioe String msg ioe getMessage throw new BuildException msg ioe getLocation finally FileUtils close fis FileUtils close out FileUtils close zIn protected boolean supportsNonFileResources return getClass equals GUnzip class public class LeadPipeInputStream extends PipedInputStream private ProjectComponent managingPc public LeadPipeInputStream super public LeadPipeInputStream int size super setBufferSize size public LeadPipeInputStream PipedOutputStream src throws IOException super src public LeadPipeInputStream PipedOutputStream src int size throws IOException super src setBufferSize size public synchronized int read throws IOException int result try result super read catch IOException eyeOhEx if equalsIgnoreCase eyeOhEx getMessage if super in super out super buffer length super out super in result super buffer super out else log eyeOhEx getMessage Project MSG_INFO return result public synchronized void setBufferSize int size if size buffer length byte newBuffer new byte size if in if in out System arraycopy buffer out newBuffer out in out else int outlen buffer length out System arraycopy buffer out newBuffer outlen System arraycopy buffer newBuffer outlen in in outlen out buffer newBuffer public void setManagingTask Task task setManagingComponent task public void setManagingComponent ProjectComponent pc this managingPc pc public void log String message int loglevel if managingPc null managingPc log message loglevel else if loglevel Project MSG_WARN System out println message else System err println message public class AntXMLContext private Project project private File buildFile private Vector targetVector new Vector private File buildFileParent private String currentProjectName private Locator locator private Target implicitTarget new Target private Target currentTarget null private Vector wStack new Vector private boolean ignoreProjectTag false private Map prefixMapping new HashMap private Map currentTargets null public AntXMLContext Project project this project project implicitTarget setProject project implicitTarget setName targetVector addElement implicitTarget public void setBuildFile File buildFile this buildFile buildFile this buildFileParent new File buildFile getParent implicitTarget setLocation new Location buildFile getAbsolutePath public File getBuildFile return buildFile public File getBuildFileParent return buildFileParent public Project getProject return project public String getCurrentProjectName return currentProjectName public void setCurrentProjectName String name this currentProjectName name public RuntimeConfigurable currentWrapper if wStack size return null return RuntimeConfigurable wStack elementAt wStack size public RuntimeConfigurable parentWrapper if wStack size return null return RuntimeConfigurable wStack elementAt wStack size public void pushWrapper RuntimeConfigurable wrapper wStack addElement wrapper public void popWrapper if wStack size wStack removeElementAt wStack size public Vector getWrapperStack return wStack public void addTarget Target target targetVector addElement target currentTarget target public Target getCurrentTarget return currentTarget public Target getImplicitTarget return implicitTarget public void setCurrentTarget Target target this currentTarget target public void setImplicitTarget Target target this implicitTarget target public Vector getTargets return targetVector public void configureId Object element Attributes attr String id attr getValue if id null project addIdReference id element public Locator getLocator return locator public void setLocator Locator locator this locator locator public boolean isIgnoringProjectTag return ignoreProjectTag public void setIgnoreProjectTag boolean flag this ignoreProjectTag flag public void startPrefixMapping String prefix String uri List list List prefixMapping get prefix if list null list new ArrayList prefixMapping put prefix list list add uri public void endPrefixMapping String prefix List list List prefixMapping get prefix if list null list size list remove list size public String getPrefixMapping String prefix List list List prefixMapping get prefix if list null list size return null return String list get list size public Map getCurrentTargets return currentTargets public void setCurrentTargets Map currentTargets this currentTargets currentTargets public class JakartaRegexpMatcher implements RegexpMatcher private String pattern public void setPattern String pattern this pattern pattern public String getPattern return pattern protected RE getCompiledPattern int options throws BuildException int cOptions getCompilerOptions options try RE reg new RE pattern reg setMatchFlags cOptions return reg catch RESyntaxException throw new BuildException public boolean matches String argument throws BuildException return matches argument MATCH_DEFAULT public boolean matches String input int options throws BuildException return matches input getCompiledPattern options private boolean matches String input RE reg return reg match input public Vector getGroups String argument throws BuildException return getGroups argument MATCH_DEFAULT public Vector getGroups String input int options throws BuildException RE reg getCompiledPattern options if matches input reg return null Vector new Vector int cnt reg getParenCount for int cnt String match reg getParen if match null match addElement match return protected int getCompilerOptions int options int cOptions RE MATCH_NORMAL if RegexpUtil hasFlag options MATCH_CASE_INSENSITIVE cOptions RE MATCH_CASEINDEPENDENT if RegexpUtil hasFlag options MATCH_MULTILINE cOptions RE MATCH_MULTILINE if RegexpUtil hasFlag options MATCH_SINGLELINE cOptions RE MATCH_SINGLELINE return cOptions public class JakartaRegexpRegexp extends JakartaRegexpMatcher implements Regexp public JakartaRegexpRegexp super protected int getSubsOptions int options int subsOptions RE REPLACE_FIRSTONLY if RegexpUtil hasFlag options REPLACE_ALL subsOptions RE REPLACE_ALL return subsOptions public String substitute String input String argument int options throws BuildException Vector getGroups input options StringBuffer result new StringBuffer for int argument length char argument charAt if if argument length argument charAt int value Character digit if value result append String elementAt value else result append else result append else result append argument result toString RE reg getCompiledPattern options int sOptions getSubsOptions options return reg subst input argument sOptions public class Pvcs extends org apache tools ant Task private static final int POS_1 private static final int POS_2 private static final int POS_3 private String pvcsbin private String repository private String pvcsProject private Vector pvcsProjects private String workspace private String force private String promotiongroup private String label private String revision private boolean ignorerc private boolean updateOnly private String filenameFormat private String lineStart private String userId private String config private static final String PCLI_EXE private static final String GET_EXE protected int runCmd Commandline cmd ExecuteStreamHandler out try Project aProj getProject Execute exe new Execute out exe setAntRun aProj exe setWorkingDirectory aProj getBaseDir exe setCommandline cmd getCommandline return exe execute catch java io IOException String msg cmd toString getMessage throw new BuildException msg getLocation private String getExecutable String exe StringBuffer correctedExe new StringBuffer if getPvcsbin null if pvcsbin endsWith File separator correctedExe append pvcsbin else correctedExe append pvcsbin append File separator return correctedExe append exe toString public void execute throws org apache tools ant BuildException int result if repository null repository trim equals throw new BuildException Commandline commandLine new Commandline commandLine setExecutable getExecutable PCLI_EXE commandLine createArgument setValue commandLine createArgument setValue commandLine createArgument setValue if getWorkspace null commandLine createArgument setValue getWorkspace commandLine createArgument setValue getRepository String uid getUserId if uid null commandLine createArgument setValue uid if getPvcsproject null getPvcsprojects isEmpty pvcsProject if getPvcsproject null commandLine createArgument setValue getPvcsproject if getPvcsprojects isEmpty Enumeration getPvcsprojects elements while hasMoreElements String projectName PvcsProject nextElement getName if projectName null projectName trim equals throw new BuildException commandLine createArgument setValue projectName File tmp null File tmp2 null try Random rand new Random System currentTimeMillis tmp new File rand nextLong FileOutputStream fos new FileOutputStream tmp tmp2 new File rand nextLong log commandLine describeCommand Project MSG_VERBOSE try result runCmd commandLine new PumpStreamHandler fos new LogOutputStream this Project MSG_WARN finally fos close if Execute isFailure result ignorerc String msg commandLine toString throw new BuildException msg getLocation if tmp exists throw new BuildException log Project MSG_INFO createFolders tmp massagePCLI tmp tmp2 commandLine clearArgs commandLine setExecutable getExecutable GET_EXE if getConfig null getConfig length commandLine createArgument setValue getConfig if getForce null getForce equals commandLine createArgument setValue else commandLine createArgument setValue if getPromotiongroup null commandLine createArgument setValue getPromotiongroup else if getLabel null commandLine createArgument setValue getLabel else if getRevision null commandLine createArgument setValue getRevision if updateOnly commandLine createArgument setValue commandLine createArgument setValue tmp2 getAbsolutePath log Project MSG_INFO log commandLine toString Project MSG_VERBOSE result runCmd commandLine new LogStreamHandler this Project MSG_INFO Project MSG_WARN if result ignorerc String msg commandLine toString result throw new BuildException msg getLocation catch FileNotFoundException String msg commandLine toString getMessage throw new BuildException msg getLocation catch IOException String msg commandLine toString getMessage throw new BuildException msg getLocation catch ParseException String msg commandLine toString getMessage throw new BuildException msg getLocation finally if tmp null tmp delete if tmp2 null tmp2 delete private void createFolders File file throws IOException ParseException BufferedReader in null try in new BufferedReader new FileReader file MessageFormat mf new MessageFormat getFilenameFormat String line in readLine while line null log line Project MSG_VERBOSE line length POS_3 line startsWith Character isLetter line charAt POS_1 String valueOf line charAt POS_2 equals String valueOf line charAt POS_3 equals Object objs mf parse line String String objs int index lastIndexOf File separator if index File dir new File substring index if dir exists log dir getAbsolutePath Project MSG_VERBOSE if dir mkdirs log dir getAbsolutePath Project MSG_INFO else log dir getAbsolutePath Project MSG_INFO else log dir getAbsolutePath Project MSG_VERBOSE else log line Project MSG_WARN else log line Project MSG_VERBOSE line in readLine finally if in null in close private void massagePCLI File in File out throws IOException BufferedReader inReader null BufferedWriter outWriter null try inReader new BufferedReader new FileReader in outWriter new BufferedWriter new FileWriter out String null while inReader readLine null String sNormal replace outWriter write sNormal outWriter newLine finally if inReader null inReader close if outWriter null outWriter close public String getRepository return repository public String getFilenameFormat return filenameFormat public void setFilenameFormat String filenameFormat public String getLineStart return lineStart public void setLineStart String lineStart public void setRepository String repo repository repo public String getPvcsproject return pvcsProject public void setPvcsproject String prj pvcsProject prj public Vector getPvcsprojects return pvcsProjects public String getWorkspace return workspace public void setWorkspace String ws workspace ws public String getPvcsbin return pvcsbin public void setPvcsbin String bin pvcsbin bin public String getForce return force public void setForce String if null equalsIgnoreCase force else force public String getPromotiongroup return promotiongroup public void setPromotiongroup String promotiongroup public String getLabel return label public void setLabel String label public String getRevision return revision public void setRevision String revision public boolean getIgnoreReturnCode return ignorerc public void setIgnoreReturnCode boolean ignorerc public void addPvcsproject PvcsProject pvcsProjects addElement public boolean getUpdateOnly return updateOnly public void setUpdateOnly boolean updateOnly public String getConfig return config public void setConfig File config toString public String getUserId return userId public void setUserId String userId public Pvcs super pvcsProject null pvcsProjects new Vector workspace null repository null pvcsbin null force null promotiongroup null label null ignorerc false updateOnly false lineStart filenameFormat public class TarInputStream extends FilterInputStream protected boolean debug protected boolean hasHitEOF protected long entrySize protected long entryOffset protected byte readBuf protected TarBuffer buffer protected TarEntry currEntry protected byte oneBuf public TarInputStream InputStream is this is TarBuffer DEFAULT_BLKSIZE TarBuffer DEFAULT_RCDSIZE public TarInputStream InputStream is int blockSize this is blockSize TarBuffer DEFAULT_RCDSIZE public TarInputStream InputStream is int blockSize int recordSize super is this buffer new TarBuffer is blockSize recordSize this readBuf null this oneBuf new byte this debug false this hasHitEOF false public void setDebug boolean debug this debug debug this buffer setDebug debug public void close throws IOException this buffer close public int getRecordSize return this buffer getRecordSize public int available throws IOException if this entrySize this entryOffset Integer MAX_VALUE return Integer MAX_VALUE return int this entrySize this entryOffset public long skip long numToSkip throws IOException byte skipBuf new byte long skip numToSkip while skip int realSkip int skip skipBuf length skipBuf length skip int numRead this read skipBuf realSkip if numRead break skip numRead return numToSkip skip public boolean markSupported return false public void mark int markLimit public void reset public TarEntry getNextEntry throws IOException if this hasHitEOF return null if this currEntry null long numToSkip this entrySize this entryOffset if this debug System err println this currEntry getName this entrySize this entryOffset numToSkip if numToSkip this skip numToSkip this readBuf null byte headerBuf this buffer readRecord if headerBuf null if this debug System err println this hasHitEOF true else if this buffer isEOFRecord headerBuf if this debug System err println this hasHitEOF true if this hasHitEOF this currEntry null else this currEntry new TarEntry headerBuf if this debug System err println this currEntry getName this currEntry getSize this entryOffset this entrySize this currEntry getSize if this currEntry null this currEntry isGNULongNameEntry StringBuffer longName new StringBuffer byte buf new byte int length while length read buf longName append new String buf length getNextEntry if this currEntry null return null if longName length longName charAt longName length longName deleteCharAt longName length this currEntry setName longName toString return this currEntry public int read throws IOException int num this read this oneBuf return num int this oneBuf public int read byte buf int offset int numToRead throws IOException int totalRead if this entryOffset this entrySize return if numToRead this entryOffset this entrySize numToRead int this entrySize this entryOffset if this readBuf null int sz numToRead this readBuf length this readBuf length numToRead System arraycopy this readBuf buf offset sz if sz this readBuf length this readBuf null else int newLen this readBuf length sz byte newBuf new byte newLen System arraycopy this readBuf sz newBuf newLen this readBuf newBuf totalRead sz numToRead sz offset sz while numToRead byte rec this buffer readRecord if rec null throw new IOException numToRead int sz numToRead int recLen rec length if recLen sz System arraycopy rec buf offset sz this readBuf new byte recLen sz System arraycopy rec sz this readBuf recLen sz else sz recLen System arraycopy rec buf offset recLen totalRead sz numToRead sz offset sz this entryOffset totalRead return totalRead public void copyEntryContents OutputStream out throws IOException byte buf new byte while true int numRead this read buf buf length if numRead break out write buf numRead public class NoneSelector extends BaseSelectorContainer public NoneSelector public String toString StringBuffer buf new StringBuffer if hasSelectors buf append buf append super toString buf append return buf toString public boolean isSelected File basedir String filename File file validate Enumeration selectorElements boolean result while hasMoreElements result FileSelector nextElement isSelected basedir filename file if result return false return true public interface FileSelector boolean isSelected File basedir String filename File file throws BuildException public class Or extends ConditionBase implements Condition public boolean eval throws BuildException Enumeration getConditions while hasMoreElements Condition Condition nextElement if eval return true return false public class Chmod extends ExecuteOn private FileSet defaultSet new FileSet private boolean defaultSetDefined false private boolean havePerm false public Chmod super setExecutable super setParallel true super setSkipEmptyFilesets true public void setProject Project project super setProject project defaultSet setProject project public void setFile File src FileSet fs new FileSet fs setFile src addFileset fs public void setDir File src defaultSet setDir src public void setPerm String perm createArg setValue perm havePerm true public PatternSet NameEntry createInclude defaultSetDefined true return defaultSet createInclude public PatternSet NameEntry createExclude defaultSetDefined true return defaultSet createExclude public PatternSet createPatternSet defaultSetDefined true return defaultSet createPatternSet public void setIncludes String includes defaultSetDefined true defaultSet setIncludes includes public void setExcludes String excludes defaultSetDefined true defaultSet setExcludes excludes public void setDefaultexcludes boolean useDefaultExcludes defaultSetDefined true defaultSet setDefaultexcludes useDefaultExcludes protected void checkConfiguration if havePerm throw new BuildException getLocation if defaultSetDefined defaultSet getDir getProject null addFileset defaultSet super checkConfiguration public void execute throws BuildException if defaultSetDefined defaultSet getDir getProject null try super execute finally if defaultSetDefined defaultSet getDir getProject null filesets removeElement defaultSet else if isValidOs Execute execute prepareExec Commandline cloned Commandline cmdl clone cloned createArgument setValue defaultSet getDir getProject getPath try execute setCommandline cloned getCommandline runExecute execute catch IOException throw new BuildException getLocation finally logFlush public void setExecutable String throw new BuildException getTaskType getLocation public void setCommand Commandline cmdl throw new BuildException getTaskType getLocation public void setSkipEmptyFilesets boolean skip throw new BuildException getTaskType getLocation public void setAddsourcefile boolean throw new BuildException getTaskType getLocation protected boolean isValidOs return Os isFamily Os FAMILY_UNIX super isValidOs public class ContainsRegexpSelector extends BaseExtendSelector implements ResourceSelector private String userProvidedExpression null private RegularExpression myRegExp null private Regexp myExpression null public static final String EXPRESSION_KEY public ContainsRegexpSelector public String toString StringBuffer buf new StringBuffer buf append userProvidedExpression buf append return buf toString public void setExpression String theexpression this userProvidedExpression theexpression public void setParameters Parameter parameters super setParameters parameters if parameters null for int parameters length String paramname parameters getName if EXPRESSION_KEY equalsIgnoreCase paramname setExpression parameters getValue else setError paramname public void verifySettings if userProvidedExpression null setError public boolean isSelected File basedir String filename File file return isSelected new FileResource file public boolean isSelected Resource String teststr null BufferedReader in null validate if isDirectory return true if myRegExp null myRegExp new RegularExpression myRegExp setPattern userProvidedExpression myExpression myRegExp getRegexp getProject try in new BufferedReader new InputStreamReader getInputStream catch Exception throw new BuildException toLongString try teststr in readLine while teststr null if myExpression matches teststr return true teststr in readLine return false catch IOException ioe throw new BuildException toLongString finally if in null try in close catch Exception throw new BuildException toLongString public class BZip2Resource extends CompressedResource private static final char MAGIC new char public BZip2Resource public BZip2Resource org apache tools ant types ResourceCollection other super other protected InputStream wrapStream InputStream in throws IOException for int MAGIC length if in read MAGIC throw new IOException return new CBZip2InputStream in protected OutputStream wrapStream OutputStream out throws IOException for int MAGIC length out write MAGIC return new CBZip2OutputStream out protected String getCompressionName return private File localFile private String remotePath private List directoryList public ScpToMessageBySftp boolean verbose Session session File aLocalFile String aRemotePath this verbose session aRemotePath this localFile aLocalFile public ScpToMessageBySftp boolean verbose Session session List aDirectoryList String aRemotePath this verbose session aRemotePath this directoryList aDirectoryList private ScpToMessageBySftp boolean verbose Session session String aRemotePath super verbose session this remotePath aRemotePath public ScpToMessageBySftp Session session File aLocalFile String aRemotePath this false session aLocalFile aRemotePath public ScpToMessageBySftp Session session List aDirectoryList String aRemotePath this false session aDirectoryList aRemotePath public void execute throws IOException JSchException if directoryList null doMultipleTransfer if localFile null doSingleTransfer log private void doSingleTransfer throws IOException JSchException ChannelSftp channel openSftpChannel try channel connect try sendFileToRemote channel localFile remotePath catch SftpException throw new JSchException toString finally if channel null channel disconnect private void doMultipleTransfer throws IOException JSchException ChannelSftp channel openSftpChannel try channel connect try channel cd remotePath for Iterator directoryList iterator hasNext Directory current Directory next sendDirectory channel current catch SftpException throw new JSchException toString finally if channel null channel disconnect private void sendDirectory ChannelSftp channel Directory current throws IOException SftpException for Iterator fileIt current filesIterator fileIt hasNext sendFileToRemote channel File fileIt next null for Iterator dirIt current directoryIterator dirIt hasNext Directory dir Directory dirIt next sendDirectoryToRemote channel dir private void sendDirectoryToRemote ChannelSftp channel Directory directory throws IOException SftpException String dir directory getDirectory getName try channel stat dir catch SftpException if id ChannelSftp SSH_FX_NO_SUCH_FILE channel mkdir dir channel cd dir sendDirectory channel directory channel cd private void sendFileToRemote ChannelSftp channel File localFile String remotePath throws IOException SftpException long filesize localFile length if remotePath null remotePath localFile getName long startTime System currentTimeMillis long totalLength filesize boolean trackProgress getVerbose filesize SftpProgressMonitor monitor null if trackProgress monitor getProgressMonitor try if this getVerbose log localFile getName filesize channel put localFile getAbsolutePath remotePath monitor finally if this getVerbose long endTime System currentTimeMillis logStats startTime endTime int totalLength public File getLocalFile return localFile public String getRemotePath return remotePath public class Assertions extends DataType implements Cloneable private Boolean enableSystemAssertions private ArrayList assertionList new ArrayList public void addEnable EnabledAssertion assertion checkChildrenAllowed assertionList add assertion public void addDisable DisabledAssertion assertion checkChildrenAllowed assertionList add assertion public void setEnableSystemAssertions Boolean enableSystemAssertions checkAttributesAllowed this enableSystemAssertions enableSystemAssertions public void setRefid Reference ref if assertionList size enableSystemAssertions null throw tooManyAttributes super setRefid ref private Assertions getFinalReference if getRefid null return this else Object getRefid getReferencedObject getProject if instanceof Assertions throw new BuildException return Assertions public int size Assertions clause getFinalReference return clause getFinalSize private int getFinalSize return assertionList size enableSystemAssertions null public void applyAssertions List commandList getProject log Project MSG_DEBUG Assertions clause getFinalReference if Boolean TRUE equals clause enableSystemAssertions getProject log Project MSG_DEBUG commandList add else if Boolean FALSE equals clause enableSystemAssertions getProject log Project MSG_DEBUG commandList add Iterator it clause assertionList iterator while it hasNext BaseAssertion assertion BaseAssertion it next String arg assertion toCommand getProject log arg Project MSG_DEBUG commandList add arg public void applyAssertions CommandlineJava command Assertions clause getFinalReference if Boolean TRUE equals clause enableSystemAssertions addVmArgument command else if Boolean FALSE equals clause enableSystemAssertions addVmArgument command Iterator it clause assertionList iterator while it hasNext BaseAssertion assertion BaseAssertion it next String arg assertion toCommand addVmArgument command arg public void applyAssertions final ListIterator commandIterator getProject log Project MSG_DEBUG Assertions clause getFinalReference if Boolean TRUE equals clause enableSystemAssertions getProject log Project MSG_DEBUG commandIterator add else if Boolean FALSE equals clause enableSystemAssertions getProject log Project MSG_DEBUG commandIterator add Iterator it clause assertionList iterator while it hasNext BaseAssertion assertion BaseAssertion it next String arg assertion toCommand getProject log arg Project MSG_DEBUG commandIterator add arg private static void addVmArgument CommandlineJava command String arg Commandline Argument argument argument command createVmArgument argument setValue arg public Object clone throws CloneNotSupportedException Assertions that Assertions super clone that assertionList ArrayList assertionList clone return that public abstract static class BaseAssertion private String className public void setClass String className this className className protected String getClassName return className protected String getPackageName public abstract String getCommandPrefix public String toCommand if getPackageName null getClassName null StringBuffer command new StringBuffer getCommandPrefix if getPackageName null command append command append getPackageName if command toString endsWith command append else if getClassName null command append command append getClassName return command toString public static class EnabledAssertion extends BaseAssertion public String getCommandPrefix return public static class DisabledAssertion extends BaseAssertion public String getCommandPrefix return public class IsReference extends ProjectComponent implements Condition private Reference ref private String type public void setRefid Reference ref public void setType String type this type type public boolean eval throws BuildException if ref null throw new BuildException Object getProject getReference ref getRefId if null return false else if type null return true else Class typeClass Class getProject getDataTypeDefinitions get type if typeClass null typeClass Class getProject getTaskDefinitions get type if typeClass null return false return typeClass isAssignableFrom getClass public class ProjectHelper2 extends ProjectHelper private static AntHandler elementHandler new ElementHandler private static AntHandler targetHandler new TargetHandler private static AntHandler mainHandler new MainHandler private static AntHandler projectHandler new ProjectHandler private static final FileUtils FILE_UTILS FileUtils getFileUtils public UnknownElement parseUnknownElement Project project URL source throws BuildException Target dummyTarget new Target dummyTarget setProject project AntXMLContext context new AntXMLContext project context addTarget dummyTarget context setImplicitTarget dummyTarget parse context getProject source new RootHandler context elementHandler Task tasks dummyTarget getTasks if tasks length throw new BuildException return UnknownElement tasks public void parse Project project Object source throws BuildException getImportStack addElement source AntXMLContext context null context AntXMLContext project getReference if context null context new AntXMLContext project project addReference context project addReference context getTargets if getImportStack size context setIgnoreProjectTag true Target currentTarget context getCurrentTarget Target currentImplicit context getImplicitTarget Map currentTargets context getCurrentTargets try Target newCurrent new Target newCurrent setProject project newCurrent setName context setCurrentTarget newCurrent context setCurrentTargets new HashMap context setImplicitTarget newCurrent parse project source new RootHandler context mainHandler newCurrent execute finally context setCurrentTarget currentTarget context setImplicitTarget currentImplicit context setCurrentTargets currentTargets else context setCurrentTargets new HashMap parse project source new RootHandler context mainHandler context getImplicitTarget execute public void parse Project project Object source RootHandler handler throws BuildException AntXMLContext context handler context File buildFile null URL url null String buildFileName null if source instanceof File buildFile File source buildFile FILE_UTILS normalize buildFile getAbsolutePath context setBuildFile buildFile buildFileName buildFile toString else if source instanceof URL url URL source buildFileName url toString else throw new BuildException source getClass getName InputStream inputStream null InputSource inputSource null try XMLReader parser JAXPUtils getNamespaceXMLReader String uri null if buildFile null uri FILE_UTILS toURI buildFile getAbsolutePath inputStream new FileInputStream buildFile else inputStream url openStream inputSource new InputSource inputStream if uri null inputSource setSystemId uri project log buildFileName uri Project MSG_VERBOSE DefaultHandler hb handler parser setContentHandler hb parser setEntityResolver hb parser setErrorHandler hb parser setDTDHandler hb parser parse inputSource catch SAXParseException exc Location location new Location exc getSystemId exc getLineNumber exc getColumnNumber Throwable exc getException if instanceof BuildException BuildException be BuildException if be getLocation Location UNKNOWN_LOCATION be setLocation location throw be else if null exc throw new BuildException exc getMessage location catch SAXException exc Throwable exc getException if instanceof BuildException throw BuildException else if null exc throw new BuildException exc getMessage catch FileNotFoundException exc throw new BuildException exc catch UnsupportedEncodingException exc throw new BuildException buildFileName exc catch IOException exc throw new BuildException buildFileName exc getMessage exc finally FileUtils close inputStream protected static AntHandler getMainHandler return mainHandler protected static void setMainHandler AntHandler handler mainHandler handler protected static AntHandler getProjectHandler return projectHandler protected static void setProjectHandler AntHandler handler projectHandler handler protected static AntHandler getTargetHandler return targetHandler protected static void setTargetHandler AntHandler handler targetHandler handler protected static AntHandler getElementHandler return elementHandler protected static void setElementHandler AntHandler handler elementHandler handler public static class AntHandler public void onStartElement String uri String tag String qname Attributes attrs AntXMLContext context throws SAXParseException public AntHandler onStartChild String uri String tag String qname Attributes attrs AntXMLContext context throws SAXParseException throw new SAXParseException qname context getLocator public void onEndChild String uri String tag String qname AntXMLContext context throws SAXParseException public void onEndElement String uri String tag AntXMLContext context public void characters char buf int start int count AntXMLContext context throws SAXParseException String new String buf start count trim if length throw new SAXParseException context getLocator protected void checkNamespace String uri public static class RootHandler extends DefaultHandler private Stack antHandlers new Stack private AntHandler currentHandler null private AntXMLContext context public RootHandler AntXMLContext context AntHandler rootHandler currentHandler rootHandler antHandlers push currentHandler this context context public AntHandler getCurrentAntHandler return currentHandler public InputSource resolveEntity String publicId String systemId context getProject log systemId Project MSG_VERBOSE if systemId startsWith String path FILE_UTILS fromURI systemId File file new File path if file isAbsolute file FILE_UTILS resolveFile context getBuildFileParent path context getProject log systemId context getBuildFile path replace Project MSG_WARN context getProject log file Project MSG_DEBUG try InputSource inputSource new InputSource new FileInputStream file inputSource setSystemId FILE_UTILS toURI file getAbsolutePath return inputSource catch FileNotFoundException fne context getProject log file getAbsolutePath Project MSG_WARN context getProject log Project MSG_DEBUG return null public void startElement String uri String tag String qname Attributes attrs throws SAXParseException AntHandler next currentHandler onStartChild uri tag qname attrs context antHandlers push currentHandler currentHandler next currentHandler onStartElement uri tag qname attrs context public void setDocumentLocator Locator locator context setLocator locator public void endElement String uri String name String qName throws SAXException currentHandler onEndElement uri name context AntHandler prev AntHandler antHandlers pop currentHandler prev if currentHandler null currentHandler onEndChild uri name qName context public void characters char buf int start int count throws SAXParseException currentHandler characters buf start count context public void startPrefixMapping String prefix String uri context startPrefixMapping prefix uri public void endPrefixMapping String prefix context endPrefixMapping prefix public static class MainHandler extends AntHandler public AntHandler onStartChild String uri String name String qname Attributes attrs AntXMLContext context throws SAXParseException if name equals uri equals uri equals ANT_CORE_URI return ProjectHelper2 projectHandler else if name equals qname throw new SAXParseException uri name ANT_CORE_URI name context getLocator else throw new SAXParseException qname name context getLocator public static class ProjectHandler extends AntHandler public void onStartElement String uri String tag String qname Attributes attrs AntXMLContext context throws SAXParseException String baseDir null boolean nameAttributeSet false Project project context getProject context getImplicitTarget setLocation new Location context getLocator for int attrs getLength String attrUri attrs getURI if attrUri null attrUri equals attrUri equals uri String key attrs getLocalName String value attrs getValue if key equals if value null value equals if context isIgnoringProjectTag project setDefault value else if key equals if value null context setCurrentProjectName value nameAttributeSet true if context isIgnoringProjectTag project setName value project addReference value project else if key equals if value null if context isIgnoringProjectTag project addReference value project else if key equals if context isIgnoringProjectTag baseDir value else throw new SAXParseException attrs getQName context getLocator String antFileProp context getCurrentProjectName String dup project getProperty antFileProp if dup null nameAttributeSet File dupFile new File dup if context isIgnoringProjectTag dupFile equals context getBuildFile context getCurrentProjectName dup context getBuildFile Project MSG_WARN if context getBuildFile null nameAttributeSet project setUserProperty context getCurrentProjectName context getBuildFile toString if context isIgnoringProjectTag return if project getProperty null project setBasedir project getProperty else if baseDir null project setBasedir context getBuildFileParent getAbsolutePath else if new File baseDir isAbsolute project setBasedir baseDir else project setBaseDir FILE_UTILS resolveFile context getBuildFileParent baseDir project addTarget context getImplicitTarget context setCurrentTarget context getImplicitTarget public AntHandler onStartChild String uri String name String qname Attributes attrs AntXMLContext context throws SAXParseException if name equals uri equals uri equals ANT_CORE_URI return ProjectHelper2 targetHandler else return ProjectHelper2 elementHandler public static class TargetHandler extends AntHandler public void onStartElement String uri String tag String qname Attributes attrs AntXMLContext context throws SAXParseException String name null String depends Project project context getProject Target target new Target target setProject project target setLocation new Location context getLocator context addTarget target for int attrs getLength String attrUri attrs getURI if attrUri null attrUri equals attrUri equals uri String key attrs getLocalName String value attrs getValue if key equals name value if equals name throw new BuildException else if key equals depends value else if key equals target setIf value else if key equals target setUnless value else if key equals if value null value equals context getProject addReference value target else if key equals target setDescription value else throw new SAXParseException key context getLocator if name null throw new SAXParseException context getLocator if context getCurrentTargets get name null throw new BuildException name target getLocation Hashtable projectTargets project getTargets boolean usedTarget false if projectTargets containsKey name name Project MSG_VERBOSE else target setName name context getCurrentTargets put name target project addOrReplaceTarget name target usedTarget true if depends length target setDepends depends if context isIgnoringProjectTag context getCurrentProjectName null context getCurrentProjectName length String newName context getCurrentProjectName name Target newTarget usedTarget new Target target target newTarget setName newName context getCurrentTargets put newName newTarget project addOrReplaceTarget newName newTarget public AntHandler onStartChild String uri String name String qname Attributes attrs AntXMLContext context throws SAXParseException return ProjectHelper2 elementHandler public void onEndElement String uri String tag AntXMLContext context context setCurrentTarget context getImplicitTarget public static class ElementHandler extends AntHandler public ElementHandler public void onStartElement String uri String tag String qname Attributes attrs AntXMLContext context throws SAXParseException RuntimeConfigurable parentWrapper context currentWrapper Object parent null if parentWrapper null parent parentWrapper getProxy UnknownElement task new UnknownElement tag task setProject context getProject task setNamespace uri task setQName qname task setTaskType ProjectHelper genComponentName task getNamespace tag task setTaskName qname Location location new Location context getLocator getSystemId context getLocator getLineNumber context getLocator getColumnNumber task setLocation location task setOwningTarget context getCurrentTarget if parent null UnknownElement parent addChild task else context getCurrentTarget addTask task context configureId task attrs RuntimeConfigurable wrapper new RuntimeConfigurable task task getTaskName for int attrs getLength String name attrs getLocalName String attrUri attrs getURI if attrUri null attrUri equals attrUri equals uri name attrUri attrs getQName String value attrs getValue if ANT_TYPE equals name ANT_CORE_URI equals attrUri ANT_TYPE equals attrs getLocalName name ANT_TYPE int index value indexOf if index String prefix value substring index String mappedUri context getPrefixMapping prefix if mappedUri null throw new BuildException prefix value ProjectHelper genComponentName mappedUri value substring index wrapper setAttribute name value if parentWrapper null parentWrapper addChild wrapper context pushWrapper wrapper public void characters char buf int start int count AntXMLContext context throws SAXParseException RuntimeConfigurable wrapper context currentWrapper wrapper addText buf start count public AntHandler onStartChild String uri String tag String qname Attributes attrs AntXMLContext context throws SAXParseException return ProjectHelper2 elementHandler public void onEndElement String uri String tag AntXMLContext context context popWrapper public class AggregateTransformer public static final String FRAMES public static final String NOFRAMES public static class Format extends EnumeratedAttribute public String getValues return new String FRAMES NOFRAMES protected Task task protected Document document protected File styleDir protected File toDir private List params private static final FileUtils FILE_UTILS FileUtils getFileUtils private static int counter protected String format FRAMES private static DocumentBuilderFactory privateDBFactory protected static DocumentBuilderFactory dbfactory static privateDBFactory DocumentBuilderFactory newInstance dbfactory privateDBFactory public AggregateTransformer Task task this task task params new Vector protected static DocumentBuilderFactory getDocumentBuilderFactory return privateDBFactory public void setFormat Format format this format format getValue public void setXmlDocument Document doc this document doc protected void setXmlfile File xmlfile throws BuildException try DocumentBuilder builder privateDBFactory newDocumentBuilder InputStream in new FileInputStream xmlfile try Document doc builder parse in setXmlDocument doc finally in close catch Exception throw new BuildException xmlfile public void setStyledir File styledir this styleDir styledir public void setTodir File todir this toDir todir public void setExtension String ext task log Project MSG_WARN public XSLTProcess Param createParam XSLTProcess Param new XSLTProcess Param params add return public void transform throws BuildException checkOptions Project project task getProject TempFile tempFileTask new TempFile tempFileTask bindToOwner task XSLTProcess xsltTask new XSLTProcess xsltTask bindToOwner task xsltTask setXslResource getStylesheet xsltTask setIn XMLResultAggregator task getDestinationFile File outputFile null if format equals FRAMES String tempFileProperty getClass getName String valueOf counter File tmp FILE_UTILS resolveFile project getBaseDir project getProperty tempFileTask setDestDir tmp tempFileTask setProperty tempFileProperty tempFileTask execute outputFile new File project getProperty tempFileProperty else outputFile new File toDir xsltTask setOut outputFile for Iterator params iterator hasNext XSLTProcess Param param XSLTProcess Param next XSLTProcess Param newParam xsltTask createParam newParam setProject task getProject newParam setName param getName newParam setExpression param getExpression XSLTProcess Param paramx xsltTask createParam paramx setProject task getProject paramx setName paramx setExpression toDir getAbsolutePath final long t0 System currentTimeMillis try xsltTask execute catch Exception throw new BuildException getMessage final long dt System currentTimeMillis t0 task log dt if format equals FRAMES Delete delete new Delete delete bindToOwner task delete setFile outputFile delete execute protected Resource getStylesheet String xslname if NOFRAMES equals format xslname if styleDir null URLResource stylesheet new URLResource URL stylesheetURL getClass getClassLoader getResource xslname stylesheet setURL stylesheetURL return stylesheet FileResource stylesheet new FileResource File stylesheetFile new File styleDir xslname stylesheet setFile stylesheetFile return stylesheet protected void checkOptions throws BuildException if toDir null toDir task getProject resolveFile else if toDir isAbsolute toDir task getProject resolveFile toDir getPath protected String getStylesheetSystemId throws IOException String xslname if NOFRAMES equals format xslname if styleDir null URL url getClass getResource xslname if url null throw new FileNotFoundException xslname return url toExternalForm File file new File styleDir xslname if file exists throw new FileNotFoundException file return JAXPUtils getSystemId file public class FullAnalyzer extends AbstractAnalyzer public FullAnalyzer try new ClassParser catch IOException protected void determineDependencies Vector files Vector classes Hashtable dependencies new Hashtable Hashtable containers new Hashtable Hashtable toAnalyze new Hashtable for Enumeration getRootClasses hasMoreElements String classname String nextElement toAnalyze put classname classname int count int maxCount isClosureRequired MAX_LOOPS while toAnalyze size count maxCount DependencyVisitor dependencyVisitor new DependencyVisitor for Enumeration toAnalyze keys hasMoreElements String classname String nextElement dependencies put classname classname try File container getClassContainer classname if container null continue containers put container container ClassParser parser null if container getName endsWith parser new ClassParser container getPath else parser new ClassParser container getPath classname replace JavaClass javaClass parser parse DescendingVisitor traverser new DescendingVisitor javaClass dependencyVisitor traverser visit catch IOException ioe toAnalyze clear Enumeration depsEnum dependencyVisitor getDependencies while depsEnum hasMoreElements String className String depsEnum nextElement if dependencies containsKey className toAnalyze put className className files removeAllElements for Enumeration containers keys hasMoreElements files addElement File nextElement classes removeAllElements for Enumeration dependencies keys hasMoreElements classes addElement String nextElement protected boolean supportsFileDependencies return true public interface LogListener void log String message class ProcessDestroyer implements Runnable private Vector processes new Vector private Method addShutdownHookMethod private Method removeShutdownHookMethod private ProcessDestroyerImpl destroyProcessThread null private boolean added false private boolean running false private class ProcessDestroyerImpl extends Thread private boolean shouldDestroy true public ProcessDestroyerImpl super public void run if shouldDestroy ProcessDestroyer this run public void setShouldDestroy boolean shouldDestroy this shouldDestroy shouldDestroy public ProcessDestroyer try Class paramTypes Thread class addShutdownHookMethod Runtime class getMethod paramTypes removeShutdownHookMethod Runtime class getMethod paramTypes catch NoSuchMethodException catch Exception printStackTrace private void addShutdownHook if addShutdownHookMethod null running destroyProcessThread new ProcessDestroyerImpl Object args destroyProcessThread try addShutdownHookMethod invoke Runtime getRuntime args added true catch IllegalAccessException printStackTrace catch InvocationTargetException Throwable getTargetException if null getClass IllegalStateException class running true else printStackTrace private void removeShutdownHook if removeShutdownHookMethod null added running Object args destroyProcessThread try Boolean removed Boolean removeShutdownHookMethod invoke Runtime getRuntime args if removed booleanValue System err println catch IllegalAccessException printStackTrace catch InvocationTargetException Throwable getTargetException if null getClass IllegalStateException class running true else printStackTrace destroyProcessThread setShouldDestroy false if destroyProcessThread getThreadGroup isDestroyed destroyProcessThread start try destroyProcessThread join catch InterruptedException ie destroyProcessThread null added false public boolean isAddedAsShutdownHook return added public boolean add Process process synchronized processes if processes size addShutdownHook processes addElement process return processes contains process public boolean remove Process process synchronized processes boolean processRemoved processes removeElement process if processRemoved processes size removeShutdownHook return processRemoved public void run synchronized processes running true Enumeration processes elements while hasMoreElements Process nextElement destroy public class Name extends ResourceComparator protected int resourceCompare Resource foo Resource bar return foo getName compareTo bar getName public class EscapeUnicode extends BaseParamFilterReader implements ChainableReader private StringBuffer unicodeBuf public EscapeUnicode super unicodeBuf new StringBuffer public EscapeUnicode final Reader in super in unicodeBuf new StringBuffer public final int read throws IOException if getInitialized initialize setInitialized true int ch if unicodeBuf length ch in read if ch char achar char ch if achar unicodeBuf new StringBuffer String Integer toHexString ch for int length unicodeBuf setCharAt unicodeBuf length length charAt ch else ch int unicodeBuf charAt unicodeBuf deleteCharAt return ch public final Reader chain final Reader rdr EscapeUnicode newFilter new EscapeUnicode rdr newFilter setInitialized true return newFilter private void initialize public abstract class DefaultNative2Ascii implements Native2AsciiAdapter public DefaultNative2Ascii public final boolean convert Native2Ascii args File srcFile File destFile throws BuildException Commandline cmd new Commandline setup cmd args addFiles cmd args srcFile destFile return run cmd args protected void setup Commandline cmd Native2Ascii args throws BuildException if args getEncoding null cmd createArgument setValue cmd createArgument setValue args getEncoding cmd addArguments args getCurrentArgs protected void addFiles Commandline cmd ProjectComponent log File src File dest throws BuildException cmd createArgument setFile src cmd createArgument setFile dest protected abstract boolean run Commandline cmd ProjectComponent log throws BuildException public class RegexpUtil public static boolean hasFlag int options int flag return options flag public static int removeFlag int options int flag return options flag public class PumpStreamHandler implements ExecuteStreamHandler private Thread outputThread private Thread errorThread private StreamPumper inputPump private OutputStream out private OutputStream err private InputStream input public PumpStreamHandler OutputStream out OutputStream err InputStream input this out out this err err this input input public PumpStreamHandler OutputStream out OutputStream err this out err null public PumpStreamHandler OutputStream outAndErr this outAndErr outAndErr public PumpStreamHandler this System out System err public void setProcessOutputStream InputStream is createProcessOutputPump is out public void setProcessErrorStream InputStream is if err null createProcessErrorPump is err public void setProcessInputStream OutputStream os if input null inputPump createInputPump input os true else try os close catch IOException public void start outputThread start errorThread start if inputPump null Thread inputThread new Thread inputPump inputThread setDaemon true inputThread start public void stop try outputThread join catch InterruptedException try errorThread join catch InterruptedException if inputPump null inputPump stop try err flush catch IOException try out flush catch IOException protected OutputStream getErr return err protected OutputStream getOut return out protected void createProcessOutputPump InputStream is OutputStream os outputThread createPump is os protected void createProcessErrorPump InputStream is OutputStream os errorThread createPump is os protected Thread createPump InputStream is OutputStream os return createPump is os false protected Thread createPump InputStream is OutputStream os boolean closeWhenExhausted final Thread result new Thread new StreamPumper is os closeWhenExhausted result setDaemon true return result boolean closeWhenExhausted StreamPumper pumper new StreamPumper is os closeWhenExhausted pumper setAutoflush true return pumper public class Parallel extends Task implements TaskContainer public static class TaskList implements TaskContainer private List tasks new ArrayList public void addTask Task nestedTask tasks add nestedTask private Vector nestedTasks new Vector private final Object semaphore new Object private int numThreads private int numThreadsPerProcessor private long timeout private volatile boolean stillRunning private boolean timedOut private boolean failOnAny private TaskList daemonTasks private StringBuffer exceptionMessage private int numExceptions private Throwable firstException private Location firstLocation public void addDaemons TaskList daemonTasks if this daemonTasks null throw new BuildException this daemonTasks daemonTasks public void setPollInterval int pollInterval public void setFailOnAny boolean failOnAny this failOnAny failOnAny public void addTask Task nestedTask nestedTasks addElement nestedTask public void setThreadsPerProcessor int numThreadsPerProcessor this numThreadsPerProcessor numThreadsPerProcessor public void setThreadCount int numThreads this numThreads numThreads public void setTimeout long timeout this timeout timeout public void execute throws BuildException updateThreadCounts if numThreads numThreads nestedTasks size spinThreads private void updateThreadCounts if numThreadsPerProcessor int numProcessors getNumProcessors if numProcessors numThreads numProcessors numThreadsPerProcessor private void processExceptions TaskRunnable runnables if runnables null return for int runnables length Throwable runnables getException if null numExceptions if firstException null firstException if instanceof BuildException firstLocation Location UNKNOWN_LOCATION firstLocation BuildException getLocation exceptionMessage append StringUtils LINE_SEP exceptionMessage append getMessage private void spinThreads throws BuildException final int numTasks nestedTasks size TaskRunnable runnables new TaskRunnable numTasks stillRunning true timedOut false int threadNumber for Enumeration nestedTasks elements hasMoreElements threadNumber Task nestedTask Task nextElement runnables threadNumber new TaskRunnable nestedTask final int maxRunning numTasks numThreads numTasks numThreads TaskRunnable running new TaskRunnable maxRunning threadNumber ThreadGroup group new ThreadGroup TaskRunnable daemons null if daemonTasks null daemonTasks tasks size daemons new TaskRunnable daemonTasks tasks size synchronized semaphore synchronized semaphore if daemons null for int daemons length daemons new TaskRunnable Task daemonTasks tasks get Thread daemonThread new Thread group daemons daemonThread setDaemon true daemonThread start for int maxRunning running runnables threadNumber Thread thread new Thread group running thread start if timeout Thread timeoutThread new Thread public synchronized void run try wait timeout synchronized semaphore stillRunning false timedOut true semaphore notifyAll catch InterruptedException timeoutThread start outer while threadNumber numTasks stillRunning for int maxRunning if running null running isFinished running runnables threadNumber Thread thread new Thread group running thread start continue outer try semaphore wait catch InterruptedException ie outer2 while stillRunning for int maxRunning if running null running isFinished try semaphore wait catch InterruptedException ie continue outer2 stillRunning false if timedOut throw new BuildException exceptionMessage new StringBuffer numExceptions firstException null firstLocation Location UNKNOWN_LOCATION processExceptions daemons processExceptions runnables if numExceptions if firstException instanceof BuildException throw BuildException firstException else throw new BuildException firstException else if numExceptions throw new BuildException exceptionMessage toString firstLocation private int getNumProcessors try Class paramTypes Method availableProcessors Runtime class getMethod paramTypes Object args Integer ret Integer availableProcessors invoke Runtime getRuntime args return ret intValue catch Exception return private class TaskRunnable implements Runnable private Throwable exception private Task task private boolean finished TaskRunnable Task task this task task public void run try task perform catch Throwable exception if failOnAny stillRunning false finally synchronized semaphore finished true semaphore notifyAll public Throwable getException return exception boolean isFinished return finished public class PropertyOutputStream extends ByteArrayOutputStream private Project project private String property private boolean trim public PropertyOutputStream Project String this true public PropertyOutputStream Project String boolean project property trim public void close if project null property null String new String toByteArray project setNewProperty property trim trim class PlainMailer extends Mailer public void send try MailMessage mailMessage new MailMessage host port mailMessage from from toString Enumeration replyToList elements while hasMoreElements mailMessage replyto nextElement toString toList elements while hasMoreElements mailMessage to nextElement toString ccList elements while hasMoreElements mailMessage cc nextElement toString bccList elements while hasMoreElements mailMessage bcc nextElement toString if subject null mailMessage setSubject subject mailMessage setHeader getDate if message getCharset null mailMessage setHeader message getMimeType message getCharset else mailMessage setHeader message getMimeType headers elements while hasMoreElements Header Header nextElement mailMessage setHeader getName getValue PrintStream out mailMessage getPrintStream message print out files elements while hasMoreElements attach File nextElement out mailMessage sendAndClose catch IOException ioe throw new BuildException ioe protected void attach File file PrintStream out throws IOException if file exists file canRead throw new BuildException file getName if includeFileNames out println String filename file getName int filenamelength filename length out println filename for int star star filenamelength star out print out println int length final int maxBuf byte buf new byte maxBuf FileInputStream finstr new FileInputStream file try BufferedInputStream in new BufferedInputStream finstr buf length while length in read buf out write buf length finally finstr close public class AntResolver implements ExtensionResolver private File antfile private File destfile private String target public void setAntfile final File antfile this antfile antfile public void setDestfile final File destfile this destfile destfile public void setTarget final String target this target target public File resolve final Extension extension final Project project throws BuildException validate final Ant ant new Ant ant setProject project ant setInheritAll false ant setAntfile antfile getName try final File dir antfile getParentFile getCanonicalFile ant setDir dir catch final IOException ioe throw new BuildException ioe getMessage ioe if null target ant setTarget target ant execute return destfile private void validate if null antfile final String message throw new BuildException message if null destfile final String message throw new BuildException message public String toString return antfile destfile public abstract class DefaultCompilerAdapter implements CompilerAdapter private static final FileUtils FILE_UTILS FileUtils getFileUtils protected Path src protected File destDir protected String encoding protected boolean debug false protected boolean optimize false protected boolean deprecation false protected boolean depend false protected boolean verbose false protected String target protected Path bootclasspath protected Path extdirs protected Path compileClasspath protected Path compileSourcepath protected Project project protected Location location protected boolean includeAntRuntime protected boolean includeJavaRuntime protected String memoryInitialSize protected String memoryMaximumSize protected File compileList protected Javac attributes protected static final String lSep StringUtils LINE_SEP public void setJavac Javac attributes this attributes attributes src attributes getSrcdir destDir attributes getDestdir encoding attributes getEncoding debug attributes getDebug optimize attributes getOptimize deprecation attributes getDeprecation depend attributes getDepend verbose attributes getVerbose target attributes getTarget bootclasspath attributes getBootclasspath extdirs attributes getExtdirs compileList attributes getFileList compileClasspath attributes getClasspath compileSourcepath attributes getSourcepath project attributes getProject location attributes getLocation includeAntRuntime attributes getIncludeantruntime includeJavaRuntime attributes getIncludejavaruntime memoryInitialSize attributes getMemoryInitialSize memoryMaximumSize attributes getMemoryMaximumSize public Javac getJavac return attributes protected Project getProject return project protected Path getCompileClasspath Path classpath new Path project if destDir null classpath setLocation destDir Path cp compileClasspath if cp null cp new Path project if includeAntRuntime classpath addExisting cp concatSystemClasspath else classpath addExisting cp concatSystemClasspath if includeJavaRuntime classpath addJavaRuntime return classpath protected Commandline setupJavacCommandlineSwitches Commandline cmd return setupJavacCommandlineSwitches cmd false protected Commandline setupJavacCommandlineSwitches Commandline cmd boolean useDebugLevel Path classpath getCompileClasspath Path sourcepath null if compileSourcepath null sourcepath compileSourcepath else sourcepath src String memoryParameterPrefix assumeJava11 if memoryInitialSize null if attributes isForkedJavac attributes log Project MSG_WARN else cmd createArgument setValue memoryParameterPrefix memoryInitialSize if memoryMaximumSize null if attributes isForkedJavac attributes log Project MSG_WARN else cmd createArgument setValue memoryParameterPrefix memoryMaximumSize if attributes getNowarn cmd createArgument setValue if deprecation cmd createArgument setValue if destDir null cmd createArgument setValue cmd createArgument setFile destDir cmd createArgument setValue if assumeJava11 Path cp new Path project Path bp getBootClassPath if bp size cp append bp if extdirs null cp addExtdirs extdirs cp append classpath cp append sourcepath cmd createArgument setPath cp else cmd createArgument setPath classpath if sourcepath size cmd createArgument setValue cmd createArgument setPath sourcepath if target null cmd createArgument setValue cmd createArgument setValue target Path bp getBootClassPath if bp size cmd createArgument setValue cmd createArgument setPath bp if extdirs null extdirs size cmd createArgument setValue cmd createArgument setPath extdirs if encoding null cmd createArgument setValue cmd createArgument setValue encoding if debug if useDebugLevel assumeJava11 String debugLevel attributes getDebugLevel if debugLevel null cmd createArgument setValue debugLevel else cmd createArgument setValue else cmd createArgument setValue else if getNoDebugArgument null cmd createArgument setValue getNoDebugArgument if optimize cmd createArgument setValue if depend if assumeJava11 cmd createArgument setValue else if assumeJava12 cmd createArgument setValue else attributes log Project MSG_WARN if verbose cmd createArgument setValue addCurrentCompilerArgs cmd return cmd protected Commandline setupModernJavacCommandlineSwitches Commandline cmd setupJavacCommandlineSwitches cmd true if attributes getSource null assumeJava13 cmd createArgument setValue String source attributes getSource if assumeJava14 assumeJava15 source equals source equals cmd createArgument setValue else cmd createArgument setValue source else if assumeJava15 assumeJava16 attributes getTarget null String attributes getTarget if equals equals equals equals String if equals attributes log Project MSG_WARN attributes log Project MSG_WARN attributes log Project MSG_WARN attributes log Project MSG_WARN attributes log Project MSG_WARN attributes log Project MSG_WARN cmd createArgument setValue cmd createArgument setValue return cmd protected Commandline setupModernJavacCommand Commandline cmd new Commandline setupModernJavacCommandlineSwitches cmd logAndAddFilesToCompile cmd return cmd protected Commandline setupJavacCommand return setupJavacCommand false protected Commandline setupJavacCommand boolean debugLevelCheck Commandline cmd new Commandline setupJavacCommandlineSwitches cmd debugLevelCheck logAndAddFilesToCompile cmd return cmd protected void logAndAddFilesToCompile Commandline cmd attributes log cmd describeArguments Project MSG_VERBOSE StringBuffer niceSourceList new StringBuffer if compileList length niceSourceList append niceSourceList append niceSourceList append StringUtils LINE_SEP for int compileList length String arg compileList getAbsolutePath cmd createArgument setValue arg niceSourceList append niceSourceList append arg niceSourceList append StringUtils LINE_SEP attributes log niceSourceList toString Project MSG_VERBOSE protected int executeExternalCompile String args int firstFileName return executeExternalCompile args firstFileName true protected int executeExternalCompile String args int firstFileName boolean quoteFiles String commandArray null File tmpFile null try if Commandline toString args length firstFileName PrintWriter out null try tmpFile FILE_UTILS createTempFile getJavac getTempdir tmpFile deleteOnExit out new PrintWriter new FileWriter tmpFile for int firstFileName args length if quoteFiles args indexOf args args replace File separatorChar out println args else out println args out flush commandArray new String firstFileName System arraycopy args commandArray firstFileName commandArray firstFileName tmpFile catch IOException throw new BuildException location finally FileUtils close out else commandArray args try Execute exe new Execute new LogStreamHandler attributes Project MSG_INFO Project MSG_WARN if Os isFamily exe setVMLauncher true exe setAntRun project exe setWorkingDirectory project getBaseDir exe setCommandline commandArray exe execute return exe getExitValue catch IOException throw new BuildException args location finally if tmpFile null tmpFile delete protected void addExtdirsToClasspath Path classpath classpath addExtdirs extdirs protected void addCurrentCompilerArgs Commandline cmd cmd addArguments getJavac getCurrentCompilerArgs protected boolean assumeJava11 return equals attributes getCompilerVersion protected boolean assumeJava12 return equals attributes getCompilerVersion equals attributes getCompilerVersion JavaEnvUtils isJavaVersion JavaEnvUtils JAVA_1_2 equals attributes getCompilerVersion JavaEnvUtils isJavaVersion JavaEnvUtils JAVA_1_2 protected boolean assumeJava13 return equals attributes getCompilerVersion equals attributes getCompilerVersion JavaEnvUtils isJavaVersion JavaEnvUtils JAVA_1_3 equals attributes getCompilerVersion JavaEnvUtils isJavaVersion JavaEnvUtils JAVA_1_3 equals attributes getCompilerVersion JavaEnvUtils isJavaVersion JavaEnvUtils JAVA_1_3 protected boolean assumeJava14 return equals attributes getCompilerVersion equals attributes getCompilerVersion JavaEnvUtils isJavaVersion JavaEnvUtils JAVA_1_4 equals attributes getCompilerVersion JavaEnvUtils isJavaVersion JavaEnvUtils JAVA_1_4 equals attributes getCompilerVersion JavaEnvUtils isJavaVersion JavaEnvUtils JAVA_1_4 protected boolean assumeJava15 return equals attributes getCompilerVersion equals attributes getCompilerVersion JavaEnvUtils isJavaVersion JavaEnvUtils JAVA_1_5 equals attributes getCompilerVersion JavaEnvUtils isJavaVersion JavaEnvUtils JAVA_1_5 equals attributes getCompilerVersion JavaEnvUtils isJavaVersion JavaEnvUtils JAVA_1_5 protected boolean assumeJava16 return equals attributes getCompilerVersion equals attributes getCompilerVersion JavaEnvUtils isJavaVersion JavaEnvUtils JAVA_1_6 equals attributes getCompilerVersion JavaEnvUtils isJavaVersion JavaEnvUtils JAVA_1_6 equals attributes getCompilerVersion JavaEnvUtils isJavaVersion JavaEnvUtils JAVA_1_6 protected Path getBootClassPath Path bp new Path project if bootclasspath null bp append bootclasspath return bp concatSystemBootClasspath protected String getNoDebugArgument return assumeJava11 null public abstract class SSHBase extends Task implements LogListener private static final int SSH_PORT private String host private String knownHosts private int port SSH_PORT private boolean failOnError true private boolean verbose private SSHUserInfo userInfo public SSHBase super userInfo new SSHUserInfo public void setHost String host this host host public String getHost return host public void setFailonerror boolean failure failOnError failure public boolean getFailonerror return failOnError public void setVerbose boolean verbose this verbose verbose public boolean getVerbose return verbose public void setUsername String username userInfo setName username public void setPassword String password userInfo setPassword password public void setKeyfile String keyfile userInfo setKeyfile keyfile public void setPassphrase String passphrase userInfo setPassphrase passphrase public void setKnownhosts String knownHosts this knownHosts knownHosts public void setTrust boolean yesOrNo userInfo setTrust yesOrNo public void setPort int port this port port public int getPort return port public void init throws BuildException super init this knownHosts System getProperty this port SSH_PORT protected Session openSession throws JSchException JSch jsch new JSch if null userInfo getKeyfile jsch addIdentity userInfo getKeyfile if userInfo getTrust knownHosts null log knownHosts Project MSG_DEBUG jsch setKnownHosts knownHosts Session session jsch getSession userInfo getName host port session setUserInfo userInfo log host port session connect return session protected SSHUserInfo getUserInfo return userInfo public class DotnetResource private File file private boolean embed true private Boolean isPublic null private String name null private ArrayList fileSets new ArrayList private String namespace null public boolean isEmbed return embed public void setEmbed boolean embed this embed embed public File getFile return file public void setFile File file this file file public Boolean getPublic return isPublic public void setPublic Boolean aPublic isPublic aPublic public String getName return name public void setName String name this name name public String getNamespace return namespace public void setNamespace String namespace if namespace null this namespace null else this namespace namespace length namespace endsWith namespace namespace private void checkParameters if hasFilesets if getName null throw new BuildException if getFile null throw new BuildException else if getNamespace null throw new BuildException public void getParameters Project NetCommand command boolean csharpStyle checkParameters if hasFilesets for Iterator listIter fileSets iterator listIter hasNext FileSet fs FileSet listIter next String baseDirectory fs getDir toString DirectoryScanner ds fs getDirectoryScanner String files ds getIncludedFiles for int files length String file files command addArgument getParameter baseDirectory File separatorChar file namespace null null namespace file replace File separatorChar csharpStyle else command addArgument getParameter getFile toString getName csharpStyle private String getParameter String fileName String name boolean csharpStyle StringBuffer buffer new StringBuffer buffer append isEmbed buffer append buffer append fileName if name null buffer append buffer append name if csharpStyle if getPublic null throw new BuildException else if getPublic null buffer append buffer append getPublic booleanValue else if getPublic null throw new BuildException return buffer toString public void addFileset FileSet fileset fileSets add fileset public boolean hasFilesets return fileSets size public class LongCPInfo extends ConstantCPInfo public LongCPInfo super CONSTANT_LONG public void read DataInputStream cpStream throws IOException setValue new Long cpStream readLong public String toString return getValue public class BZip2 extends Pack protected void pack CBZip2OutputStream zOut null try BufferedOutputStream bos new BufferedOutputStream new FileOutputStream zipFile bos write bos write zOut new CBZip2OutputStream bos zipResource getSrcResource zOut catch IOException ioe String msg ioe getMessage throw new BuildException msg ioe getLocation finally FileUtils close zOut protected boolean supportsNonFileResources return getClass equals BZip2 class public class Property extends Task protected String name protected String value protected File file protected URL url protected String resource protected Path classpath protected String env protected Reference ref protected String prefix private Project fallback public Property this false protected Property boolean userProperty this userProperty null protected Property boolean userProperty Project fallback this userProperty userProperty this fallback fallback public void setName String name this name name public String getName return name public void setLocation File location setValue location getAbsolutePath public void setValue String value this value value public String getValue return value public void setFile File file this file file public File getFile return file public void setUrl URL url this url url public URL getUrl return url public void setPrefix String prefix this prefix prefix if prefix endsWith this prefix public String getPrefix return prefix public void setRefid Reference ref this ref ref public Reference getRefid return ref public void setResource String resource this resource resource public String getResource return resource public void setEnvironment String env this env env public String getEnvironment return env public void setClasspath Path classpath if this classpath null this classpath classpath else this classpath append classpath public Path createClasspath if this classpath null this classpath new Path getProject return this classpath createPath public void setClasspathRef Reference createClasspath setRefid public Path getClasspath return classpath public void setUserProperty boolean userProperty log Project MSG_WARN public String toString return value null value public void execute throws BuildException if getProject null throw new IllegalStateException if name null if value null ref null throw new BuildException getLocation else if url null file null resource null env null throw new BuildException getLocation if url null file null resource null prefix null throw new BuildException getLocation if name null value null addProperty name value if file null loadFile file if url null loadUrl url if resource null loadResource resource if env null loadEnvironment env if name null ref null try addProperty name ref getReferencedObject getProject toString catch BuildException be if fallback null addProperty name ref getReferencedObject fallback toString else throw be protected void loadUrl URL url throws BuildException Properties props new Properties log url Project MSG_VERBOSE try InputStream is url openStream try props load is finally if is null is close addProperties props catch IOException ex throw new BuildException ex getLocation protected void loadFile File file throws BuildException Properties props new Properties log file getAbsolutePath Project MSG_VERBOSE try if file exists FileInputStream fis new FileInputStream file try props load fis finally if fis null fis close addProperties props else log file getAbsolutePath Project MSG_VERBOSE catch IOException ex throw new BuildException ex getLocation protected void loadResource String name Properties props new Properties log name Project MSG_VERBOSE InputStream is null try ClassLoader cL null if classpath null cL getProject createClassLoader classpath else cL this getClass getClassLoader if cL null is ClassLoader getSystemResourceAsStream name else is cL getResourceAsStream name if is null props load is addProperties props else log name Project MSG_WARN catch IOException ex throw new BuildException ex getLocation finally if is null try is close catch IOException protected void loadEnvironment String prefix Properties props new Properties if prefix endsWith prefix log prefix Project MSG_VERBOSE Vector osEnv Execute getProcEnvironment for Enumeration osEnv elements hasMoreElements String entry String nextElement int pos entry indexOf if pos log entry Project MSG_WARN else props put prefix entry substring pos entry substring pos addProperties props protected void addProperties Properties props resolveAllProperties props Enumeration props keys while hasMoreElements String propertyName String nextElement String propertyValue props getProperty propertyName String getProject replaceProperties propertyValue if prefix null propertyName prefix propertyName addProperty propertyName protected void addProperty String String if userProperty if getProject getUserProperty null getProject setInheritedProperty else log Project MSG_VERBOSE else getProject setNewProperty private void resolveAllProperties Properties props throws BuildException for Enumeration props keys hasMoreElements String propertyName String nextElement Stack referencesSeen new Stack resolve props propertyName referencesSeen private void resolve Properties props String name Stack referencesSeen throws BuildException if referencesSeen contains name throw new BuildException name String propertyValue props getProperty name Vector fragments new Vector Vector propertyRefs new Vector PropertyHelper getPropertyHelper this getProject parsePropertyString propertyValue fragments propertyRefs if propertyRefs size referencesSeen push name StringBuffer sb new StringBuffer Enumeration fragments elements Enumeration propertyRefs elements while hasMoreElements String fragment String nextElement if fragment null String propertyName String nextElement fragment getProject getProperty propertyName if fragment null if props containsKey propertyName resolve props propertyName referencesSeen fragment props getProperty propertyName else fragment propertyName sb append fragment propertyValue sb toString props put name propertyValue referencesSeen pop public class StringCPInfo extends ConstantCPInfo public StringCPInfo super CONSTANT_STRING public void read DataInputStream cpStream throws IOException index cpStream readUnsignedShort setValue public String toString return getValue index public void resolve ConstantPool constantPool setValue Utf8CPInfo constantPool getEntry index getValue super resolve constantPool private int index class RedirectingOutputStream extends LineOrientedOutputStream private final ChangeLogParser parser public RedirectingOutputStream final ChangeLogParser parser this parser parser protected void processLine final String line parser stdout line public abstract class BaseFilterReader extends FilterReader private static final int BUFFER_SIZE private boolean initialized false private Project project null public BaseFilterReader super new StringReader FileUtils close this public BaseFilterReader final Reader in super in public final int read final char cbuf final int off final int len throws IOException for int len final int ch read if ch if return else return cbuf off char ch return len public final long skip final long throws IOException IllegalArgumentException if throw new IllegalArgumentException for long if read return return protected final void setInitialized final boolean initialized this initialized initialized protected final boolean getInitialized return initialized public final void setProject final Project project this project project protected final Project getProject return project protected final String readLine throws IOException int ch in read if ch return null StringBuffer line new StringBuffer while ch line append char ch if ch break ch in read return line toString protected final String readFully throws IOException return FileUtils readFully in BUFFER_SIZE public class DirSet extends AbstractFileSet implements ResourceCollection public DirSet super protected DirSet DirSet dirset super dirset public Object clone if isReference return DirSet getRef getProject clone else return super clone public Iterator iterator if isReference return DirSet getRef getProject iterator return new FileResourceIterator getDir getProject getDirectoryScanner getProject getIncludedDirectories public int size if isReference return DirSet getRef getProject size return getDirectoryScanner getProject getIncludedDirsCount public boolean isFilesystemOnly return true public String toString DirectoryScanner ds getDirectoryScanner getProject String dirs ds getIncludedDirectories StringBuffer sb new StringBuffer for int dirs length if sb append sb append dirs return sb toString public final class SunNative2Ascii extends DefaultNative2Ascii public static final String IMPLEMENTATION_NAME protected void setup Commandline cmd Native2Ascii args throws BuildException if args getReverse cmd createArgument setValue super setup cmd args protected boolean run Commandline cmd ProjectComponent log throws BuildException try Class n2aMain Class forName Class param new Class String class Method convert n2aMain getMethod param if convert null throw new BuildException Object n2aMain newInstance return Boolean convert invoke new Object cmd getArguments booleanValue catch BuildException ex throw ex catch Exception ex throw new BuildException ex public class PreSetDef extends AntlibDefinition implements TaskContainer private UnknownElement nestedTask private String name public void setName String name this name name public void addTask Task nestedTask if this nestedTask null throw new BuildException if nestedTask instanceof UnknownElement throw new BuildException this nestedTask UnknownElement nestedTask public void execute if nestedTask null throw new BuildException if name null throw new BuildException name ProjectHelper genComponentName getURI name ComponentHelper helper ComponentHelper getComponentHelper getProject String componentName ProjectHelper genComponentName nestedTask getNamespace nestedTask getTag AntTypeDefinition def helper getDefinition componentName if def null throw new BuildException componentName PreSetDefinition newDef new PreSetDefinition def nestedTask newDef setName name helper addDataTypeDefinition newDef log name Project MSG_VERBOSE public static class PreSetDefinition extends AntTypeDefinition private AntTypeDefinition parent private UnknownElement element public PreSetDefinition AntTypeDefinition parent UnknownElement el if parent instanceof PreSetDefinition PreSetDefinition PreSetDefinition parent el applyPreSet element parent parent this parent parent this element el public void setClass Class clazz throw new BuildException public void setClassName String className throw new BuildException public String getClassName return parent getClassName public void setAdapterClass Class adapterClass throw new BuildException public void setAdaptToClass Class adaptToClass throw new BuildException public void setClassLoader ClassLoader classLoader throw new BuildException public ClassLoader getClassLoader return parent getClassLoader public Class getExposedClass Project project return parent getExposedClass project public Class getTypeClass Project project return parent getTypeClass project public void checkClass Project project parent checkClass project public Object createObject Project project return parent create project public UnknownElement getPreSets return element public Object create Project project return this public boolean sameDefinition AntTypeDefinition other Project project return other null other getClass getClass parent null parent sameDefinition PreSetDefinition other parent project element similar PreSetDefinition other element public boolean similarDefinition AntTypeDefinition other Project project return other null other getClass getName equals getClass getName parent null parent similarDefinition PreSetDefinition other parent project element similar PreSetDefinition other element public class JavahAdapterFactory public static String getDefault if JavaEnvUtils isKaffe return Kaffeh IMPLEMENTATION_NAME return SunJavah IMPLEMENTATION_NAME public static JavahAdapter getAdapter String choice ProjectComponent log throws BuildException if JavaEnvUtils isKaffe choice null Kaffeh IMPLEMENTATION_NAME equals choice return new Kaffeh else if SunJavah IMPLEMENTATION_NAME equals choice return new SunJavah else if choice null return resolveClassName choice return new SunJavah private static JavahAdapter resolveClassName String className throws BuildException return JavahAdapter ClasspathUtils newInstance className JavahAdapterFactory class getClassLoader JavahAdapter class public abstract class AbstractScriptComponent extends ProjectComponent private ScriptRunnerHelper helper new ScriptRunnerHelper private ScriptRunnerBase runner null public void setProject Project project super setProject project helper setProjectComponent this public ScriptRunnerBase getRunner initScriptRunner return runner public void setSrc File file helper setSrc file public void addText String text helper addText text public void setManager String manager helper setManager manager public void setLanguage String language helper setLanguage language protected void initScriptRunner if runner null return helper setProjectComponent this runner helper getScriptRunner public void setClasspath Path classpath helper setClasspath classpath public Path createClasspath return helper createClasspath public void setClasspathRef Reference helper setClasspathRef protected void executeScript String execName getRunner executeScript execName public class WeblogicDeploymentTool extends GenericDeploymentTool public static final String PUBLICID_EJB11 public static final String PUBLICID_EJB20 public static final String PUBLICID_WEBLOGIC_EJB510 public static final String PUBLICID_WEBLOGIC_EJB600 public static final String PUBLICID_WEBLOGIC_EJB700 protected static final String DEFAULT_WL51_EJB11_DTD_LOCATION protected static final String DEFAULT_WL60_EJB11_DTD_LOCATION protected static final String DEFAULT_WL60_EJB20_DTD_LOCATION protected static final String DEFAULT_WL51_DTD_LOCATION protected static final String DEFAULT_WL60_51_DTD_LOCATION protected static final String DEFAULT_WL60_DTD_LOCATION protected static final String DEFAULT_WL70_DTD_LOCATION protected static final String DEFAULT_COMPILER protected static final String WL_DD protected static final String WL_CMP_DD protected static final String COMPILER_EJB11 protected static final String COMPILER_EJB20 private static final FileUtils FILE_UTILS FileUtils getFileUtils private String jarSuffix private String weblogicDTD private String ejb11DTD private boolean keepgenerated false private String ejbcClass null private String additionalArgs private String additionalJvmArgs private boolean keepGeneric false private String compiler null private boolean alwaysRebuild true private boolean noEJBC false private boolean newCMP false private Path wlClasspath null private Vector sysprops new Vector private Integer jvmDebugLevel null private File outputDir public void addSysproperty Environment Variable sysp sysprops add sysp public Path createWLClasspath if wlClasspath null wlClasspath new Path getTask getProject return wlClasspath createPath public void setOutputDir File outputDir this outputDir outputDir public void setWLClasspath Path wlClasspath this wlClasspath wlClasspath public void setCompiler String compiler this compiler compiler public void setRebuild boolean rebuild this alwaysRebuild rebuild public void setJvmDebugLevel Integer jvmDebugLevel this jvmDebugLevel jvmDebugLevel public Integer getJvmDebugLevel return jvmDebugLevel public void setSuffix String inString this jarSuffix inString public void setKeepgeneric boolean inValue this keepGeneric inValue public void setKeepgenerated String inValue this keepgenerated Boolean valueOf inValue booleanValue public void setArgs String args this additionalArgs args public void setJvmargs String args this additionalJvmArgs args public void setEjbcClass String ejbcClass this ejbcClass ejbcClass public String getEjbcClass return ejbcClass public void setWeblogicdtd String inString setEJBdtd inString public void setWLdtd String inString this weblogicDTD inString public void setEJBdtd String inString this ejb11DTD inString public void setOldCMP boolean oldCMP this newCMP oldCMP public void setNewCMP boolean newCMP this newCMP newCMP public void setNoEJBC boolean noEJBC this noEJBC noEJBC protected void registerKnownDTDs DescriptorHandler handler handler registerDTD PUBLICID_EJB11 DEFAULT_WL51_EJB11_DTD_LOCATION handler registerDTD PUBLICID_EJB11 DEFAULT_WL60_EJB11_DTD_LOCATION handler registerDTD PUBLICID_EJB11 ejb11DTD handler registerDTD PUBLICID_EJB20 DEFAULT_WL60_EJB20_DTD_LOCATION protected DescriptorHandler getWeblogicDescriptorHandler final File srcDir DescriptorHandler handler new DescriptorHandler getTask srcDir protected void processElement if currentElement equals String fileNameWithMETA currentText String fileName fileNameWithMETA substring META_DIR length fileNameWithMETA length File descriptorFile new File srcDir fileName ejbFiles put fileNameWithMETA descriptorFile handler registerDTD PUBLICID_WEBLOGIC_EJB510 DEFAULT_WL51_DTD_LOCATION handler registerDTD PUBLICID_WEBLOGIC_EJB510 DEFAULT_WL60_51_DTD_LOCATION handler registerDTD PUBLICID_WEBLOGIC_EJB600 DEFAULT_WL60_DTD_LOCATION handler registerDTD PUBLICID_WEBLOGIC_EJB700 DEFAULT_WL70_DTD_LOCATION handler registerDTD PUBLICID_WEBLOGIC_EJB510 weblogicDTD handler registerDTD PUBLICID_WEBLOGIC_EJB600 weblogicDTD for Iterator getConfig dtdLocations iterator hasNext EjbJar DTDLocation dtdLocation EjbJar DTDLocation next handler registerDTD dtdLocation getPublicId dtdLocation getLocation return handler protected void addVendorFiles Hashtable ejbFiles String ddPrefix File weblogicDD new File getConfig descriptorDir ddPrefix WL_DD if weblogicDD exists ejbFiles put META_DIR WL_DD weblogicDD else log weblogicDD getPath Project MSG_WARN return if newCMP log Project MSG_VERBOSE log Project MSG_VERBOSE File weblogicCMPDD new File getConfig descriptorDir ddPrefix WL_CMP_DD if weblogicCMPDD exists ejbFiles put META_DIR WL_CMP_DD weblogicCMPDD else try File ejbDescriptor File ejbFiles get META_DIR EJB_DD SAXParserFactory saxParserFactory SAXParserFactory newInstance saxParserFactory setValidating true SAXParser saxParser saxParserFactory newSAXParser DescriptorHandler handler getWeblogicDescriptorHandler ejbDescriptor getParentFile saxParser parse new InputSource new FileInputStream weblogicDD handler Hashtable ht handler getFiles Enumeration ht keys while hasMoreElements String key String nextElement ejbFiles put key ht get key catch Exception String msg toString throw new BuildException msg File getVendorOutputJarFile String baseName return new File getDestDir baseName jarSuffix private void buildWeblogicJar File sourceJar File destJar String publicId Java javaTask null if noEJBC try FILE_UTILS copyFile sourceJar destJar if keepgenerated sourceJar delete return catch IOException throw new BuildException String ejbcClassName ejbcClass try javaTask new Java getTask javaTask setTaskName javaTask createJvmarg setLine additionalJvmArgs if sysprops isEmpty for Enumeration en sysprops elements en hasMoreElements Environment Variable entry Environment Variable en nextElement javaTask addSysproperty entry if getJvmDebugLevel null javaTask createJvmarg setLine jvmDebugLevel if ejbcClassName null if PUBLICID_EJB11 equals publicId ejbcClassName COMPILER_EJB11 else if PUBLICID_EJB20 equals publicId ejbcClassName COMPILER_EJB20 else log publicId Project MSG_WARN ejbcClassName COMPILER_EJB11 javaTask setClassname ejbcClassName javaTask createArg setLine additionalArgs if keepgenerated javaTask createArg setValue if compiler null String buildCompiler getTask getProject getProperty if buildCompiler null buildCompiler equals javaTask createArg setValue javaTask createArg setValue else if compiler equals DEFAULT_COMPILER javaTask createArg setValue javaTask createArg setLine compiler Path combinedClasspath getCombinedClasspath if wlClasspath null combinedClasspath null combinedClasspath toString trim length javaTask createArg setValue javaTask createArg setPath combinedClasspath javaTask createArg setValue sourceJar getPath if outputDir null javaTask createArg setValue destJar getPath else javaTask createArg setValue outputDir getPath Path classpath wlClasspath if classpath null classpath getCombinedClasspath javaTask setFork true if classpath null javaTask setClasspath classpath log ejbcClassName sourceJar toString Project MSG_VERBOSE if javaTask executeJava throw new BuildException catch Exception String msg ejbcClassName toString throw new BuildException msg protected void writeJar String baseName File jarFile Hashtable files String publicId throws BuildException File genericJarFile super getVendorOutputJarFile baseName super writeJar baseName genericJarFile files publicId if alwaysRebuild isRebuildRequired genericJarFile jarFile buildWeblogicJar genericJarFile jarFile publicId if keepGeneric log genericJarFile toString Project MSG_VERBOSE genericJarFile delete public void validateConfigured throws BuildException super validateConfigured protected boolean isRebuildRequired File genericJarFile File weblogicJarFile boolean rebuild false JarFile genericJar null JarFile wlJar null File newWLJarFile null JarOutputStream newJarStream null ClassLoader genericLoader null try log weblogicJarFile getName Project MSG_VERBOSE if genericJarFile exists genericJarFile isFile weblogicJarFile exists weblogicJarFile isFile genericJar new JarFile genericJarFile wlJar new JarFile weblogicJarFile Hashtable genericEntries new Hashtable Hashtable wlEntries new Hashtable Hashtable replaceEntries new Hashtable for Enumeration genericJar entries hasMoreElements JarEntry je JarEntry nextElement genericEntries put je getName replace je for Enumeration wlJar entries hasMoreElements JarEntry je JarEntry nextElement wlEntries put je getName je genericLoader getClassLoaderFromJar genericJarFile for Enumeration genericEntries keys hasMoreElements String filepath String nextElement if wlEntries containsKey filepath JarEntry genericEntry JarEntry genericEntries get filepath JarEntry wlEntry JarEntry wlEntries get filepath if genericEntry getCrc wlEntry getCrc genericEntry getSize wlEntry getSize if genericEntry getName endsWith String classname genericEntry getName replace File separatorChar classname classname substring classname lastIndexOf Class genclass genericLoader loadClass classname if genclass isInterface log genclass getName Project MSG_VERBOSE rebuild true break else replaceEntries put filepath genericEntry else if genericEntry getName equals log genericEntry getName Project MSG_VERBOSE rebuild true break else log filepath Project MSG_VERBOSE rebuild true break if rebuild log Project MSG_VERBOSE newWLJarFile new File weblogicJarFile getAbsolutePath if newWLJarFile exists newWLJarFile delete newJarStream new JarOutputStream new FileOutputStream newWLJarFile newJarStream setLevel for Enumeration wlEntries elements hasMoreElements byte buffer new byte DEFAULT_BUFFER_SIZE int bytesRead InputStream is JarEntry je JarEntry nextElement if je getCompressedSize je getCompressedSize je getSize newJarStream setLevel else newJarStream setLevel JAR_COMPRESS_LEVEL if replaceEntries containsKey je getName log je getName Project MSG_VERBOSE je JarEntry replaceEntries get je getName is genericJar getInputStream je else is wlJar getInputStream je newJarStream putNextEntry new JarEntry je getName while bytesRead is read buffer newJarStream write buffer bytesRead is close else log Project MSG_VERBOSE else rebuild true catch ClassNotFoundException cnfe String cnfmsg cnfe getMessage throw new BuildException cnfmsg cnfe catch IOException ioe String msg ioe getMessage throw new BuildException msg ioe finally if genericJar null try genericJar close catch IOException closeException if wlJar null try wlJar close catch IOException closeException if newJarStream null try newJarStream close catch IOException closeException try FILE_UTILS rename newWLJarFile weblogicJarFile catch IOException renameException log renameException getMessage Project MSG_WARN rebuild true if genericLoader null genericLoader instanceof AntClassLoader AntClassLoader loader AntClassLoader genericLoader loader cleanup return rebuild protected ClassLoader getClassLoaderFromJar File classjar throws IOException Path lookupPath new Path getTask getProject lookupPath setLocation classjar Path classpath getCombinedClasspath if classpath null lookupPath append classpath return getTask getProject createClassLoader lookupPath public class DelegatedResourceComparator extends ResourceComparator private Vector null public synchronized void add ResourceComparator if isReference throw noChildrenAllowed if null return null new Vector add public synchronized boolean equals Object if this return true if isReference return getCheckedRef equals if instanceof DelegatedResourceComparator return false Vector ov DelegatedResourceComparator return null ov null equals ov public synchronized int hashCode if isReference return getCheckedRef hashCode return null hashCode protected synchronized int resourceCompare Resource foo Resource bar if null isEmpty return foo compareTo bar int result for Iterator iterator result hasNext result ResourceComparator next resourceCompare foo bar return result protected void dieOnCircularReference Stack stk Project throws BuildException if isChecked return if isReference super dieOnCircularReference stk else if null isEmpty for Iterator iterator hasNext Object next if instanceof DataType stk push invokeCircularReferenceCheck DataType stk setChecked true public class DeweyDecimal private int components public DeweyDecimal final int components this components new int components length for int components length this components components public DeweyDecimal final String string throws NumberFormatException final StringTokenizer tokenizer new StringTokenizer string true final int size tokenizer countTokens components new int size for int components length final String component tokenizer nextToken if component equals throw new NumberFormatException components Integer parseInt component if tokenizer hasMoreTokens tokenizer nextToken if tokenizer hasMoreTokens throw new NumberFormatException public int getSize return components length public int get final int index return components index public boolean isEqual final DeweyDecimal other final int max Math max other components length components length for int max final int component1 components length components final int component2 other components length other components if component2 component1 return false public boolean isLessThan final DeweyDecimal other return isGreaterThanOrEqual other public boolean isLessThanOrEqual final DeweyDecimal other return isGreaterThan other public boolean isGreaterThan final DeweyDecimal other final int max Math max other components length components length for int max final int component1 components length components final int component2 other components length other components if component2 component1 return false if component2 component1 return true public boolean isGreaterThanOrEqual final DeweyDecimal other final int max Math max other components length components length for int max final int component1 components length components final int component2 other components length other components if component2 component1 return false if component2 component1 return true public String toString final StringBuffer sb new StringBuffer for int components length if sb append sb append components return sb toString public interface ChainableReader Reader chain Reader rdr public class URLResource extends Resource private static final FileUtils FILE_UTILS FileUtils getFileUtils private static final int NULL_URL Resource getMagicNumber getBytes private URL url private URLConnection conn public URLResource public URLResource URL setURL public URLResource File setFile public URLResource String this newURL public synchronized void setURL URL checkAttributesAllowed url public synchronized void setFile File try setURL FILE_UTILS getFileURL catch MalformedURLException throw new BuildException public synchronized URL getURL if isReference return URLResource getCheckedRef getURL return url public synchronized void setRefid Reference if url null throw tooManyAttributes super setRefid public synchronized String getName return isReference Resource getCheckedRef getName getURL getFile substring public synchronized String toString return isReference getCheckedRef toString String valueOf getURL public synchronized boolean isExists if isReference return Resource getCheckedRef isExists return isExists false private synchronized boolean isExists boolean closeConnection if getURL null return false try connect return true catch IOException return false finally if closeConnection close public synchronized long getLastModified if isReference return Resource getCheckedRef getLastModified if isExists false return return conn getLastModified public synchronized boolean isDirectory return isReference Resource getCheckedRef isDirectory getName endsWith public synchronized long getSize if isReference return Resource getCheckedRef getSize if isExists false return try connect long contentlength conn getContentLength close return contentlength catch IOException return UNKNOWN_SIZE public synchronized boolean equals Object another if this another return true if isReference return getCheckedRef equals another if another getClass equals getClass return false URLResource otheru URLResource another return getURL null otheru getURL null getURL equals otheru getURL public synchronized int hashCode if isReference return getCheckedRef hashCode return MAGIC getURL null NULL_URL getURL hashCode public synchronized InputStream getInputStream throws IOException if isReference return Resource getCheckedRef getInputStream connect try return conn getInputStream finally conn null public synchronized OutputStream getOutputStream throws IOException if isReference return Resource getCheckedRef getOutputStream connect try return conn getOutputStream finally conn null protected synchronized void connect throws IOException URL getURL if null throw new BuildException if conn null try conn openConnection conn connect catch IOException log toString Project MSG_ERR conn null throw private synchronized void close if conn null try if conn instanceof JarURLConnection JarURLConnection juc JarURLConnection conn JarFile jf juc getJarFile jf close jf null else if conn instanceof HttpURLConnection HttpURLConnection conn disconnect catch IOException exc finally conn null private static URL newURL String try return new URL catch MalformedURLException throw new BuildException public class Untar extends Expand private UntarCompressionMethod compression new UntarCompressionMethod public void setCompression UntarCompressionMethod method compression method public void setEncoding String encoding throw new BuildException getTaskName getLocation protected void expandFile FileUtils fileUtils File srcF File dir FileInputStream fis null try fis new FileInputStream srcF expandStream srcF getPath fis dir catch IOException ioe throw new BuildException srcF getPath ioe getLocation finally FileUtils close fis protected void expandResource Resource srcR File dir InputStream null try srcR getInputStream expandStream srcR getName dir catch IOException ioe throw new BuildException srcR getName ioe getLocation finally FileUtils close private void expandStream String name InputStream stream File dir throws IOException TarInputStream tis null try tis new TarInputStream compression decompress name new BufferedInputStream stream log name dir Project MSG_INFO TarEntry te null FileNameMapper mapper getMapper while te tis getNextEntry null extractFile FileUtils getFileUtils null dir tis te getName te getModTime te isDirectory mapper log Project MSG_VERBOSE finally FileUtils close tis public static final class UntarCompressionMethod extends EnumeratedAttribute private static final String NONE private static final String GZIP private static final String BZIP2 public UntarCompressionMethod super setValue NONE public String getValues return new String NONE GZIP BZIP2 public InputStream decompress final String name final InputStream istream throws IOException BuildException final String getValue if GZIP equals return new GZIPInputStream istream else if BZIP2 equals final char magic new char for int magic length if istream read magic throw new BuildException name return new CBZip2InputStream istream return istream public class CommonsLoggingListener implements BuildListener BuildLogger private boolean initialized false private LogFactory logFactory public static final String TARGET_LOG public static final String PROJECT_LOG public CommonsLoggingListener private Log getLog String cat String suffix if suffix null suffix suffix replace suffix suffix replace cat cat suffix PrintStream tmpOut System out PrintStream tmpErr System err System setOut out System setErr err if initialized try logFactory LogFactory getFactory catch LogConfigurationException printStackTrace System err return null initialized true Log log logFactory getInstance cat System setOut tmpOut System setErr tmpErr return log public void buildStarted BuildEvent event String categoryString PROJECT_LOG Log log getLog categoryString null if initialized realLog log Project MSG_INFO null public void buildFinished BuildEvent event if initialized String categoryString PROJECT_LOG Log log getLog categoryString event getProject getName if event getException null realLog log Project MSG_INFO null else realLog log Project MSG_ERR event getException public void targetStarted BuildEvent event if initialized Log log getLog TARGET_LOG event getTarget getName realLog log event getTarget getName Project MSG_VERBOSE null public void targetFinished BuildEvent event if initialized String targetName event getTarget getName Log log getLog TARGET_LOG event getTarget getName if event getException null realLog log targetName Project MSG_DEBUG null else realLog log targetName Project MSG_ERR event getException public void taskStarted BuildEvent event if initialized Task task event getTask Object real task if task instanceof UnknownElement Object realObj UnknownElement task getTask if realObj null real realObj Log log getLog real getClass getName null if log isTraceEnabled realLog log task getTaskName Project MSG_VERBOSE null public void taskFinished BuildEvent event if initialized Task task event getTask Object real task if task instanceof UnknownElement Object realObj UnknownElement task getTask if realObj null real realObj Log log getLog real getClass getName null if event getException null if log isTraceEnabled realLog log task getTaskName Project MSG_VERBOSE null else realLog log task getTaskName Project MSG_ERR event getException public void messageLogged BuildEvent event if initialized Object categoryObject event getTask String categoryString null String categoryDetail null if categoryObject null categoryObject event getTarget if categoryObject null categoryObject event getProject categoryString PROJECT_LOG categoryDetail event getProject getName else categoryString TARGET_LOG categoryDetail event getTarget getName else if event getTarget null categoryString categoryObject getClass getName categoryDetail event getTarget getName else categoryString categoryObject getClass getName Log log getLog categoryString categoryDetail int priority event getPriority String message event getMessage realLog log message priority null private void realLog Log log String message int priority Throwable PrintStream tmpOut System out PrintStream tmpErr System err System setOut out System setErr err switch priority case Project MSG_ERR if null log error message else log error message break case Project MSG_WARN if null log warn message else log warn message break case Project MSG_INFO if null log info message else log info message break case Project MSG_VERBOSE log debug message break case Project MSG_DEBUG log debug message break default log error message break System setOut tmpOut System setErr tmpErr PrintStream out System out PrintStream err System err public void setMessageOutputLevel int level public void setOutputPrintStream PrintStream output this out output public void setEmacsMode boolean emacsMode public void setErrorPrintStream PrintStream err this err err public class ComponentHelper private AntTypeTable antTypeTable private Hashtable taskClassDefinitions new Hashtable private boolean rebuildTaskClassDefinitions true private Hashtable typeClassDefinitions new Hashtable private boolean rebuildTypeClassDefinitions true private Set checkedNamespaces new HashSet private Stack antLibStack new Stack private String antLibCurrentUri null private ComponentHelper next private Project project private static final String ERROR_NO_TASK_LIST_LOAD private static final String ERROR_NO_TYPE_LIST_LOAD public static final String COMPONENT_HELPER_REFERENCE private static final String BUILD_SYSCLASSPATH_ONLY private static final String ANT_PROPERTY_TASK private static Properties defaultDefinitions new Properties public static ComponentHelper getComponentHelper Project project if project null return null ComponentHelper ph ComponentHelper project getReference COMPONENT_HELPER_REFERENCE if ph null return ph ph new ComponentHelper ph setProject project project addReference COMPONENT_HELPER_REFERENCE ph return ph protected ComponentHelper public void setNext ComponentHelper next this next next public ComponentHelper getNext return next public void setProject Project project this project project antTypeTable new AntTypeTable project public void initSubProject ComponentHelper helper AntTypeTable typeTable helper antTypeTable for Iterator typeTable values iterator hasNext AntTypeDefinition def AntTypeDefinition next antTypeTable put def getName def for Iterator helper checkedNamespaces iterator hasNext checkedNamespaces add next public Object createComponent UnknownElement ue String ns String componentType throws BuildException Object component createComponent componentType if component instanceof Task Task task Task component task setLocation ue getLocation task setTaskType componentType task setTaskName ue getTaskName task setOwningTarget ue getOwningTarget task init return component public Object createComponent String componentName AntTypeDefinition def getDefinition componentName return def null null def create project public Class getComponentClass String componentName AntTypeDefinition def getDefinition componentName return def null null def getExposedClass project public AntTypeDefinition getDefinition String componentName checkNamespace componentName return antTypeTable getDefinition componentName public void initDefaultDefinitions initTasks initTypes public void addTaskDefinition String taskName Class taskClass checkTaskClass taskClass AntTypeDefinition def new AntTypeDefinition def setName taskName def setClassLoader taskClass getClassLoader def setClass taskClass def setAdapterClass TaskAdapter class def setClassName taskClass getName def setAdaptToClass Task class updateDataTypeDefinition def public void checkTaskClass final Class taskClass throws BuildException if Modifier isPublic taskClass getModifiers final String message taskClass project log message Project MSG_ERR throw new BuildException message if Modifier isAbstract taskClass getModifiers final String message taskClass project log message Project MSG_ERR throw new BuildException message try taskClass getConstructor Class null catch NoSuchMethodException final String message taskClass project log message Project MSG_ERR throw new BuildException message if Task class isAssignableFrom taskClass TaskAdapter checkTaskClass taskClass project public Hashtable getTaskDefinitions synchronized taskClassDefinitions synchronized antTypeTable if rebuildTaskClassDefinitions taskClassDefinitions clear for Iterator antTypeTable keySet iterator hasNext String name String next Class clazz antTypeTable getExposedClass name if clazz null continue if Task class isAssignableFrom clazz taskClassDefinitions put name antTypeTable getTypeClass name rebuildTaskClassDefinitions false return taskClassDefinitions public Hashtable getDataTypeDefinitions synchronized typeClassDefinitions synchronized antTypeTable if rebuildTypeClassDefinitions typeClassDefinitions clear for Iterator antTypeTable keySet iterator hasNext String name String next Class clazz antTypeTable getExposedClass name if clazz null continue if Task class isAssignableFrom clazz typeClassDefinitions put name antTypeTable getTypeClass name rebuildTypeClassDefinitions false return typeClassDefinitions public void addDataTypeDefinition String typeName Class typeClass AntTypeDefinition def new AntTypeDefinition def setName typeName def setClass typeClass updateDataTypeDefinition def project log typeName typeClass getName Project MSG_DEBUG public void addDataTypeDefinition AntTypeDefinition def updateDataTypeDefinition def public Hashtable getAntTypeTable return antTypeTable public Task createTask String taskType throws BuildException Task task createNewTask taskType if task null taskType equals ANT_PROPERTY_TASK addTaskDefinition ANT_PROPERTY_TASK org apache tools ant taskdefs Property class task createNewTask taskType return task private Task createNewTask String taskType throws BuildException Class getComponentClass taskType if null Task class isAssignableFrom return null Object obj createComponent taskType if obj null return null if obj instanceof Task throw new BuildException taskType obj getClass getName Task task Task obj task setTaskType taskType task setTaskName taskType project log taskType Project MSG_DEBUG return task public Object createDataType String typeName throws BuildException return createComponent typeName public String getElementName Object element return getElementName element false public String getElementName Object boolean brief Class elementClass getClass String elementClassname elementClass getName for Iterator antTypeTable values iterator hasNext AntTypeDefinition def AntTypeDefinition next if elementClassname equals def getClassName elementClass def getExposedClass project String name def getName return brief name name return getUnmappedElementName getClass brief public static String getElementName Project Object boolean brief if null getProject return null getUnmappedElementName getClass brief getComponentHelper getElementName brief private static String getUnmappedElementName Class boolean brief if brief String name getName return name substring name lastIndexOf return toString private static Project getProject Object if instanceof ProjectComponent return ProjectComponent getProject try Method getClass getMethod Class null if Project class getReturnType return Project invoke Object null catch Exception return null private boolean validDefinition AntTypeDefinition def return def getTypeClass project null def getExposedClass project null private boolean sameDefinition AntTypeDefinition def AntTypeDefinition old boolean defValid validDefinition def boolean sameValidity defValid validDefinition old return sameValidity defValid def sameDefinition old project private void updateDataTypeDefinition AntTypeDefinition def String name def getName synchronized antTypeTable rebuildTaskClassDefinitions true rebuildTypeClassDefinitions true AntTypeDefinition old antTypeTable getDefinition name if old null if sameDefinition def old return Class oldClass antTypeTable getExposedClass name boolean isTask oldClass null Task class isAssignableFrom oldClass project log isTask name def similarDefinition old project Project MSG_VERBOSE Project MSG_WARN project log name def getClassName Project MSG_DEBUG antTypeTable put name def public void enterAntLib String uri antLibCurrentUri uri antLibStack push uri public String getCurrentAntlibUri return antLibCurrentUri public void exitAntLib antLibStack pop antLibCurrentUri antLibStack size null String antLibStack peek private void initTasks ClassLoader classLoader getClassLoader null Properties props getDefaultDefinitions false Enumeration props propertyNames while hasMoreElements String name String nextElement String className props getProperty name AntTypeDefinition def new AntTypeDefinition def setName name def setClassName className def setClassLoader classLoader def setAdaptToClass Task class def setAdapterClass TaskAdapter class antTypeTable put name def private ClassLoader getClassLoader ClassLoader classLoader String buildSysclasspath project getProperty MagicNames BUILD_SYSCLASSPATH if project getCoreLoader null BUILD_SYSCLASSPATH_ONLY equals buildSysclasspath classLoader project getCoreLoader return classLoader private static synchronized Properties getDefaultDefinitions boolean type throws BuildException int idx type if defaultDefinitions idx null String resource type MagicNames TYPEDEFS_PROPERTIES_RESOURCE MagicNames TASKDEF_PROPERTIES_RESOURCE String errorString type ERROR_NO_TYPE_LIST_LOAD ERROR_NO_TASK_LIST_LOAD InputStream in null try in ComponentHelper class getResourceAsStream resource if in null throw new BuildException errorString Properties new Properties load in defaultDefinitions idx catch IOException throw new BuildException errorString finally FileUtils close in return defaultDefinitions idx private void initTypes ClassLoader classLoader getClassLoader null Properties props getDefaultDefinitions true Enumeration props propertyNames while hasMoreElements String name String nextElement String className props getProperty name AntTypeDefinition def new AntTypeDefinition def setName name def setClassName className def setClassLoader classLoader antTypeTable put name def private synchronized void checkNamespace String componentName String uri ProjectHelper extractUriFromComponentName componentName if equals uri uri ProjectHelper ANT_CORE_URI if uri startsWith ProjectHelper ANTLIB_URI if checkedNamespaces contains uri checkedNamespaces add uri Typedef definer new Typedef definer setProject project definer init definer setURI uri definer setTaskName uri definer setResource Definer makeResourceFromURI uri definer setOnError new Typedef OnError Typedef OnError POLICY_IGNORE definer execute public String diagnoseCreationFailure String componentName String type StringWriter errorText new StringWriter PrintWriter out new PrintWriter errorText out println type componentName boolean lowlevel false boolean jars false boolean definitions false boolean antTask String home System getProperty Launcher USER_HOMEDIR File libDir new File home Launcher USER_LIBDIR String antHomeLib boolean probablyIDE false String anthome System getProperty MagicNames ANT_HOME if anthome null File antHomeLibDir new File anthome antHomeLib antHomeLibDir getAbsolutePath else probablyIDE true antHomeLib File separatorChar StringBuffer dirListingText new StringBuffer final String tab dirListingText append tab dirListingText append antHomeLib dirListingText append if probablyIDE dirListingText append tab dirListingText append else dirListingText append tab dirListingText append libDir dirListingText append dirListingText append tab dirListingText append String dirListing dirListingText toString AntTypeDefinition def getDefinition componentName if def null boolean isAntlib componentName indexOf MagicNames ANTLIB_PREFIX out println out println out println out println if isAntlib out println out println out println out println dirListing definitions true else final String classname def getClassName antTask classname startsWith boolean optional classname startsWith optional classname startsWith Class clazz null try clazz def innerGetTypeClass catch ClassNotFoundException out println classname jars true if optional out println out println out println dirListing else out println out println out println dirListing definitions true catch NoClassDefFoundError ncdfe jars true out println ncdfe getMessage if optional out println out println out println else out println out println out println dirListing if clazz null try def innerCreateAndSet clazz project out println catch NoSuchMethodException lowlevel true out println classname catch InstantiationException lowlevel true out println classname catch IllegalAccessException lowlevel true out println classname catch InvocationTargetException ex lowlevel true Throwable ex getTargetException out println out println toString printStackTrace out catch NoClassDefFoundError ncdfe jars true out println classname out println ncdfe getMessage out println out println dirListing out println out println if definitions out println if jars out println if lowlevel out println if antTask out println else out println out println type out println else out println out println out flush out close return errorText toString private static class AntTypeTable extends Hashtable private Project project AntTypeTable Project project this project project AntTypeDefinition getDefinition String key return AntTypeDefinition super get key public Object get Object key return getTypeClass String key Object create String name AntTypeDefinition def getDefinition name return def null null def create project Class getTypeClass String name AntTypeDefinition def getDefinition name return def null null def getTypeClass project Class getExposedClass String name AntTypeDefinition def getDefinition name return def null null def getExposedClass project public boolean contains Object clazz boolean found false if clazz instanceof Class for Iterator values iterator hasNext found found AntTypeDefinition next getExposedClass project clazz return found public boolean containsValue Object value return contains value public class RuntimeConfigurable implements Serializable private static final Hashtable EMPTY_HASHTABLE new Hashtable private String elementTag null private transient Object wrappedObject null private transient IntrospectionHelper Creator creator private transient AttributeList attributes private StringBuffer characters null private boolean proxyConfigured false private String polyType null private String id null public RuntimeConfigurable Object proxy String elementTag setProxy proxy setElementTag elementTag if proxy instanceof Task Task proxy setRuntimeConfigurableWrapper this public synchronized void setProxy Object proxy wrappedObject proxy proxyConfigured false synchronized void setCreator IntrospectionHelper Creator creator this creator creator public synchronized Object getProxy return wrappedObject public synchronized String getId return id public synchronized String getPolyType return polyType public synchronized void setPolyType String polyType this polyType polyType public synchronized void setAttributes AttributeList attributes this attributes new AttributeListImpl attributes for int attributes getLength setAttribute attributes getName attributes getValue public synchronized void setAttribute String name String value if name equalsIgnoreCase ProjectHelper ANT_TYPE this polyType value else if attributeNames null attributeNames new ArrayList attributeMap new HashMap if name toLowerCase Locale US equals attributeNames add name else attributeNames add name attributeMap put name value if name equals this id value public synchronized void removeAttribute String name attributeNames remove name attributeMap remove name public synchronized Hashtable getAttributeMap return attributeMap null EMPTY_HASHTABLE new Hashtable attributeMap public synchronized AttributeList getAttributes return attributes public synchronized void addChild RuntimeConfigurable child children children null new ArrayList children children add child synchronized RuntimeConfigurable getChild int index return RuntimeConfigurable children get index public synchronized Enumeration getChildren return children null new CollectionUtils EmptyEnumeration Collections enumeration children public synchronized void addText String data if data length return characters characters null new StringBuffer data characters append data public synchronized void addText char buf int start int count if count return characters characters null new StringBuffer count characters append buf start count public synchronized StringBuffer getText return characters null new StringBuffer characters public synchronized void setElementTag String elementTag this elementTag elementTag public synchronized String getElementTag return elementTag public void maybeConfigure Project throws BuildException maybeConfigure true public synchronized void maybeConfigure Project boolean configureChildren throws BuildException if proxyConfigured return Object target wrappedObject instanceof TypeAdapter TypeAdapter wrappedObject getProxy wrappedObject IntrospectionHelper ih IntrospectionHelper getHelper target getClass if attributeNames null for int attributeNames size String name String attributeNames get String value String attributeMap get name value replaceProperties value try ih setAttribute target name value catch UnsupportedAttributeException be if name equals else if getElementTag null throw be else throw new BuildException getElementTag be getAttribute be catch BuildException be if name equals else throw be if characters null ProjectHelper addText wrappedObject characters substring if id null addReference id wrappedObject proxyConfigured true public void reconfigure Project proxyConfigured false maybeConfigure public void applyPreSet RuntimeConfigurable if attributeMap null for Iterator attributeMap keySet iterator hasNext String name String next if attributeMap null attributeMap get name null setAttribute name String attributeMap get name polyType polyType null polyType polyType if children null List newChildren new ArrayList newChildren addAll children if children null newChildren addAll children children newChildren if characters null if characters null characters toString trim length characters new StringBuffer characters toString public class SmtpResponseReader protected BufferedReader reader null private StringBuffer result new StringBuffer public SmtpResponseReader InputStream in reader new BufferedReader new InputStreamReader in public String getResponse throws IOException result setLength String line reader readLine if line null line length result append line substring result append while line null append line if hasMoreLines line break line reader readLine return result toString trim public void close throws IOException reader close protected boolean hasMoreLines String line return line length line charAt private void append String line if line length result append line substring result append public class VerifyJar extends AbstractJarSignerTask public static final String ERROR_NO_FILE private static final String VERIFIED_TEXT private boolean certificates false private BufferingOutputFilter outputCache new BufferingOutputFilter public static final String ERROR_NO_VERIFY public void setCertificates boolean certificates this certificates certificates public void execute throws BuildException final boolean hasJar jar null if hasJar hasResources throw new BuildException ERROR_NO_SOURCE beginExecution RedirectorElement redirector getRedirector redirector setAlwaysLog true FilterChain outputFilterChain redirector createOutputFilterChain outputFilterChain add outputCache try Path sources createUnifiedSourcePath Iterator iter sources iterator while iter hasNext FileResource fr FileResource iter next verifyOneJar fr getFile finally endExecution private void verifyOneJar File jar if jar exists throw new BuildException ERROR_NO_FILE jar final ExecTask cmd createJarSigner setCommonOptions cmd bindToKeystore cmd addValue cmd if certificates addValue cmd addValue cmd jar getPath log jar getAbsolutePath outputCache clear BuildException ex null try cmd execute catch BuildException ex String results outputCache toString if ex null if results indexOf log JARSIGNER_COMMAND Project MSG_WARN else throw ex if results indexOf VERIFIED_TEXT throw new BuildException ERROR_NO_VERIFY jar private static class BufferingOutputFilter implements ChainableReader private BufferingOutputFilterReader buffer public Reader chain Reader rdr buffer new BufferingOutputFilterReader rdr return buffer public String toString return buffer toString public void clear if buffer null buffer clear private static class BufferingOutputFilterReader extends Reader private Reader next private StringBuffer buffer new StringBuffer public BufferingOutputFilterReader Reader next this next next public int read char cbuf int off int len throws IOException int result next read cbuf off len buffer append cbuf off len return result public void close throws IOException next close public String toString return buffer toString public void clear buffer new StringBuffer public class ScpToMessage extends AbstractSshMessage private static final int BUFFER_SIZE private File localFile private String remotePath private List directoryList public ScpToMessage Session session super session public ScpToMessage boolean verbose Session session super verbose session public ScpToMessage boolean verbose Session session File aLocalFile String aRemotePath this verbose session aRemotePath this localFile aLocalFile public ScpToMessage boolean verbose Session session List aDirectoryList String aRemotePath this verbose session aRemotePath this directoryList aDirectoryList private ScpToMessage boolean verbose Session session String aRemotePath super verbose session this remotePath aRemotePath public ScpToMessage Session session File aLocalFile String aRemotePath this false session aLocalFile aRemotePath public ScpToMessage Session session List aDirectoryList String aRemotePath this false session aDirectoryList aRemotePath public void execute throws IOException JSchException if directoryList null doMultipleTransfer if localFile null doSingleTransfer log private void doSingleTransfer throws IOException JSchException String cmd remotePath Channel channel openExecChannel cmd try OutputStream out channel getOutputStream InputStream in channel getInputStream channel connect waitForAck in sendFileToRemote localFile in out finally if channel null channel disconnect private void doMultipleTransfer throws IOException JSchException Channel channel openExecChannel remotePath try OutputStream out channel getOutputStream InputStream in channel getInputStream channel connect waitForAck in for Iterator directoryList iterator hasNext Directory current Directory next sendDirectory current in out finally if channel null channel disconnect private void sendDirectory Directory current InputStream in OutputStream out throws IOException for Iterator fileIt current filesIterator fileIt hasNext sendFileToRemote File fileIt next in out for Iterator dirIt current directoryIterator dirIt hasNext Directory dir Directory dirIt next sendDirectoryToRemote dir in out private void sendDirectoryToRemote Directory directory InputStream in OutputStream out throws IOException String command command directory getDirectory getName command out write command getBytes out flush waitForAck in sendDirectory directory in out out write getBytes waitForAck in private void sendFileToRemote File localFile InputStream in OutputStream out throws IOException long filesize localFile length String command filesize command localFile getName command out write command getBytes out flush waitForAck in FileInputStream fis new FileInputStream localFile byte buf new byte BUFFER_SIZE long startTime System currentTimeMillis long totalLength boolean trackProgress getVerbose filesize long initFilesize filesize int percentTransmitted try if this getVerbose log localFile getName localFile length while true int len fis read buf buf length if len break out write buf len totalLength len if trackProgress percentTransmitted trackProgress initFilesize totalLength percentTransmitted out flush sendAck out waitForAck in finally if this getVerbose long endTime System currentTimeMillis logStats startTime endTime totalLength fis close public File getLocalFile return localFile public String getRemotePath return remotePath public class Symlink extends DispatchTask private static final FileUtils FILE_UTILS FileUtils getFileUtils private String resource private String link private Vector fileSets new Vector private String linkFileName private boolean overwrite private boolean failonerror private boolean executing false public void init throws BuildException super init setDefaults public synchronized void execute throws BuildException if executing throw new BuildException try executing true DispatchUtils execute this finally executing false public void single throws BuildException try if resource null handleError return if link null handleError return doLink resource link finally setDefaults public void delete throws BuildException try if link null handleError return log link deleteSymlink link catch FileNotFoundException fnfe handleError fnfe toString catch IOException ioe handleError ioe toString finally setDefaults public void recreate throws BuildException try if fileSets isEmpty handleError return Properties links loadLinks fileSets for Iterator kitr links keySet iterator kitr hasNext String lnk String kitr next String res links getProperty lnk try File test new File lnk if FILE_UTILS isSymbolicLink null lnk doLink res lnk else if test getCanonicalPath equals new File res getCanonicalPath deleteSymlink lnk doLink res lnk catch IOException ioe handleError finally setDefaults public void record throws BuildException try if fileSets isEmpty handleError return if linkFileName null handleError return Hashtable byDir new Hashtable for Iterator litr findLinks fileSets iterator litr hasNext File thisLink File litr next File parent thisLink getParentFile Vector Vector byDir get parent if null new Vector byDir put parent addElement thisLink for Iterator dirs byDir keySet iterator dirs hasNext File dir File dirs next Vector linksInDir Vector byDir get dir Properties linksToStore new Properties for Iterator dlnk linksInDir iterator dlnk hasNext File lnk File dlnk next try linksToStore put lnk getName lnk getCanonicalPath catch IOException ioe handleError writePropertyFile linksToStore dir finally setDefaults private void setDefaults resource null link null linkFileName null fileSets clear public void setOverwrite boolean owrite this overwrite owrite public void setFailOnError boolean foe this failonerror foe public void setAction String action super setAction action public void setLink String lnk this link lnk public void setResource String src this resource src public void setLinkfilename String lf this linkFileName lf public void addFileset FileSet set fileSets addElement set public static void deleteSymlink String path throws IOException FileNotFoundException deleteSymlink new File path public static void deleteSymlink File linkfil throws IOException FileNotFoundException if linkfil exists throw new FileNotFoundException linkfil File canfil linkfil getCanonicalFile File temp FILE_UTILS createTempFile canfil getParentFile try try FILE_UTILS rename canfil temp catch IOException throw new IOException linkfil if linkfil delete throw new IOException linkfil finally try FILE_UTILS rename temp canfil catch IOException throw new IOException temp canfil getAbsolutePath private void writePropertyFile Properties properties File dir throws BuildException BufferedOutputStream bos null try bos new BufferedOutputStream new FileOutputStream new File dir linkFileName properties store bos dir catch IOException ioe throw new BuildException ioe getLocation finally FileUtils close bos private void handleError String msg if failonerror throw new BuildException msg log msg private void doLink String res String lnk throws BuildException File linkfil new File lnk if overwrite linkfil exists try deleteSymlink linkfil catch FileNotFoundException fnfe handleError lnk catch IOException ioe handleError lnk String cmd new String res lnk log Commandline toString cmd Execute runCommand this cmd private HashSet findLinks Vector HashSet result new HashSet for int size FileSet fs FileSet get DirectoryScanner ds fs getDirectoryScanner getProject String fnd new String ds getIncludedFiles ds getIncludedDirectories File dir fs getDir getProject for int fnd length for int fnd length try File new File dir fnd File pf getParentFile String name getName if FILE_UTILS isSymbolicLink pf name result add new File pf getCanonicalFile name catch IOException handleError fnd return result private Properties loadLinks Vector Properties finalList new Properties for int size FileSet fs FileSet elementAt DirectoryScanner ds new DirectoryScanner fs setupDirectoryScanner ds getProject ds setFollowSymlinks false ds scan String incs ds getIncludedFiles File dir fs getDir getProject for int incs length File inc new File dir incs File pf inc getParentFile Properties lnks new Properties try lnks load new BufferedInputStream new FileInputStream inc pf pf getCanonicalFile catch FileNotFoundException fnfe handleError incs continue catch IOException ioe handleError incs continue lnks list new PrintStream new LogOutputStream this Project MSG_INFO for Iterator kitr lnks keySet iterator kitr hasNext String key String kitr next finalList put new File pf key getAbsolutePath lnks getProperty key return finalList public class ProjectHelper public static final String ANT_CORE_URI public static final String ANT_CURRENT_URI public static final String ANTLIB_URI public static final String ANT_TYPE public static final String HELPER_PROPERTY public static final String SERVICE_ID public static final String PROJECTHELPER_REFERENCE public static void configureProject Project project File buildFile throws BuildException ProjectHelper helper ProjectHelper getProjectHelper project addReference PROJECTHELPER_REFERENCE helper helper parse project buildFile public ProjectHelper public Vector getImportStack public void parse Project project Object source throws BuildException throw new BuildException this getClass getName public static ProjectHelper getProjectHelper throws BuildException ProjectHelper helper null String helperClass System getProperty HELPER_PROPERTY try if helperClass null helper newHelper helperClass catch SecurityException System out println helperClass HELPER_PROPERTY if helper null try ClassLoader classLoader LoaderUtils getContextClassLoader InputStream is null if classLoader null is classLoader getResourceAsStream SERVICE_ID if is null is ClassLoader getSystemResourceAsStream SERVICE_ID if is null InputStreamReader isr try isr new InputStreamReader is catch java io UnsupportedEncodingException isr new InputStreamReader is BufferedReader rd new BufferedReader isr String helperClassName rd readLine rd close if helperClassName null equals helperClassName helper newHelper helperClassName catch Exception ex System out println SERVICE_ID if helper null return helper else return new ProjectHelper2 private static ProjectHelper newHelper String helperClass throws BuildException ClassLoader classLoader LoaderUtils getContextClassLoader try Class clazz null if classLoader null try clazz classLoader loadClass helperClass catch ClassNotFoundException ex if clazz null clazz Class forName helperClass return ProjectHelper clazz newInstance catch Exception throw new BuildException public static ClassLoader getContextClassLoader if LoaderUtils isContextLoaderAvailable return null return LoaderUtils getContextClassLoader public static void configure Object target AttributeList attrs Project project throws BuildException if target instanceof TypeAdapter target TypeAdapter target getProxy IntrospectionHelper ih IntrospectionHelper getHelper project target getClass for int attrs getLength String value replaceProperties project attrs getValue project getProperties try ih setAttribute project target attrs getName toLowerCase Locale US value catch BuildException be if attrs getName equals throw be public static void addText Project project Object target char buf int start int count throws BuildException addText project target new String buf start count public static void addText Project project Object target String text throws BuildException if text null return if target instanceof TypeAdapter target TypeAdapter target getProxy IntrospectionHelper getHelper project target getClass addText project target text public static void storeChild Project project Object parent Object child String tag IntrospectionHelper ih IntrospectionHelper getHelper project parent getClass ih storeElement project parent child tag public static String replaceProperties Project project String value throws BuildException return project replaceProperties value public static String replaceProperties Project project String value Hashtable keys throws BuildException PropertyHelper ph PropertyHelper getPropertyHelper project return ph replaceProperties null value keys public static void parsePropertyString String value Vector fragments Vector propertyRefs throws BuildException PropertyHelper parsePropertyStringDefault value fragments propertyRefs public static String genComponentName String uri String name if uri null uri equals uri equals ANT_CORE_URI return name return uri name public static String extractUriFromComponentName String componentName if componentName null return int index componentName lastIndexOf if index return return componentName substring index public static String extractNameFromComponentName String componentName int index componentName lastIndexOf if index return componentName return componentName substring index public static BuildException addLocationToBuildException BuildException ex Location newLocation if ex getLocation null ex getMessage null return ex String errorMessage System getProperty ex getLocation toString ex getMessage if newLocation null return new BuildException errorMessage ex else return new BuildException errorMessage ex newLocation public class Log4jListener implements BuildListener private boolean initialized false public static final String LOG_ANT public Log4jListener initialized false Logger log Logger getLogger LOG_ANT Logger rootLog Logger getRootLogger if rootLog getAllAppenders instanceof NullEnumeration initialized true else log error public void buildStarted BuildEvent event if initialized Logger log Logger getLogger Project class getName log info public void buildFinished BuildEvent event if initialized Logger log Logger getLogger Project class getName if event getException null log info else log error event getException public void targetStarted BuildEvent event if initialized Logger log Logger getLogger Target class getName log info event getTarget getName public void targetFinished BuildEvent event if initialized String targetName event getTarget getName Logger cat Logger getLogger Target class getName if event getException null cat info targetName else cat error targetName event getException public void taskStarted BuildEvent event if initialized Task task event getTask Logger log Logger getLogger task getClass getName log info task getTaskName public void taskFinished BuildEvent event if initialized Task task event getTask Logger log Logger getLogger task getClass getName if event getException null log info task getTaskName else log error task getTaskName event getException public void messageLogged BuildEvent event if initialized Object categoryObject event getTask if categoryObject null categoryObject event getTarget if categoryObject null categoryObject event getProject Logger log Logger getLogger categoryObject getClass getName switch event getPriority case Project MSG_ERR log error event getMessage break case Project MSG_WARN log warn event getMessage break case Project MSG_INFO log info event getMessage break case Project MSG_VERBOSE log debug event getMessage break case Project MSG_DEBUG log debug event getMessage break default log error event getMessage break public final class FixCrLfFilter extends BaseParamFilterReader implements ChainableReader private static final char CTRLZ private int tabLength private CrLf eol private AddAsisRemove ctrlz private AddAsisRemove tabs private boolean javafiles false private boolean fixlast true private boolean initialized false public FixCrLfFilter super public FixCrLfFilter final Reader in throws IOException super in tabs AddAsisRemove ASIS if Os isFamily Os isFamily ctrlz AddAsisRemove REMOVE setEol CrLf MAC else if Os isFamily ctrlz AddAsisRemove ASIS setEol CrLf DOS else ctrlz AddAsisRemove REMOVE setEol CrLf UNIX public Reader chain final Reader rdr try FixCrLfFilter newFilter new FixCrLfFilter rdr newFilter setJavafiles getJavafiles newFilter setEol getEol newFilter setTab getTab newFilter setTablength getTablength newFilter setEof getEof newFilter setFixlast getFixlast newFilter initInternalFilters return newFilter catch IOException throw new BuildException public AddAsisRemove getEof return ctrlz newInstance public CrLf getEol return eol newInstance public boolean getFixlast return fixlast public boolean getJavafiles return javafiles public AddAsisRemove getTab return tabs newInstance public int getTablength return tabLength private static String calculateEolString CrLf eol if eol CrLf ASIS return System getProperty if eol CrLf CR eol CrLf MAC return if eol CrLf CRLF eol CrLf DOS return return private void initInternalFilters in ctrlz AddAsisRemove REMOVE new RemoveEofFilter in in in new NormalizeEolFilter in calculateEolString eol getFixlast if tabs AddAsisRemove ASIS if getJavafiles in new MaskJavaTabLiteralsFilter in in tabs AddAsisRemove ADD Reader new AddTabFilter in getTablength Reader new RemoveTabFilter in getTablength in ctrlz AddAsisRemove ADD new AddEofFilter in in initialized true public synchronized int read throws IOException if initialized initInternalFilters return in read public void setEof AddAsisRemove attr ctrlz attr resolve public void setEol CrLf attr eol attr resolve public void setFixlast boolean fixlast this fixlast fixlast public void setJavafiles boolean javafiles this javafiles javafiles public void setTab AddAsisRemove attr tabs attr resolve public void setTablength int tabLength throws IOException if tabLength tabLength throw new IOException this tabLength tabLength private static class SimpleFilterReader extends Reader private Reader in private int preempt new int private int preemptIndex public SimpleFilterReader Reader in this in in public void push char push int public void push int try preempt preemptIndex catch ArrayIndexOutOfBoundsException int p2 new int preempt length System arraycopy preempt p2 preempt length preempt p2 push public void push char cs int start int length for int start length start push cs public void push char cs push cs cs length public void push String push toCharArray public boolean editsBlocked return in instanceof SimpleFilterReader SimpleFilterReader in editsBlocked public int read throws java io IOException return preemptIndex preempt preemptIndex in read public void close throws java io IOException in close public void reset throws IOException in reset public boolean markSupported return in markSupported public boolean ready throws java io IOException return in ready public void mark int throws java io IOException in mark public long skip long throws java io IOException return in skip public int read char buf throws java io IOException return read buf buf length public int read char buf int start int length throws java io IOException int count int while length this read buf start char count return count count private static class MaskJavaTabLiteralsFilter extends SimpleFilterReader private boolean editsBlocked false private static final int JAVA private static final int IN_CHAR_CONST private static final int IN_STR_CONST private static final int IN_SINGLE_COMMENT private static final int IN_MULTI_COMMENT private static final int TRANS_TO_COMMENT private static final int TRANS_FROM_MULTI private int state public MaskJavaTabLiteralsFilter Reader in super in state JAVA public boolean editsBlocked return editsBlocked super editsBlocked public int read throws IOException int thisChar super read editsBlocked state IN_CHAR_CONST state IN_STR_CONST switch state case JAVA switch thisChar case state IN_CHAR_CONST break case state IN_STR_CONST break case state TRANS_TO_COMMENT break default break case IN_CHAR_CONST switch thisChar case state JAVA break default break case IN_STR_CONST switch thisChar case state JAVA break default break case IN_SINGLE_COMMENT switch thisChar case state JAVA break default break case IN_MULTI_COMMENT switch thisChar case state TRANS_FROM_MULTI break default break case TRANS_TO_COMMENT switch thisChar case state IN_MULTI_COMMENT break case state IN_SINGLE_COMMENT break case state IN_CHAR_CONST break case state IN_STR_CONST break default state JAVA break case TRANS_FROM_MULTI switch thisChar case state JAVA break default break default return thisChar private static class NormalizeEolFilter extends SimpleFilterReader private boolean previousWasEOL private boolean fixLast private int normalizedEOL private char eol null public NormalizeEolFilter Reader in String eolString boolean fixLast super in eol eolString toCharArray this fixLast fixLast public int read throws IOException int thisChar super read if normalizedEOL int numEOL boolean atEnd false switch thisChar case CTRLZ int super read if atEnd true if fixLast previousWasEOL numEOL push thisChar else push break case atEnd true if fixLast previousWasEOL numEOL break case numEOL break case numEOL int c1 super read int c2 super read if c1 c2 else if c1 numEOL push c2 else if c1 push c2 else push c2 push c1 default if numEOL while numEOL push eol normalizedEOL eol length previousWasEOL true thisChar read else if atEnd previousWasEOL false else normalizedEOL return thisChar private static class AddEofFilter extends SimpleFilterReader private int lastChar public AddEofFilter Reader in super in public int read throws IOException int thisChar super read if thisChar if lastChar CTRLZ lastChar CTRLZ return lastChar else lastChar thisChar return thisChar private static class RemoveEofFilter extends SimpleFilterReader private int lookAhead public RemoveEofFilter Reader in super in try lookAhead in read catch IOException lookAhead public int read throws IOException int lookAhead2 super read if lookAhead2 lookAhead CTRLZ return int lookAhead lookAhead lookAhead2 return private static class AddTabFilter extends SimpleFilterReader private int columnNumber private int tabLength public AddTabFilter Reader in int tabLength super in this tabLength tabLength public int read throws IOException int super read switch case case columnNumber break case columnNumber if editsBlocked int colNextTab columnNumber tabLength tabLength tabLength int countSpaces int numTabs scanWhitespace while super read switch case if columnNumber colNextTab numTabs countSpaces colNextTab tabLength else countSpaces break case columnNumber colNextTab numTabs countSpaces colNextTab tabLength break default push break scanWhitespace while countSpaces push columnNumber while numTabs push columnNumber tabLength super read switch case columnNumber break case columnNumber tabLength break default break case columnNumber columnNumber tabLength tabLength tabLength break default columnNumber return private static class RemoveTabFilter extends SimpleFilterReader private int columnNumber private int tabLength public RemoveTabFilter Reader in int tabLength super in this tabLength tabLength public int read throws IOException int super read switch case case columnNumber break case int width tabLength columnNumber tabLength if editsBlocked for width width push columnNumber width break default columnNumber return public static class AddAsisRemove extends EnumeratedAttribute private static final AddAsisRemove ASIS newInstance private static final AddAsisRemove ADD newInstance private static final AddAsisRemove REMOVE newInstance public String getValues return new String public boolean equals Object other return other instanceof AddAsisRemove getIndex AddAsisRemove other getIndex public int hashCode return getIndex AddAsisRemove resolve throws IllegalStateException if this equals ASIS return ASIS if this equals ADD return ADD if this equals REMOVE return REMOVE throw new IllegalStateException this private AddAsisRemove newInstance return newInstance getValue public static AddAsisRemove newInstance String value AddAsisRemove new AddAsisRemove setValue value return public static class CrLf extends EnumeratedAttribute private static final CrLf ASIS newInstance private static final CrLf CR newInstance private static final CrLf CRLF newInstance private static final CrLf DOS newInstance private static final CrLf LF newInstance private static final CrLf MAC newInstance private static final CrLf UNIX newInstance public String getValues return new String public boolean equals Object other return other instanceof CrLf getIndex CrLf other getIndex public int hashCode return getIndex CrLf resolve if this equals ASIS return ASIS if this equals CR this equals MAC return CR if this equals CRLF this equals DOS return CRLF if this equals LF this equals UNIX return LF throw new IllegalStateException this private CrLf newInstance return newInstance getValue public static CrLf newInstance String value CrLf new CrLf setValue value return public abstract class AbstractJarSignerTask extends Task protected File jar protected String alias protected String keystore protected String storepass protected String storetype protected String keypass protected boolean verbose protected String maxMemory protected Vector filesets new Vector protected static final String JARSIGNER_COMMAND private RedirectorElement redirector private Environment sysProperties new Environment public static final String ERROR_NO_SOURCE private Path path null public void setMaxmemory String max maxMemory max public void setJar final File jar this jar jar public void setAlias final String alias this alias alias public void setKeystore final String keystore this keystore keystore public void setStorepass final String storepass this storepass storepass public void setStoretype final String storetype this storetype storetype public void setKeypass final String keypass this keypass keypass public void setVerbose final boolean verbose this verbose verbose public void addFileset final FileSet set filesets addElement set public void addSysproperty Environment Variable sysp sysProperties addVariable sysp public Path createPath if path null path new Path getProject return path createPath protected void beginExecution redirector createRedirector protected void endExecution redirector null private RedirectorElement createRedirector RedirectorElement result new RedirectorElement if storepass null StringBuffer input new StringBuffer storepass append if keypass null input append keypass append result setInputString input toString result setLogInputString false return result public RedirectorElement getRedirector return redirector protected void setCommonOptions final ExecTask cmd if maxMemory null addValue cmd maxMemory if verbose addValue cmd Vector props sysProperties getVariablesVector Enumeration props elements while hasMoreElements Environment Variable variable Environment Variable nextElement declareSysProperty cmd variable protected void declareSysProperty ExecTask cmd Environment Variable property throws BuildException addValue cmd property getContent protected void bindToKeystore final ExecTask cmd if null keystore addValue cmd String loc File keystoreFile getProject resolveFile keystore if keystoreFile exists loc keystoreFile getPath else loc keystore addValue cmd loc if null storetype addValue cmd addValue cmd storetype protected ExecTask createJarSigner final ExecTask cmd new ExecTask this cmd setExecutable JavaEnvUtils getJdkExecutable JARSIGNER_COMMAND cmd setTaskType JARSIGNER_COMMAND cmd setFailonerror true cmd addConfiguredRedirector redirector return cmd protected Vector createUnifiedSources Vector sources Vector filesets clone if jar null FileSet sourceJar new FileSet sourceJar setProject getProject sourceJar setFile jar sourceJar setDir jar getParentFile sources add sourceJar return sources protected Path createUnifiedSourcePath Path path null new Path getProject Path path clone Vector createUnifiedSources Enumeration elements while hasMoreElements add FileSet nextElement return protected boolean hasResources return path null filesets size protected void addValue final ExecTask cmd String value cmd createArg setValue value public class JbossDeploymentTool extends GenericDeploymentTool protected static final String JBOSS_DD protected static final String JBOSS_CMP10D protected static final String JBOSS_CMP20D private String jarSuffix public void setSuffix String inString jarSuffix inString protected void addVendorFiles Hashtable ejbFiles String ddPrefix File jbossDD new File getConfig descriptorDir ddPrefix JBOSS_DD if jbossDD exists ejbFiles put META_DIR JBOSS_DD jbossDD else log jbossDD getPath Project MSG_WARN return String descriptorFileName JBOSS_CMP10D if EjbJar CMPVersion CMP2_0 equals getParent getCmpversion descriptorFileName JBOSS_CMP20D File jbossCMPD new File getConfig descriptorDir ddPrefix descriptorFileName if jbossCMPD exists ejbFiles put META_DIR descriptorFileName jbossCMPD else log jbossCMPD getPath Project MSG_VERBOSE return File getVendorOutputJarFile String baseName if getDestDir null getParent getDestdir null throw new BuildException if getDestDir null return new File getParent getDestdir baseName jarSuffix else return new File getDestDir baseName jarSuffix public void validateConfigured throws BuildException private EjbJar getParent return EjbJar this getTask public class ManifestClassPath extends Task private String name private File dir private int maxParentLevels private Path path public void execute if name null throw new BuildException if dir null throw new BuildException if getProject getProperty name null throw new BuildException name if path null throw new BuildException final FileUtils fileUtils FileUtils getFileUtils dir fileUtils normalize dir getAbsolutePath File currDir dir String dirs new String maxParentLevels for int maxParentLevels dirs currDir getAbsolutePath File separatorChar currDir currDir getParentFile if currDir null maxParentLevels break String elements path list StringBuffer buffer new StringBuffer StringBuffer element new StringBuffer for int elements length File pathEntry new File elements pathEntry fileUtils normalize pathEntry getAbsolutePath String fullPath pathEntry getAbsolutePath String relPath null for int maxParentLevels String dir dirs if fullPath startsWith dir continue element setLength for int element append element append File separatorChar element append fullPath substring dir length relPath element toString break if relPath null throw new BuildException dir fullPath if File separatorChar relPath relPath replace File separatorChar if pathEntry isDirectory relPath relPath try relPath Locator encodeURI relPath catch UnsupportedEncodingException exc throw new BuildException exc buffer append relPath buffer append getProject setNewProperty name buffer toString trim public void setProperty String name this name name public void setJarFile File jarfile File parent jarfile getParentFile if parent isDirectory throw new BuildException parent this dir parent public void setMaxParentLevels int levels this maxParentLevels levels public void addClassPath Path path this path path public class P4Reopen extends P4Base private String toChange public void setToChange String toChange throws BuildException if toChange null toChange equals throw new BuildException this toChange toChange public void execute throws BuildException if P4View null throw new BuildException execP4Command toChange P4View new SimpleP4OutputHandler this public class Javadoc extends Task public class DocletParam private String name private String value public void setName String name this name name public String getName return name public void setValue String value this value value public String getValue return value public static class ExtensionInfo extends ProjectComponent private String name private Path path public void setName String name this name name public String getName return name public void setPath Path path if this path null this path path else this path append path public Path getPath return path public Path createPath if path null path new Path getProject return path createPath public void setPathRef Reference createPath setRefid public class DocletInfo extends ExtensionInfo private Vector params new Vector public DocletParam createParam DocletParam param new DocletParam params addElement param return param public Enumeration getParams return params elements public static class PackageName private String name public void setName String name this name name trim public String getName return name public String toString return getName public static class SourceFile private File file public SourceFile public SourceFile File file this file file public void setFile File file this file file public File getFile return file public static class Html private StringBuffer text new StringBuffer public void addText String text append public String getText return text substring public static class AccessType extends EnumeratedAttribute public String getValues public class ResourceCollectionContainer private ArrayList rcs new ArrayList public void add ResourceCollection rc rcs add rc private Iterator iterator return rcs iterator private static final FileUtils FILE_UTILS FileUtils getFileUtils private Commandline cmd new Commandline private void addArgIf boolean String arg if cmd createArgument setValue arg private void addArgIfNotEmpty String key String value if value null value length cmd createArgument setValue key cmd createArgument setValue value else log key Project MSG_WARN private boolean failOnError false private Path sourcePath null private File destDir null private Vector sourceFiles new Vector private Vector excludePackageNames new Vector private boolean author true private boolean version true private DocletInfo doclet null private Path classpath null private Path bootclasspath null private String group null private Vector links new Vector private Vector groups new Vector private Vector tags new Vector private boolean useDefaultExcludes true private Html doctitle null private Html header null private Html footer null private Html bottom null private boolean useExternalFile false private String source null private boolean linksource false private boolean breakiterator false private String noqualifier private boolean includeNoSourcePackages false private boolean old false private String executable null private ResourceCollectionContainer nestedSourceFiles new ResourceCollectionContainer public void setUseExternalFile boolean useExternalFile public void setDefaultexcludes boolean useDefaultExcludes this useDefaultExcludes useDefaultExcludes public void setMaxmemory String max cmd createArgument setValue max public void setAdditionalparam String add cmd createArgument setLine add public Commandline Argument createArg return cmd createArgument public void setSourcepath Path src if sourcePath null sourcePath src else sourcePath append src public Path createSourcepath if sourcePath null sourcePath new Path getProject return sourcePath createPath public void setSourcepathRef Reference createSourcepath setRefid public void setDestdir File dir destDir dir cmd createArgument setValue cmd createArgument setFile destDir public void setSourcefiles String src StringTokenizer tok new StringTokenizer src while tok hasMoreTokens String tok nextToken SourceFile sf new SourceFile sf setFile getProject resolveFile trim addSource sf public void addSource SourceFile sf sourceFiles addElement sf while tok hasMoreTokens String tok nextToken PackageName pn new PackageName pn setName addPackage pn public void addPackage PackageName pn while tok hasMoreTokens String tok nextToken PackageName pn new PackageName pn setName addExcludePackage pn public void addExcludePackage PackageName pn excludePackageNames addElement pn public void setOverview File cmd createArgument setValue cmd createArgument setFile public void setPublic boolean addArgIf public void setProtected boolean addArgIf public void setPackage boolean public void setPrivate boolean addArgIf public void setAccess AccessType at cmd createArgument setValue at getValue public void setDoclet String docletName if doclet null doclet new DocletInfo doclet setProject getProject doclet setName docletName public void setDocletPath Path docletPath if doclet null doclet new DocletInfo doclet setProject getProject doclet setPath docletPath public void setDocletPathRef Reference if doclet null doclet new DocletInfo doclet setProject getProject doclet createPath setRefid public DocletInfo createDoclet if doclet null doclet new DocletInfo return doclet public void addTaglet ExtensionInfo tagletInfo tags addElement tagletInfo public void setOld boolean old public void setClasspath Path path if classpath null classpath path else classpath append path public Path createClasspath if classpath null classpath new Path getProject return classpath createPath public void setClasspathRef Reference createClasspath setRefid public void setBootclasspath Path path if bootclasspath null bootclasspath path else bootclasspath append path public Path createBootclasspath if bootclasspath null bootclasspath new Path getProject return bootclasspath createPath public void setBootClasspathRef Reference createBootclasspath setRefid public void setExtdirs String path cmd createArgument setValue cmd createArgument setValue path public void setExtdirs Path path cmd createArgument setValue cmd createArgument setPath path public void setVerbose boolean addArgIf public void setLocale String locale cmd createArgument true setValue locale cmd createArgument true setValue public void setEncoding String enc cmd createArgument setValue cmd createArgument setValue enc public void setVersion boolean this version public void setUse boolean addArgIf public void setAuthor boolean author public void setSplitindex boolean addArgIf public void setWindowtitle String title addArgIfNotEmpty title public void setDoctitle String doctitle Html new Html addText doctitle addDoctitle public void addDoctitle Html text doctitle text public void setHeader String header Html new Html addText header addHeader public void addHeader Html text header text public void setFooter String footer Html new Html addText footer addFooter public void addFooter Html text footer text public void setBottom String bottom Html new Html addText bottom addBottom public void addBottom Html text bottom text public void setLinkoffline String src LinkArgument le createLink le setOffline true String linkOfflineError if src trim length throw new BuildException linkOfflineError StringTokenizer tok new StringTokenizer src false le setHref tok nextToken if tok hasMoreTokens throw new BuildException linkOfflineError le setPackagelistLoc getProject resolveFile tok nextToken public void setGroup String src group src public void setLink String src createLink setHref src public void setNodeprecated boolean addArgIf public void setNodeprecatedlist boolean addArgIf public void setNotree boolean addArgIf public void setNoindex boolean addArgIf public void setNohelp boolean addArgIf public void setNonavbar boolean addArgIf public void setSerialwarn boolean addArgIf public void setStylesheetfile File cmd createArgument setValue cmd createArgument setFile public void setHelpfile File cmd createArgument setValue cmd createArgument setFile public void setDocencoding String enc cmd createArgument setValue cmd createArgument setValue enc public void setPackageList String src public LinkArgument createLink LinkArgument la new LinkArgument links addElement la return la public class LinkArgument private String href private boolean offline false private boolean resolveLink false public LinkArgument public void setHref String hr href hr public String getHref return href public void setPackagelistLoc File src public File getPackagelistLoc public void setOffline boolean offline this offline offline public boolean isLinkOffline return offline public void setResolveLink boolean resolve this resolveLink resolve public boolean shouldResolveLink return resolveLink public TagArgument createTag TagArgument ta new TagArgument tags addElement ta return ta static final String SCOPE_ELEMENTS public class TagArgument extends FileSet private String name null private boolean enabled true private String scope public TagArgument public void setName String name this name name public void setScope String verboseScope throws BuildException verboseScope verboseScope toLowerCase Locale US boolean elements new boolean SCOPE_ELEMENTS length boolean gotAll false boolean gotNotAll false StringTokenizer tok new StringTokenizer verboseScope while tok hasMoreTokens String next tok nextToken trim if next equals if gotAll getProject log Project MSG_VERBOSE gotAll true else int for SCOPE_ELEMENTS length if next equals SCOPE_ELEMENTS break if SCOPE_ELEMENTS length throw new BuildException next else if elements getProject log next Project MSG_VERBOSE elements true gotNotAll true if gotNotAll gotAll throw new BuildException if gotNotAll gotAll throw new BuildException if gotAll this scope else StringBuffer buff new StringBuffer elements length for int elements length if elements buff append SCOPE_ELEMENTS charAt this scope buff toString public void setEnabled boolean enabled this enabled enabled public String getParameter throws BuildException if name null name equals throw new BuildException if getDescription null return name enabled scope getDescription else return name enabled scope name public GroupArgument createGroup GroupArgument ga new GroupArgument groups addElement ga return ga public class GroupArgument private Html title public GroupArgument public void setTitle String src Html new Html addText src addTitle public void addTitle Html text title text public String getTitle return title null title getText null public void setPackages String src StringTokenizer tok new StringTokenizer src while tok hasMoreTokens String tok nextToken PackageName pn new PackageName pn setName addPackage pn public void addPackage PackageName pn public String getPackages StringBuffer new StringBuffer if append return toString public void setCharset String src this addArgIfNotEmpty src public void setFailonerror boolean failOnError public void setSource String source this source source public void setExecutable String executable this executable executable public void addFileset FileSet fs createSourceFiles add fs public ResourceCollectionContainer createSourceFiles return nestedSourceFiles public void setLinksource boolean this linksource public void setBreakiterator boolean this breakiterator public void setNoqualifier String noqualifier this noqualifier noqualifier public void setIncludeNoSourcePackages boolean this includeNoSourcePackages public void execute throws BuildException if equals getTaskType log Project MSG_WARN boolean javadoc4 JavaEnvUtils isJavaVersion JavaEnvUtils JAVA_1_2 JavaEnvUtils isJavaVersion JavaEnvUtils JAVA_1_3 boolean javadoc5 javadoc4 JavaEnvUtils isJavaVersion JavaEnvUtils JAVA_1_4 Path sourceDirs new Path getProject String msg throw new BuildException msg if sourcePath null sourceDirs addExisting sourcePath String msg throw new BuildException msg Vector sourceFilesToDoc Vector sourceFiles clone addSourceFiles sourceFilesToDoc sourceFilesToDoc size log Project MSG_INFO Commandline toExecute Commandline cmd clone if executable null toExecute setExecutable executable else toExecute setExecutable JavaEnvUtils getJdkExecutable if doctitle null toExecute createArgument setValue toExecute createArgument setValue expand doctitle getText if header null toExecute createArgument setValue toExecute createArgument setValue expand header getText if footer null toExecute createArgument setValue toExecute createArgument setValue expand footer getText if bottom null toExecute createArgument setValue toExecute createArgument setValue expand bottom getText if classpath null classpath new Path getProject concatSystemClasspath else classpath classpath concatSystemClasspath if classpath size toExecute createArgument setValue toExecute createArgument setPath classpath if sourceDirs size toExecute createArgument setValue toExecute createArgument setPath sourceDirs if version doclet null toExecute createArgument setValue if author doclet null toExecute createArgument setValue if doclet null destDir null throw new BuildException if doclet null if doclet getName null throw new BuildException getLocation else toExecute createArgument setValue toExecute createArgument setValue doclet getName if doclet getPath null Path docletPath doclet getPath concatSystemClasspath if docletPath size toExecute createArgument setValue toExecute createArgument setPath docletPath for Enumeration doclet getParams hasMoreElements DocletParam param DocletParam nextElement if param getName null throw new BuildException toExecute createArgument setValue param getName if param getValue null toExecute createArgument setValue param getValue Path bcp new Path getProject if bootclasspath null bcp append bootclasspath bcp bcp concatSystemBootClasspath if bcp size toExecute createArgument setValue toExecute createArgument setPath bcp if links size for Enumeration links elements hasMoreElements LinkArgument la LinkArgument nextElement if la getHref null la getHref length log Project MSG_VERBOSE continue String link null if la shouldResolveLink File hrefAsFile getProject resolveFile la getHref if hrefAsFile exists try link FILE_UTILS getFileURL hrefAsFile toExternalForm catch MalformedURLException ex log hrefAsFile Project MSG_WARN if link null try new URL base la getHref link la getHref catch MalformedURLException mue log la getHref Project MSG_WARN continue if la isLinkOffline la getHref try toExternalForm toExecute createArgument setValue toExecute createArgument setValue link toExecute createArgument catch MalformedURLException ex log Project MSG_WARN else else toExecute createArgument setValue toExecute createArgument setValue link if group null StringTokenizer tok new StringTokenizer group false while tok hasMoreTokens String grp tok nextToken trim int space grp indexOf if space String name grp substring space String pkgList grp substring space toExecute createArgument setValue toExecute createArgument setValue name toExecute createArgument setValue pkgList if groups size for Enumeration groups elements hasMoreElements GroupArgument ga GroupArgument nextElement String title ga getTitle toExecute createArgument setValue toExecute createArgument setValue expand title if javadoc4 executable null for Enumeration tags elements hasMoreElements Object element nextElement if element instanceof TagArgument TagArgument ta TagArgument element File tagDir ta getDir getProject if tagDir null toExecute createArgument setValue toExecute createArgument setValue ta getParameter else DirectoryScanner tagDefScanner ta getDirectoryScanner getProject String files tagDefScanner getIncludedFiles for int files length File tagDefFile new File tagDir files try BufferedReader in new BufferedReader new FileReader tagDefFile String line null while line in readLine null toExecute createArgument setValue toExecute createArgument setValue line in close catch IOException ioe throw new BuildException tagDefFile getAbsolutePath ioe else ExtensionInfo tagletInfo ExtensionInfo element toExecute createArgument setValue toExecute createArgument setValue tagletInfo getName if tagletInfo getPath null Path tagletPath tagletInfo getPath concatSystemClasspath if tagletPath size toExecute createArgument setValue toExecute createArgument setPath tagletPath String sourceArg source null source getProject getProperty MagicNames BUILD_JAVAC_SOURCE if sourceArg null toExecute createArgument setValue toExecute createArgument setValue sourceArg if linksource doclet null toExecute createArgument setValue if breakiterator doclet null javadoc5 toExecute createArgument setValue if noqualifier null doclet null toExecute createArgument setValue toExecute createArgument setValue noqualifier else if tags isEmpty log Project MSG_VERBOSE if source null log Project MSG_VERBOSE if linksource log Project MSG_VERBOSE if breakiterator log Project MSG_VERBOSE if noqualifier null log Project MSG_VERBOSE if javadoc4 executable null if old toExecute createArgument setValue else if old log Project MSG_WARN if useExternalFile javadoc4 writeExternalArgs toExecute File tmpList null PrintWriter srcListWriter null try if useExternalFile if tmpList null tmpList FILE_UTILS createTempFile null tmpList deleteOnExit toExecute createArgument setValue tmpList getAbsolutePath srcListWriter new PrintWriter new FileWriter tmpList getAbsolutePath true while hasMoreElements if useExternalFile else sourceFilesToDoc elements while hasMoreElements SourceFile sf SourceFile nextElement String sourceFileName sf getFile getAbsolutePath if useExternalFile if javadoc4 sourceFileName indexOf String name sourceFileName if File separatorChar name sourceFileName replace File separatorChar srcListWriter println name else srcListWriter println sourceFileName else toExecute createArgument setValue sourceFileName catch IOException tmpList delete throw new BuildException getLocation finally if srcListWriter null srcListWriter close log toExecute describeCommand Project MSG_VERBOSE log Project MSG_INFO JavadocOutputStream out new JavadocOutputStream Project MSG_INFO JavadocOutputStream err new JavadocOutputStream Project MSG_WARN Execute exe new Execute new PumpStreamHandler out err exe setAntRun getProject exe setWorkingDirectory null try exe setCommandline toExecute getCommandline int ret exe execute if ret failOnError throw new BuildException ret getLocation catch IOException throw new BuildException getLocation finally if tmpList null tmpList delete tmpList null out logFlush err logFlush try out close err close catch IOException private void writeExternalArgs Commandline toExecute File optionsTmpFile null PrintWriter optionsListWriter null try optionsTmpFile FILE_UTILS createTempFile null optionsTmpFile deleteOnExit String listOpt toExecute getArguments toExecute clearArgs toExecute createArgument setValue optionsTmpFile getAbsolutePath optionsListWriter new PrintWriter new FileWriter optionsTmpFile getAbsolutePath true for int listOpt length String string listOpt if string startsWith toExecute createArgument setValue string else if string startsWith optionsListWriter print string optionsListWriter print else optionsListWriter println quoteString string optionsListWriter close catch IOException ex if optionsTmpFile null optionsTmpFile delete throw new BuildException ex getLocation finally FILE_UTILS close optionsListWriter private String quoteString String str if str indexOf str indexOf str indexOf return str if str indexOf return quoteString str else return quoteString str private String quoteString String str char delim StringBuffer buf new StringBuffer str length buf append delim if str indexOf str replace str if str indexOf delim str replace str delim delim buf append str buf append delim return buf toString private String replace String str char fromChar String toString StringBuffer buf new StringBuffer str length for int str length char ch str charAt if ch fromChar buf append toString else buf append ch return buf toString private void addSourceFiles Vector sf Iterator nestedSourceFiles iterator while hasNext ResourceCollection rc ResourceCollection next if rc isFilesystemOnly throw new BuildException if rc instanceof FileSet FileSet fs FileSet rc if fs hasPatterns fs hasSelectors fs FileSet fs clone if includeNoSourcePackages Iterator iter rc iterator while iter hasNext sf addElement new SourceFile FileResource iter next getFile private void parsePackages Vector pn Path sp Vector addedPackages new Vector if sourcePath null PatternSet ps new PatternSet while hasMoreElements PackageName PackageName nextElement String pkg getName replace if pkg endsWith pkg ps createInclude setName pkg else ps createInclude setName Enumeration excludePackageNames elements while hasMoreElements PackageName PackageName nextElement String pkg getName replace if pkg endsWith pkg ps createExclude setName pkg String pathElements sourcePath list for int pathElements length File dir new File pathElements if dir isDirectory DirSet ds new DirSet ds setDefaultexcludes useDefaultExcludes ds setDir dir ds createPatternSet addConfiguredPatternset ps dirSets addElement ds else log pathElements Project MSG_WARN Enumeration dirSets elements while hasMoreElements DirSet ds DirSet nextElement File baseDir ds getDir getProject DirectoryScanner dsc ds getDirectoryScanner getProject String dirs dsc getIncludedDirectories boolean containsPackages false for int dirs length File pd new File baseDir dirs String files pd list new FilenameFilter public boolean accept File dir1 String name return name endsWith includeNoSourcePackages if files length if equals dirs log baseDir Project MSG_WARN else containsPackages true dirs replace File separatorChar if containsPackages sp createPathElement setLocation baseDir else Project MSG_VERBOSE private class JavadocOutputStream extends LogOutputStream JavadocOutputStream int level super Javadoc this level private String queuedLine null protected void processLine String line int messageLevel if messageLevel Project MSG_INFO line startsWith if queuedLine null super processLine queuedLine Project MSG_VERBOSE queuedLine line else if queuedLine null if line startsWith super processLine queuedLine Project MSG_VERBOSE else super processLine queuedLine Project MSG_INFO queuedLine null super processLine line messageLevel protected void logFlush if queuedLine null super processLine queuedLine Project MSG_VERBOSE queuedLine null protected String expand String content return getProject replaceProperties content public abstract class BaseSelector extends DataType implements FileSelector private String errmsg null public BaseSelector public void setError String msg if errmsg null errmsg msg public String getError return errmsg public void verifySettings if isReference BaseSelector getCheckedRef verifySettings public void validate if getError null verifySettings if getError null throw new BuildException errmsg public abstract boolean isSelected File basedir String filename File file public class ResourceSelectorContainer extends DataType private Vector new Vector public ResourceSelectorContainer public ResourceSelectorContainer ResourceSelector for int length add public void add ResourceSelector if isReference throw noChildrenAllowed if null return add setChecked false public boolean hasSelectors if isReference return ResourceSelectorContainer getCheckedRef hasSelectors dieOnCircularReference return isEmpty public int selectorCount if isReference return ResourceSelectorContainer getCheckedRef selectorCount dieOnCircularReference return size public Iterator getSelectors if isReference return ResourceSelectorContainer getCheckedRef getSelectors dieOnCircularReference return Collections unmodifiableList iterator protected void dieOnCircularReference Stack stk Project throws BuildException if isChecked return if isReference super dieOnCircularReference stk else for Iterator iterator hasNext Object next if instanceof DataType stk push invokeCircularReferenceCheck DataType stk setChecked true public class Gcj extends DefaultCompilerAdapter public boolean execute throws BuildException Commandline cmd attributes log Project MSG_VERBOSE cmd setupGCJCommand int firstFileName cmd size logAndAddFilesToCompile cmd return executeExternalCompile cmd getCommandline firstFileName protected Commandline setupGCJCommand Commandline cmd new Commandline Path classpath new Path project Path getBootClassPath if size classpath append classpath addExtdirs extdirs classpath append getCompileClasspath if compileSourcepath null classpath append compileSourcepath else classpath append src String exec getJavac getExecutable cmd setExecutable exec null exec if destDir null cmd createArgument setValue cmd createArgument setFile destDir if destDir exists destDir mkdirs throw new BuildException cmd createArgument setValue cmd createArgument setPath classpath if encoding null cmd createArgument setValue encoding if debug cmd createArgument setValue if optimize cmd createArgument setValue if isNativeBuild cmd createArgument setValue addCurrentCompilerArgs cmd return cmd public boolean isNativeBuild boolean nativeBuild false String additionalArguments getJavac getCurrentCompilerArgs int argsLength while nativeBuild argsLength additionalArguments length int conflictLength while nativeBuild conflictLength CONFLICT_WITH_DASH_C length nativeBuild additionalArguments argsLength startsWith CONFLICT_WITH_DASH_C conflictLength conflictLength argsLength return nativeBuild private static final String CONFLICT_WITH_DASH_C public class JarFileIterator implements ClassFileIterator private ZipInputStream jarStream public JarFileIterator InputStream stream throws IOException super jarStream new ZipInputStream stream public ClassFile getNextClassFile ZipEntry jarEntry ClassFile nextElement null try jarEntry jarStream getNextEntry while nextElement null jarEntry null String entryName jarEntry getName if jarEntry isDirectory entryName endsWith ClassFile javaClass new ClassFile javaClass read jarStream nextElement javaClass else jarEntry jarStream getNextEntry catch IOException String message getMessage String text getClass getName if message null text message throw new RuntimeException text return nextElement 