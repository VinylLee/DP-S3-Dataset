public class FuzzyQuery extends MultiTermQuery public final static float defaultMinSimilarity public final static int defaultPrefixLength private float minimumSimilarity private int prefixLength public FuzzyQuery Term term float minimumSimilarity int prefixLength throws IllegalArgumentException super term if minimumSimilarity throw new IllegalArgumentException else if minimumSimilarity throw new IllegalArgumentException if prefixLength throw new IllegalArgumentException this minimumSimilarity minimumSimilarity this prefixLength prefixLength public FuzzyQuery Term term float minimumSimilarity throws IllegalArgumentException this term minimumSimilarity defaultPrefixLength public FuzzyQuery Term term this term defaultMinSimilarity defaultPrefixLength public float getMinSimilarity return minimumSimilarity public int getPrefixLength return prefixLength protected FilteredTermEnum getEnum IndexReader reader throws IOException return new FuzzyTermEnum reader getTerm minimumSimilarity prefixLength public Query rewrite IndexReader reader throws IOException FilteredTermEnum enumerator getEnum reader int maxClauseCount BooleanQuery getMaxClauseCount ScoreTermQueue stQueue new ScoreTermQueue maxClauseCount try do float minScore float score Term enumerator term if null score enumerator difference if stQueue size maxClauseCount score minScore stQueue insert new ScoreTerm score while enumerator next finally enumerator close BooleanQuery query new BooleanQuery true int size stQueue size for int size ScoreTerm st ScoreTerm stQueue pop return query public String toString String field StringBuffer buffer new StringBuffer Term term getTerm if term field equals field buffer append term field buffer append buffer append term text buffer append buffer append Float toString minimumSimilarity buffer append ToStringUtils boost getBoost return buffer toString protected static class ScoreTerm public Term term public float score public ScoreTerm Term term float score this term term this score score protected static class ScoreTermQueue extends PriorityQueue public ScoreTermQueue int size initialize size protected boolean lessThan Object Object ScoreTerm termA ScoreTerm ScoreTerm termB ScoreTerm if termA score termB score return termA term compareTo termB term else return termA score termB score public boolean equals Object if this return true if instanceof FuzzyQuery return false if super equals return false final FuzzyQuery fuzzyQuery FuzzyQuery if minimumSimilarity fuzzyQuery minimumSimilarity return false if prefixLength fuzzyQuery prefixLength return false return true public int hashCode int result super hashCode result result minimumSimilarity Float floatToIntBits minimumSimilarity result result prefixLength return result abstract class MultiLevelSkipListReader private int maxNumberOfSkipLevels private int numberOfSkipLevels private int numberOfLevelsToBuffer private int docCount private boolean haveSkipped private boolean inputIsBuffered public MultiLevelSkipListReader IndexInput skipStream int maxSkipLevels int skipInterval this skipStream new IndexInput maxSkipLevels this skipPointer new long maxSkipLevels this childPointer new long maxSkipLevels this numSkipped new int maxSkipLevels this maxNumberOfSkipLevels maxSkipLevels this skipInterval new int maxSkipLevels this skipStream skipStream this inputIsBuffered skipStream instanceof BufferedIndexInput this skipInterval skipInterval for int maxSkipLevels this skipInterval this skipInterval skipInterval skipDoc new int maxSkipLevels int getDoc return lastDoc int skipTo int target throws IOException if haveSkipped loadSkipLevels haveSkipped true int level while level numberOfSkipLevels target skipDoc level level while level if target skipDoc level if loadNextSkip level continue else if level lastChildPointer skipStream level getFilePointer seekChild level level return numSkipped skipInterval private boolean loadNextSkip int level throws IOException setLastSkipData level numSkipped level skipInterval level if numSkipped level docCount skipDoc level Integer MAX_VALUE if numberOfSkipLevels level numberOfSkipLevels level return false skipDoc level readSkipData level skipStream level if level childPointer level skipStream level readVLong skipPointer level return true protected void seekChild int level throws IOException skipStream level seek lastChildPointer numSkipped level numSkipped level skipInterval level skipDoc level lastDoc if level childPointer level skipStream level readVLong skipPointer level void close throws IOException for int skipStream length if skipStream null skipStream close void init long skipPointer int df this skipPointer skipPointer this docCount df Arrays fill skipDoc Arrays fill numSkipped haveSkipped false for int numberOfSkipLevels skipStream null private void loadSkipLevels throws IOException numberOfSkipLevels docCount int Math floor Math log docCount Math log skipInterval if numberOfSkipLevels maxNumberOfSkipLevels numberOfSkipLevels maxNumberOfSkipLevels skipStream seek skipPointer int toBuffer numberOfLevelsToBuffer for int numberOfSkipLevels long length skipStream readVLong skipPointer skipStream getFilePointer if toBuffer skipStream new SkipBuffer skipStream int length toBuffer else skipStream IndexInput skipStream clone if inputIsBuffered length BufferedIndexInput BUFFER_SIZE BufferedIndexInput skipStream setBufferSize int length skipStream seek skipStream getFilePointer length skipPointer skipStream getFilePointer protected abstract int readSkipData int level IndexInput skipStream throws IOException protected void setLastSkipData int level lastDoc skipDoc level lastChildPointer childPointer level private final static class SkipBuffer extends IndexInput private byte data private long pointer private int pos SkipBuffer IndexInput input int length throws IOException data new byte length pointer input getFilePointer input readBytes data length public void close throws IOException data null public long getFilePointer return pointer pos public long length return data length public byte readByte throws IOException return data pos public void readBytes byte int offset int len throws IOException System arraycopy data pos offset len pos len public void seek long pos throws IOException this pos int pos pointer public class RAMDirectory extends Directory implements Serializable private static final long serialVersionUID HashMap fileMap new HashMap long sizeInBytes public RAMDirectory setLockFactory new SingleInstanceLockFactory public RAMDirectory Directory dir throws IOException this dir false private RAMDirectory Directory dir boolean closeDir throws IOException this Directory copy dir this closeDir public RAMDirectory File dir throws IOException this FSDirectory getDirectory dir true public RAMDirectory String dir throws IOException this FSDirectory getDirectory dir true public synchronized final String list ensureOpen Set fileNames fileMap keySet String result new String fileNames size int Iterator it fileNames iterator while it hasNext result String it next return result public final boolean fileExists String name ensureOpen RAMFile file synchronized this file RAMFile fileMap get name return file null public final long fileModified String name throws IOException ensureOpen RAMFile file synchronized this file RAMFile fileMap get name if file null throw new FileNotFoundException name return file getLastModified public void touchFile String name throws IOException ensureOpen RAMFile file synchronized this file RAMFile fileMap get name if file null throw new FileNotFoundException name long ts2 ts1 System currentTimeMillis do try Thread sleep catch InterruptedException ts2 System currentTimeMillis while ts1 ts2 file setLastModified ts2 public final long fileLength String name throws IOException ensureOpen RAMFile file synchronized this file RAMFile fileMap get name if file null throw new FileNotFoundException name return file getLength public synchronized final long sizeInBytes ensureOpen return sizeInBytes public synchronized void deleteFile String name throws IOException ensureOpen RAMFile file RAMFile fileMap get name if file null fileMap remove name file directory null else throw new FileNotFoundException name public synchronized final void renameFile String from String to throws IOException ensureOpen RAMFile fromFile RAMFile fileMap get from if fromFile null throw new FileNotFoundException from RAMFile toFile RAMFile fileMap get to if toFile null toFile directory null fileMap remove from fileMap put to fromFile public IndexOutput createOutput String name ensureOpen RAMFile file new RAMFile this synchronized this RAMFile existing RAMFile fileMap get name if existing null sizeInBytes existing sizeInBytes existing directory null fileMap put name file return new RAMOutputStream file public IndexInput openInput String name throws IOException ensureOpen RAMFile file synchronized this file RAMFile fileMap get name if file null throw new FileNotFoundException name return new RAMInputStream file public void close fileMap null protected final void ensureOpen throws AlreadyClosedException if fileMap null throw new AlreadyClosedException public abstract class SpanQuery extends Query public abstract Spans getSpans IndexReader reader throws IOException public abstract String getField public abstract Collection getTerms protected Weight createWeight Searcher searcher throws IOException return new SpanWeight this searcher public interface TermPositions extends TermDocs int nextPosition throws IOException int getPayloadLength byte getPayload byte data int offset throws IOException public boolean isPayloadAvailable public abstract class DocValues private int nVals public DocValues int nVals this nVals nVals private DocValues public abstract float floatVal int doc public int intVal int doc return int floatVal doc public long longVal int doc return long floatVal doc public double doubleVal int doc return double floatVal doc public String strVal int doc return Float toString floatVal doc public abstract String toString int doc public Explanation explain int doc return new Explanation floatVal doc toString doc Object getInnerArray return new Object private float minVal private float maxVal private float avgVal private boolean computed false private void compute if computed return minVal Float MAX_VALUE maxVal float sum for int nVals float val floatVal sum val minVal Math min minVal val maxVal Math max maxVal val avgVal sum nVals computed true public float getMinValue compute return minVal public float getMaxValue compute return maxVal public float getAverageValue compute return avgVal public interface CharStream char readChar throws java io IOException int getColumn int getLine int getEndColumn int getEndLine int getBeginColumn int getBeginLine void backup int amount char BeginToken throws java io IOException String GetImage char GetSuffix int len void Done public final class FastCharStream implements CharStream char buffer null public FastCharStream Reader input public final char readChar throws IOException if bufferPosition bufferLength refill return buffer bufferPosition private final void refill throws IOException int newPosition bufferLength tokenStart buffer new char char newBuffer new char buffer length System arraycopy buffer newBuffer bufferLength buffer newBuffer System arraycopy buffer tokenStart buffer newPosition bufferPosition newPosition bufferStart tokenStart tokenStart input read buffer newPosition buffer length newPosition if charsRead throw new IOException else bufferLength charsRead public final char BeginToken throws IOException tokenStart bufferPosition return readChar public final void backup int amount bufferPosition amount public final String GetImage return new String buffer tokenStart bufferPosition tokenStart public final char GetSuffix int len char value new char len System arraycopy buffer bufferPosition len value len return value public final void Done try input close catch IOException System err println public final int getColumn return bufferStart bufferPosition public final int getLine return public final int getEndColumn return bufferStart bufferPosition public final int getEndLine return public final int getBeginColumn return bufferStart tokenStart public final int getBeginLine return class FieldCacheImpl implements FieldCache abstract static class Cache private final Map readerCache new WeakHashMap protected abstract Object createValue IndexReader reader Object key throws IOException public Object get IndexReader reader Object key throws IOException Map innerCache Object value synchronized readerCache innerCache Map readerCache get reader if innerCache null innerCache new HashMap readerCache put reader innerCache value null else value innerCache get key if value null value new CreationPlaceholder innerCache put key value if value instanceof CreationPlaceholder synchronized value CreationPlaceholder progress CreationPlaceholder value if progress value null progress value createValue reader key synchronized readerCache innerCache put key progress value return progress value return value static final class CreationPlaceholder Object value static class Entry Entry String field int type Locale locale this field field intern this type type this custom null this locale locale Entry String field Object custom this field field intern this type SortField CUSTOM this custom custom this locale null public boolean equals Object if instanceof Entry Entry other Entry if other field field other type type if other locale null locale null other locale equals locale if other custom null if custom null return true else if other custom equals custom return true return false public int hashCode return field hashCode type custom null custom hashCode locale null locale hashCode private static final ByteParser BYTE_PARSER new ByteParser public byte parseByte String value return Byte parseByte value private static final ShortParser SHORT_PARSER new ShortParser public short parseShort String value return Short parseShort value private static final IntParser INT_PARSER new IntParser public int parseInt String value return Integer parseInt value private static final FloatParser FLOAT_PARSER new FloatParser public float parseFloat String value return Float parseFloat value public byte getBytes IndexReader reader String field throws IOException return getBytes reader field BYTE_PARSER public byte getBytes IndexReader reader String field ByteParser parser throws IOException return byte bytesCache get reader new Entry field parser Cache bytesCache new Cache protected Object createValue IndexReader reader Object entryKey throws IOException Entry entry Entry entryKey String field entry field ByteParser parser ByteParser entry custom final byte retArray new byte reader maxDoc TermDocs termDocs reader termDocs TermEnum termEnum reader terms new Term field try do Term term termEnum term if term null term field field break byte termval parser parseByte term text termDocs seek termEnum while termDocs next retArray termDocs doc termval while termEnum next finally termDocs close termEnum close return retArray public short getShorts IndexReader reader String field throws IOException return getShorts reader field SHORT_PARSER public short getShorts IndexReader reader String field ShortParser parser throws IOException return short shortsCache get reader new Entry field parser Cache shortsCache new Cache protected Object createValue IndexReader reader Object entryKey throws IOException Entry entry Entry entryKey String field entry field ShortParser parser ShortParser entry custom final short retArray new short reader maxDoc TermDocs termDocs reader termDocs TermEnum termEnum reader terms new Term field try do Term term termEnum term if term null term field field break short termval parser parseShort term text termDocs seek termEnum while termDocs next retArray termDocs doc termval while termEnum next finally termDocs close termEnum close return retArray public int getInts IndexReader reader String field throws IOException return getInts reader field INT_PARSER public int getInts IndexReader reader String field IntParser parser throws IOException return int intsCache get reader new Entry field parser Cache intsCache new Cache protected Object createValue IndexReader reader Object entryKey throws IOException Entry entry Entry entryKey String field entry field IntParser parser IntParser entry custom final int retArray new int reader maxDoc TermDocs termDocs reader termDocs TermEnum termEnum reader terms new Term field try do Term term termEnum term if term null term field field break int termval parser parseInt term text termDocs seek termEnum while termDocs next retArray termDocs doc termval while termEnum next finally termDocs close termEnum close return retArray public float getFloats IndexReader reader String field throws IOException return getFloats reader field FLOAT_PARSER public float getFloats IndexReader reader String field FloatParser parser throws IOException return float floatsCache get reader new Entry field parser Cache floatsCache new Cache protected Object createValue IndexReader reader Object entryKey throws IOException Entry entry Entry entryKey String field entry field FloatParser parser FloatParser entry custom final float retArray new float reader maxDoc TermDocs termDocs reader termDocs TermEnum termEnum reader terms new Term field try do Term term termEnum term if term null term field field break float termval parser parseFloat term text termDocs seek termEnum while termDocs next retArray termDocs doc termval while termEnum next finally termDocs close termEnum close return retArray public String getStrings IndexReader reader String field throws IOException return String stringsCache get reader field Cache stringsCache new Cache protected Object createValue IndexReader reader Object fieldKey throws IOException String field String fieldKey intern final String retArray new String reader maxDoc TermDocs termDocs reader termDocs TermEnum termEnum reader terms new Term field try do Term term termEnum term if term null term field field break String termval term text termDocs seek termEnum while termDocs next retArray termDocs doc termval while termEnum next finally termDocs close termEnum close return retArray public StringIndex getStringIndex IndexReader reader String field throws IOException return StringIndex stringsIndexCache get reader field Cache stringsIndexCache new Cache protected Object createValue IndexReader reader Object fieldKey throws IOException String field String fieldKey intern final int retArray new int reader maxDoc String mterms new String reader maxDoc TermDocs termDocs reader termDocs TermEnum termEnum reader terms new Term field mterms null try do Term term termEnum term if term null term field field break if mterms length throw new RuntimeException field mterms term text termDocs seek termEnum while termDocs next retArray termDocs doc while termEnum next finally termDocs close termEnum close if mterms new String else if mterms length String terms new String System arraycopy mterms terms mterms terms StringIndex value new StringIndex retArray mterms return value public Object getAuto IndexReader reader String field throws IOException return autoCache get reader field Cache autoCache new Cache protected Object createValue IndexReader reader Object fieldKey throws IOException String field String fieldKey intern TermEnum enumerator reader terms new Term field try Term term enumerator term if term null throw new RuntimeException field Object ret null if term field field String termtext term text trim try Integer parseInt termtext ret getInts reader field catch NumberFormatException nfe1 try Float parseFloat termtext ret getFloats reader field catch NumberFormatException nfe2 ret getStringIndex reader field else throw new RuntimeException field return ret finally enumerator close public Comparable getCustom IndexReader reader String field SortComparator comparator throws IOException return Comparable customCache get reader new Entry field comparator Cache customCache new Cache protected Object createValue IndexReader reader Object entryKey throws IOException Entry entry Entry entryKey String field entry field SortComparator comparator SortComparator entry custom final Comparable retArray new Comparable reader maxDoc TermDocs termDocs reader termDocs TermEnum termEnum reader terms new Term field try do Term term termEnum term if term null term field field break Comparable termval comparator getComparable term text termDocs seek termEnum while termDocs next retArray termDocs doc termval while termEnum next finally termDocs close termEnum close return retArray public class LoadFirstFieldSelector implements FieldSelector public FieldSelectorResult accept String fieldName return FieldSelectorResult LOAD_AND_BREAK final class SegmentInfo public SegmentInfo String name int docCount Directory dir this name name this docCount docCount this dir dir delGen NO isCompoundFile CHECK_DIR preLockless true hasSingleNormFile false public SegmentInfo String name int docCount Directory dir boolean isCompoundFile boolean hasSingleNormFile this name docCount dir this isCompoundFile byte isCompoundFile YES NO this hasSingleNormFile hasSingleNormFile preLockless false void reset SegmentInfo src files null name src name docCount src docCount dir src dir preLockless src preLockless delGen src delGen if src normGen null normGen null else normGen new long src normGen length System arraycopy src normGen normGen src normGen length isCompoundFile src isCompoundFile hasSingleNormFile src hasSingleNormFile SegmentInfo Directory dir int format IndexInput input throws IOException this dir dir name input readString docCount input readInt if format SegmentInfos FORMAT_LOCKLESS delGen input readLong if format SegmentInfos FORMAT_SINGLE_NORM_FILE hasSingleNormFile input readByte else hasSingleNormFile false int numNormGen input readInt if numNormGen NO normGen null else normGen new long numNormGen for int numNormGen normGen input readLong isCompoundFile input readByte preLockless isCompoundFile CHECK_DIR else delGen CHECK_DIR normGen null isCompoundFile CHECK_DIR preLockless true hasSingleNormFile false void setNumFields int numFields if normGen null normGen new long numFields if preLockless else for int numFields normGen NO boolean hasDeletions throws IOException if delGen NO return false else if delGen YES return true else return dir fileExists getDelFileName void advanceDelGen if delGen NO delGen YES else delGen files null void clearDelGen delGen NO files null public Object clone SegmentInfo si new SegmentInfo name docCount dir si isCompoundFile isCompoundFile si delGen delGen si preLockless preLockless si hasSingleNormFile hasSingleNormFile if normGen null si normGen long normGen clone return si String getDelFileName if delGen NO return null else return IndexFileNames fileNameFromGeneration name IndexFileNames DELETES_EXTENSION delGen boolean hasSeparateNorms int fieldNumber throws IOException if normGen null preLockless normGen null normGen fieldNumber CHECK_DIR String fileName name fieldNumber return dir fileExists fileName else if normGen null normGen fieldNumber NO return false else return true boolean hasSeparateNorms throws IOException if normGen null if preLockless return false else String result dir list if result null throw new IOException dir String pattern pattern name int patternLength pattern length for int result length if result startsWith pattern Character isDigit result charAt patternLength return true return false else for int normGen length if normGen YES return true for int normGen length if normGen CHECK_DIR if hasSeparateNorms return true return false void advanceNormGen int fieldIndex if normGen fieldIndex NO normGen fieldIndex YES else normGen fieldIndex files null String getNormFileName int number throws IOException String prefix long gen if normGen null gen CHECK_DIR else gen normGen number if hasSeparateNorms number prefix return IndexFileNames fileNameFromGeneration name prefix number gen if hasSingleNormFile prefix IndexFileNames NORMS_EXTENSION return IndexFileNames fileNameFromGeneration name prefix WITHOUT_GEN prefix return IndexFileNames fileNameFromGeneration name prefix number WITHOUT_GEN void setUseCompoundFile boolean isCompoundFile if isCompoundFile this isCompoundFile YES else this isCompoundFile NO files null boolean getUseCompoundFile throws IOException if isCompoundFile NO return false else if isCompoundFile YES return true else return dir fileExists name IndexFileNames COMPOUND_FILE_EXTENSION void write IndexOutput output throws IOException output writeString name output writeInt docCount output writeLong delGen output writeByte byte hasSingleNormFile if normGen null output writeInt NO else output writeInt normGen length for int normGen length output writeLong normGen output writeByte isCompoundFile public List files throws IOException if files null return files files new ArrayList boolean useCompoundFile getUseCompoundFile if useCompoundFile files add name IndexFileNames COMPOUND_FILE_EXTENSION else for int IndexFileNames INDEX_EXTENSIONS_IN_COMPOUND_FILE length String ext IndexFileNames INDEX_EXTENSIONS_IN_COMPOUND_FILE String fileName name ext if dir fileExists fileName files add fileName String delFileName IndexFileNames fileNameFromGeneration name IndexFileNames DELETES_EXTENSION delGen if delFileName null delGen YES dir fileExists delFileName files add delFileName if normGen null for int normGen length long gen normGen if gen YES files add IndexFileNames fileNameFromGeneration name IndexFileNames SEPARATE_NORMS_EXTENSION gen else if NO gen if hasSingleNormFile useCompoundFile String fileName name IndexFileNames PLAIN_NORMS_EXTENSION if dir fileExists fileName files add fileName else if CHECK_DIR gen String fileName null if useCompoundFile fileName name IndexFileNames SEPARATE_NORMS_EXTENSION else if hasSingleNormFile fileName name IndexFileNames PLAIN_NORMS_EXTENSION if fileName null dir fileExists fileName files add fileName else if preLockless hasSingleNormFile useCompoundFile String prefix if useCompoundFile prefix name IndexFileNames SEPARATE_NORMS_EXTENSION else prefix name IndexFileNames PLAIN_NORMS_EXTENSION int prefixLength prefix length String allFiles dir list if allFiles null throw new IOException dir for int allFiles length String fileName allFiles if fileName length prefixLength Character isDigit fileName charAt prefixLength fileName startsWith prefix files add fileName return files public abstract class BufferedIndexInput extends IndexInput public static final int BUFFER_SIZE private int bufferSize BUFFER_SIZE private byte buffer public byte readByte throws IOException if bufferPosition bufferLength refill return buffer bufferPosition public BufferedIndexInput public BufferedIndexInput int bufferSize checkBufferSize bufferSize this bufferSize bufferSize public void setBufferSize int newSize assert buffer null bufferSize buffer length if newSize bufferSize checkBufferSize newSize bufferSize newSize if buffer null byte newBuffer new byte newSize final int leftInBuffer bufferLength bufferPosition final int numToCopy if leftInBuffer newSize numToCopy newSize else numToCopy leftInBuffer System arraycopy buffer bufferPosition newBuffer numToCopy bufferStart bufferPosition bufferPosition bufferLength numToCopy buffer newBuffer public int getBufferSize return bufferSize private void checkBufferSize int bufferSize if bufferSize throw new IllegalArgumentException bufferSize public void readBytes byte int offset int len throws IOException if len bufferLength bufferPosition System arraycopy buffer bufferPosition offset len bufferPosition len else int available bufferLength bufferPosition if available System arraycopy buffer bufferPosition offset available offset available len available bufferPosition available if len bufferSize refill if bufferLength len System arraycopy buffer offset bufferLength throw new IOException else System arraycopy buffer offset len bufferPosition len else long after bufferStart bufferPosition len if after length throw new IOException readInternal offset len bufferStart after bufferPosition private void refill throws IOException long start bufferStart bufferPosition long end start bufferSize end length bufferLength int end start if bufferLength throw new IOException if buffer null seekInternal bufferStart readInternal buffer bufferLength bufferStart start bufferPosition protected abstract void readInternal byte int offset int length throws IOException public long getFilePointer return bufferStart bufferPosition public void seek long pos throws IOException if pos bufferStart pos bufferStart bufferLength else bufferStart pos bufferPosition seekInternal pos protected abstract void seekInternal long pos throws IOException public Object clone BufferedIndexInput clone BufferedIndexInput super clone clone buffer null clone bufferLength clone bufferPosition clone bufferStart getFilePointer return clone final class TermInfosWriter public static final int FORMAT private FieldInfos fieldInfos private IndexOutput output private Term lastTerm new Term private TermInfo lastTi new TermInfo private long size int indexInterval int skipInterval int maxSkipLevels private long lastIndexPointer private boolean isIndex false private TermInfosWriter other null TermInfosWriter Directory directory String segment FieldInfos fis int interval throws IOException initialize directory segment fis interval false other new TermInfosWriter directory segment fis interval true other other this private TermInfosWriter Directory directory String segment FieldInfos fis int interval boolean isIndex throws IOException initialize directory segment fis interval isIndex private void initialize Directory directory String segment FieldInfos fis int interval boolean isi throws IOException indexInterval interval fieldInfos fis isIndex isi output directory createOutput segment isIndex final void add Term term TermInfo ti throws CorruptIndexException IOException if isIndex term compareTo lastTerm throw new CorruptIndexException term lastTerm if ti freqPointer lastTi freqPointer throw new CorruptIndexException ti freqPointer lastTi freqPointer if ti proxPointer lastTi proxPointer throw new CorruptIndexException ti proxPointer lastTi proxPointer if isIndex size indexInterval output writeVLong ti proxPointer lastTi proxPointer if ti docFreq skipInterval output writeVInt ti skipOffset if isIndex output writeVLong other output getFilePointer lastIndexPointer lastTi set ti size private final void writeTerm Term term throws IOException int start StringHelper stringDifference lastTerm text term text int length term text length start lastTerm term final void close throws IOException output writeLong size output close if isIndex other close class DefaultSkipListReader extends MultiLevelSkipListReader private boolean currentFieldStoresPayloads private long freqPointer private long proxPointer private int payloadLength private long lastFreqPointer private long lastProxPointer private int lastPayloadLength DefaultSkipListReader IndexInput skipStream int maxSkipLevels int skipInterval super skipStream maxSkipLevels skipInterval freqPointer new long maxSkipLevels proxPointer new long maxSkipLevels payloadLength new int maxSkipLevels void init long skipPointer long freqBasePointer long proxBasePointer int df boolean storesPayloads super init skipPointer df this currentFieldStoresPayloads storesPayloads lastFreqPointer freqBasePointer lastProxPointer proxBasePointer Arrays fill freqPointer freqBasePointer Arrays fill proxPointer proxBasePointer Arrays fill payloadLength long getFreqPointer return lastFreqPointer long getProxPointer return lastProxPointer int getPayloadLength return lastPayloadLength protected void seekChild int level throws IOException super seekChild level freqPointer level lastFreqPointer proxPointer level lastProxPointer payloadLength level lastPayloadLength protected void setLastSkipData int level super setLastSkipData level lastFreqPointer freqPointer level lastProxPointer proxPointer level lastPayloadLength payloadLength level protected int readSkipData int level IndexInput skipStream throws IOException int delta if currentFieldStoresPayloads delta skipStream readVInt if delta payloadLength level skipStream readVInt delta else delta skipStream readVInt freqPointer level skipStream readVInt proxPointer level skipStream readVInt return delta public class MultiSearcher extends Searcher private static class CachedDfSource extends Searcher public CachedDfSource Map dfMap int maxDoc Similarity similarity this dfMap dfMap this maxDoc maxDoc setSimilarity similarity public int docFreq Term term int df try df Integer dfMap get term intValue catch NullPointerException throw new IllegalArgumentException term text return df public int docFreqs Term terms int result new int terms length for int terms length result docFreq terms return result public int maxDoc return maxDoc public Query rewrite Query query return query public void close throw new UnsupportedOperationException public Document doc int throw new UnsupportedOperationException public Document doc int FieldSelector fieldSelector throw new UnsupportedOperationException public Explanation explain Weight weight int doc throw new UnsupportedOperationException public void search Weight weight Filter filter HitCollector results throw new UnsupportedOperationException public TopDocs search Weight weight Filter filter int throw new UnsupportedOperationException public TopFieldDocs search Weight weight Filter filter int Sort sort throw new UnsupportedOperationException private Searchable searchables private int starts private int maxDoc public MultiSearcher Searchable searchables throws IOException this searchables searchables for int searchables length starts maxDoc starts searchables length maxDoc public Searchable getSearchables return searchables protected int getStarts return starts public void close throws IOException for int searchables length searchables close public int docFreq Term term throws IOException int docFreq for int searchables length docFreq searchables docFreq term return docFreq public Document doc int throws CorruptIndexException IOException public Document doc int FieldSelector fieldSelector throws CorruptIndexException IOException while hi lo int mid lo hi int midValue starts mid if midValue hi mid else if midValue lo mid while mid searchables length starts mid midValue return mid return hi public int subDoc int return starts subSearcher public int maxDoc throws IOException return maxDoc public TopDocs search Weight weight Filter filter int nDocs throws IOException HitQueue hq new HitQueue nDocs int totalHits TopDocs docs searchables search weight filter nDocs ScoreDoc scoreDocs docs scoreDocs ScoreDoc scoreDoc scoreDocs if hq insert scoreDoc ScoreDoc scoreDocs new ScoreDoc hq size scoreDocs ScoreDoc hq pop float maxScore totalHits Float NEGATIVE_INFINITY scoreDocs score return new TopDocs totalHits scoreDocs maxScore public TopFieldDocs search Weight weight Filter filter int Sort sort throws IOException FieldDocSortedHitQueue hq null int totalHits float maxScore Float NEGATIVE_INFINITY TopFieldDocs docs searchables search weight filter sort if hq null hq new FieldDocSortedHitQueue docs fields maxScore Math max maxScore docs getMaxScore ScoreDoc scoreDocs docs scoreDocs ScoreDoc scoreDoc scoreDocs if hq insert scoreDoc ScoreDoc scoreDocs new ScoreDoc hq size scoreDocs ScoreDoc hq pop return new TopFieldDocs totalHits scoreDocs hq getFields maxScore public void search Weight weight Filter filter final HitCollector results throws IOException for int searchables length final int start starts searchables search weight filter new HitCollector public void collect int doc float score results collect doc start score public Query rewrite Query original throws IOException Query queries new Query searchables length for int searchables length queries searchables rewrite original return queries combine queries public Explanation explain Weight weight int doc throws IOException protected Weight createWeight Query original throws IOException Query rewrittenQuery rewrite original Set terms new HashSet rewrittenQuery extractTerms terms Term allTermsArray new Term terms size terms toArray allTermsArray int aggregatedDfs new int terms size for int searchables length int dfs searchables docFreqs allTermsArray for int aggregatedDfs length aggregatedDfs dfs HashMap dfMap new HashMap for int allTermsArray length dfMap put allTermsArray new Integer aggregatedDfs int numDocs maxDoc CachedDfSource cacheSim new CachedDfSource dfMap numDocs getSimilarity return rewrittenQuery weight cacheSim public interface Searchable extends java rmi Remote void search Weight weight Filter filter HitCollector results throws IOException void close throws IOException int docFreq Term term throws IOException int docFreqs Term terms throws IOException int maxDoc throws IOException TopDocs search Weight weight Filter filter int throws IOException Document doc int throws CorruptIndexException IOException Document doc int FieldSelector fieldSelector throws CorruptIndexException IOException Query rewrite Query query throws IOException Explanation explain Weight weight int doc throws IOException TopFieldDocs search Weight weight Filter filter int Sort sort throws IOException public class MultiPhraseQuery extends Query private String field private ArrayList termArrays new ArrayList private Vector positions new Vector private int slop public void setSlop int slop public int getSlop return slop public void add Term term add new Term term public void add Term terms int position if positions size position Integer positions lastElement intValue add terms position public void add Term terms int position if termArrays size field terms field for int terms length if terms field field throw new IllegalArgumentException field terms termArrays add terms positions addElement new Integer position public List getTermArrays return Collections unmodifiableList termArrays public int getPositions int result new int positions size for int positions size result Integer positions elementAt intValue return result public void extractTerms Set terms for Iterator iter termArrays iterator iter hasNext Term arr Term iter next for int arr length terms add arr private class MultiPhraseWeight implements Weight private Similarity similarity private float value private float idf private float queryNorm private float queryWeight public MultiPhraseWeight Searcher searcher throws IOException this similarity getSimilarity searcher Iterator termArrays iterator while hasNext Term terms Term next for int terms length idf getSimilarity searcher idf terms searcher public Query getQuery return MultiPhraseQuery this public float getValue return value public float sumOfSquaredWeights public void normalize float queryNorm this queryNorm queryNorm public Scorer scorer IndexReader reader throws IOException return null TermPositions tps new TermPositions termArrays size for int tps length Term terms Term termArrays get TermPositions if terms length new MultipleTermPositions reader terms else reader termPositions terms if null return null tps if slop return new ExactPhraseScorer this tps getPositions similarity reader norms field else return new SloppyPhraseScorer this tps getPositions similarity slop reader norms field public Explanation explain IndexReader reader int doc throws IOException ComplexExplanation result new ComplexExplanation result setDescription getQuery doc Explanation idfExpl new Explanation idf getQuery Explanation queryExpl new Explanation queryExpl setDescription getQuery Explanation boostExpl new Explanation getBoost if getBoost queryExpl addDetail boostExpl queryExpl addDetail idfExpl Explanation queryNormExpl new Explanation queryNorm queryExpl addDetail queryNormExpl queryExpl setValue boostExpl getValue idfExpl getValue queryNormExpl getValue result addDetail queryExpl ComplexExplanation fieldExpl new ComplexExplanation fieldExpl setDescription getQuery doc Explanation tfExpl scorer reader explain doc fieldExpl addDetail tfExpl fieldExpl addDetail idfExpl Explanation fieldNormExpl new Explanation byte fieldNorms reader norms field float fieldNorm fieldNorms null Similarity decodeNorm fieldNorms doc fieldNormExpl setValue fieldNorm fieldNormExpl setDescription field doc fieldExpl addDetail fieldNormExpl fieldExpl setMatch Boolean valueOf tfExpl isMatch fieldExpl setValue tfExpl getValue idfExpl getValue fieldNormExpl getValue result addDetail fieldExpl result setMatch fieldExpl getMatch result setValue queryExpl getValue fieldExpl getValue if queryExpl getValue return fieldExpl return result public Query rewrite IndexReader reader Term terms Term termArrays get BooleanQuery boq new BooleanQuery true for int terms length boq add new TermQuery terms BooleanClause Occur SHOULD boq setBoost getBoost return boq else return this protected Weight createWeight Searcher searcher throws IOException return new MultiPhraseWeight searcher public final String toString String StringBuffer buffer new StringBuffer if field equals buffer append field buffer append buffer append Iterator termArrays iterator while hasNext Term terms Term next if terms length buffer append for int terms length buffer append terms text if terms length buffer append buffer append else buffer append terms text if hasNext buffer append buffer append if slop buffer append buffer append slop buffer append ToStringUtils boost getBoost return buffer toString public boolean equals Object if instanceof MultiPhraseQuery return false MultiPhraseQuery other MultiPhraseQuery return this getBoost other getBoost this slop other slop this termArrays equals other termArrays this positions equals other positions public int hashCode return Float floatToIntBits getBoost slop termArrays hashCode positions hashCode public abstract class IndexOutput public abstract void writeByte byte throws IOException public void writeBytes byte int length throws IOException writeBytes length public abstract void writeBytes byte int offset int length throws IOException public void writeInt int throws IOException writeByte byte writeByte byte writeByte byte writeByte byte public void writeVInt int throws IOException while writeByte byte writeByte byte public void writeLong long throws IOException writeInt int writeInt int public void writeVLong long throws IOException while writeByte byte writeByte byte public void writeString String throws IOException int length length writeVInt length writeChars length public void writeChars String int start int length throws IOException final int end start length for int start end final int code int charAt if code code writeByte byte code else if code code code writeByte byte code writeByte byte code else writeByte byte code writeByte byte code writeByte byte code public abstract void flush throws IOException public abstract void close throws IOException public abstract long getFilePointer public abstract void seek long pos throws IOException public abstract long length throws IOException public class WordlistLoader public static HashSet getWordSet File wordfile throws IOException HashSet result new HashSet FileReader reader null try reader new FileReader wordfile result getWordSet reader finally if reader null reader close return result public static HashSet getWordSet Reader reader throws IOException HashSet result new HashSet BufferedReader br null try if reader instanceof BufferedReader br BufferedReader reader else br new BufferedReader reader String word null while word br readLine null result add word trim finally if br null br close return result public static HashMap getStemDict File wordstemfile throws IOException if wordstemfile null throw new NullPointerException HashMap result new HashMap BufferedReader br null FileReader fr null try fr new FileReader wordstemfile br new BufferedReader fr String line while line br readLine null String wordstem line split result put wordstem wordstem finally if fr null fr close if br null br close return result public class TermSpans implements Spans protected TermPositions positions protected Term term protected int doc protected int freq protected int count protected int position public TermSpans TermPositions positions Term term throws IOException this positions positions this term term doc public boolean next throws IOException if count freq if positions next doc Integer MAX_VALUE return false doc positions doc freq positions freq count position positions nextPosition count return true public boolean skipTo int target throws IOException if doc target return true if positions skipTo target doc Integer MAX_VALUE return false doc positions doc freq positions freq count position positions nextPosition count return true public int doc return doc public int start return position public int end return position public String toString return term toString doc doc Integer MAX_VALUE doc position public TermPositions getPositions return positions public final class LowerCaseFilter extends TokenFilter public LowerCaseFilter TokenStream in super in public final Token next throws IOException Token input next if null return null termText termText toLowerCase return public class MultiReader extends IndexReader private IndexReader subReaders private Hashtable normsCache new Hashtable private int maxDoc private int numDocs private boolean hasDeletions false public MultiReader IndexReader subReaders throws IOException super subReaders length null subReaders directory initialize subReaders MultiReader Directory directory SegmentInfos sis boolean closeDirectory IndexReader subReaders super directory sis closeDirectory initialize subReaders private void initialize IndexReader subReaders this subReaders subReaders for int subReaders length starts maxDoc if subReaders hasDeletions hasDeletions true starts subReaders length maxDoc public TermFreqVector getTermFreqVectors int throws IOException ensureOpen public TermFreqVector getTermFreqVector int String field throws IOException ensureOpen return subReaders getTermFreqVector starts field public synchronized int numDocs for int subReaders length numDocs return numDocs public int maxDoc return maxDoc public Document document int FieldSelector fieldSelector throws CorruptIndexException IOException ensureOpen public boolean isDeleted int public boolean hasDeletions return hasDeletions protected void doDelete int throws CorruptIndexException IOException hasDeletions true protected void doUndeleteAll throws CorruptIndexException IOException for int subReaders length subReaders undeleteAll hasDeletions false while hi lo int mid lo hi int midValue starts mid if midValue hi mid else if midValue lo mid while mid subReaders length starts mid midValue return mid return hi public boolean hasNorms String field throws IOException ensureOpen for int subReaders length if subReaders hasNorms field return true return false private byte ones private byte fakeNorms if ones null ones SegmentReader createFakeNorms maxDoc return ones public synchronized byte norms String field throws IOException ensureOpen byte bytes byte normsCache get field if bytes null if hasNorms field return fakeNorms bytes new byte maxDoc for int subReaders length subReaders norms field bytes starts return bytes public synchronized void norms String field byte result int offset throws IOException ensureOpen byte bytes byte normsCache get field if bytes null hasNorms field bytes fakeNorms System arraycopy bytes result offset maxDoc subReaders norms field result offset starts protected void doSetNorm int String field byte value throws CorruptIndexException IOException public TermEnum terms throws IOException ensureOpen return new MultiTermEnum subReaders starts null public TermEnum terms Term term throws IOException ensureOpen return new MultiTermEnum subReaders starts term public int docFreq Term throws IOException ensureOpen for int subReaders length total subReaders docFreq return total public TermDocs termDocs throws IOException ensureOpen return new MultiTermDocs subReaders starts public TermPositions termPositions throws IOException ensureOpen return new MultiTermPositions subReaders starts protected void doCommit throws IOException for int subReaders length subReaders commit void startCommit super startCommit for int subReaders length subReaders startCommit void rollbackCommit super rollbackCommit for int subReaders length subReaders rollbackCommit protected synchronized void doClose throws IOException for int subReaders length subReaders close public Collection getFieldNames IndexReader FieldOption fieldNames ensureOpen Set fieldSet new HashSet for int subReaders length IndexReader reader subReaders Collection names reader getFieldNames fieldNames fieldSet addAll names return fieldSet class MultiTermEnum extends TermEnum private SegmentMergeQueue queue private Term term private int docFreq public MultiTermEnum IndexReader readers int starts Term throws IOException queue new SegmentMergeQueue readers length for int readers length IndexReader reader readers TermEnum termEnum if null termEnum reader terms else termEnum reader terms SegmentMergeInfo smi new SegmentMergeInfo starts termEnum reader if null smi next termEnum term null else smi close if null queue size next public boolean next throws IOException SegmentMergeInfo top SegmentMergeInfo queue top if top null term null return false term top term docFreq while top null term compareTo top term queue pop if top next else top SegmentMergeInfo queue top return true public Term term return term public int docFreq return docFreq public void close throws IOException queue close class MultiTermDocs implements TermDocs protected IndexReader readers protected int starts protected Term term protected int base protected int pointer private TermDocs readerTermDocs public MultiTermDocs IndexReader int readers starts readerTermDocs new TermDocs length public int doc return base current doc public int freq return current freq public void seek Term term this term term this base this pointer this current null public void seek TermEnum termEnum throws IOException seek termEnum term public boolean next throws IOException for if current null current next return true else if pointer readers length base starts pointer current termDocs pointer else return false public int read final int docs final int freqs throws IOException while true while current null base starts pointer current termDocs pointer else return int end current read docs freqs current null for int end docs return end public boolean skipTo int target throws IOException for if current null current skipTo target base return true else if pointer readers length base starts pointer current termDocs pointer else return false private TermDocs termDocs int throws IOException if term null return null TermDocs result readerTermDocs if result null result readerTermDocs termDocs readers result seek term return result protected TermDocs termDocs IndexReader reader throws IOException return reader termDocs public void close throws IOException for int readerTermDocs length if readerTermDocs null readerTermDocs close class MultiTermPositions extends MultiTermDocs implements TermPositions public MultiTermPositions IndexReader int super protected TermDocs termDocs IndexReader reader throws IOException return TermDocs reader termPositions public int nextPosition throws IOException return TermPositions current nextPosition public int getPayloadLength return TermPositions current getPayloadLength public byte getPayload byte data int offset throws IOException return TermPositions current getPayload data offset public boolean isPayloadAvailable return TermPositions current isPayloadAvailable public class SpanScorer extends Scorer protected Spans spans protected Weight weight protected byte norms protected float value protected boolean firstTime true protected boolean more true protected int doc protected float freq protected SpanScorer Spans spans Weight weight Similarity similarity byte norms throws IOException super similarity this spans spans this norms norms this weight weight this value weight getValue doc public boolean next throws IOException if firstTime more spans next firstTime false return setFreqCurrentDoc public boolean skipTo int target throws IOException if firstTime more spans skipTo target firstTime false if more return false more spans skipTo target return setFreqCurrentDoc protected boolean setFreqCurrentDoc throws IOException if more return false doc spans doc freq while more doc spans doc int matchLength spans end spans start freq getSimilarity sloppyFreq matchLength more spans next return more freq public int doc return doc public float score throws IOException public Explanation explain final int doc throws IOException Explanation tfExplanation new Explanation skipTo doc float phraseFreq doc doc freq tfExplanation setValue getSimilarity tf phraseFreq tfExplanation setDescription phraseFreq return tfExplanation public class SpanNearQuery extends SpanQuery private List clauses private int slop private boolean inOrder private String field public SpanNearQuery SpanQuery clauses int slop boolean inOrder this clauses new ArrayList clauses length for int clauses length SpanQuery clause clauses field clause getField else if clause getField equals field throw new IllegalArgumentException this clauses add clause this slop slop this inOrder inOrder public SpanQuery getClauses return SpanQuery clauses toArray new SpanQuery clauses size public int getSlop return slop public boolean isInOrder return inOrder public String getField return field public Collection getTerms Collection terms new ArrayList Iterator clauses iterator while hasNext SpanQuery clause SpanQuery next terms addAll clause getTerms return terms public void extractTerms Set terms Iterator clauses iterator while hasNext SpanQuery clause SpanQuery next clause extractTerms terms public String toString String field StringBuffer buffer new StringBuffer buffer append Iterator clauses iterator while hasNext SpanQuery clause SpanQuery next buffer append clause toString field if hasNext buffer append buffer append buffer append slop buffer append buffer append inOrder buffer append buffer append ToStringUtils boost getBoost return buffer toString public Spans getSpans final IndexReader reader throws IOException return new SpanOrQuery getClauses getSpans reader return SpanQuery clauses get getSpans reader return inOrder Spans new NearSpansOrdered this reader Spans new NearSpansUnordered this reader public Query rewrite IndexReader reader throws IOException SpanNearQuery clone null for int clauses size SpanQuery SpanQuery clauses get SpanQuery query SpanQuery rewrite reader if clone null clone SpanNearQuery this clone clone clauses set query if clone null else public boolean equals Object if this return true if instanceof SpanNearQuery return false final SpanNearQuery spanNearQuery SpanNearQuery if inOrder spanNearQuery inOrder return false if slop spanNearQuery slop return false if clauses equals spanNearQuery clauses return false return getBoost spanNearQuery getBoost public int hashCode int result result clauses hashCode result Float floatToRawIntBits getBoost result slop result inOrder return result public final class Document implements java io Serializable List fields new Vector private float boost public Document public void setBoost float boost this boost boost public float getBoost return boost public final void add Fieldable field fields add field public final void removeField String name Iterator it fields iterator while it hasNext Fieldable field Fieldable it next if field name equals name it remove return public final void removeFields String name Iterator it fields iterator while it hasNext Fieldable field Fieldable it next if field name equals name it remove public final Field getField String name for int fields size Field field Field fields get if field name equals name return field return null public Fieldable getFieldable String name for int fields size Fieldable field Fieldable fields get if field name equals name return field return null public final String get String name for int fields size Fieldable field Fieldable fields get if field name equals name field isBinary return field stringValue return null public final Enumeration fields return Vector fields elements public final List getFields return fields public final Field getFields String name List result new ArrayList for int fields size Field field Field fields get if field name equals name result add field if result size return null return Field result toArray new Field result size public Fieldable getFieldables String name List result new ArrayList for int fields size Fieldable field Fieldable fields get if field name equals name result add field if result size return null return Fieldable result toArray new Fieldable result size public final String getValues String name List result new ArrayList for int fields size Fieldable field Fieldable fields get if field name equals name field isBinary result add field stringValue if result size return null return String result toArray new String result size public final byte getBinaryValues String name List result new ArrayList for int fields size Fieldable field Fieldable fields get if field name equals name field isBinary result add field binaryValue if result size return null return byte result toArray new byte result size public final byte getBinaryValue String name for int fields size Fieldable field Fieldable fields get if field name equals name field isBinary return field binaryValue return null public final String toString StringBuffer buffer new StringBuffer buffer append for int fields size Fieldable field Fieldable fields get buffer append field toString if fields size buffer append buffer append return buffer toString public interface CharStream char readChar throws java io IOException int getColumn int getLine int getEndColumn int getEndLine int getBeginColumn int getBeginLine void backup int amount char BeginToken throws java io IOException String GetImage char GetSuffix int len void Done final class PhrasePositions PhrasePositions TermPositions int tp offset if tp next return false doc tp doc position return true final boolean skipTo int target throws IOException if tp skipTo target return false doc tp doc position return true final void firstPosition throws IOException nextPosition final boolean nextPosition throws IOException position tp nextPosition offset return true else return false final class SloppyPhraseScorer extends PhraseScorer private int slop private PhrasePositions repeats private boolean checkedRepeats SloppyPhraseScorer Weight weight TermPositions tps int offsets Similarity similarity int slop byte norms super weight tps offsets similarity norms this slop slop protected final float phraseFreq throws IOException int end initPhrasePositions float freq boolean done end while done PhrasePositions pp PhrasePositions pq pop int start pp position int next PhrasePositions pq top position boolean tpsDiffer true for int pos start pos next tpsDiffer pos pp position if pos next tpsDiffer if pp nextPosition break tpsDiffer pp repeats termPositionsDiffer pp int matchLength end start if matchLength slop if pp position end end pp position return freq private int initPhrasePositions throws IOException int end if checkedRepeats repeats null pq clear for PhrasePositions pp first pp null pp pp next pp firstPosition if pp position end end pp position return end for PhrasePositions pp first pp null pp pp next pp firstPosition if checkedRepeats checkedRepeats true HashMap null for PhrasePositions pp first pp null pp pp next int tpPos pp position pp offset for PhrasePositions pp2 pp next pp2 null pp2 pp2 next int tpPos2 pp2 position pp2 offset if tpPos2 tpPos if null new HashMap pp repeats true pp2 repeats true put pp null put pp2 null if null repeats PhrasePositions keySet toArray new PhrasePositions if repeats null Arrays sort repeats new Comparator public int compare Object Object return PhrasePositions offset PhrasePositions offset for int repeats length PhrasePositions pp repeats while termPositionsDiffer pp if pp nextPosition pq clear for PhrasePositions pp first pp null pp pp next if pp position end end pp position return end private boolean termPositionsDiffer PhrasePositions pp int tpPos pp position pp offset for int repeats length PhrasePositions pp2 repeats if pp2 pp continue int tpPos2 pp2 position pp2 offset if tpPos2 tpPos return false return true final class FieldInfos static final byte IS_INDEXED static final byte STORE_TERMVECTOR static final byte STORE_POSITIONS_WITH_TERMVECTOR static final byte STORE_OFFSET_WITH_TERMVECTOR static final byte OMIT_NORMS static final byte STORE_PAYLOADS private ArrayList byNumber new ArrayList private HashMap byName new HashMap FieldInfos FieldInfos Directory String name throws IOException IndexInput input openInput name try read input finally input close public void add Document doc List fields doc getFields Iterator fieldIterator fields iterator while fieldIterator hasNext Fieldable field Fieldable fieldIterator next add field name field isIndexed field isTermVectorStored field isStorePositionWithTermVector field isStoreOffsetWithTermVector field getOmitNorms public void addIndexed Collection names boolean storeTermVectors boolean storePositionWithTermVector boolean storeOffsetWithTermVector Iterator names iterator while hasNext add String next true storeTermVectors storePositionWithTermVector storeOffsetWithTermVector public void add Collection names boolean isIndexed Iterator names iterator while hasNext add String next isIndexed public void add String name boolean isIndexed add name isIndexed false false false false public void add String name boolean isIndexed boolean storeTermVector add name isIndexed storeTermVector false false false public void add String name boolean isIndexed boolean storeTermVector boolean storePositionWithTermVector boolean storeOffsetWithTermVector add name isIndexed storeTermVector storePositionWithTermVector storeOffsetWithTermVector false public void add String name boolean isIndexed boolean storeTermVector boolean storePositionWithTermVector boolean storeOffsetWithTermVector boolean omitNorms add name isIndexed storeTermVector storePositionWithTermVector storeOffsetWithTermVector omitNorms false public FieldInfo add String name boolean isIndexed boolean storeTermVector boolean storePositionWithTermVector boolean storeOffsetWithTermVector boolean omitNorms boolean storePayloads FieldInfo fi fieldInfo name if fi null return addInternal name isIndexed storeTermVector storePositionWithTermVector storeOffsetWithTermVector omitNorms storePayloads else if fi isIndexed isIndexed if fi storeTermVector storeTermVector if fi storePositionWithTermVector storePositionWithTermVector if fi storeOffsetWithTermVector storeOffsetWithTermVector if fi omitNorms omitNorms if fi storePayloads storePayloads fi storePayloads true return fi private FieldInfo addInternal String name boolean isIndexed boolean storeTermVector boolean storePositionWithTermVector boolean storeOffsetWithTermVector boolean omitNorms boolean storePayloads FieldInfo fi new FieldInfo name isIndexed byNumber size storeTermVector storePositionWithTermVector storeOffsetWithTermVector omitNorms storePayloads byNumber add fi byName put name fi return fi public int fieldNumber String fieldName try FieldInfo fi fieldInfo fieldName if fi null return fi number catch IndexOutOfBoundsException ioobe return return public FieldInfo fieldInfo String fieldName return FieldInfo byName get fieldName public String fieldName int fieldNumber try return fieldInfo fieldNumber name catch NullPointerException npe return public FieldInfo fieldInfo int fieldNumber try return FieldInfo byNumber get fieldNumber catch IndexOutOfBoundsException ioobe return null public int size return byNumber size public boolean hasVectors boolean hasVectors false for int size if fieldInfo storeTermVector hasVectors true break return hasVectors public void write Directory String name throws IOException IndexOutput output createOutput name try write output finally output close public void write IndexOutput output throws IOException output writeVInt size for int size FieldInfo fi fieldInfo byte bits if fi isIndexed bits IS_INDEXED if fi storeTermVector bits STORE_TERMVECTOR if fi storePositionWithTermVector bits STORE_POSITIONS_WITH_TERMVECTOR if fi storeOffsetWithTermVector bits STORE_OFFSET_WITH_TERMVECTOR if fi omitNorms bits OMIT_NORMS if fi storePayloads bits STORE_PAYLOADS output writeString fi name output writeByte bits private void read IndexInput input throws IOException for int size String name input readString intern byte bits input readByte boolean isIndexed bits IS_INDEXED boolean storeTermVector bits STORE_TERMVECTOR boolean storePositionsWithTermVector bits STORE_POSITIONS_WITH_TERMVECTOR boolean storeOffsetWithTermVector bits STORE_OFFSET_WITH_TERMVECTOR boolean omitNorms bits OMIT_NORMS boolean storePayloads bits STORE_PAYLOADS addInternal name isIndexed storeTermVector storePositionsWithTermVector storeOffsetWithTermVector omitNorms storePayloads public interface FieldSelector extends Serializable FieldSelectorResult accept String fieldName final class CompoundFileWriter private static final class FileEntry String file long directoryOffset long dataOffset private Directory directory private String fileName private HashSet ids private LinkedList entries private boolean merged false public CompoundFileWriter Directory dir String name if dir null throw new NullPointerException if name null throw new NullPointerException directory dir fileName name ids new HashSet entries new LinkedList public Directory getDirectory return directory public String getName return fileName public void addFile String file if merged throw new IllegalStateException if file null throw new NullPointerException if ids add file throw new IllegalArgumentException file FileEntry entry new FileEntry entry file file entries add entry public void close throws IOException if merged throw new IllegalStateException if entries isEmpty throw new IllegalStateException merged true IndexOutput os null try os directory createOutput fileName os writeVInt entries size Iterator it entries iterator while it hasNext FileEntry fe FileEntry it next fe directoryOffset os getFilePointer os writeString fe file byte buffer new byte it entries iterator while it hasNext FileEntry fe FileEntry it next fe dataOffset os getFilePointer copyFile fe os buffer it entries iterator while it hasNext FileEntry fe FileEntry it next os seek fe directoryOffset os writeLong fe dataOffset IndexOutput tmp os os null tmp close finally if os null try os close catch IOException private void copyFile FileEntry source IndexOutput os byte buffer throws IOException IndexInput is null try long startPtr os getFilePointer is directory openInput source file long length is length long remainder length int chunk buffer length while remainder int len int Math min chunk remainder is readBytes buffer len os writeBytes buffer len remainder len if remainder throw new IOException remainder source file length chunk long endPtr os getFilePointer long diff endPtr startPtr if diff length throw new IOException diff length finally if is null is close public class PrefixFilter extends Filter protected final Term prefix public PrefixFilter Term prefix this prefix prefix public Term getPrefix return prefix public BitSet bits IndexReader reader throws IOException final BitSet bitSet new BitSet reader maxDoc new PrefixGenerator prefix public void handleDoc int doc bitSet set doc generate reader return bitSet public String toString StringBuffer buffer new StringBuffer buffer append buffer append prefix toString buffer append return buffer toString interface IdGenerator public void generate IndexReader reader throws IOException public void handleDoc int doc abstract class PrefixGenerator implements IdGenerator protected final Term prefix PrefixGenerator Term prefix this prefix prefix public void generate IndexReader reader throws IOException TermEnum enumerator reader terms prefix TermDocs termDocs reader termDocs try String prefixText prefix text String prefixField prefix field do Term term enumerator term if term null term text startsWith prefixText termDocs seek term while termDocs next handleDoc termDocs doc else break while enumerator next finally termDocs close enumerator close final class TermVectorsWriter static final byte STORE_POSITIONS_WITH_TERMVECTOR static final byte STORE_OFFSET_WITH_TERMVECTOR static final int FORMAT_VERSION static final int FORMAT_SIZE static final String TVX_EXTENSION static final String TVD_EXTENSION static final String TVF_EXTENSION private IndexOutput tvx null tvd null tvf null private Vector fields null private Vector terms null private FieldInfos fieldInfos private TVField currentField null private long currentDocPointer public TermVectorsWriter Directory directory String segment FieldInfos fieldInfos throws IOException tvx directory createOutput segment TVX_EXTENSION tvx writeInt FORMAT_VERSION tvd directory createOutput segment TVD_EXTENSION tvd writeInt FORMAT_VERSION tvf directory createOutput segment TVF_EXTENSION tvf writeInt FORMAT_VERSION this fieldInfos fieldInfos fields new Vector fieldInfos size terms new Vector public final void openDocument throws IOException closeDocument currentDocPointer tvd getFilePointer public final void closeDocument throws IOException if isDocumentOpen closeField writeDoc fields clear currentDocPointer public final boolean isDocumentOpen return currentDocPointer public final void openField String field throws IOException FieldInfo fieldInfo fieldInfos fieldInfo field openField fieldInfo number fieldInfo storePositionWithTermVector fieldInfo storeOffsetWithTermVector private void openField int fieldNumber boolean storePositionWithTermVector boolean storeOffsetWithTermVector throws IOException if isDocumentOpen throw new IllegalStateException closeField currentField new TVField fieldNumber storePositionWithTermVector storeOffsetWithTermVector public final void closeField throws IOException if isFieldOpen writeField fields add currentField terms clear currentField null public final boolean isFieldOpen return currentField null public final void addTerm String termText int freq addTerm termText freq null null public final void addTerm String termText int freq int positions TermVectorOffsetInfo offsets if isDocumentOpen throw new IllegalStateException if isFieldOpen throw new IllegalStateException addTermInternal termText freq positions offsets private final void addTermInternal String termText int freq int positions TermVectorOffsetInfo offsets TVTerm term new TVTerm term termText termText term freq freq term positions positions term offsets offsets terms add term public final void addAllDocVectors TermFreqVector vectors throws IOException openDocument if vectors null for int vectors length boolean storePositionWithTermVector false boolean storeOffsetWithTermVector false try TermPositionVector tpVector TermPositionVector vectors if tpVector size tpVector getTermPositions null storePositionWithTermVector true if tpVector size tpVector getOffsets null storeOffsetWithTermVector true FieldInfo fieldInfo fieldInfos fieldInfo tpVector getField openField fieldInfo number storePositionWithTermVector storeOffsetWithTermVector for int tpVector size addTermInternal tpVector getTerms tpVector getTermFrequencies tpVector getTermPositions tpVector getOffsets closeField catch ClassCastException ignore TermFreqVector tfVector vectors FieldInfo fieldInfo fieldInfos fieldInfo tfVector getField openField fieldInfo number storePositionWithTermVector storeOffsetWithTermVector for int tfVector size addTermInternal tfVector getTerms tfVector getTermFrequencies null null closeField closeDocument final void close throws IOException try closeDocument finally IOException keep null if tvx null try tvx close catch IOException if keep null keep if tvd null try tvd close catch IOException if keep null keep if tvf null try tvf close catch IOException if keep null keep if keep null throw IOException keep fillInStackTrace private void writeField throws IOException currentField tvfPointer tvf getFilePointer final int size terms size tvf writeVInt size boolean storePositions currentField storePositions boolean storeOffsets currentField storeOffsets byte bits if storePositions bits STORE_POSITIONS_WITH_TERMVECTOR if storeOffsets bits STORE_OFFSET_WITH_TERMVECTOR tvf writeByte bits String lastTermText for int size TVTerm term TVTerm terms elementAt int start StringHelper stringDifference lastTermText term termText int length term termText length start tvf writeVInt term freq lastTermText term termText if storePositions if term positions null throw new IllegalStateException int position for int term freq tvf writeVInt term positions position position term positions if storeOffsets if term offsets null throw new IllegalStateException int position for int term freq tvf writeVInt term offsets getStartOffset position position term offsets getEndOffset private void writeDoc throws IOException if isFieldOpen throw new IllegalStateException tvx writeLong currentDocPointer final int size fields size tvd writeVInt size for int size TVField field TVField fields elementAt tvd writeVInt field number long lastFieldPointer for int size TVField field TVField fields elementAt tvd writeVLong field tvfPointer lastFieldPointer lastFieldPointer field tvfPointer private static class TVField int number long tvfPointer boolean storePositions false boolean storeOffsets false TVField int number boolean storePos boolean storeOff this number number storePositions storePos storeOffsets storeOff private static class TVTerm String termText int freq int positions null TermVectorOffsetInfo offsets null public class FieldScoreQuery extends ValueSourceQuery public static class Type public static final Type BYTE new Type public static final Type SHORT new Type public static final Type INT new Type public static final Type FLOAT new Type private String typeName private Type String name this typeName name public String toString return getClass getName typeName public FieldScoreQuery String field Type type super getValueSource field type private static ValueSource getValueSource String field Type type if type Type BYTE return new ByteFieldSource field if type Type SHORT return new ShortFieldSource field if type Type INT return new IntFieldSource field if type Type FLOAT return new FloatFieldSource field throw new IllegalArgumentException type final class FieldsReader private final FieldInfos fieldInfos private final IndexInput cloneableFieldsStream private final IndexInput fieldsStream private final IndexInput indexStream private int size private boolean closed private ThreadLocal fieldsStreamTL new ThreadLocal FieldsReader Directory String segment FieldInfos fn throws IOException this segment fn BufferedIndexInput BUFFER_SIZE FieldsReader Directory String segment FieldInfos fn int readBufferSize throws IOException fieldInfos fn cloneableFieldsStream openInput segment readBufferSize fieldsStream IndexInput cloneableFieldsStream clone indexStream openInput segment readBufferSize size int indexStream length protected final void ensureOpen throws AlreadyClosedException if closed throw new AlreadyClosedException final void close throws IOException if closed fieldsStream close cloneableFieldsStream close indexStream close IndexInput localFieldsStream IndexInput fieldsStreamTL get if localFieldsStream null localFieldsStream close fieldsStreamTL set null closed true final int size return size final Document doc int FieldSelector fieldSelector throws CorruptIndexException IOException indexStream seek long position indexStream readLong fieldsStream seek position Document doc new Document int numFields fieldsStream readVInt for int numFields int fieldNumber fieldsStream readVInt FieldInfo fi fieldInfos fieldInfo fieldNumber FieldSelectorResult acceptField fieldSelector null FieldSelectorResult LOAD fieldSelector accept fi name byte bits fieldsStream readByte boolean compressed bits FieldsWriter FIELD_IS_COMPRESSED boolean tokenize bits FieldsWriter FIELD_IS_TOKENIZED boolean binary bits FieldsWriter FIELD_IS_BINARY if acceptField equals FieldSelectorResult LOAD addField doc fi binary compressed tokenize else if acceptField equals FieldSelectorResult LOAD_FOR_MERGE addFieldForMerge doc fi binary compressed tokenize else if acceptField equals FieldSelectorResult LOAD_AND_BREAK addField doc fi binary compressed tokenize else if acceptField equals FieldSelectorResult LAZY_LOAD addFieldLazy doc fi binary compressed tokenize else if acceptField equals FieldSelectorResult SIZE skipField binary compressed addFieldSize doc fi binary compressed else if acceptField equals FieldSelectorResult SIZE_AND_BREAK addFieldSize doc fi binary compressed break else skipField binary compressed return doc private void skipField boolean binary boolean compressed throws IOException skipField binary compressed fieldsStream readVInt private void skipField boolean binary boolean compressed int toRead throws IOException if binary compressed long pointer fieldsStream getFilePointer fieldsStream seek pointer toRead else fieldsStream skipChars toRead private void addFieldLazy Document doc FieldInfo fi boolean binary boolean compressed boolean tokenize throws IOException if binary true int toRead fieldsStream readVInt long pointer fieldsStream getFilePointer if compressed doc add new LazyField fi name Field Store COMPRESS toRead pointer else doc add new LazyField fi name Field Store YES toRead pointer fieldsStream seek pointer toRead else Field Store store Field Store YES Field Index index getIndexType fi tokenize Field TermVector termVector getTermVectorType fi Fieldable if compressed store Field Store COMPRESS int toRead fieldsStream readVInt long pointer fieldsStream getFilePointer new LazyField fi name store toRead pointer fieldsStream seek pointer toRead setOmitNorms fi omitNorms else int length fieldsStream readVInt long pointer fieldsStream getFilePointer fieldsStream skipChars length new LazyField fi name store index termVector length pointer setOmitNorms fi omitNorms doc add private void addFieldForMerge Document doc FieldInfo fi boolean binary boolean compressed boolean tokenize throws IOException Object data if binary compressed int toRead fieldsStream readVInt final byte new byte toRead fieldsStream readBytes length data else data fieldsStream readString doc add new FieldForMerge data fi binary compressed tokenize private void addField Document doc FieldInfo fi boolean binary boolean compressed boolean tokenize throws CorruptIndexException IOException if binary int toRead fieldsStream readVInt final byte new byte toRead fieldsStream readBytes length if compressed doc add new Field fi name uncompress Field Store COMPRESS else doc add new Field fi name Field Store YES else Field Store store Field Store YES Field Index index getIndexType fi tokenize Field TermVector termVector getTermVectorType fi Fieldable if compressed store Field Store COMPRESS int toRead fieldsStream readVInt final byte new byte toRead fieldsStream readBytes length store index termVector setOmitNorms fi omitNorms else store index termVector setOmitNorms fi omitNorms doc add private int addFieldSize Document doc FieldInfo fi boolean binary boolean compressed throws IOException int size fieldsStream readVInt bytesize binary compressed size size byte sizebytes new byte sizebytes byte bytesize sizebytes byte bytesize sizebytes byte bytesize sizebytes byte bytesize doc add new Field fi name sizebytes Field Store YES return size private Field TermVector getTermVectorType FieldInfo fi Field TermVector termVector null if fi storeTermVector if fi storeOffsetWithTermVector if fi storePositionWithTermVector termVector Field TermVector WITH_POSITIONS_OFFSETS else termVector Field TermVector WITH_OFFSETS else if fi storePositionWithTermVector termVector Field TermVector WITH_POSITIONS else termVector Field TermVector YES else termVector Field TermVector NO return termVector private Field Index getIndexType FieldInfo fi boolean tokenize Field Index index if fi isIndexed tokenize index Field Index TOKENIZED else if fi isIndexed tokenize index Field Index UN_TOKENIZED else index Field Index NO return index private class LazyField extends AbstractField implements Fieldable private int toRead private long pointer public LazyField String name Field Store store int toRead long pointer super name store Field Index NO Field TermVector NO this toRead toRead this pointer pointer lazy true public LazyField String name Field Store store Field Index index Field TermVector termVector int toRead long pointer super name store index termVector this toRead toRead this pointer pointer lazy true private IndexInput getFieldStream IndexInput localFieldsStream IndexInput fieldsStreamTL get if localFieldsStream null localFieldsStream IndexInput cloneableFieldsStream clone fieldsStreamTL set localFieldsStream return localFieldsStream public byte binaryValue ensureOpen if fieldsData null final byte new byte toRead IndexInput localFieldsStream getFieldStream try localFieldsStream seek pointer localFieldsStream readBytes length if isCompressed true fieldsData uncompress else fieldsData catch IOException throw new FieldReaderException return fieldsData instanceof byte byte fieldsData null public Reader readerValue ensureOpen return fieldsData instanceof Reader Reader fieldsData null public TokenStream tokenStreamValue ensureOpen return fieldsData instanceof TokenStream TokenStream fieldsData null public String stringValue ensureOpen if fieldsData null IndexInput localFieldsStream getFieldStream try localFieldsStream seek pointer if isCompressed final byte new byte toRead localFieldsStream readBytes length fieldsData new String uncompress else char chars new char toRead localFieldsStream readChars chars toRead fieldsData new String chars catch IOException throw new FieldReaderException return fieldsData instanceof String String fieldsData null public long getPointer ensureOpen return pointer public void setPointer long pointer ensureOpen this pointer pointer public int getToRead ensureOpen return toRead public void setToRead int toRead ensureOpen this toRead toRead private final byte uncompress final byte input throws CorruptIndexException IOException Inflater decompressor new Inflater decompressor setInput input ByteArrayOutputStream bos new ByteArrayOutputStream input length byte buf new byte while decompressor finished try int count decompressor inflate buf bos write buf count catch DataFormatException CorruptIndexException newException new CorruptIndexException toString newException initCause throw newException decompressor end return bos toByteArray final static class FieldForMerge extends AbstractField public String stringValue return String this fieldsData public Reader readerValue return null public byte binaryValue return byte this fieldsData public TokenStream tokenStreamValue return null public FieldForMerge Object value FieldInfo fi boolean binary boolean compressed boolean tokenize this isStored true this fieldsData value this isCompressed compressed this isBinary binary this isTokenized tokenize this name fi name intern this isIndexed fi isIndexed this omitNorms fi omitNorms this storeOffsetWithTermVector fi storeOffsetWithTermVector this storePositionWithTermVector fi storePositionWithTermVector this storeTermVector fi storeTermVector public abstract class PriorityQueue private Object heap private int size private int maxSize protected abstract boolean lessThan Object Object protected final void initialize int maxSize size int heapSize maxSize heap new Object heapSize this maxSize maxSize public final void put Object element size heap size element upHeap public boolean insert Object element if size maxSize put element return true else if size lessThan element top heap element adjustTop return true else return false public final Object top if size return heap else return null public final Object pop if size size return result else return null public final void adjustTop downHeap public final int size return size public final void clear for int size heap null size private final void upHeap int size int while lessThan node heap private final void downHeap int int if size lessThan heap heap while size lessThan heap node if size lessThan heap heap public abstract class Query implements java io Serializable Cloneable public void setBoost float boost public float getBoost return boost public abstract String toString String field public String toString return toString protected Weight createWeight Searcher searcher throws IOException throw new UnsupportedOperationException public Weight weight Searcher searcher throws IOException Query query searcher rewrite this Weight weight query createWeight searcher float sum weight sumOfSquaredWeights float norm getSimilarity searcher queryNorm sum weight normalize norm return weight public Query rewrite IndexReader reader throws IOException return this public Query combine Query queries HashSet uniques new HashSet for int queries length Query query queries BooleanClause clauses null boolean splittable query instanceof BooleanQuery if splittable BooleanQuery bq BooleanQuery query splittable bq isCoordDisabled clauses bq getClauses for int splittable clauses length splittable clauses getOccur BooleanClause Occur SHOULD if splittable for int clauses length uniques add clauses getQuery else uniques add query if uniques size return Query uniques iterator next Iterator it uniques iterator BooleanQuery result new BooleanQuery true while it hasNext result add Query it next BooleanClause Occur SHOULD return result public void extractTerms Set terms throw new UnsupportedOperationException public static Query mergeBooleanQueries Query queries HashSet allClauses new HashSet for int queries length BooleanClause clauses BooleanQuery queries getClauses for int clauses length allClauses add clauses boolean coordDisabled queries length false BooleanQuery queries isCoordDisabled BooleanQuery result new BooleanQuery coordDisabled Iterator allClauses iterator while hasNext result add BooleanClause next return result public Similarity getSimilarity Searcher searcher return searcher getSimilarity public Object clone try return Query super clone catch CloneNotSupportedException throw new RuntimeException getMessage public class MultipleTermPositions implements TermPositions private static final class TermPositionsQueue extends PriorityQueue TermPositionsQueue List termPositions throws IOException initialize termPositions size Iterator termPositions iterator while hasNext TermPositions tp TermPositions next if tp next put tp final TermPositions peek return TermPositions top public final boolean lessThan Object Object return TermPositions doc TermPositions doc private static final class IntQueue private int private int private int private int new int final void add int if growArray final int next return final void sort Arrays sort final void clear final int size return private void growArray int newArray new int System arraycopy newArray newArray private int private int private TermPositionsQueue private IntQueue public MultipleTermPositions IndexReader indexReader Term terms throws IOException List termPositions new LinkedList for int terms length termPositions add indexReader termPositions terms new TermPositionsQueue termPositions new IntQueue public final boolean next throws IOException if size return false clear peek doc TermPositions tp do tp peek for int tp freq add tp nextPosition if tp next adjustTop else pop tp close while size peek doc sort size return true public final int nextPosition return next public final boolean skipTo int target throws IOException while peek null target peek doc TermPositions tp TermPositions pop if tp skipTo target put tp else tp close return next public final int doc return public final int freq return public final void close throws IOException while size TermPositions pop close public void seek Term arg0 throws IOException throw new UnsupportedOperationException public void seek TermEnum termEnum throws IOException throw new UnsupportedOperationException public int read int arg0 int arg1 throws IOException throw new UnsupportedOperationException public int getPayloadLength throw new UnsupportedOperationException public byte getPayload byte data int offset throws IOException throw new UnsupportedOperationException public boolean isPayloadAvailable return false public class QueryParser implements QueryParserConstants private static final int CONJ_NONE private static final int CONJ_AND private static final int CONJ_OR private static final int MOD_NONE private static final int MOD_NOT private static final int MOD_REQ public static final Operator AND_OPERATOR Operator AND public static final Operator OR_OPERATOR Operator OR private Operator operator OR_OPERATOR boolean lowercaseExpandedTerms true boolean useOldRangeQuery false boolean allowLeadingWildcard false Analyzer analyzer String field int phraseSlop float fuzzyMinSim FuzzyQuery defaultMinSimilarity int fuzzyPrefixLength FuzzyQuery defaultPrefixLength Locale locale Locale getDefault DateTools Resolution dateResolution null Map fieldToDateResolution null static public final class Operator extends Parameter private Operator String name super name static public final Operator OR new Operator static public final Operator AND new Operator public QueryParser String Analyzer this new FastCharStream new StringReader analyzer field public Query parse String query throws ParseException ReInit new FastCharStream new StringReader query try return TopLevelQuery field catch ParseException tme throw new ParseException query tme getMessage catch TokenMgrError tme throw new ParseException query tme getMessage catch BooleanQuery TooManyClauses tmc throw new ParseException query public Analyzer getAnalyzer return analyzer public String getField return field public float getFuzzyMinSim return fuzzyMinSim public void setFuzzyMinSim float fuzzyMinSim this fuzzyMinSim fuzzyMinSim public int getFuzzyPrefixLength return fuzzyPrefixLength public void setFuzzyPrefixLength int fuzzyPrefixLength this fuzzyPrefixLength fuzzyPrefixLength public void setPhraseSlop int phraseSlop this phraseSlop phraseSlop public int getPhraseSlop return phraseSlop public void setAllowLeadingWildcard boolean allowLeadingWildcard this allowLeadingWildcard allowLeadingWildcard public boolean getAllowLeadingWildcard return allowLeadingWildcard public void setDefaultOperator Operator op this operator op public Operator getDefaultOperator return operator public void setLowercaseExpandedTerms boolean lowercaseExpandedTerms this lowercaseExpandedTerms lowercaseExpandedTerms public boolean getLowercaseExpandedTerms return lowercaseExpandedTerms public void setUseOldRangeQuery boolean useOldRangeQuery this useOldRangeQuery useOldRangeQuery public boolean getUseOldRangeQuery return useOldRangeQuery public void setLocale Locale locale this locale locale public Locale getLocale return locale public void setDateResolution DateTools Resolution dateResolution this dateResolution dateResolution public void setDateResolution String fieldName DateTools Resolution dateResolution if fieldName null throw new IllegalArgumentException if fieldToDateResolution null fieldToDateResolution new HashMap fieldToDateResolution put fieldName dateResolution public DateTools Resolution getDateResolution String fieldName if fieldName null throw new IllegalArgumentException if fieldToDateResolution null return this dateResolution DateTools Resolution resolution DateTools Resolution fieldToDateResolution get fieldName if resolution null resolution this dateResolution return resolution protected void addClause Vector clauses int conj int mods Query boolean required prohibited if clauses size conj CONJ_AND BooleanClause BooleanClause clauses elementAt clauses size if isProhibited setOccur BooleanClause Occur MUST if clauses size operator AND_OPERATOR conj CONJ_OR BooleanClause BooleanClause clauses elementAt clauses size if isProhibited setOccur BooleanClause Occur SHOULD if null return if operator OR_OPERATOR prohibited mods MOD_NOT required mods MOD_REQ if conj CONJ_AND prohibited required true else prohibited mods MOD_NOT required prohibited conj CONJ_OR if required prohibited clauses addElement new BooleanClause BooleanClause Occur MUST else if required prohibited clauses addElement new BooleanClause BooleanClause Occur SHOULD else if required prohibited clauses addElement new BooleanClause BooleanClause Occur MUST_NOT else throw new RuntimeException protected Query getFieldQuery String field String queryText throws ParseException TokenStream source analyzer tokenStream field new StringReader queryText Vector new Vector org apache lucene analysis Token int positionCount boolean severalTokensAtSamePosition false while true try source next catch IOException null if null break addElement if getPositionIncrement positionCount getPositionIncrement else severalTokensAtSamePosition true try source close catch IOException if size return null else if size org apache lucene analysis Token elementAt return new TermQuery new Term field termText else if severalTokensAtSamePosition if positionCount BooleanQuery new BooleanQuery true for int size org apache lucene analysis Token elementAt TermQuery currentQuery new TermQuery new Term field termText add currentQuery BooleanClause Occur SHOULD return else MultiPhraseQuery mpq new MultiPhraseQuery mpq setSlop phraseSlop List multiTerms new ArrayList for int size org apache lucene analysis Token elementAt if getPositionIncrement multiTerms size mpq add Term multiTerms toArray new Term multiTerms clear multiTerms add new Term field termText mpq add Term multiTerms toArray new Term return mpq else PhraseQuery new PhraseQuery setSlop phraseSlop for int size add new Term field org apache lucene analysis Token elementAt termText return protected Query getFieldQuery String field String queryText int slop throws ParseException Query query getFieldQuery field queryText if query instanceof PhraseQuery PhraseQuery query setSlop slop if query instanceof MultiPhraseQuery MultiPhraseQuery query setSlop slop return query protected Query getRangeQuery String field String part1 String part2 boolean inclusive throws ParseException if lowercaseExpandedTerms part1 part1 toLowerCase part2 part2 toLowerCase try DateFormat df DateFormat getDateInstance DateFormat SHORT locale df setLenient true Date d1 df parse part1 Date d2 df parse part2 if inclusive Calendar cal Calendar getInstance locale cal setTime d2 cal set Calendar HOUR_OF_DAY cal set Calendar MINUTE cal set Calendar SECOND cal set Calendar MILLISECOND d2 cal getTime DateTools Resolution resolution getDateResolution field if resolution null part1 DateField dateToString d1 part2 DateField dateToString d2 else part1 DateTools dateToString d1 resolution part2 DateTools dateToString d2 resolution catch Exception if useOldRangeQuery return new RangeQuery new Term field part1 new Term field part2 inclusive else return new ConstantScoreRangeQuery field part1 part2 inclusive inclusive protected Query getBooleanQuery Vector clauses throws ParseException return getBooleanQuery clauses false protected Query getBooleanQuery Vector clauses boolean disableCoord throws ParseException BooleanQuery query new BooleanQuery disableCoord for int clauses size query add BooleanClause clauses elementAt return query protected Query getWildcardQuery String field String termStr throws ParseException if equals field if equals termStr return new MatchAllDocsQuery if allowLeadingWildcard termStr startsWith termStr startsWith throw new ParseException if lowercaseExpandedTerms termStr termStr toLowerCase Term new Term field termStr return new WildcardQuery protected Query getPrefixQuery String field String termStr throws ParseException if allowLeadingWildcard termStr startsWith throw new ParseException if lowercaseExpandedTerms termStr termStr toLowerCase Term new Term field termStr return new PrefixQuery protected Query getFuzzyQuery String field String termStr float minSimilarity throws ParseException if lowercaseExpandedTerms termStr termStr toLowerCase Term new Term field termStr return new FuzzyQuery minSimilarity fuzzyPrefixLength private String discardEscapeChar String input throws ParseException char output new char input length int length boolean lastCharWasEscapeChar false int codePointMultiplier int codePoint for int input length char curChar input charAt if codePointMultiplier codePoint hexToInt curChar codePointMultiplier codePointMultiplier if codePointMultiplier output length char codePoint codePoint else if lastCharWasEscapeChar if curChar codePointMultiplier else output length curChar length lastCharWasEscapeChar false else if curChar lastCharWasEscapeChar true else output length curChar length if codePointMultiplier throw new ParseException if lastCharWasEscapeChar throw new ParseException return new String output length private static final int hexToInt char throws ParseException if return else if return else if return else throw new ParseException public static String escape String StringBuffer sb new StringBuffer for int length char charAt if sb append sb append return sb toString public static void main String args throws Exception if args length System out println System exit QueryParser qp new QueryParser new org apache lucene analysis SimpleAnalyzer Query qp parse args System out println toString final public int Conjunction throws ParseException int ret CONJ_NONE switch jj_ntk jj_ntk jj_ntk case AND case OR switch jj_ntk jj_ntk jj_ntk case AND jj_consume_token AND ret CONJ_AND break case OR jj_consume_token OR ret CONJ_OR break default jj_la1 jj_gen jj_consume_token throw new ParseException break default jj_la1 jj_gen if true return ret throw new Error final public int Modifiers throws ParseException int ret MOD_NONE switch jj_ntk jj_ntk jj_ntk case NOT case PLUS case MINUS switch jj_ntk jj_ntk jj_ntk case PLUS jj_consume_token PLUS ret MOD_REQ break case MINUS jj_consume_token MINUS ret MOD_NOT break case NOT jj_consume_token NOT ret MOD_NOT break default jj_la1 jj_gen jj_consume_token throw new ParseException break default jj_la1 jj_gen if true return ret throw new Error final public Query TopLevelQuery String field throws ParseException Query Query field jj_consume_token if true return throw new Error final public Query Query String field throws ParseException Vector clauses new Vector Query firstQuery null int conj mods mods Modifiers Clause field addClause clauses CONJ_NONE mods if mods MOD_NONE firstQuery label_1 while true switch jj_ntk jj_ntk jj_ntk case AND case OR case NOT case PLUS case MINUS case LPAREN case STAR case QUOTED case TERM case PREFIXTERM case WILDTERM case RANGEIN_START case RANGEEX_START case NUMBER break default jj_la1 jj_gen break label_1 conj Conjunction mods Modifiers Clause field addClause clauses conj mods if clauses size firstQuery null if true return firstQuery else if true return getBooleanQuery clauses throw new Error final public Query Clause String field throws ParseException Query Token fieldToken null boost null if jj_2_1 switch jj_ntk jj_ntk jj_ntk case TERM fieldToken jj_consume_token TERM jj_consume_token COLON field discardEscapeChar fieldToken image break case STAR jj_consume_token STAR jj_consume_token COLON field break default jj_la1 jj_gen jj_consume_token throw new ParseException else switch jj_ntk jj_ntk jj_ntk case STAR case QUOTED case TERM case PREFIXTERM case WILDTERM case RANGEIN_START case RANGEEX_START case NUMBER Term field break case LPAREN jj_consume_token LPAREN Query field jj_consume_token RPAREN switch jj_ntk jj_ntk jj_ntk case CARAT jj_consume_token CARAT boost jj_consume_token NUMBER break default jj_la1 jj_gen break default jj_la1 jj_gen jj_consume_token throw new ParseException if boost null float float try Float valueOf boost image floatValue setBoost catch Exception ignored if true return throw new Error final public Query Term String field throws ParseException Token term boost null fuzzySlop null goop1 goop2 boolean prefix false boolean wildcard false boolean fuzzy false boolean rangein false Query switch jj_ntk jj_ntk jj_ntk case STAR case TERM case PREFIXTERM case WILDTERM case NUMBER switch jj_ntk jj_ntk jj_ntk case TERM term jj_consume_token TERM break case STAR term jj_consume_token STAR wildcard true break case PREFIXTERM term jj_consume_token PREFIXTERM prefix true break case WILDTERM term jj_consume_token WILDTERM wildcard true break case NUMBER term jj_consume_token NUMBER break default jj_la1 jj_gen jj_consume_token throw new ParseException switch jj_ntk jj_ntk jj_ntk case FUZZY_SLOP fuzzySlop jj_consume_token FUZZY_SLOP fuzzy true break default jj_la1 jj_gen switch jj_ntk jj_ntk jj_ntk case CARAT jj_consume_token CARAT boost jj_consume_token NUMBER switch jj_ntk jj_ntk jj_ntk case FUZZY_SLOP fuzzySlop jj_consume_token FUZZY_SLOP fuzzy true break default jj_la1 jj_gen break default jj_la1 jj_gen String termImage discardEscapeChar term image if wildcard getWildcardQuery field termImage else if prefix getPrefixQuery field discardEscapeChar term image substring term image length else if fuzzy float fms fuzzyMinSim try fms Float valueOf fuzzySlop image substring floatValue catch Exception ignored if fms fms if true throw new ParseException getFuzzyQuery field termImage fms else getFieldQuery field termImage break case RANGEIN_START jj_consume_token RANGEIN_START switch jj_ntk jj_ntk jj_ntk case RANGEIN_GOOP goop1 jj_consume_token RANGEIN_GOOP break case RANGEIN_QUOTED goop1 jj_consume_token RANGEIN_QUOTED break default jj_la1 jj_gen jj_consume_token throw new ParseException switch jj_ntk jj_ntk jj_ntk case RANGEIN_TO jj_consume_token RANGEIN_TO break default jj_la1 jj_gen switch jj_ntk jj_ntk jj_ntk case RANGEIN_GOOP goop2 jj_consume_token RANGEIN_GOOP break case RANGEIN_QUOTED goop2 jj_consume_token RANGEIN_QUOTED break default jj_la1 jj_gen jj_consume_token throw new ParseException jj_consume_token RANGEIN_END switch jj_ntk jj_ntk jj_ntk case CARAT jj_consume_token CARAT boost jj_consume_token NUMBER break default jj_la1 jj_gen if goop1 kind RANGEIN_QUOTED goop1 image goop1 image substring goop1 image length if goop2 kind RANGEIN_QUOTED goop2 image goop2 image substring goop2 image length getRangeQuery field discardEscapeChar goop1 image discardEscapeChar goop2 image true break case RANGEEX_START jj_consume_token RANGEEX_START switch jj_ntk jj_ntk jj_ntk case RANGEEX_GOOP goop1 jj_consume_token RANGEEX_GOOP break case RANGEEX_QUOTED goop1 jj_consume_token RANGEEX_QUOTED break default jj_la1 jj_gen jj_consume_token throw new ParseException switch jj_ntk jj_ntk jj_ntk case RANGEEX_TO jj_consume_token RANGEEX_TO break default jj_la1 jj_gen switch jj_ntk jj_ntk jj_ntk case RANGEEX_GOOP goop2 jj_consume_token RANGEEX_GOOP break case RANGEEX_QUOTED goop2 jj_consume_token RANGEEX_QUOTED break default jj_la1 jj_gen jj_consume_token throw new ParseException jj_consume_token RANGEEX_END switch jj_ntk jj_ntk jj_ntk case CARAT jj_consume_token CARAT boost jj_consume_token NUMBER break default jj_la1 jj_gen if goop1 kind RANGEEX_QUOTED goop1 image goop1 image substring goop1 image length if goop2 kind RANGEEX_QUOTED goop2 image goop2 image substring goop2 image length getRangeQuery field discardEscapeChar goop1 image discardEscapeChar goop2 image false break case QUOTED term jj_consume_token QUOTED switch jj_ntk jj_ntk jj_ntk case FUZZY_SLOP fuzzySlop jj_consume_token FUZZY_SLOP break default jj_la1 jj_gen switch jj_ntk jj_ntk jj_ntk case CARAT jj_consume_token CARAT boost jj_consume_token NUMBER break default jj_la1 jj_gen int phraseSlop if fuzzySlop null try Float valueOf fuzzySlop image substring intValue catch Exception ignored getFieldQuery field discardEscapeChar term image substring term image length break default jj_la1 jj_gen jj_consume_token throw new ParseException if boost null float float try Float valueOf boost image floatValue catch Exception ignored if null setBoost if true return throw new Error final private boolean jj_2_1 int xla jj_la xla jj_lastpos jj_scanpos token try return jj_3_1 catch LookaheadSuccess ls return true finally jj_save xla final private boolean jj_3_1 Token xsp xsp jj_scanpos if jj_3R_2 jj_scanpos xsp if jj_3R_3 return true return false final private boolean jj_3R_3 if jj_scan_token STAR return true if jj_scan_token COLON return true return false final private boolean jj_3R_2 if jj_scan_token TERM return true if jj_scan_token COLON return true return false public QueryParserTokenManager token_source public Token token jj_nt private int jj_ntk private Token jj_scanpos jj_lastpos private int jj_la public boolean lookingAhead false private boolean jj_semLA private int jj_gen final private int jj_la1 new int static private int jj_la1_0 static private int jj_la1_1 static jj_la1_0 jj_la1_1 private static void jj_la1_0 jj_la1_0 new int private static void jj_la1_1 jj_la1_1 new int final private JJCalls jj_2_rtns new JJCalls private boolean jj_rescan false private int jj_gc public QueryParser CharStream stream token_source new QueryParserTokenManager stream token new Token jj_ntk jj_gen for int jj_la1 for int jj_2_rtns length jj_2_rtns new JJCalls public void ReInit CharStream stream token_source ReInit stream token new Token jj_ntk jj_gen for int jj_la1 for int jj_2_rtns length jj_2_rtns new JJCalls public QueryParser QueryParserTokenManager tm token_source tm token new Token jj_ntk jj_gen for int jj_la1 for int jj_2_rtns length jj_2_rtns new JJCalls public void ReInit QueryParserTokenManager tm token_source tm token new Token jj_ntk jj_gen for int jj_la1 for int jj_2_rtns length jj_2_rtns new JJCalls final private Token jj_consume_token int kind throws ParseException Token oldToken if oldToken token next null token token next else token token next token_source getNextToken jj_ntk if token kind kind jj_gen if jj_gc jj_gc for int jj_2_rtns length JJCalls jj_2_rtns while null if gen jj_gen first null next return token token oldToken jj_kind kind throw generateParseException static private final class LookaheadSuccess extends java lang Error final private LookaheadSuccess jj_ls new LookaheadSuccess final private boolean jj_scan_token int kind if jj_scanpos jj_lastpos jj_la if jj_scanpos next null jj_lastpos jj_scanpos jj_scanpos next token_source getNextToken else jj_lastpos jj_scanpos jj_scanpos next else jj_scanpos jj_scanpos next if jj_rescan int Token tok token while tok null tok jj_scanpos tok tok next if tok null jj_add_error_token kind if jj_scanpos kind kind return true if jj_la jj_scanpos jj_lastpos throw jj_ls return false final public Token getNextToken if token next null token token next else token token next token_source getNextToken jj_ntk jj_gen return token final public Token getToken int index Token lookingAhead jj_scanpos token for int index if next null next else next token_source getNextToken return final private int jj_ntk if jj_nt token next null return jj_ntk token next token_source getNextToken kind else return jj_ntk jj_nt kind private java util Vector jj_expentries new java util Vector private int jj_expentry private int jj_kind private int jj_lasttokens new int private int jj_endpos private void jj_add_error_token int kind int pos if pos return if pos jj_endpos jj_lasttokens jj_endpos kind else if jj_endpos jj_expentry new int jj_endpos for int jj_endpos jj_expentry jj_lasttokens boolean exists false for java util Enumeration jj_expentries elements hasMoreElements int oldentry int nextElement if oldentry length jj_expentry length exists true for int jj_expentry length if oldentry jj_expentry exists false break if exists break if exists jj_expentries addElement jj_expentry if pos jj_lasttokens jj_endpos pos kind public ParseException generateParseException jj_expentries removeAllElements boolean la1tokens new boolean for int la1tokens false if jj_kind la1tokens jj_kind true jj_kind for int if jj_la1 jj_gen for int if jj_la1_0 la1tokens true if jj_la1_1 la1tokens true for int if la1tokens jj_expentry new int jj_expentry jj_expentries addElement jj_expentry jj_endpos jj_rescan_token jj_add_error_token int exptokseq new int jj_expentries size for int jj_expentries size exptokseq int jj_expentries elementAt return new ParseException token exptokseq tokenImage final public void enable_tracing final public void disable_tracing final private void jj_rescan_token jj_rescan true for int JJCalls jj_2_rtns do if gen jj_gen jj_la arg jj_lastpos jj_scanpos first switch case jj_3_1 break next while null jj_rescan false final private void jj_save int index int xla JJCalls jj_2_rtns index while gen jj_gen if next null next new JJCalls break next gen jj_gen xla jj_la first token arg xla static final class JJCalls int gen Token first int arg JJCalls next public final class SimpleAnalyzer extends Analyzer public TokenStream tokenStream String fieldName Reader reader return new LowerCaseTokenizer reader class FieldDocSortedHitQueue extends PriorityQueue volatile SortField fields volatile Collator collators FieldDocSortedHitQueue SortField fields int size this fields fields this collators hasCollators fields initialize size synchronized void setFields SortField fields if this fields null this fields fields this collators hasCollators fields SortField getFields return fields private Collator hasCollators final SortField fields if fields null return null Collator ret new Collator fields length for int fields length Locale locale fields getLocale if locale null ret Collator getInstance locale return ret protected final boolean lessThan final Object final Object final FieldDoc docA FieldDoc final FieldDoc docB FieldDoc final int fields length int for int final int type fields getType switch type case SortField SCORE float r1 Float docA fields floatValue float r2 Float docB fields floatValue if r1 r2 if r1 r2 break case SortField DOC case SortField INT int i1 Integer docA fields intValue int i2 Integer docB fields intValue if i1 i2 if i1 i2 break case SortField STRING String s1 String docA fields String s2 String docB fields if s1 null s2 null else if fields getLocale null s1 compareTo s2 else collators compare s1 s2 break case SortField FLOAT float f1 Float docA fields floatValue float f2 Float docB fields floatValue if f1 f2 if f1 f2 break case SortField CUSTOM docA fields compareTo docB fields break case SortField AUTO throw new RuntimeException default throw new RuntimeException type if fields getReverse if return docA doc docB doc return public abstract class FieldCacheSource extends ValueSource private String field private FieldCache cache FieldCache DEFAULT public FieldCacheSource String field this field field public final DocValues getValues IndexReader reader throws IOException return getCachedFieldValues cache field reader public String description return field public abstract DocValues getCachedFieldValues FieldCache cache String field IndexReader reader throws IOException public final boolean equals Object if instanceof FieldCacheSource return false FieldCacheSource other FieldCacheSource return this cache other cache this field equals other field cachedFieldSourceEquals other public final int hashCode return cache hashCode field hashCode cachedFieldSourceHashCode public abstract boolean cachedFieldSourceEquals FieldCacheSource other public abstract int cachedFieldSourceHashCode public class BooleanQuery extends Query private static int maxClauseCount public static class TooManyClauses extends RuntimeException public TooManyClauses public String getMessage return maxClauseCount public static int getMaxClauseCount return maxClauseCount public static void setMaxClauseCount int maxClauseCount if maxClauseCount throw new IllegalArgumentException BooleanQuery maxClauseCount maxClauseCount private ArrayList clauses new ArrayList private boolean disableCoord public BooleanQuery public BooleanQuery boolean disableCoord this disableCoord disableCoord public boolean isCoordDisabled return disableCoord public Similarity getSimilarity Searcher searcher Similarity result super getSimilarity searcher result new SimilarityDelegator result public float coord int overlap int maxOverlap return return result public void setMinimumNumberShouldMatch int min this minNrShouldMatch min protected int minNrShouldMatch public int getMinimumNumberShouldMatch return minNrShouldMatch public void add Query query BooleanClause Occur occur add new BooleanClause query occur public void add BooleanClause clause if clauses size maxClauseCount throw new TooManyClauses clauses add clause public BooleanClause getClauses return BooleanClause clauses toArray new BooleanClause clauses size public List clauses return clauses private class BooleanWeight implements Weight protected Similarity similarity protected Vector weights new Vector public BooleanWeight Searcher searcher throws IOException this similarity getSimilarity searcher for int clauses size BooleanClause BooleanClause clauses get weights add getQuery createWeight searcher public Query getQuery return BooleanQuery this public float getValue return getBoost public float sumOfSquaredWeights throws IOException float sum for int weights size BooleanClause BooleanClause clauses get Weight Weight weights elementAt if isProhibited sum return sum public void normalize float norm for int weights size BooleanClause BooleanClause clauses get Weight Weight weights elementAt normalize norm public Scorer scorer IndexReader reader throws IOException BooleanScorer2 result new BooleanScorer2 similarity minNrShouldMatch allowDocsOutOfOrder for int weights size BooleanClause BooleanClause clauses get Weight Weight weights elementAt Scorer subScorer scorer reader if subScorer null result add subScorer isRequired isProhibited else if isRequired return null return result public Explanation explain IndexReader reader int doc throws IOException final int minShouldMatch BooleanQuery this getMinimumNumberShouldMatch ComplexExplanation sumExpl new ComplexExplanation sumExpl setDescription int coord int maxCoord float sum boolean fail false int shouldMatchCount for int weights size BooleanClause BooleanClause clauses get Weight Weight weights elementAt Explanation explain reader doc if isProhibited maxCoord if isMatch if isProhibited sumExpl addDetail sum getValue coord else Explanation new Explanation getQuery toString addDetail sumExpl addDetail fail true if getOccur equals Occur SHOULD shouldMatchCount else if isRequired Explanation new Explanation getQuery toString addDetail sumExpl addDetail fail true if fail sumExpl setMatch Boolean FALSE sumExpl setValue sumExpl setDescription return sumExpl else if shouldMatchCount minShouldMatch sumExpl setMatch Boolean FALSE sumExpl setValue sumExpl setDescription minShouldMatch return sumExpl sumExpl setMatch coord Boolean TRUE Boolean FALSE sumExpl setValue sum float coordFactor similarity coord coord maxCoord else ComplexExplanation result new ComplexExplanation sumExpl isMatch sum coordFactor result addDetail sumExpl result addDetail new Explanation coordFactor coord maxCoord return result private static boolean allowDocsOutOfOrder false public static void setAllowDocsOutOfOrder boolean allow allowDocsOutOfOrder allow public static boolean getAllowDocsOutOfOrder return allowDocsOutOfOrder public static void setUseScorer14 boolean use14 setAllowDocsOutOfOrder use14 public static boolean getUseScorer14 return getAllowDocsOutOfOrder protected Weight createWeight Searcher searcher throws IOException return new BooleanWeight searcher public Query rewrite IndexReader reader throws IOException BooleanClause BooleanClause clauses get query setBoost getBoost query getBoost return query for int clauses size BooleanClause BooleanClause clauses get Query query getQuery rewrite reader if clone null clone BooleanQuery this clone clone clauses set new BooleanClause query getOccur if clone null else public void extractTerms Set terms for Iterator clauses iterator hasNext BooleanClause clause BooleanClause next clause getQuery extractTerms terms public Object clone BooleanQuery clone BooleanQuery super clone clone clauses ArrayList this clauses clone return clone public String toString String field StringBuffer buffer new StringBuffer boolean needParens getBoost getMinimumNumberShouldMatch if needParens buffer append for int clauses size BooleanClause BooleanClause clauses get if isProhibited buffer append else if isRequired buffer append Query subQuery getQuery buffer append buffer append getQuery toString field buffer append else buffer append getQuery toString field if clauses size buffer append if needParens buffer append if getMinimumNumberShouldMatch buffer append buffer append getMinimumNumberShouldMatch if getBoost buffer append ToStringUtils boost getBoost return buffer toString public boolean equals Object if instanceof BooleanQuery return false BooleanQuery other BooleanQuery return this getBoost other getBoost this clauses equals other clauses this getMinimumNumberShouldMatch other getMinimumNumberShouldMatch public int hashCode return Float floatToIntBits getBoost clauses hashCode getMinimumNumberShouldMatch final class TermInfo int docFreq long freqPointer long proxPointer int skipOffset TermInfo TermInfo int df long fp long pp docFreq df freqPointer fp proxPointer pp TermInfo TermInfo ti docFreq ti docFreq freqPointer ti freqPointer proxPointer ti proxPointer skipOffset ti skipOffset final void set int docFreq long freqPointer long proxPointer int skipOffset this docFreq docFreq this freqPointer freqPointer this proxPointer proxPointer this skipOffset skipOffset final void set TermInfo ti docFreq ti docFreq freqPointer ti freqPointer proxPointer ti proxPointer skipOffset ti skipOffset public final class Term implements Comparable java io Serializable String field String text public Term String fld String txt this fld txt true Term String fld String txt boolean intern public final String field return field public final String text return text public Term createTerm String text return new Term field text false public final boolean equals Object if this return true if null return false if instanceof Term return false Term other Term return field other field text equals other text public final int hashCode return field hashCode text hashCode public int compareTo Object other return compareTo Term other public final int compareTo Term other return text compareTo other text else return field compareTo other field final void set String fld String txt field fld text txt public final String toString return field text private void readObject java io ObjectInputStream in throws java io IOException ClassNotFoundException in defaultReadObject field field intern public class TermQuery extends Query private Term term private class TermWeight implements Weight private Similarity similarity private float value private float idf private float queryNorm private float queryWeight public TermWeight Searcher searcher throws IOException this similarity getSimilarity searcher public String toString return TermQuery this public Query getQuery return TermQuery this public float getValue return value public float sumOfSquaredWeights public void normalize float queryNorm this queryNorm queryNorm public Scorer scorer IndexReader reader throws IOException TermDocs termDocs reader termDocs term if termDocs null return null return new TermScorer this termDocs similarity reader norms term field public Explanation explain IndexReader reader int doc throws IOException ComplexExplanation result new ComplexExplanation result setDescription getQuery doc Explanation idfExpl new Explanation idf reader docFreq term Explanation queryExpl new Explanation queryExpl setDescription getQuery Explanation boostExpl new Explanation getBoost if getBoost queryExpl addDetail boostExpl queryExpl addDetail idfExpl Explanation queryNormExpl new Explanation queryNorm queryExpl addDetail queryNormExpl queryExpl setValue boostExpl getValue idfExpl getValue queryNormExpl getValue result addDetail queryExpl String field term field ComplexExplanation fieldExpl new ComplexExplanation fieldExpl setDescription term doc Explanation tfExpl scorer reader explain doc fieldExpl addDetail tfExpl fieldExpl addDetail idfExpl Explanation fieldNormExpl new Explanation byte fieldNorms reader norms field float fieldNorm fieldNorms null Similarity decodeNorm fieldNorms doc fieldNormExpl setValue fieldNorm fieldNormExpl setDescription field doc fieldExpl addDetail fieldNormExpl fieldExpl setMatch Boolean valueOf tfExpl isMatch fieldExpl setValue tfExpl getValue idfExpl getValue fieldNormExpl getValue result addDetail fieldExpl result setMatch fieldExpl getMatch result setValue queryExpl getValue fieldExpl getValue if queryExpl getValue return fieldExpl return result public TermQuery Term term public Term getTerm return term protected Weight createWeight Searcher searcher throws IOException return new TermWeight searcher public void extractTerms Set terms terms add getTerm public String toString String field StringBuffer buffer new StringBuffer if term field equals field buffer append term field buffer append buffer append term text buffer append ToStringUtils boost getBoost return buffer toString public boolean equals Object if instanceof TermQuery return false TermQuery other TermQuery return this getBoost other getBoost this term equals other term public int hashCode return Float floatToIntBits getBoost term hashCode public abstract class CharTokenizer extends Tokenizer public CharTokenizer Reader input super input private int offset bufferIndex dataLen private static final int MAX_WORD_LEN private static final int IO_BUFFER_SIZE private final char buffer new char MAX_WORD_LEN private final char ioBuffer new char IO_BUFFER_SIZE protected abstract boolean isTokenChar char protected char normalize char return public final Token next throws IOException int length int start offset while true final char offset if bufferIndex dataLen dataLen input read ioBuffer bufferIndex if dataLen if length break else return null else ioBuffer bufferIndex start offset break return new Token new String buffer length start start length public class CorruptIndexException extends IOException public CorruptIndexException String message super message public class MultiFieldQueryParser extends QueryParser protected String fields protected Map boosts public MultiFieldQueryParser String fields Analyzer analyzer Map boosts this fields analyzer this boosts boosts public MultiFieldQueryParser String fields Analyzer analyzer super null analyzer this fields fields protected Query getFieldQuery String field String queryText int slop throws ParseException if field null Vector clauses new Vector for int fields length Query getFieldQuery fields queryText if null if boosts null Float boost Float boosts get fields if boost null setBoost boost floatValue if instanceof PhraseQuery PhraseQuery setSlop slop if instanceof MultiPhraseQuery MultiPhraseQuery setSlop slop clauses add new BooleanClause BooleanClause Occur SHOULD return null return getBooleanQuery clauses true return super getFieldQuery field queryText protected Query getFieldQuery String field String queryText throws ParseException return getFieldQuery field queryText protected Query getFuzzyQuery String field String termStr float minSimilarity throws ParseException if field null Vector clauses new Vector for int fields length clauses add new BooleanClause getFuzzyQuery fields termStr minSimilarity BooleanClause Occur SHOULD return getBooleanQuery clauses true return super getFuzzyQuery field termStr minSimilarity protected Query getPrefixQuery String field String termStr throws ParseException if field null Vector clauses new Vector for int fields length clauses add new BooleanClause getPrefixQuery fields termStr BooleanClause Occur SHOULD return getBooleanQuery clauses true return super getPrefixQuery field termStr protected Query getWildcardQuery String field String termStr throws ParseException if field null Vector clauses new Vector for int fields length clauses add new BooleanClause getWildcardQuery fields termStr BooleanClause Occur SHOULD return getBooleanQuery clauses true return super getWildcardQuery field termStr protected Query getRangeQuery String field String part1 String part2 boolean inclusive throws ParseException if field null Vector clauses new Vector for int fields length clauses add new BooleanClause getRangeQuery fields part1 part2 inclusive BooleanClause Occur SHOULD return getBooleanQuery clauses true return super getRangeQuery field part1 part2 inclusive public static Query parse String queries String fields Analyzer analyzer throws ParseException if queries length fields length throw new IllegalArgumentException BooleanQuery bQuery new BooleanQuery for int fields length QueryParser qp new QueryParser fields analyzer Query qp parse queries bQuery add BooleanClause Occur SHOULD return bQuery public static Query parse String query String fields BooleanClause Occur flags Analyzer analyzer throws ParseException if fields length flags length throw new IllegalArgumentException BooleanQuery bQuery new BooleanQuery for int fields length QueryParser qp new QueryParser fields analyzer Query qp parse query bQuery add flags return bQuery public static Query parse String queries String fields BooleanClause Occur flags Analyzer analyzer throws ParseException if queries length fields length queries length flags length throw new IllegalArgumentException BooleanQuery bQuery new BooleanQuery for int fields length QueryParser qp new QueryParser fields analyzer Query qp parse queries bQuery add flags return bQuery final class SegmentMergeQueue extends PriorityQueue SegmentMergeQueue int size initialize size protected final boolean lessThan Object Object SegmentMergeInfo stiA SegmentMergeInfo SegmentMergeInfo stiB SegmentMergeInfo int comparison stiA term compareTo stiB term if comparison return stiA base stiB base else return comparison final void close throws IOException while top null SegmentMergeInfo pop close public abstract class Directory protected LockFactory lockFactory public abstract String list throws IOException public abstract boolean fileExists String name throws IOException public abstract long fileModified String name throws IOException public abstract void touchFile String name throws IOException public abstract void deleteFile String name throws IOException public abstract void renameFile String from String to throws IOException public abstract long fileLength String name throws IOException public abstract IndexOutput createOutput String name throws IOException public abstract IndexInput openInput String name throws IOException public IndexInput openInput String name int bufferSize throws IOException return openInput name public Lock makeLock String name return lockFactory makeLock name public void clearLock String name throws IOException if lockFactory null lockFactory clearLock name public abstract void close throws IOException public void setLockFactory LockFactory lockFactory this lockFactory lockFactory lockFactory setLockPrefix this getLockID public LockFactory getLockFactory return this lockFactory public String getLockID return this toString public static void copy Directory src Directory dest boolean closeDirSrc throws IOException final String files src list if files null throw new IOException src byte buf new byte BufferedIndexOutput BUFFER_SIZE for int files length IndexOutput os null IndexInput is null try os dest createOutput files is src openInput files long len is length long readCount while readCount len int toRead readCount BufferedIndexOutput BUFFER_SIZE len int len readCount BufferedIndexOutput BUFFER_SIZE is readBytes buf toRead os writeBytes buf toRead readCount toRead finally try if os null os close finally if is null is close if closeDirSrc src close class PorterStemmer private char k0 private boolean dirty false private static final int EXTRA public PorterStemmer new char INC public void reset dirty false public void add char ch if length EXTRA char new_b new char length INC for int length new_b new_b ch public String toString return new String public int getResultLength return public char getResultBuffer return private final boolean cons int switch case case case case case return false case return k0 true cons default return true private final int int int k0 while true if return if cons break while true while true if return if cons break while true if return if cons break private final boolean vowelinstem int for k0 if cons return true return false private final boolean doublec int if k0 return false if return false return cons private final boolean cvc int if k0 cons cons cons return false else int ch if ch ch ch return false return true private final boolean ends String int length int if k0 return false for int if charAt return false return true void setto String int length int for int charAt dirty true void String if setto private final void step1 if if ends else if ends setto else if if ends if else if ends ends vowelinstem if ends setto else if ends setto else if ends setto else if doublec int ch if ch ch ch else if cvc setto private final void step2 if ends vowelinstem dirty true private final void step3 switch case if ends break if ends break break case if ends break if ends break break case if ends break break case if ends break if ends break if ends break if ends break if ends break break case if ends break if ends break if ends break break case if ends break if ends break if ends break if ends break break case if ends break if ends break if ends break break case if ends break private final void step4 switch case if ends break if ends break if ends break break case if ends break break case if ends break if ends break break case if ends break break private final void step5 switch case if ends break return case if ends break if ends break return case if ends break return case if ends break return case if ends break if ends break return case if ends break if ends break if ends break if ends break return case if ends break if ends break return case if ends break return case if ends break if ends break return case if ends break return case if ends break return case if ends break return default return if private final void step6 if int if cvc if doublec public String stem String if stem toCharArray length return toString else return public boolean stem char word return stem word word length public boolean stem char wordBuffer int offset int wordLen reset if length wordLen char new_b new char wordLen EXTRA new_b for int wordLen wordBuffer offset wordLen return stem public boolean stem char word int wordLen return stem word wordLen public boolean stem return stem public boolean stem int i0 k0 i0 if k0 step1 step2 step3 step4 step5 step6 if dirty true return dirty public static void main String args PorterStemmer new PorterStemmer for int args length try InputStream in new FileInputStream args byte buffer new byte int bufferLen offset ch bufferLen in read buffer offset reset while true if offset bufferLen ch buffer offset else bufferLen in read buffer offset if bufferLen ch else ch buffer offset if Character isLetter char ch add Character toLowerCase char ch else stem System out print toString reset if ch break else System out print char ch in close catch IOException System out println args public abstract class Searcher implements Searchable public final Hits search Query query throws IOException return search query Filter null public Hits search Query query Filter filter throws IOException return new Hits this query filter public Hits search Query query Sort sort throws IOException return new Hits this query null sort public Hits search Query query Filter filter Sort sort throws IOException return new Hits this query filter sort public TopFieldDocs search Query query Filter filter int Sort sort throws IOException return search createWeight query filter sort public void search Query query HitCollector results throws IOException search query Filter null results public void search Query query Filter filter HitCollector results throws IOException search createWeight query filter results public TopDocs search Query query Filter filter int throws IOException return search createWeight query filter public Explanation explain Query query int doc throws IOException return explain createWeight query doc private Similarity similarity Similarity getDefault public void setSimilarity Similarity similarity this similarity similarity public Similarity getSimilarity return this similarity protected Weight createWeight Query query throws IOException return query weight this public int docFreqs Term terms throws IOException int result new int terms length for int terms length result docFreq terms return result abstract public void search Weight weight Filter filter HitCollector results throws IOException abstract public void close throws IOException abstract public int docFreq Term term throws IOException abstract public int maxDoc throws IOException abstract public TopDocs search Weight weight Filter filter int throws IOException abstract public Document doc int throws CorruptIndexException IOException abstract public Query rewrite Query query throws IOException abstract public Explanation explain Weight weight int doc throws IOException abstract public TopFieldDocs search Weight weight Filter filter int Sort sort throws IOException public class BoostingTermQuery extends SpanTermQuery public BoostingTermQuery Term term super term protected Weight createWeight Searcher searcher throws IOException return new BoostingTermWeight this searcher protected class BoostingTermWeight extends SpanWeight implements Weight public BoostingTermWeight BoostingTermQuery query Searcher searcher throws IOException super query searcher public Scorer scorer IndexReader reader throws IOException return new BoostingSpanScorer TermSpans query getSpans reader this similarity reader norms query getField class BoostingSpanScorer extends SpanScorer byte payload new byte private TermPositions positions protected float payloadScore private int payloadsSeen public BoostingSpanScorer TermSpans spans Weight weight Similarity similarity byte norms throws IOException super spans weight similarity norms positions spans getPositions protected boolean setFreqCurrentDoc throws IOException if more return false doc spans doc freq payloadScore payloadsSeen Similarity similarity1 getSimilarity while more doc spans doc int matchLength spans end spans start freq similarity1 sloppyFreq matchLength processPayload similarity1 return more freq protected void processPayload Similarity similarity throws IOException if positions isPayloadAvailable payload positions getPayload payload payloadScore similarity scorePayload payload positions getPayloadLength payloadsSeen else public float score throws IOException return super score payloadsSeen payloadScore payloadsSeen public Explanation explain final int doc throws IOException Explanation result new Explanation Explanation nonPayloadExpl super explain doc result addDetail nonPayloadExpl Explanation payloadBoost new Explanation result addDetail payloadBoost float avgPayloadScore payloadScore payloadsSeen payloadBoost setValue avgPayloadScore payloadBoost setDescription result setValue nonPayloadExpl getValue avgPayloadScore result setDescription return result public boolean equals Object if instanceof BoostingTermQuery return false BoostingTermQuery other BoostingTermQuery return this getBoost other getBoost this term equals other term public abstract class Analyzer public abstract TokenStream tokenStream String fieldName Reader reader public int getPositionIncrementGap String fieldName return public class SimpleFSLockFactory extends LockFactory private File lockDir SimpleFSLockFactory throws IOException this File null public SimpleFSLockFactory File lockDir throws IOException setLockDir lockDir public SimpleFSLockFactory String lockDirName throws IOException lockDir new File lockDirName setLockDir lockDir void setLockDir File lockDir throws IOException this lockDir lockDir public Lock makeLock String lockName if lockPrefix null lockName lockPrefix lockName return new SimpleFSLock lockDir lockName public void clearLock String lockName throws IOException if lockDir exists if lockPrefix null lockName lockPrefix lockName File lockFile new File lockDir lockName if lockFile exists lockFile delete throw new IOException lockFile class SimpleFSLock extends Lock File lockFile File lockDir public SimpleFSLock File lockDir String lockFileName this lockDir lockDir lockFile new File lockDir lockFileName public boolean obtain throws IOException if lockDir exists if lockDir mkdirs throw new IOException lockDir getAbsolutePath else if lockDir isDirectory throw new IOException lockDir getAbsolutePath return lockFile createNewFile public void release lockFile delete public boolean isLocked return lockFile exists public String toString return lockFile class DisjunctionSumScorer extends Scorer private final int nrScorers protected final List subScorers private final int minimumNrMatchers private ScorerDocQueue scorerDocQueue null private int currentDoc protected int nrMatchers private float currentScore Float NaN public DisjunctionSumScorer List subScorers int minimumNrMatchers super null nrScorers subScorers size if minimumNrMatchers throw new IllegalArgumentException if nrScorers throw new IllegalArgumentException this minimumNrMatchers minimumNrMatchers this subScorers subScorers public DisjunctionSumScorer List subScorers this subScorers private void initScorerDocQueue throws IOException Iterator si subScorers iterator scorerDocQueue new ScorerDocQueue nrScorers queueSize while si hasNext Scorer se Scorer si next if scorerDocQueue insert se queueSize public void score HitCollector hc throws IOException while next hc collect currentDoc currentScore protected boolean score HitCollector hc int max throws IOException while currentDoc max hc collect currentDoc currentScore if next return false return true public boolean next throws IOException if scorerDocQueue null initScorerDocQueue return scorerDocQueue size minimumNrMatchers advanceAfterCurrent protected boolean advanceAfterCurrent throws IOException currentDoc scorerDocQueue topDoc currentScore scorerDocQueue topScore nrMatchers if scorerDocQueue topNextAndAdjustElsePop if queueSize if scorerDocQueue topDoc currentDoc currentScore scorerDocQueue topScore nrMatchers while true if nrMatchers minimumNrMatchers return true else if queueSize minimumNrMatchers return false while true public float score throws IOException return currentScore public int doc return currentDoc public int nrMatchers return nrMatchers public boolean skipTo int target throws IOException if scorerDocQueue null initScorerDocQueue if queueSize minimumNrMatchers return false if target currentDoc return true do if scorerDocQueue topDoc target return advanceAfterCurrent else if scorerDocQueue topSkipToAndAdjustElsePop target if queueSize minimumNrMatchers return false while true public Explanation explain int doc throws IOException Explanation res new Explanation Iterator ssi subScorers iterator float sumScore int nrMatches while ssi hasNext Explanation es Scorer ssi next explain doc sumScore es getValue nrMatches res addDetail es if nrMatchers minimumNrMatchers res setValue sumScore res setDescription minimumNrMatchers subScorers size else res setValue res setDescription nrMatches minimumNrMatchers subScorers size return res final class TermBuffer implements Cloneable private static final char NO_CHARS new char private String field private char text NO_CHARS private int textLength public final int compareTo TermBuffer other return compareChars text textLength other text other textLength else return field compareTo other field private static final int compareChars char v1 int len1 char v2 int len2 int end Math min len1 len2 for int end char c1 v1 char c2 v2 if c1 c2 return c1 c2 return len1 len2 private final void setTextLength int newLength if text length newLength char newText new char newLength System arraycopy text newText textLength text newText textLength newLength public final void read IndexInput input FieldInfos fieldInfos throws IOException int start input readVInt int length input readVInt int totalLength start length setTextLength totalLength input readChars this text start length this field fieldInfos fieldName input readVInt public final void set Term term if term null reset return setTextLength term text length term text getChars term text length text this field term field this term term public final void set TermBuffer other setTextLength other textLength System arraycopy other text text textLength this field other field this term other term public void reset this field null this textLength this term null public Term toTerm return null if term null term new Term field new String text textLength false return term protected Object clone TermBuffer clone null try clone TermBuffer super clone catch CloneNotSupportedException clone text new char text length System arraycopy text clone text textLength return clone public abstract class BufferedIndexOutput extends IndexOutput static final int BUFFER_SIZE private final byte buffer new byte BUFFER_SIZE public void writeByte byte throws IOException if bufferPosition BUFFER_SIZE flush buffer bufferPosition public void writeBytes byte int offset int length throws IOException int bytesLeft BUFFER_SIZE bufferPosition if bytesLeft length System arraycopy offset buffer bufferPosition length bufferPosition length if BUFFER_SIZE bufferPosition flush else if length BUFFER_SIZE if bufferPosition flush flushBuffer offset length bufferStart length else int pieceLength while pos length pieceLength length pos bytesLeft length pos bytesLeft System arraycopy pos offset buffer bufferPosition pieceLength pos pieceLength bufferPosition pieceLength bytesLeft BUFFER_SIZE bufferPosition if bytesLeft flush bytesLeft BUFFER_SIZE public void flush throws IOException flushBuffer buffer bufferPosition bufferStart bufferPosition bufferPosition private void flushBuffer byte int len throws IOException flushBuffer len protected abstract void flushBuffer byte int offset int len throws IOException public void close throws IOException flush public long getFilePointer return bufferStart bufferPosition public void seek long pos throws IOException flush bufferStart pos public abstract long length throws IOException public class TermVectorOffsetInfo public static final TermVectorOffsetInfo EMPTY_OFFSET_INFO new TermVectorOffsetInfo private int startOffset private int endOffset public TermVectorOffsetInfo public TermVectorOffsetInfo int startOffset int endOffset this endOffset endOffset this startOffset startOffset public int getEndOffset return endOffset public void setEndOffset int endOffset this endOffset endOffset public int getStartOffset return startOffset public void setStartOffset int startOffset this startOffset startOffset public boolean equals Object if this return true if instanceof TermVectorOffsetInfo return false final TermVectorOffsetInfo termVectorOffsetInfo TermVectorOffsetInfo if endOffset termVectorOffsetInfo endOffset return false if startOffset termVectorOffsetInfo startOffset return false return true public int hashCode int result result startOffset result result endOffset return result public class IntFieldSource extends FieldCacheSource private FieldCache IntParser parser public IntFieldSource String field this field null public IntFieldSource String field FieldCache IntParser parser super field this parser parser public String description return super description public DocValues getCachedFieldValues FieldCache cache String field IndexReader reader throws IOException final int arr parser null cache getInts reader field cache getInts reader field parser return new DocValues reader maxDoc public float floatVal int doc return float arr doc public int intVal int doc return arr doc public String toString int doc return description intVal doc Object getInnerArray return arr public boolean cachedFieldSourceEquals FieldCacheSource if getClass IntFieldSource class return false IntFieldSource other IntFieldSource return this parser null other parser null this parser getClass other parser getClass public int cachedFieldSourceHashCode return parser null Integer class hashCode parser getClass hashCode abstract class MultiLevelSkipListWriter private int numberOfSkipLevels private int skipInterval private RAMOutputStream skipBuffer protected MultiLevelSkipListWriter int skipInterval int maxSkipLevels int df this skipInterval skipInterval numberOfSkipLevels df int Math floor Math log df Math log skipInterval if numberOfSkipLevels maxSkipLevels numberOfSkipLevels maxSkipLevels protected void init skipBuffer new RAMOutputStream numberOfSkipLevels for int numberOfSkipLevels skipBuffer new RAMOutputStream protected void resetSkip if skipBuffer null init else for int skipBuffer length skipBuffer reset protected abstract void writeSkipData int level IndexOutput skipBuffer throws IOException void bufferSkip int df throws IOException int numLevels for numLevels df skipInterval numLevels numberOfSkipLevels df skipInterval numLevels long childPointer for int level level numLevels level writeSkipData level skipBuffer level long newChildPointer skipBuffer level getFilePointer if level skipBuffer level writeVLong childPointer childPointer newChildPointer long writeSkip IndexOutput output throws IOException long skipPointer output getFilePointer if skipBuffer null skipBuffer length return skipPointer for int level numberOfSkipLevels level level long length skipBuffer level getFilePointer if length output writeVLong length skipBuffer level writeTo output skipBuffer writeTo output return skipPointer public interface IndexDeletionPolicy public void onInit List commits throws IOException public void onCommit List commits throws IOException public class LetterTokenizer extends CharTokenizer public LetterTokenizer Reader in super in protected boolean isTokenChar char return Character isLetter public class MatchAllDocsQuery extends Query public MatchAllDocsQuery private class MatchAllScorer extends Scorer final IndexReader reader int id final int maxId final float score MatchAllScorer IndexReader reader Similarity similarity Weight super similarity this reader reader id maxId reader maxDoc score getValue public Explanation explain int doc public int doc return id public boolean next while id maxId id if reader isDeleted id return true return false public float score return score public boolean skipTo int target id target return next private class MatchAllDocsWeight implements Weight private Similarity similarity private float queryWeight private float queryNorm public MatchAllDocsWeight Searcher searcher this similarity searcher getSimilarity public String toString return MatchAllDocsQuery this public Query getQuery return MatchAllDocsQuery this public float getValue return queryWeight public float sumOfSquaredWeights queryWeight getBoost return queryWeight queryWeight public void normalize float queryNorm this queryNorm queryNorm queryWeight this queryNorm public Scorer scorer IndexReader reader return new MatchAllScorer reader similarity this public Explanation explain IndexReader reader int doc Explanation queryExpl new ComplexExplanation true getValue if getBoost queryExpl addDetail new Explanation getBoost queryExpl addDetail new Explanation queryNorm return queryExpl protected Weight createWeight Searcher searcher return new MatchAllDocsWeight searcher public void extractTerms Set terms public String toString String field StringBuffer buffer new StringBuffer buffer append buffer append ToStringUtils boost getBoost return buffer toString public boolean equals Object if instanceof MatchAllDocsQuery return false MatchAllDocsQuery other MatchAllDocsQuery return this getBoost other getBoost public int hashCode return Float floatToIntBits getBoost public class BooleanClause implements java io Serializable public static final class Occur extends Parameter implements java io Serializable private Occur String name super name public String toString if this MUST return if this MUST_NOT return return public static final Occur MUST new Occur public static final Occur SHOULD new Occur public static final Occur MUST_NOT new Occur private Query query private Occur occur public BooleanClause Query query Occur occur this query query this occur occur public Occur getOccur return occur public void setOccur Occur occur this occur occur public Query getQuery return query public void setQuery Query query this query query public boolean isProhibited return Occur MUST_NOT equals occur public boolean isRequired return Occur MUST equals occur public boolean equals Object if instanceof BooleanClause return false BooleanClause other BooleanClause return this query equals other query this occur equals other occur public int hashCode return query hashCode Occur MUST equals occur Occur MUST_NOT equals occur public String toString return occur toString query toString public interface IndexCommitPoint public String getSegmentsFileName public void delete public class ToStringUtils public static String boost float boost if boost return Float toString boost else return public class WildcardQuery extends MultiTermQuery private boolean termContainsWildcard public WildcardQuery Term term super term this termContainsWildcard term text indexOf term text indexOf protected FilteredTermEnum getEnum IndexReader reader throws IOException return new WildcardTermEnum reader getTerm public boolean equals Object if instanceof WildcardQuery return super equals return false public Query rewrite IndexReader reader throws IOException if this termContainsWildcard return super rewrite reader return new TermQuery getTerm class SegmentTermVector implements TermFreqVector private String field private String terms private int termFreqs SegmentTermVector String field String terms int termFreqs this field field this terms terms this termFreqs termFreqs public String getField return field public String toString StringBuffer sb new StringBuffer sb append sb append field append if terms null for int terms length if sb append sb append terms append append termFreqs sb append return sb toString public int size return terms null terms length public String getTerms return terms public int getTermFrequencies return termFreqs public int indexOf String termText if terms null return int res Arrays binarySearch terms termText return res res public int indexesOf String termNumbers int start int len int res new int len for int len res indexOf termNumbers start return res public abstract class ValueSource implements Serializable public abstract DocValues getValues IndexReader reader throws IOException public abstract String description public String toString return description public abstract boolean equals Object public abstract int hashCode public class DateField private DateField private static int DATE_LEN Long toString Character MAX_RADIX length public static String MIN_DATE_STRING return timeToString public static String MAX_DATE_STRING char buffer new char DATE_LEN char Character forDigit Character MAX_RADIX Character MAX_RADIX for int DATE_LEN buffer return new String buffer public static String dateToString Date date return timeToString date getTime public static String timeToString long time if time throw new RuntimeException time String Long toString time Character MAX_RADIX if length DATE_LEN throw new RuntimeException time DATE_LEN if length DATE_LEN StringBuffer sb new StringBuffer while sb length DATE_LEN sb insert sb toString return public static long stringToTime String return Long parseLong Character MAX_RADIX public static Date stringToDate String return new Date stringToTime public class FieldDoc extends ScoreDoc public Comparable fields public FieldDoc int doc float score super doc score public FieldDoc int doc float score Comparable fields super doc score this fields fields public class TokenMgrError extends Error static final int LEXICAL_ERROR static final int STATIC_LEXER_ERROR static final int INVALID_LEXICAL_STATE static final int LOOP_DETECTED int errorCode protected static final String addEscapes String str StringBuffer retval new StringBuffer char ch for int str length switch str charAt case continue case retval append continue case retval append continue case retval append continue case retval append continue case retval append continue case retval append continue case retval append continue case retval append continue default if ch str charAt ch String Integer toString ch retval append substring length length else retval append ch continue return retval toString protected static String LexicalError boolean EOFSeen int lexState int errorLine int errorColumn String errorAfter char curChar return errorLine errorColumn EOFSeen addEscapes String valueOf curChar int curChar addEscapes errorAfter public String getMessage return super getMessage public TokenMgrError public TokenMgrError String message int reason super message errorCode reason public TokenMgrError boolean EOFSeen int lexState int errorLine int errorColumn String errorAfter char curChar int reason this LexicalError EOFSeen lexState errorLine errorColumn errorAfter curChar reason final class SegmentMerger static final byte NORMS_HEADER new byte private Directory directory private String segment private int termIndexInterval IndexWriter DEFAULT_TERM_INDEX_INTERVAL private Vector readers new Vector private FieldInfos fieldInfos private int mergedDocs SegmentMerger Directory dir String name directory dir segment name SegmentMerger IndexWriter writer String name directory writer getDirectory segment name termIndexInterval writer getTermIndexInterval final void add IndexReader reader readers addElement reader final IndexReader segmentReader int return IndexReader readers elementAt final int merge throws CorruptIndexException IOException int value mergedDocs mergeFields mergeTerms mergeNorms if fieldInfos hasVectors mergeVectors return mergedDocs final void closeReaders throws IOException IndexReader reader IndexReader readers elementAt reader close final Vector createCompoundFile String fileName throws IOException CompoundFileWriter cfsWriter new CompoundFileWriter directory fileName Vector files new Vector IndexFileNames COMPOUND_EXTENSIONS length for int IndexFileNames COMPOUND_EXTENSIONS length files add segment IndexFileNames COMPOUND_EXTENSIONS for int fieldInfos size FieldInfo fi fieldInfos fieldInfo if fi isIndexed fi omitNorms files add segment IndexFileNames NORMS_EXTENSION break if fieldInfos hasVectors for int IndexFileNames VECTOR_EXTENSIONS length files add segment IndexFileNames VECTOR_EXTENSIONS Iterator it files iterator while it hasNext cfsWriter addFile String it next cfsWriter close return files private void addIndexed IndexReader reader FieldInfos fieldInfos Collection names boolean storeTermVectors boolean storePositionWithTermVector boolean storeOffsetWithTermVector boolean storePayloads throws IOException Iterator names iterator while hasNext String field String next fieldInfos add field true storeTermVectors storePositionWithTermVector storeOffsetWithTermVector reader hasNorms field storePayloads private final int mergeFields throws CorruptIndexException IOException int docCount for int readers size IndexReader reader IndexReader readers elementAt addIndexed reader fieldInfos reader getFieldNames IndexReader FieldOption TERMVECTOR_WITH_POSITION_OFFSET true true true false addIndexed reader fieldInfos reader getFieldNames IndexReader FieldOption TERMVECTOR_WITH_POSITION true true false false addIndexed reader fieldInfos reader getFieldNames IndexReader FieldOption TERMVECTOR_WITH_OFFSET true false true false addIndexed reader fieldInfos reader getFieldNames IndexReader FieldOption TERMVECTOR true false false false addIndexed reader fieldInfos reader getFieldNames IndexReader FieldOption STORES_PAYLOADS false false false true addIndexed reader fieldInfos reader getFieldNames IndexReader FieldOption INDEXED false false false false fieldInfos add reader getFieldNames IndexReader FieldOption UNINDEXED false fieldInfos write directory segment new FieldsWriter directory segment fieldInfos FieldSelector fieldSelectorMerge new FieldSelector public FieldSelectorResult accept String fieldName return FieldSelectorResult LOAD_FOR_MERGE try for int readers size IndexReader reader IndexReader readers elementAt int maxDoc reader maxDoc for int maxDoc fieldsWriter addDocument reader document fieldSelectorMerge docCount finally fieldsWriter close return docCount private final void mergeVectors throws IOException TermVectorsWriter termVectorsWriter new TermVectorsWriter directory segment fieldInfos try for int readers size IndexReader reader IndexReader readers elementAt int maxDoc reader maxDoc for int docNum docNum maxDoc docNum if reader isDeleted docNum continue termVectorsWriter addAllDocVectors reader getTermFreqVectors docNum finally termVectorsWriter close private IndexOutput freqOutput null private IndexOutput proxOutput null private TermInfosWriter termInfosWriter null private int skipInterval private int maxSkipLevels private SegmentMergeQueue queue null private DefaultSkipListWriter skipListWriter null private final void mergeTerms throws CorruptIndexException IOException try freqOutput directory createOutput segment proxOutput directory createOutput segment termInfosWriter new TermInfosWriter directory segment fieldInfos termIndexInterval skipInterval termInfosWriter skipInterval maxSkipLevels termInfosWriter maxSkipLevels skipListWriter new DefaultSkipListWriter skipInterval maxSkipLevels mergedDocs freqOutput proxOutput queue new SegmentMergeQueue readers size mergeTermInfos finally if freqOutput null freqOutput close if proxOutput null proxOutput close if termInfosWriter null termInfosWriter close if queue null queue close private final void mergeTermInfos throws CorruptIndexException IOException int base for int readers size IndexReader reader IndexReader readers elementAt TermEnum termEnum reader terms SegmentMergeInfo smi new SegmentMergeInfo base termEnum reader base reader numDocs if smi next else smi close SegmentMergeInfo match new SegmentMergeInfo readers size while queue size match matchSize SegmentMergeInfo queue pop Term term match term SegmentMergeInfo top SegmentMergeInfo queue top while top null term compareTo top term match matchSize SegmentMergeInfo queue pop top SegmentMergeInfo queue top while matchSize SegmentMergeInfo smi match matchSize if smi next else private final void mergeTermInfo SegmentMergeInfo smis int throws CorruptIndexException IOException long freqPointer freqOutput getFilePointer long proxPointer proxOutput getFilePointer long skipPointer skipListWriter writeSkip freqOutput if df termInfo set df freqPointer proxPointer int skipPointer freqPointer termInfosWriter add smis term termInfo private byte payloadBuffer null private final int appendPostings SegmentMergeInfo smis int throws CorruptIndexException IOException int lastDoc skipListWriter resetSkip boolean storePayloads fieldInfos fieldInfo smis term field storePayloads for int SegmentMergeInfo smi smis TermPositions postings smi getPositions int base smi base int docMap smi getDocMap postings seek smi termEnum while postings next int doc postings doc if docMap null if doc df doc lastDoc throw new CorruptIndexException doc lastDoc df if df skipInterval skipListWriter setSkipData lastDoc storePayloads lastPayloadLength skipListWriter bufferSkip df lastDoc doc int freq postings freq if freq else for int freq int position postings nextPosition int delta position lastPosition if storePayloads int payloadLength postings getPayloadLength if payloadLength lastPayloadLength proxOutput writeVInt delta else proxOutput writeVInt delta proxOutput writeVInt payloadLength lastPayloadLength payloadLength if payloadLength if payloadBuffer null payloadBuffer length payloadLength payloadBuffer new byte payloadLength postings getPayload payloadBuffer proxOutput writeBytes payloadBuffer payloadLength else proxOutput writeVInt delta lastPosition position return df private void mergeNorms throws IOException byte normBuffer null IndexOutput output null try for int fieldInfos size FieldInfo fi fieldInfos fieldInfo if fi isIndexed fi omitNorms if output null output directory createOutput segment IndexFileNames NORMS_EXTENSION output writeBytes NORMS_HEADER NORMS_HEADER length for int readers size IndexReader reader IndexReader readers elementAt int maxDoc reader maxDoc if normBuffer null normBuffer length maxDoc normBuffer new byte maxDoc reader norms fi name normBuffer if reader hasDeletions output writeBytes normBuffer maxDoc else for int maxDoc if reader isDeleted output writeByte normBuffer finally if output null output close public final class FieldSelectorResult implements Serializable public transient static final FieldSelectorResult LOAD new FieldSelectorResult public transient static final FieldSelectorResult LAZY_LOAD new FieldSelectorResult public transient static final FieldSelectorResult NO_LOAD new FieldSelectorResult public transient static final FieldSelectorResult LOAD_AND_BREAK new FieldSelectorResult public transient static final FieldSelectorResult LOAD_FOR_MERGE new FieldSelectorResult public transient static final FieldSelectorResult SIZE new FieldSelectorResult public transient static final FieldSelectorResult SIZE_AND_BREAK new FieldSelectorResult private int id private FieldSelectorResult int id this id id public boolean equals Object if this return true if null getClass getClass return false final FieldSelectorResult that FieldSelectorResult if id that id return false return true public int hashCode return id public interface SortComparatorSource extends Serializable ScoreDocComparator newComparator IndexReader reader String fieldname throws IOException public class ReqOptSumScorer extends Scorer private Scorer reqScorer private Scorer optScorer public ReqOptSumScorer Scorer reqScorer Scorer optScorer this reqScorer reqScorer this optScorer optScorer private boolean firstTimeOptScorer true public boolean next throws IOException return reqScorer next public boolean skipTo int target throws IOException return reqScorer skipTo target public int doc return reqScorer doc public float score throws IOException int curDoc reqScorer doc float reqScore reqScorer score if firstTimeOptScorer firstTimeOptScorer false if optScorer skipTo curDoc optScorer null return reqScore else if optScorer null return reqScore else if optScorer doc curDoc optScorer skipTo curDoc optScorer null return reqScore return optScorer doc curDoc reqScore optScorer score reqScore public Explanation explain int doc throws IOException Explanation res new Explanation res setDescription res addDetail reqScorer explain doc res addDetail optScorer explain doc return res class DisjunctionMaxScorer extends Scorer private ArrayList subScorers new ArrayList private float tieBreakerMultiplier public DisjunctionMaxScorer float tieBreakerMultiplier Similarity similarity super similarity this tieBreakerMultiplier tieBreakerMultiplier public void add Scorer scorer throws IOException subScorers add scorer more true public boolean next throws IOException if more return false if firstTime heapify firstTime false int lastdoc Scorer subScorers get doc do if Scorer subScorers get next heapAdjust else heapRemoveRoot if subScorers isEmpty return more false while Scorer subScorers get doc lastdoc return true public int doc return Scorer subScorers get doc public float score throws IOException int doc Scorer subScorers get doc float sum Scorer subScorers get score max sum int size subScorers size scoreAll size doc sum max scoreAll size doc sum max return max sum max tieBreakerMultiplier private void scoreAll int root int size int doc float sum float max throws IOException if root size Scorer subScorers get root doc doc float sub Scorer subScorers get root score sum sub max Math max max sub scoreAll root size doc sum max scoreAll root size doc sum max public boolean skipTo int target throws IOException if firstTime if more return false heapify firstTime false while subScorers size Scorer subScorers get doc target if Scorer subScorers get skipTo target heapAdjust else heapRemoveRoot if subScorers size return more false return true public Explanation explain int doc throws IOException throw new UnsupportedOperationException private void heapify int size subScorers size for int size heapAdjust private void heapAdjust int root Scorer scorer Scorer subScorers get root int doc scorer doc int root size subScorers size while size int lchild Scorer lscorer Scorer subScorers get lchild int ldoc lscorer doc int rdoc Integer MAX_VALUE rchild Scorer rscorer null if rchild size rscorer Scorer subScorers get rchild rdoc rscorer doc if ldoc doc if rdoc ldoc subScorers set rscorer subScorers set rchild scorer rchild else subScorers set lscorer subScorers set lchild scorer lchild else if rdoc doc subScorers set rscorer subScorers set rchild scorer rchild else return private void heapRemoveRoot int size subScorers size if size subScorers remove else subScorers set subScorers get size subScorers remove size heapAdjust public class NumberTools private static final int RADIX private static final char NEGATIVE_PREFIX private static final char POSITIVE_PREFIX public static final String MIN_STRING_VALUE NEGATIVE_PREFIX public static final String MAX_STRING_VALUE POSITIVE_PREFIX public static final int STR_SIZE MIN_STRING_VALUE length public static String longToString long if Long MIN_VALUE return MIN_STRING_VALUE StringBuffer buf new StringBuffer STR_SIZE if buf append NEGATIVE_PREFIX Long MAX_VALUE else buf append POSITIVE_PREFIX String num Long toString RADIX int padLen STR_SIZE num length buf length while padLen buf append buf append num return buf toString public static long stringToLong String str if str null throw new NullPointerException if str length STR_SIZE throw new NumberFormatException if str equals MIN_STRING_VALUE return Long MIN_VALUE char prefix str charAt long Long parseLong str substring RADIX if prefix POSITIVE_PREFIX else if prefix NEGATIVE_PREFIX Long MAX_VALUE else throw new NumberFormatException return public class SimilarityDelegator extends Similarity private Similarity delegee public SimilarityDelegator Similarity delegee this delegee delegee public float lengthNorm String fieldName int numTerms return delegee lengthNorm fieldName numTerms public float queryNorm float sumOfSquaredWeights return delegee queryNorm sumOfSquaredWeights public float tf float freq return delegee tf freq public float sloppyFreq int distance return delegee sloppyFreq distance public float idf int docFreq int numDocs return delegee idf docFreq numDocs public float coord int overlap int maxOverlap return delegee coord overlap maxOverlap public class SingleInstanceLockFactory extends LockFactory private HashSet locks new HashSet public Lock makeLock String lockName return new SingleInstanceLock locks lockName public void clearLock String lockName throws IOException synchronized locks if locks contains lockName locks remove lockName class SingleInstanceLock extends Lock String lockName private HashSet locks public SingleInstanceLock HashSet locks String lockName this locks locks this lockName lockName public boolean obtain throws IOException synchronized locks return locks add lockName public void release synchronized locks locks remove lockName public boolean isLocked synchronized locks return locks contains lockName public String toString return lockName public class SortField implements Serializable public static final int SCORE public static final int DOC public static final int AUTO public static final int STRING public static final int INT public static final int FLOAT public static final int CUSTOM public static final SortField FIELD_SCORE new SortField null SCORE public static final SortField FIELD_DOC new SortField null DOC private String field private SortComparatorSource factory public SortField String field this field field intern public SortField String field boolean reverse this field field intern this reverse reverse public SortField String field int type this field field null field intern field this type type public SortField String field int type boolean reverse this field field null field intern field this type type this reverse reverse public SortField String field Locale locale this field field intern this type STRING this locale locale public SortField String field Locale locale boolean reverse this field field intern this type STRING this locale locale this reverse reverse public SortField String field SortComparatorSource comparator this field field null field intern field this type CUSTOM this factory comparator public SortField String field SortComparatorSource comparator boolean reverse this field field null field intern field this type CUSTOM this reverse reverse this factory comparator public String getField return field public int getType return type public Locale getLocale return locale public boolean getReverse return reverse public SortComparatorSource getFactory return factory public String toString StringBuffer buffer new StringBuffer switch type case SCORE buffer append break case DOC buffer append break case CUSTOM buffer append field factory break default buffer append field break if locale null buffer append locale if reverse buffer append return buffer toString public abstract class Similarity implements Serializable private static Similarity defaultImpl new DefaultSimilarity public static void setDefault Similarity similarity Similarity defaultImpl similarity public static Similarity getDefault return Similarity defaultImpl private static final float NORM_TABLE new float static for int NORM_TABLE SmallFloat byte315ToFloat byte public static float decodeNorm byte public static float getNormDecoder return NORM_TABLE public abstract float lengthNorm String fieldName int numTokens public abstract float queryNorm float sumOfSquaredWeights public static byte encodeNorm float return SmallFloat floatToByte315 public float tf int freq return tf float freq public abstract float sloppyFreq int distance public abstract float tf float freq public float idf Term term Searcher searcher throws IOException return idf searcher docFreq term searcher maxDoc public float idf Collection terms Searcher searcher throws IOException float idf Iterator terms iterator while hasNext idf idf Term next searcher return idf public abstract float idf int docFreq int numDocs public abstract float coord int overlap int maxOverlap public float scorePayload byte payload int offset int length return public final class FuzzyTermEnum extends FilteredTermEnum private static final int TYPICAL_LONGEST_WORD_IN_INDEX private int private float similarity private boolean endEnum false private Term searchTerm null private final String field private final String text private final String prefix private final float minimumSimilarity private final float scale_factor private final int maxDistances new int TYPICAL_LONGEST_WORD_IN_INDEX public FuzzyTermEnum IndexReader reader Term term throws IOException this reader term FuzzyQuery defaultMinSimilarity FuzzyQuery defaultPrefixLength public FuzzyTermEnum IndexReader reader Term term float minSimilarity throws IOException this reader term minSimilarity FuzzyQuery defaultPrefixLength public FuzzyTermEnum IndexReader reader Term term final float minSimilarity final int prefixLength throws IOException super if minSimilarity throw new IllegalArgumentException else if minSimilarity throw new IllegalArgumentException if prefixLength throw new IllegalArgumentException this minimumSimilarity minSimilarity this scale_factor minimumSimilarity this searchTerm term this field searchTerm field final int fullSearchTermLength searchTerm text length final int realPrefixLength prefixLength fullSearchTermLength fullSearchTermLength prefixLength this text searchTerm text substring realPrefixLength this prefix searchTerm text substring realPrefixLength initializeMaxDistances this initDistanceArray setEnum reader terms new Term searchTerm field prefix protected final boolean termCompare Term term if field term field term text startsWith prefix final String target term text substring prefix length this similarity similarity target return similarity minimumSimilarity endEnum true return false public final float difference return float similarity minimumSimilarity scale_factor public final boolean endEnum return endEnum private static final int min int int int final int return private final int initDistanceArray return new int this text length TYPICAL_LONGEST_WORD_IN_INDEX private synchronized final float similarity final String target final int target length final int text length if return prefix length float prefix length if return prefix length float prefix length final int maxDistance getMaxDistance if maxDistance Math abs return if length growDistanceArray for int for int for int int bestPossibleEditDistance final char s_i text charAt for int if s_i target charAt min else min bestPossibleEditDistance Math min bestPossibleEditDistance return return float float prefix length Math min private void growDistanceArray int for int length new int private final int getMaxDistance int return maxDistances length maxDistances calculateMaxDistance private void initializeMaxDistances for int maxDistances length maxDistances calculateMaxDistance private int calculateMaxDistance int return int minimumSimilarity Math min text length prefix length public void close throws IOException public abstract class Lock public static long LOCK_POLL_INTERVAL public abstract boolean obtain throws IOException protected Throwable failureReason public boolean obtain long lockWaitTimeout throws LockObtainFailedException IOException failureReason null boolean locked obtain int maxSleepCount int lockWaitTimeout LOCK_POLL_INTERVAL int sleepCount while locked if sleepCount maxSleepCount String reason this toString if failureReason null reason failureReason LockObtainFailedException new LockObtainFailedException reason if failureReason null initCause failureReason throw try Thread sleep LOCK_POLL_INTERVAL catch InterruptedException throw new IOException toString locked obtain return locked public abstract void release public abstract boolean isLocked public abstract static class With private Lock lock private long lockWaitTimeout public With Lock lock long lockWaitTimeout this lock lock this lockWaitTimeout lockWaitTimeout protected abstract Object doBody throws IOException public Object run throws LockObtainFailedException IOException boolean locked false try locked lock obtain lockWaitTimeout return doBody finally if locked lock release public class SpanFirstQuery extends SpanQuery private SpanQuery match private int end public SpanFirstQuery SpanQuery match int end this match match this end end public SpanQuery getMatch return match public int getEnd return end public String getField return match getField public Collection getTerms return match getTerms public String toString String field StringBuffer buffer new StringBuffer buffer append buffer append match toString field buffer append buffer append end buffer append buffer append ToStringUtils boost getBoost return buffer toString public void extractTerms Set terms match extractTerms terms public Spans getSpans final IndexReader reader throws IOException return new Spans private Spans spans match getSpans reader public boolean next throws IOException if end end return true return false public boolean skipTo int target throws IOException if spans skipTo target return false return true public int doc return spans doc public int start return spans start public int end return spans end public String toString return SpanFirstQuery this toString public Query rewrite IndexReader reader throws IOException SpanFirstQuery clone null SpanQuery rewritten SpanQuery match rewrite reader if rewritten match clone SpanFirstQuery this clone clone match rewritten if clone null else public boolean equals Object if this return true if instanceof SpanFirstQuery return false SpanFirstQuery other SpanFirstQuery return this end other end this match equals other match this getBoost other getBoost public int hashCode int match hashCode Float floatToRawIntBits getBoost end return public class TopDocs implements java io Serializable public int totalHits public ScoreDoc scoreDocs private float maxScore public float getMaxScore return maxScore public void setMaxScore float maxScore this maxScore maxScore TopDocs int totalHits ScoreDoc scoreDocs float maxScore this totalHits totalHits this scoreDocs scoreDocs this maxScore maxScore public class TopFieldDocCollector extends TopDocCollector public TopFieldDocCollector IndexReader reader Sort sort int numHits throws IOException super numHits new FieldSortedHitQueue reader sort fields numHits public void collect int doc float score if score totalHits hq insert new FieldDoc doc score public TopDocs topDocs FieldSortedHitQueue fshq FieldSortedHitQueue hq ScoreDoc scoreDocs new ScoreDoc fshq size scoreDocs fshq fillFields FieldDoc fshq pop return new TopFieldDocs totalHits scoreDocs fshq getFields fshq getMaxScore public abstract class Tokenizer extends TokenStream protected Reader input protected Tokenizer protected Tokenizer Reader input this input input public void close throws IOException input close public final class LucenePackage public static Package get return LucenePackage class getPackage public class ComplexExplanation extends Explanation private Boolean match public ComplexExplanation super public ComplexExplanation boolean match float value String description super value description this match Boolean valueOf match public Boolean getMatch return match public void setMatch Boolean match this match match public boolean isMatch Boolean getMatch return null booleanValue super isMatch protected String getSummary if null getMatch return super getSummary return getValue isMatch getDescription public class Hit implements java io Serializable private Document doc null private boolean resolved false private Hits hits null private int hitNumber Hit Hits hits int hitNumber this hits hits this hitNumber hitNumber public Document getDocument throws CorruptIndexException IOException if resolved fetchTheHit return doc public float getScore throws IOException return hits score hitNumber public int getId throws IOException return hits id hitNumber private void fetchTheHit throws CorruptIndexException IOException doc hits doc hitNumber resolved true public float getBoost throws CorruptIndexException IOException return getDocument getBoost public String get String name throws CorruptIndexException IOException return getDocument get name public String toString StringBuffer buffer new StringBuffer buffer append buffer append hits toString buffer append buffer append hitNumber buffer append if resolved buffer append else buffer append buffer append return buffer toString public abstract class Parameter implements Serializable static Map allParameters new HashMap private String name private Parameter protected Parameter String name this name name String key makeKey name if allParameters containsKey key throw new IllegalArgumentException key allParameters put key this private String makeKey String name return getClass name public String toString return name protected Object readResolve throws ObjectStreamException Object par allParameters get makeKey name if par null throw new StreamCorruptedException name return par class NearSpansUnordered implements Spans private SpanNearQuery query private class CellQueue extends PriorityQueue public CellQueue int size initialize size protected final boolean lessThan Object o1 Object o2 SpansCell spans1 SpansCell o1 SpansCell spans2 SpansCell o2 if spans1 doc spans2 doc return NearSpansOrdered docSpansOrdered spans1 spans2 else return spans1 doc spans2 doc private class SpansCell implements Spans private Spans spans private SpansCell next private int length private int index public SpansCell Spans spans int index this spans spans this index index public boolean next throws IOException return adjust spans next public boolean skipTo int target throws IOException return adjust spans skipTo target private boolean adjust boolean condition if length if condition length end start if max null doc max doc doc max doc end max end max this more condition return condition public int doc return spans doc public int start return spans start public int end return spans end public String toString return spans toString index public NearSpansUnordered SpanNearQuery query IndexReader reader throws IOException this query query this slop query getSlop SpanQuery clauses query getClauses queue new CellQueue clauses length for int clauses length SpansCell cell new SpansCell clauses getSpans reader ordered add cell public boolean next throws IOException if firstTime initList true firstTime false else if more else more false while more boolean queueStale false queueToList queueStale true while more first doc last doc queueStale true if more return false listToQueue queueStale false if atMatch return true more min next if more public boolean skipTo int target throws IOException initList false for SpansCell cell first more cell null cell cell next if more listToQueue firstTime false if min skipTo target queue adjustTop else more false return more atMatch next private SpansCell min return SpansCell queue top public int doc return min doc public int start return min start public int end return max end public String toString return getClass getName query toString firstTime more doc start end private void initList boolean next throws IOException for int more ordered size SpansCell cell SpansCell ordered get if next if more private void addToList SpansCell cell last next cell else first cell last cell cell next null private void firstToLast last first first first next last next null private void queueToList last first null while queue top null addToList SpansCell queue pop private void listToQueue for SpansCell cell first cell null cell cell next private boolean atMatch return min doc max doc max end min start totalLength slop public interface Fieldable extends Serializable void setBoost float boost float getBoost String name public String stringValue public Reader readerValue public byte binaryValue public TokenStream tokenStreamValue boolean isStored boolean isIndexed boolean isTokenized boolean isCompressed boolean isTermVectorStored boolean isStoreOffsetWithTermVector boolean isStorePositionWithTermVector boolean isBinary boolean getOmitNorms void setOmitNorms boolean omitNorms boolean isLazy public final class Hits private Weight weight private Searcher searcher private Filter filter null private Sort sort null Hits Searcher Query Filter throws IOException weight weight searcher filter Hits Searcher Query Filter Sort throws IOException weight weight searcher filter sort private final void getMoreDocs int min throws IOException if hitDocs size min min hitDocs size TopDocs topDocs sort null searcher search weight filter searcher search weight filter sort length topDocs totalHits ScoreDoc scoreDocs topDocs scoreDocs float scoreNorm if length topDocs getMaxScore scoreNorm topDocs getMaxScore int end scoreDocs length length scoreDocs length length for int hitDocs size end hitDocs addElement new HitDoc scoreDocs score scoreNorm scoreDocs doc public final int length return length public final Document doc int throws CorruptIndexException IOException HitDoc hitDoc hitDoc HitDoc oldLast last if hitDoc doc null return hitDoc doc public final float score int throws IOException return hitDoc score public final int id int throws IOException return hitDoc id public Iterator iterator return new HitIterator this private final HitDoc hitDoc int throws IOException if length throw new IndexOutOfBoundsException if hitDocs size getMoreDocs return HitDoc hitDocs elementAt if first null last hitDoc else first prev hitDoc hitDoc next first first hitDoc hitDoc prev null numDocs if hitDoc next null last hitDoc prev else hitDoc next prev hitDoc prev if hitDoc prev null first hitDoc next else hitDoc prev next hitDoc next numDocs final class HitDoc float score int id Document doc null HitDoc float int score id public class Token public int kind public int beginLine beginColumn endLine endColumn public String image public Token next public Token specialToken public String toString return image public static final Token newToken int ofKind switch ofKind default return new Token public class SpanTermQuery extends SpanQuery protected Term term public SpanTermQuery Term term this term term public Term getTerm return term public String getField return term field public Collection getTerms Collection terms new ArrayList terms add term return terms public void extractTerms Set terms terms add term public String toString String field StringBuffer buffer new StringBuffer if term field equals field buffer append term text else buffer append term toString buffer append ToStringUtils boost getBoost return buffer toString public boolean equals Object if instanceof SpanTermQuery return false SpanTermQuery other SpanTermQuery return this getBoost other getBoost this term equals other term public int hashCode return Float floatToIntBits getBoost term hashCode public Spans getSpans final IndexReader reader throws IOException return new TermSpans reader termPositions term term public abstract class StringHelper public static final int stringDifference String s1 String s2 int len1 s1 length int len2 s2 length int len len1 len2 len1 len2 for int len if s1 charAt s2 charAt return return len private StringHelper class RAMInputStream extends IndexInput implements Cloneable static final int BUFFER_SIZE RAMOutputStream BUFFER_SIZE private RAMFile file private long length private byte currentBuffer private int currentBufferIndex private int bufferPosition private long bufferStart private int bufferLength public RAMInputStream RAMFile file length file length currentBufferIndex currentBuffer null public void close public long length return length public byte readByte throws IOException if bufferPosition bufferLength currentBufferIndex switchCurrentBuffer return currentBuffer bufferPosition public void readBytes byte int offset int len throws IOException while len if bufferPosition bufferLength currentBufferIndex switchCurrentBuffer int remainInBuffer bufferLength bufferPosition int bytesToCopy len remainInBuffer len remainInBuffer System arraycopy currentBuffer bufferPosition offset bytesToCopy offset bytesToCopy len bytesToCopy bufferPosition bytesToCopy private final void switchCurrentBuffer throws IOException if currentBufferIndex file buffers size throw new IOException else currentBuffer byte file buffers get currentBufferIndex bufferPosition bufferStart BUFFER_SIZE currentBufferIndex bufferLength int length bufferStart if bufferLength BUFFER_SIZE bufferLength BUFFER_SIZE public long getFilePointer return currentBufferIndex bufferStart bufferPosition public void seek long pos throws IOException long bufferStart currentBufferIndex BUFFER_SIZE if pos bufferStart pos bufferStart BUFFER_SIZE currentBufferIndex int pos BUFFER_SIZE switchCurrentBuffer bufferPosition int pos BUFFER_SIZE public class CachingWrapperFilter extends Filter protected Filter filter protected transient Map cache public CachingWrapperFilter Filter filter this filter filter public BitSet bits IndexReader reader throws IOException if cache null cache new WeakHashMap BitSet cached BitSet cache get reader if cached null return cached final BitSet bits filter bits reader cache put reader bits return bits public String toString return filter public boolean equals Object if instanceof CachingWrapperFilter return false return this filter equals CachingWrapperFilter filter public int hashCode return filter hashCode public interface TermPositionVector extends TermFreqVector public int getTermPositions int index public TermVectorOffsetInfo getOffsets int index class RAMFile implements Serializable private static final long serialVersionUID ArrayList buffers new ArrayList long length RAMDirectory directory private long lastModified System currentTimeMillis RAMFile RAMFile RAMDirectory directory this directory directory synchronized long getLength return length synchronized void setLength long length this length length synchronized long getLastModified return lastModified synchronized void setLastModified long lastModified this lastModified lastModified final byte addBuffer int size byte buffer new byte size if directory null buffers add buffer directory sizeInBytes size sizeInBytes size else buffers add buffer return buffer long getSizeInBytes synchronized directory return sizeInBytes public final class StopFilter extends TokenFilter private final Set stopWords private final boolean ignoreCase public StopFilter TokenStream input String stopWords this input stopWords false public StopFilter TokenStream in String stopWords boolean ignoreCase super in this ignoreCase ignoreCase this stopWords makeStopSet stopWords ignoreCase public StopFilter TokenStream input Set stopWords boolean ignoreCase super input this ignoreCase ignoreCase this stopWords stopWords public StopFilter TokenStream in Set stopWords this in stopWords false public static final Set makeStopSet String stopWords return makeStopSet stopWords false public static final Set makeStopSet String stopWords boolean ignoreCase HashSet stopTable new HashSet stopWords length for int stopWords length stopTable add ignoreCase stopWords toLowerCase stopWords return stopTable public final Token next throws IOException for Token token input next token null token input next String termText ignoreCase token termText toLowerCase token termText if stopWords contains termText return token return null private final HeapedScorerDoc heap private final int maxSize private int size private class HeapedScorerDoc Scorer scorer int doc HeapedScorerDoc Scorer this doc HeapedScorerDoc Scorer scorer int doc this scorer scorer this doc doc void adjust doc scorer doc public ScorerDocQueue int maxSize size int heapSize maxSize heap new HeapedScorerDoc heapSize this maxSize maxSize public final void put Scorer scorer size heap size new HeapedScorerDoc scorer upHeap public boolean insert Scorer scorer if size maxSize put scorer return true else int docNr scorer doc heap new HeapedScorerDoc scorer docNr downHeap return true else return false public final Scorer top return topHSD scorer public final int topDoc return topHSD doc public final float topScore throws IOException return topHSD scorer score public final boolean topNextAndAdjustElsePop throws IOException return checkAdjustElsePop topHSD scorer next public final boolean topSkipToAndAdjustElsePop int target throws IOException return checkAdjustElsePop topHSD scorer skipTo target private boolean checkAdjustElsePop boolean cond topHSD doc topHSD scorer doc heap size null size downHeap return cond public final Scorer pop Scorer result topHSD scorer popNoResult return result private final void popNoResult heap size null size public final void adjustTop topHSD adjust downHeap public final int size return size public final void clear for int size heap null size private final void upHeap int size int while node doc heap doc topHSD heap private final void downHeap int int if size heap doc heap doc while size heap doc node doc if size heap doc heap doc topHSD heap public class DefaultSimilarity extends Similarity public float lengthNorm String fieldName int numTerms return float Math sqrt numTerms public float queryNorm float sumOfSquaredWeights return float Math sqrt sumOfSquaredWeights public float tf float freq return float Math sqrt freq public float sloppyFreq int distance return distance public float idf int docFreq int numDocs return float Math log numDocs double docFreq public float coord int overlap int maxOverlap return overlap float maxOverlap public class ConstantScoreRangeQuery extends Query private final String fieldName private final String lowerVal private final String upperVal private final boolean includeLower private final boolean includeUpper public ConstantScoreRangeQuery String fieldName String lowerVal String upperVal boolean includeLower boolean includeUpper if lowerVal null includeLower true else if includeLower lowerVal equals lowerVal null if upperVal null includeUpper true this lowerVal lowerVal this upperVal upperVal this includeLower includeLower this includeUpper includeUpper public String getField return fieldName public String getLowerVal return lowerVal public String getUpperVal return upperVal public boolean includesLower return includeLower public boolean includesUpper return includeUpper public Query rewrite IndexReader reader throws IOException RangeFilter rangeFilt new RangeFilter fieldName lowerVal null lowerVal upperVal lowerVal false includeLower upperVal null false includeUpper Query new ConstantScoreQuery rangeFilt setBoost getBoost return public String toString String field StringBuffer buffer new StringBuffer if getField equals field buffer append getField buffer append buffer append includeLower buffer append lowerVal null lowerVal buffer append buffer append upperVal null upperVal buffer append includeUpper if getBoost buffer append buffer append Float toString getBoost return buffer toString public boolean equals Object if this return true if instanceof ConstantScoreRangeQuery return false ConstantScoreRangeQuery other ConstantScoreRangeQuery this includeLower other includeLower this includeUpper other includeUpper return false if this lowerVal null this lowerVal equals other lowerVal other lowerVal null return false if this upperVal null this upperVal equals other upperVal other upperVal null return false return this getBoost other getBoost public int hashCode int Float floatToIntBits getBoost fieldName hashCode lowerVal null lowerVal hashCode upperVal null upperVal hashCode includeLower includeUpper return public abstract class TokenFilter extends TokenStream protected TokenStream input protected TokenFilter TokenStream input this input input public void close throws IOException input close final class PhraseQueue extends PriorityQueue PhraseQueue int size initialize size protected final boolean lessThan Object o1 Object o2 PhrasePositions pp1 PhrasePositions o1 PhrasePositions pp2 PhrasePositions o2 if pp1 doc pp2 doc if pp1 position pp2 position return pp1 offset pp2 offset else return pp1 position pp2 position else return pp1 doc pp2 doc public final class KeepOnlyLastCommitDeletionPolicy implements IndexDeletionPolicy public void onInit List commits onCommit commits public void onCommit List commits int size commits size for int size IndexCommitPoint commits get delete public class StandardAnalyzer extends Analyzer private Set stopSet public static final String STOP_WORDS StopAnalyzer ENGLISH_STOP_WORDS public StandardAnalyzer this STOP_WORDS public StandardAnalyzer Set stopWords stopSet stopWords public StandardAnalyzer String stopWords stopSet StopFilter makeStopSet stopWords public StandardAnalyzer File stopwords throws IOException stopSet WordlistLoader getWordSet stopwords public StandardAnalyzer Reader stopwords throws IOException stopSet WordlistLoader getWordSet stopwords public TokenStream tokenStream String fieldName Reader reader TokenStream result new StandardTokenizer reader result new StandardFilter result result new LowerCaseFilter result result new StopFilter result stopSet return result public class RAMOutputStream extends IndexOutput static final int BUFFER_SIZE private RAMFile file private byte currentBuffer private int currentBufferIndex private int bufferPosition private long bufferStart private int bufferLength public RAMOutputStream this new RAMFile RAMOutputStream RAMFile file currentBufferIndex currentBuffer null public void writeTo IndexOutput out throws IOException flush final long end file length long pos int buffer while pos end int length BUFFER_SIZE long nextPos pos length length int end pos out writeBytes byte file buffers get buffer length pos nextPos public void reset try seek throw new RuntimeException toString file setLength public void close throws IOException flush public void seek long pos throws IOException setFileLength if pos bufferStart pos bufferStart bufferLength currentBufferIndex int pos BUFFER_SIZE switchCurrentBuffer bufferPosition int pos BUFFER_SIZE public long length return file length public void writeByte byte throws IOException if bufferPosition bufferLength currentBufferIndex switchCurrentBuffer currentBuffer bufferPosition public void writeBytes byte int offset int len throws IOException while len if bufferPosition bufferLength currentBufferIndex switchCurrentBuffer int remainInBuffer currentBuffer length bufferPosition int bytesToCopy len remainInBuffer len remainInBuffer System arraycopy offset currentBuffer bufferPosition bytesToCopy offset bytesToCopy len bytesToCopy bufferPosition bytesToCopy private final void switchCurrentBuffer throws IOException if currentBufferIndex file buffers size currentBuffer file addBuffer BUFFER_SIZE else currentBuffer byte file buffers get currentBufferIndex bufferPosition bufferStart BUFFER_SIZE currentBufferIndex bufferLength currentBuffer length private void setFileLength long pointer bufferStart bufferPosition if pointer file length file setLength pointer public void flush throws IOException file setLastModified System currentTimeMillis setFileLength public long getFilePointer return currentBufferIndex bufferStart bufferPosition public class AlreadyClosedException extends IllegalStateException public AlreadyClosedException String message super message public interface Spans boolean next throws IOException boolean skipTo int target throws IOException int doc int start int end final class SegmentMergeInfo Term term int base TermEnum termEnum IndexReader reader SegmentMergeInfo int TermEnum te IndexReader throws IOException base reader termEnum te term te term int getDocMap if docMap null if reader hasDeletions int maxDoc reader maxDoc docMap new int maxDoc int for int maxDoc if reader isDeleted docMap else docMap return docMap TermPositions getPositions throws IOException if postings null postings reader termPositions return postings final boolean next throws IOException if termEnum next term termEnum term return true else term null return false final void close throws IOException termEnum close if postings null postings close class SegmentTermDocs implements TermDocs protected SegmentReader parent protected IndexInput freqStream protected int count protected int df protected BitVector deletedDocs int doc int freq private int skipInterval private int maxSkipLevels private DefaultSkipListReader skipListReader private long freqBasePointer private long proxBasePointer private long skipPointer private boolean haveSkipped protected boolean currentFieldStoresPayloads protected SegmentTermDocs SegmentReader parent this parent parent this freqStream IndexInput parent freqStream clone this deletedDocs parent deletedDocs this skipInterval parent tis getSkipInterval this maxSkipLevels parent tis getMaxSkipLevels public void seek Term term throws IOException TermInfo ti parent tis get term seek ti term public void seek TermEnum termEnum throws IOException TermInfo ti Term term SegmentTermEnum segmentTermEnum SegmentTermEnum termEnum term segmentTermEnum term ti segmentTermEnum termInfo term termEnum term ti parent tis get term seek ti term void seek TermInfo ti Term term throws IOException count FieldInfo fi parent fieldInfos fieldInfo term field currentFieldStoresPayloads fi null fi storePayloads false if ti null df else df ti docFreq doc freqBasePointer ti freqPointer proxBasePointer ti proxPointer skipPointer freqBasePointer ti skipOffset freqStream seek freqBasePointer haveSkipped false public void close throws IOException freqStream close if skipListReader null skipListReader close public final int doc return doc public final int freq return freq protected void skippingDoc throws IOException public boolean next throws IOException while true if count df return false int docCode freqStream readVInt else count if deletedDocs null deletedDocs get doc break skippingDoc return true public int read final int docs final int freqs throws IOException final int length docs length int while length count df final int docCode freqStream readVInt else count if deletedDocs null deletedDocs get doc docs doc freqs freq return protected void skipProx long proxPointer int payloadLength throws IOException public boolean skipTo int target throws IOException if skipListReader null skipListReader init skipPointer freqBasePointer proxBasePointer df currentFieldStoresPayloads haveSkipped true int newCount skipListReader skipTo target if newCount count freqStream seek skipListReader getFreqPointer skipProx skipListReader getProxPointer skipListReader getPayloadLength doc skipListReader getDoc count newCount do if next return false while target doc return true class CompoundFileReader extends Directory private int readBufferSize private static final class FileEntry long offset long length private Directory directory private String fileName private IndexInput stream private HashMap entries new HashMap public CompoundFileReader Directory dir String name throws IOException this dir name BufferedIndexInput BUFFER_SIZE public CompoundFileReader Directory dir String name int readBufferSize throws IOException directory dir fileName name this readBufferSize readBufferSize boolean success false try stream dir openInput name readBufferSize int count stream readVInt FileEntry entry null for int count long offset stream readLong String id stream readString if entry null entry length offset entry offset entry new FileEntry entry offset offset entries put id entry if entry null entry length stream length entry offset success true finally if success stream null try stream close catch IOException public Directory getDirectory return directory public String getName return fileName public synchronized void close throws IOException if stream null throw new IOException entries clear stream close stream null public synchronized IndexInput openInput String id throws IOException return openInput id readBufferSize public synchronized IndexInput openInput String id int readBufferSize throws IOException if stream null throw new IOException FileEntry entry FileEntry entries get id if entry null throw new IOException id return new CSIndexInput stream entry offset entry length readBufferSize public String list String res new String entries size return String entries keySet toArray res public boolean fileExists String name return entries containsKey name public long fileModified String name throws IOException return directory fileModified fileName public void touchFile String name throws IOException directory touchFile fileName public void deleteFile String name throw new UnsupportedOperationException public void renameFile String from String to throw new UnsupportedOperationException public long fileLength String name throws IOException FileEntry FileEntry entries get name if null throw new IOException name return length public IndexOutput createOutput String name throw new UnsupportedOperationException public Lock makeLock String name throw new UnsupportedOperationException static final class CSIndexInput extends BufferedIndexInput IndexInput base long fileOffset long length CSIndexInput final IndexInput base final long fileOffset final long length this base fileOffset length BufferedIndexInput BUFFER_SIZE CSIndexInput final IndexInput base final long fileOffset final long length int readBufferSize super readBufferSize this base base this fileOffset fileOffset this length length protected void readInternal byte int offset int len throws IOException synchronized base long start getFilePointer if start len length throw new IOException base seek fileOffset start base readBytes offset len protected void seekInternal long pos public void close public long length return length public class PhraseQuery extends Query private String field private Vector terms new Vector private Vector positions new Vector private int slop public PhraseQuery public void setSlop int slop public int getSlop return slop public void add Term term int position if positions size position Integer positions lastElement intValue add term position public void add Term term int position if terms size field term field else if term field field throw new IllegalArgumentException term terms addElement term positions addElement new Integer position public Term getTerms return Term terms toArray new Term public int getPositions int result new int positions size for int positions size result Integer positions elementAt intValue return result private class PhraseWeight implements Weight private Similarity similarity private float value private float idf private float queryNorm private float queryWeight public PhraseWeight Searcher searcher throws IOException this similarity getSimilarity searcher idf similarity idf terms searcher public String toString return PhraseQuery this public Query getQuery return PhraseQuery this public float getValue return value public float sumOfSquaredWeights public void normalize float queryNorm this queryNorm queryNorm public Scorer scorer IndexReader reader throws IOException return null TermPositions tps new TermPositions terms size for int terms size TermPositions reader termPositions Term terms elementAt if null return null tps return new ExactPhraseScorer this tps getPositions similarity reader norms field else return new SloppyPhraseScorer this tps getPositions similarity slop reader norms field public Explanation explain IndexReader reader int doc throws IOException Explanation result new Explanation result setDescription getQuery doc StringBuffer docFreqs new StringBuffer StringBuffer query new StringBuffer query append for int terms size if docFreqs append query append Term term Term terms elementAt docFreqs append term text docFreqs append docFreqs append reader docFreq term query append term text query append Explanation idfExpl new Explanation idf field docFreqs Explanation queryExpl new Explanation queryExpl setDescription getQuery Explanation boostExpl new Explanation getBoost if getBoost queryExpl addDetail boostExpl queryExpl addDetail idfExpl Explanation queryNormExpl new Explanation queryNorm queryExpl addDetail queryNormExpl queryExpl setValue boostExpl getValue idfExpl getValue queryNormExpl getValue result addDetail queryExpl Explanation fieldExpl new Explanation fieldExpl setDescription field query doc Explanation tfExpl scorer reader explain doc fieldExpl addDetail tfExpl fieldExpl addDetail idfExpl Explanation fieldNormExpl new Explanation byte fieldNorms reader norms field float fieldNorm fieldNorms null Similarity decodeNorm fieldNorms doc fieldNormExpl setValue fieldNorm fieldNormExpl setDescription field doc fieldExpl addDetail fieldNormExpl fieldExpl setValue tfExpl getValue idfExpl getValue fieldNormExpl getValue result addDetail fieldExpl result setValue queryExpl getValue fieldExpl getValue if queryExpl getValue return fieldExpl return result protected Weight createWeight Searcher searcher throws IOException Term term Term terms elementAt Query termQuery new TermQuery term termQuery setBoost getBoost return termQuery createWeight searcher return new PhraseWeight searcher public void extractTerms Set queryTerms queryTerms addAll terms public String toString String StringBuffer buffer new StringBuffer if field equals buffer append field buffer append buffer append for int terms size buffer append Term terms elementAt text if terms size buffer append buffer append if slop buffer append buffer append slop buffer append ToStringUtils boost getBoost return buffer toString public boolean equals Object if instanceof PhraseQuery return false PhraseQuery other PhraseQuery return this getBoost other getBoost this slop other slop this terms equals other terms this positions equals other positions public int hashCode return Float floatToIntBits getBoost slop terms hashCode positions hashCode public final class WhitespaceAnalyzer extends Analyzer public TokenStream tokenStream String fieldName Reader reader return new WhitespaceTokenizer reader public class QueryTermVector implements TermFreqVector private String terms new String private int termFreqs new int public String getField return null public QueryTermVector String queryTerms processTerms queryTerms public QueryTermVector String queryString Analyzer analyzer if analyzer null TokenStream stream analyzer tokenStream new StringReader queryString if stream null Token next null List terms new ArrayList try while next stream next null terms add next termText processTerms String terms toArray new String terms size catch IOException private void processTerms String queryTerms if queryTerms null Arrays sort queryTerms Map tmpSet new HashMap queryTerms length List tmpList new ArrayList queryTerms length List tmpFreqs new ArrayList queryTerms length int for int queryTerms length String term queryTerms Integer position Integer tmpSet get term if position null tmpSet put term new Integer tmpList add term tmpFreqs add new Integer else Integer integer Integer tmpFreqs get position intValue tmpFreqs set position intValue new Integer integer intValue terms String tmpList toArray terms termFreqs new int tmpFreqs size int for Iterator iter tmpFreqs iterator iter hasNext Integer integer Integer iter next termFreqs integer intValue public final String toString StringBuffer sb new StringBuffer sb append for int terms length if sb append sb append terms append append termFreqs sb append return sb toString public int size return terms length public String getTerms return terms public int getTermFrequencies return termFreqs public int indexOf String term int res Arrays binarySearch terms term return res res public int indexesOf String terms int start int len int res new int len for int len res indexOf terms return res public class TokenMgrError extends Error static final int LEXICAL_ERROR static final int STATIC_LEXER_ERROR static final int INVALID_LEXICAL_STATE static final int LOOP_DETECTED int errorCode protected static final String addEscapes String str StringBuffer retval new StringBuffer char ch for int str length switch str charAt case continue case retval append continue case retval append continue case retval append continue case retval append continue case retval append continue case retval append continue case retval append continue case retval append continue default if ch str charAt ch String Integer toString ch retval append substring length length else retval append ch continue return retval toString protected static String LexicalError boolean EOFSeen int lexState int errorLine int errorColumn String errorAfter char curChar return errorLine errorColumn EOFSeen addEscapes String valueOf curChar int curChar addEscapes errorAfter public String getMessage return super getMessage public TokenMgrError public TokenMgrError String message int reason super message errorCode reason public TokenMgrError boolean EOFSeen int lexState int errorLine int errorColumn String errorAfter char curChar int reason this LexicalError EOFSeen lexState errorLine errorColumn errorAfter curChar reason final class FieldsWriter static final byte FIELD_IS_TOKENIZED static final byte FIELD_IS_BINARY static final byte FIELD_IS_COMPRESSED private FieldInfos fieldInfos private IndexOutput fieldsStream private IndexOutput indexStream FieldsWriter Directory String segment FieldInfos fn throws IOException fieldInfos fn fieldsStream createOutput segment indexStream createOutput segment final void close throws IOException fieldsStream close indexStream close final void addDocument Document doc throws IOException indexStream writeLong fieldsStream getFilePointer int storedCount Iterator fieldIterator doc getFields iterator while fieldIterator hasNext Fieldable field Fieldable fieldIterator next if field isStored storedCount fieldsStream writeVInt storedCount fieldIterator doc getFields iterator while fieldIterator hasNext Fieldable field Fieldable fieldIterator next boolean disableCompression field instanceof FieldsReader FieldForMerge if field isStored fieldsStream writeVInt fieldInfos fieldNumber field name byte bits if field isTokenized bits FieldsWriter FIELD_IS_TOKENIZED if field isBinary bits FieldsWriter FIELD_IS_BINARY if field isCompressed bits FieldsWriter FIELD_IS_COMPRESSED fieldsStream writeByte bits if field isCompressed byte data null if disableCompression data field binaryValue else if field isBinary data compress field binaryValue else data compress field stringValue getBytes final int len data length fieldsStream writeVInt len fieldsStream writeBytes data len else if field isBinary byte data field binaryValue final int len data length fieldsStream writeVInt len fieldsStream writeBytes data len else fieldsStream writeString field stringValue private final byte compress byte input Deflater compressor new Deflater compressor setLevel Deflater BEST_COMPRESSION compressor setInput input compressor finish ByteArrayOutputStream bos new ByteArrayOutputStream input length byte buf new byte while compressor finished int count compressor deflate buf bos write buf count compressor end return bos toByteArray final class SegmentTermPositions extends SegmentTermDocs implements TermPositions private IndexInput proxStream private int proxCount private int position private int payloadLength private boolean needToLoadPayload private long lazySkipPointer private int lazySkipProxCount SegmentTermPositions SegmentReader super final void seek TermInfo ti Term term throws IOException super seek ti term if ti null lazySkipPointer ti proxPointer lazySkipProxCount proxCount payloadLength needToLoadPayload false public final void close throws IOException super close if proxStream null proxStream close public final int nextPosition throws IOException lazySkip proxCount return position readDeltaPosition private final int readDeltaPosition throws IOException int delta proxStream readVInt if currentFieldStoresPayloads if delta payloadLength proxStream readVInt delta needToLoadPayload true else payloadLength needToLoadPayload false return delta protected final void skippingDoc throws IOException lazySkipProxCount freq public final boolean next throws IOException lazySkipProxCount proxCount return true return false public final int read final int docs final int freqs throw new UnsupportedOperationException protected void skipProx long proxPointer int payloadLength throws IOException lazySkipPointer proxPointer lazySkipProxCount proxCount this payloadLength payloadLength needToLoadPayload false private void skipPositions int throws IOException readDeltaPosition skipPayload private void skipPayload throws IOException if needToLoadPayload payloadLength proxStream seek proxStream getFilePointer payloadLength needToLoadPayload false private void lazySkip throws IOException if proxStream null proxStream IndexInput parent proxStream clone skipPayload if lazySkipPointer proxStream seek lazySkipPointer lazySkipPointer if lazySkipProxCount skipPositions lazySkipProxCount lazySkipProxCount public int getPayloadLength return payloadLength public byte getPayload byte data int offset throws IOException if needToLoadPayload throw new IOException byte retArray int retOffset if data null data length offset payloadLength retArray new byte payloadLength retOffset else retArray data retOffset offset proxStream readBytes retArray retOffset payloadLength needToLoadPayload false return retArray public boolean isPayloadAvailable return needToLoadPayload payloadLength public abstract class IndexInput implements Cloneable public abstract byte readByte throws IOException public abstract void readBytes byte int offset int len throws IOException public int readInt throws IOException return readByte readByte readByte readByte public int readVInt throws IOException byte readByte int for int shift shift readByte shift return public long readLong throws IOException return long readInt readInt public long readVLong throws IOException byte readByte long for int shift shift readByte shift return public String readString throws IOException int length readVInt if chars null length chars length chars new char length readChars chars length return new String chars length public void readChars char buffer int start int length throws IOException final int end start length for int start end byte readByte if buffer char else if buffer char readByte else buffer char readByte readByte public void skipChars int length throws IOException for int length byte readByte if else if else readByte readByte public abstract void close throws IOException public abstract long getFilePointer public abstract void seek long pos throws IOException public abstract long length public Object clone IndexInput clone null try clone IndexInput super clone catch CloneNotSupportedException clone chars null return clone public abstract class TokenStream public abstract Token next throws IOException public void reset throws IOException public void close throws IOException final class ExactPhraseScorer extends PhraseScorer ExactPhraseScorer Weight weight TermPositions tps int offsets Similarity similarity byte norms super weight tps offsets similarity norms protected final float phraseFreq throws IOException pq clear for PhrasePositions pp first pp null pp pp next pp firstPosition int freq do if first nextPosition return float freq while first position last position firstToLast while last nextPosition return float freq public class RangeFilter extends Filter private String fieldName private String lowerTerm private String upperTerm private boolean includeLower private boolean includeUpper public RangeFilter String fieldName String lowerTerm String upperTerm boolean includeLower boolean includeUpper this fieldName fieldName this lowerTerm lowerTerm this upperTerm upperTerm this includeLower includeLower this includeUpper includeUpper if null lowerTerm null upperTerm throw new IllegalArgumentException if includeLower null lowerTerm throw new IllegalArgumentException if includeUpper null upperTerm throw new IllegalArgumentException public static RangeFilter Less String fieldName String upperTerm return new RangeFilter fieldName null upperTerm false true public static RangeFilter More String fieldName String lowerTerm return new RangeFilter fieldName lowerTerm null true false public BitSet bits IndexReader reader throws IOException BitSet bits new BitSet reader maxDoc TermEnum enumerator null lowerTerm reader terms new Term fieldName lowerTerm reader terms new Term fieldName try if enumerator term null return bits boolean checkLower false checkLower true TermDocs termDocs reader termDocs try do Term term enumerator term if term null term field equals fieldName if checkLower null lowerTerm term text compareTo lowerTerm checkLower false if upperTerm null int compare upperTerm compareTo term text if compare includeUpper compare break termDocs seek enumerator term while termDocs next bits set termDocs doc else break while enumerator next finally termDocs close finally enumerator close return bits public String toString StringBuffer buffer new StringBuffer buffer append fieldName buffer append buffer append includeLower if null lowerTerm buffer append lowerTerm buffer append if null upperTerm buffer append upperTerm buffer append includeUpper return buffer toString public boolean equals Object if this return true if instanceof RangeFilter return false RangeFilter other RangeFilter if this fieldName equals other fieldName this includeLower other includeLower this includeUpper other includeUpper return false if this lowerTerm null this lowerTerm equals other lowerTerm other lowerTerm null return false if this upperTerm null this upperTerm equals other upperTerm other upperTerm null return false return true public int hashCode int fieldName hashCode lowerTerm null lowerTerm hashCode upperTerm null upperTerm hashCode includeLower includeUpper return public class ReverseOrdFieldSource extends ValueSource public String field public ReverseOrdFieldSource String field this field field public String description return field public DocValues getValues IndexReader reader throws IOException final FieldCache StringIndex sindex FieldCache DEFAULT getStringIndex reader field final int arr sindex order final int end sindex lookup length return new DocValues arr length public float floatVal int doc return float end arr doc public int intVal int doc return end arr doc public String strVal int doc return Integer toString intVal doc public String toString int doc return description strVal doc Object getInnerArray return arr public boolean equals Object if getClass ReverseOrdFieldSource class return false ReverseOrdFieldSource other ReverseOrdFieldSource return this field equals other field private static final int hcode ReverseOrdFieldSource class hashCode public int hashCode return hcode field hashCode public class ReqExclScorer extends Scorer private Scorer reqScorer exclScorer public ReqExclScorer Scorer reqScorer Scorer exclScorer this reqScorer reqScorer this exclScorer exclScorer private boolean firstTime true public boolean next throws IOException if firstTime if exclScorer next firstTime false if reqScorer null return false if reqScorer next return false if exclScorer null return toNonExcluded private boolean toNonExcluded throws IOException int exclDoc exclScorer doc do if reqDoc exclDoc else if reqDoc exclDoc if exclScorer skipTo reqDoc return true exclDoc exclScorer doc if exclDoc reqDoc while reqScorer next return false public int doc public float score throws IOException public boolean skipTo int target throws IOException if firstTime firstTime false if exclScorer skipTo target if reqScorer null return false if exclScorer null return reqScorer skipTo target if reqScorer skipTo target reqScorer null return false return toNonExcluded public Explanation explain int doc throws IOException Explanation res new Explanation if exclScorer skipTo doc exclScorer doc doc res setDescription else res setDescription res addDetail reqScorer explain doc return res public final class PorterStemFilter extends TokenFilter private PorterStemmer stemmer public PorterStemFilter TokenStream in super in stemmer new PorterStemmer public final Token next throws IOException Token token input next if token null return null else String stemmer stem token termText token termText return token public class IndexModifier protected IndexWriter indexWriter null protected IndexReader indexReader null protected Directory directory null protected Analyzer analyzer null protected boolean open false protected PrintStream infoStream null protected boolean useCompoundFile true protected int maxBufferedDocs IndexWriter DEFAULT_MAX_BUFFERED_DOCS protected int maxFieldLength IndexWriter DEFAULT_MAX_FIELD_LENGTH protected int mergeFactor IndexWriter DEFAULT_MERGE_FACTOR public IndexModifier Directory directory Analyzer analyzer boolean create throws CorruptIndexException LockObtainFailedException IOException init directory analyzer create public IndexModifier String dirName Analyzer analyzer boolean create throws CorruptIndexException LockObtainFailedException IOException Directory dir FSDirectory getDirectory dirName init dir analyzer create public IndexModifier File file Analyzer analyzer boolean create throws CorruptIndexException LockObtainFailedException IOException Directory dir FSDirectory getDirectory file init dir analyzer create protected void init Directory directory Analyzer analyzer boolean create throws CorruptIndexException LockObtainFailedException IOException this directory directory synchronized this directory this analyzer analyzer indexWriter new IndexWriter directory analyzer create open true protected void assureOpen if open throw new IllegalStateException protected void createIndexWriter throws CorruptIndexException LockObtainFailedException IOException if indexWriter null if indexReader null indexReader close indexReader null indexWriter new IndexWriter directory analyzer false indexWriter setInfoStream infoStream indexWriter setUseCompoundFile useCompoundFile indexWriter setMaxBufferedDocs maxBufferedDocs indexWriter setMaxFieldLength maxFieldLength indexWriter setMergeFactor mergeFactor protected void createIndexReader throws CorruptIndexException IOException if indexReader null if indexWriter null indexWriter close indexWriter null indexReader IndexReader open directory public void flush throws CorruptIndexException LockObtainFailedException IOException synchronized directory assureOpen if indexWriter null indexWriter close indexWriter null createIndexWriter else indexReader close indexReader null createIndexReader public void addDocument Document doc Analyzer docAnalyzer throws CorruptIndexException LockObtainFailedException IOException synchronized directory assureOpen createIndexWriter if docAnalyzer null indexWriter addDocument doc docAnalyzer else indexWriter addDocument doc public void addDocument Document doc throws CorruptIndexException LockObtainFailedException IOException addDocument doc null public int deleteDocuments Term term throws StaleReaderException CorruptIndexException LockObtainFailedException IOException synchronized directory assureOpen createIndexReader return indexReader deleteDocuments term public void deleteDocument int docNum throws StaleReaderException CorruptIndexException LockObtainFailedException IOException synchronized directory assureOpen createIndexReader indexReader deleteDocument docNum public int docCount synchronized directory assureOpen if indexWriter null return indexWriter docCount else return indexReader numDocs public void optimize throws CorruptIndexException LockObtainFailedException IOException synchronized directory assureOpen createIndexWriter indexWriter optimize public void setInfoStream PrintStream infoStream synchronized directory assureOpen if indexWriter null indexWriter setInfoStream infoStream this infoStream infoStream public PrintStream getInfoStream throws CorruptIndexException LockObtainFailedException IOException synchronized directory assureOpen createIndexWriter return indexWriter getInfoStream public void setUseCompoundFile boolean useCompoundFile synchronized directory assureOpen if indexWriter null indexWriter setUseCompoundFile useCompoundFile this useCompoundFile useCompoundFile public boolean getUseCompoundFile throws CorruptIndexException LockObtainFailedException IOException synchronized directory assureOpen createIndexWriter return indexWriter getUseCompoundFile public void setMaxFieldLength int maxFieldLength synchronized directory assureOpen if indexWriter null indexWriter setMaxFieldLength maxFieldLength this maxFieldLength maxFieldLength public int getMaxFieldLength throws CorruptIndexException LockObtainFailedException IOException synchronized directory assureOpen createIndexWriter return indexWriter getMaxFieldLength public void setMaxBufferedDocs int maxBufferedDocs synchronized directory assureOpen if indexWriter null indexWriter setMaxBufferedDocs maxBufferedDocs this maxBufferedDocs maxBufferedDocs public int getMaxBufferedDocs throws CorruptIndexException LockObtainFailedException IOException synchronized directory assureOpen createIndexWriter return indexWriter getMaxBufferedDocs public void setMergeFactor int mergeFactor synchronized directory assureOpen if indexWriter null indexWriter setMergeFactor mergeFactor this mergeFactor mergeFactor public int getMergeFactor throws CorruptIndexException LockObtainFailedException IOException synchronized directory assureOpen createIndexWriter return indexWriter getMergeFactor public void close throws CorruptIndexException IOException synchronized directory if open throw new IllegalStateException if indexWriter null indexWriter close indexWriter null else indexReader close indexReader null open false public String toString return directory final class SegmentTermEnum extends TermEnum implements Cloneable private IndexInput input FieldInfos fieldInfos long size long position private TermBuffer termBuffer new TermBuffer private TermBuffer prevBuffer new TermBuffer private TermInfo termInfo new TermInfo private int format private boolean isIndex false long indexPointer int indexInterval int skipInterval int maxSkipLevels private int formatM1SkipInterval SegmentTermEnum IndexInput FieldInfos fis boolean isi throws CorruptIndexException IOException input fieldInfos fis isIndex isi int firstInt input readInt if firstInt format size firstInt indexInterval else format firstInt if format TermInfosWriter FORMAT throw new CorruptIndexException format if format if isIndex indexInterval input readInt formatM1SkipInterval input readInt skipInterval Integer MAX_VALUE else indexInterval input readInt skipInterval input readInt if format maxSkipLevels input readInt protected Object clone SegmentTermEnum clone null try clone SegmentTermEnum super clone catch CloneNotSupportedException clone input IndexInput input clone clone termInfo new TermInfo termInfo clone termBuffer TermBuffer termBuffer clone clone prevBuffer TermBuffer prevBuffer clone clone scratch null return clone final void seek long pointer int Term TermInfo ti throws IOException input seek pointer position termBuffer set prevBuffer reset termInfo set ti public final boolean next throws IOException if position size termBuffer reset return false prevBuffer set termBuffer termBuffer read input fieldInfos if format if isIndex if termInfo docFreq formatM1SkipInterval termInfo skipOffset input readVInt else if termInfo docFreq skipInterval termInfo skipOffset input readVInt if isIndex return true final void scanTo Term term throws IOException if scratch null scratch new TermBuffer scratch set term while scratch compareTo termBuffer next public final Term term return termBuffer toTerm final Term prev return prevBuffer toTerm final TermInfo termInfo return new TermInfo termInfo final void termInfo TermInfo ti ti set termInfo public final int docFreq return termInfo docFreq final long freqPointer return termInfo freqPointer final long proxPointer return termInfo proxPointer public final void close throws IOException input close public class ParseException extends java io IOException public ParseException Token currentTokenVal int expectedTokenSequencesVal String tokenImageVal super specialConstructor true currentToken currentTokenVal expectedTokenSequences expectedTokenSequencesVal tokenImage tokenImageVal public ParseException super specialConstructor false public ParseException String message super message specialConstructor false protected boolean specialConstructor public Token currentToken public int expectedTokenSequences public String tokenImage public String getMessage if specialConstructor return super getMessage String expected int maxSize for int expectedTokenSequences length if maxSize expectedTokenSequences length maxSize expectedTokenSequences length for int expectedTokenSequences length expected tokenImage expectedTokenSequences if expectedTokenSequences expectedTokenSequences length expected expected eol String retval Token tok currentToken next for int maxSize if retval if tok kind retval tokenImage break retval add_escapes tok image tok tok next retval currentToken next beginLine currentToken next beginColumn eol if expectedTokenSequences length retval eol else retval eol retval expected return retval protected String eol System getProperty protected String add_escapes String str StringBuffer retval new StringBuffer char ch for int str length switch str charAt case continue case retval append continue case retval append continue case retval append continue case retval append continue case retval append continue case retval append continue case retval append continue case retval append continue default if ch str charAt ch String Integer toString ch retval append substring length length else retval append ch continue return retval toString class SegmentTermPositionVector extends SegmentTermVector implements TermPositionVector protected int positions protected TermVectorOffsetInfo offsets public static final int EMPTY_TERM_POS new int public SegmentTermPositionVector String field String terms int termFreqs int positions TermVectorOffsetInfo offsets super field terms termFreqs this offsets offsets this positions positions public TermVectorOffsetInfo getOffsets int index TermVectorOffsetInfo result TermVectorOffsetInfo EMPTY_OFFSET_INFO if offsets null return null if index index offsets length result offsets index return result public int getTermPositions int index int result EMPTY_TERM_POS if positions null return null if index index positions length result positions index return result public class CustomScoreQuery extends Query private Query subQuery public CustomScoreQuery Query subQuery this subQuery null public CustomScoreQuery Query subQuery ValueSourceQuery valSrcQuery super this subQuery subQuery this valSrcQuery valSrcQuery if subQuery null throw new IllegalArgumentException public Query rewrite IndexReader reader throws IOException subQuery subQuery rewrite reader if valSrcQuery null valSrcQuery ValueSourceQuery valSrcQuery rewrite reader return this public void extractTerms Set terms subQuery extractTerms terms if valSrcQuery null valSrcQuery extractTerms terms public Object clone CustomScoreQuery clone CustomScoreQuery super clone clone subQuery Query subQuery clone if valSrcQuery null clone valSrcQuery ValueSourceQuery valSrcQuery clone return clone public String toString String field StringBuffer sb new StringBuffer name append sb append subQuery toString field if valSrcQuery null sb append append valSrcQuery toString field sb append sb append strict return sb toString ToStringUtils boost getBoost public boolean equals Object if getClass getClass return false CustomScoreQuery other CustomScoreQuery return this getBoost other getBoost this subQuery equals other subQuery this valSrcQuery null other valSrcQuery null this valSrcQuery equals other valSrcQuery public int hashCode int valSrcHash valSrcQuery null valSrcQuery hashCode return getClass hashCode subQuery hashCode valSrcHash Float floatToIntBits getBoost public float customScore int doc float subQueryScore float valSrcScore return valSrcScore subQueryScore public Explanation customExplain int doc Explanation subQueryExpl Explanation valSrcExpl float valSrcScore valSrcExpl null valSrcExpl getValue Explanation exp new Explanation valSrcScore subQueryExpl getValue exp addDetail subQueryExpl if valSrcExpl null exp addDetail valSrcExpl return exp private class CustomWeight implements Weight Searcher searcher Weight subQueryWeight boolean qStrict public CustomWeight Searcher searcher throws IOException this searcher searcher this subQueryWeight subQuery weight searcher if valSrcQuery null this valSrcWeight valSrcQuery createWeight searcher this qStrict strict public Query getQuery return CustomScoreQuery this public float getValue return getBoost public float sumOfSquaredWeights throws IOException float sum subQueryWeight sumOfSquaredWeights if valSrcWeight null if qStrict else sum valSrcWeight sumOfSquaredWeights return sum public void normalize float norm subQueryWeight normalize norm if valSrcWeight null if qStrict else valSrcWeight normalize norm public Scorer scorer IndexReader reader throws IOException Scorer subQueryScorer subQueryWeight scorer reader Scorer valSrcScorer valSrcWeight null null valSrcWeight scorer reader return new CustomScorer getSimilarity searcher reader this subQueryScorer valSrcScorer public Explanation explain IndexReader reader int doc throws IOException return scorer reader explain doc private class CustomScorer extends Scorer private final CustomWeight weight private final float qWeight private Scorer subQueryScorer private IndexReader reader private CustomScorer Similarity similarity IndexReader reader CustomWeight Scorer subQueryScorer Scorer valSrcScorer throws IOException super similarity this weight this qWeight getValue this subQueryScorer subQueryScorer this valSrcScorer valSrcScorer this reader reader public boolean next throws IOException boolean hasNext subQueryScorer next if valSrcScorer null hasNext valSrcScorer skipTo subQueryScorer doc return hasNext public int doc return subQueryScorer doc public float score throws IOException float valSrcScore valSrcScorer null valSrcScorer score return qWeight customScore subQueryScorer doc subQueryScorer score valSrcScore public boolean skipTo int target throws IOException boolean hasNext subQueryScorer skipTo target if valSrcScorer null hasNext valSrcScorer skipTo subQueryScorer doc return hasNext public Explanation explain int doc throws IOException Explanation subQueryExpl weight subQueryWeight explain reader doc if subQueryExpl isMatch return subQueryExpl Explanation valSrcExpl valSrcScorer null null valSrcScorer explain doc Explanation customExp customExplain doc subQueryExpl valSrcExpl float sc qWeight customExp getValue Explanation res new ComplexExplanation true sc CustomScoreQuery this toString res addDetail customExp return res protected Weight createWeight Searcher searcher throws IOException return new CustomWeight searcher public boolean isStrict return strict public void setStrict boolean strict this strict strict public String name return final class HitQueue extends PriorityQueue HitQueue int size initialize size protected final boolean lessThan Object Object ScoreDoc hitA ScoreDoc ScoreDoc hitB ScoreDoc if hitA score hitB score return hitA doc hitB doc else return hitA score hitB score public abstract class LockFactory protected String lockPrefix public void setLockPrefix String lockPrefix this lockPrefix lockPrefix public String getLockPrefix return this lockPrefix public abstract Lock makeLock String lockName abstract public void clearLock String lockName throws IOException class NonMatchingScorer extends Scorer public int doc throw new UnsupportedOperationException public boolean next throws IOException return false public float score throw new UnsupportedOperationException public boolean skipTo int target return false public Explanation explain int doc Explanation new Explanation setDescription return public class StaleReaderException extends IOException public StaleReaderException String message super message public class TopFieldDocs extends TopDocs public SortField fields TopFieldDocs int totalHits ScoreDoc scoreDocs SortField fields float maxScore super totalHits scoreDocs maxScore this fields fields public class SpanWeight implements Weight protected Similarity similarity protected float value protected float idf protected float queryNorm protected float queryWeight protected Set terms protected SpanQuery query public SpanWeight SpanQuery query Searcher searcher throws IOException this similarity query getSimilarity searcher this query query terms new HashSet query extractTerms terms idf this query getSimilarity searcher idf terms searcher public Query getQuery return query public float getValue return value public float sumOfSquaredWeights throws IOException public void normalize float queryNorm this queryNorm queryNorm public Scorer scorer IndexReader reader throws IOException return new SpanScorer query getSpans reader this similarity reader norms query getField public Explanation explain IndexReader reader int doc throws IOException ComplexExplanation result new ComplexExplanation result setDescription getQuery doc String field SpanQuery getQuery getField StringBuffer docFreqs new StringBuffer Iterator terms iterator while hasNext Term term Term next docFreqs append term text docFreqs append docFreqs append reader docFreq term if hasNext docFreqs append Explanation idfExpl new Explanation idf field docFreqs Explanation queryExpl new Explanation queryExpl setDescription getQuery Explanation boostExpl new Explanation getQuery getBoost if getQuery getBoost queryExpl addDetail boostExpl queryExpl addDetail idfExpl Explanation queryNormExpl new Explanation queryNorm queryExpl addDetail queryNormExpl queryExpl setValue boostExpl getValue idfExpl getValue queryNormExpl getValue result addDetail queryExpl ComplexExplanation fieldExpl new ComplexExplanation fieldExpl setDescription field query toString field doc Explanation tfExpl scorer reader explain doc fieldExpl addDetail tfExpl fieldExpl addDetail idfExpl Explanation fieldNormExpl new Explanation byte fieldNorms reader norms field float fieldNorm fieldNorms null Similarity decodeNorm fieldNorms doc fieldNormExpl setValue fieldNorm fieldNormExpl setDescription field doc fieldExpl addDetail fieldNormExpl fieldExpl setMatch Boolean valueOf tfExpl isMatch fieldExpl setValue tfExpl getValue idfExpl getValue fieldNormExpl getValue result addDetail fieldExpl result setMatch fieldExpl getMatch result setValue queryExpl getValue fieldExpl getValue if queryExpl getValue return fieldExpl return result class DefaultSkipListWriter extends MultiLevelSkipListWriter private int lastSkipDoc private int lastSkipPayloadLength private long lastSkipFreqPointer private long lastSkipProxPointer private IndexOutput freqOutput private IndexOutput proxOutput private int curDoc private boolean curStorePayloads private int curPayloadLength private long curFreqPointer private long curProxPointer DefaultSkipListWriter int skipInterval int numberOfSkipLevels int docCount IndexOutput freqOutput IndexOutput proxOutput super skipInterval numberOfSkipLevels docCount this freqOutput freqOutput this proxOutput proxOutput lastSkipDoc new int numberOfSkipLevels lastSkipPayloadLength new int numberOfSkipLevels lastSkipFreqPointer new long numberOfSkipLevels lastSkipProxPointer new long numberOfSkipLevels void setSkipData int doc boolean storePayloads int payloadLength this curDoc doc this curStorePayloads storePayloads this curPayloadLength payloadLength this curFreqPointer freqOutput getFilePointer this curProxPointer proxOutput getFilePointer protected void resetSkip super resetSkip Arrays fill lastSkipDoc Arrays fill lastSkipFreqPointer freqOutput getFilePointer Arrays fill lastSkipProxPointer proxOutput getFilePointer protected void writeSkipData int level IndexOutput skipBuffer throws IOException if curStorePayloads int delta curDoc lastSkipDoc level if curPayloadLength lastSkipPayloadLength level skipBuffer writeVInt delta else skipBuffer writeVInt delta skipBuffer writeVInt curPayloadLength lastSkipPayloadLength level curPayloadLength else skipBuffer writeVInt curDoc lastSkipDoc level skipBuffer writeVInt int curFreqPointer lastSkipFreqPointer level skipBuffer writeVInt int curProxPointer lastSkipProxPointer level lastSkipDoc level curDoc lastSkipFreqPointer level curFreqPointer lastSkipProxPointer level curProxPointer public interface StandardTokenizerConstants int EOF int ALPHANUM int APOSTROPHE int ACRONYM int COMPANY int EMAIL int HOST int NUM int int HAS_DIGIT int ALPHA int LETTER int CJ int KOREAN int DIGIT int NOISE int DEFAULT String tokenImage public class QueryParserTokenManager implements QueryParserConstants public java io PrintStream debugStream System out public void setDebugStream java io PrintStream ds debugStream ds private final int jjStopStringLiteralDfa_3 int pos long active0 switch pos default return private final int jjStartNfa_3 int pos long active0 return jjMoveNfa_3 jjStopStringLiteralDfa_3 pos active0 pos private final int jjStopAtPos int pos int kind jjmatchedKind kind jjmatchedPos pos return pos private final int jjStartNfaWithStates_3 int pos int kind int state jjmatchedKind kind jjmatchedPos pos try curChar input_stream readChar catch java io IOException return pos return jjMoveNfa_3 state pos private final int jjMoveStringLiteralDfa0_3 switch curChar case return jjStopAtPos case return jjStopAtPos case return jjStartNfaWithStates_3 case return jjStopAtPos case return jjStopAtPos case return jjStopAtPos case return jjStopAtPos case return jjStopAtPos case return jjStopAtPos default return jjMoveNfa_3 private final void jjCheckNAdd int state if jjrounds state jjround jjstateSet jjnewStateCnt state jjrounds state jjround private final void jjAddStates int start int end do jjstateSet jjnewStateCnt jjnextStates start while start end private final void jjCheckNAddTwoStates int state1 int state2 jjCheckNAdd state1 jjCheckNAdd state2 private final void jjCheckNAddStates int start int end do jjCheckNAdd jjnextStates start while start end private final void jjCheckNAddStates int start jjCheckNAdd jjnextStates start jjCheckNAdd jjnextStates start static final long jjbitVec0 static final long jjbitVec2 private final int jjMoveNfa_3 int startState int curPos int nextStates int startsAt jjnewStateCnt int jjstateSet startState int kind for if jjround ReInitRounds if curChar long curChar MatchLoop do switch jjstateSet case case if break if kind kind jjCheckNAddTwoStates break case if if kind kind jjCheckNAddTwoStates else if if kind kind else if curChar jjCheckNAddTwoStates else if curChar if kind kind if if kind kind jjCheckNAddStates else if curChar if kind kind if curChar jjstateSet jjnewStateCnt break case if curChar kind kind break case if curChar jjstateSet jjnewStateCnt break case if curChar kind kind break case if curChar jjCheckNAddTwoStates break case if jjCheckNAddStates break case if curChar jjCheckNAddStates break case if curChar kind kind break case if break if kind kind jjAddStates break case if curChar jjCheckNAdd break case if break if kind kind jjCheckNAdd break case if curChar kind kind break case if break if kind kind jjCheckNAddTwoStates break case if kind kind jjCheckNAddTwoStates break case if break if kind kind jjCheckNAddStates break case if break if kind kind jjCheckNAddTwoStates break case if kind kind jjCheckNAddTwoStates break case if jjCheckNAddStates break case jjCheckNAddStates break default break while startsAt else if curChar long curChar MatchLoop do switch jjstateSet case if if kind kind jjCheckNAddTwoStates else if curChar jjCheckNAddTwoStates break case if if kind kind jjCheckNAddStates else if curChar jjCheckNAddStates else if curChar if kind kind jjstateSet jjnewStateCnt if if kind kind jjCheckNAddTwoStates if curChar jjstateSet jjnewStateCnt else if curChar jjstateSet jjnewStateCnt else if curChar jjstateSet jjnewStateCnt else if curChar jjstateSet jjnewStateCnt break case if curChar kind kind break case if curChar jjstateSet jjnewStateCnt break case if curChar jjstateSet jjnewStateCnt break case if curChar kind kind break case if curChar jjstateSet jjnewStateCnt break case if curChar kind kind break case if curChar jjstateSet jjnewStateCnt break case if curChar kind kind break case if curChar jjstateSet jjnewStateCnt break case if curChar jjstateSet jjnewStateCnt break case jjAddStates break case if curChar jjstateSet jjnewStateCnt break case if curChar break if kind kind jjstateSet jjnewStateCnt break case if break if kind kind jjCheckNAddTwoStates break case if break if kind kind jjCheckNAddTwoStates break case if curChar jjCheckNAddTwoStates break case if kind kind jjCheckNAddTwoStates break case if break if kind kind jjCheckNAddStates break case if break if kind kind jjCheckNAddTwoStates break case if curChar jjCheckNAddTwoStates break case if kind kind jjCheckNAddTwoStates break case if jjCheckNAddStates break case if curChar jjCheckNAddTwoStates break case jjCheckNAddStates break case if curChar jjCheckNAddStates break default break while startsAt else int hiByte int curChar int i1 hiByte long l1 hiByte int i2 curChar long l2 curChar MatchLoop do switch jjstateSet case case case if jjCanMove_0 hiByte i1 i2 l1 l2 break if kind kind jjCheckNAddTwoStates break case if jjCanMove_0 hiByte i1 i2 l1 l2 if kind kind jjCheckNAddTwoStates if jjCanMove_0 hiByte i1 i2 l1 l2 if kind kind jjCheckNAddStates break case if jjCanMove_0 hiByte i1 i2 l1 l2 jjAddStates break case if jjCanMove_0 hiByte i1 i2 l1 l2 break if kind kind jjCheckNAddTwoStates break case if jjCanMove_0 hiByte i1 i2 l1 l2 break if kind kind jjCheckNAddStates break case case if jjCanMove_0 hiByte i1 i2 l1 l2 break if kind kind jjCheckNAddTwoStates break case case if jjCanMove_0 hiByte i1 i2 l1 l2 jjCheckNAddStates break default break while startsAt if kind jjmatchedKind kind jjmatchedPos curPos kind curPos if jjnewStateCnt startsAt jjnewStateCnt startsAt return curPos try curChar input_stream readChar catch java io IOException return curPos private final int jjStopStringLiteralDfa_1 int pos long active0 switch pos case if active0 jjmatchedKind return return default return private final int jjStartNfa_1 int pos long active0 return jjMoveNfa_1 jjStopStringLiteralDfa_1 pos active0 pos private final int jjStartNfaWithStates_1 int pos int kind int state jjmatchedKind kind jjmatchedPos pos try curChar input_stream readChar catch java io IOException return pos return jjMoveNfa_1 state pos private final int jjMoveStringLiteralDfa0_1 switch curChar case return jjMoveStringLiteralDfa1_1 case return jjStopAtPos default return jjMoveNfa_1 private final int jjMoveStringLiteralDfa1_1 long active0 try curChar input_stream readChar catch java io IOException jjStopStringLiteralDfa_1 active0 return switch curChar case if active0 return jjStartNfaWithStates_1 break default break return jjStartNfa_1 active0 private final int jjMoveNfa_1 int startState int curPos int nextStates int startsAt jjnewStateCnt int jjstateSet startState int kind for if jjround ReInitRounds if curChar long curChar MatchLoop do switch jjstateSet case if if kind kind jjCheckNAdd if if kind kind else if curChar jjCheckNAddTwoStates break case if curChar jjCheckNAddTwoStates break case if jjCheckNAddStates break case if curChar jjCheckNAddStates break case if curChar kind kind break case if break if kind kind jjCheckNAdd break default break while startsAt else if curChar long curChar MatchLoop do switch jjstateSet case case if break if kind kind jjCheckNAdd break case jjAddStates break case if curChar jjstateSet jjnewStateCnt break default break while startsAt else int hiByte int curChar int i1 hiByte long l1 hiByte int i2 curChar long l2 curChar MatchLoop do switch jjstateSet case case if jjCanMove_0 hiByte i1 i2 l1 l2 break if kind kind jjCheckNAdd break case if jjCanMove_0 hiByte i1 i2 l1 l2 jjAddStates break default break while startsAt if kind jjmatchedKind kind jjmatchedPos curPos kind curPos if jjnewStateCnt startsAt jjnewStateCnt startsAt return curPos try curChar input_stream readChar catch java io IOException return curPos private final int jjMoveStringLiteralDfa0_0 return jjMoveNfa_0 private final int jjMoveNfa_0 int startState int curPos int nextStates int startsAt jjnewStateCnt int jjstateSet startState int kind for if jjround ReInitRounds if curChar long curChar MatchLoop do switch jjstateSet case if break if kind kind jjAddStates break case if curChar jjCheckNAdd break case if break if kind kind jjCheckNAdd break default break while startsAt else if curChar long curChar MatchLoop do switch jjstateSet default break while startsAt else int hiByte int curChar int i1 hiByte long l1 hiByte int i2 curChar long l2 curChar MatchLoop do switch jjstateSet default break while startsAt if kind jjmatchedKind kind jjmatchedPos curPos kind curPos if jjnewStateCnt startsAt jjnewStateCnt startsAt return curPos try curChar input_stream readChar catch java io IOException return curPos private final int jjStopStringLiteralDfa_2 int pos long active0 switch pos case if active0 jjmatchedKind return return default return private final int jjStartNfa_2 int pos long active0 return jjMoveNfa_2 jjStopStringLiteralDfa_2 pos active0 pos private final int jjStartNfaWithStates_2 int pos int kind int state jjmatchedKind kind jjmatchedPos pos try curChar input_stream readChar catch java io IOException return pos return jjMoveNfa_2 state pos private final int jjMoveStringLiteralDfa0_2 switch curChar case return jjMoveStringLiteralDfa1_2 case return jjStopAtPos default return jjMoveNfa_2 private final int jjMoveStringLiteralDfa1_2 long active0 try curChar input_stream readChar catch java io IOException jjStopStringLiteralDfa_2 active0 return switch curChar case if active0 return jjStartNfaWithStates_2 break default break return jjStartNfa_2 active0 private final int jjMoveNfa_2 int startState int curPos int nextStates int startsAt jjnewStateCnt int jjstateSet startState int kind for if jjround ReInitRounds if curChar long curChar MatchLoop do switch jjstateSet case if if kind kind jjCheckNAdd if if kind kind else if curChar jjCheckNAddTwoStates break case if curChar jjCheckNAddTwoStates break case if jjCheckNAddStates break case if curChar jjCheckNAddStates break case if curChar kind kind break case if break if kind kind jjCheckNAdd break default break while startsAt else if curChar long curChar MatchLoop do switch jjstateSet case case if break if kind kind jjCheckNAdd break case jjAddStates break case if curChar jjstateSet jjnewStateCnt break default break while startsAt else int hiByte int curChar int i1 hiByte long l1 hiByte int i2 curChar long l2 curChar MatchLoop do switch jjstateSet case case if jjCanMove_0 hiByte i1 i2 l1 l2 break if kind kind jjCheckNAdd break case if jjCanMove_0 hiByte i1 i2 l1 l2 jjAddStates break default break while startsAt if kind jjmatchedKind kind jjmatchedPos curPos kind curPos if jjnewStateCnt startsAt jjnewStateCnt startsAt return curPos try curChar input_stream readChar catch java io IOException return curPos static final int jjnextStates private static final boolean jjCanMove_0 int hiByte int i1 int i2 long l1 long l2 switch hiByte case return jjbitVec2 i2 l2 default if jjbitVec0 i1 l1 return true return false public static final String jjstrLiteralImages null null null null null null null null null null null null null null null null null null null public static final String lexStateNames public static final int jjnewLexState static final long jjtoToken static final long jjtoSkip protected CharStream input_stream private final int jjrounds new int private final int jjstateSet new int protected char curChar public QueryParserTokenManager CharStream stream input_stream stream public QueryParserTokenManager CharStream stream int lexState this stream SwitchTo lexState public void ReInit CharStream stream jjmatchedPos jjnewStateCnt curLexState defaultLexState input_stream stream ReInitRounds private final void ReInitRounds int jjround for jjrounds public void ReInit CharStream stream int lexState ReInit stream SwitchTo lexState public void SwitchTo int lexState if lexState lexState throw new TokenMgrError lexState TokenMgrError INVALID_LEXICAL_STATE else curLexState lexState protected Token jjFillToken Token Token newToken jjmatchedKind kind jjmatchedKind String im jjstrLiteralImages jjmatchedKind image im null input_stream GetImage im beginLine input_stream getBeginLine beginColumn input_stream getBeginColumn endLine input_stream getEndLine endColumn input_stream getEndColumn return int curLexState int defaultLexState int jjnewStateCnt int jjround int jjmatchedPos int jjmatchedKind public Token getNextToken int kind Token specialToken null Token matchedToken int curPos EOFLoop for try curChar input_stream BeginToken catch java io IOException jjmatchedKind matchedToken jjFillToken return matchedToken switch curLexState case jjmatchedKind jjmatchedPos curPos jjMoveStringLiteralDfa0_0 break case jjmatchedKind jjmatchedPos curPos jjMoveStringLiteralDfa0_1 break case jjmatchedKind jjmatchedPos curPos jjMoveStringLiteralDfa0_2 break case jjmatchedKind jjmatchedPos curPos jjMoveStringLiteralDfa0_3 break if jjmatchedKind if jjmatchedPos curPos input_stream backup curPos jjmatchedPos if jjtoToken jjmatchedKind jjmatchedKind matchedToken jjFillToken if jjnewLexState jjmatchedKind curLexState jjnewLexState jjmatchedKind return matchedToken else if jjnewLexState jjmatchedKind curLexState jjnewLexState jjmatchedKind continue EOFLoop int error_line input_stream getEndLine int error_column input_stream getEndColumn String error_after null boolean EOFSeen false try input_stream readChar input_stream backup catch java io IOException e1 EOFSeen true error_after curPos input_stream GetImage if curChar curChar error_line error_column else error_column if EOFSeen input_stream backup error_after curPos input_stream GetImage throw new TokenMgrError EOFSeen curLexState error_line error_column error_after curChar TokenMgrError LEXICAL_ERROR public abstract class SortComparator implements SortComparatorSource public ScoreDocComparator newComparator final IndexReader reader final String fieldname throws IOException final String field fieldname intern final Comparable cachedValues FieldCache DEFAULT getCustom reader field SortComparator this return new ScoreDocComparator public int compare ScoreDoc ScoreDoc return cachedValues doc compareTo cachedValues doc public Comparable sortValue ScoreDoc return cachedValues doc public int sortType return SortField CUSTOM protected abstract Comparable getComparable String termtext public class ValueSourceQuery extends Query ValueSource valSrc public ValueSourceQuery ValueSource valSrc this valSrc valSrc public Query rewrite IndexReader reader throws IOException return this public void extractTerms Set terms private class ValueSourceWeight implements Weight Searcher searcher float queryNorm float queryWeight public ValueSourceWeight Searcher searcher this searcher searcher public Query getQuery return ValueSourceQuery this public float getValue return queryWeight public float sumOfSquaredWeights throws IOException queryWeight getBoost return queryWeight queryWeight public void normalize float norm this queryNorm norm queryWeight this queryNorm public Scorer scorer IndexReader reader throws IOException return new ValueSourceScorer getSimilarity searcher reader this public Explanation explain IndexReader reader int doc throws IOException return scorer reader explain doc private class ValueSourceScorer extends Scorer private final IndexReader reader private final ValueSourceWeight weight private final int maxDoc private final float qWeight private int doc private final DocValues vals private ValueSourceScorer Similarity similarity IndexReader reader ValueSourceWeight throws IOException super similarity this weight this qWeight getValue this reader reader this maxDoc reader maxDoc vals valSrc getValues reader public boolean next throws IOException for doc if doc maxDoc return false if reader isDeleted doc continue return true public int doc return doc public float score throws IOException return qWeight vals floatVal doc public boolean skipTo int target throws IOException doc target return next public Explanation explain int doc throws IOException float sc qWeight vals floatVal doc Explanation result new ComplexExplanation true sc ValueSourceQuery this toString result addDetail vals explain doc result addDetail new Explanation getBoost result addDetail new Explanation weight queryNorm return result protected Weight createWeight Searcher searcher return new ValueSourceQuery ValueSourceWeight searcher public String toString String field return valSrc toString ToStringUtils boost getBoost public boolean equals Object if getClass getClass return false ValueSourceQuery other ValueSourceQuery return this getBoost other getBoost this valSrc equals other valSrc public int hashCode return getClass hashCode valSrc hashCode Float floatToIntBits getBoost public abstract class TermEnum public abstract boolean next throws IOException public abstract Term term public abstract int docFreq public abstract void close throws IOException public boolean skipTo Term target throws IOException do if next return false while target compareTo term return true public class ParallelReader extends IndexReader private List readers new ArrayList private SortedMap fieldToReader new TreeMap private Map readerToFields new HashMap private List storedFieldReaders new ArrayList private int maxDoc private int numDocs private boolean hasDeletions public ParallelReader throws IOException super null public void add IndexReader reader throws IOException ensureOpen add reader false public void add IndexReader reader boolean ignoreStoredFields throws IOException ensureOpen if readers size this maxDoc reader maxDoc this numDocs reader numDocs this hasDeletions reader hasDeletions throw new IllegalArgumentException maxDoc reader maxDoc if reader numDocs numDocs throw new IllegalArgumentException numDocs reader numDocs Collection fields reader getFieldNames IndexReader FieldOption ALL readerToFields put reader fields Iterator fields iterator String field String next if fieldToReader get field null fieldToReader put field reader if ignoreStoredFields readers add reader public int numDocs return numDocs public int maxDoc return maxDoc public boolean hasDeletions return hasDeletions public boolean isDeleted int if readers size return IndexReader readers get isDeleted return false protected void doDelete int throws CorruptIndexException IOException for int readers size IndexReader readers get deleteDocument hasDeletions true protected void doUndeleteAll throws CorruptIndexException IOException for int readers size IndexReader readers get undeleteAll hasDeletions false public Document document int FieldSelector fieldSelector throws CorruptIndexException IOException ensureOpen Document result new Document for int storedFieldReaders size IndexReader reader IndexReader storedFieldReaders get boolean include fieldSelector null if include Iterator it Collection readerToFields get reader iterator while it hasNext if fieldSelector accept String it next FieldSelectorResult NO_LOAD include true break if include Iterator fieldIterator reader document fieldSelector getFields iterator while fieldIterator hasNext result add Fieldable fieldIterator next return result public TermFreqVector getTermFreqVectors int throws IOException ensureOpen ArrayList results new ArrayList Iterator fieldToReader entrySet iterator while hasNext Map Entry Map Entry next String field String getKey IndexReader reader IndexReader getValue TermFreqVector vector reader getTermFreqVector field if vector null results add vector return TermFreqVector results toArray new TermFreqVector results size public TermFreqVector getTermFreqVector int String field throws IOException ensureOpen IndexReader reader IndexReader fieldToReader get field return reader null null reader getTermFreqVector field public boolean hasNorms String field throws IOException ensureOpen IndexReader reader IndexReader fieldToReader get field return reader null false reader hasNorms field public byte norms String field throws IOException ensureOpen IndexReader reader IndexReader fieldToReader get field return reader null null reader norms field public void norms String field byte result int offset throws IOException ensureOpen IndexReader reader IndexReader fieldToReader get field if reader null reader norms field result offset protected void doSetNorm int String field byte value throws CorruptIndexException IOException IndexReader reader IndexReader fieldToReader get field if reader null reader doSetNorm field value public TermEnum terms throws IOException ensureOpen return new ParallelTermEnum public TermEnum terms Term term throws IOException ensureOpen return new ParallelTermEnum term public int docFreq Term term throws IOException ensureOpen IndexReader reader IndexReader fieldToReader get term field return reader null reader docFreq term public TermDocs termDocs Term term throws IOException ensureOpen return new ParallelTermDocs term public TermDocs termDocs throws IOException ensureOpen return new ParallelTermDocs public TermPositions termPositions Term term throws IOException ensureOpen return new ParallelTermPositions term public TermPositions termPositions throws IOException ensureOpen return new ParallelTermPositions protected void doCommit throws IOException for int readers size IndexReader readers get commit protected synchronized void doClose throws IOException for int readers size IndexReader readers get close public Collection getFieldNames IndexReader FieldOption fieldNames ensureOpen Set fieldSet new HashSet for int readers size IndexReader reader IndexReader readers get Collection names reader getFieldNames fieldNames fieldSet addAll names return fieldSet private class ParallelTermEnum extends TermEnum private String field private Iterator fieldIterator private TermEnum termEnum public ParallelTermEnum throws IOException field String fieldToReader firstKey if field null termEnum IndexReader fieldToReader get field terms public ParallelTermEnum Term term throws IOException field term field IndexReader reader IndexReader fieldToReader get field if reader null termEnum reader terms term public boolean next throws IOException if termEnum null return false if termEnum next termEnum term field field if fieldIterator null fieldIterator fieldToReader tailMap field keySet iterator while fieldIterator hasNext field String fieldIterator next termEnum IndexReader fieldToReader get field terms new Term field Term term termEnum term if term null term field field return true else termEnum close public Term term if termEnum null return null return termEnum term public int docFreq if termEnum null return return termEnum docFreq public void close throws IOException if termEnum null termEnum close private class ParallelTermDocs implements TermDocs protected TermDocs termDocs public ParallelTermDocs public ParallelTermDocs Term term throws IOException seek term public int doc return termDocs doc public int freq return termDocs freq public void seek Term term throws IOException IndexReader reader IndexReader fieldToReader get term field termDocs reader null reader termDocs term null public void seek TermEnum termEnum throws IOException seek termEnum term public boolean next throws IOException if termDocs null return false return termDocs next public int read final int docs final int freqs throws IOException if termDocs null return return termDocs read docs freqs public boolean skipTo int target throws IOException if termDocs null return false return termDocs skipTo target public void close throws IOException if termDocs null termDocs close private class ParallelTermPositions extends ParallelTermDocs implements TermPositions public ParallelTermPositions public ParallelTermPositions Term term throws IOException seek term public void seek Term term throws IOException IndexReader reader IndexReader fieldToReader get term field termDocs reader null reader termPositions term null public int nextPosition throws IOException return TermPositions termDocs nextPosition public int getPayloadLength return TermPositions termDocs getPayloadLength public byte getPayload byte data int offset throws IOException return TermPositions termDocs getPayload data offset public boolean isPayloadAvailable return TermPositions termDocs isPayloadAvailable final class TermScorer extends Scorer private Weight weight private TermDocs termDocs private byte norms private float weightValue private int doc private int pointer private int pointerMax private static final int SCORE_CACHE_SIZE private float scoreCache new float SCORE_CACHE_SIZE TermScorer Weight weight TermDocs td Similarity similarity byte norms super similarity this weight weight this termDocs td this norms norms this weightValue weight getValue for int SCORE_CACHE_SIZE scoreCache getSimilarity tf weightValue public void score HitCollector hc throws IOException next score hc Integer MAX_VALUE protected boolean score HitCollector int end throws IOException float normDecoder Similarity getNormDecoder int freqs pointer if pointer pointerMax if pointerMax pointer else return false doc docs pointer return true public int doc return doc public boolean next throws IOException pointer if pointer pointerMax if pointerMax pointer else return false doc docs pointer return true public float score int freqs pointer public boolean skipTo int target throws IOException for pointer pointer pointerMax pointer if docs pointer target doc docs pointer return true boolean result termDocs skipTo target if result pointerMax pointer docs pointer doc termDocs doc freqs pointer termDocs freq else doc Integer MAX_VALUE return result public Explanation explain int doc throws IOException TermQuery query TermQuery weight getQuery Explanation tfExplanation new Explanation int tf while pointer pointerMax if docs pointer doc tf freqs pointer pointer if tf if termDocs skipTo doc if termDocs doc doc tf termDocs freq termDocs close tfExplanation setValue getSimilarity tf tf tfExplanation setDescription query getTerm tf return tfExplanation public String toString return weight public class ShortFieldSource extends FieldCacheSource private FieldCache ShortParser parser public ShortFieldSource String field this field null public ShortFieldSource String field FieldCache ShortParser parser super field this parser parser public String description return super description public DocValues getCachedFieldValues FieldCache cache String field IndexReader reader throws IOException final short arr parser null cache getShorts reader field cache getShorts reader field parser return new DocValues reader maxDoc public float floatVal int doc return float arr doc public int intVal int doc return arr doc public String toString int doc return description intVal doc Object getInnerArray return arr public boolean cachedFieldSourceEquals FieldCacheSource if getClass ShortFieldSource class return false ShortFieldSource other ShortFieldSource return this parser null other parser null this parser getClass other parser getClass public int cachedFieldSourceHashCode return parser null Short class hashCode parser getClass hashCode public class FilteredQuery extends Query Query query Filter filter public FilteredQuery Query query Filter filter this query query this filter filter protected Weight createWeight final Searcher searcher throws IOException final Weight weight query createWeight searcher final Similarity similarity query getSimilarity searcher return new Weight private float value public float getValue return value public float sumOfSquaredWeights throws IOException return weight sumOfSquaredWeights getBoost getBoost public void normalize float weight normalize value weight getValue getBoost public Explanation explain IndexReader ir int throws IOException Explanation inner weight explain ir if getBoost Explanation preBoost inner inner new Explanation inner getValue getBoost inner addDetail new Explanation getBoost inner addDetail preBoost Filter FilteredQuery this filter BitSet matches bits ir if matches get return inner Explanation result new Explanation toString result addDetail inner return result public Query getQuery return FilteredQuery this public Scorer scorer IndexReader indexReader throws IOException final Scorer scorer weight scorer indexReader final BitSet bitset filter bits indexReader return new Scorer similarity public boolean next throws IOException do if scorer next return false while bitset get scorer doc return true public int doc return scorer doc public boolean skipTo int throws IOException if scorer skipTo return false while bitset get scorer doc int nextFiltered bitset nextSetBit scorer doc if nextFiltered return false else if scorer skipTo nextFiltered return false return true public float score throws IOException return getBoost scorer score public Explanation explain int throws IOException Explanation exp scorer explain exp setValue getBoost exp getValue if bitset get exp setDescription exp getDescription else exp setDescription exp getDescription return exp public Query rewrite IndexReader reader throws IOException Query rewritten query rewrite reader if rewritten query FilteredQuery clone FilteredQuery this clone clone query rewritten return clone else return this public Query getQuery return query public Filter getFilter return filter public void extractTerms Set terms getQuery extractTerms terms public String toString String StringBuffer buffer new StringBuffer buffer append buffer append query toString buffer append buffer append filter buffer append ToStringUtils boost getBoost return buffer toString public boolean equals Object if instanceof FilteredQuery FilteredQuery fq FilteredQuery return query equals fq query filter equals fq filter getBoost fq getBoost return false public int hashCode return query hashCode filter hashCode Float floatToRawIntBits getBoost public class FloatFieldSource extends FieldCacheSource private FieldCache FloatParser parser public FloatFieldSource String field this field null public FloatFieldSource String field FieldCache FloatParser parser super field this parser parser public String description return super description public DocValues getCachedFieldValues FieldCache cache String field IndexReader reader throws IOException final float arr parser null cache getFloats reader field cache getFloats reader field parser return new DocValues reader maxDoc public float floatVal int doc return arr doc public String toString int doc return description arr doc Object getInnerArray return arr public boolean cachedFieldSourceEquals FieldCacheSource if getClass FloatFieldSource class return false FloatFieldSource other FloatFieldSource return this parser null other parser null this parser getClass other parser getClass public int cachedFieldSourceHashCode return parser null Float class hashCode parser getClass hashCode public class FilterManager protected static FilterManager manager protected static final int DEFAULT_CACHE_CLEAN_SIZE protected static final long DEFAULT_CACHE_SLEEP_TIME protected Map cache protected int cacheCleanSize protected long cleanSleepTime protected FilterCleaner filterCleaner public synchronized static FilterManager getInstance if manager null manager new FilterManager return manager protected FilterManager cache new HashMap filterCleaner new FilterCleaner Thread fcThread new Thread filterCleaner fcThread setDaemon true fcThread start public void setCacheSize int cacheCleanSize this cacheCleanSize cacheCleanSize public void setCleanThreadSleepTime long cleanSleepTime this cleanSleepTime cleanSleepTime public Filter getFilter Filter filter synchronized cache FilterItem fi null fi FilterItem cache get new Integer filter hashCode if fi null fi timestamp new Date getTime return fi filter cache put new Integer filter hashCode new FilterItem filter return filter protected class FilterItem public Filter filter public long timestamp public FilterItem Filter filter this filter filter this timestamp new Date getTime protected class FilterCleaner implements Runnable private boolean running true private TreeSet sortedFilterItems public FilterCleaner sortedFilterItems new TreeSet new Comparator public int compare Object Object if instanceof Map Entry instanceof Map Entry FilterItem fia FilterItem Map Entry getValue FilterItem fib FilterItem Map Entry getValue if fia timestamp fib timestamp return if fia timestamp fib timestamp return return else throw new ClassCastException public void run while running if cache size cacheCleanSize sortedFilterItems clear synchronized cache sortedFilterItems addAll cache entrySet Iterator it sortedFilterItems iterator int numToDelete int cache size cacheCleanSize int counter while it hasNext counter numToDelete Map Entry entry Map Entry it next cache remove entry getKey sortedFilterItems clear try Thread sleep cleanSleepTime catch InterruptedException public abstract class FilteredTermEnum extends TermEnum private Term currentTerm null private TermEnum actualEnum null public FilteredTermEnum protected abstract boolean termCompare Term term public abstract float difference protected abstract boolean endEnum protected void setEnum TermEnum actualEnum throws IOException this actualEnum actualEnum Term term actualEnum term if term null termCompare term currentTerm term else next public int docFreq if actualEnum null return return actualEnum docFreq public boolean next throws IOException currentTerm null while currentTerm null if endEnum return false if actualEnum next Term term actualEnum term if termCompare term currentTerm term return true else return false currentTerm null return false public Term term return currentTerm public void close throws IOException actualEnum close currentTerm null actualEnum null public interface TermDocs void seek Term term throws IOException void seek TermEnum termEnum throws IOException int doc int freq boolean next throws IOException int read int docs int freqs throws IOException boolean skipTo int target throws IOException void close throws IOException class SegmentReader extends IndexReader private String segment private SegmentInfo si FieldInfos fieldInfos private FieldsReader fieldsReader TermInfosReader tis TermVectorsReader termVectorsReaderOrig null ThreadLocal termVectorsLocal new ThreadLocal BitVector deletedDocs null private boolean deletedDocsDirty false private boolean normsDirty false private boolean undeleteAll false private boolean rollbackDeletedDocsDirty false private boolean rollbackNormsDirty false private boolean rollbackUndeleteAll false IndexInput freqStream IndexInput proxStream private IndexInput singleNormStream CompoundFileReader cfsReader null private class Norm public Norm IndexInput in int number long normSeek this in in this number number this normSeek normSeek private IndexInput in private byte bytes private boolean dirty private int number private long normSeek private boolean rollbackDirty private void reWrite SegmentInfo si throws IOException si advanceNormGen this number IndexOutput out directory createOutput si getNormFileName this number try out writeBytes bytes maxDoc finally out close this dirty false public void close throws IOException if in null in singleNormStream in close in null private Hashtable norms new Hashtable private static Class IMPL static try String name System getProperty SegmentReader class getName IMPL Class forName name catch ClassNotFoundException throw new RuntimeException catch SecurityException se try IMPL Class forName SegmentReader class getName catch ClassNotFoundException throw new RuntimeException protected SegmentReader super null public static SegmentReader get SegmentInfo si throws CorruptIndexException IOException return get si dir si null false false BufferedIndexInput BUFFER_SIZE public static SegmentReader get SegmentInfo si int readBufferSize throws CorruptIndexException IOException return get si dir si null false false readBufferSize public static SegmentReader get SegmentInfos sis SegmentInfo si boolean closeDir throws CorruptIndexException IOException return get si dir si sis closeDir true BufferedIndexInput BUFFER_SIZE public static SegmentReader get Directory dir SegmentInfo si SegmentInfos sis boolean closeDir boolean ownDir int readBufferSize throws CorruptIndexException IOException SegmentReader instance try instance SegmentReader IMPL newInstance catch Exception throw new RuntimeException instance init dir sis closeDir ownDir instance initialize si readBufferSize return instance private void initialize SegmentInfo si int readBufferSize throws CorruptIndexException IOException segment si name this si si boolean success false try Directory cfsDir directory if si getUseCompoundFile cfsReader new CompoundFileReader directory segment readBufferSize cfsDir cfsReader fieldInfos new FieldInfos cfsDir segment fieldsReader new FieldsReader cfsDir segment fieldInfos readBufferSize if fieldsReader size si docCount throw new CorruptIndexException si name fieldsReader size si docCount tis new TermInfosReader cfsDir segment fieldInfos readBufferSize if hasDeletions si deletedDocs new BitVector directory si getDelFileName if deletedDocs count maxDoc throw new CorruptIndexException deletedDocs count maxDoc si name freqStream cfsDir openInput segment readBufferSize proxStream cfsDir openInput segment readBufferSize openNorms cfsDir readBufferSize termVectorsReaderOrig new TermVectorsReader cfsDir segment fieldInfos readBufferSize success true finally if success doClose protected void doCommit throws IOException si advanceDelGen deletedDocs write directory si getDelFileName if undeleteAll si hasDeletions si clearDelGen si setNumFields fieldInfos size Enumeration values norms elements while values hasMoreElements Norm norm Norm values nextElement if norm dirty norm reWrite si deletedDocsDirty false normsDirty false undeleteAll false protected void doClose throws IOException if fieldsReader null fieldsReader close if tis null tis close if freqStream null freqStream close if proxStream null proxStream close closeNorms if termVectorsReaderOrig null termVectorsReaderOrig close if cfsReader null cfsReader close static boolean hasDeletions SegmentInfo si throws IOException return si hasDeletions public boolean hasDeletions return deletedDocs null static boolean usesCompoundFile SegmentInfo si throws IOException return si getUseCompoundFile static boolean hasSeparateNorms SegmentInfo si throws IOException return si hasSeparateNorms protected void doDelete int docNum if deletedDocs null deletedDocs new BitVector maxDoc deletedDocsDirty true undeleteAll false deletedDocs set docNum protected void doUndeleteAll deletedDocs null deletedDocsDirty false undeleteAll true Vector files throws IOException return new Vector si files public TermEnum terms ensureOpen return tis terms public TermEnum terms Term throws IOException ensureOpen return tis terms public synchronized Document document int FieldSelector fieldSelector throws CorruptIndexException IOException ensureOpen if isDeleted throw new IllegalArgumentException return fieldsReader doc fieldSelector public synchronized boolean isDeleted int return deletedDocs null deletedDocs get public TermDocs termDocs throws IOException ensureOpen return new SegmentTermDocs this public TermPositions termPositions throws IOException ensureOpen return new SegmentTermPositions this public int docFreq Term throws IOException ensureOpen TermInfo ti tis get if ti null return ti docFreq else return public int numDocs int maxDoc if deletedDocs null deletedDocs count return public int maxDoc return si docCount public Collection getFieldNames IndexReader FieldOption fieldOption ensureOpen Set fieldSet new HashSet for int fieldInfos size FieldInfo fi fieldInfos fieldInfo if fieldOption IndexReader FieldOption ALL fieldSet add fi name else if fi isIndexed fieldOption IndexReader FieldOption UNINDEXED fieldSet add fi name else if fi storePayloads fieldOption IndexReader FieldOption STORES_PAYLOADS fieldSet add fi name else if fi isIndexed fieldOption IndexReader FieldOption INDEXED fieldSet add fi name else if fi isIndexed fi storeTermVector false fieldOption IndexReader FieldOption INDEXED_NO_TERMVECTOR fieldSet add fi name else if fi storeTermVector true fi storePositionWithTermVector false fi storeOffsetWithTermVector false fieldOption IndexReader FieldOption TERMVECTOR fieldSet add fi name else if fi isIndexed fi storeTermVector fieldOption IndexReader FieldOption INDEXED_WITH_TERMVECTOR fieldSet add fi name else if fi storePositionWithTermVector fi storeOffsetWithTermVector false fieldOption IndexReader FieldOption TERMVECTOR_WITH_POSITION fieldSet add fi name else if fi storeOffsetWithTermVector fi storePositionWithTermVector false fieldOption IndexReader FieldOption TERMVECTOR_WITH_OFFSET fieldSet add fi name else if fi storeOffsetWithTermVector fi storePositionWithTermVector fieldOption IndexReader FieldOption TERMVECTOR_WITH_POSITION_OFFSET fieldSet add fi name return fieldSet public synchronized boolean hasNorms String field ensureOpen return norms containsKey field static byte createFakeNorms int size byte ones new byte size Arrays fill ones DefaultSimilarity encodeNorm return ones private byte ones private byte fakeNorms if ones null ones createFakeNorms maxDoc return ones protected synchronized byte getNorms String field throws IOException Norm norm Norm norms get field byte bytes new byte maxDoc norms field bytes norm close return norm bytes public synchronized byte norms String field throws IOException ensureOpen byte bytes getNorms field if bytes null bytes fakeNorms return bytes protected void doSetNorm int doc String field byte value throws IOException Norm norm Norm norms get field return normsDirty true public synchronized void norms String field byte bytes int offset throws IOException ensureOpen Norm norm Norm norms get field if norm null System arraycopy fakeNorms bytes offset maxDoc return System arraycopy norm bytes bytes offset maxDoc return norm in seek norm normSeek norm in readBytes bytes offset maxDoc private void openNorms Directory cfsDir int readBufferSize throws IOException int maxDoc maxDoc for int fieldInfos size FieldInfo fi fieldInfos fieldInfo if fi isIndexed fi omitNorms Directory directory String fileName si getNormFileName fi number if si hasSeparateNorms fi number cfsDir boolean singleNormFile fileName endsWith IndexFileNames NORMS_EXTENSION IndexInput normInput null long normSeek if singleNormFile normSeek nextNormSeek if singleNormStream null singleNormStream openInput fileName readBufferSize normInput singleNormStream else normSeek normInput openInput fileName norms put fi name new Norm normInput fi number normSeek private void closeNorms throws IOException synchronized norms Enumeration enumerator norms elements while enumerator hasMoreElements Norm norm Norm enumerator nextElement norm close if singleNormStream null singleNormStream close singleNormStream null private TermVectorsReader getTermVectorsReader TermVectorsReader tvReader TermVectorsReader termVectorsLocal get if tvReader null tvReader TermVectorsReader termVectorsReaderOrig clone termVectorsLocal set tvReader return tvReader public TermFreqVector getTermFreqVector int docNumber String field throws IOException ensureOpen FieldInfo fi fieldInfos fieldInfo field if fi null fi storeTermVector termVectorsReaderOrig null return null TermVectorsReader termVectorsReader getTermVectorsReader if termVectorsReader null return null return termVectorsReader get docNumber field public TermFreqVector getTermFreqVectors int docNumber throws IOException ensureOpen if termVectorsReaderOrig null return null TermVectorsReader termVectorsReader getTermVectorsReader if termVectorsReader null return null return termVectorsReader get docNumber FieldInfos fieldInfos return fieldInfos String getSegmentName return segment void setSegmentInfo SegmentInfo info si info void startCommit super startCommit rollbackDeletedDocsDirty deletedDocsDirty rollbackNormsDirty normsDirty rollbackUndeleteAll undeleteAll Enumeration values norms elements while values hasMoreElements Norm norm Norm values nextElement norm rollbackDirty norm dirty void rollbackCommit super rollbackCommit deletedDocsDirty rollbackDeletedDocsDirty normsDirty rollbackNormsDirty undeleteAll rollbackUndeleteAll Enumeration values norms elements while values hasMoreElements Norm norm Norm values nextElement norm dirty norm rollbackDirty public class FieldSortedHitQueue extends PriorityQueue public FieldSortedHitQueue IndexReader reader SortField fields int size throws IOException final int fields length comparators new ScoreDocComparator this fields new SortField for int String fieldname fields getField comparators getCachedComparator reader fieldname fields getType fields getLocale fields getFactory if comparators sortType SortField STRING this fields new SortField fieldname fields getLocale fields getReverse else this fields new SortField fieldname comparators sortType fields getReverse initialize size protected ScoreDocComparator comparators protected SortField fields protected float maxscore Float NEGATIVE_INFINITY public float getMaxScore return maxscore public boolean insert FieldDoc fdoc maxscore Math max maxscore fdoc score return super insert fdoc public boolean insert Object fdoc return insert FieldDoc fdoc protected boolean lessThan final Object final Object final ScoreDoc docA ScoreDoc final ScoreDoc docB ScoreDoc final int comparators length int for int fields reverse comparators compare docB docA comparators compare docA docB if return docA doc docB doc return FieldDoc fillFields final FieldDoc doc final int comparators length final Comparable fields new Comparable for int fields comparators sortValue doc doc fields fields return doc SortField getFields return fields static ScoreDocComparator getCachedComparator IndexReader reader String field int type Locale locale SortComparatorSource factory throws IOException if type SortField DOC return ScoreDocComparator INDEXORDER if type SortField SCORE return ScoreDocComparator RELEVANCE FieldCacheImpl Entry entry factory null new FieldCacheImpl Entry field factory new FieldCacheImpl Entry field type locale return ScoreDocComparator Comparators get reader entry static final FieldCacheImpl Cache Comparators new FieldCacheImpl Cache protected Object createValue IndexReader reader Object entryKey throws IOException FieldCacheImpl Entry entry FieldCacheImpl Entry entryKey String fieldname entry field int type entry type Locale locale entry locale SortComparatorSource factory SortComparatorSource entry custom ScoreDocComparator comparator switch type case SortField AUTO comparator comparatorAuto reader fieldname break case SortField INT comparator comparatorInt reader fieldname break case SortField FLOAT comparator comparatorFloat reader fieldname break case SortField STRING if locale null comparator comparatorStringLocale reader fieldname locale else comparator comparatorString reader fieldname break case SortField CUSTOM comparator factory newComparator reader fieldname break default throw new RuntimeException type return comparator static ScoreDocComparator comparatorInt final IndexReader reader final String fieldname throws IOException final String field fieldname intern final int fieldOrder FieldCache DEFAULT getInts reader field return new ScoreDocComparator public final int compare final ScoreDoc final ScoreDoc final int fi fieldOrder doc final int fj fieldOrder doc if fi fj return if fi fj return return public Comparable sortValue final ScoreDoc return new Integer fieldOrder doc public int sortType return SortField INT static ScoreDocComparator comparatorFloat final IndexReader reader final String fieldname throws IOException final String field fieldname intern final float fieldOrder FieldCache DEFAULT getFloats reader field return new ScoreDocComparator public final int compare final ScoreDoc final ScoreDoc final float fi fieldOrder doc final float fj fieldOrder doc if fi fj return if fi fj return return public Comparable sortValue final ScoreDoc return new Float fieldOrder doc public int sortType return SortField FLOAT static ScoreDocComparator comparatorString final IndexReader reader final String fieldname throws IOException final String field fieldname intern final FieldCache StringIndex index FieldCache DEFAULT getStringIndex reader field return new ScoreDocComparator public final int compare final ScoreDoc final ScoreDoc final int fi index order doc final int fj index order doc if fi fj return if fi fj return return public Comparable sortValue final ScoreDoc return index lookup index order doc public int sortType return SortField STRING static ScoreDocComparator comparatorStringLocale final IndexReader reader final String fieldname final Locale locale throws IOException final Collator collator Collator getInstance locale final String field fieldname intern final String index FieldCache DEFAULT getStrings reader field return new ScoreDocComparator public final int compare final ScoreDoc final ScoreDoc String is index doc String js index doc if is js return else if is null return else if js null return else return collator compare is js public Comparable sortValue final ScoreDoc return index doc public int sortType return SortField STRING static ScoreDocComparator comparatorAuto final IndexReader reader final String fieldname throws IOException final String field fieldname intern Object lookupArray FieldCache DEFAULT getAuto reader field if lookupArray instanceof FieldCache StringIndex return comparatorString reader field else if lookupArray instanceof int return comparatorInt reader field else if lookupArray instanceof float return comparatorFloat reader field else if lookupArray instanceof String return comparatorString reader field else throw new RuntimeException field public class PerFieldAnalyzerWrapper extends Analyzer private Analyzer defaultAnalyzer private Map analyzerMap new HashMap public PerFieldAnalyzerWrapper Analyzer defaultAnalyzer this defaultAnalyzer defaultAnalyzer public void addAnalyzer String fieldName Analyzer analyzer analyzerMap put fieldName analyzer public TokenStream tokenStream String fieldName Reader reader Analyzer analyzer Analyzer analyzerMap get fieldName if analyzer null analyzer defaultAnalyzer return analyzer tokenStream fieldName reader public int getPositionIncrementGap String fieldName Analyzer analyzer Analyzer analyzerMap get fieldName if analyzer null analyzer defaultAnalyzer return analyzer getPositionIncrementGap fieldName public String toString return analyzerMap defaultAnalyzer public abstract class HitCollector public abstract void collect int doc float score public class WhitespaceTokenizer extends CharTokenizer public WhitespaceTokenizer Reader in super in protected boolean isTokenChar char return Character isWhitespace public class SpanNotQuery extends SpanQuery private SpanQuery include private SpanQuery exclude public SpanNotQuery SpanQuery include SpanQuery exclude this include include this exclude exclude if include getField equals exclude getField throw new IllegalArgumentException public SpanQuery getInclude return include public SpanQuery getExclude return exclude public String getField return include getField public Collection getTerms return include getTerms public void extractTerms Set terms include extractTerms terms public String toString String field StringBuffer buffer new StringBuffer buffer append buffer append include toString field buffer append buffer append exclude toString field buffer append buffer append ToStringUtils boost getBoost return buffer toString public Spans getSpans final IndexReader reader throws IOException return new Spans private Spans includeSpans include getSpans reader private boolean moreInclude true private Spans excludeSpans exclude getSpans reader private boolean moreExclude excludeSpans next public boolean next throws IOException moreInclude includeSpans next while moreInclude moreExclude moreExclude excludeSpans skipTo includeSpans doc includeSpans doc excludeSpans doc excludeSpans end includeSpans start includeSpans doc excludeSpans doc includeSpans end excludeSpans start return moreInclude public boolean skipTo int target throws IOException moreInclude includeSpans skipTo target if moreInclude return false includeSpans doc excludeSpans doc moreExclude excludeSpans skipTo includeSpans doc includeSpans doc excludeSpans doc excludeSpans end includeSpans start includeSpans doc excludeSpans doc includeSpans end excludeSpans start public int doc return includeSpans doc public int start return includeSpans start public int end return includeSpans end public String toString return SpanNotQuery this toString public Query rewrite IndexReader reader throws IOException SpanNotQuery clone null SpanQuery rewrittenInclude SpanQuery include rewrite reader if rewrittenInclude include clone SpanNotQuery this clone clone include rewrittenInclude SpanQuery rewrittenExclude SpanQuery exclude rewrite reader if rewrittenExclude exclude if clone null clone SpanNotQuery this clone clone exclude rewrittenExclude if clone null else public boolean equals Object if this return true if instanceof SpanNotQuery return false SpanNotQuery other SpanNotQuery return this include equals other include this exclude equals other exclude this getBoost other getBoost public int hashCode int include hashCode exclude hashCode Float floatToRawIntBits getBoost return public final class StandardFilter extends TokenFilter implements StandardTokenizerConstants public StandardFilter TokenStream in super in private static final String APOSTROPHE_TYPE tokenImage APOSTROPHE private static final String ACRONYM_TYPE tokenImage ACRONYM public final org apache lucene analysis Token next throws java io IOException org apache lucene analysis Token input next if null return null String text termText String type type text endsWith text endsWith return new org apache lucene analysis Token text substring text length startOffset endOffset type StringBuffer trimmed new StringBuffer for int text length char text charAt if trimmed append return new org apache lucene analysis Token trimmed toString startOffset endOffset type else return public class ConstantScoreQuery extends Query protected final Filter filter public ConstantScoreQuery Filter filter this filter filter public Filter getFilter return filter public Query rewrite IndexReader reader throws IOException return this public void extractTerms Set terms protected class ConstantWeight implements Weight private Similarity similarity private float queryNorm private float queryWeight public ConstantWeight Searcher searcher this similarity getSimilarity searcher public Query getQuery return ConstantScoreQuery this public float getValue return queryWeight public float sumOfSquaredWeights throws IOException queryWeight getBoost return queryWeight queryWeight public void normalize float norm this queryNorm norm queryWeight this queryNorm public Scorer scorer IndexReader reader throws IOException return new ConstantScorer similarity reader this public Explanation explain IndexReader reader int doc throws IOException ConstantScorer cs ConstantScorer scorer reader boolean exists cs bits get doc ComplexExplanation result new ComplexExplanation if exists result setDescription filter result setValue queryWeight result setMatch Boolean TRUE result addDetail new Explanation getBoost result addDetail new Explanation queryNorm else result setDescription filter doc result setValue result setMatch Boolean FALSE return result protected class ConstantScorer extends Scorer final BitSet bits final float theScore int doc public ConstantScorer Similarity similarity IndexReader reader Weight throws IOException super similarity theScore getValue bits filter bits reader public boolean next throws IOException doc bits nextSetBit doc return doc public int doc return doc public float score throws IOException return theScore public boolean skipTo int target throws IOException return doc public Explanation explain int doc throws IOException throw new UnsupportedOperationException protected Weight createWeight Searcher searcher return new ConstantScoreQuery ConstantWeight searcher public String toString String field return filter toString getBoost getBoost public boolean equals Object if this return true if instanceof ConstantScoreQuery return false ConstantScoreQuery other ConstantScoreQuery return this getBoost other getBoost filter equals other filter public int hashCode return filter hashCode Float floatToIntBits getBoost public class RemoteSearchable extends UnicastRemoteObject implements Searchable private Searchable local public RemoteSearchable Searchable local throws RemoteException super this local local public void search Weight weight Filter filter HitCollector results throws IOException local search weight filter results public void close throws IOException local close public int docFreq Term term throws IOException return local docFreq term public int docFreqs Term terms throws IOException return local docFreqs terms public int maxDoc throws IOException return local maxDoc public TopDocs search Weight weight Filter filter int throws IOException return local search weight filter public TopFieldDocs search Weight weight Filter filter int Sort sort throws IOException return local search weight filter sort public Document doc int throws CorruptIndexException IOException return local doc public Document doc int FieldSelector fieldSelector throws CorruptIndexException IOException return local doc fieldSelector public Query rewrite Query original throws IOException return local rewrite original public Explanation explain Weight weight int doc throws IOException return local explain weight doc public static void main String args throws Exception String indexName null if args null args length indexName args if indexName null System out println return if System getSecurityManager null System setSecurityManager new RMISecurityManager Searchable local new IndexSearcher indexName RemoteSearchable impl new RemoteSearchable local public class FilterIndexReader extends IndexReader public static class FilterTermDocs implements TermDocs protected TermDocs in public FilterTermDocs TermDocs in this in in public void seek Term term throws IOException in seek term public void seek TermEnum termEnum throws IOException in seek termEnum public int doc return in doc public int freq return in freq public boolean next throws IOException return in next public int read int docs int freqs throws IOException return in read docs freqs public boolean skipTo int throws IOException return in skipTo public void close throws IOException in close public static class FilterTermPositions extends FilterTermDocs implements TermPositions public FilterTermPositions TermPositions in super in public int nextPosition throws IOException return TermPositions this in nextPosition public int getPayloadLength return TermPositions this in getPayloadLength public byte getPayload byte data int offset throws IOException return TermPositions this in getPayload data offset public boolean isPayloadAvailable return TermPositions this in isPayloadAvailable public static class FilterTermEnum extends TermEnum protected TermEnum in public FilterTermEnum TermEnum in this in in public boolean next throws IOException return in next public Term term return in term public int docFreq return in docFreq public void close throws IOException in close protected IndexReader in public FilterIndexReader IndexReader in super in directory this in in public TermFreqVector getTermFreqVectors int docNumber throws IOException ensureOpen return in getTermFreqVectors docNumber public TermFreqVector getTermFreqVector int docNumber String field throws IOException ensureOpen return in getTermFreqVector docNumber field public int numDocs return in numDocs public int maxDoc return in maxDoc public Document document int FieldSelector fieldSelector throws CorruptIndexException IOException ensureOpen return in document fieldSelector public boolean isDeleted int return in isDeleted public boolean hasDeletions return in hasDeletions protected void doUndeleteAll throws CorruptIndexException IOException in undeleteAll public boolean hasNorms String field throws IOException ensureOpen return in hasNorms field public byte norms String throws IOException ensureOpen return in norms public void norms String byte bytes int offset throws IOException ensureOpen in norms bytes offset protected void doSetNorm int String byte throws CorruptIndexException IOException in setNorm public TermEnum terms throws IOException ensureOpen return in terms public TermEnum terms Term throws IOException ensureOpen return in terms public int docFreq Term throws IOException ensureOpen return in docFreq public TermDocs termDocs throws IOException ensureOpen return in termDocs public TermPositions termPositions throws IOException ensureOpen return in termPositions protected void doDelete int throws CorruptIndexException IOException in deleteDocument protected void doCommit throws IOException in commit protected void doClose throws IOException in close public Collection getFieldNames IndexReader FieldOption fieldNames ensureOpen return in getFieldNames fieldNames public long getVersion ensureOpen return in getVersion public boolean isCurrent throws CorruptIndexException IOException ensureOpen return in isCurrent public class DateTools private final static TimeZone GMT TimeZone getTimeZone private static final SimpleDateFormat YEAR_FORMAT new SimpleDateFormat private static final SimpleDateFormat MONTH_FORMAT new SimpleDateFormat private static final SimpleDateFormat DAY_FORMAT new SimpleDateFormat private static final SimpleDateFormat HOUR_FORMAT new SimpleDateFormat private static final SimpleDateFormat MINUTE_FORMAT new SimpleDateFormat private static final SimpleDateFormat SECOND_FORMAT new SimpleDateFormat private static final SimpleDateFormat MILLISECOND_FORMAT new SimpleDateFormat static YEAR_FORMAT setTimeZone GMT MONTH_FORMAT setTimeZone GMT DAY_FORMAT setTimeZone GMT HOUR_FORMAT setTimeZone GMT MINUTE_FORMAT setTimeZone GMT SECOND_FORMAT setTimeZone GMT MILLISECOND_FORMAT setTimeZone GMT private DateTools public static String dateToString Date date Resolution resolution return timeToString date getTime resolution public static String timeToString long time Resolution resolution Calendar cal Calendar getInstance GMT cal setTime new Date round time resolution String result if resolution Resolution YEAR synchronized YEAR_FORMAT result YEAR_FORMAT format cal getTime else if resolution Resolution MONTH synchronized MONTH_FORMAT result MONTH_FORMAT format cal getTime else if resolution Resolution DAY synchronized DAY_FORMAT result DAY_FORMAT format cal getTime else if resolution Resolution HOUR synchronized HOUR_FORMAT result HOUR_FORMAT format cal getTime else if resolution Resolution MINUTE synchronized MINUTE_FORMAT result MINUTE_FORMAT format cal getTime else if resolution Resolution SECOND synchronized SECOND_FORMAT result SECOND_FORMAT format cal getTime else if resolution Resolution MILLISECOND synchronized MILLISECOND_FORMAT result MILLISECOND_FORMAT format cal getTime else throw new IllegalArgumentException resolution return result public static long stringToTime String dateString throws ParseException return stringToDate dateString getTime public static Date stringToDate String dateString throws ParseException Date date if dateString length synchronized YEAR_FORMAT date YEAR_FORMAT parse dateString else if dateString length synchronized MONTH_FORMAT date MONTH_FORMAT parse dateString else if dateString length synchronized DAY_FORMAT date DAY_FORMAT parse dateString else if dateString length synchronized HOUR_FORMAT date HOUR_FORMAT parse dateString else if dateString length synchronized MINUTE_FORMAT date MINUTE_FORMAT parse dateString else if dateString length synchronized SECOND_FORMAT date SECOND_FORMAT parse dateString else if dateString length synchronized MILLISECOND_FORMAT date MILLISECOND_FORMAT parse dateString else throw new ParseException dateString return date public static Date round Date date Resolution resolution return new Date round date getTime resolution public static long round long time Resolution resolution Calendar cal Calendar getInstance GMT cal setTime new Date time if resolution Resolution YEAR cal set Calendar MONTH cal set Calendar DAY_OF_MONTH cal set Calendar HOUR_OF_DAY cal set Calendar MINUTE cal set Calendar SECOND cal set Calendar MILLISECOND else if resolution Resolution MONTH cal set Calendar DAY_OF_MONTH cal set Calendar HOUR_OF_DAY cal set Calendar MINUTE cal set Calendar SECOND cal set Calendar MILLISECOND else if resolution Resolution DAY cal set Calendar HOUR_OF_DAY cal set Calendar MINUTE cal set Calendar SECOND cal set Calendar MILLISECOND else if resolution Resolution HOUR cal set Calendar MINUTE cal set Calendar SECOND cal set Calendar MILLISECOND else if resolution Resolution MINUTE cal set Calendar SECOND cal set Calendar MILLISECOND else if resolution Resolution SECOND cal set Calendar MILLISECOND else if resolution Resolution MILLISECOND else throw new IllegalArgumentException resolution return cal getTime getTime public static class Resolution public static final Resolution YEAR new Resolution public static final Resolution MONTH new Resolution public static final Resolution DAY new Resolution public static final Resolution HOUR new Resolution public static final Resolution MINUTE new Resolution public static final Resolution SECOND new Resolution public static final Resolution MILLISECOND new Resolution private String resolution private Resolution private Resolution String resolution this resolution resolution public String toString return resolution public interface ScoreDocComparator static final ScoreDocComparator RELEVANCE new ScoreDocComparator public int compare ScoreDoc ScoreDoc if score score return if score score return return public Comparable sortValue ScoreDoc return new Float score public int sortType return SortField SCORE static final ScoreDocComparator INDEXORDER new ScoreDocComparator public int compare ScoreDoc ScoreDoc if doc doc return if doc doc return return public Comparable sortValue ScoreDoc return new Integer doc public int sortType return SortField DOC int compare ScoreDoc ScoreDoc Comparable sortValue ScoreDoc int sortType public class Payload implements Serializable protected byte data protected int offset protected int length protected Payload public Payload byte data this data data length public Payload byte data int offset int length if offset offset length data length throw new IllegalArgumentException this data data this offset offset this length length public int length return this length public byte byteAt int index if index index this length return this data this offset index throw new ArrayIndexOutOfBoundsException index public byte toByteArray byte retArray new byte this length System arraycopy this data this offset retArray this length return retArray public void copyTo byte target int targetOffset if this length target length targetOffset throw new ArrayIndexOutOfBoundsException System arraycopy this data this offset target targetOffset this length public abstract class Filter implements java io Serializable public abstract BitSet bits IndexReader reader throws IOException public interface FieldCache public static final int STRING_INDEX public static class StringIndex public final String lookup public final int order public StringIndex int values String lookup this order values this lookup lookup public interface ByteParser public byte parseByte String string public interface ShortParser public short parseShort String string public interface IntParser public int parseInt String string public interface FloatParser public float parseFloat String string public static FieldCache DEFAULT new FieldCacheImpl public byte getBytes IndexReader reader String field throws IOException public byte getBytes IndexReader reader String field ByteParser parser throws IOException public short getShorts IndexReader reader String field throws IOException public short getShorts IndexReader reader String field ShortParser parser throws IOException public int getInts IndexReader reader String field throws IOException public int getInts IndexReader reader String field IntParser parser throws IOException public float getFloats IndexReader reader String field throws IOException public float getFloats IndexReader reader String field FloatParser parser throws IOException public String getStrings IndexReader reader String field throws IOException public StringIndex getStringIndex IndexReader reader String field throws IOException public Object getAuto IndexReader reader String field throws IOException public Comparable getCustom IndexReader reader String field SortComparator comparator throws IOException public class SmallFloat public static byte floatToByte float int numMantissaBits int zeroExp int fzero zeroExp numMantissaBits int bits Float floatToRawIntBits int smallfloat bits numMantissaBits if smallfloat fzero return bits else if smallfloat fzero else return byte smallfloat fzero public static float byteToFloat byte int numMantissaBits int zeroExp if return int bits numMantissaBits bits zeroExp return Float intBitsToFloat bits public static byte floatToByte315 float int bits Float floatToRawIntBits int smallfloat bits if smallfloat return bits byte byte if smallfloat return return byte smallfloat public static float byte315ToFloat byte if return int bits bits return Float intBitsToFloat bits public static byte floatToByte52 float int bits Float floatToRawIntBits int smallfloat bits if smallfloat return bits byte byte if smallfloat return return byte smallfloat public static float byte52ToFloat byte if return int bits bits return Float intBitsToFloat bits final class IndexFileDeleter private List deletable private Map refCounts new HashMap private List commits new ArrayList private List lastFiles new ArrayList private List commitsToDelete new ArrayList private PrintStream infoStream private Directory directory private IndexDeletionPolicy policy void setInfoStream PrintStream infoStream this infoStream infoStream private void message String message infoStream println this Thread currentThread getName message public IndexFileDeleter Directory directory IndexDeletionPolicy policy SegmentInfos segmentInfos PrintStream infoStream throws CorruptIndexException IOException this infoStream infoStream this policy policy this directory directory long currentGen segmentInfos getGeneration IndexFileNameFilter filter IndexFileNameFilter getFilter String files directory list if files null throw new IOException directory CommitPoint currentCommitPoint null for int files length String fileName files if filter accept null fileName fileName equals IndexFileNames SEGMENTS_GEN getRefCount fileName if fileName startsWith IndexFileNames SEGMENTS if SegmentInfos generationFromSegmentsFileName fileName currentGen if infoStream null message fileName SegmentInfos sis new SegmentInfos sis read directory fileName CommitPoint commitPoint new CommitPoint sis if sis getGeneration segmentInfos getGeneration currentCommitPoint commitPoint commits add commitPoint incRef sis true if currentCommitPoint null throw new CorruptIndexException Collections sort commits Iterator it refCounts keySet iterator while it hasNext String fileName String it next RefCount rc RefCount refCounts get fileName if rc count if infoStream null message fileName deleteFile fileName policy onInit commits if currentCommitPoint deleted checkpoint segmentInfos false deleteCommits private void deleteCommits throws IOException int size commitsToDelete size if size for int size CommitPoint commit CommitPoint commitsToDelete get if infoStream null message commit getSegmentsFileName int size2 commit files size for int size2 decRef List commit files get decRef commit getSegmentsFileName commitsToDelete clear size commits size int readFrom int writeTo while readFrom size CommitPoint commit CommitPoint commits get readFrom if commit deleted if writeTo readFrom commits set writeTo commits get readFrom writeTo readFrom while size writeTo commits remove size size public void refresh throws IOException String files directory list if files null throw new IOException directory IndexFileNameFilter filter IndexFileNameFilter getFilter for int files length String fileName files if filter accept null fileName refCounts containsKey fileName fileName equals IndexFileNames SEGMENTS_GEN if infoStream null message fileName deleteFile fileName public void checkpoint SegmentInfos segmentInfos boolean isCommit throws IOException if infoStream null message segmentInfos getCurrentSegmentFileName isCommit if deletable null List oldDeletable deletable deletable null int size oldDeletable size for int size deleteFile String oldDeletable get incRef segmentInfos isCommit if isCommit commits add new CommitPoint segmentInfos policy onCommit commits deleteCommits int size lastFiles size if size for int size decRef List lastFiles get lastFiles clear if isCommit size segmentInfos size for int size SegmentInfo segmentInfo segmentInfos info if segmentInfo dir directory lastFiles add segmentInfo files void incRef SegmentInfos segmentInfos boolean isCommit throws IOException int size segmentInfos size for int size SegmentInfo segmentInfo segmentInfos info if segmentInfo dir directory incRef segmentInfo files if isCommit getRefCount segmentInfos getCurrentSegmentFileName IncRef private void incRef List files throws IOException int size files size for int size String fileName String files get RefCount rc getRefCount fileName if infoStream null message fileName rc count rc IncRef private void decRef List files throws IOException int size files size for int size decRef String files get private void decRef String fileName throws IOException RefCount rc getRefCount fileName if infoStream null message fileName rc count if rc DecRef deleteFile fileName refCounts remove fileName void decRef SegmentInfos segmentInfos throws IOException final int size segmentInfos size for int size SegmentInfo segmentInfo segmentInfos info if segmentInfo dir directory decRef segmentInfo files private RefCount getRefCount String fileName RefCount rc if refCounts containsKey fileName rc new RefCount refCounts put fileName rc else rc RefCount refCounts get fileName return rc private void deleteFile String fileName throws IOException try if infoStream null message fileName directory deleteFile fileName if directory fileExists fileName if infoStream null message fileName toString if deletable null deletable new ArrayList public void deleteDirect Directory otherDir List segments throws IOException int size segments size for int size List filestoDelete SegmentInfo segments get files int size2 filestoDelete size for int size2 otherDir deleteFile String filestoDelete get final private static class RefCount int count final private int IncRef return count final private int DecRef return count final private class CommitPoint implements Comparable IndexCommitPoint long gen List files String segmentsFileName boolean deleted public CommitPoint SegmentInfos segmentInfos throws IOException segmentsFileName segmentInfos getCurrentSegmentFileName int size segmentInfos size files new ArrayList size gen segmentInfos getGeneration for int size SegmentInfo segmentInfo segmentInfos info if segmentInfo dir directory files add segmentInfo files public String getSegmentsFileName return segmentsFileName public void delete if deleted deleted true commitsToDelete add this public int compareTo Object obj CommitPoint commit CommitPoint obj if gen commit gen return else if gen commit gen return else return public class KeywordTokenizer extends Tokenizer private static final int DEFAULT_BUFFER_SIZE private boolean done private final char buffer public KeywordTokenizer Reader input this input DEFAULT_BUFFER_SIZE public KeywordTokenizer Reader input int bufferSize super input this buffer new char bufferSize this done false public Token next throws IOException if done done true StringBuffer buffer new StringBuffer int length while true length input read this buffer if length break buffer append this buffer length String text buffer toString return new Token text text length return null public interface QueryParserConstants int EOF int int int int int int AND int OR int NOT int PLUS int MINUS int LPAREN int RPAREN int COLON int STAR int CARAT int QUOTED int TERM int FUZZY_SLOP int PREFIXTERM int WILDTERM int RANGEIN_START int RANGEEX_START int NUMBER int RANGEIN_TO int RANGEIN_END int RANGEIN_QUOTED int RANGEIN_GOOP int RANGEEX_TO int RANGEEX_END int RANGEEX_QUOTED int RANGEEX_GOOP int Boost int RangeEx int RangeIn int DEFAULT String tokenImage public interface TermFreqVector public String getField public int size public String getTerms public int getTermFrequencies public int indexOf String term public int indexesOf String terms int start int len final class IndexFileNames static final String SEGMENTS static final String SEGMENTS_GEN static final String DELETABLE static final String NORMS_EXTENSION static final String COMPOUND_FILE_EXTENSION static final String DELETES_EXTENSION static final String PLAIN_NORMS_EXTENSION static final String SEPARATE_NORMS_EXTENSION static final String INDEX_EXTENSIONS new String static final String INDEX_EXTENSIONS_IN_COMPOUND_FILE new String static final String COMPOUND_EXTENSIONS new String static final String VECTOR_EXTENSIONS new String static final String fileNameFromGeneration String base String extension long gen if gen SegmentInfo NO return null else if gen SegmentInfo WITHOUT_GEN return base extension else return base Long toString gen Character MAX_RADIX extension final class SegmentInfos extends Vector public static final int FORMAT public static final int FORMAT_LOCKLESS public static final int FORMAT_SINGLE_NORM_FILE private static final int CURRENT_FORMAT FORMAT_SINGLE_NORM_FILE private long version System currentTimeMillis private static PrintStream infoStream public final SegmentInfo info int return SegmentInfo elementAt public static long getCurrentSegmentGeneration String files if files null return long max for int files length String file files if file startsWith IndexFileNames SEGMENTS file equals IndexFileNames SEGMENTS_GEN long gen generationFromSegmentsFileName file if gen max max gen return max public static long getCurrentSegmentGeneration Directory directory throws IOException String files directory list if files null throw new IOException directory return getCurrentSegmentGeneration files public static String getCurrentSegmentFileName String files throws IOException return IndexFileNames fileNameFromGeneration IndexFileNames SEGMENTS getCurrentSegmentGeneration files public static String getCurrentSegmentFileName Directory directory throws IOException return IndexFileNames fileNameFromGeneration IndexFileNames SEGMENTS getCurrentSegmentGeneration directory public String getCurrentSegmentFileName return IndexFileNames fileNameFromGeneration IndexFileNames SEGMENTS lastGeneration public static long generationFromSegmentsFileName String fileName if fileName equals IndexFileNames SEGMENTS return else if fileName startsWith IndexFileNames SEGMENTS return Long parseLong fileName substring IndexFileNames SEGMENTS length Character MAX_RADIX else throw new IllegalArgumentException fileName public String getNextSegmentFileName long nextGeneration if generation nextGeneration else nextGeneration generation return IndexFileNames fileNameFromGeneration IndexFileNames SEGMENTS nextGeneration public final void read Directory directory String segmentFileName throws CorruptIndexException IOException boolean success false IndexInput input directory openInput segmentFileName generation generationFromSegmentsFileName segmentFileName lastGeneration generation try int format input readInt if format CURRENT_FORMAT throw new CorruptIndexException format counter format addElement new SegmentInfo directory format input if input getFilePointer input length else success true finally input close if success clear public final void read Directory directory throws CorruptIndexException IOException generation lastGeneration new FindSegmentsFile directory protected Object doBody String segmentFileName throws CorruptIndexException IOException read directory segmentFileName return null run public final void write Directory directory throws IOException String segmentFileName getNextSegmentFileName if generation generation else generation IndexOutput output directory createOutput segmentFileName boolean success false try for int size info write output finally try output close success true finally if success directory deleteFile segmentFileName try output directory createOutput IndexFileNames SEGMENTS_GEN try output writeInt FORMAT_LOCKLESS output writeLong generation output writeLong generation finally output close catch IOException lastGeneration generation public Object clone SegmentInfos sis SegmentInfos super clone for int sis size sis setElementAt SegmentInfo sis elementAt clone return sis public long getVersion return version public long getGeneration return generation public static long readCurrentVersion Directory directory throws CorruptIndexException IOException return Long new FindSegmentsFile directory protected Object doBody String segmentFileName throws CorruptIndexException IOException IndexInput input directory openInput segmentFileName int format long version try format input readInt if format if format CURRENT_FORMAT throw new CorruptIndexException format finally input close if format return new Long version SegmentInfos sis new SegmentInfos sis read directory segmentFileName return new Long sis getVersion run longValue public static void setInfoStream PrintStream infoStream SegmentInfos infoStream infoStream private static int defaultGenFileRetryCount private static int defaultGenFileRetryPauseMsec private static int defaultGenLookaheadCount public static void setDefaultGenFileRetryCount int count defaultGenFileRetryCount count public static int getDefaultGenFileRetryCount return defaultGenFileRetryCount public static void setDefaultGenFileRetryPauseMsec int msec defaultGenFileRetryPauseMsec msec public static int getDefaultGenFileRetryPauseMsec return defaultGenFileRetryPauseMsec public static void setDefaultGenLookaheadCount int count defaultGenLookaheadCount count public static int getDefaultGenLookahedCount return defaultGenLookaheadCount public static PrintStream getInfoStream return infoStream private static void message String message if infoStream null infoStream println Thread currentThread getName message public abstract static class FindSegmentsFile File fileDirectory Directory directory public FindSegmentsFile File directory this fileDirectory directory public FindSegmentsFile Directory directory this directory directory public Object run throws CorruptIndexException IOException String segmentFileName null long lastGen long gen int genLookaheadCount IOException exc null boolean retry false int method while true String files null if method if directory null files directory list if files null throw new FileNotFoundException directory else files fileDirectory list if files null throw new FileNotFoundException fileDirectory gen getCurrentSegmentGeneration files if gen String for int files length files throw new FileNotFoundException directory if method method lastGen gen retry method for int defaultGenFileRetryCount IndexInput genInput null try genInput directory openInput IndexFileNames SEGMENTS_GEN catch IOException message if genInput null try int version genInput readInt if version FORMAT_LOCKLESS long gen0 genInput readLong long gen1 genInput readLong message gen0 gen1 if gen0 gen1 if gen0 gen message IndexFileNames SEGMENTS_GEN gen0 gen gen gen0 break catch IOException err2 finally genInput close try Thread sleep defaultGenFileRetryPauseMsec catch InterruptedException if method method lastGen gen retry method if genLookaheadCount defaultGenLookaheadCount gen genLookaheadCount message gen if lastGen gen if retry throw exc else retry true else retry false lastGen gen segmentFileName IndexFileNames fileNameFromGeneration IndexFileNames SEGMENTS gen try Object doBody segmentFileName if exc null message segmentFileName return catch IOException err if exc null exc err message segmentFileName err retry gen if retry gen String prevSegmentFileName IndexFileNames fileNameFromGeneration IndexFileNames SEGMENTS gen if directory fileExists prevSegmentFileName message prevSegmentFileName try Object doBody prevSegmentFileName if exc null message prevSegmentFileName return catch IOException err2 message prevSegmentFileName err2 protected abstract Object doBody String segmentFileName throws CorruptIndexException IOException public final class Field extends AbstractField implements Fieldable Serializable public static final class Store extends Parameter implements Serializable private Store String name super name public static final Store COMPRESS new Store public static final Store YES new Store public static final Store NO new Store public static final class Index extends Parameter implements Serializable private Index String name super name public static final Index NO new Index public static final Index TOKENIZED new Index public static final Index UN_TOKENIZED new Index public static final Index NO_NORMS new Index public static final class TermVector extends Parameter implements Serializable private TermVector String name super name public static final TermVector NO new TermVector public static final TermVector YES new TermVector public static final TermVector WITH_POSITIONS new TermVector public static final TermVector WITH_OFFSETS new TermVector public static final TermVector WITH_POSITIONS_OFFSETS new TermVector public String stringValue return fieldsData instanceof String String fieldsData null public Reader readerValue return fieldsData instanceof Reader Reader fieldsData null public byte binaryValue return fieldsData instanceof byte byte fieldsData null public TokenStream tokenStreamValue return fieldsData instanceof TokenStream TokenStream fieldsData null public Field String name String value Store store Index index this name value store index TermVector NO public Field String name String value Store store Index index TermVector termVector if name null throw new NullPointerException if value null throw new NullPointerException if name length value length throw new IllegalArgumentException if index Index NO store Store NO throw new IllegalArgumentException if index Index NO termVector TermVector NO throw new IllegalArgumentException this fieldsData value if store Store YES this isStored true this isCompressed false else if store Store COMPRESS this isStored true this isCompressed true else if store Store NO this isStored false this isCompressed false else throw new IllegalArgumentException store if index Index NO this isIndexed false this isTokenized false else if index Index TOKENIZED this isIndexed true this isTokenized true else if index Index UN_TOKENIZED this isIndexed true this isTokenized false else if index Index NO_NORMS this isIndexed true this isTokenized false this omitNorms true else throw new IllegalArgumentException index this isBinary false setStoreTermVector termVector public Field String name Reader reader this name reader TermVector NO public Field String name Reader reader TermVector termVector if name null throw new NullPointerException if reader null throw new NullPointerException this fieldsData reader this isStored false this isCompressed false this isIndexed true this isTokenized true this isBinary false setStoreTermVector termVector public Field String name TokenStream tokenStream this name tokenStream TermVector NO public Field String name TokenStream tokenStream TermVector termVector if name null throw new NullPointerException if tokenStream null throw new NullPointerException this fieldsData tokenStream this isStored false this isCompressed false this isIndexed true this isTokenized true this isBinary false setStoreTermVector termVector public Field String name byte value Store store if name null throw new IllegalArgumentException if value null throw new IllegalArgumentException this name name intern this fieldsData value if store Store YES this isStored true this isCompressed false else if store Store COMPRESS this isStored true this isCompressed true else if store Store NO throw new IllegalArgumentException else throw new IllegalArgumentException store this isIndexed false this isTokenized false this isBinary true setStoreTermVector TermVector NO public class TopDocCollector extends HitCollector private int numHits private float minScore int totalHits PriorityQueue hq public TopDocCollector int numHits this numHits new HitQueue numHits TopDocCollector int numHits PriorityQueue hq this numHits numHits this hq hq public void collect int doc float score if score totalHits if hq size numHits score minScore hq insert new ScoreDoc doc score public int getTotalHits return totalHits public TopDocs topDocs ScoreDoc scoreDocs new ScoreDoc hq size scoreDocs ScoreDoc hq pop float maxScore totalHits Float NEGATIVE_INFINITY scoreDocs score return new TopDocs totalHits scoreDocs maxScore public class KeywordAnalyzer extends Analyzer public TokenStream tokenStream String fieldName final Reader reader return new KeywordTokenizer reader public class FSDirectory extends Directory private static final Hashtable DIRECTORIES new Hashtable private static boolean disableLocks false public static void setDisableLocks boolean doDisableLocks FSDirectory disableLocks doDisableLocks public static boolean getDisableLocks return FSDirectory disableLocks public static final String LOCK_DIR System getProperty System getProperty private static Class IMPL static try String name System getProperty FSDirectory class getName IMPL Class forName name catch ClassNotFoundException throw new RuntimeException toString catch SecurityException se try IMPL Class forName FSDirectory class getName catch ClassNotFoundException throw new RuntimeException toString private static MessageDigest DIGESTER static try DIGESTER MessageDigest getInstance catch NoSuchAlgorithmException throw new RuntimeException toString private byte buffer null public static FSDirectory getDirectory String path throws IOException return getDirectory new File path null public static FSDirectory getDirectory String path LockFactory lockFactory throws IOException return getDirectory new File path lockFactory public static FSDirectory getDirectory File file throws IOException return getDirectory file null public static FSDirectory getDirectory File file LockFactory lockFactory throws IOException file new File file getCanonicalPath if file exists file isDirectory throw new IOException file if file exists if file mkdirs throw new IOException file FSDirectory dir synchronized DIRECTORIES dir FSDirectory DIRECTORIES get file if dir null try dir FSDirectory IMPL newInstance catch Exception throw new RuntimeException toString dir init file lockFactory DIRECTORIES put file dir else if lockFactory null lockFactory dir getLockFactory throw new IOException synchronized dir dir refCount return dir public static FSDirectory getDirectory String path boolean create throws IOException return getDirectory new File path create public static FSDirectory getDirectory File file boolean create throws IOException FSDirectory dir getDirectory file null if create dir create return dir private void create throws IOException if directory exists if files null throw new IOException directory getAbsolutePath for int files length File file new File directory files if file delete throw new IOException file lockFactory clearLock IndexWriter WRITE_LOCK_NAME private File directory null private int refCount private void init File path LockFactory lockFactory throws IOException directory path boolean doClearLockID false if lockFactory null if disableLocks lockFactory NoLockFactory getNoLockFactory else String lockClassName System getProperty if lockClassName null lockClassName equals Class try Class forName lockClassName catch ClassNotFoundException throw new IOException lockClassName try lockFactory LockFactory newInstance catch IllegalAccessException throw new IOException lockClassName catch InstantiationException throw new IOException lockClassName catch ClassCastException throw new IOException lockClassName if lockFactory instanceof NativeFSLockFactory NativeFSLockFactory lockFactory setLockDir path else if lockFactory instanceof SimpleFSLockFactory SimpleFSLockFactory lockFactory setLockDir path else lockFactory new SimpleFSLockFactory path doClearLockID true setLockFactory lockFactory if doClearLockID lockFactory setLockPrefix null public String list return directory list IndexFileNameFilter getFilter public boolean fileExists String name File file new File directory name return file exists public long fileModified String name File file new File directory name return file lastModified public static long fileModified File directory String name File file new File directory name return file lastModified public void touchFile String name File file new File directory name file setLastModified System currentTimeMillis public long fileLength String name File file new File directory name return file length public void deleteFile String name throws IOException File file new File directory name if file delete throw new IOException file public synchronized void renameFile String from String to throws IOException File old new File directory from File nu new File directory to if nu exists if nu delete throw new IOException nu if old renameTo nu java io InputStream in null java io OutputStream out null try in new FileInputStream old out new FileOutputStream nu if buffer null buffer new byte int len while len in read buffer out write buffer len old delete catch IOException ioe IOException newExc new IOException old nu newExc initCause ioe throw newExc finally try if in null try in close catch IOException throw new RuntimeException toString finally if out null try out close catch IOException throw new RuntimeException toString public IndexOutput createOutput String name throws IOException File file new File directory name throw new IOException file return new FSIndexOutput file public IndexInput openInput String name throws IOException return new FSIndexInput new File directory name public IndexInput openInput String name int bufferSize throws IOException return new FSIndexInput new File directory name bufferSize private static final char HEX_DIGITS public String getLockID try dirName directory getCanonicalPath catch IOException throw new RuntimeException toString byte digest synchronized DIGESTER digest DIGESTER digest dirName getBytes StringBuffer buf new StringBuffer buf append for int digest length int digest buf append HEX_DIGITS buf append HEX_DIGITS return buf toString public synchronized void close if refCount synchronized DIRECTORIES DIRECTORIES remove directory public File getFile return directory public String toString return this getClass getName directory protected static class FSIndexInput extends BufferedIndexInput private static class Descriptor extends RandomAccessFile private boolean isOpen long position final long length public Descriptor File file String mode throws IOException super file mode isOpen true length length public void close throws IOException if isOpen isOpen false super close protected void finalize throws Throwable try close finally super finalize private final Descriptor file boolean isClone public FSIndexInput File path throws IOException this path BufferedIndexInput BUFFER_SIZE public FSIndexInput File path int bufferSize throws IOException super bufferSize file new Descriptor path protected void readInternal byte int offset int len throws IOException synchronized file long position getFilePointer if position file position file seek position file position position int total do int file read offset total len total if throw new IOException file position total while total len public void close throws IOException if isClone file close protected void seekInternal long position public long length return file length public Object clone FSIndexInput clone FSIndexInput super clone clone isClone true return clone boolean isFDValid throws IOException return file getFD valid protected static class FSIndexOutput extends BufferedIndexOutput RandomAccessFile file null private boolean isOpen public FSIndexOutput File path throws IOException file new RandomAccessFile path isOpen true public void flushBuffer byte int offset int size throws IOException file write offset size public void close throws IOException if isOpen super close file close isOpen false public void seek long pos throws IOException super seek pos file seek pos public long length throws IOException return file length public class CachingTokenFilter extends TokenFilter private List cache private int index public CachingTokenFilter TokenStream input super input public Token next throws IOException if cache null cache new LinkedList fillCache if index cache size return null return Token cache get index public void reset throws IOException index private void fillCache throws IOException Token token while token input next null cache add token public class SpanOrQuery extends SpanQuery private List clauses private String field public SpanOrQuery SpanQuery clauses this clauses new ArrayList clauses length for int clauses length SpanQuery clause clauses field clause getField else if clause getField equals field throw new IllegalArgumentException this clauses add clause public SpanQuery getClauses return SpanQuery clauses toArray new SpanQuery clauses size public String getField return field public Collection getTerms Collection terms new ArrayList Iterator clauses iterator while hasNext SpanQuery clause SpanQuery next terms addAll clause getTerms return terms public void extractTerms Set terms Iterator clauses iterator while hasNext SpanQuery clause SpanQuery next clause extractTerms terms public Query rewrite IndexReader reader throws IOException SpanOrQuery clone null for int clauses size SpanQuery SpanQuery clauses get SpanQuery query SpanQuery rewrite reader if clone null clone SpanOrQuery this clone clone clauses set query if clone null else public String toString String field StringBuffer buffer new StringBuffer buffer append Iterator clauses iterator while hasNext SpanQuery clause SpanQuery next buffer append clause toString field if hasNext buffer append buffer append buffer append ToStringUtils boost getBoost return buffer toString public boolean equals Object if this return true if null getClass getClass return false final SpanOrQuery that SpanOrQuery if clauses equals that clauses return false if field equals that field return false return getBoost that getBoost public int hashCode int clauses hashCode Float floatToRawIntBits getBoost return private class SpanQueue extends PriorityQueue public SpanQueue int size initialize size protected final boolean lessThan Object o1 Object o2 Spans spans1 Spans o1 Spans spans2 Spans o2 if spans1 doc spans2 doc if spans1 start spans2 start return spans1 end spans2 end else return spans1 start spans2 start else return spans1 doc spans2 doc public Spans getSpans final IndexReader reader throws IOException return SpanQuery clauses get getSpans reader return new Spans private SpanQueue queue null private boolean initSpanQueue int target throws IOException queue new SpanQueue clauses size Iterator clauses iterator while hasNext Spans spans SpanQuery next getSpans reader if target spans next target spans skipTo target queue put spans return queue size public boolean next throws IOException if queue null return initSpanQueue return false queue adjustTop return true return queue size private Spans top return Spans queue top public boolean skipTo int target throws IOException if queue null return initSpanQueue target while queue size top doc target if top skipTo target queue adjustTop else queue pop return queue size public int doc return top doc public int start return top start public int end return top end public String toString return SpanOrQuery this queue null queue size doc start end public class NoLockFactory extends LockFactory private static NoLock singletonLock new NoLock private static NoLockFactory singleton new NoLockFactory public static NoLockFactory getNoLockFactory return singleton public Lock makeLock String lockName return singletonLock public void clearLock String lockName class NoLock extends Lock public boolean obtain throws IOException return true public void release public boolean isLocked return false public String toString return public class ScoreDoc implements java io Serializable public float score public int doc public ScoreDoc int doc float score this doc doc this score score class NearSpansOrdered implements Spans private final int allowedSlop private boolean firstTime true private boolean more false private final Spans subSpans private boolean inSameDoc false private int matchDoc private int matchStart private int matchEnd private final Spans subSpansByDoc private final Comparator spanDocComparator new Comparator public int compare Object o1 Object o2 return Spans o1 doc Spans o2 doc private SpanNearQuery query public NearSpansOrdered SpanNearQuery spanNearQuery IndexReader reader throws IOException if spanNearQuery getClauses length throw new IllegalArgumentException spanNearQuery allowedSlop spanNearQuery getSlop SpanQuery clauses spanNearQuery getClauses subSpans new Spans clauses length subSpansByDoc new Spans clauses length for int clauses length subSpans clauses getSpans reader public int doc return matchDoc public int start return matchStart public int end return matchEnd public boolean next throws IOException if firstTime firstTime false for int subSpans length if subSpans next more false return false more true return advanceAfterOrdered public boolean skipTo int target throws IOException if firstTime firstTime false for int subSpans length if subSpans skipTo target more false return false more true else if more subSpans doc target if subSpans skipTo target inSameDoc false else more false return false return advanceAfterOrdered private boolean advanceAfterOrdered throws IOException while more inSameDoc toSameDoc if stretchToOrder shrinkToAfterShortestMatch return true private boolean toSameDoc throws IOException Arrays sort subSpansByDoc spanDocComparator int firstIndex int maxDoc subSpansByDoc subSpansByDoc length doc while subSpansByDoc firstIndex doc maxDoc if subSpansByDoc firstIndex skipTo maxDoc more false inSameDoc false return false maxDoc subSpansByDoc firstIndex doc if firstIndex subSpansByDoc length firstIndex for int subSpansByDoc length assert subSpansByDoc doc maxDoc subSpansByDoc subSpansByDoc doc maxDoc inSameDoc true return true static final boolean docSpansOrdered Spans spans1 Spans spans2 assert spans1 doc spans2 doc spans1 doc spans2 doc int start1 spans1 start int start2 spans2 start return start1 start2 spans1 end spans2 end start1 start2 private static final boolean docSpansOrdered int start1 int end1 int start2 int end2 return start1 start2 end1 end2 start1 start2 private boolean stretchToOrder throws IOException matchDoc subSpans doc for int inSameDoc subSpans length while docSpansOrdered subSpans subSpans if subSpans next inSameDoc false more false break else if matchDoc subSpans doc inSameDoc false break return inSameDoc private boolean shrinkToAfterShortestMatch throws IOException matchStart subSpans subSpans length start matchEnd subSpans subSpans length end int matchSlop int lastStart matchStart int lastEnd matchEnd for int subSpans length Spans prevSpans subSpans int prevStart prevSpans start int prevEnd prevSpans end if prevSpans next inSameDoc false more false else if matchDoc prevSpans doc else int ppStart prevSpans start if docSpansOrdered ppStart ppEnd lastStart lastEnd prevStart ppStart prevEnd ppEnd assert prevStart matchStart matchSlop matchStart prevEnd matchStart prevStart lastStart prevStart lastEnd prevEnd public String toString return getClass getName query toString firstTime more doc start end public final class LengthFilter extends TokenFilter final int min final int max public LengthFilter TokenStream in int min int max super in this min min this max max public final Token next throws IOException for Token token input next token null token input next int len token termText length if len min len max return token return null public class IndexSearcher extends Searcher IndexReader reader private boolean closeReader public IndexSearcher String path throws CorruptIndexException IOException this IndexReader open path true public IndexSearcher Directory directory throws CorruptIndexException IOException this IndexReader open directory true public IndexSearcher IndexReader this false private IndexSearcher IndexReader boolean closeReader reader this closeReader closeReader public IndexReader getIndexReader return reader public void close throws IOException if closeReader reader close public int docFreq Term term throws IOException return reader docFreq term public Document doc int throws CorruptIndexException IOException return reader document public Document doc int FieldSelector fieldSelector throws CorruptIndexException IOException return reader document fieldSelector public int maxDoc throws IOException return reader maxDoc public TopDocs search Weight weight Filter filter final int nDocs throws IOException throw new IllegalArgumentException TopDocCollector collector new TopDocCollector nDocs search weight filter collector return collector topDocs public TopFieldDocs search Weight weight Filter filter final int nDocs Sort sort throws IOException TopFieldDocCollector collector new TopFieldDocCollector reader sort nDocs search weight filter collector return TopFieldDocs collector topDocs public void search Weight weight Filter filter final HitCollector results throws IOException HitCollector collector results if filter null final BitSet bits filter bits reader collector new HitCollector public final void collect int doc float score results collect doc score Scorer scorer weight scorer reader if scorer null return scorer score collector public Query rewrite Query original throws IOException Query query original for Query rewrittenQuery query rewrite reader rewrittenQuery query rewrittenQuery query rewrite reader query rewrittenQuery return query public Explanation explain Weight weight int doc throws IOException return weight explain reader doc public class ParseException extends Exception public ParseException Token currentTokenVal int expectedTokenSequencesVal String tokenImageVal super specialConstructor true currentToken currentTokenVal expectedTokenSequences expectedTokenSequencesVal tokenImage tokenImageVal public ParseException super specialConstructor false public ParseException String message super message specialConstructor false protected boolean specialConstructor public Token currentToken public int expectedTokenSequences public String tokenImage public String getMessage if specialConstructor return super getMessage String expected int maxSize for int expectedTokenSequences length if maxSize expectedTokenSequences length maxSize expectedTokenSequences length for int expectedTokenSequences length expected tokenImage expectedTokenSequences if expectedTokenSequences expectedTokenSequences length expected expected eol String retval Token tok currentToken next for int maxSize if retval if tok kind retval tokenImage break retval add_escapes tok image tok tok next retval currentToken next beginLine currentToken next beginColumn retval eol if expectedTokenSequences length retval eol else retval eol retval expected return retval protected String eol System getProperty protected String add_escapes String str StringBuffer retval new StringBuffer char ch for int str length switch str charAt case continue case retval append continue case retval append continue case retval append continue case retval append continue case retval append continue case retval append continue case retval append continue case retval append continue default if ch str charAt ch String Integer toString ch retval append substring length length else retval append ch continue return retval toString public interface Weight extends java io Serializable Query getQuery float getValue float sumOfSquaredWeights throws IOException void normalize float norm Scorer scorer IndexReader reader throws IOException Explanation explain IndexReader reader int doc throws IOException public abstract class Scorer private Similarity similarity protected Scorer Similarity similarity this similarity similarity public Similarity getSimilarity return this similarity public void score HitCollector hc throws IOException while next hc collect doc score protected boolean score HitCollector hc int max throws IOException while doc max hc collect doc score if next return false return true public abstract boolean next throws IOException public abstract int doc public abstract float score throws IOException public abstract boolean skipTo int target throws IOException public abstract Explanation explain int doc throws IOException public abstract class IndexReader public static final class FieldOption private String option private FieldOption private FieldOption String option this option option public String toString return this option public static final FieldOption ALL new FieldOption public static final FieldOption INDEXED new FieldOption public static final FieldOption STORES_PAYLOADS new FieldOption public static final FieldOption UNINDEXED new FieldOption public static final FieldOption INDEXED_WITH_TERMVECTOR new FieldOption public static final FieldOption INDEXED_NO_TERMVECTOR new FieldOption public static final FieldOption TERMVECTOR new FieldOption public static final FieldOption TERMVECTOR_WITH_POSITION new FieldOption public static final FieldOption TERMVECTOR_WITH_OFFSET new FieldOption public static final FieldOption TERMVECTOR_WITH_POSITION_OFFSET new FieldOption protected IndexReader Directory directory this directory directory IndexReader Directory directory SegmentInfos segmentInfos boolean closeDirectory init directory segmentInfos closeDirectory true void init Directory directory SegmentInfos segmentInfos boolean closeDirectory boolean directoryOwner this directory directory this segmentInfos segmentInfos this directoryOwner directoryOwner this closeDirectory closeDirectory private Directory directory private boolean directoryOwner private boolean closeDirectory private IndexDeletionPolicy deletionPolicy private boolean closed protected final void ensureOpen throws AlreadyClosedException if closed throw new AlreadyClosedException private SegmentInfos segmentInfos private Lock writeLock private boolean stale private boolean hasChanges private boolean rollbackHasChanges private SegmentInfos rollbackSegmentInfos public static IndexReader open String path throws CorruptIndexException IOException return open FSDirectory getDirectory path true null public static IndexReader open File path throws CorruptIndexException IOException return open FSDirectory getDirectory path true null public static IndexReader open final Directory directory throws CorruptIndexException IOException return open directory false null public static IndexReader open final Directory directory IndexDeletionPolicy deletionPolicy throws CorruptIndexException IOException return open directory false deletionPolicy private static IndexReader open final Directory directory final boolean closeDirectory final IndexDeletionPolicy deletionPolicy throws CorruptIndexException IOException return IndexReader new SegmentInfos FindSegmentsFile directory protected Object doBody String segmentFileName throws CorruptIndexException IOException SegmentInfos infos new SegmentInfos infos read directory segmentFileName IndexReader reader reader SegmentReader get infos infos info closeDirectory else IndexReader readers new IndexReader infos size for int infos size try readers SegmentReader get infos info catch IOException for infos size readers close throw reader new MultiReader directory infos closeDirectory readers reader deletionPolicy deletionPolicy return reader run public Directory directory ensureOpen return directory public static long lastModified String directory throws CorruptIndexException IOException return lastModified new File directory public static long lastModified File fileDirectory throws CorruptIndexException IOException return Long new SegmentInfos FindSegmentsFile fileDirectory public Object doBody String segmentFileName return new Long FSDirectory fileModified fileDirectory segmentFileName run longValue public static long lastModified final Directory directory2 throws CorruptIndexException IOException return Long new SegmentInfos FindSegmentsFile directory2 public Object doBody String segmentFileName throws IOException return new Long directory2 fileModified segmentFileName run longValue public static long getCurrentVersion String directory throws CorruptIndexException IOException return getCurrentVersion new File directory public static long getCurrentVersion File directory throws CorruptIndexException IOException Directory dir FSDirectory getDirectory directory long version getCurrentVersion dir dir close return version public static long getCurrentVersion Directory directory throws CorruptIndexException IOException return SegmentInfos readCurrentVersion directory public long getVersion ensureOpen return segmentInfos getVersion public boolean isCurrent throws CorruptIndexException IOException ensureOpen return SegmentInfos readCurrentVersion directory segmentInfos getVersion public boolean isOptimized ensureOpen return segmentInfos size hasDeletions false abstract public TermFreqVector getTermFreqVectors int docNumber throws IOException abstract public TermFreqVector getTermFreqVector int docNumber String field throws IOException public static boolean indexExists String directory return indexExists new File directory public static boolean indexExists File directory return SegmentInfos getCurrentSegmentGeneration directory list public static boolean indexExists Directory directory throws IOException return SegmentInfos getCurrentSegmentGeneration directory public abstract int numDocs public abstract int maxDoc public Document document int throws CorruptIndexException IOException ensureOpen return document null public abstract Document document int FieldSelector fieldSelector throws CorruptIndexException IOException public abstract boolean isDeleted int public abstract boolean hasDeletions public boolean hasNorms String field throws IOException ensureOpen return norms field null public abstract byte norms String field throws IOException public abstract void norms String field byte bytes int offset throws IOException public final synchronized void setNorm int doc String field byte value throws StaleReaderException CorruptIndexException LockObtainFailedException IOException ensureOpen if directoryOwner acquireWriteLock hasChanges true doSetNorm doc field value protected abstract void doSetNorm int doc String field byte value throws CorruptIndexException IOException public void setNorm int doc String field float value throws StaleReaderException CorruptIndexException LockObtainFailedException IOException ensureOpen setNorm doc field Similarity encodeNorm value public abstract TermEnum terms throws IOException public abstract TermEnum terms Term throws IOException public abstract int docFreq Term throws IOException public TermDocs termDocs Term term throws IOException ensureOpen TermDocs termDocs termDocs termDocs seek term return termDocs public abstract TermDocs termDocs throws IOException public TermPositions termPositions Term term throws IOException ensureOpen TermPositions termPositions termPositions termPositions seek term return termPositions public abstract TermPositions termPositions throws IOException private void acquireWriteLock throws StaleReaderException CorruptIndexException LockObtainFailedException IOException ensureOpen if stale throw new StaleReaderException if writeLock null Lock writeLock directory makeLock IndexWriter WRITE_LOCK_NAME throw new LockObtainFailedException writeLock this writeLock writeLock if SegmentInfos readCurrentVersion directory segmentInfos getVersion stale true this writeLock release this writeLock null throw new StaleReaderException public final synchronized void deleteDocument int docNum throws StaleReaderException CorruptIndexException LockObtainFailedException IOException ensureOpen if directoryOwner acquireWriteLock hasChanges true doDelete docNum protected abstract void doDelete int docNum throws CorruptIndexException IOException public final int deleteDocuments Term term throws StaleReaderException CorruptIndexException LockObtainFailedException IOException ensureOpen TermDocs docs termDocs term if docs null return int try while docs next deleteDocument docs doc finally docs close return public final synchronized void undeleteAll throws StaleReaderException CorruptIndexException LockObtainFailedException IOException ensureOpen if directoryOwner acquireWriteLock hasChanges true doUndeleteAll protected abstract void doUndeleteAll throws CorruptIndexException IOException void startCommit if directoryOwner rollbackSegmentInfos SegmentInfos segmentInfos clone rollbackHasChanges hasChanges void rollbackCommit if directoryOwner for int segmentInfos size segmentInfos info reset rollbackSegmentInfos info rollbackSegmentInfos null hasChanges rollbackHasChanges protected final synchronized void commit throws IOException if hasChanges if directoryOwner IndexFileDeleter deleter new IndexFileDeleter directory deletionPolicy null new KeepOnlyLastCommitDeletionPolicy deletionPolicy segmentInfos null startCommit boolean success false try doCommit segmentInfos write directory success true finally if success rollbackCommit deleter refresh deleter checkpoint segmentInfos true if writeLock null writeLock null else doCommit hasChanges false protected abstract void doCommit throws IOException public final synchronized void close throws IOException if closed commit doClose if directoryOwner closed true if closeDirectory directory close protected abstract void doClose throws IOException protected void finalize throws Throwable try if writeLock null writeLock null finally super finalize public abstract Collection getFieldNames FieldOption fldOption public static boolean isLocked Directory directory throws IOException return directory makeLock IndexWriter WRITE_LOCK_NAME isLocked public static boolean isLocked String directory throws IOException Directory dir FSDirectory getDirectory directory boolean result isLocked dir dir close return result public static void unlock Directory directory throws IOException directory makeLock IndexWriter WRITE_LOCK_NAME release public static void main String args String filename null boolean extract false for int args length if args equals extract true else if filename null filename args if filename null System out println return Directory dir null CompoundFileReader cfr null try File file new File filename String dirname file getAbsoluteFile getParent filename file getName dir FSDirectory getDirectory dirname cfr new CompoundFileReader dir filename String files cfr list for int files length long len cfr fileLength files if extract System out println files len IndexInput ii cfr openInput files FileOutputStream new FileOutputStream files byte buffer new byte int chunk buffer length while len final int bufLen int Math min chunk len ii readBytes buffer bufLen write buffer bufLen len bufLen close ii close else System out println files len catch IOException ioe ioe printStackTrace finally try if dir null dir close if cfr null cfr close catch IOException ioe ioe printStackTrace public class QueryWrapperFilter extends Filter private Query query public QueryWrapperFilter Query query this query query public BitSet bits IndexReader reader throws IOException final BitSet bits new BitSet reader maxDoc new IndexSearcher reader search query new HitCollector public final void collect int doc float score return bits public String toString return query public boolean equals Object if instanceof QueryWrapperFilter return false return this query equals QueryWrapperFilter query public int hashCode return query hashCode public final class StopAnalyzer extends Analyzer private Set stopWords public static final String ENGLISH_STOP_WORDS public StopAnalyzer stopWords StopFilter makeStopSet ENGLISH_STOP_WORDS public StopAnalyzer Set stopWords this stopWords stopWords public StopAnalyzer String stopWords this stopWords StopFilter makeStopSet stopWords public StopAnalyzer File stopwordsFile throws IOException stopWords WordlistLoader getWordSet stopwordsFile public StopAnalyzer Reader stopwords throws IOException stopWords WordlistLoader getWordSet stopwords public TokenStream tokenStream String fieldName Reader reader return new StopFilter new LowerCaseTokenizer reader stopWords class TermVectorsReader implements Cloneable private FieldInfos fieldInfos private IndexInput tvx private IndexInput tvd private IndexInput tvf private int size private int tvdFormat private int tvfFormat TermVectorsReader Directory String segment FieldInfos fieldInfos throws CorruptIndexException IOException this segment fieldInfos BufferedIndexInput BUFFER_SIZE TermVectorsReader Directory String segment FieldInfos fieldInfos int readBufferSize throws CorruptIndexException IOException if fileExists segment TermVectorsWriter TVX_EXTENSION tvx openInput segment TermVectorsWriter TVX_EXTENSION readBufferSize checkValidFormat tvx tvd openInput segment TermVectorsWriter TVD_EXTENSION readBufferSize tvdFormat checkValidFormat tvd tvf openInput segment TermVectorsWriter TVF_EXTENSION readBufferSize tvfFormat checkValidFormat tvf size int tvx length this fieldInfos fieldInfos private int checkValidFormat IndexInput in throws CorruptIndexException IOException int format in readInt if format TermVectorsWriter FORMAT_VERSION throw new CorruptIndexException format TermVectorsWriter FORMAT_VERSION return format void close throws IOException IOException keep null if tvx null try tvx close catch IOException if keep null keep if tvd null try tvd close catch IOException if keep null keep if tvf null try tvf close catch IOException if keep null keep if keep null throw IOException keep fillInStackTrace int size return size TermFreqVector get int docNum String field throws IOException int fieldNumber fieldInfos fieldNumber field TermFreqVector result null if tvx null tvx seek docNum TermVectorsWriter FORMAT_SIZE long position tvx readLong tvd seek position int fieldCount tvd readVInt int number int found for int fieldCount if tvdFormat TermVectorsWriter FORMAT_VERSION number tvd readVInt else number tvd readVInt if number fieldNumber found if found position for int found position tvd readVLong result readTermVector field position else else return result TermFreqVector get int docNum throws IOException TermFreqVector result null if tvx null tvx seek docNum TermVectorsWriter FORMAT_SIZE long position tvx readLong tvd seek position int fieldCount tvd readVInt if fieldCount int number String fields new String fieldCount for int fieldCount if tvdFormat TermVectorsWriter FORMAT_VERSION number tvd readVInt else number tvd readVInt fields fieldInfos fieldName number position long tvfPointers new long fieldCount for int fieldCount position tvd readVLong tvfPointers position result readTermVectors fields tvfPointers else return result private SegmentTermVector readTermVectors String fields long tvfPointers throws IOException SegmentTermVector res new SegmentTermVector fields length for int fields length res readTermVector fields tvfPointers return res private SegmentTermVector readTermVector String field long tvfPointer throws IOException tvf seek tvfPointer int numTerms tvf readVInt if numTerms return new SegmentTermVector field null null boolean storePositions boolean storeOffsets if tvfFormat TermVectorsWriter FORMAT_VERSION byte bits tvf readByte storePositions bits TermVectorsWriter STORE_POSITIONS_WITH_TERMVECTOR storeOffsets bits TermVectorsWriter STORE_OFFSET_WITH_TERMVECTOR else tvf readVInt storePositions false storeOffsets false String terms new String numTerms int termFreqs new int numTerms int positions null TermVectorOffsetInfo offsets null if storePositions positions new int numTerms if storeOffsets offsets new TermVectorOffsetInfo numTerms int start int deltaLength int totalLength char previousBuffer for int numTerms start tvf readVInt deltaLength tvf readVInt totalLength start deltaLength buffer new char totalLength System arraycopy previousBuffer buffer start tvf readChars buffer start deltaLength terms new String buffer totalLength previousBuffer buffer int freq tvf readVInt termFreqs freq int pos new int freq positions pos int prevPosition for int freq pos prevPosition tvf readVInt prevPosition pos if storeOffsets TermVectorOffsetInfo offs new TermVectorOffsetInfo freq offsets offs int prevOffset for int freq int startOffset prevOffset tvf readVInt int endOffset startOffset tvf readVInt offs new TermVectorOffsetInfo startOffset endOffset prevOffset endOffset SegmentTermVector tv if storePositions storeOffsets tv new SegmentTermPositionVector field terms termFreqs positions offsets else tv new SegmentTermVector field terms termFreqs return tv protected Object clone if tvx null tvd null tvf null return null TermVectorsReader clone null try clone TermVectorsReader super clone catch CloneNotSupportedException clone tvx IndexInput tvx clone clone tvd IndexInput tvd clone clone tvf IndexInput tvf clone return clone public class StandardTokenizerTokenManager implements StandardTokenizerConstants public java io PrintStream debugStream System out public void setDebugStream java io PrintStream ds debugStream ds private final int jjMoveStringLiteralDfa0_0 return jjMoveNfa_0 private final void jjCheckNAdd int state if jjrounds state jjround jjstateSet jjnewStateCnt state jjrounds state jjround private final void jjAddStates int start int end do jjstateSet jjnewStateCnt jjnextStates start while start end private final void jjCheckNAddTwoStates int state1 int state2 jjCheckNAdd state1 jjCheckNAdd state2 private final void jjCheckNAddStates int start int end do jjCheckNAdd jjnextStates start while start end private final void jjCheckNAddStates int start jjCheckNAdd jjnextStates start jjCheckNAdd jjnextStates start static final long jjbitVec0 static final long jjbitVec2 static final long jjbitVec3 static final long jjbitVec4 static final long jjbitVec5 static final long jjbitVec6 static final long jjbitVec7 static final long jjbitVec8 static final long jjbitVec9 static final long jjbitVec10 static final long jjbitVec11 static final long jjbitVec12 static final long jjbitVec13 static final long jjbitVec14 static final long jjbitVec15 static final long jjbitVec16 static final long jjbitVec17 static final long jjbitVec18 static final long jjbitVec19 private final int jjMoveNfa_0 int startState int curPos int nextStates int startsAt jjnewStateCnt int jjstateSet startState int kind for if jjround ReInitRounds if curChar long curChar MatchLoop do switch jjstateSet case if if kind kind jjCheckNAddStates if jjCheckNAddStates if jjCheckNAddStates break case if jjCheckNAddStates break case if jjCheckNAddTwoStates break case case if jjCheckNAddTwoStates break case if jjCheckNAdd break case if break if kind kind jjCheckNAdd break case if jjCheckNAddTwoStates break case case if jjCheckNAddTwoStates break case if jjCheckNAdd break case if jjCheckNAddTwoStates break case if jjCheckNAddTwoStates break case if jjCheckNAddTwoStates break case case if break if kind kind jjCheckNAddTwoStates break case if jjCheckNAddTwoStates break case case if jjCheckNAddTwoStates break case if jjCheckNAdd break case if jjCheckNAddTwoStates break case if jjCheckNAddTwoStates break case if jjCheckNAddTwoStates break case case if jjCheckNAddTwoStates break case if jjCheckNAdd break case if break if kind kind jjCheckNAddTwoStates break case if jjCheckNAddStates break case if break if kind kind jjCheckNAddStates break case if break if kind kind jjCheckNAdd break case if jjCheckNAddStates break case if jjCheckNAdd break case if jjCheckNAddStates break case if jjCheckNAddTwoStates break case if jjCheckNAdd break case if break if kind kind jjCheckNAddTwoStates break case if jjCheckNAddTwoStates break case if curChar jjCheckNAdd break case if break if kind kind jjCheckNAddTwoStates break case if jjCheckNAddTwoStates break case if jjCheckNAddTwoStates break case if jjCheckNAddTwoStates break case case if break if kind kind jjCheckNAdd break case if jjCheckNAddTwoStates break case if jjCheckNAddTwoStates break case if jjCheckNAddTwoStates break case case if jjCheckNAddTwoStates break case if jjCheckNAdd break case if break if kind kind jjCheckNAddTwoStates break case if jjCheckNAddTwoStates break case if jjCheckNAddTwoStates break case if jjCheckNAddTwoStates break case case if jjCheckNAddTwoStates break case if jjCheckNAdd break case if jjCheckNAddTwoStates break case if jjCheckNAddTwoStates break case if jjCheckNAddTwoStates break case case if break if kind kind jjCheckNAddTwoStates break case if curChar jjstateSet jjnewStateCnt break case if curChar jjCheckNAdd break case if curChar break if kind kind jjCheckNAdd break case if curChar jjstateSet jjnewStateCnt break default break while startsAt else if curChar long curChar MatchLoop do switch jjstateSet case if jjCheckNAddStates if if kind kind jjCheckNAddStates if jjCheckNAddStates break case if jjCheckNAddStates break case if jjCheckNAddTwoStates break case if jjAddStates break case if curChar jjCheckNAdd break case if break if kind kind jjCheckNAdd break case if jjCheckNAddTwoStates break case if jjCheckNAddTwoStates break case if curChar jjCheckNAdd break case if jjCheckNAddTwoStates break case if curChar jjCheckNAddTwoStates break case if jjCheckNAddTwoStates break case if break if kind kind jjCheckNAddTwoStates break case if jjCheckNAddTwoStates break case if jjAddStates break case if curChar jjCheckNAdd break case if jjCheckNAddTwoStates break case if curChar jjCheckNAddTwoStates break case if jjCheckNAddTwoStates break case if jjAddStates break case if curChar jjCheckNAdd break case if break if kind kind jjCheckNAddTwoStates break case if break if kind kind jjCheckNAddStates break case if break if kind kind jjCheckNAdd break case if jjCheckNAddStates break case if curChar jjCheckNAdd break case if jjCheckNAddStates break case if curChar jjCheckNAdd break case if jjCheckNAddTwoStates break case if break if kind kind jjCheckNAddTwoStates break case if jjCheckNAddTwoStates break case if break if kind kind jjCheckNAddTwoStates break case if jjCheckNAddTwoStates break case if curChar jjCheckNAddTwoStates break case if jjCheckNAddTwoStates break case if break if kind kind jjstateSet jjnewStateCnt break case if jjCheckNAddTwoStates break case if curChar jjCheckNAddTwoStates break case if jjCheckNAddTwoStates break case if jjAddStates break case if curChar jjCheckNAdd break case if break if kind kind jjCheckNAddTwoStates break case if jjCheckNAddTwoStates break case if curChar jjCheckNAddTwoStates break case if jjCheckNAddTwoStates break case if jjCheckNAddTwoStates break case if curChar jjCheckNAdd break case if jjCheckNAddTwoStates break case if curChar jjCheckNAddTwoStates break case if jjCheckNAddTwoStates break case if break if kind kind jjCheckNAddTwoStates break case if jjCheckNAddStates break case if jjCheckNAddTwoStates break case if break if kind kind jjCheckNAddTwoStates break case if jjCheckNAddTwoStates break case if jjAddStates break case if jjCheckNAddTwoStates break case if curChar jjCheckNAdd break case if break if kind kind jjCheckNAdd break default break while startsAt else int hiByte int curChar int i1 hiByte long l1 hiByte int i2 curChar long l2 curChar MatchLoop do switch jjstateSet case if jjCanMove_0 hiByte i1 i2 l1 l2 if kind kind if jjCanMove_1 hiByte i1 i2 l1 l2 if kind kind if jjCanMove_2 hiByte i1 i2 l1 l2 jjCheckNAddStates if jjCanMove_3 hiByte i1 i2 l1 l2 jjCheckNAddStates if jjCanMove_4 hiByte i1 i2 l1 l2 if kind kind jjCheckNAddStates if jjCanMove_2 hiByte i1 i2 l1 l2 jjCheckNAddStates break case if jjCanMove_1 hiByte i1 i2 l1 l2 kind kind break case if jjCanMove_2 hiByte i1 i2 l1 l2 jjCheckNAddStates break case if jjCanMove_2 hiByte i1 i2 l1 l2 jjCheckNAddTwoStates break case if jjCanMove_3 hiByte i1 i2 l1 l2 jjCheckNAddTwoStates break case if jjCanMove_2 hiByte i1 i2 l1 l2 jjCheckNAddTwoStates break case if jjCanMove_4 hiByte i1 i2 l1 l2 break if kind kind jjstateSet jjnewStateCnt break case if jjCanMove_2 hiByte i1 i2 l1 l2 jjCheckNAddTwoStates break case if jjCanMove_3 hiByte i1 i2 l1 l2 jjCheckNAddTwoStates break case if jjCanMove_2 hiByte i1 i2 l1 l2 jjCheckNAddTwoStates break case if jjCanMove_4 hiByte i1 i2 l1 l2 jjAddStates break case if jjCanMove_2 hiByte i1 i2 l1 l2 jjAddStates break case if jjCanMove_3 hiByte i1 i2 l1 l2 break if kind kind jjCheckNAddTwoStates break case if jjCanMove_2 hiByte i1 i2 l1 l2 break if kind kind jjCheckNAddTwoStates break case if jjCanMove_2 hiByte i1 i2 l1 l2 jjCheckNAddTwoStates break case if jjCanMove_3 hiByte i1 i2 l1 l2 jjCheckNAddTwoStates break case if jjCanMove_2 hiByte i1 i2 l1 l2 jjCheckNAddTwoStates break case if jjCanMove_4 hiByte i1 i2 l1 l2 jjCheckNAddTwoStates break case if jjCanMove_2 hiByte i1 i2 l1 l2 jjAddStates break case if jjCanMove_3 hiByte i1 i2 l1 l2 jjCheckNAddTwoStates break case if jjCanMove_2 hiByte i1 i2 l1 l2 jjCheckNAddTwoStates break case if jjCanMove_4 hiByte i1 i2 l1 l2 break if kind kind jjCheckNAddTwoStates break case if jjCanMove_3 hiByte i1 i2 l1 l2 jjCheckNAddStates break case if jjCanMove_4 hiByte i1 i2 l1 l2 break if kind kind jjCheckNAddStates break case if jjCanMove_4 hiByte i1 i2 l1 l2 break if kind kind jjCheckNAdd break case if jjCanMove_4 hiByte i1 i2 l1 l2 jjCheckNAddStates break case if jjCanMove_4 hiByte i1 i2 l1 l2 jjCheckNAddStates break case if jjCanMove_4 hiByte i1 i2 l1 l2 jjCheckNAddTwoStates break case if jjCanMove_4 hiByte i1 i2 l1 l2 break if kind kind jjCheckNAddTwoStates break case if jjCanMove_4 hiByte i1 i2 l1 l2 jjCheckNAddTwoStates break case if jjCanMove_4 hiByte i1 i2 l1 l2 break if kind kind jjCheckNAddTwoStates break case if jjCanMove_4 hiByte i1 i2 l1 l2 jjCheckNAddTwoStates break case if jjCanMove_2 hiByte i1 i2 l1 l2 jjAddStates break case if jjCanMove_3 hiByte i1 i2 l1 l2 break if kind kind jjCheckNAdd break case if jjCanMove_2 hiByte i1 i2 l1 l2 break if kind kind jjCheckNAdd break case if jjCanMove_4 hiByte i1 i2 l1 l2 jjCheckNAddTwoStates break case if jjCanMove_2 hiByte i1 i2 l1 l2 jjAddStates break case if jjCanMove_3 hiByte i1 i2 l1 l2 jjCheckNAddTwoStates break case if jjCanMove_2 hiByte i1 i2 l1 l2 jjCheckNAddTwoStates break case if jjCanMove_4 hiByte i1 i2 l1 l2 break if kind kind jjCheckNAddTwoStates break case if jjCanMove_4 hiByte i1 i2 l1 l2 jjCheckNAddTwoStates break case if jjCanMove_2 hiByte i1 i2 l1 l2 jjAddStates break case if jjCanMove_3 hiByte i1 i2 l1 l2 jjCheckNAddTwoStates break case if jjCanMove_2 hiByte i1 i2 l1 l2 jjCheckNAddTwoStates break case if jjCanMove_4 hiByte i1 i2 l1 l2 jjAddStates break case if jjCanMove_2 hiByte i1 i2 l1 l2 jjAddStates break case if jjCanMove_3 hiByte i1 i2 l1 l2 break if kind kind jjCheckNAddTwoStates break case if jjCanMove_2 hiByte i1 i2 l1 l2 break if kind kind jjCheckNAddTwoStates break case if jjCanMove_2 hiByte i1 i2 l1 l2 jjCheckNAddStates break case if jjCanMove_2 hiByte i1 i2 l1 l2 jjCheckNAddTwoStates break case if jjCanMove_2 hiByte i1 i2 l1 l2 break if kind kind jjCheckNAddTwoStates break case if jjCanMove_2 hiByte i1 i2 l1 l2 jjCheckNAddTwoStates break case if jjCanMove_2 hiByte i1 i2 l1 l2 jjAddStates break case if jjCanMove_2 hiByte i1 i2 l1 l2 jjCheckNAddTwoStates break case if jjCanMove_2 hiByte i1 i2 l1 l2 break if kind kind jjstateSet jjnewStateCnt break default break while startsAt if kind jjmatchedKind kind jjmatchedPos curPos kind curPos if jjnewStateCnt startsAt jjnewStateCnt startsAt return curPos try curChar input_stream readChar catch java io IOException return curPos static final int jjnextStates private static final boolean jjCanMove_0 int hiByte int i1 int i2 long l1 long l2 switch hiByte case return jjbitVec2 i2 l2 case return jjbitVec3 i2 l2 case return jjbitVec4 i2 l2 case return jjbitVec5 i2 l2 case return jjbitVec6 i2 l2 default if jjbitVec0 i1 l1 return true return false private static final boolean jjCanMove_1 int hiByte int i1 int i2 long l1 long l2 switch hiByte case return jjbitVec8 i2 l2 default if jjbitVec7 i1 l1 return true return false private static final boolean jjCanMove_2 int hiByte int i1 int i2 long l1 long l2 switch hiByte case return jjbitVec10 i2 l2 case return jjbitVec11 i2 l2 default if jjbitVec9 i1 l1 return true return false private static final boolean jjCanMove_3 int hiByte int i1 int i2 long l1 long l2 switch hiByte case return jjbitVec14 i2 l2 case return jjbitVec15 i2 l2 case return jjbitVec16 i2 l2 case return jjbitVec17 i2 l2 case return jjbitVec18 i2 l2 default if jjbitVec12 i1 l1 if jjbitVec13 i2 l2 return false else return true return false private static final boolean jjCanMove_4 int hiByte int i1 int i2 long l1 long l2 switch hiByte case return jjbitVec10 i2 l2 case return jjbitVec8 i2 l2 case return jjbitVec11 i2 l2 default if jjbitVec19 i1 l1 return true return false public static final String jjstrLiteralImages null null null null null null null null null null null null null null null public static final String lexStateNames static final long jjtoToken static final long jjtoSkip protected CharStream input_stream private final int jjrounds new int private final int jjstateSet new int protected char curChar public StandardTokenizerTokenManager CharStream stream input_stream stream public StandardTokenizerTokenManager CharStream stream int lexState this stream SwitchTo lexState public void ReInit CharStream stream jjmatchedPos jjnewStateCnt curLexState defaultLexState input_stream stream ReInitRounds private final void ReInitRounds int jjround for jjrounds public void ReInit CharStream stream int lexState ReInit stream SwitchTo lexState public void SwitchTo int lexState if lexState lexState throw new TokenMgrError lexState TokenMgrError INVALID_LEXICAL_STATE else curLexState lexState protected Token jjFillToken Token Token newToken jjmatchedKind kind jjmatchedKind String im jjstrLiteralImages jjmatchedKind image im null input_stream GetImage im beginLine input_stream getBeginLine beginColumn input_stream getBeginColumn endLine input_stream getEndLine endColumn input_stream getEndColumn return int curLexState int defaultLexState int jjnewStateCnt int jjround int jjmatchedPos int jjmatchedKind public Token getNextToken int kind Token specialToken null Token matchedToken int curPos EOFLoop for try curChar input_stream BeginToken catch java io IOException jjmatchedKind matchedToken jjFillToken return matchedToken jjmatchedKind jjmatchedPos curPos jjMoveStringLiteralDfa0_0 if jjmatchedPos jjmatchedKind jjmatchedKind if jjmatchedKind if jjmatchedPos curPos input_stream backup curPos jjmatchedPos if jjtoToken jjmatchedKind jjmatchedKind matchedToken jjFillToken return matchedToken else continue EOFLoop int error_line input_stream getEndLine int error_column input_stream getEndColumn String error_after null boolean EOFSeen false try input_stream readChar input_stream backup catch java io IOException e1 EOFSeen true error_after curPos input_stream GetImage if curChar curChar error_line error_column else error_column if EOFSeen input_stream backup error_after curPos input_stream GetImage throw new TokenMgrError EOFSeen curLexState error_line error_column error_after curChar TokenMgrError LEXICAL_ERROR public class NativeFSLockFactory extends LockFactory private File lockDir private void acquireTestLock throws IOException String randomLockName Long toString new Random nextInt Character MAX_RADIX Lock makeLock randomLockName try obtain catch IOException IOException e2 new IOException lockDir e2 initCause throw e2 release NativeFSLockFactory throws IOException this File null public NativeFSLockFactory String lockDirName throws IOException this new File lockDirName public NativeFSLockFactory File lockDir throws IOException setLockDir lockDir void setLockDir File lockDir throws IOException this lockDir lockDir if lockDir null if lockDir exists if lockDir mkdirs throw new IOException lockDir getAbsolutePath else if lockDir isDirectory throw new IOException lockDir getAbsolutePath acquireTestLock public synchronized Lock makeLock String lockName if lockPrefix null lockName lockPrefix lockName return new NativeFSLock lockDir lockName public void clearLock String lockName throws IOException if lockDir exists if lockPrefix null lockName lockPrefix lockName File lockFile new File lockDir lockName if lockFile exists lockFile delete throw new IOException lockFile class NativeFSLock extends Lock private RandomAccessFile private FileChannel channel private FileLock lock private File path private File lockDir private static HashSet LOCK_HELD new HashSet public NativeFSLock File lockDir String lockFileName this lockDir lockDir path new File lockDir lockFileName public synchronized boolean obtain throws IOException if isLocked return false if lockDir exists if lockDir mkdirs throw new IOException lockDir getAbsolutePath else if lockDir isDirectory throw new IOException lockDir getAbsolutePath String canonicalPath path getCanonicalPath boolean markedHeld false try synchronized LOCK_HELD if LOCK_HELD contains canonicalPath return false else LOCK_HELD add canonicalPath markedHeld true try new RandomAccessFile path catch IOException failureReason null if null try channel getChannel try lock channel tryLock catch IOException failureReason finally if lock null try channel close finally channel null finally if channel null try close finally null finally if markedHeld isLocked synchronized LOCK_HELD if LOCK_HELD contains canonicalPath LOCK_HELD remove canonicalPath return isLocked public synchronized void release try if isLocked try lock release finally lock null try channel close finally channel null try close finally null synchronized LOCK_HELD LOCK_HELD remove path getCanonicalPath path delete catch IOException throw new RuntimeException public boolean isLocked return lock null public String toString return path public void finalize throws Throwable try if isLocked release finally super finalize public class ISOLatin1AccentFilter extends TokenFilter public ISOLatin1AccentFilter TokenStream input super input public final Token next throws java io IOException final Token input next if null setTermText removeAccents termText return public final static String removeAccents String input final StringBuffer output new StringBuffer for int input length switch input charAt output append break output append break output append break output append break output append break output append break output append break output append break output append break output append break output append break output append break output append break output append break output append break output append break output append break output append break output append break output append break output append break output append break output append break output append break output append break default output append input charAt break return output toString public class Token public int kind public int beginLine beginColumn endLine endColumn public String image public Token next public Token specialToken public String toString return image public static final Token newToken int ofKind switch ofKind default return new Token public class RemoteCachingWrapperFilter extends Filter protected Filter filter public RemoteCachingWrapperFilter Filter filter this filter filter public BitSet bits IndexReader reader throws IOException Filter cachedFilter FilterManager getInstance getFilter filter return cachedFilter bits reader public class RangeQuery extends Query private Term lowerTerm private Term upperTerm private boolean inclusive public RangeQuery Term lowerTerm Term upperTerm boolean inclusive if lowerTerm null upperTerm null throw new IllegalArgumentException if lowerTerm null upperTerm null lowerTerm field upperTerm field throw new IllegalArgumentException if lowerTerm null this lowerTerm lowerTerm else this lowerTerm new Term upperTerm field this upperTerm upperTerm this inclusive inclusive public Query rewrite IndexReader reader throws IOException BooleanQuery query new BooleanQuery true TermEnum enumerator reader terms lowerTerm try boolean checkLower false checkLower true String testField getField do Term term enumerator term if checkLower term text compareTo lowerTerm text checkLower false if upperTerm null int compare upperTerm text compareTo term text if compare inclusive compare break else break while enumerator next finally enumerator close return query public String getField return lowerTerm null lowerTerm field upperTerm field public Term getLowerTerm return lowerTerm public Term getUpperTerm return upperTerm public boolean isInclusive return inclusive public String toString String field StringBuffer buffer new StringBuffer if getField equals field buffer append getField buffer append buffer append inclusive buffer append lowerTerm null lowerTerm text buffer append buffer append upperTerm null upperTerm text buffer append inclusive buffer append ToStringUtils boost getBoost return buffer toString public boolean equals Object if this return true if instanceof RangeQuery return false final RangeQuery other RangeQuery if this getBoost other getBoost return false if this inclusive other inclusive return false if this lowerTerm null this lowerTerm equals other lowerTerm other lowerTerm null return false if this upperTerm null this upperTerm equals other upperTerm other upperTerm null return false return true public int hashCode int Float floatToIntBits getBoost lowerTerm null lowerTerm hashCode upperTerm null upperTerm hashCode this inclusive return public class PrefixQuery extends Query private Term prefix public PrefixQuery Term prefix this prefix prefix public Term getPrefix return prefix public Query rewrite IndexReader reader throws IOException BooleanQuery query new BooleanQuery true TermEnum enumerator reader terms prefix try String prefixText prefix text String prefixField prefix field do Term term enumerator term if term null term text startsWith prefixText else break while enumerator next finally enumerator close return query public String toString String field StringBuffer buffer new StringBuffer if prefix field equals field buffer append prefix field buffer append buffer append prefix text buffer append buffer append ToStringUtils boost getBoost return buffer toString public boolean equals Object if instanceof PrefixQuery return false PrefixQuery other PrefixQuery return this getBoost other getBoost this prefix equals other prefix public int hashCode return Float floatToIntBits getBoost prefix hashCode public class StandardTokenizer extends org apache lucene analysis Tokenizer implements StandardTokenizerConstants public StandardTokenizer Reader reader this new FastCharStream reader this input reader final public org apache lucene analysis Token next throws ParseException IOException Token token null switch jj_ntk jj_ntk jj_ntk case ALPHANUM token jj_consume_token ALPHANUM break case APOSTROPHE token jj_consume_token APOSTROPHE break case ACRONYM token jj_consume_token ACRONYM break case COMPANY token jj_consume_token COMPANY break case EMAIL token jj_consume_token EMAIL break case HOST token jj_consume_token HOST break case NUM token jj_consume_token NUM break case CJ token jj_consume_token CJ break case token jj_consume_token break default jj_la1 jj_gen jj_consume_token throw new ParseException if token kind EOF if true return null else if true return new org apache lucene analysis Token token image token beginColumn token endColumn tokenImage token kind throw new Error public StandardTokenizerTokenManager token_source public Token token jj_nt private int jj_ntk private int jj_gen final private int jj_la1 new int static private int jj_la1_0 static jj_la1_0 private static void jj_la1_0 jj_la1_0 new int public StandardTokenizer CharStream stream token_source new StandardTokenizerTokenManager stream token new Token jj_ntk jj_gen for int jj_la1 public void ReInit CharStream stream token_source ReInit stream token new Token jj_ntk jj_gen for int jj_la1 public StandardTokenizer StandardTokenizerTokenManager tm token_source tm token new Token jj_ntk jj_gen for int jj_la1 public void ReInit StandardTokenizerTokenManager tm token_source tm token new Token jj_ntk jj_gen for int jj_la1 final private Token jj_consume_token int kind throws ParseException Token oldToken if oldToken token next null token token next else token token next token_source getNextToken jj_ntk if token kind kind jj_gen return token token oldToken jj_kind kind throw generateParseException final public Token getNextToken if token next null token token next else token token next token_source getNextToken jj_ntk jj_gen return token final public Token getToken int index Token token for int index if next null next else next token_source getNextToken return final private int jj_ntk if jj_nt token next null return jj_ntk token next token_source getNextToken kind else return jj_ntk jj_nt kind private java util Vector jj_expentries new java util Vector private int jj_expentry private int jj_kind public ParseException generateParseException jj_expentries removeAllElements boolean la1tokens new boolean for int la1tokens false if jj_kind la1tokens jj_kind true jj_kind for int if jj_la1 jj_gen for int if jj_la1_0 la1tokens true for int if la1tokens jj_expentry new int jj_expentry jj_expentries addElement jj_expentry int exptokseq new int jj_expentries size for int jj_expentries size exptokseq int jj_expentries elementAt return new ParseException token exptokseq tokenImage final public void enable_tracing final public void disable_tracing public class ByteFieldSource extends FieldCacheSource private FieldCache ByteParser parser public ByteFieldSource String field this field null public ByteFieldSource String field FieldCache ByteParser parser super field this parser parser public String description return super description public DocValues getCachedFieldValues FieldCache cache String field IndexReader reader throws IOException final byte arr parser null cache getBytes reader field cache getBytes reader field parser return new DocValues reader maxDoc public float floatVal int doc return float arr doc public int intVal int doc return arr doc public String toString int doc return description intVal doc Object getInnerArray return arr public boolean cachedFieldSourceEquals FieldCacheSource if getClass ByteFieldSource class return false ByteFieldSource other ByteFieldSource return this parser null other parser null this parser getClass other parser getClass public int cachedFieldSourceHashCode return parser null Byte class hashCode parser getClass hashCode public class OrdFieldSource extends ValueSource protected String field public OrdFieldSource String field this field field public String description return field public DocValues getValues IndexReader reader throws IOException final int arr FieldCache DEFAULT getStringIndex reader field order return new DocValues arr length public float floatVal int doc return float arr doc public String strVal int doc return Integer toString arr doc public String toString int doc return description intVal doc Object getInnerArray return arr public boolean equals Object if getClass OrdFieldSource class return false OrdFieldSource other OrdFieldSource return this field equals other field private static final int hcode OrdFieldSource class hashCode public int hashCode return hcode field hashCode public class MapFieldSelector implements FieldSelector Map fieldSelections public MapFieldSelector Map fieldSelections this fieldSelections fieldSelections public MapFieldSelector List fields fieldSelections new HashMap fields size for int fields size fieldSelections put fields get FieldSelectorResult LOAD public MapFieldSelector String fields fieldSelections new HashMap fields length for int fields length fieldSelections put fields FieldSelectorResult LOAD public FieldSelectorResult accept String field FieldSelectorResult selection FieldSelectorResult fieldSelections get field return selection null selection FieldSelectorResult NO_LOAD public class IndexFileNameFilter implements FilenameFilter static IndexFileNameFilter singleton new IndexFileNameFilter private HashSet extensions private HashSet extensionsInCFS public IndexFileNameFilter extensions new HashSet for int IndexFileNames INDEX_EXTENSIONS length extensions add IndexFileNames INDEX_EXTENSIONS extensionsInCFS new HashSet for int IndexFileNames INDEX_EXTENSIONS_IN_COMPOUND_FILE length extensionsInCFS add IndexFileNames INDEX_EXTENSIONS_IN_COMPOUND_FILE public boolean accept File dir String name int name lastIndexOf if String extension name substring if extensions contains extension return true else if extension startsWith extension matches return true else if extension startsWith extension matches return true else if name equals IndexFileNames DELETABLE return true else if name startsWith IndexFileNames SEGMENTS return true return false public boolean isCFSFile String name int name lastIndexOf if String extension name substring if extensionsInCFS contains extension return true if extension startsWith extension matches return true return false public static IndexFileNameFilter getFilter return singleton public final class LowerCaseTokenizer extends LetterTokenizer public LowerCaseTokenizer Reader in super in protected char normalize char return Character toLowerCase public final class BitVector private byte bits private int size private int count public BitVector int size bits new byte size public final void set int bit if bit size throw new ArrayIndexOutOfBoundsException bit bits bit bit count public final void clear int bit if bit size throw new ArrayIndexOutOfBoundsException bit bits bit bit count public final boolean get int bit if bit size throw new ArrayIndexOutOfBoundsException bit return bits bit bit public final int size return size public final int count if count int int end bits length for int end count return count public final void write Directory String name throws IOException IndexOutput output createOutput name try if isSparse else writeBits output finally output close private void writeBits IndexOutput output throws IOException output writeBytes bits bits length private void writeDgaps IndexOutput output throws IOException int last int count int bits length for int if bits output writeVInt last output writeByte bits last BYTE_COUNTS bits private boolean isSparse int factor if bits length return factor count size if bits length return factor count size if bits length return factor count size if bits length return factor count size return factor count size public BitVector Directory String name throws IOException IndexInput input openInput name try if size readDgaps input else readBits input finally input close private void readBits IndexInput input throws IOException input readBytes bits bits length private void readDgaps IndexInput input throws IOException int last int count while last input readVInt bits last input readByte BYTE_COUNTS bits last public abstract class AbstractField implements Fieldable protected String name protected boolean storeTermVector false protected boolean storeOffsetWithTermVector false protected boolean storePositionWithTermVector false protected boolean omitNorms false protected boolean isStored false protected boolean isIndexed true protected boolean isTokenized true protected boolean isBinary false protected boolean isCompressed false protected boolean lazy false protected float boost protected Object fieldsData null protected AbstractField protected AbstractField String name Field Store store Field Index index Field TermVector termVector if name null throw new NullPointerException if store Field Store YES this isStored true this isCompressed false else if store Field Store COMPRESS this isStored true this isCompressed true else if store Field Store NO this isStored false this isCompressed false else throw new IllegalArgumentException store if index Field Index NO this isIndexed false this isTokenized false else if index Field Index TOKENIZED this isIndexed true this isTokenized true else if index Field Index UN_TOKENIZED this isIndexed true this isTokenized false else if index Field Index NO_NORMS this isIndexed true this isTokenized false this omitNorms true else throw new IllegalArgumentException index this isBinary false setStoreTermVector termVector public void setBoost float boost this boost boost public float getBoost return boost public String name return name protected void setStoreTermVector Field TermVector termVector if termVector Field TermVector NO this storeTermVector false this storePositionWithTermVector false this storeOffsetWithTermVector false else if termVector Field TermVector YES this storeTermVector true this storePositionWithTermVector false this storeOffsetWithTermVector false else if termVector Field TermVector WITH_POSITIONS this storeTermVector true this storePositionWithTermVector true this storeOffsetWithTermVector false else if termVector Field TermVector WITH_OFFSETS this storeTermVector true this storePositionWithTermVector false this storeOffsetWithTermVector true else if termVector Field TermVector WITH_POSITIONS_OFFSETS this storeTermVector true this storePositionWithTermVector true this storeOffsetWithTermVector true else throw new IllegalArgumentException termVector public final boolean isStored return isStored public final boolean isIndexed return isIndexed public final boolean isTokenized return isTokenized public final boolean isCompressed return isCompressed public final boolean isTermVectorStored return storeTermVector public boolean isStoreOffsetWithTermVector return storeOffsetWithTermVector public boolean isStorePositionWithTermVector return storePositionWithTermVector public final boolean isBinary return isBinary public boolean getOmitNorms return omitNorms public void setOmitNorms boolean omitNorms this omitNorms omitNorms public boolean isLazy return lazy public final String toString StringBuffer result new StringBuffer if isStored result append if isCompressed result append else result append if isIndexed if result length result append result append if isTokenized if result length result append result append if storeTermVector if result length result append result append if storeOffsetWithTermVector if result length result append result append if storePositionWithTermVector if result length result append result append if isBinary if result length result append result append if omitNorms result append if lazy result append result append result append name result append if fieldsData null lazy false result append fieldsData result append return result toString public class DisjunctionMaxQuery extends Query private ArrayList disjuncts new ArrayList private float tieBreakerMultiplier public DisjunctionMaxQuery float tieBreakerMultiplier this tieBreakerMultiplier tieBreakerMultiplier public DisjunctionMaxQuery Collection disjuncts float tieBreakerMultiplier this tieBreakerMultiplier tieBreakerMultiplier add disjuncts public void add Query query disjuncts add query public void add Collection disjuncts this disjuncts addAll disjuncts public Iterator iterator return disjuncts iterator private class DisjunctionMaxWeight implements Weight public DisjunctionMaxWeight Searcher searcher throws IOException this searcher searcher for int disjuncts size weights add Query disjuncts get createWeight searcher public Query getQuery return DisjunctionMaxQuery this public float getValue return getBoost public float sumOfSquaredWeights throws IOException float max sum for int weights size float sub Weight weights get sumOfSquaredWeights sum sub max Math max max sub return sum max tieBreakerMultiplier tieBreakerMultiplier max getBoost getBoost public void normalize float norm for int weights size Weight weights get normalize norm public Scorer scorer IndexReader reader throws IOException DisjunctionMaxScorer result new DisjunctionMaxScorer tieBreakerMultiplier getSimilarity searcher for int weights size Weight Weight weights get Scorer subScorer scorer reader if subScorer null return null result add subScorer return result public Explanation explain IndexReader reader int doc throws IOException if disjuncts size return Weight weights get explain reader doc ComplexExplanation result new ComplexExplanation float max sum result setDescription tieBreakerMultiplier tieBreakerMultiplier for int weights size Explanation Weight weights get explain reader doc if isMatch result setMatch Boolean TRUE result addDetail sum getValue max Math max max getValue result setValue max sum max tieBreakerMultiplier return result protected Weight createWeight Searcher searcher throws IOException return new DisjunctionMaxWeight searcher public Query rewrite IndexReader reader throws IOException if disjuncts size Query singleton Query disjuncts get Query result singleton rewrite reader if getBoost if result singleton result Query result clone result setBoost getBoost result getBoost return result DisjunctionMaxQuery clone null for int disjuncts size Query clause Query disjuncts get Query rewrite clause rewrite reader if rewrite clause if clone null clone DisjunctionMaxQuery this clone clone disjuncts set rewrite if clone null return clone else return this public Object clone DisjunctionMaxQuery clone DisjunctionMaxQuery super clone clone disjuncts ArrayList this disjuncts clone return clone public void extractTerms Set terms for int disjuncts size Query disjuncts get extractTerms terms public String toString String field StringBuffer buffer new StringBuffer buffer append for int disjuncts size Query subquery Query disjuncts get buffer append buffer append subquery toString field buffer append else buffer append subquery toString field if disjuncts size buffer append buffer append if tieBreakerMultiplier buffer append buffer append tieBreakerMultiplier if getBoost buffer append buffer append getBoost return buffer toString public boolean equals Object if instanceof DisjunctionMaxQuery return false DisjunctionMaxQuery other DisjunctionMaxQuery return this getBoost other getBoost this tieBreakerMultiplier other tieBreakerMultiplier this disjuncts equals other disjuncts public int hashCode return Float floatToIntBits getBoost Float floatToIntBits tieBreakerMultiplier disjuncts hashCode final class DocumentWriter private Analyzer analyzer private Directory directory private Similarity similarity private FieldInfos fieldInfos private int maxFieldLength private int termIndexInterval IndexWriter DEFAULT_TERM_INDEX_INTERVAL private PrintStream infoStream DocumentWriter Directory directory Analyzer analyzer Similarity similarity int maxFieldLength this directory directory this analyzer analyzer this similarity similarity this maxFieldLength maxFieldLength DocumentWriter Directory directory Analyzer analyzer IndexWriter writer this directory directory this analyzer analyzer this similarity writer getSimilarity this maxFieldLength writer getMaxFieldLength this termIndexInterval writer getTermIndexInterval final void addDocument String segment Document doc throws CorruptIndexException IOException fieldInfos new FieldInfos fieldInfos add doc fieldStoresPayloads new BitSet fieldInfos size Arrays fill fieldBoosts doc getBoost try invertDocument doc Posting postings sortPostingTable fieldInfos write directory segment FieldsWriter fieldsWriter new FieldsWriter directory segment fieldInfos try fieldsWriter addDocument doc finally fieldsWriter close writePostings postings segment writeNorms segment finally IOException ex null Iterator it openTokenStreams iterator while it hasNext try TokenStream it next close catch IOException if ex null ex openTokenStreams clear if ex null throw ex private final Hashtable postingTable new Hashtable private int fieldLengths private int fieldPositions private int fieldOffsets private float fieldBoosts private BitSet fieldStoresPayloads private List openTokenStreams new LinkedList private final void invertDocument Document doc throws IOException Iterator fieldIterator doc getFields iterator while fieldIterator hasNext Fieldable field Fieldable fieldIterator next String fieldName field name int fieldNumber fieldInfos fieldNumber fieldName if length position analyzer getPositionIncrementGap fieldName if field isIndexed String stringValue field stringValue if field isStoreOffsetWithTermVector addPosition fieldName stringValue position null new TermVectorOffsetInfo offset offset stringValue length else addPosition fieldName stringValue position null null offset stringValue length length else TokenStream stream field tokenStreamValue if stream null if field readerValue null reader field readerValue else if field stringValue null reader new StringReader field stringValue else throw new IllegalArgumentException stream analyzer tokenStream fieldName reader openTokenStreams add stream stream reset Token lastToken null for Token stream next null stream next position getPositionIncrement Payload payload getPayload if payload null fieldStoresPayloads set fieldNumber TermVectorOffsetInfo termVectorOffsetInfo if field isStoreOffsetWithTermVector termVectorOffsetInfo new TermVectorOffsetInfo offset startOffset offset endOffset else termVectorOffsetInfo null addPosition fieldName termText position payload termVectorOffsetInfo lastToken if length maxFieldLength if infoStream null infoStream println maxFieldLength break if lastToken null offset lastToken endOffset fieldBoosts fieldNumber field getBoost fieldOffsets fieldNumber offset for int fieldStoresPayloads nextSetBit fieldStoresPayloads nextSetBit fieldInfos fieldInfo storePayloads true private final void addPosition String field String text int position Payload payload TermVectorOffsetInfo offset termBuffer set field text Posting ti Posting postingTable get termBuffer int freq ti freq int positions ti positions System arraycopy positions newPositions freq ti positions newPositions if ti payloads null Payload payloads ti payloads System arraycopy payloads newPayloads payloads length ti payloads newPayloads if payload null if ti payloads null ti payloads new Payload ti positions length ti payloads freq payload if offset null if ti offsets length freq TermVectorOffsetInfo newOffsets new TermVectorOffsetInfo freq TermVectorOffsetInfo offsets ti offsets System arraycopy offsets newOffsets freq ti offsets newOffsets ti offsets freq offset Term term new Term field text false postingTable put term new Posting term position payload offset private final Posting sortPostingTable Posting array new Posting postingTable size Enumeration postings postingTable elements for int postings hasMoreElements array Posting postings nextElement quickSort array array length return array private static final void quickSort Posting postings int lo int hi if lo hi return int mid lo hi if postings lo term compareTo postings mid term Posting tmp postings lo postings lo postings mid postings mid tmp if postings mid term compareTo postings hi term Posting tmp postings mid postings mid postings hi postings hi tmp if postings lo term compareTo postings mid term Posting tmp2 postings lo postings lo postings mid postings mid tmp2 int left lo int right hi if left right return Term partition postings mid term for while postings right term compareTo partition right while left right postings left term compareTo partition left if left right Posting tmp postings left postings left postings right postings right tmp right else break quickSort postings lo left quickSort postings left hi private final void writePostings Posting postings String segment throws CorruptIndexException IOException IndexOutput freq null prox null TermInfosWriter tis null TermVectorsWriter termVectorWriter null try freq directory createOutput segment prox directory createOutput segment tis new TermInfosWriter directory segment fieldInfos termIndexInterval TermInfo ti new TermInfo String currentField null boolean currentFieldHasPayloads false for int postings length Posting posting postings String termField posting term field if currentField termField currentField termField FieldInfo fi fieldInfos fieldInfo currentField currentFieldHasPayloads fi storePayloads if fi storeTermVector if termVectorWriter null termVectorWriter new TermVectorsWriter directory segment fieldInfos termVectorWriter openDocument termVectorWriter openField currentField else if termVectorWriter null termVectorWriter closeField ti set freq getFilePointer prox getFilePointer tis add posting term ti int postingFreq posting freq else int positions posting positions Payload payloads posting payloads int lastPayloadLength int position positions int delta position lastPosition if currentFieldHasPayloads int payloadLength Payload payload null if payloads null payload payloads if payload null payloadLength payload length if payloadLength lastPayloadLength prox writeVInt delta else prox writeVInt delta prox writeVInt payloadLength lastPayloadLength payloadLength if payloadLength prox writeBytes payload data payload offset payload length else prox writeVInt delta lastPosition position if termVectorWriter null termVectorWriter isFieldOpen termVectorWriter addTerm posting term text postingFreq posting positions posting offsets if termVectorWriter null termVectorWriter closeDocument finally IOException keep null if freq null try freq close catch IOException if keep null keep if prox null try prox close catch IOException if keep null keep if tis null try tis close catch IOException if keep null keep if termVectorWriter null try termVectorWriter close catch IOException if keep null keep if keep null throw IOException keep fillInStackTrace private final void writeNorms String segment throws IOException for int fieldInfos size FieldInfo fi fieldInfos fieldInfo if fi isIndexed fi omitNorms float norm fieldBoosts similarity lengthNorm fi name fieldLengths IndexOutput norms directory createOutput segment try norms writeByte Similarity encodeNorm norm finally norms close void setInfoStream PrintStream infoStream this infoStream infoStream int getNumFields return fieldInfos size TermVectorOffsetInfo offsets Posting Term int position Payload payload TermVectorOffsetInfo offset term freq positions new int positions position if payload null payloads new Payload payloads payload else payloads null if offset null offsets new TermVectorOffsetInfo offsets offset else offsets null public final class Constants public static final String JAVA_VERSION System getProperty public static final boolean JAVA_1_1 JAVA_VERSION startsWith public static final boolean JAVA_1_2 JAVA_VERSION startsWith public static final boolean JAVA_1_3 JAVA_VERSION startsWith public static final String OS_NAME System getProperty public static final boolean LINUX OS_NAME startsWith public static final boolean WINDOWS OS_NAME startsWith public static final boolean SUN_OS OS_NAME startsWith public abstract class MultiTermQuery extends Query private Term term public MultiTermQuery Term term this term term public Term getTerm return term protected abstract FilteredTermEnum getEnum IndexReader reader throws IOException public Query rewrite IndexReader reader throws IOException FilteredTermEnum enumerator getEnum reader BooleanQuery query new BooleanQuery true try do Term enumerator term if null while enumerator next finally enumerator close return query public String toString String field StringBuffer buffer new StringBuffer if term field equals field buffer append term field buffer append buffer append term text buffer append ToStringUtils boost getBoost return buffer toString public boolean equals Object if this return true if instanceof MultiTermQuery return false final MultiTermQuery multiTermQuery MultiTermQuery if term equals multiTermQuery term return false return getBoost multiTermQuery getBoost public int hashCode return term hashCode Float floatToRawIntBits getBoost final class BooleanScorer extends Scorer private SubScorer scorers null private BucketTable bucketTable new BucketTable private int maxCoord private float coordFactors null private int requiredMask private int prohibitedMask private int nextMask private final int minNrShouldMatch BooleanScorer Similarity similarity this similarity BooleanScorer Similarity similarity int minNrShouldMatch super similarity this minNrShouldMatch minNrShouldMatch static final class SubScorer public Scorer scorer public boolean done public boolean required false public boolean prohibited false public HitCollector collector public SubScorer next public SubScorer Scorer scorer boolean required boolean prohibited HitCollector collector SubScorer next throws IOException this scorer scorer this done scorer next this required required this prohibited prohibited this collector collector this next next final void add Scorer scorer boolean required boolean prohibited throws IOException int mask if required prohibited if nextMask throw new IndexOutOfBoundsException mask nextMask nextMask nextMask else mask if prohibited maxCoord if prohibited else if required scorers new SubScorer scorer required prohibited bucketTable newCollector mask scorers private final void computeCoordFactors coordFactors new float maxCoord for int maxCoord coordFactors getSimilarity coord maxCoord private int end private Bucket current public void score HitCollector hc throws IOException next score hc Integer MAX_VALUE protected boolean score HitCollector hc int max throws IOException if coordFactors null computeCoordFactors boolean more Bucket tmp do bucketTable first null if current bits prohibitedMask current bits requiredMask requiredMask if current doc max tmp current current current next tmp next bucketTable first bucketTable first tmp continue if current coord minNrShouldMatch hc collect current doc current score coordFactors current coord if bucketTable first null current bucketTable first bucketTable first current next return true more false end BucketTable SIZE for SubScorer sub scorers sub null sub sub next if sub done sub done sub scorer score sub collector end if sub done more true current bucketTable first while current null more return false public int doc return current doc public boolean next throws IOException boolean more do current bucketTable first if current bits prohibitedMask current bits requiredMask requiredMask current coord minNrShouldMatch return true more false end BucketTable SIZE for SubScorer sub scorers sub null sub sub next Scorer scorer sub scorer while sub done scorer doc end sub collector collect scorer doc scorer score sub done scorer next if sub done more true while bucketTable first null more return false public float score if coordFactors null computeCoordFactors return current score coordFactors current coord static final class Bucket static final class BucketTable public static final int SIZE public static final int MASK SIZE final Bucket buckets new Bucket SIZE public BucketTable public final int size return SIZE public HitCollector newCollector int mask return new Collector mask this static final class Collector extends HitCollector private BucketTable bucketTable private int mask public Collector int mask BucketTable bucketTable this mask mask this bucketTable bucketTable public final void collect final int doc final float score final BucketTable table bucketTable final int doc BucketTable MASK Bucket bucket table buckets if bucket null table buckets bucket new Bucket table first bucket public boolean skipTo int target throw new UnsupportedOperationException public Explanation explain int doc throw new UnsupportedOperationException public String toString StringBuffer buffer new StringBuffer buffer append for SubScorer sub scorers sub null sub sub next buffer append sub scorer toString buffer append buffer append return buffer toString public class QueryFilter extends CachingWrapperFilter public QueryFilter Query query super new QueryWrapperFilter query public boolean equals Object return super equals QueryFilter public int hashCode return super hashCode public class ParallelMultiSearcher extends MultiSearcher private Searchable searchables private int starts public ParallelMultiSearcher Searchable searchables throws IOException super searchables this searchables searchables this starts getStarts public int docFreq Term term throws IOException return super docFreq term public TopDocs search Weight weight Filter filter int nDocs throws IOException HitQueue hq new HitQueue nDocs int totalHits MultiSearcherThread msta new MultiSearcherThread searchables length msta new MultiSearcherThread searchables weight filter nDocs hq starts msta start for int searchables length try msta join catch InterruptedException ie IOException ioe msta getIOException if ioe null totalHits msta hits else throw ioe ScoreDoc scoreDocs new ScoreDoc hq size scoreDocs ScoreDoc hq pop float maxScore totalHits Float NEGATIVE_INFINITY scoreDocs score return new TopDocs totalHits scoreDocs maxScore public TopFieldDocs search Weight weight Filter filter int nDocs Sort sort throws IOException FieldDocSortedHitQueue hq new FieldDocSortedHitQueue null nDocs int totalHits MultiSearcherThread msta new MultiSearcherThread searchables length msta new MultiSearcherThread searchables weight filter nDocs hq sort starts msta start float maxScore Float NEGATIVE_INFINITY for int searchables length try msta join catch InterruptedException ie IOException ioe msta getIOException if ioe null totalHits msta hits maxScore Math max maxScore msta getMaxScore else throw ioe ScoreDoc scoreDocs new ScoreDoc hq size scoreDocs ScoreDoc hq pop return new TopFieldDocs totalHits scoreDocs hq getFields maxScore public void search Weight weight Filter filter final HitCollector results throws IOException for int searchables length final int start starts searchables search weight filter new HitCollector public void collect int doc float score results collect doc start score public Query rewrite Query original throws IOException return super rewrite original class MultiSearcherThread extends Thread private Searchable searchable private Weight weight private Filter filter private int nDocs private TopDocs docs private int private PriorityQueue hq private int starts private IOException ioe private Sort sort public MultiSearcherThread Searchable searchable Weight weight Filter filter int nDocs HitQueue hq int int starts String name super name this searchable searchable this weight weight this filter filter this nDocs nDocs this hq hq this this starts starts public MultiSearcherThread Searchable searchable Weight weight Filter filter int nDocs FieldDocSortedHitQueue hq Sort sort int int starts String name super name this searchable searchable this weight weight this filter filter this nDocs nDocs this hq hq this this starts starts this sort sort public void run try docs sort null searchable search weight filter nDocs searchable search weight filter nDocs sort catch IOException ioe this ioe ioe if ioe null if sort null FieldDocSortedHitQueue hq setFields TopFieldDocs docs fields ScoreDoc scoreDocs docs scoreDocs for int scoreDocs length ScoreDoc scoreDoc scoreDocs synchronized hq if hq insert scoreDoc break public int hits return docs totalHits public float getMaxScore return docs getMaxScore public IOException getIOException return ioe class ConjunctionScorer extends Scorer private Scorer scorers new Scorer private int length private int first private int last private boolean firstTime true private boolean more true private float coord public ConjunctionScorer Similarity similarity super similarity final void add Scorer scorer if length scorers length Scorer temps new Scorer scorers length System arraycopy scorers temps length scorers temps last length scorers last scorer public int doc return scorers first doc public boolean next throws IOException if firstTime init true else if more return doNext private boolean doNext throws IOException first first length first public boolean skipTo int target throws IOException if firstTime init false for int pos first length if more break more scorers pos skipTo target pos pos length pos if more return doNext public float score throws IOException float sum for int length sum scorers score return sum coord private void init boolean initScorers throws IOException coord getSimilarity coord length length more length if initScorers for int pos first length if more break more scorers pos next pos pos length pos if more sortScorers firstTime false private void sortScorers if length scorers length Scorer temps new Scorer length System arraycopy scorers temps length scorers temps public int compare Object o1 Object o2 return Scorer o1 doc Scorer o2 doc first last length public Explanation explain int doc throw new UnsupportedOperationException public class Token implements Cloneable Payload payload private int positionIncrement public Token String text int start int end termText text startOffset start endOffset end public Token String text int start int end String typ termText text startOffset start endOffset end type typ public void setPositionIncrement int positionIncrement if positionIncrement throw new IllegalArgumentException positionIncrement this positionIncrement positionIncrement public int getPositionIncrement return positionIncrement public void setTermText String text termText text public final String termText return termText public final int startOffset return startOffset public final int endOffset return endOffset public final String type return type public void setPayload Payload payload this payload payload public Payload getPayload return this payload public String toString StringBuffer sb new StringBuffer sb append termText startOffset endOffset if type equals sb append type if positionIncrement sb append positionIncrement sb append return sb toString public Object clone try return super clone catch CloneNotSupportedException public final class FastCharStream implements CharStream char buffer null public FastCharStream Reader input public final char readChar throws IOException if bufferPosition bufferLength refill return buffer bufferPosition private final void refill throws IOException int newPosition bufferLength tokenStart buffer new char char newBuffer new char buffer length System arraycopy buffer newBuffer bufferLength buffer newBuffer System arraycopy buffer tokenStart buffer newPosition bufferPosition newPosition bufferStart tokenStart tokenStart input read buffer newPosition buffer length newPosition if charsRead throw new IOException else bufferLength charsRead public final char BeginToken throws IOException tokenStart bufferPosition return readChar public final void backup int amount bufferPosition amount public final String GetImage return new String buffer tokenStart bufferPosition tokenStart public final char GetSuffix int len char value new char len System arraycopy buffer bufferPosition len value len return value public final void Done try input close catch IOException System err println public final int getColumn return bufferStart bufferPosition public final int getLine return public final int getEndColumn return bufferStart bufferPosition public final int getEndLine return public final int getBeginColumn return bufferStart tokenStart public final int getBeginLine return public class WildcardTermEnum extends FilteredTermEnum Term searchTerm String field String text String pre int preLen boolean endEnum false public WildcardTermEnum IndexReader reader Term term throws IOException super searchTerm term field searchTerm field text searchTerm text int sidx text indexOf WILDCARD_STRING int cidx text indexOf WILDCARD_CHAR int idx sidx if idx idx cidx else if cidx idx Math min idx cidx pre searchTerm text substring idx preLen pre length text text substring preLen setEnum reader terms new Term searchTerm field pre protected final boolean termCompare Term term if field term field String searchText term text if searchText startsWith pre return wildcardEquals text searchText preLen endEnum true return false public final float difference return public final boolean endEnum return endEnum public static final char WILDCARD_STRING public static final char WILDCARD_CHAR public static final boolean wildcardEquals String pattern int patternIdx String string int stringIdx int patternIdx for int stringIdx boolean sEnd string length boolean pEnd pattern length if sEnd boolean justWildcardsLeft true int wildcardSearchPos while wildcardSearchPos pattern length justWildcardsLeft char wildchar pattern charAt wildcardSearchPos if wildchar WILDCARD_CHAR wildchar WILDCARD_STRING justWildcardsLeft false else if wildchar WILDCARD_CHAR return false wildcardSearchPos if justWildcardsLeft return true if sEnd pEnd break if pattern charAt WILDCARD_CHAR continue if pattern charAt WILDCARD_STRING for int string length if wildcardEquals pattern string return true break if pattern charAt string charAt break return false public void close throws IOException super close searchTerm null field null text null public class LockObtainFailedException extends IOException public LockObtainFailedException String message super message public class Sort implements Serializable public static final Sort RELEVANCE new Sort public static final Sort INDEXORDER new Sort SortField FIELD_DOC SortField fields public Sort this new SortField SortField FIELD_SCORE SortField FIELD_DOC public Sort String field setSort field false public Sort String field boolean reverse setSort field reverse public Sort String fields setSort fields public Sort SortField field setSort field public Sort SortField fields setSort fields public final void setSort String field setSort field false public void setSort String field boolean reverse SortField nfields new SortField new SortField field SortField AUTO reverse SortField FIELD_DOC fields nfields public void setSort String fieldnames final int fieldnames length SortField nfields new SortField for int nfields new SortField fieldnames SortField AUTO fields nfields public void setSort SortField field this fields new SortField field public void setSort SortField fields this fields fields public SortField getSort return fields public String toString StringBuffer buffer new StringBuffer for int fields length buffer append fields toString if fields length buffer append return buffer toString public class IndexWriter public static long WRITE_LOCK_TIMEOUT private long writeLockTimeout WRITE_LOCK_TIMEOUT public static final String WRITE_LOCK_NAME public final static int DEFAULT_MERGE_FACTOR public final static int DEFAULT_MAX_BUFFERED_DOCS public final static int DEFAULT_MAX_BUFFERED_DELETE_TERMS public final static int DEFAULT_MAX_MERGE_DOCS Integer MAX_VALUE public final static int DEFAULT_MAX_FIELD_LENGTH public final static int DEFAULT_TERM_INDEX_INTERVAL private final static int MERGE_READ_BUFFER_SIZE private IndexFileDeleter deleter private Lock writeLock private int termIndexInterval DEFAULT_TERM_INDEX_INTERVAL private int maxBufferedDeleteTerms DEFAULT_MAX_BUFFERED_DELETE_TERMS private HashMap bufferedDeleteTerms new HashMap private int numBufferedDeleteTerms private boolean useCompoundFile true private boolean closeDir private boolean closed protected final void ensureOpen throws AlreadyClosedException if closed throw new AlreadyClosedException public boolean getUseCompoundFile ensureOpen return useCompoundFile public void setUseCompoundFile boolean value ensureOpen useCompoundFile value public void setSimilarity Similarity similarity ensureOpen this similarity similarity public Similarity getSimilarity ensureOpen return this similarity public void setTermIndexInterval int interval ensureOpen this termIndexInterval interval public int getTermIndexInterval ensureOpen return termIndexInterval public IndexWriter String path Analyzer boolean create throws CorruptIndexException LockObtainFailedException IOException init FSDirectory getDirectory path create true null true public IndexWriter File path Analyzer boolean create throws CorruptIndexException LockObtainFailedException IOException init FSDirectory getDirectory path create true null true public IndexWriter Directory Analyzer boolean create throws CorruptIndexException LockObtainFailedException IOException init create false null true public IndexWriter String path Analyzer throws CorruptIndexException LockObtainFailedException IOException init FSDirectory getDirectory path true null true public IndexWriter File path Analyzer throws CorruptIndexException LockObtainFailedException IOException init FSDirectory getDirectory path true null true public IndexWriter Directory Analyzer throws CorruptIndexException LockObtainFailedException IOException init false null true public IndexWriter Directory boolean autoCommit Analyzer throws CorruptIndexException LockObtainFailedException IOException init false null autoCommit public IndexWriter Directory boolean autoCommit Analyzer boolean create throws CorruptIndexException LockObtainFailedException IOException init create false null autoCommit public IndexWriter Directory boolean autoCommit Analyzer IndexDeletionPolicy deletionPolicy throws CorruptIndexException LockObtainFailedException IOException init false deletionPolicy autoCommit public IndexWriter Directory boolean autoCommit Analyzer boolean create IndexDeletionPolicy deletionPolicy throws CorruptIndexException LockObtainFailedException IOException init create false deletionPolicy autoCommit private void init Directory Analyzer boolean closeDir IndexDeletionPolicy deletionPolicy boolean autoCommit throws CorruptIndexException LockObtainFailedException IOException if IndexReader indexExists init false closeDir deletionPolicy autoCommit else init true closeDir deletionPolicy autoCommit private void init Directory Analyzer final boolean create boolean closeDir IndexDeletionPolicy deletionPolicy boolean autoCommit throws CorruptIndexException LockObtainFailedException IOException this closeDir closeDir directory analyzer this infoStream defaultInfoStream if create directory clearLock IndexWriter WRITE_LOCK_NAME Lock writeLock directory makeLock IndexWriter WRITE_LOCK_NAME throw new LockObtainFailedException writeLock try if create try segmentInfos read directory segmentInfos clear catch IOException segmentInfos write directory else segmentInfos read directory this autoCommit autoCommit if autoCommit rollbackSegmentInfos SegmentInfos segmentInfos clone deleter new IndexFileDeleter directory deletionPolicy null new KeepOnlyLastCommitDeletionPolicy deletionPolicy segmentInfos infoStream catch IOException this writeLock release this writeLock null throw public void setMaxMergeDocs int maxMergeDocs ensureOpen this maxMergeDocs maxMergeDocs public int getMaxMergeDocs ensureOpen return maxMergeDocs public void setMaxFieldLength int maxFieldLength ensureOpen this maxFieldLength maxFieldLength public int getMaxFieldLength ensureOpen return maxFieldLength public void setMaxBufferedDocs int maxBufferedDocs ensureOpen if maxBufferedDocs throw new IllegalArgumentException this minMergeDocs maxBufferedDocs public int getMaxBufferedDocs ensureOpen return minMergeDocs public void setMaxBufferedDeleteTerms int maxBufferedDeleteTerms ensureOpen if maxBufferedDeleteTerms throw new IllegalArgumentException this maxBufferedDeleteTerms maxBufferedDeleteTerms public int getMaxBufferedDeleteTerms ensureOpen return maxBufferedDeleteTerms public void setMergeFactor int mergeFactor ensureOpen if mergeFactor throw new IllegalArgumentException this mergeFactor mergeFactor public int getMergeFactor ensureOpen return mergeFactor public static void setDefaultInfoStream PrintStream infoStream IndexWriter defaultInfoStream infoStream public static PrintStream getDefaultInfoStream return IndexWriter defaultInfoStream public void setInfoStream PrintStream infoStream ensureOpen this infoStream infoStream deleter setInfoStream infoStream public PrintStream getInfoStream ensureOpen return infoStream public void setWriteLockTimeout long writeLockTimeout ensureOpen this writeLockTimeout writeLockTimeout public long getWriteLockTimeout ensureOpen return writeLockTimeout public static void setDefaultWriteLockTimeout long writeLockTimeout IndexWriter WRITE_LOCK_TIMEOUT writeLockTimeout public static long getDefaultWriteLockTimeout return IndexWriter WRITE_LOCK_TIMEOUT public synchronized void close throws CorruptIndexException IOException if closed flushRamSegments if commitPending deleter checkpoint segmentInfos true commitPending false rollbackSegmentInfos null ramDirectory close if writeLock null writeLock null closed true if closeDir directory close protected void finalize throws Throwable try if writeLock null writeLock null finally super finalize public Directory getDirectory ensureOpen return directory public Analyzer getAnalyzer ensureOpen return analyzer public synchronized int docCount ensureOpen int count ramSegmentInfos size for int segmentInfos size SegmentInfo si segmentInfos info count si docCount return count private int maxFieldLength DEFAULT_MAX_FIELD_LENGTH public void addDocument Document doc throws CorruptIndexException IOException addDocument doc analyzer public void addDocument Document doc Analyzer analyzer throws CorruptIndexException IOException ensureOpen SegmentInfo newSegmentInfo buildSingleDocSegment doc analyzer synchronized this ramSegmentInfos addElement newSegmentInfo maybeFlushRamSegments SegmentInfo buildSingleDocSegment Document doc Analyzer analyzer throws CorruptIndexException IOException DocumentWriter dw new DocumentWriter ramDirectory analyzer this dw setInfoStream infoStream String segmentName newRamSegmentName dw addDocument segmentName doc SegmentInfo si new SegmentInfo segmentName ramDirectory false false si setNumFields dw getNumFields return si public synchronized void deleteDocuments Term term throws CorruptIndexException IOException ensureOpen bufferDeleteTerm term maybeFlushRamSegments public synchronized void deleteDocuments Term terms throws CorruptIndexException IOException ensureOpen for int terms length bufferDeleteTerm terms maybeFlushRamSegments public void updateDocument Term term Document doc throws CorruptIndexException IOException ensureOpen updateDocument term doc getAnalyzer public void updateDocument Term term Document doc Analyzer analyzer throws CorruptIndexException IOException ensureOpen SegmentInfo newSegmentInfo buildSingleDocSegment doc analyzer synchronized this bufferDeleteTerm term ramSegmentInfos addElement newSegmentInfo maybeFlushRamSegments final synchronized String newRamSegmentName return Integer toString ramSegmentInfos counter Character MAX_RADIX final synchronized int getSegmentCount return segmentInfos size final synchronized int getRamSegmentCount return ramSegmentInfos size final synchronized int getDocCount int if segmentInfos size return segmentInfos info docCount else return final synchronized String newSegmentName return Integer toString segmentInfos counter Character MAX_RADIX private int mergeFactor DEFAULT_MERGE_FACTOR private int minMergeDocs DEFAULT_MAX_BUFFERED_DOCS private int maxMergeDocs DEFAULT_MAX_MERGE_DOCS private PrintStream infoStream null private static PrintStream defaultInfoStream null public synchronized void optimize throws CorruptIndexException IOException ensureOpen flushRamSegments while segmentInfos size segmentInfos size SegmentReader hasDeletions segmentInfos info SegmentReader hasSeparateNorms segmentInfos info segmentInfos info dir directory useCompoundFile SegmentReader usesCompoundFile segmentInfos info int minSegment segmentInfos size mergeFactor mergeSegments segmentInfos minSegment minSegment segmentInfos size private void startTransaction throws IOException localRollbackSegmentInfos SegmentInfos segmentInfos clone localAutoCommit autoCommit if localAutoCommit flushRamSegments autoCommit false else deleter incRef segmentInfos false private void rollbackTransaction throws IOException autoCommit localAutoCommit segmentInfos clear segmentInfos addAll localRollbackSegmentInfos localRollbackSegmentInfos null deleter checkpoint segmentInfos false if autoCommit deleter decRef segmentInfos deleter refresh private void commitTransaction throws IOException autoCommit localAutoCommit boolean success false try checkpoint success true finally if success rollbackTransaction if autoCommit deleter decRef localRollbackSegmentInfos localRollbackSegmentInfos null deleter checkpoint segmentInfos autoCommit public synchronized void abort throws IOException ensureOpen if autoCommit segmentInfos clear segmentInfos addAll rollbackSegmentInfos deleter checkpoint segmentInfos false deleter refresh ramSegmentInfos new SegmentInfos bufferedDeleteTerms clear numBufferedDeleteTerms commitPending false close else throw new IllegalStateException private void checkpoint throws IOException if autoCommit segmentInfos write directory else commitPending true public synchronized void addIndexes Directory dirs throws CorruptIndexException IOException ensureOpen int start segmentInfos size boolean success false startTransaction try for int dirs length sis read dirs for int sis size while segmentInfos size start mergeFactor for int base start base segmentInfos size base int end Math min segmentInfos size base mergeFactor if end base mergeSegments segmentInfos base end success true finally if success commitTransaction else rollbackTransaction public synchronized void addIndexesNoOptimize Directory dirs throws CorruptIndexException IOException ensureOpen flushRamSegments int startUpperBound minMergeDocs boolean success false startTransaction try for int dirs length if directory dirs throw new IllegalArgumentException sis read dirs for int sis size SegmentInfo info sis info while startUpperBound info docCount if startUpperBound maxMergeDocs throw new IllegalArgumentException maybeMergeSegments startUpperBound int segmentCount segmentInfos size int numTailSegments while numTailSegments segmentCount startUpperBound segmentInfos info segmentCount numTailSegments docCount numTailSegments if numTailSegments success true return if checkNonDecreasingLevels segmentCount numTailSegments int numSegmentsToCopy while numSegmentsToCopy segmentCount directory segmentInfos info segmentCount numSegmentsToCopy dir numSegmentsToCopy if numSegmentsToCopy success true return for int segmentCount numSegmentsToCopy segmentCount mergeSegments segmentInfos if checkNonDecreasingLevels segmentCount numSegmentsToCopy success true return mergeSegments segmentInfos segmentCount numTailSegments segmentCount if segmentInfos info segmentInfos size docCount startUpperBound maybeMergeSegments startUpperBound mergeFactor success true finally if success commitTransaction else rollbackTransaction public synchronized void addIndexes IndexReader readers throws CorruptIndexException IOException ensureOpen final String mergedName newSegmentName SegmentMerger merger new SegmentMerger this mergedName SegmentInfo info IndexReader sReader null try sReader SegmentReader get segmentInfos info merger add sReader merger add readers boolean success false startTransaction try if sReader null sReader close sReader null info new SegmentInfo mergedName docCount directory false true segmentInfos addElement info success true finally if success rollbackTransaction else commitTransaction finally if sReader null sReader close if useCompoundFile boolean success false startTransaction try merger createCompoundFile mergedName info setUseCompoundFile true finally if success rollbackTransaction else commitTransaction void doAfterFlush throws IOException protected final void maybeFlushRamSegments throws CorruptIndexException IOException if ramSegmentInfos size minMergeDocs numBufferedDeleteTerms maxBufferedDeleteTerms flushRamSegments private final synchronized void flushRamSegments throws CorruptIndexException IOException flushRamSegments true protected final synchronized void flushRamSegments boolean triggerMerge throws CorruptIndexException IOException if ramSegmentInfos size bufferedDeleteTerms size mergeSegments ramSegmentInfos ramSegmentInfos size if triggerMerge maybeMergeSegments minMergeDocs public final synchronized void flush throws CorruptIndexException IOException ensureOpen flushRamSegments public final long ramSizeInBytes ensureOpen return ramDirectory sizeInBytes public final synchronized int numRamDocs ensureOpen return ramSegmentInfos size private final void maybeMergeSegments int startUpperBound throws CorruptIndexException IOException long lowerBound long upperBound startUpperBound while upperBound maxMergeDocs int minSegment segmentInfos size int maxSegment while minSegment SegmentInfo si segmentInfos info minSegment if maxSegment si docCount lowerBound si docCount upperBound maxSegment minSegment else if si docCount upperBound break minSegment maxSegment int numSegments maxSegment minSegment if numSegments mergeFactor break else boolean exceedsUpperLimit false while numSegments mergeFactor int docCount mergeSegments segmentInfos minSegment minSegment mergeFactor numSegments mergeFactor if docCount upperBound minSegment exceedsUpperLimit true else numSegments if exceedsUpperLimit break lowerBound upperBound upperBound mergeFactor private final int mergeSegments SegmentInfos sourceSegments int minSegment int end throws CorruptIndexException IOException boolean doMerge end final String mergedName newSegmentName SegmentMerger merger null final List ramSegmentsToDelete new ArrayList SegmentInfo newSegment null int mergedDocCount boolean anyDeletes bufferedDeleteTerms size try if doMerge if infoStream null infoStream print merger new SegmentMerger this mergedName for int minSegment end SegmentInfo si sourceSegments info if infoStream null infoStream print si name si docCount merger add reader if reader directory this ramDirectory ramSegmentsToDelete add si SegmentInfos rollback null boolean success false try if doMerge mergedDocCount merger merge if infoStream null infoStream println mergedName mergedDocCount newSegment new SegmentInfo mergedName mergedDocCount directory false true if sourceSegments ramSegmentInfos anyDeletes rollback SegmentInfos segmentInfos clone if doMerge if sourceSegments ramSegmentInfos segmentInfos addElement newSegment else sourceSegments remove segmentInfos set minSegment newSegment if sourceSegments ramSegmentInfos maybeApplyDeletes doMerge doAfterFlush checkpoint success true finally if success if sourceSegments ramSegmentInfos ramSegmentInfos removeAllElements else if sourceSegments ramSegmentInfos anyDeletes if newSegment null segmentInfos size segmentInfos info segmentInfos size newSegment segmentInfos remove segmentInfos size else if rollback null segmentInfos clear segmentInfos addAll rollback deleter refresh finally if doMerge merger closeReaders deleter deleteDirect ramDirectory ramSegmentsToDelete deleter checkpoint segmentInfos autoCommit if useCompoundFile doMerge boolean success false try merger createCompoundFile mergedName newSegment setUseCompoundFile true checkpoint success true finally if success newSegment setUseCompoundFile false deleter refresh deleter checkpoint segmentInfos autoCommit return mergedDocCount private final void maybeApplyDeletes boolean doMerge throws CorruptIndexException IOException if bufferedDeleteTerms size if infoStream null infoStream println numBufferedDeleteTerms segmentInfos size if doMerge IndexReader reader null try reader SegmentReader get segmentInfos info segmentInfos size applyDeletesSelectively bufferedDeleteTerms reader finally if reader null try reader doCommit finally reader doClose int infosEnd segmentInfos size if doMerge infosEnd for int infosEnd IndexReader reader null try reader SegmentReader get segmentInfos info applyDeletes bufferedDeleteTerms reader finally if reader null try reader doCommit finally reader doClose bufferedDeleteTerms clear numBufferedDeleteTerms private final boolean checkNonDecreasingLevels int start int lowerBound int upperBound minMergeDocs for int segmentInfos size start int docCount segmentInfos info docCount if docCount lowerBound return false while docCount upperBound lowerBound upperBound upperBound mergeFactor return true final synchronized int getBufferedDeleteTermsSize return bufferedDeleteTerms size final synchronized int getNumBufferedDeleteTerms return numBufferedDeleteTerms private static class Num private int num Num int num this num num int getNum return num void setNum int num this num num private void bufferDeleteTerm Term term Num num Num bufferedDeleteTerms get term if num null bufferedDeleteTerms put term new Num ramSegmentInfos size else num setNum ramSegmentInfos size numBufferedDeleteTerms private final void applyDeletesSelectively HashMap deleteTerms IndexReader reader throws CorruptIndexException IOException Iterator iter deleteTerms entrySet iterator while iter hasNext Entry entry Entry iter next Term term Term entry getKey TermDocs docs reader termDocs term if docs null int num Num entry getValue getNum try while docs next int doc docs doc if doc num break reader deleteDocument doc finally docs close private final void applyDeletes HashMap deleteTerms IndexReader reader throws CorruptIndexException IOException Iterator iter deleteTerms entrySet iterator while iter hasNext Entry entry Entry iter next reader deleteDocuments Term entry getKey final class TermInfosReader private Directory directory private String segment private FieldInfos fieldInfos private ThreadLocal enumerators new ThreadLocal private SegmentTermEnum origEnum private long size private Term indexTerms null private TermInfo indexInfos private long indexPointers private SegmentTermEnum indexEnum TermInfosReader Directory dir String seg FieldInfos fis throws CorruptIndexException IOException this dir seg fis BufferedIndexInput BUFFER_SIZE TermInfosReader Directory dir String seg FieldInfos fis int readBufferSize throws CorruptIndexException IOException directory dir segment seg fieldInfos fis origEnum new SegmentTermEnum directory openInput segment readBufferSize fieldInfos false size origEnum size indexEnum new SegmentTermEnum directory openInput segment readBufferSize fieldInfos true public int getSkipInterval return origEnum skipInterval public int getMaxSkipLevels return origEnum maxSkipLevels final void close throws IOException if origEnum null origEnum close if indexEnum null indexEnum close enumerators set null final long size return size private SegmentTermEnum getEnum SegmentTermEnum termEnum SegmentTermEnum enumerators get if termEnum null termEnum terms enumerators set termEnum return termEnum private synchronized void ensureIndexIsRead throws IOException try indexTerms new Term indexSize indexInfos new TermInfo indexSize indexPointers new long indexSize for int indexEnum next indexTerms indexEnum term indexInfos indexEnum termInfo indexPointers indexEnum indexPointer finally indexEnum close indexEnum null private final int getIndexOffset Term term int hi indexTerms length while hi lo int mid lo hi int delta term compareTo indexTerms mid if delta hi mid else if delta lo mid else return mid return hi private final void seekEnum int indexOffset throws IOException getEnum seek indexPointers indexOffset indexOffset getEnum indexInterval indexTerms indexOffset indexInfos indexOffset TermInfo get Term term throws IOException if size return null ensureIndexIsRead SegmentTermEnum enumerator getEnum enumerator prev null term compareTo enumerator prev term compareTo enumerator term int enumOffset int enumerator position enumerator indexInterval term compareTo indexTerms enumOffset seekEnum getIndexOffset term return scanEnum term private final TermInfo scanEnum Term term throws IOException SegmentTermEnum enumerator getEnum enumerator scanTo term if enumerator term null term compareTo enumerator term return enumerator termInfo else return null final Term get int position throws IOException if size return null SegmentTermEnum enumerator getEnum if enumerator null enumerator term null position enumerator position position enumerator position enumerator indexInterval return scanEnum position private final Term scanEnum int position throws IOException SegmentTermEnum enumerator getEnum while enumerator position position if enumerator next return null return enumerator term final long getPosition Term term throws IOException if size return ensureIndexIsRead int indexOffset getIndexOffset term seekEnum indexOffset SegmentTermEnum enumerator getEnum while term compareTo enumerator term enumerator next if term compareTo enumerator term return enumerator position else return public SegmentTermEnum terms return SegmentTermEnum origEnum clone public SegmentTermEnum terms Term term throws IOException get term return SegmentTermEnum getEnum clone abstract class PhraseScorer extends Scorer private Weight weight protected byte norms protected float value private boolean firstTime true private boolean more true protected PhraseQueue pq protected PhrasePositions first last PhraseScorer Weight weight TermPositions tps int offsets Similarity similarity byte norms super similarity this norms norms this weight weight this value weight getValue for int tps length PhrasePositions pp new PhrasePositions tps offsets last next pp else first pp last pp public int doc return first doc public boolean next throws IOException if firstTime init firstTime false else if more return doNext private boolean doNext throws IOException while more if more else public float score throws IOException public boolean skipTo int target throws IOException firstTime false for PhrasePositions pp first more pp null pp pp next more pp skipTo target if more return doNext protected abstract float phraseFreq throws IOException private void init throws IOException for PhrasePositions pp first more pp null pp pp next more pp next if more sort private void sort pq clear for PhrasePositions pp first pp null pp pp next pq put pp pqToList protected final void pqToList last first null while pq top null PhrasePositions pp PhrasePositions pq pop last next pp else first pp last pp pp next null protected final void firstToLast last first first first next last next null public Explanation explain final int doc throws IOException Explanation tfExplanation new Explanation while next doc doc float phraseFreq doc doc freq tfExplanation setValue getSimilarity tf phraseFreq tfExplanation setDescription phraseFreq return tfExplanation public String toString return weight public class MMapDirectory extends FSDirectory private static class MMapIndexInput extends IndexInput private ByteBuffer buffer private final long length private MMapIndexInput RandomAccessFile raf throws IOException this length raf length this buffer raf getChannel map MapMode READ_ONLY length public byte readByte throws IOException return buffer get public void readBytes byte int offset int len throws IOException buffer get offset len public long getFilePointer return buffer position public void seek long pos throws IOException buffer position int pos public long length return length public Object clone MMapIndexInput clone MMapIndexInput super clone clone buffer buffer duplicate return clone public void close throws IOException private static class MultiMMapIndexInput extends IndexInput private ByteBuffer buffers private final long length private int curBufIndex private final int maxBufSize public MultiMMapIndexInput RandomAccessFile raf int maxBufSize throws IOException this length raf length this maxBufSize maxBufSize if maxBufSize throw new IllegalArgumentException maxBufSize if length maxBufSize Integer MAX_VALUE throw new IllegalArgumentException raf toString int nrBuffers int length maxBufSize if nrBuffers maxBufSize length nrBuffers this buffers new ByteBuffer nrBuffers this bufSizes new int nrBuffers long bufferStart FileChannel rafc raf getChannel for int bufNr bufNr nrBuffers bufNr int bufSize length bufferStart maxBufSize maxBufSize int length bufferStart this buffers bufNr rafc map MapMode READ_ONLY bufferStart bufSize this bufSizes bufNr bufSize bufferStart bufSize seek public byte readByte throws IOException if curAvail curBufIndex curBuf position curAvail bufSizes curBufIndex curAvail return curBuf get public void readBytes byte int offset int len throws IOException while len curAvail curBuf get offset curAvail len curAvail offset curAvail curBufIndex curBuf position curAvail bufSizes curBufIndex curBuf get offset len curAvail len public long getFilePointer return curBufIndex long maxBufSize curBuf position public void seek long pos throws IOException curBufIndex int pos maxBufSize curBuf buffers curBufIndex int bufOffset int pos curBufIndex maxBufSize curBuf position bufOffset curAvail bufSizes curBufIndex bufOffset public long length return length public Object clone MultiMMapIndexInput clone MultiMMapIndexInput super clone clone buffers new ByteBuffer buffers length for int bufNr bufNr buffers length bufNr clone buffers bufNr buffers bufNr duplicate try clone seek getFilePointer catch IOException ioe RuntimeException newException new RuntimeException ioe newException initCause ioe throw newException return clone public void close throws IOException private final int MAX_BBUF Integer MAX_VALUE public IndexInput openInput String name throws IOException File new File getFile name RandomAccessFile raf new RandomAccessFile try return raf length MAX_BBUF IndexInput new MMapIndexInput raf IndexInput new MultiMMapIndexInput raf MAX_BBUF finally raf close public class SetBasedFieldSelector implements FieldSelector private Set fieldsToLoad private Set lazyFieldsToLoad public SetBasedFieldSelector Set fieldsToLoad Set lazyFieldsToLoad this fieldsToLoad fieldsToLoad this lazyFieldsToLoad lazyFieldsToLoad public FieldSelectorResult accept String fieldName FieldSelectorResult result FieldSelectorResult NO_LOAD if fieldsToLoad contains fieldName true result FieldSelectorResult LOAD if lazyFieldsToLoad contains fieldName true result FieldSelectorResult LAZY_LOAD return result public class Explanation implements java io Serializable public Explanation public Explanation float value String description this value value this description description public boolean isMatch return getValue public float getValue return value public void setValue float value this value value public String getDescription return description public void setDescription String description this description description protected String getSummary return getValue getDescription public Explanation getDetails if details null return null return Explanation details toArray new Explanation public void addDetail Explanation detail if details null details new ArrayList details add detail public String toString return toString protected String toString int depth StringBuffer buffer new StringBuffer for int depth buffer append buffer append getSummary buffer append Explanation details getDetails if details null for int details length buffer append details toString depth return buffer toString public String toHtml StringBuffer buffer new StringBuffer buffer append buffer append buffer append getSummary buffer append Explanation details getDetails if details null for int details length buffer append details toHtml buffer append buffer append return buffer toString public class FieldReaderException extends RuntimeException public FieldReaderException public FieldReaderException Throwable cause super cause public FieldReaderException String message super message public FieldReaderException String message Throwable cause super message cause final class FieldInfo String name boolean isIndexed int number boolean storeTermVector boolean storeOffsetWithTermVector boolean storePositionWithTermVector FieldInfo String na boolean tk int nu boolean storeTermVector boolean storePositionWithTermVector boolean storeOffsetWithTermVector boolean omitNorms boolean storePayloads name na isIndexed tk number nu this storeTermVector storeTermVector this storeOffsetWithTermVector storeOffsetWithTermVector this storePositionWithTermVector storePositionWithTermVector this omitNorms omitNorms this storePayloads storePayloads public class HitIterator implements Iterator private Hits hits private int hitNumber HitIterator Hits hits this hits hits public boolean hasNext return hitNumber hits length public Object next if hitNumber hits length throw new NoSuchElementException Object next new Hit hits hitNumber hitNumber return next public void remove throw new UnsupportedOperationException public int length return hits length class BooleanScorer2 extends Scorer private ArrayList requiredScorers new ArrayList private ArrayList optionalScorers new ArrayList private ArrayList prohibitedScorers new ArrayList private class Coordinator private float coordFactors null coordFactors new float maxCoord Similarity sim getSimilarity for int maxCoord coordFactors sim coord maxCoord void initDoc nrMatchers float coordFactor return coordFactors nrMatchers private final Coordinator coordinator private Scorer countingSumScorer null private final int minNrShouldMatch private boolean allowDocsOutOfOrder public BooleanScorer2 Similarity similarity int minNrShouldMatch boolean allowDocsOutOfOrder super similarity if minNrShouldMatch throw new IllegalArgumentException coordinator new Coordinator this minNrShouldMatch minNrShouldMatch this allowDocsOutOfOrder allowDocsOutOfOrder public BooleanScorer2 Similarity similarity int minNrShouldMatch this similarity minNrShouldMatch false public BooleanScorer2 Similarity similarity this similarity false public void add final Scorer scorer boolean required boolean prohibited if prohibited coordinator maxCoord if required if prohibited throw new IllegalArgumentException requiredScorers add scorer else if prohibited prohibitedScorers add scorer else optionalScorers add scorer private void initCountingSumScorer coordinator init countingSumScorer makeCountingSumScorer private class SingleMatchScorer extends Scorer private Scorer scorer private int lastScoredDoc SingleMatchScorer Scorer scorer super scorer getSimilarity this scorer scorer public float score throws IOException if this doc lastScoredDoc lastScoredDoc this doc coordinator nrMatchers return scorer score public int doc return scorer doc public boolean next throws IOException return scorer next public boolean skipTo int docNr throws IOException return scorer skipTo docNr public Explanation explain int docNr throws IOException return scorer explain docNr private Scorer countingDisjunctionSumScorer final List scorers int minNrShouldMatch return new DisjunctionSumScorer scorers minNrShouldMatch private int lastScoredDoc public float score throws IOException if this doc lastScoredDoc lastScoredDoc this doc coordinator nrMatchers super nrMatchers return super score private static Similarity defaultSimilarity new DefaultSimilarity private Scorer countingConjunctionSumScorer List requiredScorers final int requiredNrMatchers requiredScorers size ConjunctionScorer cs new ConjunctionScorer defaultSimilarity private int lastScoredDoc public float score throws IOException if this doc lastScoredDoc lastScoredDoc this doc coordinator nrMatchers requiredNrMatchers return super score Iterator rsi requiredScorers iterator while rsi hasNext cs add Scorer rsi next return cs ConjunctionScorer cs new ConjunctionScorer defaultSimilarity cs add req1 cs add req2 return cs return requiredScorers size makeCountingSumScorerNoReq makeCountingSumScorerSomeReq if optionalScorers size int nrOptRequired minNrShouldMatch minNrShouldMatch if optionalScorers size nrOptRequired Scorer requiredCountingSumScorer optionalScorers size nrOptRequired countingDisjunctionSumScorer optionalScorers nrOptRequired optionalScorers size new SingleMatchScorer Scorer optionalScorers get countingConjunctionSumScorer optionalScorers return addProhibitedScorers requiredCountingSumScorer if optionalScorers size minNrShouldMatch ArrayList allReq new ArrayList requiredScorers allReq addAll optionalScorers return addProhibitedScorers countingConjunctionSumScorer allReq Scorer requiredCountingSumScorer requiredScorers size new SingleMatchScorer Scorer requiredScorers get countingConjunctionSumScorer requiredScorers return addProhibitedScorers requiredCountingSumScorer countingDisjunctionSumScorer optionalScorers minNrShouldMatch return new ReqOptSumScorer addProhibitedScorers requiredCountingSumScorer optionalScorers size new SingleMatchScorer Scorer optionalScorers get private Scorer addProhibitedScorers Scorer requiredCountingSumScorer return prohibitedScorers size new ReqExclScorer requiredCountingSumScorer prohibitedScorers size Scorer prohibitedScorers get new DisjunctionSumScorer prohibitedScorers public void score HitCollector hc throws IOException if allowDocsOutOfOrder requiredScorers size prohibitedScorers size BooleanScorer bs new BooleanScorer getSimilarity minNrShouldMatch Iterator si optionalScorers iterator while si hasNext si prohibitedScorers iterator while si hasNext bs score hc else if countingSumScorer null initCountingSumScorer while countingSumScorer next hc collect countingSumScorer doc score protected boolean score HitCollector hc int max throws IOException int docNr countingSumScorer doc while docNr max hc collect docNr score if countingSumScorer next return false docNr countingSumScorer doc return true public int doc return countingSumScorer doc public boolean next throws IOException if countingSumScorer null initCountingSumScorer return countingSumScorer next public float score throws IOException coordinator initDoc float sum countingSumScorer score return sum coordinator coordFactor public boolean skipTo int target throws IOException if countingSumScorer null initCountingSumScorer return countingSumScorer skipTo target public Explanation explain int doc throw new UnsupportedOperationException 